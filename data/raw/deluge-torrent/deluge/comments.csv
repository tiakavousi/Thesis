id,pr_number,user,created_at,body
1004610739,331,DjLegolas,2022-01-04T08:26:43Z,"Looks great, thanks.
If you can, please add a job to the CI for automatic creating the installer. It will need to have the ability to compile everything it needs (GTK3, OpenSSL, etc.)."
1004613096,331,doadin,2022-01-04T08:30:56Z,"@DjLegolas 
I'm working on that atm. The hardest part kind of is compiling GTK. Others have public windows builds. Could use a build host for this but artifacts don't last forever. And GTK takes quite a bit of time to compile."
1004642179,331,doadin,2022-01-04T09:17:01Z,"@DjLegolas
The best option would probably be to have a build of GTK hosted somewhere then use that plus the already available builds of others eg. just pip install libtorrent and use prebuilt openssl from the ci host, as most things are available or easy to get like with pip, GTK is the only thing really hard to get."
1004646414,331,cas--,2022-01-04T09:23:35Z,"@doadin I agree if we can start simple with dependencies the better, where needed we can modify it later to suit.  For GTK we could fork the gvsbuild repo and create releases or store them on deluge ftp, either way we want a simple reproducible process."
1004650915,331,doadin,2022-01-04T09:30:20Z,"@cas-- Yes I plan on on making an CD github actions, since that seems to be what we are using for other things, that will making an installer using prebuilts from github actions image, which the only thing I see needed out side of that is GTK ill make the script to use from appveyor since thats where im currently setting up a build, should be a easy change in url to a different host depending on where you would like to get it from."
1004690840,331,doadin,2022-01-04T10:27:07Z,"@DjLegolas @cas-- 
It seems that github actions uses powershell to run so I added a sample CD.yml based on that which should only need a correction for the URL where we want to get GTK from. The deluge spec file already has path setup to be able to find openssl and such so unless the wheel of libtorrent from pip requires something else should be able to find all the deps deluge needs.

Edit: also the path to gtk may need editing all depends on how we get gtk and how the zip for it looks and is extracted and so on. Again though should be a fairly easy edit of the spec file to make any correction for how the build environment is setup. Appveyor and github actions (maybe others) seem to put openssl and such in the same location so should be pretty easy to make work any where really.

Also I made the sample only build on pushed tags so any time you want to make a release should be as simple as adding a tag. We could maybe build for PRs too or something but you guys can decide that."
1005092640,331,DjLegolas,2022-01-04T19:05:44Z,"BTW, great work @doadin ðŸ¥‡"
1005310000,331,doadin,2022-01-05T01:42:24Z,"@DjLegolas  @cas-- I think I have addressed the points you guys have brought up, still uncertain about nsis use again I'm not very familiar but I think other than it being cleaner its at least close to proper syntax?"
1005380653,331,doadin,2022-01-05T04:50:34Z,"@DjLegolas @cas--  So im really stuck its apparently not able to load a dll for gtk, which I have no clue. I have the spec file setup to add GTK\lib folder and the VC redist to path but its still missing a dll from somewhere idk."
1005426388,331,DjLegolas,2022-01-05T06:50:55Z,"@doadin - don't worry, we will help you with that.
Seem like there are several dlls missing:

1. python - `No such file or directory: 'c:\\hostedtoolcache\\windows\\python\\3.7.9\\x64\\DLLs\\'`. Maybe it's on another location or name?
2. make sure that the GTK lib and bin paths are in the PATH environment variable so the the python libs will find them."
1005450228,331,doadin,2022-01-05T07:40:34Z,"@DjLegolas 
1. I did a print of the dir and that dir does exist not sure why it says it doesn't. (side note: do wish we could have rdp to the vm like with appveyor.)
2.I am using pathex in pyinstaller to add the GTK lib and bin paths. I could try and add it in the build script vs pyinstaller adding it but should work from pyinstaller.
`12734 INFO: Extending PYTHONPATH with paths
['C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\Scripts',
 'C:\\gtk-build\\gtk\\x86\\release\\bin',
 'C:\\gtk-build\\gtk\\x86\\release\\lib',
 'C:\\gtk-build\\gtk\\x86\\release\\share',
 'C:\\GTK\\release\\bin',
 'C:\\GTK\\release\\lib',
 'C:\\GTK\\release\\share',
 'C:\\OpenSSL-Win64\\bin',
 'C:\\Program Files (x86)\\Microsoft Visual '
 'Studio\\2019\\Enterprise\\VC\\Redist\\MSVC\\14.29.30133',
 'C:\\Windows\\System32',
 'C:\\Windows\\SysWOW64',
 'C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64',
 'C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\DLLs']`"
1005455759,331,doadin,2022-01-05T07:51:31Z,@DjLegolas I tried adding the GTK dir to path from the github actions and still no go. I wish I knew what DLL it can't find would be probabbly really easy to find if I knew what I was looking for lol.
1005530462,331,mhertz,2022-01-05T09:45:04Z,"Really stupid question, but doesn't help using x64 gtk(for x64 build) ? It's seemingly through bindepend.py/pefile.py trying check a file related to gi(hook) , which links to gtk dlls, running matchdllarch on them, or something. Strange error regardless. As said on forum, the pathhex is irrelevant, atleast on real system, with that spec(mine atleast), when in PATH as djlegolas said, just to not waste time on adding there this and that. Anyway, really impressed, looking great, thanks a bunch for all the nice work :) 

Edit: I'm sorry, just looked more at the commit, and see the gvsbuild zip states x64 in name, but I just thought it was x86 because added panthex's lists e.g the standard gvsbuild paths for x86 builds, not standard x64 ones. I apologize for noise, and please disregard, as if having the x64 paths in PATH env-var, then fine(I'd change them regardless, spec pathex's I mean, if not completelly ditching them all).

Edit2: Before that issue, then cannot even import gi module, making breakage later on presumably, so should look into that and not the missing dir/dll(s) later reported, as byproduct of that presumably. Cannot import _gi module from gi - have you checked pygeoip installed correctly in python I.e can you import it / _gi* file in site-packages/gi?

Edit3: pygobject, not pygeoip lol :) The gtk3 python bindings wheel produced by gvsbuild. "
1005838989,331,doadin,2022-01-05T15:43:36Z,"The script installs pycairo and pygobject from wheel from gtk build folder and is ""successful"" so I see no reason why it would not be available. I could be wrong but I think the missing dll isn't a product of missing gi but other way around it tries to import gi which tries to load the dll which fails ending in the importing failing."
1005840354,331,doadin,2022-01-05T15:45:14Z,"https://github.com/deluge-torrent/deluge/runs/4711875889?check_suite_focus=true#step:5:54
https://github.com/deluge-torrent/deluge/runs/4711875889?check_suite_focus=true#step:5:58

I believe https://github.com/deluge-torrent/deluge/runs/4711875889?check_suite_focus=true#step:7:107 shows us that at least partially gi is installed. And that it fails to import because of missing dll.

Edit: again maybe I am wrong but if gi module was not installed it would be a name error or something like that not a dll error?"
1005863790,331,mhertz,2022-01-05T16:11:57Z,"Sorry doadin, thanks for explaining, and sounds like you're right. Anyway, I remember during looking through cmd output during mine builds, that it stated sometimes, probably unrelated, looking for ctypes in DLLs, though not specially for gi, but saw there where a ctypes pyd in that DLLs folder, so maybe check if there, if possible, though strange mentions dir not found in error, when there. Sorry for noise and I'll butt out now - best of luck you guys :) "
1005874174,331,doadin,2022-01-05T16:23:33Z,@mhertz I never turn down help/ideas. :)
1005882953,331,mhertz,2022-01-05T16:34:15Z,"Thanks mate :)

Just very quick, seemingly is issue of gdkpixbuff hook tries to find path to gi library dir it gets the wrong one and fails colecting any pixbuff-loaders - it tries to do a dll check I think, but cannot on a folder, as the error just mentions folder not file.

Anyway, I got this from looking closer at the output and googling it, where issue with little other, but slight related, very slight but regardless - It was stated that e.g. the user having issues had poisened his build environment by having gtk3/gdk dll's in current folder or next to script or something, messing that part up.

A suggestion was to check if can see the path correct by adding in spec file, just for troubleshooting... well, you can see yourself what to add, a single line printing it to cmd during freeze - I didn't yet read it through, so possibly better hints later, and again sorry if way off:

https://github.com/pyinstaller/pyinstaller/issues/6282
 
Edit: No need add in spec, sorry, just states to check in python from where running pyinstaller normally. Here gets the correct:

C:\\gtk-build\\gtk\\x64\\release\\bin"
1005895701,331,doadin,2022-01-05T16:50:47Z,I have a theory I am testing now. Normally I believe when you install gtk python bindings you end up with a struckture something like python/lib/site-packages/gnome/gi-repository I just made a build attempt and made it print out the site-packages folder and the gi-repository which I believe normally has libs in it only had like 1 file and was a __init__.py or something like that. Im thinking maybe for some reason the wheel is incomplete. Im currently running a build on my test VM to see the folder structure.
1005898284,331,mhertz,2022-01-05T16:54:03Z,"When installing pygobject, then always makes gi dir under site_packages and bunch other gi dirs there. Indeed if only a __init__.py, then the issue as per error, as the _gi*.pyd not there, which tries imported - so the install of wheel went wrong, or incomplete as you state. Good catch, sorry for my ramblings before."
1005901327,331,doadin,2022-01-05T16:57:43Z,I'm trying to run a test suggested in that github issue and see where it is looking for the lib then we can check that folder to confirm if the files needed are there or not.
1005902679,331,mhertz,2022-01-05T16:59:23Z,"The gi regardless is f'ed up - you need a _gi*.pyd there for import, and i'm pretty sure that's the root cause(if you say there only is a init.py under site_packages/gi). But sure, test that out.

Edit:

C:\Python37\Lib\site-packages\gi>dir
 Volume in drive C has no label.
 Volume Serial Number is AAB9-32CE

 Directory of C:\Python37\Lib\site-packages\gi

01/02/2022  07:19 PM    <DIR>          .
01/02/2022  07:19 PM    <DIR>          ..
08/25/2019  05:33 PM             6,688 docstring.py
05/06/2020  04:48 PM             5,241 importer.py
05/06/2020  04:48 PM             9,549 module.py
01/02/2022  07:19 PM    <DIR>          overrides
05/06/2020  04:48 PM               727 pygtkcompat.py
01/02/2022  07:19 PM    <DIR>          repository
05/06/2020  04:48 PM            13,543 types.py
12/30/2019  11:13 AM             1,969 _constants.py
11/06/2020  03:06 PM             2,082 _error.py
01/02/2022  12:19 AM           327,168 _gi.cp37-win_amd64.pyd
01/02/2022  12:19 AM            19,456 _gi_cairo.cp37-win_amd64.pyd
03/30/2021  06:42 AM            10,172 _gtktemplate.py
11/06/2020  03:06 PM            13,140 _option.py
05/06/2020  04:48 PM             7,615 _ossighelper.py
05/06/2020  04:48 PM            14,163 _propertyhelper.py
12/30/2019  11:13 AM             9,303 _signalhelper.py
01/02/2022  12:19 AM             6,246 __init__.py
01/02/2022  07:19 PM    <DIR>          __pycache__
              15 File(s)        447,062 bytes
               5 Dir(s)   8,373,551,104 bytes free"
1005907479,331,doadin,2022-01-05T17:04:50Z,"@mhertz we have that same struckture https://github.com/deluge-torrent/deluge/runs/4717092096?check_suite_focus=true#step:7:4767 it is the other folder i'm uncertain about.

https://github.com/deluge-torrent/deluge/runs/4717092096?check_suite_focus=true#step:7:4821 https://github.com/deluge-torrent/deluge/runs/4717092096?check_suite_focus=true#step:7:4821 . shows ""Directory: C:\hostedtoolcache\windows\Python\3.7.9\x64\Lib\site-packages\gi\repository"" with only a pycache dir and a ""__init__.py"" file im fairly sure there is supposed to be more. Again waiting for my VM to finish building to confirm. However if this is the case then we either have to build GTK in the build process or wait for gvsbuild to fix the wheel creation? idk."
1005914978,331,mhertz,2022-01-05T17:13:13Z,"Sorry doadin, I get myself confused, and forgot what yopu said initially about the import failing because missing file of that gdkpixbuff or whatever, doh :) There should only be a __init__.py there.

Edit: ...and pycache, though unimportant."
1005917331,331,doadin,2022-01-05T17:15:52Z,"with a test python script with
`from PyInstaller.utils.hooks.gi import get_gi_libdir
get_gi_libdir('GdkPixbuf', '2.0')
`
we get
`
Traceback (most recent call last):
  File ""C:\test.py"", line 2, in <module>
    get_gi_libdir('GdkPixbuf', '2.0')
  File ""C:\hostedtoolcache\windows\Python\3.7.9\x64\lib\site-packages\PyInstaller\utils\hooks\gi.py"", line 35, in get_gi_libdir
    path = findSystemLibrary(lib.strip())
  File ""C:\hostedtoolcache\windows\Python\3.7.9\x64\lib\site-packages\PyInstaller\depend\bindepend.py"", line 942, in findSystemLibrary
    return getfullnameof(name)
  File ""C:\hostedtoolcache\windows\Python\3.7.9\x64\lib\site-packages\PyInstaller\depend\bindepend.py"", line 71, in getfullnameof
    if os.path.exists(npth) and matchDLLArch(npth):
  File ""C:\hostedtoolcache\windows\Python\3.7.9\x64\lib\site-packages\PyInstaller\depend\bindepend.py"", line 178, in matchDLLArch
    pe = pefile.PE(filename, fast_load=True)
  File ""C:\hostedtoolcache\windows\Python\3.7.9\x64\lib\site-packages\pefile.py"", line 2743, in __init__
    self.__parse__(name, data, fast_load)
  File ""C:\hostedtoolcache\windows\Python\3.7.9\x64\lib\site-packages\pefile.py"", line 2808, in __parse__
    ""Unable to access file '{0}'{1}"".format(fname, exception_msg)
Exception: Unable to access file 'C:\': [Errno 2] No such file or directory: 'C:\\'
`
Which is interesting It seems to just search the dir the script is ran from?"
1005922843,331,mhertz,2022-01-05T17:22:35Z,"Hmm, that dir is not present at all??? I don't get where gets that part from? SOrry over my head, please let me know if can do something to help test in a vm, but else hope you good people can figure it out :)

Edit: Well, besides hacking the hook of pyinstaller to hardcode correct path...

Edit2: Sorry, other places too, as importing gi fails precedingly, and not same hook there presumably. Again, over my head :("
1005928585,331,doadin,2022-01-05T17:29:51Z,"Yea I think this is way over my head looking at https://github.com/pyinstaller/pyinstaller/blob/develop/PyInstaller/depend/bindepend.py#L42 it searches sys.path for dll's to which in our spec file we extend to include the gtk build folder, so how is it not finding them? Again unless its not actually the GTK libs we are missing and it is looking for msvc dll's or something to which again it would be helpful if it told us which dll it is looking for and not finding so we could add that dll's dir to our path.... but that would make this too easy I guess..."
1005932331,331,mhertz,2022-01-05T17:34:49Z,"Yeah indeed puzzling. I have no input, but would personally try without any pathex's, as maybe trips something up, like that pyinstaller thread I posted before about poisening his own environment - in my many testings of this, I needed zero pathex's, but just all in PATHs. I just tested a spec today actually without such, and posted it in my edit to forum-thread.

Hope you succede, or get help from qualified people, thanks again!"
1005932485,331,doadin,2022-01-05T17:35:00Z,"Im starting to actually thinking maybe this is a issue of github actions running some command as cmd and some with powershell and therefore we have different path environment variables? Im not sure thats a thing?
edit apparently the default shell is powershell and we are setting path through powershell way so idk."
1005935166,331,doadin,2022-01-05T17:38:45Z,@mhertz well the test script doesn't use the spec file and also fails so unfortunatly I don't think thats an issue. at least not yet.
1005940163,331,mhertz,2022-01-05T17:46:05Z,"Doh!

Are you setting paths like so: https://stackoverflow.com/questions/60169752/how-to-update-the-path-in-a-github-action-workflow-file-for-a-windows-latest-hos"
1005942064,331,doadin,2022-01-05T17:48:44Z,@mhertz you might be on to somethinig I was setting them using the normal windows method but in the Install dependencies step not the Freeze Deluge step which that post seems to suggest that they don't carry over between runs. Maybe thats it.
1005944857,331,doadin,2022-01-05T17:52:27Z,"@mhertz I think I also kind of just confirmed this in my last test we get

```
  File ""<string>"", line 2, in <module>
  File ""C:\hostedtoolcache\windows\Python\3.7.9\x64\lib\site-packages\gi\__init__.py"", line 47, in <module>
    from . import _gi
ImportError: DLL load failed: The specified module could not be found.
['C:\\', 'C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\python37.zip', 'C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\DLLs', 'C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib', 'C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64', 'C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages']
Traceback (most recent call last):
  File ""C:\hostedtoolcache\windows\Python\3.7.9\x64\lib\site-packages\pefile.py"", line 2795, in __parse__
    fd = open(fname, ""rb"")
FileNotFoundError: [Errno 2] No such file or directory: 'C:\\'
```

which I added print(sys.path) to the test python script and what do you know no gtk folder. I would think that the spec file extending path to include the gtk folder would by pass this but idk."
1005950013,331,mhertz,2022-01-05T17:59:13Z,"Glad you hopefully figured it out, and thanks for conversation - again, if fails still, please let me know if can do something to help test.

Take care. "
1005953430,331,doadin,2022-01-05T18:03:57Z,"@DjLegolas @cas-- @mhertz It seems to be working now, the only issue is the icon file location its not finding but that worst case scenario could be hard coded to the deluge source path. However the gi imports working now. So we have made progress."
1005990595,331,cas--,2022-01-05T18:51:51Z,"@doadin Nice work, much appreciated :tada: "
1005993344,331,doadin,2022-01-05T18:56:07Z,"since this is really close now a few things to note going forward
1. Depends on gtk artifact from appveyor/zip file that has the structure like so:
    gvsbuild-vs16-x64.zip/release/bin
    gvsbuild-vs16-x64.zip/release/lib
    etc etc
2. the pyinstaller spec file is coded to a set deluge.ico path specific to github actions checkout
3. I don't know how to use nsis command line args to make nsis produce different installers for x86 vs x64
    why was this needed? I had two nsis scripts to change the installer file name so we can provide x86 and x64 installers without confusion of which a user downloaded. and it changes the default install location to ""program files"" for x64 or ""program files (x86)"" for x86
4. Currently the gtk build artifacts are built using vs 2019 and python 3.7 so I used python 3.7 in the CD action and the cd action has hard coded locations for python which idk if actions/setup-python@v2 provides a variable to get pythons path so we can use that instead to make the builds less python specific or what?"
1006001076,331,doadin,2022-01-05T19:07:52Z,"@cas-- something I can change now is do we want the CD to run on pull requests so we can verify changes easier? Or just on tags?

Do we want to make github releases?"
1006067051,331,mhertz,2022-01-05T20:50:17Z,"Very quickly while you're messing with it anyway, then as per my last edit on forum-thread, using 'pip install .' like deluge official instructions states, followed by 'python setup.py install_scripts', fixes deluge-console working again(freezed I mean), and is more proper installed anyway, without double deluge package folders(one egg one normal, mixing up). I noticed you don't include hidden_imports for gi and cairo, but I guess you've tested that this isn't needed - was previously, but maybe not now with added spec-additions. Btw, I tested spec also runs fine in packaging/win32 folder(if shipped there in feature), also icons support relative path in spec btw. 

You don't have to answer, I know you're busy, but just so you don't need read through my way to long edits on forum about this :)

Thanks again.

Edit: Yes, hidden_imports for gi/cairo not needed, and sorry realized it was pretty dumb thing to state anyway, after previous long conversation about gi importing issues, doh, but I didn't knew if that option did more than just extra impports, sorry.

Edit2: Last thing, instead of in deluge instructions having user add '--distpath xxxx' additional option to pyinstaller, then can add it to spec, e.g. like I just did in mine, I just set to 'freeze' of cwd(packaging/win) like instructions. I btw changed the analyze code to avoid need import sys when os already imported and does job fine, though not important: https://paste.c-net.org/BeccaCharming (emulate --clean would need delete build folder I guess, I don't really see why, but regardless)

Anyway, disregard and concentrate on the important stuff of-course :)

Edit3: Very last, promise - Just wanted to end with uploading my final spec, where I added the ""--clean"" code, the ""--noconfirm/-y"" code, and ~50MB savings from unneeded icons(gi hook copies all from share), I didn't touch locales as didn't neither in unofficial installer I see. https://paste.c-net.org/MoralsPleasing"
1007058338,331,doadin,2022-01-07T01:07:09Z,@mhertz Adwaita icons are being used.
1007069619,331,mhertz,2022-01-07T01:36:27Z,"Sure doadin, and obviously your call, but I just did this to unofficial installer for 1+ years now, without errors reported, well not my builds atleast. I left the 'scalable' folder there, and index file, which has all the symbolic deluge icons as far as I know, or there would be errors in deluge-debug.exe which I checked. Honestly don't know if this is particular correct, but however does work I know. As said gi hook copies much of share over needlessly, just in case. Thanks for reply, and again, ping me if can help somehow. "
1007104661,331,doadin,2022-01-07T03:07:03Z,"@mhertz Sorry didn't see you left scale and the index, working on nsis atm then I'll test that in a min."
1007348293,331,cas--,2022-01-07T11:51:34Z,"@doadin I would not want this to run on every PR (fine here for testing), tags might be useful (those without `-dev0`), if we also have a manual option to run it that is good. 

Oh the PR runs could be gated as we did for the security tests so would need to include a PR comment value to run it."
1007353845,331,darkred,2022-01-07T12:02:07Z,"/off-topic

Greetings

*Sorry in advance for this off-topic, but I couldn't find any other way to ask your opinion directly.*

I'm so glad for the ongoing development of Deluge, and I've been constantly wondering: why not enabling Issues and Discussions in this repo? And, also why not migrate issue tracker from Trac to GitHub? 
I believe it would help in getting more attention to the project and more people to actively contribute in Deluge's development.
I made this thread in the forum [[Suggestions] Make use of 'GitHub Actions' + Migrate issue tracker from Trac to GitHub](https://forum.deluge-torrent.org/viewtopic.php?f=8&t=55442) 2.5 years ago, but never got a response from a dev. How do you find this idea?

/off-topic"
1007359659,331,doadin,2022-01-07T12:12:09Z,"@cas-- 
> @doadin I would not want this to run on every PR (fine here for testing), tags might be useful (those without `-dev0`), if we also have a manual option to run it that is good.
> 
It should now have this

> Oh the PR runs could be gated as we did for the security tests so would need to include a PR comment value to run it.
>
Not sure about this. Also I don't know how to make the nsis change its providing a def but idk how to process it in the nsis script.

"
1007362687,331,doadin,2022-01-07T12:17:01Z,@cas-- Also is there a version of python we want to target for builds? I currently have a github action for GTK setup to target 3.8 which should be ready to copy over if you want to. And it should be easy to change the deluge CD action as well now. I think you have test run on 3.8? Looks like python supports each new version for +1 year from the last and 3.8 is supported till 2024 so that could be a decent target. I see deluge code was updated to work with 3.10 though so we could go for newer.
1007366997,331,cas--,2022-01-07T12:24:04Z,"@darkred Very offtopic.. I have considered it but also don't want to be at the whim of Github...

@doadin For the windows build I am happy with almost latest Python version e.g. 3.9. We want something that is stable and not outdated as you mentioned. If it's easier to stick with 3.8 then that is perfect with me :+1: Obviously Deluge needs to support much older versions so it's Python 3.6+ now"
1007379350,331,doadin,2022-01-07T12:44:19Z,"@cas-- 3.9 sounds like a good target its not latest but has had a year to get stable and get improvements, and also only a year old so not too dated. I'm starting a gtk build with 3.9 now to test make sure it goes ok, With how its setup now its just change the number in three places for each job in the action file and off it goes. And for the deluge action only in one spot per job."
1007388942,331,doadin,2022-01-07T13:01:26Z,@cas-- As of now as long as the GTK build with python 3.9 goes ok all I need to do is adjust the url of where to get the GTK.zip build from.
1007498572,331,doadin,2022-01-07T15:31:23Z,@cas-- Sorry not sure why https://github.com/deluge-torrent/deluge/commit/23141dff826af7adf409b03bcd842c0f6fe839c1 is'nt showing as the current changes.
1007538687,331,doadin,2022-01-07T16:18:30Z,"> Really nice work on this
> 
> How and where are you currently building the gvsbuild, is there anything custom to it? Have they moved to github actions?

@DjLegolas @cas-- 
They use github actions but don't release builds. I was building on AppVeyor but switched to github actions so really if you fork the repo you can go with either. AppVeyor build process doesn't make github releases only AppVeyor artifacts. The github actions I updated recently so it will make a release on tag, Downloading that release I'm not sure of a better way other than just downloading from a url.

Nothing custom to it really just skip a few thing we don't need to build, could also be more things we don't need to build but that I'm not sure of."
1007603473,331,doadin,2022-01-07T17:45:03Z,"@cas-- The github action I have for GTK currently build on any tag and now has two strategy matrix.
`
          - platform: x64
            vs_ver: 16
            pythonversion: 3.9

          - platform: x86
            vs_ver: 16
            pythonversion: 3.9
`
And the end result is a github release with two zip files in the format:
gvsbuild-pyPYTHONVERSION-vsVS_VER-ARCH.zip

the deluge build will download w.e. url and name the file GTK.zip so only the url has to change there when we want to use a new build(unless we wana rename the zip to something more generic and upload to deluge ftp or something). I also updated the script to scan for GTK python wheels so we no longer have a static pycairo and pygobject wheel which includes version and things now it will just find them and install what/if it finds any in the gtkbuild/python folder."
1007696999,331,doadin,2022-01-07T19:58:48Z,So it appears if you re-run a build the release with delete the old and upload the new so the url doesn't have to change with using github releases for GTK. Alternatively  could use something like https://github.com/dsaltares/fetch-gh-release-asset to just download the latest release.
1007900819,331,DjLegolas,2022-01-08T07:18:05Z,"@doadin @cas-- I think we can build everything for py3.6-3.9 (don't know if py3.10 will work, not to mention 3.11), and libtorrent 1.2 and 2.0.
It all depends on GTK to be built for all of the python versions (and it look like @doadin is already compiling it to 3.7-3.9).
As a result, we will have every supported python version with every supported libtorrent (still a WIP :sweat_smile:)

The difference is only in the `matrix` section in the `cd.yml` file:
```yml
matrix:
    pythonVersion: [3.7, 3.8, 3.9]
    libtorrent: [1.2.15, 2.0.5]
    arch: [x64, x86]
    include:
      - arch: x64
        wheel_arch: amd64
      - arch: x86
        wheel_arch: win32
```
And the GTK zip download link was moved to the `Install Dependencies` section (the only place it is needed) as follows:
```yml
GVSBUILD: ""https://github.com/doadin/gvsbuild/releases/download/1-7-2022-5/gvsbuild-py${{matrix.pythonVersion}}-vs16-${{matrix.arch}}.zip""
```
In addition, need to change the artifact zip file name like so:
```yml
name: my-artifact-py${{matrix.pythonVersion}}-lt${{matrix.libtorrent}}
```
The end result: https://github.com/DjLegolas/deluge/actions/runs/1670792188"
1007953321,331,cas--,2022-01-08T10:46:19Z,"@DjLegolas As a stand-alone install we don't need to build other python versions, we pick one that is stable and is compatible with Deluge dependencies. 

It might be worthwhile having a libtorrent 2.0 for testing but not sure as a wide release :thinking: "
1007965087,331,DjLegolas,2022-01-08T11:31:05Z,"> @DjLegolas As a stand-alone install we don't need to build other python versions, we pick one that is stable and is compatible with Deluge dependencies.
> 
> It might be worthwhile having a libtorrent 2.0 for testing but not sure as a wide release ðŸ¤”

It's a valid point, and it is you decision at the end ðŸ¥‡.
Some think points:

- create a libtorrent2.0 variant which will be always marked as testing release, up until we finish with the fixes for it.
- add the matrix for the CI phase, and test on all supported python versions (>= 3.6), also on LT1.2/2.0.
- @doadin - change your `CD.yml` file for gvsbuild, for better and shorter file, to: 
   ```yml
    matrix:
        pythonversion: [3.7, 3.8, 3.9]
        vs_ver: 16
        platform: [x64, x86]
        include:
          - platform: x64
            arch: x64
          - platform: x86
            arch: win32
   ```"
1008198514,331,doadin,2022-01-09T00:38:18Z,"@cas-- @DjLegolas 
The build process seems to work with anything python 3.7-3.9, except for with 3.7 & 3.9 the end exe's give this issue:
`
Traceback (most recent call last):
  File ""deluge-script.pyw"", line 33, in <module>
  File ""deluge-script.pyw"", line 22, in importlib_load_entry_point
  File ""importlib\metadata.py"", line 524, in distribution
  File ""importlib\metadata.py"", line 187, in from_name
importlib.metadata.PackageNotFoundError: deluge
`
From what I read this was due to a change early on in 3.9 which now seems maybe backported to 3.8.(googleing gives a lot of results from people saying 3.9 issue, went to 3.8 and its fine) I changed the build back to 3.7, after trying 3.8 and 3.9, and its working fine."
1008203779,331,doadin,2022-01-09T01:01:22Z,"@mhertz I am getting https://github.com/deluge-torrent/deluge/runs/4750750505?check_suite_focus=true#step:7:326 when adding datas += [ ('deluge', 'deluge-2.0.5-py3.7.egg/deluge') ]"
1008206983,331,mhertz,2022-01-09T01:24:21Z,"Yeah, sorry, that was from pretty old edit, and at the time I didn't really know it was supposed to build from packages/win, and so just changed to build from deluge-source dir, as you did at time, instead of my previous testing direct from Scripts dir.

Anyway, that's old as said, and I posted better solution later, so unneeded. Also as said, for fixing deluge-console, and to follow general best practise guide-lines, imho consider installing through 'pip install .' or alternatively, if must use setup.py, then I checked works through adding install command '--old-and-unmanageable', or alternatively what pip does, and use '--single-version-externally-managed --record record.txt' to setup.py.

Last, the excludes you added won't work, and will need e.g what I did I.e folders not supported there. Took me a bunch of tests to get working, though never claimed being the brightest neither :)

Edit: Sorry for being vague, I meant this won't work: 'excludes=excludes,' - the excludes list itself is fine, but needs used in other way, e.g like the for loop and list comprehension or whatever called. "
1008208822,331,doadin,2022-01-09T01:38:24Z,@mhertz Thanks!
1008211896,331,doadin,2022-01-09T01:59:51Z,"@DjLegolas Sorry if you saw my comment about gtk build I figured it out, so nvm. :)"
1008216090,331,mhertz,2022-01-09T02:33:03Z,"doadin, i'm going to bed now, pretty late/early here in my side of the woods, but just wanted to say that in my spec/setup I have crypto dlls auto-picked up and used e.g. added a https tracker manually and checked ""announce OK"", which won't happen without. Just noticed you messed with the pathex/datas additions. Again, amazing work all around!"
1008222380,331,doadin,2022-01-09T03:33:48Z,@mhertz Unfortunately in github action environ its not picking up the x64 dll for openssl even though its in the os PATH environment variable. 
1008293597,331,mhertz,2022-01-09T13:01:34Z,"doadin, quick note just, hope okay. I wanted to look into the stuff you mentioned regarding newer python's making issues, so just started doing little testings. I always thought probably being issues when going to py3.8 and above(but wanted wait to if you maybe asked for help regarding it), tbecause in unofficial installer I had to specifically code into __init__.py os.add_dll_directory(dir),well used *.pth initially but regardless, because of changes in how python worked in those versions, to avoid dll mismatch I also was plauged with initially with bug-reports by forum-users before py3.8. I wasen't sure if would work anyway for you, without mods, because the gvsbuild devs included os.add_dll_directory into __init__.py's of pycairo and pygobject after I raised that there where newly introduced issues, and one of the devs explained me the pitfall, and made/comitted fix still there i.e. checks PATH for needed gtk dll's and add the dirs found into os.add_dll_directory. There can still then be mismatches, because some have dirs in PATH from other apps, with said dll's, or in system32 with incompatible versions, completelly breaking deluge(system32 takes precedense always, before this os.add_dll_directory change introduced, saving me from lotta trouble at the time), so I in my scripts/builds(unofficial installer) patch that out of __init__.py of pycairo/pygobject and in deluge's __init__.py I hardcode the bin dir of gtk , which I included in app dir, as only call to os.add_dll_directory happening, as if keeping the pycairo/pygobject's __init__.py's and add mine infront or some other place, then the docs state it cannot promise load order of multiple os_add_dll_directories, hence I did it that way just in case. Anyway, I suspect you need openssl location in os_add_dll_dir, but if having it next to the libtorrent.pyd under site-packages, then works regardless, so I just had my scripts(unofficial installer) copy the two built openssl dlls to there, but could also be copied to gtk bin dir as included in os.add_dll_dir if not patching out the mods by pycairo/gobject, or if override and doing it yourself like I did. Forgive me for having a problem explaining stuff shortly :) So, initially deluge couldn't import libtorrent, even unfreezed with python 3.9.9, but after copying dll's in place next to libtorrent.pyd, works, and gets picked up through freeze because is next to the libtorrent pyd, most likely would also have worked if copied to gtk bin dir, but whatever.

I'm thinking this possibly is your github-actions openssl freezing issue also, because maybe messed with newer python's when happened, Sorry if wrong, but regardless, wanted to say that works for me atleast with my first test of py3.9.9, just waiting for freeze to finish(so PATH for openssl not enough for even unfreezed, is my point, on py3.8 and up - also with deluged not even loading the __init__.py's of pycairo/pygobject as not gtk app).

Okay finished freezing, and fails loading deluge because error stated in gi's __init__.py as paramter incorrect for add_dll_directory it states - as said it by default enumerates PATH for cairo/gi libs(cairo.dll) and adds those found to os.add_dll_directory, which on clean system is bin dir of gtk, but that is failing now - maybe pyinstaller sets up a fake environment, where such isn't allowed i.e. parsing through PATH, or using other dll's outside freezed dir, and regardless shouldn't work like that freezed obviously anyway. Regardless might work if patching that out and using e.g. my deluge __init__.py, or some other trick, but i'll check it out and post back when progress. This must also have been brought up with pyinstaller in general before i'm sure, but didn't look it up yet. Sorry again for wordyness. Last, why it's not breaking before(under py3.8) with wrong parameter error, is that it check if os.add_dll_dir attribute available, and if not skips, in __init__.py of pycairo/pygobject, so first time using that section from there now, as upped python version, so attribute available.

I'll make some testing and will make edits when hopefully finding something that works, and try to keep short, unless you beat me to it with solution of-course - and sorry haven't looked at your latest commits, so hope you haven't already fixed, and i'm speaking redundantly here. Thank you.

Edit: Okay some progress atleast - my first handfull tests failed for some reason, but for now atleast, then I just kept the default pycairo/pygobject __init__.py contents under site-packages gi/cairo of unfreezed deluge-install, and added two lines to each of them, I found by googling it, by one of the gvsbuild devs on pyinstaller bug-tracker, not the one I talked too initially which added the patching, but anyway, and he had issues with a frozen gtk app, because of the gi __init__.py gvsbuild patches, and he posted a few lines as workaround in end, which worked and I used here. In short there's added ';' after your PATH, can only be seen in cmd(echo %PATH%, and not in advanced system settings/env-vars), and this makes the PATH parsing trip up(in pygobject/pycairo), so the added code removes that semicolon at end, if there, and so I now finished a py3.9.9 freezed build semingly working, only checked deluge.exe but still, without errors shown. If finding more later, when time, i'll add. I don't like the PATH parsing still, as point of breakage, though i'm not sure how much pyinstaller bootloader/strapper allows interference from outside regardless, or if maybe first the freezed dir takes precedense anyway, so no concern - I did rename the gtk and openssl dirs on system, so wasen't working from PATH anymore, and then still worked, so not sure that even is used, and anyways as said, freezed dir probably takes precedense anyways, so maybe OK in end here.

I added:

if os.environ['PATH'][-1] == ';':
    os.environ['PATH'] = os.environ['PATH'][:-1]

Just over 'added_dirs []' in both __init.py's of pycairo/pygobject, as only change, and had installed deluge through 'pip install .' and 'python setup.py install_scripts', before 'pyinstaller deluge.spec', with my spec, and openssl's there also..

Edit2: I reported it to gvsbuild here: https://github.com/wingtk/gvsbuild/issues/475 - didn't make PR as maybe they want to do it differently, I dunno. I'll do some tests later when have time, to see if the current pygobject/pycairo contents(the old one) is a point of failure in freezed app i.e. I add non-compatible cairo.dll or whatever else referenced into system32 or alike, and see if used and breaks or not, and if not, then can just use as is, and apply patch untill upstream fixes it I think. Your choise of-course. I haven't tested all exe's yet, so do that also, later when have time, and then will report back, for last time in this :)"
1008305875,331,cas--,2022-01-09T14:15:01Z,"I just created a Deluge repo for storing the builds: https://github.com/deluge-torrent/gvsbuild-release/releases

It's just run manually for now for a single Python version but if you are having issues can extend it to build other Python versions..."
1008316345,331,doadin,2022-01-09T15:15:15Z,"@cas-- Yes I still have not had the time to figure out the issue with newer python versions so would be nice to at least extend that to include python 3.7 so we can get builds out sooner rather than later? It's been a long time since we have seen a new windows build.

I also updated to address all but 2 of your comments, if I missed any let me know, and let me know what you thing about those two. "
1008328612,331,doadin,2022-01-09T16:16:29Z,"3.8+ gives:

`
Traceback (most recent call last):
  File ""deluge-gtk-script.pyw"", line 33, in <module>
  File ""deluge-gtk-script.pyw"", line 22, in importlib_load_entry_point
  File ""importlib\metadata.py"", line 524, in distribution
  File ""importlib\metadata.py"", line 187, in from_name
importlib.metadata.PackageNotFoundError: deluge
`
Which from some googleing suggests using pyinstaller copy_metadata would fix but unfortunatly does not."
1008336269,331,mhertz,2022-01-09T17:01:30Z,"doadin, it doesn't here, so either is a gtk-actions issue, or which I much expect, that you don't install deluge like me. Honestly don't understand why you insist on installing through setup.py and not through pip, or add flags to setup.py that don't need you to delete requirements.txt as workaround for it installs as an incomplete egg which needs extra files imported which results in two deluge packages confusing everything etc, not to mention breaking deluge-console, not the most important on windows i'd speculate, but nonetheess.

Your call of-course, and i'll go ahead and make the PR gvsbuild asked me to, upstream, in mean time.

Edit: I mean freezes incomplete, not installs - sorry bad wording.

Edit2: I could reproduce your error when installing deluge from straight 'python setup.py install' and freezing(and I remembered to rename/delete requires.txt also."
1008342279,331,mhertz,2022-01-09T17:38:56Z,"Thanks for reply, and I sincerly apologize my ton in last post, didn't mean it in any way negative honestly, and for the record am not in doubt about you being much ahead of me regarding development, to say in the slightest :) I have only tested stable deluge, and will make edits if finding something, to use for you or not of-course at your discretion - thank you :)"
1008342651,331,doadin,2022-01-09T17:41:21Z,@mhertz Ill be the first to admit I don't know very much I am just trying to help the community.
1008343868,331,doadin,2022-01-09T17:48:31Z,"@cas-- In addition to the changes I mention earlier from your review, I have added changes @mhertz has provided and we can use python 3.8+ now. Also the build process is cleaner and simpler. The only adjustment left is the spec file libssl-x64 include. Which I'm not sure why exactly it is needed. github actions has the x64 lib in its $env:Path so why pyinstaller is only getting the 32-bit bin and not the x64 I'm not sure, maybe pyinstaller searches system32 first and it finds a libssl and uses that and moves on? I'm not sure."
1008344019,331,doadin,2022-01-09T17:49:38Z,@mhertz the only change I have not pulled in is for removeing the share folders and honestly I an not sure what you have it doing and why it needs to run on every script.
1008345160,331,mhertz,2022-01-09T17:55:59Z,"Indeed, bothered me too :) Of-course your call. As said, I think ran 50 runs to even get that working, though probably an issue with me more than anything else. But it doesn't help filtering a.datas, when we have b-h.datas with those icons anyway, getting merged at end - maybe could do something with toc(), but I just got tired of it when having found something working. It goes through all collected files for each step, x.datas, and ""rewrites"" it through checking if matches with the excludes filter, and if not, then adds, and if matches, then strips/avoids - reverse filtering of sorts. No biggie of course, and i'm sure could be done better, e.g. the straight datas, like on top, but couldn't make work. Also, maybe Cas/you think it's too agressive I dunno, only found it worked as far as could see myself, and has svg decoder in gdkpixbuff loader through librsvg so why include all the pngs additionally, but what do I know.

Thanks :)

Edit: Just read your previous link - I had only read github homepage, with the pip direction, sorry.

Edit: Well, probably could avoid the for-loop on the scripts not using gtk atleast, as guess no icons collected, but just didn't bother at that point.

Edit: I had openssl dll's as said in lib\site-packages, next to libtorrent.pyd, copied there by old habit, and so got picked up for me in freeze, but if not having that, then as not in gtk3 dir which gets added to os.add_dll_directory from pygobject/pycairo, then cannot find, as PATH irrelevant on py3.8=+ so instead of copy over like I do, then could add such os.xxxx call to spec, but you have added something yourself fixing it you said, I honestly haven't looked at your spec yet, but no need then, as you found solution, good job.

Edit: As said, I haden't yet tested all exe's, though most i.e. deluge, deluge-debug, deluge-gtk, deluged and webui. Now I see deluge-console don't work, but i'm guessing it's not that hard fix, but well see. It's missing curses it states, which didn't on <py3.8, so maybe have add a line or to to spec, but i'll test and post if find something. "
1008351654,331,doadin,2022-01-09T18:38:48Z,"@mhertz well now im seeing:
deluge-debug.exe:
`
PS E:\Program Files\Deluge> .\deluge-debug
Traceback (most recent call last):
  File ""deluge-debug-script.py"", line 33, in <module>
  File ""deluge\ui\ui_entry.py"", line 39, in start_ui
    ui_entrypoints[entrypoint.name] = entrypoint.load()
  File ""pkg_resources\__init__.py"", line 2449, in load
  File ""pkg_resources\__init__.py"", line 2472, in require
  File ""pkg_resources\__init__.py"", line 772, in resolve
pkg_resources.DistributionNotFound: The 'mako' distribution was not found and is required by the application
[44432] Failed to execute script 'deluge-debug-script' due to unhandled exception!
`
deluge.exe:
`
Traceback (most recent call last):
  File ""deluge-script.pyw"", line 33, in <module>
  File ""deluge\ui\ui_entry.py"", line 39, in start_ui
    ui_entrypoints[entrypoint.name] = entrypoint.load()
  File ""pkg_resources\__init__.py"", line 2449, in load
  File ""pkg_resources\__init__.py"", line 2472, in require
  File ""pkg_resources\__init__.py"", line 772, in resolve
pkg_resources.DistributionNotFound: The 'certifi; sys_platform == ""
`

All the other exes work.

Maybe I missed something.

Edit: Also using ""working"" there isn't exactly true deluge-console loads but freezes and becomes unusable.

leave https://github.com/deluge-torrent/deluge/commit/d0cf01ed573b0e92e532d0b500b2c89bcdd3a3a8 here as last working build so I can keep track."
1008353776,331,mhertz,2022-01-09T18:51:56Z,"doadin, i'm sorry, when I said ""working"" I meant in the previous py-versions - I did say that I haden't tested all exe's yet in py3.8=+, but sorry if formulated badly - probably - sorry.
.
There are some strange issues - first deluge-console seemingly works if after installing deluge unfreezed, then also installing windows-curses - that didn't need happen on <py3.8. Then when that is installed, then works, I think, need test more, but shows some initial error about libintl and referenced before assignment, also deluge-debug states such - though seemingly works - I just think need intl dll and whatnot other dll in main dir, that I used to copy there with unofficial installer, but will take a look.

Last, atleast unfreezed, then now have deluged showing window open all time, like the debug.exe should - I remember having this issue along time ago, and got patches by tobbez fixing this, so maybe needed here again, I dunno - hmm, no I didn't use such in last unofficial build - now i'm getting confused, will write back later, and sorry if making issues for you doadin, didn't mean to.

Edit: The issue with window staying open, is a bug in deluge I believe, and need fixed, I have the patch-""method"" by tobbez, I didn't see it because use alternative exe loader and not stock, and edits shebang to pyw version, so think that will need changed, and should be reported, just hate making PRs as no programmer, just slight tinker, and no issues section on deluge well bug-tracker on trac. Anyway, i'll test some more, and sorry again, I didn't remember these issues.

Edit: I'm sure you know, but deluge-console only work non-interactive on windows, or atleast used too - so I always tested cli args."
1008357929,331,cas--,2022-01-09T19:17:47Z,"I'm sorry I'm finding it very hard to keep track of these conversations so helping out is tricky. 

Can we try and keep a track of exactly what is working and what is not and be very specific about each issue and what the potential fixes are. Also when making commit updates it would be useful to actually see what and why changes are being made rather than rebase to single commit. It might also be useful for workarounds in the code to have terse comments about what is being fixed.

@doadin would you mind updating the list of tasks remaining in the PR description and tick them off as done. We can then decide if they are a priority or not. 

We want a minimum viable stable installer for Windows therefore don't need to chase latest versions:

* If there are too many issues with Python 3.9 then don't work on it, use Python 3.7. 
* We only need to verify that the `x86` installer works since it's compatible with `x64` thus concentrate on that. 
* I would also prefer if we used libtorrent 1.2 rather than 2.0 again for stability
* I don't think reducing the installer size is a priority and can come later

@mhertz Please provide a bit more information on error and fixes by providing traces, code snippets and links to files. 

Avoid sharing links to issues that are not github.com since those are sham sites making money via ad revenue e.g. giters.com and also the linking between github issues fails. 

The deluge-console should work on Windows using windows-curses now"
1008360760,331,doadin,2022-01-09T19:37:48Z,"@cas--  I'm just going to do one last rebase to go back to what we had/what you reviewed if we find a way to improve on that, that doesn't break things then we can go from there. This new way broke two things in an attempt to just use a newer python version. Just going to scrap that and go with 3.7."
1008361614,331,doadin,2022-01-09T19:44:28Z,@cas-- ok from here everything is how you last reviewed. With the changes you requested.
1008361765,331,mhertz,2022-01-09T19:45:33Z,"I apologize Cas.

Py3.9.9 with my spec and install, has no issues in freezed version as far as I see now.

In unfreezed is having issue of reporting intl dl translation issuel, but works, though as kinda off-topic here I guess, when not in freezed, then I didn't post output, can on request.

Only thing is that the freezed deluged works because I defined console=false in spec - bit it ends in py, not pyw, so default windows exe loader/wrapper loads through python.exe not pythonw.exe making cmd window open in unfreezed- again I guess of-topic as not in freezed.

All 8 exe's tested working.

Deluge-console only works non-interactive, for me, in all my tests, both here and in unofficial, and in ""real install"".

Spec used: https://paste.c-net.org/BethesdaTermite

I add unfreezed errors just in case, but again, no issue in freezed version.

````
Unable to initialize gettext/locale!
local variable 'libintl' referenced before assignment
Traceback (most recent call last):
  File ""C:\Python\lib\site-packages\deluge\i18n\util.py"", line 143, in setup_translation
    libintl = load_libintl(['libintl-8.dll', 'intl.dll'])
  File ""C:\Python\lib\site-packages\deluge\i18n\util.py"", line 132, in load_libintl
    if not libintl:
UnboundLocalError: local variable 'libintl' referenced before assignment
20:32:41 [ERROR   ][deluge.i18n.util  :155 ] Unable to initialize gettext/locale!
20:32:41 [ERROR   ][deluge.i18n.util  :156 ] local variable 'libintl' referenced before assignment
Traceback (most recent call last):
  File ""C:\Python\lib\site-packages\deluge\i18n\util.py"", line 143, in setup_translation
    libintl = load_libintl(['libintl-8.dll', 'intl.dll'])
  File ""C:\Python\lib\site-packages\deluge\i18n\util.py"", line 132, in load_libintl
    if not libintl:
UnboundLocalError: local variable 'libintl' referenced before assignment
````
````
C:\Users\fooba>deluge-console info
Unable to initialize gettext/locale!
local variable 'libintl' referenced before assignment
Traceback (most recent call last):
  File ""C:\Python\lib\site-packages\deluge\i18n\util.py"", line 143, in setup_translation
    libintl = load_libintl(['libintl-8.dll', 'intl.dll'])
  File ""C:\Python\lib\site-packages\deluge\i18n\util.py"", line 132, in load_libintl
    if not libintl:
UnboundLocalError: local variable 'libintl' referenced before assignment
20:34:34 [ERROR   ][deluge.i18n.util                                      :155 ] Unable to initialize gettext/locale!
20:34:34 [ERROR   ][deluge.i18n.util                                      :156 ] local variable 'libintl' referenced before assignment
Traceback (most recent call last):
  File ""C:\Python\lib\site-packages\deluge\i18n\util.py"", line 143, in setup_translation
    libintl = load_libintl(['libintl-8.dll', 'intl.dll'])
  File ""C:\Python\lib\site-packages\deluge\i18n\util.py"", line 132, in load_libintl
    if not libintl:
UnboundLocalError: local variable 'libintl' referenced before assignment
[S]   100% archlinux-2022.01.01-x86_64.iso e368633c136582fc3eab4a77b1c75c36151a8eef
    DL: 899.2 M (0 B) UL: 17.9 M (0 B) ETA: -


C:\Users\fooba>
````"
1008361953,331,mhertz,2022-01-09T19:46:40Z,"I'm sorry, didn't see doadin/your reply, sorry guys, i'll but out and stop derailing, and only comment upon request. Thanks and sorry."
1008362901,331,doadin,2022-01-09T19:53:46Z,"@mhertz 
I don't think anyone really minds help but I had a build that worked only thing not tested was deluge-console which didn't work in deluge 1.3.x anyways so imo not a huge lose(hard to lose something you didn't really have as far as most users are concerned). The only thing really needed is deleting the requires.txt not really a big deal imo. Nothing done here has to hack/slash gtk or exe loaders or anything.

@cas-- 
Updated to use libtorrent 1.2.15
"
1008363687,331,doadin,2022-01-09T19:58:56Z,"I think the only reason why the openssl dll addition is needed in spec is because of the mass amounts of programs in Path that have a version of those dll's. So we can leave it as is, or I can reduce the Path env in script to only include dirs we need. Either way I think a change is needed and the one we have isn't that bad. Not my call though I'll do what ever.

Edit: imo trying to edit the Path env could be more trouble then its worth."
1008517170,331,doadin,2022-01-10T03:32:31Z,"@cas--  @mhertz Something I have found out. Which I updated the tasks.
3.9(maybe 3.8 as well?) Delete Deluge\deluge-2.1.0.dev15.dist-info\METADATA: Requires-Dist lines to work
3.7 Delete Deluge\deluge-2.1.0.dev15.egg\requires.txt to work."
1008526430,331,mhertz,2022-01-10T04:06:54Z,"Good job finding what works for you :)

The errors I posted in unfreezed was fixed in freezed because intl.dll was in the gtk-dir added through os.add_dll_directory() and gets included in freezed main-dir. 

Btw, in your gvsbuild-scripts, could use something like:
````
curl https://gitlab.gnome.org/GNOME/pygobject/-/commit/5535efb58a67a4782c17707fea8c7a8f1dfb2900.patch > gvsbuild\patches\pygobject\pygobject_py3_8_load_dll.patch
curl https://github.com/pygobject/pycairo/commit/69850152b5fb4fd7cfdf08a009fa6aa327911f5b.patch > gvsbuild\patches\pycairo\pycairo_py3_8_load_dll.patch
````
Untill added in gvsbuild or upstream. Powershell translated.

Thanks."
1008531262,331,doadin,2022-01-10T04:17:33Z,"@mhertz I havn't had any issues with the build scripts, however if we wanted we could use that first patch idea applied to the .spec file to add the openssl-x64 dll's to build and remove the 32-bit ones maybe. And that could maybe be a less peticular system dependent change unlike my check for if running on github actions."
1008534575,331,mhertz,2022-01-10T04:24:35Z,"Yes, try that - I thought I would need an os.add_dll_directory addition in spec for including openssl, but didn't need it for some reason.

I don't understand why you don't need patch the pycairo/pygobject, as is the thing that breaks deluge on py3.8+, unless you have no semicolon in PATH ending(echo %PATH%) - and from the error you posted yesterday, I believe you have. 

Regardless whatever you can make it work with :)

"
1008535804,331,doadin,2022-01-10T04:26:55Z,@mhertz I think you hit the nail on the head there I think its a OS Path setup issue not a gtk issue.
1008539434,331,mhertz,2022-01-10T04:37:09Z,"I have also openssl dlls without 64 in name in my freezed dir, didn't think you where talking about that. This means that pyopenssl from python got seen and imported with deps, and not the x64 we build ourself only for libtorrent's usage - we need both, or else e.g. yarss will break.

Edits: Good idea about that trick could be used, sorry for being dense.

* Bundles the extra missing vcredist file during freezing i.e. msvcp140.dll, so runtimes should be okay/ticked-off.

* For me, the specifically thing solelly that controls if x64 dll's pulled in, is:
````
tmp_ret = collect_all('deluge')
datas += tmp_ret[0]; binaries += tmp_ret[1]; hiddenimports += tmp_ret[2]
````
Short spec example, just to see dll's(for me): https://paste.c-net.org/TootsCovet

(Deleted too much talking before...)

* I think you use that already above, but also I use homemade openssl x64, but if you use premades, then maybe those you use are not linked to/importable - e.g. built different like with/without asm or something? Dunno... Can check with premades later when time e.g. shinning.

* Yes, I can reproduce your issue, from installing openssl-x64 from shinning, and selecting yes to the default install prompt of copying the x64 dlls to system32. Then fails pull in x64 dlls from spec. When manually deleting the two x64 dll's from system32, then works again, despite there also being x32 versions there still, which I didn't delete. If not deleting them(x64), then even breaks my own home-built openssl from pulling in. Light shinning package(as used in github-actions VM's) or full, doesn't make a difference. As is temporary VM(github actions), then just delete the system32 x64 files before firering up pyinstaller in your setup, i'm thinking."
1009597871,331,doadin,2022-01-11T04:52:37Z,@cas-- The opensll dll's it is picking up is in fact a x64 bin it is just not named as such. How we want to deal with this im not sure. However if we just name them as libtorrent expects we don't need that line in spec file.
1009611929,331,doadin,2022-01-11T05:26:56Z,From my testing I believe pyinstaller is picking up the dll from C:\hostedtoolcache\windows\Python\3.7.9\x64\DLLs which despite being x64 does not include that in the name. From testing I see that in that folder for x86 and x64 the name remains the same simply libssl-1_1.dll. It also appears openssl 1.1 is used from python 2.7-3.9 newer versions may use a different openssl version I'm not sure.
1009655516,331,doadin,2022-01-11T07:07:16Z,Using a dependency walker it shows only x64 dll needed yet if lib(ssl/crypto)-1_1.dll is removed it fails to import libtorrent. This must be a pyinstaller issue I guess?
1009782011,331,cas--,2022-01-11T10:00:23Z,"@doadin Thanks for looking into this, I like that fix. We should let libtorrent know about this too but might be tricky to resolve without breaking it for someone...

> It also appears openssl 1.1 is used from python 2.7-3.9 newer versions may use a different openssl version I'm not sure.

As long as we document it, we can revisit the issue"
1009785135,331,doadin,2022-01-11T10:04:10Z,"@cas-- yea a dependency walker shows the libtorrent.pyd as only needing the x64 so it might actually be a pyinstaller hook maybe? I'm not sure.

Edit: what I think is the build process is picking up a 64bit dll on its own.  And I'm guessing whatever process makes the libtorrent wheel links against an x64 named one and if it didn't we would likely be fine."
1009917154,331,doadin,2022-01-11T12:27:25Z,"If we change:
cd.yml:
    - Under Install Deluge:
          change the two lines to:
          pip install .
          python setup.py install_scripts
      - Under Freeze Deluge:
         remove Get-ChildItem $env:GITHUB_WORKSPACE\packaging\win\freeze\* -Include requires.txt -Recurse | Remove-Item
delugewin.spec:
change lines 20 to:
datas += [ ('../../deluge/ui', 'deluge/ui'),
           ('../../deluge/plugins', 'deluge/plugins') ]

Edit: long story short python 3.7 and 3.9 both need METADATA file edited and both have issue running deluge-console. Removing METADATA will not work it needs to be edited, this makes the process a little more complicated but 100% doable if we want. Also just figuring out why this is would obviously be very helpful.

This is what we get:

Python 3.9:
deluge.exe & Deluge-debug.exe:

```
Traceback (most recent call last):
  File ""deluge-script.pyw"", line 33, in <module>
  File ""deluge\ui\ui_entry.py"", line 39, in start_ui
    ui_entrypoints[entrypoint.name] = entrypoint.load()
  File ""pkg_resources\__init__.py"", line 2449, in load
  File ""pkg_resources\__init__.py"", line 2472, in require
  File ""pkg_resources\__init__.py"", line 772, in resolve
pkg_resources.DistributionNotFound: The 'pyopenssl' distribution was not found and is required by the application
```

Unless you remove dist lines from deluge-(build version number).dist-info METADATA
If you remove just pyopenssl it will just fail stating another was not found
All Other exe's are fine as far as starting.

deluge-console:
Starts but seems to freeze with this error seen:

```
--- <exception caught here> ---
  File ""twisted\internet\base.py"", line 1331, in mainLoop
  File ""twisted\internet\selectreactor.py"", line 101, in doSelect
  File ""twisted\internet\selectreactor.py"", line 39, in win32select
builtins.OSError: [WinError 10038] An operation was attempted on something that is not a socket
Unhandled Error
Traceback (most recent call last):
  File ""deluge\ui\console\main.py"", line 161, in start_ui
    wrapper(self.run)
  File ""curses\__init__.py"", line 94, in wrapper

  File ""deluge\ui\console\main.py"", line 282, in run
    reactor.run()
  File ""twisted\internet\base.py"", line 1318, in run
--- <exception caught here> ---
  File ""twisted\internet\base.py"", line 1331, in mainLoop
  File ""twisted\internet\selectreactor.py"", line 101, in doSelect
  File ""twisted\internet\selectreactor.py"", line 39, in win32select
builtins.OSError: [WinError 10038] An operation was attempted on something that is not a socket
```

Python 3.7:
All exe's fail with:

```
Traceback (most recent call last):
  File ""deluged-script.py"", line 11, in <module>
  File ""pkg_resources\__init__.py"", line 490, in load_entry_point
  File ""pkg_resources\__init__.py"", line 2862, in load_entry_point
  File ""pkg_resources\__init__.py"", line 2461, in load
  File ""pkg_resources\__init__.py"", line 2484, in require
  File ""pkg_resources\__init__.py"", line 787, in resolve
pkg_resources.DistributionNotFound: The 'zope.interface' distribution was not found and is required by the application
```
Unless you remove dist lines from deluge-(build version number).dist-info METADATA
If you remove just pyopenssl it will just fail stating another was not found

deluge-console:
Starts but seems to freeze with this error seen:

```
--- <exception caught here> ---
  File ""twisted\internet\base.py"", line 1331, in mainLoop
  File ""twisted\internet\selectreactor.py"", line 101, in doSelect
  File ""twisted\internet\selectreactor.py"", line 39, in win32select
builtins.OSError: [WinError 10038] An operation was attempted on something that is not a socket
Unhandled Error
Traceback (most recent call last):
  File ""deluge\ui\console\main.py"", line 161, in start_ui
    wrapper(self.run)
  File ""curses\__init__.py"", line 94, in wrapper

  File ""deluge\ui\console\main.py"", line 282, in run
    reactor.run()
  File ""twisted\internet\base.py"", line 1318, in run
--- <exception caught here> ---
  File ""twisted\internet\base.py"", line 1331, in mainLoop
  File ""twisted\internet\selectreactor.py"", line 101, in doSelect
  File ""twisted\internet\selectreactor.py"", line 39, in win32select
builtins.OSError: [WinError 10038] An operation was attempted on something that is not a socket
```"
1009920801,331,doadin,2022-01-11T12:32:21Z,"I know that was really long but we can get a wider compatibility with those changes + what we have now. I think some of the other issues where due to going back and forth with pyinstaller changes. I really should keep the changes simpler and test more. I should not have rushed this. Sorry.

If the above is hard to follow the changes can be seen here:
7603605c5b0ed3d87381e668df3b782598477bed"
1010123805,331,doadin,2022-01-11T16:15:47Z,"Still running tests to double check my work but I think 1066eb69340bc386a57950a502585245d2267ac2 is a solution to getting 3.8 and 3.9 builds. I don't have gtk 3.8 builds to test but I've been testing with 3.7 and 3.9.

Edit: ok I am confiming I have tested a few times 1066eb69340bc386a57950a502585245d2267ac2 combined with what we have makes working builds, with just that deluge-console bug remaining."
1010176805,331,doadin,2022-01-11T17:08:28Z,updated first post/task list with more info.
1010958373,331,mhertz,2022-01-12T11:45:52Z,"Forgive me for speaking uninvited, but really hard continuing holding in helpful info honestly. I'll be short/consize from now on(if invited), promize.

* Metadata needs patched only because missing metadata, both in ""requires.txt"" issue of py3.7, and ""metadata"" of py3.8+, and avoided entirely by in spec adding said metadata back through:
````
datas += copy_metadata('deluge', recursive=True)
````
* I made PRs at gvsbuild + upstream, but untill merged, then can add yourself, if deemed neccesary. It breaks deluge starting if in same dir as deluge and having trailing semicolon in PATH(only seen from 'echo %path%'), as some installers add - test e.g. from freezed dir:
````
set path=%path%;
deluge
````
https://github.com/wingtk/gvsbuild/issues/475
* deluge-console works only non-interactive on windows, just like deluge 1.3.x, sorry if thinking I ment all worked(though Cas says it should now though).
*  Unimportant, but the openssl without x64 comes from python itself/pyopenssl(and needed for yarss2 etc to resolve https), and the x64 named is for libtorrent, so no pyinstaller/libtorrent issue(should report to python to fix there unusual naming). Good job fixing by copying over! As said, deleting the x64 from system32(or whereever interferring at your end), plus full collect_all line in spec, also fixing this, but better way from doadin imho.
* If ever finding more files missing/issues, then use the collect_all for deluge line from docs I always did, though currently doadin's way is better, as saves 1mb install size.

Hope OK, but will stop post uninvited again now. Thanks doadin, awesome job as usual! :)"
1010973810,331,doadin,2022-01-12T12:01:07Z,"@mhertz Thanks, I will test this. I have been trying to get on irc more, if you would like we could work on this more there. Though honestly seems pretty close to a good change imo."
1010977740,331,mhertz,2022-01-12T12:05:55Z,"Thanks alot doadin, appreciate your post alot! I don't really have more to add honestly, never used IRC honeslty neither, so please just ping me if you think I might now/test something, or feel free to always email me, or deluge-forum PM. I'll let you finish your awesome job in peace. Take care :)"
1011178729,331,doadin,2022-01-12T15:44:25Z,"I tested 8 builds python 3.7-3.10 both x86 and x64 and found only the same issue which exists with old and new method.
Plugins Execute & Extractor:
```
09:58:44.350 [ERROR   ][deluge.pluginmanagerbase          :78  ] Unable to instantiate plugin 'Execute' from 'e:\\program files\\deluge\\deluge\\plugins\\execute-1.3-py3.10.egg'!
09:58:44.350 [ERROR   ][deluge.pluginmanagerbase          :78  ] No module named 'twisted.internet.utils'
Traceback (most recent call last):
  File ""deluge\pluginmanagerbase.py"", line 147, in enable_plugin
  File ""e:\program files\deluge\deluge\plugins\execute\deluge_execute\__init__.py"", line 14, in __init__
    from .core import Core as _pluginCls
  File ""e:\program files\deluge\deluge\plugins\execute\deluge_execute\core.py"", line 14, in <module>
    from twisted.internet.utils import getProcessOutputAndValue
ModuleNotFoundError: No module named 'twisted.internet.utils'
```

All other plugins start fine.(including one external, didn't not test more than that)

Stats plugin causes:
`
(deluge:18800): GLib-GIO-WARNING **: 10:51:08.582: win32 session dbus binary not found: E:\Program Files\Deluge\\gdbus.exe
`
to print in console but seems to work.

Enableing or disabling plugins cause:
`
Traceback (most recent call last):
  File ""deluge\ui\gtk3\preferences.py"", line 1140, in on_plugin_selection_changed
    self.builder.get_object('label_plugin_details').set_text(
TypeError: Argument 1 does not allow None as a value
Unhandled error in Deferred:
`"
1011260064,331,mhertz,2022-01-12T17:01:34Z,"I apologize doadin, I tested many of the plugins finally worked, including some 3'rd party ones, and was so happy that forgot test each and every one doh!

The last error is not important and also unfreezed, I reported some time ago here with own fix: https://dev.deluge-torrent.org/ticket/3476 "
1011271338,331,doadin,2022-01-12T17:13:20Z,"@mhertz All good, I did the same thing :) . In changing so many things I saw the plugins I use enabled and didn't test though enough. Thats why I went ahead and made builds and tested python 3.7-3.10 x86 and 64, I don't want leave anything untested. Appreciate the link to the ticket."
1011278815,331,doadin,2022-01-12T17:21:25Z,@mhertz https://github.com/deluge-torrent/deluge/pull/331/commits/bd3502bb4471497cb654f8f79c3b53baeef6a71b look like a good change to address this?
1011301134,331,mhertz,2022-01-12T17:48:29Z,"I'll narrow it down and make short edit, but just posting quick to not waste your time if you're also running testings. All plugins work with these added, and as said some is redundant obviously:
````
tmp_ret2 = collect_all('twisted')
datas += tmp_ret2[0]; binaries += tmp_ret2[1]; hiddenimports += tmp_ret2[2]
datas += copy_metadata('twisted', recursive=True)

````
About your fix, thanks mate, and for asking me, and check it out in a bit, though i'm not the one to ask as not ""good"" like you guys, but much appreciate you asked me :)

Edit(s): Quick testing shows your python-setuptools fix working great, thanks mate!. 

* You can narrow further down if wanted, but I just use same for deluge('collect_all' from docs), and same here for twisted fixing the two failing plugins:
````
tmp_ret2 = collect_all('twisted')
datas += tmp_ret2[0]; binaries += tmp_ret2[1]; hiddenimports += tmp_ret2[2]

````
* Just in case, don't begin using my icon-cleaning code unmodded/without-addition(s), as noticed one ""media-playback-pause"" adwaita-icon reported missing when enabling ""toggle"" plugin."
1011311953,331,doadin,2022-01-12T18:01:58Z,@mhertz I'll test in a bit if that works the task list is getting pretty small ðŸ˜€
1011373888,331,doadin,2022-01-12T19:20:21Z,"@mhertz I think as far as icons goes the biggest, safest one to remove I think is cursors. We will have to look into or just leave em. Its part of the theme and who knows what random plugin or something might use an icon from the theme so idk."
1011403842,331,doadin,2022-01-12T20:01:20Z,@mhertz Really just down to one more Item needing fixed. Thanks so much for your help!
1011424939,331,cas--,2022-01-12T20:28:57Z,"@doadin I have just fixed the plugin description issue https://dev.deluge-torrent.org/ticket/3476  so no longer need bd3502bb447

I have also fixed the `libintl` error that was reported by @mhertz d2390cd24729 however that would only occur if dll was missing... :slightly_smiling_face: 

"
1011428856,331,doadin,2022-01-12T20:34:06Z,"@cas--  I just noticed, ill update this. Things are looking pretty complete still need to do some cleanup. Mostly being the plugin fix adding data hopefully can at least slim it down. And still waiting for that twisted issue to get fixed I really droped the ball there, but we can just use a fixed build of our own for now not a huge deal. "
1011481266,331,doadin,2022-01-12T21:46:38Z,"@cas-- As long as everything is fine your ok with how its all done, other than cleaning the commits up I think this is ready."
1011489879,331,cas--,2022-01-12T21:59:58Z,"I'll review it tomorrow but a quick skim seems good to merge! I've setup my windows vm again to check how it looks

Thanks for all the effort in resolving this and the details provided for each problem has been really useful ðŸ‘ "
1011491387,331,mhertz,2022-01-12T22:02:20Z,"> I have also fixed the `libintl` error that was reported by @mhertz [d2390cd](https://github.com/deluge-torrent/deluge/commit/d2390cd247291ed428e6707e19d362d499cfd3ed) however that would only occur if dll was missing... ðŸ™‚

@cas, thanks! :) I'm running vanilla here, no mods, and since py3.8+ then without me adding os.add_dll_directory() then not finding the dll from gtk, same with openssl for libtorrent(i.e PATH irrelevant) - the gtk py-bindings runs that call(as patched in by gvsbuild as workaround) , but libintl requested in deluge before that, or so I'm theorizing atleast, as sure have dll. Thanks again.

Edit: Above is unfreezed, like initially reported."
1011497786,331,doadin,2022-01-12T22:11:44Z,"> I'll review it tomorrow but a quick skim seems good to merge! I've setup my windows vm again to check how it looks
> 
> Thanks for all the effort in resolving this and the details provided for each problem has been really useful ðŸ‘ 

Cool. I'm not gonna make any more changes other than cleaning up the number of commits."
1011790062,331,doadin,2022-01-13T04:37:44Z,"@cas-- I combined some of the commits that aimed to do the same thing so its done in 5 commits now vs 12 so its still seperate to see the process that happened to implement fixes, idk if you like this better or not or want it reduced even more? Or maybe this is worse? I saved a copy of how it was in a branch on my fork if you don't like it like this."
1011795238,331,doadin,2022-01-13T04:53:19Z,"the only thing not separate is the process we went through to be able to go from py3.7 to newer other than that its still all separate so the process can be seen, just in fewer steps instead of going back and forth and having commits just changing libtorrent versions.(things I think didn't need to be separate got squished) Again I have a copy of how it was before though if this is not better."
1012199005,331,DjLegolas,2022-01-13T14:41:54Z,"@doadin @mhertz first of all, great work guys. The long waited installer is an important milestone for Deluge 2.0 ðŸ¥‡ ðŸ’¯ 

Regarding only the commits, I would suggest to add to the reason for the patched `twisted` to the commit message because without it, one would never know why it was needed.

And again, thanks for this (>130 comments ðŸ¤£) MR!"
1012311605,331,CirnoT,2022-01-13T16:42:25Z,"I have not checked the version that adds `hiddenimports` from `Twisted`, however can we be reasonable sure that plugins such as YaRSS2 will work? For example, YaRSS2 for v2 depends on `http.cookies` via `requests` and `email.mime.*`. Both of these are part of stdlib for Python and are presumed to be always available, however pyinstaller does not treat them as such and produced binaries might not have necessary modules available.

This was an issue with v1 too, back then YaRSS2 had its own custom code for `email.mime.*` part for Windows users, however since release of v2 it started to depend on various 3rd-party modules such as `requests`, which bring their own dependencies that plugin does not necessarily control. To my knowledge they've done best job they could trying to package these external dependencies into egg they provide, however of course Python's stdlib is out of their control.

---

The other issue that remains is how broken GTK3 is on Windows. Seeing some weird issues where clicking Deluge icon on taskbar does bring window to front but doing so again does not minimize it as one would expect. Using `GTK_CSD=0` is a solution to this (and many more). We should of course never modify user's environment globally when installing Deluge, so the question remains whether there is some way we can have Deluge disable decorations when running on Windows without relying on environment variables.

---

In addition, do we want to also rebase this PR for 2.0.5 so that Windows users can have a stable release? 2.1 introduces some breaking Python2 related changes that will again require attention from some plugin developers so we might want to port back some of the fixes that @cas-- pushed to 2.0.5, make it a 2.0.6 release and push a Windows installer with it, while work on 2.1 continues. For reference, even without these fixes 2.0.5 is very much usable using this PR, however I only tested it as thin-client so YMMV."
1012331086,331,mhertz,2022-01-13T17:04:21Z,"@CirnoT, I specified e.g gtk_csd=0 other place before, but my understanding was that it wasent global and only enherented for running proces, and not transferred. Wrong?

Edit: Always been somewhat leery though, as stated to possibly have a performance penalty, didnt notice any though, but hard to judge, when only quick testing. "
1012373567,331,cas--,2022-01-13T17:55:52Z,"@CirnoT Thanks for suggestions :+1: 

I know that for the dependency issues (e.g. email.mime) were manual fixed in bbfreeze and py2app: https://github.com/deluge-torrent/deluge/blob/d2390cd247291ed428e6707e19d362d499cfd3ed/packaging/win32/deluge-bbfreeze.py#L84 https://github.com/deluge-torrent/deluge/blob/d2390cd247291ed428e6707e19d362d499cfd3ed/setup.cfg#L21

---

Can you more specific about Python2 breaking changes? I probably will have to create a 2.0.x release branch  anyway so certainly possible to release 2.0.5/6 for Windows.

---

> Using GTK_CSD=1 is a solution to this 

Did you mean `GTK_CSD=0`? This is only a env var. Perhaps could be done in [runtime-hook](https://pyinstaller.readthedocs.io/en/stable/usage.html?#cmdoption-runtime-hook)?"
1012392680,331,CirnoT,2022-01-13T18:20:48Z,"> Did you mean GTK_CSD=0? This is only a env var. Perhaps could be done in runtime-hook?

Yes. If its possible to set environment variable for executable via `runtime-hook` in pyinstaller than that would be solution.

> Edit: Always been somewhat leery though, as stated to possibly have a performance penalty, didnt notice any though, but hard to judge, when only quick testing.

Less performance on drawing items is in my opinion preferable to broken interaction with Windows DWM.

> but my understanding was that it wasent global and only enherented for running proces, and not transferred. Wrong?

I am not sure where you set it. Environment variables are usually either set when running process or globally for user/computer (in which case it would apply to everything). If as mentioned above `runtime-hook` can do it for pyinstaller then it would indeed be isolated.

> Can you more specific about Python2 breaking changes? I probably will have to create a 2.0.x release branch anyway so certainly possible to release 2.0.5/6 for Windows.

Some plugins (in this example YaRSS2) still retain some level of compatibility for Python 2, even on releases that are meant for Deluge 2. See https://bitbucket.org/bendikro/deluge-yarss-plugin/issues/67/deluge-210-removed-all-py2-support for details. The common offenders will most likely be `PY2` (from `deluge.common`) and `six` (if plugin decided to use it, but unlikely).

Perhaps we could keep PY2 as a dumb stub (`PY2 = false`) to make plugins happy?"
1012410500,331,CirnoT,2022-01-13T18:45:27Z,"> I know that for the dependency issues (e.g. email.mime) were manual fixed in bbfreeze and py2app:

Ideally we would package all standard modules, so that there is no difference between available environment for Windows and Linux. Python 3.10 would make it easy with `sys.stdlib_module_names`, however as we need to target lower versions, we'd need to come up with some small hook for pyinstaller that enumerates available modules (some options are on https://stackoverflow.com/questions/6463918/how-can-i-get-a-list-of-all-the-python-standard-library-modules). We could also produce a static list for versions below 3.10 (and use `sys.stdlib_module_names` from 3.10 onwards) and provide that as hidden imports directly.

For reference, here is full list of available modules for Python versions between 3.7 and 3.9 (note that some of them will not exist depending on version used, for example `'graphlib', 'zoneinfo'` were introduced in 3.9 while `'macpath'` was removed in 3.8):

```
['pickletools', 'argparse', 'gettext', 'turtledemo', 'runpy', 'copy', 'pydoc', 'dbm', 'ssl', 'struct', 'glob', 'subprocess', 'contextvars', 'trace', 'mailbox', 'winreg', 'concurrent', 'sunau', '__main__', 'encodings', 'random', 'weakref', 'code', 'os', 'fcntl', 'tabnanny', 'shutil', 'winsound', 'profile', 'gc', 'bz2', 'statistics', 'parser', 'fnmatch', 'chunk', 'tkinter', 'fractions', 'bdb', 'compileall', 'sqlite3', 'itertools', 'tempfile', 'traceback', 'curses', 'bisect', 'uu', 'csv', 'textwrap', 'formatter', 'smtplib', '_dummy_thread', 'calendar', 'xml', 'codecs', 'imghdr', '_thread', 'nis', 'sndhdr', 'urllib', 'multiprocessing', 'zoneinfo', 'decimal', 'gzip', 'mimetypes', 'timeit', 'math', 'warnings', 'cProfile', 'io', 'socketserver', 'socket', 'types', 'ast', 'wave', 'operator', 'signal', 'zipapp', 'linecache', 'builtins', 'doctest', 'tokenize', 'netrc', 'hashlib', 'audioop', 'binhex', 'aifc', 'configparser', 'pty', 'quopri', 'cmd', 'marshal', 'poplib', 'xdrlib', 'telnetlib', 'tracemalloc', 'site', 'ctypes', 'select', 'time', 'asyncio', 'nntplib', 'pickle', 'typing', 'asynchat', 'smtpd', 'cgi', 'tarfile', 'atexit', 'dataclasses', 'optparse', 'pwd', 'lzma', 'py_compile', 'syslog', 'pyclbr', '__future__', 'test', 'ossaudiodev', 'html', 'pipes', 'graphlib', 'dummy_threading', 'contextlib', 'heapq', 'http', 'copyreg', 'plistlib', 'fileinput', 'logging', 'numbers', 'ensurepip', 'distutils', 'xmlrpc', 'datetime', 'webbrowser', 'binascii', 'imaplib', 'grp', 'hmac', 'locale', 'queue', 're', 'getopt', 'sched', 'stat', 'stringprep', 'zipfile', 'cmath', 'termios', 'zipimport', 'sysconfig', 'tty', 'spwd', 'difflib', 'rlcompleter', 'symtable', 'token', 'turtle', 'filecmp', 'secrets', 'venv', 'msilib', 'unittest', 'keyword', 'shelve', 'codeop', 'symbol', 'email', 'modulefinder', 'reprlib', 'mailcap', 'pprint', 'readline', 'unicodedata', 'posix', 'selectors', 'json', 'colorsys', 'pathlib', 'pstats', 'sys', 'pkgutil', 'crypt', 'ftplib', 'lib2to3', 'shlex', 'array', 'uuid', 'errno', 'getpass', 'abc', 'dis', 'base64', 'mmap', 'wsgiref', 'inspect', 'functools', 'ipaddress', 'resource', 'threading', 'faulthandler', 'imp', 'asyncore', 'cgitb', 'string', 'platform', 'msvcrt', 'zlib', 'enum', 'collections', 'pdb', 'macpath', 'importlib']
```

Providing it as-is to hidden imports in pyinstaller SHOULD be fine, it silently skips over imports it can't enumerate."
1012442615,331,mhertz,2022-01-13T19:30:22Z,"Very quick, as not liking intrude on your important things, but just remembered that I otherplace added requests(not stdlib) and pygame, from pip, when installing deluge from pip, so springjools's autoremoveplus fork can even be enabled/used(don't know if relevant to you), and notifications default plugin works for playing sound. Don't need to respond. Thanks for everything you good people do :)"
1012446233,331,CirnoT,2022-01-13T19:35:32Z,"> added requests(not stdlib) and pygame, from pip, when installing deluge from pip, so springjools's autoremoveplus fork can even be enabled/used(don't know if relevant to you)

Appreciated to know, however non-stdlib requirements are something plugin developers must solve themselves, otherwise users are forced to take manual steps (like you did), so this is not something we can accommodate when packaging Windows version. For example, YaRSS2 depends on `requests` too but they do vendor it themselves."
1012542264,331,mhertz,2022-01-13T21:48:21Z,"Wanted to let doadin answer, but as I had tested it anyways, then maybe save him some time... With CirnoT hiddenimports list added to spec, and
````
tmp_ret3 = collect_all('email')
datas += tmp_ret3[0]; binaries += tmp_ret3[1]; hiddenimports += tmp_ret3[2]
````
Then yarss2 still fails because of that python2 support removed, so as not sure how add py2 dumb stub as suggested, then just tested deluge master branch, and worked with above, sorry for not cutting down propperly the collect_all.

Edit: Sorry, don't use yarss2, and just saw it was possible to enable yarss2 now and the plugin sub-menu came through in gtkui propperly."
1012546353,331,cas--,2022-01-13T21:55:02Z,"> Perhaps we could keep PY2 as a dumb stub (PY2 = false) to make plugins happy?

Done via https://github.com/deluge-torrent/deluge/commit/6da4c4bf6667cfb0b6f0d4dfbc8ab6d2be5ef09a"
1012571241,331,cas--,2022-01-13T22:27:36Z,"@doadin So I am happy to merge this just now and we can work on cleaning it up further in new PRs

Thank you again for all the work in getting to this stage!

These are some the issues that have come up in and still need addressed:

- [ ] Cleanup comments by @CirnoT 
- [ ] `email.mime` deps
- [ ] Include all stdlib
- [ ] Include pygame for notification plugin
- [ ] Set GTK_CSD=0 in runtime hook
- [ ] Host patched Twisted binary under Deluge "
1012578648,331,cas--,2022-01-13T22:33:04Z,Btw the job will not run by default on PRs but I added a condition if labelled with 'windows' so can try that out to see if it works...
1012578952,331,DjLegolas,2022-01-13T22:33:37Z,"About the stdlib, why not use the `Windows embeddable package` available from python?
It exists exactly for this purpose."
1012579519,331,doadin,2022-01-13T22:34:42Z,"@cas-- Sorry, I just woke up was going to make a commit with some of the requested changes, was just commenting and saw you merged."
1012596882,331,CirnoT,2022-01-13T23:03:30Z,"> About the stdlib, why not use the `Windows embeddable package` available from python?
> It exists exactly for this purpose.

That is not compatible with pyinstaller, or are you suggesting that we should abandon pyinstaller and create our own stub executables using embeddable package?"
1018515190,338,doadin,2022-01-21T13:41:28Z,@cas-- I think it would be nice to get this & f89f28f81624c8eabcc612a3acff4a7606bd2235 merged if possible for the windows release.
1019504962,338,doadin,2022-01-23T15:12:45Z,"@cas-- I think this is ready except this would bring the min python version to 3.4. Idk if we want to continue to work with older versions, 3.4 went eol March 18, 2019."
1020502540,338,doadin,2022-01-24T20:12:25Z,"@cas-- I expanded the interface check to use regex to match in case ifaddr is not available but regex only works on windows so, im not sure about a failback for linux/mac."
1020619738,338,DjLegolas,2022-01-24T22:36:03Z,"BTW, I think it will be best to also add tests for the changes."
1020654057,338,doadin,2022-01-24T23:26:50Z,@DjLegolas Maybe for now I will leave out multi-homing support just add support for interfaces. I wanted to do both so we don't have to edit the ip checks multiple times but at least at the moment I can't see how to get it done.
1020663677,338,doadin,2022-01-24T23:45:10Z,@DjLegolas the interface check using ifaddr works cross-platform however I don't have nor do I know a way to do a failback for linux/mac.
1020664253,338,DjLegolas,2022-01-24T23:46:22Z,"no problem. let's focus on verifying the linux interfaces w/o `ifaddr`.
One way I found is getting a list of [available interfaces](https://man7.org/linux/man-pages/man5/sysfs.5.html) like so `os.listdir('/sys/class/net/')`.
Need to check if available on other systems as well.

Or maybe, relay on `ifaddr` being always available as it is a dependency."
1020691181,338,doadin,2022-01-25T00:38:31Z,"@DjLegolas turns out with python >=3.3 we can use socket.if_nameindex() this is not available till 3.8 for windows. And apparently the min version for deluge is 3.6

edit: I guess not for windows because it doesn't return a guid."
1021518666,338,cas--,2022-01-25T19:10:33Z,"I agree let's do just one thing at a time in the PR (just the interface/adapter checks). I would also suggest that we optionally include `ifaddr` instead of trying to hack the problem ourselves, fallback to `True` and assume user is correct. Remember that libtorrent will fail if the interface doesn't exist"
1021546976,338,doadin,2022-01-25T19:45:49Z,"@cas-- 
> I agree let's do just one thing at a time in the PR (just the interface/adapter checks). I would also suggest that we optionally include `ifaddr` instead of trying to hack the problem ourselves, fallback to `True` and assume user is correct. Remember that libtorrent will fail if the interface doesn't exist

By hack do you mean the regex? Would you like me to remove that and just return true if importing ifaddr fails?

"
1022559468,338,doadin,2022-01-26T20:07:54Z,@cas-- I think I have merged all the requested changes.
1022590618,338,doadin,2022-01-26T20:50:19Z,@cas-- not sure about wording for https://github.com/deluge-torrent/deluge/pull/338/commits/9e977506e544c5cf1a6526e3ad86812efa5e8bf5
1023643902,338,doadin,2022-01-27T21:13:43Z,@cas-- I think I have addressed all the changes you have requested.
1024977876,338,doadin,2022-01-29T20:06:28Z,"@cas-- @DjLegolas I'm not sure how to improve the tests since windows is currently the only one that will return false, also we can't really test for true on wndows since we don't know what the guid will be on the VM its run on. Do we want ifaddr for other platforms too in requirements?"
1025000466,338,DjLegolas,2022-01-29T22:42:58Z,"About the tests, you can have something like this:
```python
def get_windows_interface_name(self):
    import winreg

    # find a network card in the registery
    with winreg.OpenKey(
        winreg.HKEY_LOCAL_MACHINE,
        r'SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkCards'
    ) as key:
        self.assertTrue(winreg.QueryInfoKey(key)[0] > 0)  # must have at least 1 network card
        network_card = winreg.EnumKey(key, 0)
    # get GUID of network card
    with winreg.OpenKey(
            winreg.HKEY_LOCAL_MACHINE,
            fr'SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkCards\{network_card}'
    ) as key:
        for i in range(5):
            value = winreg.EnumValue(key, i)
            if value[0] == 'ServiceName':
                interface_name = value[1]
    return interface_name

def test_is_interface_name(self):
    if windows_check():
        interface_name = self.get_windows_interface_name()
        self.assertFalse(is_interface_name('2001:db8:'))
        self.assertFalse(is_interface_name('{THIS0000-IS00-ONLY-FOR0-TESTING00000}'))
        self.assertTrue(is_interface_name(interface_name))
    else:
        self.assertTrue(is_interface_name('lo'))
        self.assertFalse(is_interface_name('127.0.0.1'))
        self.assertFalse(is_interface_name('eth01101'))

def test_is_interface(self):
    if windows_check():
        interface_name = self.get_windows_interface_name()
        self.assertTrue(is_interface('127.0.0.1'))
        self.assertTrue(is_interface(interface_name))
        self.assertFalse(is_interface('127'))
        self.assertFalse(is_interface('{THIS0000-IS00-ONLY-FOR0-TESTING00000}'))
    else:
        self.assertTrue(is_interface('lo'))
        self.assertTrue(is_interface('127.0.0.1'))
        self.assertTrue(is_interface('127.'))
        self.assertTrue(is_interface('eth01101'))
```"
1025009118,338,doadin,2022-01-29T23:50:32Z,@DjLegolas That would only work if we use ifaddr on linux as well for tests.
1025181076,338,cas--,2022-01-30T16:38:08Z,Thanks for your work on this @doadin 
1025327952,338,gazpachoking,2022-01-31T02:46:37Z,"Hmm, so a couple tests added to the suite are failing for me (on Windows 10.) When ifaddr is installed, these two tests fail:
```
self.assertTrue(is_interface(interface_name))
self.assertTrue(is_interface_name(interface_name))
```
When ifaddr is not installed, these two fail:
```
self.assertFalse(is_interface('{THIS0000-IS00-ONLY-FOR0-TESTING00000}'))
self.assertFalse(is_interface_name('{THIS0000-IS00-ONLY-FOR0-TESTING00000}'))
```"
1025330531,338,doadin,2022-01-31T02:56:15Z,"@gazpachoking for that first one I wonder what the output of https://github.com/doadin/deluge/blob/39c6a77dc9d3130869bb690a2d545f24164efb9c/deluge/tests/test_common.py#L144 is.
maybe https://github.com/doadin/deluge/blob/39c6a77dc9d3130869bb690a2d545f24164efb9c/deluge/tests/test_common.py#L138 is a problem with using the first adpater maybe its a loopback or something that ifaddr does not consider.

when ifaddr is not installed it should fail to regex which those are formated correctly. So actually they should be true.
"
1025332108,338,doadin,2022-01-31T03:01:51Z,@gazpachoking did you test with ifaddr from requirments.txt?
1025332781,338,gazpachoking,2022-01-31T03:03:28Z,I actually just saw that and reinstalled with the same issue.
1025333967,338,gazpachoking,2022-01-31T03:06:06Z,"ifaddr is giving a list of 5 adapter strings, but the one retrieved from the registry via test isn't in it"
1025335688,338,gazpachoking,2022-01-31T03:09:20Z,"Here's what interface_name is successfully reading as
![image](https://user-images.githubusercontent.com/187133/151733669-e41dd304-cc86-4e19-9e34-30bd90084262.png)
And here's the list of adapters returned by ifaddr
![image](https://user-images.githubusercontent.com/187133/151733748-1ecd32d5-058a-48d8-802f-fcd5ba20aa39.png)
Intel(R) Ethernet Controller (2) I225-V is my actual addapter, and shows up in both, just different ids."
1025336187,338,doadin,2022-01-31T03:10:18Z,"@gazpachoking the function at https://github.com/doadin/deluge/blob/39c6a77dc9d3130869bb690a2d545f24164efb9c/deluge/tests/test_common.py#L121 on my windows 11 machine returns a valid interface for me, that if addr lists."
1025336550,338,gazpachoking,2022-01-31T03:10:57Z,"Oh wait, the `(2)` is pertinent in that name. My real adapter is `Intel(R) Ethernet Controller (2) I225-V`, the one read from the registry doesn't have that `(2)`, but the second item in my registry is the real one without the 2, and has the matching address."
1025337255,338,gazpachoking,2022-01-31T03:12:21Z,"So, I think the actual code is working properly, but the tests are just fragile. I guess maybe the one read from the registry is an interface that was deleted or something."
1025338303,338,gazpachoking,2022-01-31T03:14:12Z,"Speaking of that line you linked, `for i in range(1):` is just the same as `for i in [0]:`, and isn't much of a loop at all."
1025338946,338,doadin,2022-01-31T03:15:14Z,"> Speaking of that line you linked, `for i in range(1):` is just the same as `for i in [0]:`, and isn't much of a loop at all.

yea it was originally as @DjLegolas had for i in range(5) but would error if there where less then 5."
1025340220,338,doadin,2022-01-31T03:17:33Z,"@gazpachoking yea, maybe one of the adapaters didn't clean uninstall after a driver update or something so a registry entry is still lingering."
1025345842,338,gazpachoking,2022-01-31T03:29:49Z,"It'd be nice to have the tests be more stable, but I'm just going to delete that key from my registry for now."
1025613276,338,cas--,2022-01-31T10:57:58Z,"@gazpachoking I agree, I only quickly checked the tests before merging. I am not sure how much we need to test here tbh as it's somewhat outside Deluge domain to verify adapter lookup and perhaps ifaddr should be mocked out."
1026022290,338,DjLegolas,2022-01-31T17:23:17Z,"That code was only a PoC, and needs improvement... ðŸ˜… "
433116013,221,DjLegolas,2018-10-25T16:21:39Z,I think everything is fixed.
434543958,221,aresch,2018-10-31T02:58:33Z,"This pull request looks good to me.  It would be nice to have some better tests for alert manager, as we don't cover much of what has changed. Feel free to follow-up with some expanded tests if you're interested :)"
434787507,221,DjLegolas,2018-10-31T17:57:29Z,"Hmm, ok, I'll give it a try.
Correct me if I'm wrong, but to fully test `AlertManager`, I'll need to make `libtorrent` post some alerts and to handle them correctly.
One way is to mock it, and the other is to somehow force is to set an alert.
Which is the better way?"
434797426,221,cas--,2018-10-31T18:27:16Z,"Considering the time it takes alerts to be posted, sometimes ~0.5s, mocking libtorrent is a better route. Although a lot of tests rely on libtorrent, it's not the best way of unit testing... :)"
434810202,221,aresch,2018-10-31T19:05:49Z,"> Hmm, ok, I'll give it a try.
> Correct me if I'm wrong, but to fully test `AlertManager`, I'll need to make `libtorrent` post some alerts and to handle them correctly.
> One way is to mock it, and the other is to somehow force is to set an alert.
> Which is the better way?

Yea, you'll want to mock out session.pop_alerts() and session.wait_for_alerts(). You can check out how we did it in spritzle for an idea: https://github.com/spritzle/spritzle/blob/master/spritzle/tests/test_alert.py
"
435696624,221,DjLegolas,2018-11-04T19:08:01Z,So I wrote some test units... What do you guys think @aresch @cas--?
436007336,221,DjLegolas,2018-11-05T19:38:10Z,"Any thoughts why this change cases `tox -e py3` to fail?
I tested it with python 3.5, 3.6, 3.7 and only with 3.7 all tests pass."
1022754772,221,DjLegolas,2022-01-27T01:17:59Z,Rebased and fixed last 2 changes requested by @aresch 
1022982853,221,cas--,2022-01-27T08:54:53Z,@DjLegolas I imagine that the segfault in tests is due to https://github.com/arvidn/libtorrent/issues/6437
1023582901,221,DjLegolas,2022-01-27T19:50:26Z,"Saving the segfault [job](https://github.com/deluge-torrent/deluge/runs/4963505515) for later use.
@cas-- how do you want to handle this? We could try to perform a deep-copy of the alerts"
1040568615,221,cas--,2022-02-15T17:32:45Z,"I am not sure this is stable, I just had it crash on me as soon as I tested the branch out

I am not willing to merge this while there is the potential for segfaults in alert handling."
1457123320,221,cas--,2023-03-06T22:31:59Z,@DjLegolas I have merged the changes for component 0745c0eff85ea4e4a3646c454098503ed08c56ff and 25a2b113e290600043338e22b4f116cd2dbf2886 but I am finding that the alertmanager thread changes is increasing the propagation of segfaults due to the alert pointer going out of scope... I will investigate further on how we can workaround the issue. 
1828111011,221,cas--,2023-11-27T15:53:14Z,"Thanks @DjLegolas 

I applied a refactor to remove the alert copy and avoid segfaults: https://github.com/deluge-torrent/deluge/commit/54d6f502319ea60de6cbe34f1c22e7eed367f1ee

I'm not sure what effect this will have for alert handling so might need to keep an eye on it and revisit if needed."
192954651,57,cas--,2016-03-06T18:25:46Z,"There are a lot of console commits, seems to have strayed a bit from UI options...
"
193005104,57,bendikro,2016-03-06T22:03:14Z,"Yes, I will remove those and merge with the other console changes for a separate PR
"
193435997,57,bendikro,2016-03-07T20:30:08Z,"All the console specific commits have now been removed.
"
211017092,57,cas--,2016-04-17T13:36:24Z,"With reference to the new `ui/entry.py`, perhaps create a `core/entry.py` for the daemon start code?
"
211098805,57,bendikro,2016-04-17T19:49:50Z,"Doesn't the daemon actually fit in the UI category? While it's not a deluge client, it's still an interface to controlling deluge?
"
390387958,181,doadin,2018-05-19T08:02:06Z,"The existing environments don't work as is in windows. This is a large part due to the TOXENV not being set which I was having some issue with appveyor and I didn't try adding it to the existing environments because I have been busy trying to get the tests running and so forth and didnt want to break them for travis.ci as im using both to compare to see proper output. Now that its working I can clean it up a bit more and make some adjustments.

However in at least the one case if you look you have a instance of the environment variable PWD this variable is not available in windows so that one is not going to work even with a appveyor setup adjustment."
390521801,181,doadin,2018-05-20T23:42:02Z,"I think we still need a few different environments for windows because windows has a few extra deps then linux does.

Edit: so we can get away with just mocking curses and win32api to get docs to pass. 
so now flake8 and docs pass."
390583866,181,cas--,2018-05-21T08:07:20Z,"For different env platforms see: https://tox.readthedocs.io/en/latest/example/platform.html

Remember to raise minimum tox version in tox.ini"
392451303,181,cas--,2018-05-28T08:01:00Z,@doadin Reason for closing?
392596121,181,doadin,2018-05-28T20:08:30Z,"Its a ways away from being ready, unless you want to take just the appveyor config or take it + skipping ~40 tests. I think about half those 40 are the console tests which will never run so its not too bad. Other than that the 2 plugin tests still don't run.(TOXENV: plugins)"
392603306,181,cas--,2018-05-28T21:05:23Z,"I am happy with skipping the tests is fine for now, config needs a bit of a polish but it seems to be working and getting windows tests and builds from appveyor would be great."
392603468,181,doadin,2018-05-28T21:06:54Z,Well it also needs some tox changes for multi os like we talked about before which for some reason I cant figure out I had it run on my computer pushed the change to github and it failed..not sure how to address that.
392605854,181,doadin,2018-05-28T21:27:35Z,"As you may have noticed to I was using a libtorrent build from my own we need to find a good reliable source to install that from as the last python build from the libtorrent repo is not good. I was gonna try and make a appveyor build and just have it set to build on tags only(low resource use, and only happenes on releases) but I didnt get that setup either but that would be a good reliable trusted source."
392612747,181,doadin,2018-05-28T22:40:00Z,ok I tried to clean it up a bit more I will leave it be for now let me know any adjustments or w.e. you would like to make.
393022202,181,doadin,2018-05-30T03:53:49Z,"ok so after that gotta clean up the commits and stuff but all the tests run and pass we get PASSED (skips=69, successes=116) which is alot of skips of which about 40 actually need addressing at a later point the others are never gonna pass because of the console ui dependent on python curses. Other than cleaning the commits and stuff make the tox multi os compatible I think i pretty well cleaned the appveyor config but let me know."
393284827,181,doadin,2018-05-30T19:18:42Z,I guess maybe we should use appveyor-retry? to try and download the deps in case for whatever reason it fails to download. They should be cached so it should be rare to even need to download but if it does.
393720130,181,doadin,2018-06-01T00:08:14Z,"yea..I definitely messed up there hopefully I got it right this time? 
edit: apparently not."
393997848,181,doadin,2018-06-01T20:18:34Z,Im not sure where ive gone wrong with this @ unittest change.
394015684,181,cas--,2018-06-01T21:37:06Z,"> Im not sure where ive gone wrong with this @ unittest change.

Apologies that is my bad, I forgot that twisted has it's own `unittest` so just revert to your original code. It's much nicer using the python unitest decorator but sometimes you can't have nice things ;)"
394080499,181,cas--,2018-06-02T11:34:59Z,Ok so I finally worked out that the platform support for tox relies on running `tox` without any env vars or using `tox -e` so adding `pywin32` to tox is not possible currently. I have created another PR #185 with the fixes and changes I wished to make. 
271547455,138,cas--,2017-01-10T11:02:45Z,Can this handle pasting an ipv6 address?
272212023,138,matiasw,2017-01-12T16:34:23Z,"Not really, the last part of the address (after the right-most "":"") would get interpreted as a port number."
272228747,138,cas--,2017-01-12T17:34:30Z,So it is an issue if you paste an ipv6 address without a port...
277687554,138,matiasw,2017-02-06T13:55:21Z,"Ok, it now correctly handles ipv6 addresses, and parses the port from the [2001:0:3238:DFE1:63::FEFB]:3188 style."
278101535,138,cas--,2017-02-07T18:47:59Z,Ok can you fix the errors and rebase into a single commit
278440230,138,matiasw,2017-02-08T19:46:27Z,"Done. Just so you know, the pydef check of Travis-CI failed twice with different results, after I had fixed my errors, which is why I needed to re-open this pull request. So, I think there's something wonky with it."
279788432,138,matiasw,2017-02-14T18:12:42Z,"Ok, I've done that now. 
I noticed that there is also a host, port duo in Connection Manager > Edit. Would you like this to be implemented there, as well? If so, should I make a separate commit about it? And where would you like the newly-created parse_host_port utility, in that case?"
279796877,138,cas--,2017-02-14T18:44:15Z,Have you rebased from latest develop because there is no separate `i2p` anymore
280020444,138,matiasw,2017-02-15T14:11:42Z,"I added the functionality to the  connection manager window, as well."
280162412,138,cas--,2017-02-15T22:34:20Z,"Ok looking better. 

The `split_host_port` function needs improvement and simplified. 

- Use `host` not `ip` as variable name in the function to keep consistency. 
- Start by setting the two variable to `None` and then the last step of the function is `return host, port`
- The tuple is implicit for returning multiple values so can drop the brackets.
- If you can't extract a port then at least pass back the `host` value with `port` set `None`.
- Use int not float for port.
- Docstring should be google style.
- Use `str.partition` to get ipv6 host and port.
- A better descriptive name than `paste` for the string parameter.
"
280167545,138,gazpachoking,2017-02-15T22:54:21Z,"Maybe using the stdlib would be more clear for that split function?
```python
from urllib2.urlparse import urlparse

def split_host_port(paste):
    parse_result = urlparse('//' + paste)
    return parse_result.host, parse_result.port
```

EDIT: In fact, that's so easy, you could probably cut out that utility function altogether. You could also fill username and password from the parse_result to support strings like `user:pass@myhost:123` if desired."
280855216,138,matiasw,2017-02-18T16:10:28Z,"Yeah I changed it to use urlparse. Thanks for the tip! It now supports pasting username and password, as well. 
It would also be possible to have `https://` type scheme identifiers change the proxy type automatically, what do you think?
I believe this version should work, but I'm suddenly unable to test the preferences, because the window won't open, and I get  

> _libtorrent.py:24: RuntimeWarning: to-Python converter for boost::shared_ptr<libtorrent::alert> already registered; second conversion method ignored.
>   import libtorrent as lt
> 18:08 $ Traceback (most recent call last):
>   File ""install/deluged"", line 11, in <module>
>     load_entry_point('deluge', 'console_scripts', 'deluged')()
>   File ""/home/appas/code/deluge/deluge/core/daemon_entry.py"", line 55, in start_daemon
>     from deluge.core.daemon import is_daemon_running
>   File ""/home/appas/code/deluge/deluge/core/daemon.py"", line 21, in <module>
>     from deluge.core.core import Core
>   File ""/home/appas/code/deluge/deluge/core/core.py"", line 27, in <module>
>     from deluge._libtorrent import lt
>   File ""/home/appas/code/deluge/deluge/_libtorrent.py"", line 31, in <module>
>     'Ubuntu users can add the develop PPA: ppa:deluge-team/develop' % get_version())
> ImportError: Deluge 2.0.0.dev898 requires latest github code from libtorrent RC_1_1 branch.
> Ubuntu users can add the develop PPA: ppa:deluge-team/develop

Now, this seems to be because `hasattr(lt, 'generate_fingerprint')` is False. Why? I'm on the latest develop HEAD and libtorrent 1.1.1.0.

EDIT: With regard to Travis-CI's flake8 test, where am I supposed to place these imports?"
280860284,138,cas--,2017-02-18T17:22:44Z,"> I'm on the latest develop HEAD and libtorrent 1.1.1.0.

```
Deluge 2.0.0.dev898 requires latest github code from libtorrent RC_1_1 branch.
Ubuntu users can add the develop PPA: ppa:deluge-team/develop
```

> where am I supposed to place these imports?

Run `isort` on the file and it will update the changes required automatically.
"
280866792,138,cas--,2017-02-18T18:54:21Z,"Just thought you should strip whitespace from the clipboard text.

I also wonder if it should automatically paste those values from the clipboard. A good example is for urls in add_torrent_dialog."
280918680,138,matiasw,2017-02-19T13:20:22Z,"Whitespace is now stripped.
Do you mean like, if, on inspection, the clipboard is found to contain suitable values, these would be pasted automatically? I think that's a separate feature that we could look into implementing.
Meanwhile, what should I do to get deluged working again? I got this 
> ImportError: Deluge 2.0.0.dev897 requires lastest github code from libtorrent RC_1_1 branch.

completely out of the blue."
280921123,138,cas--,2017-02-19T14:03:56Z,That is because the latest develop code requires the latest libtorrent git branch code (what is going to be 1.1.2 release). So you would need to checkout RC_1_1 and build that code or use the ubuntu ppa if you can.
280922411,138,matiasw,2017-02-19T14:26:23Z,"Yeah, I have the libtorrent code from github. I've tried with the latest master, as well as the libtorrent-1_1_1 release tag. Or do you mean some other version?"
280922594,138,cas--,2017-02-19T14:29:50Z,"I have repeated many times:  git branch `RC_1_1` not master and not tag 1.1.1.

    git checkout RC_1_1"
282083643,138,cas--,2017-02-23T18:49:25Z,Thanks d75afc007dcc5b
56566920,12,doadin,2014-09-23T18:28:53Z,"tested and works
"
56570700,12,doadin,2014-09-23T18:53:10Z,"Corrections made based on your notes. Nothing else.
"
56576681,12,gazpachoking,2014-09-23T19:33:39Z,"Does this fail elegantly when these keys don't exist in the registry?
"
56577149,12,doadin,2014-09-23T19:36:47Z,"I dont think so. Id have to try.
"
56577314,12,doadin,2014-09-23T19:38:02Z,"It doesnt, it says cannot find the file.
"
56580495,12,doadin,2014-09-23T20:01:03Z,"Now it will try the registry and if there is no key will go back to using static values.
"
56580607,12,doadin,2014-09-23T20:01:57Z,"I might have messed up on the formating though.
"
56581623,12,doadin,2014-09-23T20:08:59Z,"I dont think it should keep the hardcoded 'C:\Program Files\7-Zip\7z.exe', options though because if its in the program files then mostlikely the user used the installer and therefore the registry should pick it up.
"
56583115,12,doadin,2014-09-23T20:19:45Z,"Other than that though i think im about done. Unless theres more issues with it not being up to codeing standards. It works exactly like it was but improved to work in more cases. Let me know.
"
56716332,12,doadin,2014-09-24T18:28:15Z,"I thought the like 5 line commit was pretty simple but i suppose its easier. And yea sure there we go we can keep them doesnt hurt.
"
56721831,12,cas--,2014-09-24T19:06:09Z,"Almost there, just need to remove the code in lines 67-71 and replace with `pass` 
"
56744674,12,cas--,2014-09-24T21:51:10Z,"Thanks I have merged this now.

It still needed a few minor changes, the exception type was missing, needed a couple of spaces and the branch rebasing into a single commit.
"
385868002,180,doadin,2018-05-02T05:22:34Z,@aresch I believe i have fixed it? And thanks for the review.
388275311,180,doadin,2018-05-11T06:40:17Z,This should be ready for merge now. Unless theres something missing im not aware of it runs and sets the proper setting in GTKUI and WebUI.(confirmed in core.conf and ltconf)
390390713,180,doadin,2018-05-19T08:54:29Z,"I think I have addressed all the issues now?

I should probably just remove the flake8 commit, it doesn't fully make the test pass anyways. yea?"
390437714,180,cas--,2018-05-19T22:49:38Z,"Yeah I am trying to fix those failing tests and you can rebase when it's pushed, see #182"
390448793,180,doadin,2018-05-20T01:15:35Z,"Yea, so far I can see the changes so far does affect travis.ci test but should be some kinda of solution to make them more broadly compatible. GL.  :)"
392613008,180,doadin,2018-05-28T22:43:18Z,Is this ready to go now?
394018001,180,asavah,2018-06-01T21:47:21Z,"Was this runtime tested? I don't think so ...
```
00:46:14.357 [DEBUG   ][deluge.core.alertmanager      :115 ] peer_blocked_alert:  - : blocked peer: ip1 [invalid_local_interface]
00:46:14.358 [DEBUG   ][deluge.core.alertmanager      :115 ] peer_blocked_alert:  - : blocked peer: ip2 [invalid_local_interface]
00:46:14.358 [DEBUG   ][deluge.core.alertmanager      :115 ] peer_blocked_alert:  - : blocked peer: ip3 [invalid_local_interface]
```

After this got merged deluged won't download or seed."
394018877,180,doadin,2018-06-01T21:51:14Z,It was runtime tested I use this build and it runs just fine. question look at the error...it says invalid interface what did you use for a interface? currently only a ip is supported. as deluge runs the is_ip check on the input.
394019611,180,asavah,2018-06-01T21:54:32Z,"I ve tried no ip at all (blank field).
Tried local ip of the server.
Same result.
The error itself comes from libtorrent (I'm using 1.1.7).
the peer list is empty for all the torrents, reverting this PR makes everything work again.

Currently I'm trying to figure out what's wrong, will submit a fix if I find one.

And I'm not the only one https://forum.deluge-torrent.org/viewtopic.php?f=8&t=54970"
394021082,180,doadin,2018-06-01T22:01:15Z,"I just tested on windows and it runs just fine with no option selected or with a interface ip selected, maybe this is a linux issue?

deluge does have a restore previous setting with this options so I would verify with ltconfig(shows ""actual"" value) what the outgoing_interface setting is. on windows default is 0.0.0.0 which is any and works fine."
394021597,180,asavah,2018-06-01T22:03:41Z,"Not sure yet,
 yes, I'm running on linux (ubuntu 18.04 server), trying to dig through libtorrent api , c++ is not my favorite language ..."
394022249,180,asavah,2018-06-01T22:07:03Z,"https://libtorrent.org/single-page-ref.html


name | type | default
-- | -- | --
outgoing_interfaces | string | """"

sets the network interface this session will use when it opens outgoing connections. By default, it binds outgoing connections to INADDR_ANY and port 0 (i.e. let the OS decide). **Ths parameter must be a string containing one or more, comma separated, adapter names. Adapter names on unix systems are of the form ""eth0"", ""eth1"", ""tun0"", etc. When specifying multiple interfaces, they will be assigned in round-robin order. This may be useful for clients that are multi-homed**. Binding an outgoing connection to a local IP does not necessarily make the connection via the associated NIC/Adapter. Setting this to an empty string will disable binding of outgoing connections.

It should be interface name not ip address, may be windows resolves it somehow ..."
394023892,180,asavah,2018-06-01T22:16:20Z,"Dirty (not proper) fix:
https://github.com/deluge-torrent/deluge/pull/180/files#diff-fb7ff7c24ea09f1000011185039b4219R220
change '0.0.0.0' to ''

outgoing_interfaces is handled different to listen_interface in libtorrent itself."
394025468,180,doadin,2018-06-01T22:25:53Z,On Windows there isn't really interface names so libtorrent on Windows uses ip. Sorry I didn't see 0.0.0.0 wasn't default parameter but at least on Windows which you can see through ltconfig not setting a value results in 0.0.0.0 being used. Sorry.
1028864430,359,cas--,2022-02-03T10:57:03Z,"Unless we are going to include a type checker, I am not sure the value here? Also the type is included in the docstring and there should be only one source of truth"
1029047587,359,gazpachoking,2022-02-03T14:30:33Z,"Hmm, that's a good point and I hadn't fully thought it out. Here were my goals:
1. Have the IDE know what stuff was when I'm refactoring. (I have several branches where I'm trying different stuff, and the IDE rarely has good type info at the moment.)
2. Define the contract a bit better for exported methods, so it's more apparent if they get changed. (Once again, I was thinking more how pycharm automatically highlights wrong usage/returns more than running an explicit type checker.)
3. I don't think it would be terrible to enable mypy checking in the loosest mode, where it only cares about the things we have already documented, such that type hints could be added bits at a time.

That being said, point 1 is probably not so applicable to the exported methods, because they normally get used via client, or via component.get(), both of which the IDE loses track of the type hints.
And 2 is probably better served by the docstrings, so it gets exported to the RPC docs. I do like the expressiveness of the type hints compared to just a simple type in the docstring, (e.g. List[Tuple[int, str]]) but in cases where the requirement is more complex it needs to be spelled out in words for the generated documentation anyway. If we did want to move to this style type hints, we could make it the single source of truth, and just make the docstrings for people https://pypi.org/project/sphinx-autodoc-typehints/ (this would be my vote.)

I still think the type hints are quite useful in the IDE for autocompletion, and I'd be inclined to add them to any bits I touch when doing any fixing/refactoring, unless you are against them completely. For more internal methods the disadvantages above are moot."
1029056574,359,cas--,2022-02-03T14:40:06Z,"I had forgotten about IDE usefulness so happy to try to accommodate there, just didn't want to have the types to become outdated or spend a lot of effort for little gain. 

Personally I find type hints can reduce code readability and unless constantly encountering type issues not worth the added overhead, especially if never fully verified by mypy.

Since we already have a form of typing in the code, I am happy if we experiment with moving types from docstrings. As you suggest starting with core exported methods and use [sphinx-autodoc-typehints](https://pypi.org/project/sphinx-autodoc-typehints/)."
1029152733,359,DjLegolas,2022-02-03T16:14:05Z,"I think that we should also start converting the docstrings to googles's format, probably in another PR."
1029157643,359,cas--,2022-02-03T16:18:49Z,Can use https://github.com/dadadel/pyment/ to convert them
1029615308,359,gazpachoking,2022-02-04T04:04:59Z,"I did some work in core.py standardizing the docstrings, removing the types, and enabling sphinx generating them from the function signatures. Seems to be working pretty well.
![image](https://user-images.githubusercontent.com/187133/152469719-702715b8-3a8e-4916-8b6b-878f903fc591.png)
The docstring updates were sorta tedious. I tried pyment, couldn't get it to work very well. I'd be more inclined to fix stuff as it gets touched going forward rather than do a big dump."
1029635408,359,aresch,2022-02-04T05:03:19Z,Can we add a mypy check as a github action? We really should have typing everywhere that's feasible.
1029638231,359,gazpachoking,2022-02-04T05:09:23Z,"> Can we add a mypy check as a github action? We really should have typing everywhere that's feasible.

Yeah, I was just experimenting with mypy. Trying to figure the easiest way to introduce it without a shitload of comments on stuff to ignore before we get it all in.
"
1030114829,359,cas--,2022-02-04T15:53:17Z,Can we leave the mypy to another PR and get this one merged
1030134818,359,gazpachoking,2022-02-04T16:15:16Z,"> Can we leave the mypy to another PR and get this one merged

Sure can. I'll back that stuff out, was just doing some experiments."
1030154920,359,gazpachoking,2022-02-04T16:38:52Z,Restored this to just the doc changes and type hints.
1030669623,359,cas--,2022-02-05T17:56:03Z,"@gazpachoking There are breaking compatibility changes with both older Twisted and Python versions in the PR, I have reverted the code from develop: 1089adb8442

Perhaps we concentrate on fixing other areas of the code and Windows release as I don't see the expenditure just now worth it? "
1030672157,359,gazpachoking,2022-02-05T18:09:53Z,"> There are breaking compatibility changes with both older Twisted and Python versions in the PR

Ahh. Didn't consider older versions of twisted not having type hinting capability. Shouldn't be any issues with older python though, I didn't use the stdlib types as generics, so that should be fine. The twisted issue would also be resolved if we drop python 3.6 support, was questioning that in my mypy PR. https://github.com/deluge-torrent/deluge/pull/362

> Perhaps we concentrate on fixing other areas of the code and Windows release as I don't see the expenditure just now worth it?

Yeah, that's fine. I just prefer adding the type hints as I go fixing other stuff, so it's a real bummer."
1030688143,359,cas--,2022-02-05T19:48:28Z,"> Shouldn't be any issues with older python though, I didn't use the stdlib types as generics, so that should be fine.

I thought I saw usage but seems I was mistaken

> re python 3.6

Certainly can consider dropping it for 2.1.x since it would simplify our support :thinking: 

If you can see a quick way to get typing in without too much overhead certainly update this PR. I just have limited time to investigate any resulting errors

I should also see about running a CI that has our minimum requirements and current requirements"
1030696780,359,gazpachoking,2022-02-05T20:51:23Z,"> If you can see a quick way to get typing in without too much overhead certainly update this PR. I just have limited time to investigate any resulting errors

We could do comment type hints, or, probably nicer, just type Deferreds as Deferreds without typing their return value. If we do maybe_coroutine branch that won't be bad, since we don't return a Deferred if the function is wrapped in that."
1030697949,359,gazpachoking,2022-02-05T20:59:44Z,"I think there shouldn't be problems without the use of generic Deferred return types...

> I should also see about running a CI that has our minimum requirements and current requirements

Yeah, that would be useful."
1030702977,359,gazpachoking,2022-02-05T21:36:46Z,"Totally forgot type hints could just be strings. Made that change, it's a much better option."
1032094666,359,gazpachoking,2022-02-08T00:43:59Z,"Rebased to resolve the conflicts, should be good again."
405116021,200,cas--,2018-07-15T20:27:58Z,"For reference:

Install debug symbols
```
sudo add-apt-repository ""deb http://ddebs.ubuntu.com bionic main restricted universe multiverse""
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys F2EDC64DC5AEE1F6B9C621F0C8CAB6595FDFF622
sudo apt install libgtk-3-0-dbgsym
```

To fail on first warning and get backtrace:
```
G_DEBUG=fatal-warnings gdb --args python $(which deluge-gtk)
(gdb) run
(gdb) bt
```
The backtrace should give just a bit more info on where to look to fix warning.

Resources:

http://wiki.inkscape.org/wiki/index.php/Debugging_Inkscape
https://developer.gnome.org/glib/stable/glib-running.html
https://developer.gnome.org/gtk3/stable/gtk-running.html
https://wiki.ubuntu.com/DebuggingProgramCrash"
405116899,200,cas--,2018-07-15T20:42:12Z,"Also useful for debugging the UI
```
gsettings set org.gtk.Settings.Debug enable-inspector-keybinding true
GTK_DEBUG=interactive deluge-gtk
```

Based upon https://chipx86.github.io/gtkparasite/ which does support gtk3 too."
405117119,200,cas--,2018-07-15T20:46:10Z,"Two tracebacks to investigate:

```
Traceback (most recent call last):
  File ""/home/calum/projects/deluge/deluge/ui/gtk3/listview.py"", line 111, in on_button_pressed
    self.emit('button-press-event', event)
TypeError: could not convert type EventButton to GdkEvent required for parameter 0
Traceback (most recent call last):
  File ""/home/calum/projects/deluge/deluge/ui/gtk3/listview.py"", line 225, in record_position
    self.last_sort_order[model[_iter][self.unique_column_id]] = int(str(model.get_path(iter)))
TypeError: argument iter: Expected Gtk.TreeIter, but got __builtin__.builtin_function_or_method
```"
424794482,200,kbdserver,2018-09-26T17:04:17Z,"For future UI design:

- [ ]     added support for hi-dpi displays (use svg system and app icons);
- [ ]     changed pieces bar;
- [ ]     added session pause/resume support from main window;
- [x]     use GIcon to files_tab to show icons according to system mime-types;
- [ ]     Ñonnection manager became more friendly to user;
- [ ]     updated country flag tooltip;
- [x]     adapted to GTK3 and tested Scheduler, Notifications, ItConfig plugins.

Solved UI bugs:
- [ ]     sorting in torrent view;
- [x]     renaming files in files_tab problem;
- [ ]     Ñonnection manager bugs;
- [x]     restore mainwindow vpaned, hpaned position at startup;
- [x]     right click on torrentview header opens two context menus.

[Screenshots.zip](https://github.com/deluge-torrent/deluge/files/2420772/Screenshots.zip)
[deluge.7z.zip](https://github.com/deluge-torrent/deluge/files/2420774/deluge.7z.zip)
"
424975216,200,cas--,2018-09-27T06:35:53Z,"Do you have a git branch with these changes? It would make collaboration easier 

Also code cannot be removed without providing a replacement,  e.g. caching is there for a reason "
425096247,200,cas--,2018-09-27T13:39:30Z,"Caching is enabled on all cells so this can't be isolated to the speed cell. The point of the caching is when dealing with thousands of torrents.

Could you provide more information, e.g. video, on the bug as I don't see the issue you are reporting.

> I don't have git branch and have not yet learned how to use your branch cas--:Feature/GTK3UI as original.

It would be more useful as git commits contain this important information. Also I cannot simply merge all your changes as there are parts that I don't think are corrent. Many self-contained commits each with a related fix is much better. 

 "
425157223,200,cas--,2018-09-27T16:27:29Z,"Thanks for the video, I can replicate now. So the issue is that with both TorrentView and PeersTabView values are appearing in blank cells because they are sharing the same cell renderer func. Would this not be solved by not reusing the `cell_data_speed_down` func in Peers Tab so create a `cell_data_peer_speed_down` func?

However the cache is only useful for relatively static content which speed usually isn't so maybe removing the cache here is fine..."
429535317,200,kbdserver,2018-10-13T11:44:26Z,"Calum, solution for UnicodeWarning problem in torrentview.py.
The reason is in ETA int type in liststore. 
[UnicodeWarning_patch.txt](https://github.com/deluge-torrent/deluge/files/2475436/UnicodeWarning_patch.txt)
"
429994889,200,luxus,2018-10-15T20:08:24Z,"is this the blocker for the next release? ""watching"" the deluge reposity makes me really impatient"
430027968,200,kbdserver,2018-10-15T21:54:07Z,"According to my observations, Calum is not interested in a quick release. He makes a lot of important changes, but when the release will come is not clear."
430035976,200,kbdserver,2018-10-15T22:27:24Z,The problem is that there is no development team and release time-line.
431380914,200,cas--,2018-10-19T14:24:44Z,"@luxus It is not said that a watched branch never releases ;)

For Python 3 and other reasons GTK3 is important.

Can we avoid non-relevant discussion in a Pull Request though. 

@kbdserver I don't see how `long` has any effect on Unicode and in Python `int` and `long` were unified."
431391903,200,kbdserver,2018-10-19T14:57:32Z,"> @kbdserver I don't see how `long` has any effect on Unicode and in Python `int` and `long` were unified.

I assumed that your comment # FIXME: Seeing UnicodeWarning ?? was associated with this warning:

[Failure instance: Traceback: <type 'exceptions.OverflowError'>: 3072227291 not in range -2147483648 to 2147483647
/home/kbdserver/sources/deluge/deluge/core/torrentmanager.py:1441:on_alert_state_update
/home/kbdserver/sources/deluge/deluge/core/torrentmanager.py:1499:handle_torrents_status_callback
/usr/lib64/python2.7/site-packages/twisted/internet/defer.py:459:callback
/usr/lib64/python2.7/site-packages/twisted/internet/defer.py:567:_startRunCallbacks
--- <exception caught here> ---
/usr/lib64/python2.7/site-packages/twisted/internet/defer.py:653:_runCallbacks
/home/kbdserver/sources/deluge/deluge/ui/gtk3/torrentview.py:611:_on_get_torrents_status
/home/kbdserver/sources/deluge/deluge/ui/gtk3/torrentview.py:589:update_view
/usr/lib64/python2.7/site-packages/gi/overrides/Gtk.py:1052:set
/usr/lib64/python2.7/site-packages/gi/overrides/Gtk.py:1046:_set_lists
/usr/lib64/python2.7/site-packages/gi/overrides/Gtk.py:915:_convert_value
/usr/lib64/python2.7/site-packages/gi/overrides/GObject.py:218:__init__
/usr/lib64/python2.7/site-packages/gi/overrides/GObject.py:249:set_value
]

If so, warning is related to the type of the variable in the liststore."
431405321,200,cas--,2018-10-19T15:37:16Z,"Ah well yes that is a different issue and the solution is to limit the maximum size of ETA returned by torrent status. Perhaps put a max value of `31557600`, which is a year."
431410079,200,kbdserver,2018-10-19T15:52:14Z,"You're right, it's better:
[ETA_FIX.txt](https://github.com/deluge-torrent/deluge/files/2496506/ETA_FIX.txt)
"
431459136,200,kbdserver,2018-10-19T18:40:38Z,"For future UI design Part2:
-   Changed the trackers tab - edit tracker in tab or remove, move in multi-selection mode directly. Button Bar can be activated if needed;
-   Added flags information in peer tab to understand how this peer is connected;
-   Others design improvements.
Video and source code attached.
[For_Future_Design_Part2.mp4.zip](https://github.com/deluge-torrent/deluge/files/2496960/For_Future_Design_Part2.mp4.zip)
[deluge.7z.zip](https://github.com/deluge-torrent/deluge/files/2496962/deluge.7z.zip)
"
431584154,200,cas--,2018-10-20T13:57:23Z,"@kbdserver Please provide this as a pull request, patches or link to a branch. It is too much time and effort to do this with a source code zip file. 

https://dev.deluge-torrent.org/wiki/Contributing/PullRequests"
431586551,200,kbdserver,2018-10-20T14:27:55Z,"You do not understand, Calum. I want to help the project survive. Your problem is not in a zip file"
431587968,200,kbdserver,2018-10-20T14:45:44Z,"Maybe you're trying to get more money from https://www.patreon.com/deluge_cas.
 But also think about the users who like the program."
431594857,200,cas--,2018-10-20T16:08:54Z,"> You do not understand, Calum. I want to help the project survive. 

If you want to do that, then submitting pull requests is how you help me. Code needs reviewed before it can be merged and providing a zip is not how software development works these days. It is how the develop branch got into this mess in the first place.

>Maybe you're trying to get more money from https://www.patreon.com/deluge_cas.

Disparaging comments are not welcome here.
"
431601138,200,luxus,2018-10-20T17:19:39Z,@kbdserver can I help you to create a pull request?
431611256,200,kbdserver,2018-10-20T19:28:35Z,"> @kbdserver can I help you to create a pull request?

I will be grateful, thanks!"
431652105,200,kbdserver,2018-10-21T09:13:55Z,"> > 
> 
> If you want to do that, then submitting pull requests is how you help me. Code needs reviewed before it can be merged and providing a zip is not how software development works these days. It is how the develop branch got into this mess in the first place.

This path is very slow, deluge lost the advantage."
431652703,200,kbdserver,2018-10-21T09:25:29Z,"> > Maybe you're trying to get more money from https://www.patreon.com/deluge_cas.
> 
> Disparaging comments are not welcome here.

For me it is not right to ask for money and not to give anything in return"
431654281,200,kbdserver,2018-10-21T09:48:22Z,"Calum, you are a professional programmer, I do not even doubt that you have invested in the project. Perhaps a reboot is necessary - Deluge 3.0.0"
431656965,200,cas--,2018-10-21T10:27:24Z,"> This path is very slow, deluge lost the advantage.

This is the way that all large project works and to do otherwise wastes the project development time. There are many article on the internet as to why this is the case and I should not need to explain myself.

> For me it is not right to ask for money and not to give anything in return

I have been working for [many years](https://github.com/deluge-torrent/deluge/graphs/contributors) on Deluge so I have given plenty with Deluge a stable 1.3 because of my efforts. Patreon was never solely about next major release of Deluge, it was about me running the project as a whole, including work on libtorrent. Those who donate have got updates as to what is going on with myself.

Please do not post any further off-topic comments here."
431696516,200,bendikro,2018-10-21T19:24:31Z,"> Maybe you're trying to get more money from https://www.patreon.com/deluge_cas.
> But also think about the users who like the program.

@kbdserver
I'm not quite sure I understand what you're trying to say, or if you understand what you're saying yourself.

Running a project like this is a huge amount of work, and if there is one thing you can do to help, it is to contribute in a manner than helps the developers the most.
Dumping a zip archive with your changes has never been the way to contribute to a software project ever since patches become the standard. The fact that you even bother to quarrel about this suggest you don't know enough about software development to be in a position to suggest anything at all about how any developer should accept any help at all.

If you need help with creating a PR, you should be clear about that, and maybe someone will help you. 
Saying that Cas won't accept zip archives due to wanting money is ridiculous.
Suggesting shit like you did is not the way to behave, and deserves am apology IMO.
If you tried something like this e.g. on the linux dev email list you'd be told to fuck off."
431700604,200,kbdserver,2018-10-21T20:19:04Z,Good luck in the project.
431704944,200,kbdserver,2018-10-21T21:19:32Z,"Many want to stop the project.
Fuck off yourself  bendikro"
433972184,200,kbdserver,2018-10-29T16:11:44Z,"Blocklist plugin GTK3 fixes
[Blocklist_fixes_diff.txt](https://github.com/deluge-torrent/deluge/files/2526074/Blocklist_fixes_diff.txt)
![blocklist](https://user-images.githubusercontent.com/43581579/47663567-6203aa80-dbae-11e8-8992-1aaf112f1bab.png)

Updated SVG Icons for Scheduler and Blocklist plugins:
[SVG_Icons.zip](https://github.com/deluge-torrent/deluge/files/2535037/SVG_Icons.zip)
"
435583602,200,kbdserver,2018-11-03T12:20:35Z,"Dear Calum, what is the release date?"
1019161190,343,cas--,2022-01-22T10:20:01Z,"Can we try to have separate PRs for distinct changes e.g. lt deprecated vs other deprecated so the easy changes can be merged, also provide some context for the change in the commit message. e.g. explain why are were replacing linux_distribution and perhaps a link to documentation

Also for deluge 2.1.x we can bump the lt min version to 1.2. This means just replacing the deprecated code rather than trying to support lt 1.1"
1019212705,343,DjLegolas,2022-01-22T11:54:49Z,"Good points.
New PR for the `linux_distribution` drop: https://github.com/deluge-torrent/deluge/pull/345.
I have added a commit for min version and removed version validation check in `torrent.py`.

BTW, @cas-- ypu should add your GPG public key to github, as currently it cannot verify your commit."
1020626145,343,DjLegolas,2022-01-24T22:46:27Z,"`resume_data` in `alertmanager` is being accessed when coping the `save_resume_data_alert` alert. It will keep warn us until we stop using a python binding with deprecation support.
Nevertheless, I have replaced the usage of the deprecated `alert.resume_data` in the alert handler in `torrentmanager.py`."
1021460920,343,DjLegolas,2022-01-25T18:00:26Z,"Ok, managed to fix the `url` and `name()` issues as well.
2 points I think I should bring up:
* `resume_data` can be fixed even further by skipping it when coping the `alert`, just like all of the `__x__` methods.
* when fixing the `url`, I learned that there is a function to parse magnet uris - [`lt.parse_magnet_uri()`](https://libtorrent.org/upgrade_to_2.0-ref.html#magnet-links). The return value is an `add_torrent_params` object which can be manipulated just before passing it to the `lt.add_torrent()` method.
 I think we should consider using it at also in https://github.com/deluge-torrent/deluge/blob/e75ef7e31f3a8befd6365acbf8b7ebbb774bb5e5/deluge/common.py#L755

Lastly, I need your input, @cas--, about upgrading to lt1.2.14 as the minimum version as @an0n666 suggested."
1021497017,343,cas--,2022-01-25T18:44:12Z,"> * `resume_data` can be fixed even further by skipping it when coping the `alert`, just like all of the `__x__` methods.

I'm not sure what you mean here, can you elaborate? 

> I think we should consider using it at also in common.py#L755

We should not use any libtorrent method outside of core since we should not require it to be installed if using a thin client.

> about upgrading to lt1.2.14 as the minimum version 

As I said we should not put a high hard limit on the lt version so leave it as 1.2.0 unless there is a critical issue we know Deluge is not compatible with. It would be up to package managers to ensure using latest stable versions of libtorrent "
1021519885,343,cas--,2022-01-25T19:12:09Z,Could you also add to the commit message a few details about the changes
1021521347,343,DjLegolas,2022-01-25T19:14:10Z,"> I'm not sure what you mean here, can you elaborate?

Sure. In [`alertmanager.py`](https://github.com/deluge-torrent/deluge/blob/e75ef7e31f3a8befd6365acbf8b7ebbb774bb5e5/deluge/core/alertmanager.py#L126), we are coping the content of each alert as it arrives as it will be deleted by the caller.
When we receive an alert of type `save_resume_data_alert`, one of it's members is the deprecated `resume_data`.
As part of the copy, we access `resume_data` as well, which triggers the `DeprecatedWarning`.
A possible solution, it treat it as `__x__` (just an example):
```python
alert_copy = SimpleNamespace(
    **{
        attr: getattr(alert, attr)
        for attr in dir(alert)
        if not attr.startswith('__') or attr != 'resume_data`
    }
)
```
The ""correct"" way, according to libtorrent [1.2 upgrade guide](https://libtorrent.org/upgrade_to_1.2-ref.html#resume-data-handling) (last line), is stop compiling LT with deprecated functions enabled, but it's not part of this PR.
 
> We should not use any libtorrent method outside of core since we should not require it to be installed if using a thin client.

I agree. 
Also, passing it from the core to the thin client is not that important and efficient.
Dropping the suggestion.

> As I said we should not put a high hard limit on the lt version so leave it as 1.2.0 unless there is a critical issue we know Deluge is not compatible with. It would be up to package managers to ensure using latest stable versions of libtorrent

Keeping `1.2.0` it is.

> Could you also add to the commit message a few details about the changes

Thinking of a splitting it into 2 commits exactly for that. Give me a couple of minutes."
1021963226,343,DjLegolas,2022-01-26T08:16:19Z,Everything is fixed.
1025211734,343,doadin,2022-01-30T19:21:46Z,"@DjLegolas 
I am also seeing.
`
13:59:22.436 [DEBUG   ][deluge.core.core                  :64  ] Deprecated session status key num_peers, please use peer.num_peers_connected
13:59:22.436 [DEBUG   ][deluge.core.core                  :64  ] Deprecated session status key dht_nodes, please use dht.dht_nodes
13:59:22.436 [DEBUG   ][deluge.core.core                  :64  ] Deprecated session status key has_incoming_connections, please use net.has_incoming_connections
13:59:22.437 [DEBUG   ][deluge.core.core                  :64  ] Deprecated session status key num_peers, please use peer.num_peers_connected
13:59:22.437 [DEBUG   ][deluge.core.core                  :64  ] Deprecated session status key dht_nodes, please use dht.dht_nodes
13:59:22.437 [DEBUG   ][deluge.core.core                  :64  ] Deprecated session status key has_incoming_connections, please use net.has_incoming_connections
`"
1025262130,343,DjLegolas,2022-01-30T23:44:05Z,@doadin with which version of lt?
1025265529,343,doadin,2022-01-31T00:02:48Z,"@DjLegolas sorry, with 2.0.5. So idk if you want to cover that here or not."
1025266016,343,doadin,2022-01-31T00:04:42Z,@DjLegolas googleing part of it like please use net.has_incoming_connections you can see people getting that with lt 1.1.5 https://forum.deluge-torrent.org/viewtopic.php?t=55670 so Id imagine at least that one is old when for each version im not sure.
1025266204,343,doadin,2022-01-31T00:05:26Z,"seems they are all as old as 1.1.11

Edit: at least as far as users have reported on the deluge forums. "
1025269200,343,doadin,2022-01-31T00:15:15Z,"I guess this list should be looked at 
https://github.com/deluge-torrent/deluge/blob/540d557cb2163c41af894ee252cc677d01887376/deluge/core/core.py#L58
https://github.com/deluge-torrent/deluge/blob/540d557cb2163c41af894ee252cc677d01887376/deluge/core/core.py#L69"
1025269469,343,DjLegolas,2022-01-31T00:16:09Z,"It's not a list, but a dict for deprecated session status keys, but seem we only use it when the key is not  available at all:
```python
for key in keys:
    try:
        status[key] = self.session_status[key]
    except KeyError:
        if key in DEPR_SESSION_STATUS_KEYS:
            new_key = DEPR_SESSION_STATUS_KEYS[key]
            log.debug(
                'Deprecated session status key %s, please use %s', key, new_key
            )
            status[key] = self.session_status[new_key]
        else:
            log.debug('Session status key not valid: %s', key)
```
I'll try to fix it also, thanks.
And also for lt2.0"
1025269958,343,doadin,2022-01-31T00:18:00Z,"yea, sorry dict, but yea I just mean look over it see if theres anything that is'nt needed etc if we are going to require lt 1.2+. Anyways you got this :) thanks!"
1025270583,343,DjLegolas,2022-01-31T00:20:11Z,"The real issue is finding the caller that uses old keys...
It might be even a plugin (like ltConfig)"
1025271757,343,doadin,2022-01-31T00:24:16Z,num_peers  dht_nodes  has_incoming_connections show up with no plugins enabled.(maybe the other too just did a quick run to check) Is is still possible that its a plugin?
1025272125,343,doadin,2022-01-31T00:25:30Z,my understanding is ltconfig only loads its settings if enable and doesn't modify settings else where. 
1026287415,343,DjLegolas,2022-01-31T22:46:18Z,"@doadin So the deprecated error was being just printed by `Deluge` itself in the `core`...
The source was in all of the UIs' status bar update code.

Thanks for the catch."
1026408243,343,doadin,2022-02-01T02:04:16Z,"> @doadin So the deprecated error was being just printed by `Deluge` itself in the `core`... The source was in all of the UIs' status bar update code.
> 
> Thanks for the catch.

Cool, now we have modern UI code and up-to-date libtorrent api usage, nice work!

"
1027320002,343,doadin,2022-02-01T21:49:17Z,"@DjLegolas unfortunatly I am not sure this is all set. Currently I am seeing the status bar in gtkui say download 1 G/s but down speed in the torrent list treeview shows 3.6M/s.

edit: same is true for upload speed as well.
edit2: happens in webui too.
I think its not converting bytes vs bites or something. As it seems to be mostly ~100x the value it should be. The status bar does include more then just the torrents transfer speed to some difference is expected but I don't have a gig connection and it went up to 2g/s at one point some definitely off some how."
1028335062,343,DjLegolas,2022-02-02T20:35:23Z,"So it seem that I was using the total uploaded/downloaded bytes in the session...
Should be fix.
@doadin - can you verify? Thanks"
1028401107,343,doadin,2022-02-02T22:04:17Z,"@DjLegolas looks like its fixed, thanks!"
1029498174,343,doadin,2022-02-03T23:30:00Z,@DjLegolas sorry ignore my last comment. Still working fine.
1030156069,343,DjLegolas,2022-02-04T16:40:16Z,"Found some places that needed to be fixed also.
In addition, now I have removed all new known deprecated functions that were introduced in `LT 2.0`."
1038131736,343,cas--,2022-02-13T13:50:12Z,"Closed via 2bd095e5bfc49cbe178fc0ba9df38b88afc238aa

(mix up put wrong PR number in commit!)"
59654514,14,bendikro,2014-10-19T16:06:49Z,"All issues have been addressed as far as I know.
"
61801530,14,cas--,2014-11-05T12:44:12Z,"There are still two outstanding notes
"
65208592,14,cas--,2014-12-02T10:14:10Z,"For the docstrings:

Could the first line not be empty i.e. `""""""Add torrent`...

Add fullstops after args, etc as when reviewing you can be more certain that it it's not an incomplete description :)
"
65229534,14,bendikro,2014-12-02T13:23:02Z,"Comments on docs noted!
"
65401615,14,cas--,2014-12-03T12:45:14Z,"I was about to merge this but realised that the other UIs need to be updated to use this new function.

There were the small docstring changes I was going to add... 

```
diff --git a/deluge/core/core.py b/deluge/core/core.py
index 24bc17d..b410ed9 100644
--- a/deluge/core/core.py
+++ b/deluge/core/core.py
@@ -293,17 +293,17 @@ def add_torrent_magnet(self, uri, options):

     @export
     def remove_torrent(self, torrent_id, remove_data):
-        """"""Removes a torrent from the session.
+        """"""Removes a single torrent from the session.

         Args:
             torrent_id (str): The torrent ID to remove.
-            remove_data (bool): If True, remove the downloaded data.
+            remove_data (bool): If True, also remove the downloaded data.

         Returns:
             bool: True if removed successfully.

         Raises:
-             InvalidTorrentError: if the torrent_id does not exist in the session.
+             InvalidTorrentError: If the torrent ID does not exist in the session.

         """"""
         log.debug(""Removing torrent %s from the core."", torrent_id)
@@ -311,14 +311,14 @@ def remove_torrent(self, torrent_id, remove_data):

     @export
     def remove_torrents(self, torrent_ids, remove_data):
-        """"""Remove torrents from the session.
+        """"""Remove multiple torrents from the session.

         Args:
-            torrent_ids (list): The torrent IDs to remove
-            remove_data (bool, optional): If True, remove the downloaded data, defaults to False.
+            torrent_ids (list): The torrent IDs to remove.
+            remove_data (bool): If True, also remove the downloaded data.
```
"
65444975,14,cas--,2014-12-03T16:52:43Z,"Thanks! Added to develop: [08363f28dd308]
"
1012608979,337,cas--,2022-01-13T23:22:34Z,Hmm seems the PR label condition did not work :thinking: 
1012717504,337,mhertz,2022-01-14T03:28:57Z,"Sorry just quickly wanted to add that i'd recommend rebuild gvsbuild before releasing installers to public, sorry if always was the plan regardless - reason can be read in my issues thread and PR at gvsbuild, both closed now and PR merged. Just to add what's missing there, then I just found out NSIS adds ""Start in"" for it's generated shortcuts into target dir, effectively making people hit the pyinstaller and trailing semicolon bug I previously posted about(on py3.8 and up only), but I didn't knew before today that it is windows adding trailing semicolon to PATH(more info on gvsbuild post), so pretty much most(all) should be affected(unless maybe if having old install before change introduced), and that the generated shortcut from deluge installers uses said ""start-in"" - I tested building installer, install, and couldn't start from desktop shortcut, with error message posted about wrong parameter.

If not wanna rebuild, could also just use something like this in mean time(change paths accordingly), before firing off pyinstaller:
````
(Get-Content c:\Python\Lib\site-packages\gi\__init__.py).replace('if os.path.isfile', 'if p != """" and os.path.isfile') | Set-Content c:\Python\Lib\site-packages\gi\__init__.py
(Get-Content c:\Python\Lib\site-packages\cairo\__init__.py).replace('if os.path.isfile', 'if p != """" and os.path.isfile') | Set-Content c:\Python\Lib\site-packages\cairo\__init__.py
````
Alternatively could instead change that ""Start-in"" from NSIS(easilly goggled), though less good solution imho.

More info if interrested: https://github.com/wingtk/gvsbuild/issues/475

Don't have to respond, and sorry for intrusion again, carry on :) Thanks.

Edit: Actually no such code should be in these py-wrapper init's on freezed imho, and I elsewhere patched it out a long time ago and added my own to deluge init for finding gtk-subdir on py38+, as otherwise point-of-failure(incompatible dll found), but not here where all dll's in main dir, though still takes useless time, though neglible. Could check if frozen etc. Anyway, maybe irrelevant to you and just adding in case."
1012742544,337,doadin,2022-01-14T04:26:53Z,"@cas-- I think this might conclude what I have for now, if it looks ok and you want to merge."
1013071428,337,CirnoT,2022-01-14T12:19:39Z,"> @cas-- I think this might conclude what I have for now, if it looks ok and you want to merge.

We're still missing `GTK_CSD=0`, though we could ship without it and observe reports from users to decide if it should be added or not."
1013102393,337,doadin,2022-01-14T13:08:10Z,"> > @cas-- I think this might conclude what I have for now, if it looks ok and you want to merge.
> 
> We're still missing `GTK_CSD=0`, though we could ship without it and observe reports from users to decide if it should be added or not.

Sorry I meant specifically _**I**_ am done. If you want take these changes as is or what ever ill leave this open let you merge as you see fit @cas-- , but I'm not going to be adding more for a while. I would suggest someone else start a PR for further changes. Thanks guys!

Edit: I did make a few adjustments to this from what you guys have commented."
1013112569,337,cas--,2022-01-14T13:23:21Z,"> I'm not going to be adding more for a while.

That's perfectly understandable, I can make tweaks and hopefully others will contribute once I've created a release"
1013125812,337,doadin,2022-01-14T13:38:52Z,"> > I'm not going to be adding more for a while.
> 
> That's perfectly understandable, I can make tweaks and hopefully others will contribute once I've created a release

Thanks, I do plan on making a few changes/helping with a few things, I'd like to see added, but just gonna take a break for a while and while I would like to see people get an official release soon, I also don't want to hold up progress by just leaving this PR open and not helping/responding."
1018484327,337,cas--,2022-01-21T13:01:07Z,"@doadin

I have refactored the dependencies: 9d4ca77ef7ebf1b3e39b837a0f31cec3da110760

I created a simplified CSD runtime hook: 4f17fc41a506aeba6c595ef7ee2e53fbbd4aeeca

I merged your copyright update: ad27a278fd2b246c9c8aa30ca1887c11ca5bb712

and pygame: 2cad0f46f"
1018509748,337,doadin,2022-01-21T13:34:07Z,That covers the commits I had for here so closing. Thanks!
1032989694,369,cas--,2022-02-08T19:38:12Z,"Nice catch, I have been meaning to investigate that one properly "
1033050786,369,gazpachoking,2022-02-08T20:52:56Z,"I'm looking at all the other bits that call the live handle.status(), and having trouble deciding whether they really need a fresh status or the cached one is good now that it's guaranteed to be relatively recent. If we do want to pull guaranteed fresh status, maybe we should add something like `torrent.get_status(update=False)` That way we are guaranteed to update the cache every time `handle.status()` is called, rather than calling it sometimes and not storing it to the cache."
1033101423,369,gazpachoking,2022-02-08T21:57:24Z,"I had a go at answering my own questions raised in the OP, and implemented them as such. Happy to reconsider if anyone has any better plans."
1033819158,369,gazpachoking,2022-02-09T14:28:05Z,"Another thing that could be done to fix this, potentially alongside this change, is to call get_torrents_status on all of the torrents we need to check rather than looping over them one by one. Presumably the bulk call to libtorrent is more efficient that getting the status on each torrent individually. Maybe leave the current cache expiry changes in as backup, but also add the get_torrents_status call to do the bulk update for the stop ratio check?"
1039871460,369,gazpachoking,2022-02-15T05:22:24Z,Hmm. How did I mess up the docs building?
1040069380,369,cas--,2022-02-15T09:51:34Z,"My quick testing suggests it's related to typing added in commit [Add type hints for the torrent status methods](https://github.com/deluge-torrent/deluge/pull/369/commits/eac93ca35884ef95c37b055d12427eb0c1a40307)

I'm testing locally to see what is causing it"
213848098,78,cas--,2016-04-23T22:28:51Z,"A few notes:
- English is not an option in the drop-down.
- Need to hit `apply` then `ok` but this is probably a pre-existing issue
- Change `height: 22` to `height: 17` to gain some height in Interface.js
"
213848593,78,cas--,2016-04-23T22:32:41Z,"With the extra height I would like `Language` label to be a `xtype: fieldset`
"
213924317,78,bendikro,2016-04-24T10:01:22Z,"Haven't looked at the apply issue, but the Language option should now be working 100%.
"
214039210,78,cas--,2016-04-24T21:21:31Z,"Should we perhaps either prompt 'refresh browser' or actually refresh the page after clicking apply?
"
214039875,78,bendikro,2016-04-24T21:25:10Z,"Probably a good idea. Auto refresh may be a bit intrusive?
"
214048990,78,cas--,2016-04-24T22:25:42Z,"You might be right that auto-refresh could be intrusive so popup box perhaps?
"
214051668,78,bendikro,2016-04-24T22:29:05Z,"Yeah, if that's a simple fix?
"
214053654,78,cas--,2016-04-24T22:35:29Z,"It should be with: https://docs.sencha.com/extjs/3.4.0/#!/api/Ext.MessageBox

Just need to catch the language change
"
214214294,78,cas--,2016-04-25T08:54:31Z,"I think adding this to onApply should suffice:

```
            if ('language' in changed) {
                Ext.Msg.alert(_('Language Changed'), _('Please refresh your browser window.'));
            }
```
"
2310964316,454,cas--,2024-08-26T19:52:20Z,"I'm afraid there are too many changes here and not enough details in the commits about why the change is required. If possible, can you split these up into more concise PRs it will help reviewing and merging"
2324924199,454,Lord-Kamina,2024-09-02T14:51:51Z,"> I'm afraid there are too many changes here and not enough details in the commits about why the change is required. If possible, can you split these up into more concise PRs it will help reviewing and merging

I hadn't seen this comment, sorry for not answering before.

I'd rather not split it (although it IS true that there are some not-strictly related things here) because then we'll never get it merged. However, I'm more than happy to amend commit messages and/or explain why I've made each change."
2329862059,454,Lord-Kamina,2024-09-04T19:57:14Z,@cas-- Using `libtorrent==2.0.8`fails because for some reason that version is missing from pip. I think that's why I had done `<2.0.9`
2333314599,454,zakkarry,2024-09-06T06:09:08Z,"> @cas-- Using `libtorrent==2.0.8`fails because for some reason that version is missing from pip. I think that's why I had done `<2.0.9`

The publishing to pip seems to be intermittent, I've made an issue on libtorrent a little over a week ago about pip builds, but I haven't seen any update. There is a open PR that seems to address some of the builds/CI for libtorrent, but I'm not sure if this directly address this concern.

You can see my issue and the linked PR [here](https://github.com/arvidn/libtorrent/issues/7729)"
2333355143,454,DjLegolas,2024-09-06T06:41:59Z,"@zakkarry there were several issues with the `pypi` publish process for `libtorrent`...
i hope the fixes will work on the next release, as py3.13 is about to be released

@Lord-Kamina please revert the change to `Install GTK` step as it will always fail until we have a newer release for it."
2333358050,454,zakkarry,2024-09-06T06:44:13Z,"> @zakkarry there were several issues with the `pypi` publish process for `libtorrent`... i hope the fixes will work on the next release, as py3.13 is about to be released
> 
> @Lord-Kamina please revert the change to `Install GTK` step as it will always fail until we have a newer release for it.

As I've found out recently heh.

A user on the forums was asking about 3.13 support, and I told him to make an issue or PR, and he made https://github.com/deluge-torrent/deluge/pull/462 for it - it's failing some tests though it seems."
2333849136,454,Lord-Kamina,2024-09-06T11:26:50Z,"> @zakkarry there were several issues with the `pypi` publish process for `libtorrent`...
> 
> i hope the fixes will work on the next release, as py3.13 is about to be released
> 
> 
> 
> @Lord-Kamina please revert the change to `Install GTK` step as it will always fail until we have a newer release for it.

The change to gvsbuild-release was already commited, all that's missing is for the workflow to run, which is only on a manual trigger. However, that would break the current CI. The idea would be to run it just before this PR is ready to be merged. "
2333857570,454,Lord-Kamina,2024-09-06T11:32:20Z,"> > @cas-- Using `libtorrent==2.0.8`fails because for some reason that version is missing from pip. I think that's why I had done `<2.0.9`
> 
> 
> 
> The publishing to pip seems to be intermittent, I've made an issue on libtorrent a little over a week ago about pip builds, but I haven't seen any update. There is a open PR that seems to address some of the builds/CI for libtorrent, but I'm not sure if this directly address this concern.
> 
> 
> 
> You can see my issue and the linked PR [here](https://github.com/arvidn/libtorrent/issues/7729)

I know and I was inquiring about it as well a while ago. Thing is, even if that's fixed, I doubt we'll get retroactive releases for an old version, so the point stands in that we need to be able to 1) update libtorrent and 2) have at least some CI workflow that fails anf alerts us when newer versions break, because else we're putting ourselves in the same position the folks at twisted did, which is essentially forgetting it's an issue.

Of course, I'm willing to help however I can but I have essentially no experience working with libtorrent so I'm not sure that really amounts to much.

What do you think @DjLegolas?"
2336497552,454,Lord-Kamina,2024-09-08T00:43:04Z,"> > @zakkarry there were several issues with the `pypi` publish process for `libtorrent`... i hope the fixes will work on the next release, as py3.13 is about to be released
> > @Lord-Kamina please revert the change to `Install GTK` step as it will always fail until we have a newer release for it.
> 
> As I've found out recently heh.
> 
> A user on the forums was asking about 3.13 support, and I told him to make an issue or PR, and he made #462 for it - it's failing some tests though it seems.

I don't think that's at all related?
What was merged (and still is not really reflecting anywhere) is a change in the way gvsbuild is built for newer releases to be used in Deluge."
2336498123,454,zakkarry,2024-09-08T00:45:48Z,"I wasn't saying it was related necessarily, but you mentioned 3.13, so I informed you of a relevant PR to the version, that's all."
2358520475,454,Lord-Kamina,2024-09-18T13:46:25Z,Closing this as per #466 
218823874,90,cas--,2016-05-12T17:13:59Z,"Just revert/delete my commit removing of unicode_argv until we can test it on Windows and be sure it's working without it. Can be a python 3 milestone...

I think a few extra details in the commit message just to quicky explain the changes would be handy. Also detailing the original issue i.e. `~/delugeDev/deluge -u web -a ""-h""` not displaying help.

This was the original help output for UI group:

```
usage: deluge [-h] [-V] [-c <config>] [-l <logfile>] [-L <level>]
              [--logrotate [<max-size>]] [-q] [--profile [<profile-file>]]
              [-u {web,gtk,console}] [-a ARGS] [-s {web,gtk,console}]
<snip comm opts>
UI Options:
  -u, --ui {web,gtk,console}     The UI that you wish to launch. The UI choices are:
                                   * web -- A web-based interface (http://localhost:8112)
                                   * gtk -- A GTK-based graphical user interface
                                   * console -- A console or command-line interface
  -a, --args ARGS                Arguments to pass to the UI. Multiple args must be
                                   quoted, e.g. -a ""--option args""
  -s, --set-default-ui {web,gtk,console}
                                 Sets the default UI to be run when no UI is specified
```

Currently seeing this:

```
usage: deluge [-h] [-V] [-c <config>] [-l <logfile>] [-L <level>]
              [--logrotate [<max-size>]] [-q] [--profile [<profile-file>]]
              [-s {web,gtk,console}]
              {web,gtk,console} ...

positional arguments:
  {web,gtk,console}              The UI to launch
    web                          A web-based interface (http://localhost:8112)
    gtk                          A GTK-based graphical user interface
    console                      A console or command-line interface
<snip common opts>
UI Options:
  -s, --set-default-ui {web,gtk,console}
                                 Sets the default UI to be run when no UI is specified
```

I know that using subparsers means we cannot add them to the UI parser group so may need to do something similar as described here:  http://stackoverflow.com/questions/32017020/grouping-argparse-subparser-arguments

So if `positional arguments` can be renamed to something more meaningful, moved closer to UI options and include in the description that UI args can be passed as well...
"
218908142,90,bendikro,2016-05-12T22:51:38Z,"Rebased/squashed and removed the unicode_argv commit.

Current output of `deluge -h`

```
usage: deluge [-h] [-V] [-c <config>] [-l <logfile>] [-L <level>]
              [--logrotate [<max-size>]] [-q] [--profile [<profile-file>]]
              [-s {console,gtk,web}]
              {console,gtk,web} [UI arguments] ...

Common Options:
  -h, --help                     Print this help message
  -V, --version                  Print version information
  -c, --config <config>          Set the config directory path
  -l, --logfile <logfile>        Output to specified logfile instead of stdout
  -L, --loglevel <level>         Set the log level (none, error, warning, info, debug)
  --logrotate [<max-size>]       Enable logfile rotation, with optional maximum logfile
                                   size, default: 2M (Logfile rotation count is 5)
  -q, --quiet                    Quieten logging output (Same as `--loglevel none`)
  --profile [<profile-file>]     Profile deluge with cProfile. Outputs to stdout unless a
                                   filename is specified

UI Options:
  -s, --set-default-ui {console,gtk,web}
                                 Sets the default UI to be run when no UI is specified

  {console,gtk,web} [UI arguments]
                                 The UI to launch (default: *)
      console                    A console or command-line interface
      gtk                        A GTK-based graphical user interface
    * web                        A web-based interface (http://localhost:8112)
```
"
219013504,90,cas--,2016-05-13T11:01:33Z,"Ok so I had added a few text tweaks and rebased them and was about to merge when I realised that the ui_entry tests should not be passing... I have pushed those changes back to your branch in the meantime.

What should we be doing with unrecognised args? e.g. old `--ui`
"
219326257,90,bendikro,2016-05-16T00:51:06Z,"I think I got a working solution now that correctly handles the following key cases:
1. console command with no extra argument will connect in interactive mode: `./deluge console`
2. console help: `./deluge console -h`
3. console sub command: `./deluge console info`
4. console sub command help: `./deluge console info -h`

I've added tests to verify this to work, but more tests cases could probably be added.

`--ui` will now give `unrecognized arguments: --ui`. Is this not desirable?
"
401407557,196,DjLegolas,2018-06-29T16:34:20Z,"I'm trying to add tests, as you suggested, with no luck.
It seem as the server is up but when trying to connect to it with SSL\TLS, it does not respond to the protocol, and handle the negotiation process. And this cause the test process to halt and wait to results.
My initial try is in [this](https://pastebin.com/UtJ91YZx) pastebin
@cas-- Any ideas how to fix it?"
401458963,196,cas--,2018-06-29T20:00:18Z,"I didn't realise the tests were so slow. Perhaps leave it for now then. 

The issues you are facing with running a subprocess command in tests is likely related to the twisted reactor. I had success with the following instead: 

```
        from twisted.internet.utils import getProcessOutputAndValue
        d = getProcessOutputAndValue(
            'bash',
            [
            get_test_data_file('testssl.sh'),
            '-p',
            '127.0.0.1:8999',
        ])
        def on_result(result):
            #print(result)
            self.assertIn('OK', result[0])
            self.assertNotIn('Not OK', result[0])
        d.addCallback(on_result)
        return d
```

I did see potential python tests here: https://github.com/tomato42/tlsfuzzer/


"
401489689,196,DjLegolas,2018-06-29T22:30:23Z,"I think I didn't explain the problem correctly.
The script will take time to run, but it's not the problem we have.

When the test run, it starts the WebUI with `self.deluge_web.start()`. The expected behavior is the ability to connect to the server itself by connecting to it's IP and port - `127.0.0.1:8999` and being able to use it. Unfortunately, this is not the case.

When connecting to it with a web browser, firefox and chrome, there is no response from the WebUI at all. All you get is a message that the server is down.
Connecting with `openssl -s_client -connect IP:PORT` only shows `CONNECTED(*some-code*)` and the handshake process being stuck after the 1st phase, `CLIENT HELLO`. A good connection will show the important info about the secured connection, like public cert, protocol version and agreed cipher. 

BTW, this testing library looks cool..  I'll check it out.

**EDIT**: Now I understood what you meant... I'll create a test with both `testssl.sh` and `tlsfuzzer` and verify which is faster."
402473793,196,DjLegolas,2018-07-04T13:06:40Z,"Ok, I've implemented the tests using `testssl.sh`. This effects the duration of `pydef` and `trial` to be completed.

In addition, Not all tests currently passes as a further configuration is needed for `Twisted`:
* `Client-Initiated Renegotiation` needs to be canceled.
* There is no `server cipher order` for the daemon.

Finally, some of the tests are for `http\s` servers, so whey are being skipped.

I didn't use `tlsfuzzer` because it's still under development, has no documentation and doesn't compatible with an automated test-run."
403974929,196,DjLegolas,2018-07-10T21:40:02Z,"> Impressed with the additional tests but not sure about extra test time. Perhaps not run these by default

Yeah, I know. As a fix for `pytest`, I've added a new `toxenv` only for the security tests and set the main test run to ignore it.
The problem is going to be with `trial` run, as currently it tests everything with no option to split the tests... Please write if you know of any way to do it."
404093153,196,cas--,2018-07-11T08:46:54Z,"You could set an env var and skip the tests if not set

```python
SECURITY_TESTS = bool(os.getenv('SECURITY_TESTS', False))

if not SECURITY_TESTS:
    skip = 'Skipping security tests'
```"
408443867,196,DjLegolas,2018-07-27T14:56:00Z,"> Can the testssl package be removed from the code and downloaded by tox. The tests would also need to be skipped if testssl.sh is missing.

It can be done, but this will extend the running time of the test as we need to download 2 files, `testssl.sh` and `etc.tar.gz`, and extract the later (or download everything from its [repo](https://github.com/drwetter/testssl.sh/releases) and then extract).

To do so, I'll need to add to `commands = ` the commands to download and extract the files, right?"
410463247,196,cas--,2018-08-04T17:02:56Z,"> To do so, I'll need to add to commands = the commands to download and extract the files, right?

Actually, I just realised that the code should be downloaded by travis instead in `install` section. Tox is for setting up a python test env so we should specify in the documentation that testssl.sh is a requirement.

Use whatever is the simplest way to install the files, using the releases seems like a good idea. 

To deal with the time penalty I intend to only run these security tests either manually or with commits on the `develop` or `master` branch. So not PRs or other branches. Another idea so you can run them in a PR is to include something like the word `SECURITY_TEST` in the commit message."
412133089,196,cas--,2018-08-10T16:20:14Z,This is looking great and I think nearly ready for merging? Did you want to squash the commits and also test out the travis keyword in commit message?
419192709,196,cas--,2018-09-06T18:18:36Z,Thanks! Merged
211376089,67,bendikro,2016-04-18T13:19:24Z,"Are there any unresolved issue left?
"
211434266,67,cas--,2016-04-18T15:33:55Z,"Merged in develop: 47f14845ca
"
1025081351,354,gazpachoking,2022-01-30T06:34:16Z,"So, I guess I'd better ask, because this turned in to a much bigger thing than I thought. Are we in to this? @cas-- @aresch ?

I think it's probably worth it in the long run if I can get things cleaned up a bit more. Right now it's a mix of manually redone tests that are nice, some things that I change only just enough to work, and some in between. I have found multiple cases of tests that were broken, (passing, but not testing the thing they thought they were,) and even some where the thing they thought they were testing was broken. I think getting closer to pure pytest (with pytest-twisted) is much nicer, and converting some of the convoluted test subclasses into composable fixtures would be pretty nice."
1025082447,354,aresch,2022-01-30T06:45:09Z,I don't have much of an opinion on this besides that I like pytest and moving to using it makes sense to me.
1025193177,354,gazpachoking,2022-01-30T17:43:02Z,Looks like many of the pytest features don't work well with unittest test classes either. Some of the broken tests were because inlineCallbacks methods eat Exceptions if used in a unittests.TestCase class. Working on ripping that out completely.
1026261440,354,aresch,2022-01-31T22:09:12Z,"I've skimmed through most of this (it's too large to review too deeply) and it looks fine to me. Using pytest and removing some dependency on Twisted seem like good things to me. I'll defer to @cas-- if he has any issues with this.

LGTM"
1027523993,354,gazpachoking,2022-02-02T02:46:24Z,"My commits were not in meaningful chunks, and mostly had bad messages, so I squashed this down."
1029063441,354,cas--,2022-02-03T14:46:47Z,"@gazpachoking You know I recently watched a [talk by Raymond Hettinger](https://youtu.be/voXVTjwnn-U?t=1861) where he described a new Python core developer arriving and refactoring the entire test suite, causing unintended headaches...

I'm not saying this is not a good idea, it's just a notable coincidence  :stuck_out_tongue_closed_eyes:  "
1029120409,354,gazpachoking,2022-02-03T15:41:36Z,"> @gazpachoking You know I recently watched a [talk by Raymond Hettinger](https://youtu.be/voXVTjwnn-U?t=1861) where he described a new Python core developer arriving and refactoring the entire test suite, causing unintended headaches...
> 
> I'm not saying this is not a good idea, it's just a notable coincidence ðŸ˜

I'm happy to step back on any of these things if I'm stepping on toes or it's likely to break stuff. I'm exactly that guy that's exited to contribute that Hettinger was talking about, and I do think I'm making improvements, but let me know when I'm trampling on your flower garden. ðŸ˜ I have noticed several bits where the test/docstring doesn't do what it says on the tin, but that are delicate because there might be places depending on them working the way they do, even if the current way is 'wrong.'

Specifically on these test rewrites... there is stuff that doesn't work right when mixing unittest and twisted.trial into pytest. I think it's worth it to excise those tools in favor of pure pytest."
1029466121,354,cas--,2022-02-03T22:36:53Z,"@gazpachoking This is fantastic work, thanks. I included a modified version of your PR description in the commit message, it's really useful!
"
1040843284,376,doadin,2022-02-15T22:05:53Z,@cas-- @DjLegolas  This might help/be related to  [#3505](https://dev.deluge-torrent.org/ticket/3505) . Either way it is an improvement since ipv6 was not supported before. If you guys could review thanks!
1040893174,376,doadin,2022-02-15T23:15:59Z,"> Looks good. I looked into that ticket, but the issue is on the console side (getting the port as str, when the func expects int).

@DjLegolas Ah, ok I thought maybe it had to do with ipv6 having letters possibly or something like that. I'm not very good with naming but updated for part of the change you and  @aresch suggested. Thanks guys!"
1041403701,376,doadin,2022-02-16T11:44:29Z,@cas-- Honestly I don't follow half of what you said in reviews.
1041406329,376,cas--,2022-02-16T11:48:00Z,@doadin It was a quick review but I can clarify where you need
1045329134,376,doadin,2022-02-18T23:13:00Z,@cas-- Thanks!
405041974,204,DjLegolas,2018-07-14T18:37:42Z,"I have a dilemma as to whether to include the credits and/or license or not because they contain relatively a lot of information that I am not sure if it is necessary to include.
Of curse, it's still under develop, but mostly because of this dilemma. The main `About` window is finished and only needs a toolbar icon."
405082674,204,cas--,2018-07-15T10:48:54Z,"The About should contain a short amount of information as it is a pain to maintain otherwise.

We have all the detailed information in the source code, which is sufficient for now. Therefore I would credit writing the application to the Deluge Team and leave out the translation authors (it's pretty outdated anyway). The licence can be something like `GPL v3.0 or later`. Properly including it all in documentation might be useful in future as a central resource to point to."
405082695,204,cas--,2018-07-15T10:49:16Z,Could you include a screenshot?
405090220,204,DjLegolas,2018-07-15T12:54:33Z,"Connected | not connected
-|-
![about_connected](https://user-images.githubusercontent.com/6710676/42734076-5a880c80-8846-11e8-9eaa-6fb0cfaff101.PNG) | ![about_not_connected](https://user-images.githubusercontent.com/6710676/42734077-5abaaca8-8846-11e8-9308-1faca7350cba.PNG)

As you can see, I tried to make is as close to the one in the GTK. This is why I wanted to know about the credits and license."
405722542,204,DjLegolas,2018-07-17T20:48:14Z,Any ideas why the tests are failing?
405733846,204,cas--,2018-07-17T21:27:48Z,"Seems the new javascript has broken slimit:
https://travis-ci.org/deluge-torrent/deluge/jobs/404317349#L607

On 17 July 2018 at 21:48, DjLegolas <notifications@github.com> wrote:

> Any ideas why the tests are failing?
>
> â€”
> You are receiving this because you commented.
> Reply to this email directly, view it on GitHub
> <https://github.com/deluge-torrent/deluge/pull/204#issuecomment-405722542>,
> or mute the thread
> <https://github.com/notifications/unsubscribe-auth/AAk_VqJIV2bJdkZaCzCPTwVFxebV6dj5ks5uHk2PgaJpZM4VP9A5>
> .
>
"
427274129,204,DjLegolas,2018-10-05T07:38:07Z,"Ok, I want to finish this feature...
@cas--, is it fine if i'll remove the credits window, and set the License to [LICENSE](https://github.com/deluge-torrent/deluge/blob/develop/LICENSE) file?"
427281084,204,cas--,2018-10-05T08:06:29Z,Yes removing credits is fine and I don't think we need the license one either. I don't see it being of use for end-users.
427375876,204,cas--,2018-10-05T14:00:22Z,"Fyi: If you rebase on develop, install [pre-commit](http://pre-commit.com/) and use:

    pre-commit run --all-files

That will format the python with black and js with prettier.

To have it run on the git commit files everytime using git hooks, use the install command:

    pre-commit install

I am writing some docs to better explain the setup ;)"
427425086,204,DjLegolas,2018-10-05T16:33:03Z,"Hmm, @cas--, looks like something is missing...
When I tried running it, I got an error: 
```
An error has occurred: InvalidConfigError:
=====> D:/progrmming/python/deluge\.pre-commit-config.yaml does not exist
```"
427445953,204,cas--,2018-10-05T17:46:55Z,Yeah I only just added today: 0548bdb6 :stuck_out_tongue_closed_eyes: 
427613735,204,DjLegolas,2018-10-06T23:34:24Z,"LOL, OK. ðŸ˜‚

2 things...
1. Is there any quick way to get the connected server hash ID?
I want to get its version number, but can do so only with `deluge.client.web.get_host_status`, which requires the server ID...
2. Do you know who controls the bots of github and trac on IRC? They are both out of the main room and, therefor, no info is shown when publishing stuff."
427680511,204,cas--,2018-10-07T19:37:23Z,"1. The `host_id` is not readily available other than parsing the `web.get_hosts` for `host_id` with `connected` status. If you are looking for the version then using the rather obscure RPC method `client.daemon.info` returns the version of the currently connected daemon.

2. If you mean drizzle bot that's a deluge service that I maintain... I haven't been on IRC recently so didn't notice that need to be registered to join the channel now. The bot is now registered and hopefully will spam the channel once more ;) I think the github one was gazpachoking's but that's just a guess."
427685901,204,DjLegolas,2018-10-07T20:51:29Z,"Ok, interesting, but I didn't find a way to get this method to execute through the WebUI. Am I missing something? Is there another way to send RPC commands?

Currently, I'm doing something similar to what the ConnectionManager is doing (get the list of all configured servers and for each on of them, check if the client is connected to it and get its version)."
427692017,204,cas--,2018-10-07T22:19:44Z,"Ah it looks like some extra methods won't be allowed by the `json_api` because they are not actually in the RPCServer registered methods list. It probably would make sense to export a version method in daemon:

```diff
diff --git deluge/core/daemon.py deluge/core/daemon.py
index 84c4514a1..ebb30de2f 100644
--- deluge/core/daemon.py
+++ deluge/core/daemon.py
@@ -182,6 +182,10 @@ def get_method_list(self):
         """"""Returns a list of the exported methods.""""""
         return self.rpcserver.get_method_list()
 
+    @export()
+    def get_version(self):
+        return get_version()
+
     @export(1)
     def authorized_call(self, rpc):
         """"""Determines if session auth_level is authorized to call RPC.
```"
427732498,204,DjLegolas,2018-10-08T06:30:07Z,"Yep, this will do the trick.

BTW, do you have an idea for an icon to add to the `About` button itself?"
430182874,204,cas--,2018-10-16T10:16:31Z,What do you think about using the Deluge icon and text on the left-hand side as the button to show about? 
430225581,204,DjLegolas,2018-10-16T12:53:29Z,"Like this?
![deluge-web-about](https://user-images.githubusercontent.com/6710676/47017594-58fced00-d15b-11e8-9e88-8852f0d8ed12.PNG)
"
430249215,204,cas--,2018-10-16T14:01:35Z,Actually mean making Deluge clickable and popping up the about dialog
430309003,204,DjLegolas,2018-10-16T16:40:06Z,"Ok, I think all of the work is done."
431675849,204,cas--,2018-10-21T14:58:35Z,"Thanks, merged"
1023694782,352,aresch,2022-01-27T22:19:37Z,This would probably break plugins?
1023704726,352,aresch,2022-01-27T22:35:24Z,"By the way, here is some history when I went down a somewhat similar path in the past: https://dev.deluge-torrent.org/ticket/3207"
1023711809,352,gazpachoking,2022-01-27T22:48:06Z,"> This would probably break plugins?

Hmm, probably right, I'll look closer at that. They can access more stuff than just the `@export`ed methods, right?



> By the way, here is some history when I went down a somewhat similar path in the past: https://dev.deluge-torrent.org/ticket/3207

I'll take a peek at that.

I'm thinking given these issues, maybe the nicest compromise is to make a decorator that calls ensureDeferred, and wrap any converted functions in it, just like we would with inlineCallbacks. It wouldn't give us all the advantages of async/await, but it would ensure full compatibility with everything existing, while letting us use that syntax within the wrapped functions. I don't think that method has any disadvantages compared with inlineCallbacks either."
1023818698,352,gazpachoking,2022-01-28T02:11:20Z,"Okay, I added the ensure_deferred decorator, which will let us keep using the wrapped async functions as normal functions returning deferred. I'm investigating whether there's something clever to do that will dynamically remove the wrapping if called directly from another async function, but it might be a bit too magicy, (or not work at all,) we'll see."
1023903263,352,gazpachoking,2022-01-28T05:36:42Z,"I may have just created a best of both worlds situation. I modified the `ensure_deferred` decorator to only call `ensureDeferred` in situations where the function was not being used like a coroutine function. This means in works exactly like an `inlineCallbacks` function, _unless_ it is called from within another async function, in which case it acts like a plain coroutine. This means in areas where we've converted the whole chain to async functions we'll get nice tracebacks, without breaking compatibility with places still using legacy twisted deferred syntax.

I'm really quite excited with this solution, but it probably needs a bit more testing before I can tell if there are any weird idiosyncrasies that make it sub-optimal.

@aresch @cas-- How do you feel?

example:
```python
@ensure_deferred
async def test():
    print('something')

@ensure_deferred
async def outer():
    await test()  # This works
    test()  # This also works  (â˜‰_â˜‰)

d = test()  # yep, works here too
d.addCallback(someotherfunc)  # totally fine
```
"
1023906260,352,gazpachoking,2022-01-28T05:44:55Z,"Hmm. Might be some issues still. Gtkui doesn't seem to be working.
EDIT: Oh, that might just be from importing reactor too early and having the default one installed instead of the gtk one.
EDIT2: Yep, that was the issue."
1024323283,352,gazpachoking,2022-01-28T15:22:19Z,"I 'm pretty excited about this method, I'm hoping there are no caveats I'm failing to see at the moment. A couple questions though:
- Location: is decorators the right spot to put it? I guess so..
- Naming: It isn't really ensuring the result is a deferred anymore, I'm not sure if there is a better name."
1024437407,352,aresch,2022-01-28T17:19:29Z,"This PR kind of scares me. I feel like it's warping the definitions of both coroutines and deferreds into a bit of a mess that might not be easy to reason about. Being able to call a ""coroutine"" without await seems weird to me. There is also no async loop created, so how would a regular coroutine even work? Are you planning to install the asyncreactor?"
1024483689,352,gazpachoking,2022-01-28T18:10:44Z,"> This PR kind of scares me. I feel like it's warping the definitions of both coroutines and deferreds into a bit of a mess that might not be easy to reason about. Being able to call a ""coroutine"" without await seems weird to me. There is also no async loop created, so how would a regular coroutine even work? Are you planning to install the asyncreactor?

async/await is just a language feature separate from asyncio. I'm not involving asyncio at all in this PR, this is all still pure twisted. Twisted allows using the async/await syntax, which under the hood works almost exactly the same as using inlineCallbacks on a generator function. https://twistedmatrix.com/documents/16.4.1/core/howto/defer-intro.html#coroutines-with-async-await

Once an async function is wrapped in ensureDeferred, it can feel free to call other coroutines that aren't wrapped in ensureDeferred, as the outer most wrapping will handle the whole thing. This is desirable, because wrapping every level of coroutines in ensureDeferred mangles tracebacks, (not any more than they are now, but that is one of the nice benefits of async/await vs inlineCallbacks.) For us though, since we have a lot of places calling in to our functions, including plugins we might not control, leaving unwrapped coroutines would break any place that called it without the await keyword. The magic I've added here allows coroutines to be left unwrapped by ensureDeferred _only_ in the case where it's being called from another function that already has that wrapping. When used outside of an `await` statement, the ensureDeferrred wrapper is automatically added, making the coroutine into the excact same thing as an `inlineCallbacks` wrapped generator.

I'm still not 100% sure there aren't side effects, I'm trying to trace down the CI failures now to see what's going on with them, but at the moment I suspect it's because I've subtly changed the logic of component.start, and nothing to do with the new syntax."
1024492113,352,gazpachoking,2022-01-28T18:22:25Z,"> Being able to call a ""coroutine"" without await seems weird to me.

In this case, it turns into the same thing as running a function that returns a deferred.
```python
@inlineCallbacks
def a():
    yield defer.succeed(1)
    print('doing something')

a()

@ensure_deferred
async def b():
    await defer.succeed(1)
    print('doing something')

b()  # acts exactly the same as a()"
1024617769,352,aresch,2022-01-28T20:37:18Z,Thanks for the clarification. I guess I don't understand why the example with b() is preferable to a()?
1024626240,352,gazpachoking,2022-01-28T20:51:39Z,"> Thanks for the clarification. I guess I don't understand why the example with b() is preferable to a()?

A couple things I was shooting for:
1. get closer to a syntax where we could one day switch from twisted to asyncio
2. await is a bit nicer than yield for a few things, for example you can't:
    ```return yield d``` or ```callafunc(yield d)```, but you can with await
2. Improve tracebacks. With inlineCallbacks, (or regular callbacks,) the traceback doesn't show you the line that called `yield a_deferred` as the caller. When chaining awaits, it does.

Of these, 1 and 2 can be achieved by just creating a decorator that calls twisted's ensureDeferred which we wrap any functions we convert to async in. 3 is only achievable when the chained awaits only have the outermost coroutine wrapped. For this, we either need to convert everything at once, including plugins, or use something like the CoroDeferred that I made."
1024642018,352,gazpachoking,2022-01-28T21:17:26Z,"Man, I'm really struggling to figure out what's up with the CI failures. It looks like something happens to the daemon where it doesn't write the localclient account to the auth file. It doesn't happen every time though, and I can't figure why. Also can't figure how my current changes could cause this."
1024655648,352,aresch,2022-01-28T21:29:47Z,Perhaps you could write some tests for CoroDeferred and the wrapper?
1024815648,352,gazpachoking,2022-01-29T02:49:20Z,"> Perhaps you could write some tests for CoroDeferred and the wrapper?

https://github.com/gazpachoking/deluge/blob/maybe_coroutine/deluge/tests/test_maybe_coroutine.py

I should probably stop making new branches. ðŸ˜  Perhaps the usage in those tests makes it more clear what I'm going for, and how it works? I'm sure there is other stuff to be tested, but can't figure it right now. "
1024817640,352,aresch,2022-01-29T03:01:36Z,"Yeah, I was just suggesting it as a way to hunt down any edge cases that may be causing the CI failures."
1024835976,352,gazpachoking,2022-01-29T05:04:10Z,"Man, the converting componentregistry.start is really stumping me. I tried just regular inlinecallbacks and it has the same issue of sometimes not working."
1024844177,352,gazpachoking,2022-01-29T06:03:36Z,"I finally figured it out. The components need to be loaded in a certain order which isn't encoded fully in their 'depends'. I don't know exactly which order breaks things, but when I forced them to go in the same order as before I made any changes to the start function (by making each one depend on the next) it works every time."
1024926487,352,gazpachoking,2022-01-29T14:55:45Z,"And now I think I actually understand _why_ the order is important. The tests wait for the message 'Finished loading' to consider the daemon started. This means only that the TorrentManager component has loaded. It doesn't guarantee that the AuthManager and RPCServer has started, so if the client tries to connect before they have started there are issues.

EDIT: Upon further investigation, it's just the AuthManager not being started before the tests continue that messes things up. The RPCServer actually starts on init, and never needs the component to actually be 'started' to work."
1027599507,352,gazpachoking,2022-02-02T05:28:02Z,"Closing this. I'll do similar refactoring, but on top of maybe_coroutine PR if/when that goes in."
403991746,201,DjLegolas,2018-07-10T22:56:58Z,"> I don't see anything for TLS SNI which was in the original code

The default behavior is a browser-like HTTPS handler, so this should be covered by default. But to be sure, do you know of any site that uses cloudflare so we could test?"
404098153,201,cas--,2018-07-11T09:03:31Z,"From that ticket, I think https://www.seo.com/ is still a usable test case"
404160727,201,DjLegolas,2018-07-11T13:02:12Z,"Oh, ok. `seo.com`'s works only with browsers with SNI support.
So I added it to the icon tests as it will show us the code ability to use it and download a file from it.
As you can see, the test passes."
405085695,201,cas--,2018-07-15T11:47:14Z,Thanks! Merged with some minor changes applied: c7e61f8c3461d59b5
1030711888,364,DjLegolas,2022-02-05T23:05:33Z,Seem as there is no way to test on python3.6 because there is no libtorrent binding to 3.6 for windows or linux...
1030714505,364,doadin,2022-02-05T23:36:53Z,"imo 3.10 has been working nicely, I think we could change this from 3.7-3.10."
1030882530,364,DjLegolas,2022-02-06T17:59:28Z,"I'm thinking about upgrading the minimum python version, again, to 3.7 and run the CI on all the supported versions (3.7-3.10)...
@cas-- @gazpachoking @aresch what do you guys think?"
1030898094,364,gazpachoking,2022-02-06T19:29:33Z,"I'm ðŸ‘ on dropping 3.7 support. Not sure when we'd want to fit that in in terms of versioning and releases. In terms of this PR, I'd say testing more than one version is an improvement, regardless of whether it hits every currently supported version. I'm also ðŸ‘ on adding in other versions up to 3.10"
1030925363,364,doadin,2022-02-06T22:12:33Z,"should also maybe add 
```
    strategy:
        fail-fast: false
```"
1030926702,364,DjLegolas,2022-02-06T22:19:13Z,"While testing, it helps having everything fail fast.
But will add that flag later, thanks @doadin "
1030928157,364,doadin,2022-02-06T22:27:24Z,3.10 needs pytest >= 6.2.5 I think.
1030929311,364,doadin,2022-02-06T22:34:45Z,"https://github.com/deluge-torrent/deluge/blob/develop/requirements-tests.txt#L1
pytest == 6.2.5 ; python_version >= '3.10'
pytest != 5.2.3, < 5.4
maybe"
1030930034,364,DjLegolas,2022-02-06T22:39:02Z,"No, I'll just drop the limits from `pytest`...
It worked on my local Windows and Ubuntu, both with python 3.8."
1030932760,364,DjLegolas,2022-02-06T22:56:09Z,"To sum this up:
* Testing python versions 3.7-3.10
* Switched `libtorrent`'s installation source to `pypi`
* Dropped `pytest` version limits, current version is `7.0.0` for python 3.10 (thanks @doadin for the heads up)"
1033068452,364,doadin,2022-02-08T21:14:53Z,"I am noticing a few things we use like twisted in a coming version is droping python3.6 and pyinstaller, Pillow already has, could probabbly drop 3.6 our selves as well. if it was only pyinstaller then id say no but deps are starting to drop as well. At least on the windows side requiring 3.7+ only excluded windows xp I think which nobody should still be using so not really a big deal imo."
216035118,83,cas--,2016-05-01T11:09:02Z,"Note to self: this fix should be backported to 1.3
"
217576929,83,cas--,2016-05-06T22:15:44Z,"Could you please rebase with latest `develop` branch and fixup into a single commit. See [commit message convention](http://dev.deluge-torrent.org/wiki/Contributing/CodingStyle#GitCommitMessages)
"
217677485,83,Tanz0rz,2016-05-07T23:48:19Z,"I looked at that link you sent me, but it doesn't talk about commit messages at all.
"
217704453,83,cas--,2016-05-08T08:56:35Z,"That's because I moved the text yesterday to [GitTips](http://dev.deluge-torrent.org/wiki/GitTips#CommitMessages)
"
218065421,83,Tanz0rz,2016-05-10T05:52:51Z,"Alright. Commit rebased and commit message cleaned up. Let me know if anything needs to be improved.
"
218090873,83,cas--,2016-05-10T08:25:35Z,"I'm afraid the commit title is not correct, it shouldn't start with a dash `-`. It also doesn't follow the same convention of existing [develop commits](https://github.com/deluge-torrent/deluge/commits/develop). I did leave a hint when I renamed the title of this PR as to the wording so something like this would be more appropriate:

`[AutoAdd] Fix watch directory accepting torrent files with uppercase extension`

As mentioned in GitTips, you don't need to mention the log line addition as it's self-evident. 
"
218661538,83,Tanz0rz,2016-05-12T05:08:54Z,"Reworded again.
"
218815746,83,cas--,2016-05-12T16:44:14Z,"Merged 50d504a38f57684e
"
164834865,50,bendikro,2015-12-15T17:29:33Z,"Fixed a new issue that (for some odd reason) appeared in sessionproxy tests due to time.sleep calls.

Starting to look mergable I think.
"
446122590,228,DjLegolas,2018-12-11T08:57:39Z,"Can you fix the failed test (regarding coding style)?
In addition, please try to add a test for this."
446626530,228,hukal,2018-12-12T15:24:24Z,"> Can you fix the failed test (regarding coding style)?
> In addition, please try to add a test for this.

Thanks for the feedback @DjLegolas.

A few minor questions:
1. unit test.
I didn't find anything related to console commands. Based on the naming ""test_ui_console_fields.py"" should cover something, but it's almost empty.
Did I miss something or I just need to write it from scratch?

2. Coding style.
Based on Travis log I see that Black formatter failed.
Is it the right one? Should I run it with default config?
For example, in their [playground](https://black.now.sh/?version=stable&state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4ARXAmpdAD2IimZxl1N_WlkPinBFoXIfdFTaTVkGVeHShArYj9yPlDvwBA7LhGo8BvRQqDilPtgsfdKl-ha7EFp0Ma6lY_06IceKiVsJ3BpoICJM9wU1VJLD7l3qd5xTmo78LqThf9uibGWcWCD16LBOn0JK8rhhx_Gf2ClySDJtvm7zQJ1Z-Ipmv9D7I_zhjztfi2UTVsJp7917XToHBm2EoNZqyE8homtGskFIiif5EZthHQvvOj8S2gJx8_t_UpWp1ScpIsD_Xq83LX-B956I_EBIeNoGwZZPFC5zAIoMeiaC1jU-sdOHVucLJM_x-jkzMvK8Utdfvp9MMvKyTfb_BZoe0-FAc2ZVlXEpwYgJVAGdCXv3lQT4bpTXyBwDrDVrUeGOv9m6arhq1vG7gWPofCZzxDVx0XQ0KCGfeks9pc70MAN8zhKZ6WetjhhiFk0PFeo7NMDYe-NfEPd456oNx_KEYz45C3iEE079hLkn6kCYcxJhK3e2MeoPjq1ltI_IjvN_GUYGOGAcLksDFVlmUi-Qk0VTjDc_gzn9wl5Zd1DEs95RC0tBpR1sWvObLHIBZfrKPs047wg-CyszAR-Nh623eoU53wQRTDDzY9w3nG2rVxJNJto5ujL2ARY2w0c0IKUV_WC8HaFUy521komcC_6bE7Uq25H0d__LSj8qaCaFAO9LqMcso3A7tsEpx4-UmXBrUcHibDMQBXm0D1vGkQ8eUljUnR0TMF9NVWy5ntN1T2br3qAWqQK44I8H6kI00gZXWfQIfYHALh7cqfgti0L9Xy3Us2cCsgvD2OioBjVncxYkBm4Y5hVV5g63AAAAAECQA3Mo3QbFAAGGBdgIAACmbK8uscRn-wIAAAAABFla). 
I didn't find anything about this formatter at https://dev.deluge-torrent.org/wiki/Contributing/CodingStyle
 
Thanks"
446678831,228,DjLegolas,2018-12-12T17:47:39Z,"I'll start with the failed test: The current coding style is new and is being validated with a dedicated test.
It is something @cas-- added some time ago.
The best way to check this, is to install `tox` and run `tox -e lint`. It will run the same test and, IIRC, modify the file as needed (note: don't run only once, but after each fix).

About adding new test, you are correct.. There are no tests for the console ui... So just start one from scratch, and test only what you added for now.
You can ask here for help.

And look at the [running tests](https://deluge.readthedocs.io/en/develop/contributing/testing.html) docs.

Finally, you closed this PR ðŸ˜†"
449819698,228,DjLegolas,2018-12-25T07:56:20Z,"A little update, there are tests for the Console.
Look at the `test_ui_entry.py` file. In it there are most of the UI entry tests, including `ConsoleUIBaseTestCase` class, which tests some the Console's functionality."
449869359,228,hukal,2018-12-25T19:24:33Z,"> A little update, there are tests for the Console.
> Look at the `test_ui_entry.py` file. In it there are most of the UI entry tests, including `ConsoleUIBaseTestCase` class, which tests some the Console's functionality.

Thanks for the hint @DjLegolas and sorry for the delay with this pull request. I was busy with some personal stuff.

I've pushed the tests to make sure the parser works correctly.
But I'm still struggled with the entire flow test.
I want to write a test which ""simulates"" torrent download and checks that the file was moved in the specified folder.
Once I find a way to do it, I suppose it should be ""enough coverage"". 

"
452417917,228,hukal,2019-01-08T19:15:09Z,"Hi @DjLegolas ,
I've fixed inheritance and naming.
But it looks like I can't find a proper way to make an end to end test.

Things I have tried:
1. Directly call `handle` method of `Add` command.
In this case I'm getting _""ConsoleUI component is not registered""_ error.
Event if I register it (mock?) I can't do anything since `Add` command requires daemon.

2. In `test_ui_entry.py` we have `test_console_command_status` which works with daemon.
I was able to make a similar one to test 'add' command but this command returns only ""Torrent added"" without any id/hash. Due to this fact I can't validate the file in the way it validated in `test_add_torrent_file` from `test_core`.

3. In addition to  point 2 I've tried to run `status` command right after `add` in one method. (I was hoping to grep hash from there). It also caused errors. (Am I correct that current test structure supports 1 console call per method?)

Could you please advise how to test it?

Thanks"
452420910,228,hukal,2019-01-08T19:24:16Z,Build failed but I didn't change plugin configurations...
452908155,228,DjLegolas,2019-01-09T23:26:17Z,"I was trying to implement this myself, and as you wrote - there is some kind of problem.
I'll start with your 3rd point: there is a way to concatenate commands, and it's done by using a semicolon, `;`, between the commands and wrapping the entire phrase with apostrophes.

As for the 1st issue, I agree with you, as it will be best to use the daemon itself.

And now for the final part, the 2nd: 
As I stated in the first line, I tried to solve it too. For now, I wasn't able to solve this yet.

During my many tries, I tried sending only one command. The structure of this command is:
`deluge-console ""add --completed /tmp /some/path/to/torrent/file.torrent ; manage torrent-hash-id move_completed move_completed_path""`

This should have added the torrent and report back the values configured via `--completed` arg.
But I received only the `Torrent added!` message without the info I requested. I suspect the problem is that the `manage` command being processed before the torrent was added, so I tried to split the command into two parts, the add part and the testing-values part. But this gave me some other errors which I wasn't able to solve, yet.

Currently, when running this test, it throws a `ComponentAlreadyRegistered` exception about `ConsoleUI` when reaching the second `yield self.exec_command()` call.
@cas--, @aresch, @bendikro  - Do you guys have any recommendations, ideas or suggestions?

This is what I have done until now:
```python3
@defer.inlineCallbacks
def test_console_command_add_completed(self):
    # add new torrent with the --completed arg
    filename = common.get_test_data_file('test.torrent')
    username, password = get_localhost_auth()
    self.patch(
        sys,
        'argv',
        self.var['sys_arg_cmd']
        + ['--port']
        + ['58900']
        + ['--username']
        + [username]
        + ['--password']
        + [password]
        + ['add --completed /tmp ' + filename + ' ; quit'],
    )
    fd = StringFileDescriptor(sys.stdout)
    self.patch(sys, 'stdout', fd)

    yield self.exec_command()

    std_output = fd.out.getvalue()
    print(std_output, file=sys_stdout)
    self.assertTrue(std_output.endswith('Torrent added!\n'))

    # get the values of move_completed and move_completed_path
    self.patch(
        sys,
        'argv',
        self.var['sys_arg_cmd']
        + ['--port']
        + ['58900']
        + ['--username']
        + [username]
        + ['--password']
        + [password]
        + ['manage ab570cdd5a17ea1b61e970bb72047de141bce173 move_completed move_completed_path'],
    )

    yield self.exec_command()

    std_output = fd.out.getvalue()
    print(std_output, file=sys_stdout)
```"
453530362,228,DjLegolas,2019-01-11T14:17:47Z,"Ok, I managed to run the test by adding a call to `status` command between `add` and `manage` commands. In addition, I added a test for the `add` command itself.
Changes pushed it to @hukal fork.
I'm sure it's not the best way to handle this, but for now it will do. I hope ðŸ¤£"
453855070,228,hukal,2019-01-13T18:46:07Z,"Thanks @DjLegolas !
I've checked the tests locally - all green.
I'm only getting a warning: 
`common.py:270: PendingDeprecationWarning: dist() and linux_distribution() functions are deprecated in Python 3.5`
My local env is on Python 3.6.7"
453856012,228,hukal,2019-01-13T18:58:43Z,"@DjLegolas Build error, again.
`INTERNALERROR> PluginValidationError: unknown hook 'pytest_namespace' in plugin <module 'pytest_twisted' from 'c:\projects\deluge\.tox\py27\lib\site-packages\pytest_twisted.py'>`
Is it because of my changes?"
454109175,228,DjLegolas,2019-01-14T18:26:29Z,"1. Yeah, `platform.dist()` and `platform.linux_distribution()` were marked as depricated in version 3.5 and are will be removed on 3.8.
2. It is an issue with `pytest-twisted` version `1.8.0` with `pytest 4.1` . We will have to wait till the next release to run the tests here."
454123510,228,hukal,2019-01-14T19:07:35Z,"OK, let's wait. Thanks!"
481831520,228,DjLegolas,2019-04-10T19:33:19Z,@cas-- What do you say? Want to merge this?
483328519,228,cas--,2019-04-15T16:41:44Z,"It looks good, I will get around to reviewing and merging :+1: "
491545712,228,cas--,2019-05-11T21:37:23Z,"Thanks for this and the test :+1: 

I have made some changes (-m instead of -c) and merged it: f885edd7fc85f


"
219020900,93,cas--,2016-05-13T11:43:11Z,"Perhaps I should simply update core attribute in tm.on_alert_external_ip: `component.get(""Core"").external_ip = external_ip` rather than register event in core...?
"
219092510,93,aresch,2016-05-13T16:27:00Z,"I think that you're currently doing it the right way.  Directly updating
the core attribute would feel like it breaks encapsulation.

On Fri, May 13, 2016 at 4:43 AM, Calum Lind notifications@github.com
wrote:

> @aresch https://github.com/aresch Perhaps I should simply update core
> attribute in tm.on_alert_external_ip: component.get(""Core"").external_ip =
> external_ip rather than register event in core...?
> 
> â€”
> You are receiving this because you were mentioned.
> Reply to this email directly or view it on GitHub
> https://github.com/deluge-torrent/deluge/pull/93#issuecomment-219020900
"
219305167,93,doadin,2016-05-15T19:23:44Z,"would it not be wise to maybe add a prefference for showing this? What if someone has other plugins that use status bar and now they have to make the window bigger to see them or default ones they do want get pushed away. Just a thought. You also might be thinking well then just make it bigger but what about the users on small screens like the change to the add torrent dialog was for.
"
219307035,93,aresch,2016-05-15T19:58:11Z,"At one point I thought that including a Preferences page for the Statusbar
would be a good idea.  The user could toggle on/off the various
indicators/items.  Maybe that is what we need?

On Sun, May 15, 2016 at 12:23 PM, doadin notifications@github.com wrote:

> would it not be wise to maybe add a prefference for showing this? What if
> someone has other plugins that use status bar and now they have to make the
> window bigger to see them or default ones they do want get pushed away.
> Just a thought.
> 
> â€”
> You are receiving this because you were mentioned.
> Reply to this email directly or view it on GitHub
> https://github.com/deluge-torrent/deluge/pull/93#issuecomment-219305167
"
219307893,93,cas--,2016-05-15T20:13:55Z,"There is certainly an issue with the statusbar items setting the minimum width of the main window so a toggle for statusbar items or something similar would be nice. There should be an existing ticket that covers this issue.
"
219310062,93,cas--,2016-05-15T20:56:49Z,"This is the existing ticket: http://dev.deluge-torrent.org/ticket/1326
"
219327489,93,doadin,2016-05-16T01:05:37Z,"ah ok. yea i think like a prefferences page for status bar to add/remove items would be nice. maybe something simple like if checks to the gtk config around the statsbar create item or something more complex like status bar items registering like plugins. idk. glade to know its being thought about, though that ticket has been open for quite some time now lol.
"
214394493,62,cas--,2016-04-25T15:28:06Z,"A different question instead... could it perhaps be confusing using `argparse` and `OptionsParser` is the class in console?
"
214450845,62,bendikro,2016-04-25T17:29:21Z,"Yeah, can fix that
"
214475652,62,cas--,2016-04-25T18:44:14Z,"Added markup to help strings
"
215887139,62,cas--,2016-04-29T21:31:41Z,"There are the two tickets in 1.3.13 milestone that could also be addressed in this PR. Here is a query of outstanding [console tickets](http://dev.deluge-torrent.org/query?status=accepted&status=assigned&status=new&status=pending&status=reopened&component=Console+UI&milestone=!not+applicable&milestone=!2.0&col=id&col=summary&col=component&col=milestone&col=status&col=type&col=priority&order=priority)

Oh and a pylint [one](http://dev.deluge-torrent.org/ticket/2797) :D
"
256928213,62,cas--,2016-10-28T14:03:48Z,"Still not working with my [console.conf](https://gist.github.com/cas--/b8c9e3510223bacaf8bb757ff70ef074) and it looks like it because `sidebar_width` is a missed key in my config.

```
  File ""/home/ubuntu/delugeDev/deluge-console"", line 9, in <module>
    load_entry_point('deluge', 'console_scripts', 'deluge-console')()
  File ""/home/ubuntu/deluge.git/deluge/ui/console/__init__.py"", line 16, in start
    Console().start()
  File ""/home/ubuntu/deluge.git/deluge/ui/console/console.py"", line 116, in start
    do_profile=self.options.profile)
  File ""/home/ubuntu/deluge.git/deluge/common.py"", line 1065, in run_profiled
    return func(*args)
  File ""/home/ubuntu/deluge.git/deluge/ui/console/console.py"", line 110, in run
    return c.start_ui()
  File ""/home/ubuntu/deluge.git/deluge/ui/console/main.py"", line 156, in start_ui
    curses.wrapper(self.run)
  File ""/usr/lib/python2.7/curses/wrapper.py"", line 43, in wrapper
    return func(stdscr, *args, **kwds)
  File ""/home/ubuntu/deluge.git/deluge/ui/console/main.py"", line 224, in run
    torrentlist = self.register_mode(TorrentList(self.stdscr, self.encoding))
  File ""/home/ubuntu/deluge.git/deluge/ui/console/modes/torrentlist/torrentlist.py"", line 115, in __init__
    self.sidebar = FilterSidebar(self, self.config)
  File ""/home/ubuntu/deluge.git/deluge/ui/console/modes/torrentlist/filtersidebar.py"", line 33, in __init__
    width = self.config[""torrentview""][""sidebar_width""]
KeyError: 'sidebar_width'
```

If I delete `console.conf` I get this:

```
Traceback (most recent call last):
  File ""/home/ubuntu/delugeDev/deluge-console"", line 9, in <module>
    load_entry_point('deluge', 'console_scripts', 'deluge-console')()
  File ""/home/ubuntu/deluge.git/deluge/ui/console/__init__.py"", line 16, in start
    Console().start()
  File ""/home/ubuntu/deluge.git/deluge/ui/console/console.py"", line 116, in start
    do_profile=self.options.profile)
  File ""/home/ubuntu/deluge.git/deluge/common.py"", line 1065, in run_profiled
    return func(*args)
  File ""/home/ubuntu/deluge.git/deluge/ui/console/console.py"", line 110, in run
    return c.start_ui()
  File ""/home/ubuntu/deluge.git/deluge/ui/console/main.py"", line 156, in start_ui
    curses.wrapper(self.run)
  File ""/usr/lib/python2.7/curses/wrapper.py"", line 43, in wrapper
    return func(stdscr, *args, **kwds)
  File ""/home/ubuntu/deluge.git/deluge/ui/console/main.py"", line 218, in run
    self.config.run_converter((0, 1), 2, self._migrate_config_1_to_2)
  File ""/home/ubuntu/deluge.git/deluge/config.py"", line 519, in run_converter
    raise ex
KeyError: 'sort_primary'
```
"
257090182,62,cas--,2016-10-29T12:55:41Z,"The is a bug when switching filters in sidebar the topmost torrent gets hidden by the column header so you need to scroll up one.
"
257093512,62,cas--,2016-10-29T14:05:34Z,"I think it would be an improvement to change the selection and popup menu keyshortcuts. 
- Use `enter` to activate filter in sidebar
- Use `spacebar` to mark selections e.g. torrents

A few other notes:
- The Deluge version in topbar is unnecessary, creating an 'About' popup would be useful.
  - The 'Current Filter' text in topbar is not well placed currently and a bit superfluous. It would be better placed in the area aboved the sidebar. In fact even better is if the sidebar is hidden and revealed when pressing `left-arrow`. Something like this:
    ![deluge_console_idea](https://cloud.githubusercontent.com/assets/606038/19830252/a1b8eaee-9deb-11e6-9d6b-d2606a1025eb.png)
- Need an option to automatically connect to daemon. 
- Need a way to start console in commandline mode.

Help dialog issues:
- Pressing `h` in certain areas does nothing. e.g. connection manager, sidebar
- There is no mention of use `spacebar` in help. 
- The help guide is overly verbose. (I can rewrite it if needed)
- While in `help` you cannot open other dialogs straightaway. e.g. preferences

Bugs:
- [x] Pressing `o` on a torrent resulted in this error:

```
File ""/home/ubuntu/deluge.git/deluge/ui/console/modes/torrentlist/torrentactions.py"", line 128, in create_popup          
base_popup=kwargs[""base_popup""])
exceptions.KeyError: 'base_popup
```

There are other UI layout changes needing porting over from GTKUI but they can wait.
"
257094677,62,cas--,2016-10-29T14:30:53Z,"Other than the bugs and anything trivial the above changes can be detailed in a new ticket for future work so this PR can be merged sooner rather than later. I simply thought I'd record my train of thought while it was fresh :)
"
257119423,62,bendikro,2016-10-29T22:20:38Z,"> Use enter to activate filter in sidebar
> Use spacebar to mark selections e.g. torrents

I don't object to any such changes, however, simply changing to enter in the if test doesn't work, so I didn't look any further at how to solve that. However, it's worth to note that my idea is that, with PR6, it will be possible to have multiple states selected in the filter, which makes sense to use the space key for?
Maybe enter key would select currently marked and deselect any other currently selected?

> There is no mention of use spacebar in help.

No, I've fixed and reworked some the help text, but there is probably much left to be fixed.

> The help guide is overly verbose. (I can rewrite it if needed)

Yeah, I've reduced it somewhat, but it can certainly be refined some more.

> Need an option to automatically connect to daemon.

The help text does say ""These daemon connect options will be used for commands, or if console ui autoconnect is enabled."" but I haven't seen any _autoconnect_ functionality implemented for this.

> While in help you cannot open other dialogs straightaway. e.g. preferences

True

> Need a way to start console in commandline mode.

Good idea.

> Bugs:
> -   Pressing h in certain areas does nothing. e.g. connection manager, sidebar

Wouldn't call it bugs. More like non-implemented features :-)

> -  Pressing o on a torrent resulted in this error:
>   Fixed

Also fixed bug when switching filter
"
257148933,62,cas--,2016-10-30T12:44:05Z,"Created new tickets:

Help dialog improvements: [#2916](http://dev.deluge-torrent.org/ticket/2916#ticket)
Sidebar: [#2917](http://dev.deluge-torrent.org/ticket/2917#ticket)
Startup options: [#2918](http://dev.deluge-torrent.org/ticket/2918#ticket)
"
436420308,224,aresch,2018-11-06T21:47:00Z,"I would like to do more to improve the protocol, but it would require a bit more work that I'd like to wait to do until after the conversion to asyncio. I wanted to get these minor changes in before a 2.0 release though due to compatibility concerns of doing it post-release. I think it's reasonable to expect a break between beta releases.

The one major change I wanted to make was to introduce a handshake to the protocol on connection where we could exchange protocol version support between server and client, which would be used to negotiate the highest supportable version.

I'll fix up the remaining comments tonight."
437821591,224,cas--,2018-11-12T09:58:25Z,@aresch shall I merge this?
437934865,224,aresch,2018-11-12T16:02:43Z,"Yea, sure."
438122943,224,aresch,2018-11-13T03:46:44Z,Pushed in 043344b986013212a2ad5f51bc967810c5200c0c
557839558,224,gdm85,2019-11-23T22:42:18Z,"I am a bit late for some feedback however please note that there is an important difference between this protocol and the one originally used (https://github.com/deluge-torrent/deluge/blob/deluge-1.3.15/deluge/core/rpcserver.py):

* it is not possible anymore to encode and compress in a stream-fashion because the encoded length must be transmitted first (and thus known in advance)

This means clients will be less efficient with transmission of large requests as they will use more memory. It can be a sensible problem for embedded devices and similar use cases (Single-Board-Computers etc).

Also I observe that specifying the size is redundant as it is already guaranteed by zlib and rencode."
557899309,224,bendikro,2019-11-24T15:29:34Z,"@gdm85 
When did Deluge ever support stream-fashioned transmission of messages? And how does the current protocol increase memory usage? The entire message is required before it can be successfully decoded, isn't it?
The problem observed with the old protocol was that decompression would succeed even if the couple of last bytes of the message was missing. The result was that the last bytes were assumed to be the beginning of the subsequent message, resulting in failure to decode the message for ever."
557903472,224,gdm85,2019-11-24T16:17:23Z,"@bendikro the old version I provided URL for did support a **client** streaming the messages, regardless of what the server is doing.

> The entire message is required before it can be successfully decoded, isn't it?

No, you can start decoding rencoded-objects as soon as one rencode valid ""sequence"" has been decoded, and that does not require the full zlib buffer to be decompressed nor the full rencode message to be parsed.

> The problem observed with the old protocol was that decompression would succeed even if the couple of last bytes of the message were missing.

Do you have a Github issue for reference of this problem? zlib has an Adler32 checksum support (https://tools.ietf.org/html/rfc1950), you could have used that."
558276693,224,bendikro,2019-11-25T18:16:09Z,"@gdm85 
> the old version I provided URL for did support a client streaming the messages, regardless of what the server is doing.

Yes. But the new protocol only affects a client transmitting to the server, right? When receiving, the prefixed message length doesn't prevent the client from decoding on the fly, if that is desirable?

> > The entire message is required before it can be successfully decoded, isn't it?

> No, you can start decoding rencoded-objects as soon as one rencode valid ""sequence"" has been decoded, and that does not require the full zlib buffer to be decompressed nor the full rencode message to be parsed.

What exactly do you refer to as a valid rencode sequence? I assumed that referred to a serialized python object (`tuple(MESSAGE_TYPE, REQUEST_ID, PYTHON_DATA)`). In that case, you can't deserialize (decode) only parts of it? And how would that be useful anyways?
Say you're receiving the entire list of torrents (which is the largest message transmitted by deluge server). `rencode.loads` will not succeed until you have all the data transferred for that list. Or am I misunderstanding what you're saying?

> Do you have a Github issue for reference of this problem? zlib has an Adler32 checksum support (https://tools.ietf.org/html/rfc1950), you could have used that.

How does that help you to know the length of the transmitted message? You would still need to know when you have the complete message with the checksum at the end?

P.S.
I don't think we used github at that time. There might be some track-ticket."
558279945,224,cas--,2019-11-25T18:24:46Z,"Reference for the protocol changes in Deluge 2.0:

https://dev.deluge-torrent.org/wiki/Development/Vast_amount_of_torrents
https://dev.deluge-torrent.org/ticket/2116"
558381470,224,gdm85,2019-11-25T23:07:01Z,"> Yes. But the new protocol only affects a client transmitting to the server, right?

Yes. The server has always buffered the message before sending, so nothing changed in its implementation (but now even if one would want to rewrite it, it is constrained by the protocol).

@bendikro please note that this was my whole point (with the new protocol client must allocate a buffer for the whole message and cannot stream it down without such buffers), I mentioned it in case it was missed during the design of the new protocol. My tone should not be intended as a report of a major flaw, but as a report of what specifically is no more possible :relaxed: 

> `rencode.loads` will not succeed until you have all the data transferred for that list. Or am I misunderstanding what you're saying?

I was trying to say that at https://github.com/deluge-torrent/deluge/pull/224/files#diff-c3b99fa967416d0e136f56fc09b2c8edR130 (`zlib.decompress()`) a checksum verification could have already happened e.g. `rencode.loads` could only be called **after** the Adler32 checksum verification happened; however it turns out that Python ignores the header that signals the presence of a checksum (those checksum bytes, if enabled during compression, most likely end up in the ""unconsumed input"").

But even without a checksum, look at the python code:
* zlib decompression ends when a `Z_STREAM_END` is found: https://github.com/python/cpython/blob/a1ffad07195b8b976f8c371a92028240946d4e76/Modules/zlibmodule.c#L834

A standard-compliant zlib decompressor would return an error (either when using a buffer mode or streaming), give even stronger guarantees with a checksum, and still allow stream-fashioned I/O.

So from what I understood the main problem in [ticket 2116](https://dev.deluge-torrent.org/ticket/2116) was calling `zlib.decompress()` on a TCP received buffer which could be incomplete; the new protocol makes a **blocking** read for the whole amount so it will solve this.

However an alternative solution would have been to:
* use buffered I/O
* use a `zlib` decompressor which is strict about truncated input and honours the Adler32 checksum (the python zlib decompressor does not seem to do so, as it is not checking the header bits for it - please correct me if I am wrong)

Would buffered I/O bring back the problem of a ""hanging"" reader? In fact problem is always there if one does not set I/O deadlines, regardless of the approach used for reading. You can probably test for this problem by inserting a random long delay within the first few bytes of the header: without a deadline the receiving end will still hang on the header receipt (note that I have not checked the current behaviour).
When using buffered I/O one would practically set a deadline on how much to wait idle for a `Z_STREAM_END` (relatively to last byte received) before giving up.

I am not saying that it is - now or back then - worth pursuing this approach but I was wondering if it had been considered, as I am generally in favour of more efficient ways of performing network I/O.

@cas-- thanks for the URLs, really interesting to read about the original discussion - and thanks guys for all the hard work!"
1024814775,353,gazpachoking,2022-01-29T02:44:13Z,"Okay, once more with feeling. Starting out at the very basics, with tests, and justifications, in hopes of getting something cleaner going here. "
1024815923,353,gazpachoking,2022-01-29T02:51:02Z,"Man, what is going on with the tests. I didn't touch any deluge code yet in this branch. Maybe those need to be refactored before any other work."
1024933820,353,gazpachoking,2022-01-29T15:38:52Z,"> Man, what is going on with the tests. I didn't touch any deluge code yet in this branch. Maybe those need to be refactored before any other work.

I think maybe the problem is that my understanding of how the reactor works when used in the test suite is incomplete? Something my added test file does messes up subsequent tests, but I'm not really sure what I need to do differently."
1026433220,353,gazpachoking,2022-02-01T03:03:44Z,Rebased this on top of the new test rewrites and everything it working fine now. Was some test weirdness with the mixed twisted.trial and unittests that must have been messing it up.
1027598337,353,gazpachoking,2022-02-02T05:25:23Z,"I don't want to put too much in to this, because some of the refactoring I want to do with it should probably be in their own PRs, so it's easier to review stuff. This one I've just added the decorator, tests and converted over a few existing inlineCallbacks.

Since this is on top of my test changes branch, here's the real diff for this branch:
https://github.com/gazpachoking/deluge/compare/no_twisted_trial...gazpachoking:maybe_coroutine"
1027870623,353,cas--,2022-02-02T12:03:12Z,@gazpachoking Thanks a lot for this and the tests PR! I'll try to have a look by the weekend 
1030854718,353,gazpachoking,2022-02-06T15:25:53Z,"Oops, found an issue. Wrapping those logging functions was a bad idea, because they get called before gtkui installs the gtkreactor."
1030855213,353,gazpachoking,2022-02-06T15:28:10Z,Does anyone know why these are wrapped in inlineCallbacks to start with? My inclination is to just make them synchronous. https://github.com/deluge-torrent/deluge/blob/1089adb84420909c1e716329a2c419a63ee29b6f/deluge/log.py#L54-L86
1030859121,353,cas--,2022-02-06T15:48:06Z,">Does anyone know why these are wrapped in inlineCallbacks to start with? My inclination is to just make them synchronous. 

There are some odd decisions in old code :shrug: I agree though"
1030861089,353,gazpachoking,2022-02-06T15:58:41Z,"I made them synchronous. Doesn't seem to have any ill effects, and fixed the issue at hand."
1030914980,353,cas--,2022-02-06T21:10:00Z,Excellent work @gazpachoking this should lay a good foundation for the async code!
782799103,306,matiasw,2021-02-21T05:14:03Z,@DjLegolas Thanks for the feedback. I changed quotes into single quotes and changed the import order; not sure if it's still the way you'd like?
927121329,306,matiasw,2021-09-25T13:29:33Z,"Ok, so I changed the code to use these premade functions. It is a bit neater, now."
927324895,306,matiasw,2021-09-26T15:32:52Z,I have made the requested modifications and added the Preferences setting for this feature.
927333881,306,cas--,2021-09-26T16:36:13Z,"Excellent, thanks! Just need to fix the failing linting issues

![image](https://user-images.githubusercontent.com/606038/134816146-779a9b67-c27f-4e79-affc-2d96f0c4295e.png)

If you install [pre-commit](pre-commit.com) then your commits are linted automatically 

"
927345745,306,matiasw,2021-09-26T18:01:23Z,"Uh, so, I did install pre-commit, and on my machine, with `pre-commit run --all-files`, I get all PASSED, but the CI test on Github still fails. If I knew why, I could fix it?"
927348900,306,cas--,2021-09-26T18:23:29Z,"That is strange, I see this: 

![image](https://user-images.githubusercontent.com/606038/134819581-c601db75-734b-4839-8322-d53e989e3503.png)

Don't worry I'll can resolve it when merging it :+1: 
"
933005844,306,cas--,2021-10-03T18:53:32Z,Thanks @matiasw for this useful feature!
1001217476,325,cas--,2021-12-26T17:33:11Z,"Thanks for getting this work started. 

Maybe look at using this: https://github.com/asottile/pyupgrade with `--py36-plus` since with can bump to >=3.6 (I know 3.6 EOL)"
1001222682,325,bwitt,2021-12-26T18:03:27Z,"+1 for using https://github.com/asottile/pyupgrade with `--py36-plus` ; 
also suggest using https://github.com/asottile/reorder_python_imports with `--py36-plus` to fix up a few more things."
1001358894,325,DjLegolas,2021-12-27T06:17:02Z,"> Thanks for getting this work started.
> 
> Maybe look at using this: https://github.com/asottile/pyupgrade with `--py36-plus` since with can bump to >=3.6 (I know 3.6 EOL)

Do you want to add it permanently to the linting process?"
1001633764,325,cas--,2021-12-27T16:02:05Z,"What I would suggest is that this PR is wrapped up as is and we merge it. So things to finalise for this PR:
 
* remove urllib imports in PreferencesManager to pass the linting
* Any tests or reference to Python 2 use `git grep -Ei ""python.?2|py2[ 0-9]""`

Then create a second PR that uses pyupgrade since that will be another huge changeset. Adding pyupgrade to pre-commit is helpful since if added as a pre-commit `[manual]` stage we can run it quickly with

`pre-commit run pyupgrade -a `"
50262731,5,cas--,2014-07-27T12:07:43Z,"A quick glance at the diff, I notice the code has a few minor formatting issues that need cleaned up.

For the translation text, check `blocklist_pref.glade` file for any strings with `:` at the end and then in the js also add that char so the strings match and set `labelSeparator : '',`.
"
50277688,5,omaralvarez,2014-07-27T16:09:10Z,"> For the translation text, check blocklist_pref.glade file for any strings with : at the end and then in the js also add that char so the strings match and set labelSeparator : '',.

Done!

What are the formatting issues? I can correct them and commit the changes.
"
50279659,5,cas--,2014-07-27T17:24:36Z,"We use flake8 for the python code, I am not sure the best equivalent for js (try jslint) but these are a few obvious corrections needing made to at least keep the code consistent:

Indentations should be spaces not tabs and ensure the indentation is correct.
There is quite a bit of commented out code, if it's not needed should just remove it.
Spacing between blocks should be consistent.

Oh and it makes it easier for yourself if you create a branch for a pull request and rebase it to clean up the commit history. 
"
50279743,5,omaralvarez,2014-07-27T17:27:54Z,"Ok, I'll fix everything I can and try jslint. 
"
50287152,5,omaralvarez,2014-07-27T21:55:52Z,"Ok, I think I have fixed the formatting issues. I ran it through jslint and jshint. There are errors, but related to them not understanding extJS I think.

Edit: Next time I will rebase instead of committing this way.
"
50764443,5,cas--,2014-07-31T14:17:54Z,"I'm going to nitpick but you still have a couple of indent issues and trailing spaces. Your code editor should be able to strip the latter when saving. 

You've done a good job matching the gtk page, are you able to get rid of the horizontal scrollbar?
"
50772526,5,cas--,2014-07-31T15:12:09Z,"I can see there are a few issues with jslint as it's a bit over-jealous with changes possibly and jshint doesn't deal with whitespace so I did a bit of investigating and found a handy tool that I think will help you out with consistent whitespace: [codepainter](https://github.com/jedmao/codepainter)

If you run codepaint using the style `hautelook` it should produce the results we need:
`codepaint xform -p hautelook ""blocklist.js""`

I will probably look to update our style guide to use `codepainter`, although a little annoying have to install nodejs. 
"
50798837,5,omaralvarez,2014-07-31T18:26:46Z,"First of all, thanks a lot for codepainter, great tool! I was going crazy because of the formatting errors. Installing node.js it's pretty straightforward, no hassle.

Removed the horizontal scrollbar and changed a couple of things, so everything was nicer. 
"
50806108,5,cas--,2014-07-31T19:21:47Z,"I think there might be a bug, I had the plugin disabled with a url set and upon re-enabling the URL entry field was empty, the info section is filled in properly though.
"
50808478,5,omaralvarez,2014-07-31T19:42:17Z,"Yeah, the same thing happens to me, let me investigate further.
"
50859586,5,omaralvarez,2014-08-01T08:06:58Z,"The bug is fixed, I don't know why, the event `show` is not called when the plugin is deactivated and activated again. I made a little function, to update the config on start even if the `show` event is not called.
"
50881725,5,cas--,2014-08-01T13:09:32Z,"As the preferences dialog is already open when the plugin is enabled, the show event has been and gone. I can't see any issue with just changing it to `this.on('show'...)` which would then catch the show event for displaying that plugin page. I think that makes a bit more sense and the other plugins probably could do with updating to use that.
"
50923497,5,omaralvarez,2014-08-01T19:13:03Z,"Yes, you are probably right. As soon as I can I'll try it. 
"
50976165,5,omaralvarez,2014-08-02T22:19:38Z,"You were right, got rid of the new function and changed object that is responsible for the event. I just did not think it through much since I saw that almost every plugin did it that way.
"
51092826,5,cas--,2014-08-04T17:47:03Z,"Thanks, added to develop.
"
59012459,19,cas--,2014-10-14T09:20:52Z,"Is this due to a user not running with administrator privileges? 

It may not apply here to this case but have you tried to change `magnet_key` to:

```
magnet_key = _winreg.CreateKey(_winreg.HKEY_CLASSES_ROOT, ""Magnet"", 0, _winreg.KEY_WRITE)
```

It probably is the case we do need to use `HKCU` but we should try first with `HKCR` and then fallback to `HKCU`, using a `try..except` around `magnet_key`. Also there is no need to alter the `OpenKey` line.
"
59013272,19,doadin,2014-10-14T09:27:54Z,"Yes it is.

Have not but i could try this.

And yes we could also do that as well. And ill change the openkey back then.
"
59345146,19,cas--,2014-10-16T10:58:35Z,"Can you rebase to a single commit please.
"
59345459,19,doadin,2014-10-16T11:01:57Z,"Sure!
"
59347569,19,doadin,2014-10-16T11:25:00Z,"And sorry i cant get the rebase to work, not sure why.
"
59353427,19,cas--,2014-10-16T12:28:32Z,"It should be as simple as `git rebase --interactive develop` and then `fixup` all the commits.
"
59396345,19,doadin,2014-10-16T17:11:55Z,"Did that work right? Still looks like a mess but the one commit is combined now.
"
59399320,19,cas--,2014-10-16T17:33:49Z,"No that is not right, if there was one commit, there would be only one commit...

I forgot you are probably using your develop branch for your own purposes. In that case you want to rebase off of `origin` (our repo) so: `git rebase --interactive origin develop`. Use `fixup` to put all those commits into one: https://help.github.com/articles/about-git-rebase/
"
59404763,19,doadin,2014-10-16T18:11:06Z,"Yea i was referring to it making one commit reflecting all the changes made during this pull.

And yea that is not working.
"
60383631,19,doadin,2014-10-24T13:04:08Z,"is there anything else i should do?
"
61802052,19,cas--,2014-11-05T12:49:23Z,"There is a ticket [#2669](http://dev.deluge-torrent.org/ticket/2669) that means it might require a change to how we set not just the magnet registry entry. I may well merge this for next release but if you could at least attempt to rebase the branch properly so it is one commit.
"
61802649,19,doadin,2014-11-05T12:55:20Z,"They say its related but they also say something about the installer and it says ""file association"". Just wana make sure its clear we are all talking about the same thing.

If it is it might beeasyer to just make the changes here first then make one commit. However its up to you. In order to make this one commit i think id have to remake the pull request. Just let me know what you want to do.
"
61934199,19,doadin,2014-11-06T06:50:15Z,"Never mind i got the branch to reset its all clean now. Ready to be merged.
"
64452544,19,cas--,2014-11-25T19:02:39Z,"Merged: dd8d2c85576a
"
233988057,103,bendikro,2016-07-20T15:36:35Z,"Pushed working fixes
"
254631246,103,cas--,2016-10-18T20:35:03Z,"Applied: c8a3fd72d411
"
642932788,296,SergioInToronto,2020-06-11T21:18:20Z,The build failure is a lint issue. I'm confident I didn't caused it ;)
643653303,296,cas--,2020-06-13T17:28:44Z,"> The build failure is a lint issue. I'm confident I didn't caused it ;)

Did you install and run pre-commit to lint code: https://deluge.readthedocs.io/en/latest/devguide/tutorials/01-setup.html#setup-pre-commit-hook"
643789245,296,SergioInToronto,2020-06-14T16:24:23Z,Thanks for your feedback. Let me know if there are more issues.
991947704,296,cas--,2021-12-12T18:30:16Z,"Thanks for providing changes and sorry took so long to get around to merging, I actually wanted to make a few other changes and not hard link individual forum posts."
1028867959,355,doadin,2022-02-03T11:01:32Z,@cas-- If it runs into an error replacing that line yes.
1028870516,355,doadin,2022-02-03T11:04:38Z,"@cas-- If it works then the output looks like
`
Setting key ""hosts"" to: ('da57dedsrijvgbh38475ty78303c58', '127.0.0.1', 58846, 'localclient', '**********') (of type: <class 'tuple'>)
`"
1028871388,355,doadin,2022-02-03T11:05:42Z,I am also seeing on line 434 we also print passwords. Just noticed so that should be changed too.
1028917028,355,doadin,2022-02-03T11:57:00Z,@cas-- Would you like it to do something different in the case of fail to replace?
1028919005,355,cas--,2022-02-03T11:59:48Z,Okay I see. So the problem is that the code is not clear enough that we are working around each host being a tuple. However it also doesn't account for multiple hosts so would need to loop the hosts list.
1028922019,355,doadin,2022-02-03T12:03:43Z,"@cas-- 
@line 179 in standalone or thinclient I am only seeing one host. @line line 434 though yes thats a whole another beast its a dict with lists of host in it I think? That one idk trying to loop and replace not sure I can do that one."
1028926066,355,cas--,2022-02-03T12:09:06Z,"> line 179 in standalone or thinclient I am only seeing one host

The config key `hosts` is a list of hosts, your current change will overwrite them with a single host"
1028931430,355,doadin,2022-02-03T12:16:16Z,"@cas-- Um interesting, I am currently seeing:

`
07:08:49.315 [DEBUG   ][deluge.config                     :179 ] Setting key ""hosts"" to: ('7b7ecb1276sdgkjvhn342571ee189f6cb1e533', '127.0.0.1', 58846, 'localclient', '**********') (of type: <class 'tuple'>)

07:08:49.315 [DEBUG   ][deluge.config                     :434 ] Config C:\Users\bob\AppData\Roaming\deluge\hostlist.conf version: 1.3 loaded: {'hosts': [['18ebad274d29540sgjkn234758td20e8ffd0', '127.0.0.1', 58846, 'localclient', 'SECRET'], ['bf2c65eebb269a7sdklgjbns3473478c7a5dae8144a5', '127.0.0.1', 58845, 'localclient', 'SECRET'], ['b1e348c24sdjkfvgszjnkb34785387bb65c0b', '10.0.0.4', 58846, 'localclient', 'SECRET']]}
`

With my change and without:

`
07:12:48.900 [DEBUG   ][deluge.config                     :174 ] Setting key ""hosts"" to: [('1c09de15asjfvkasnjdk2345782345784111e6ef693e', '127.0.0.1', 58846, 'localclient', 'SECRET')] (of type: <class 'list'>)

07:12:48.901 [DEBUG   ][deluge.config                     :429 ] Config C:\Users\bob\AppData\Roaming\deluge\hostlist.conf version: 1.3 loaded: {'hosts': [['18ebad274d295sjksfndvnjkl347834587940e8ffd0', '127.0.0.1', 58846, 'localclient', 'SECRET'], ['bf2c65eebsdjksdffjkn4784334782c7a5dae8144a5', '127.0.0.1', 58845, 'localclient', 'SECRET'], ['b1e348c2sdjsdjksd3453478478bb65c0b', '10.0.0.4', 58846, 'localclient', 'SECRET']]}
`

So idk it appears to only log one host at that line, if thats intended or not idk."
1028940769,355,doadin,2022-02-03T12:28:16Z,"if key == ""hosts"":
    print(self.__config[key])

[('c6a33585sdjhkvfdjk3478437886d4f5e1a8', '127.0.0.1', 58846, 'localclient', 'SECRET')]

its only one host as far as I can tell. Idk maybe I am just doing something wrong. Sorry."
1029040044,355,cas--,2022-02-03T14:23:09Z,"It's not about what you are seeing just now, it is about what the code is capable of doing. Currently Deluge starts by setting only one host however there is no restriction to set multiple hosts in the config for this key and therefore the code changes are not correct since it doesn't account for a list of hosts. Add to the fact that the log.debug output for the `hosts` key should be a list of tuples not a tuple. Therefore this would result in a misleading debug log for the `hosts` key.

Likely want to do something like this:

```
if key == 'hosts' and value:
   # Scrub host password
   value = [host[:-1] + ('**********',) for host in hosts]
```"
1029041672,355,cas--,2022-02-03T14:24:42Z,If this is needed in multiple places within config code then might want to consider creating a scrub password function for the hosts list. 
1029471550,355,doadin,2022-02-03T22:45:57Z,@cas-- Current version of this pr is the best I got.
1030603351,355,DjLegolas,2022-02-05T11:19:14Z,"I would suggest the following changes.
* Use a scrab method to do all the work.
* Can handle both an item and the entire config
* Changed the default host list structure (from a list of tuples, to list of lists)
```diff
diff --git a/deluge/config.py b/deluge/config.py
--- a/deluge/config.py	(revision 8b0c8392b63f4af976c3046093f3ead96eddddc8)
+++ b/deluge/config.py	(date 1644059027928)
@@ -125,18 +125,31 @@
         # is set.
         self._save_timer = None
 
-        if defaults:
-            for key, value in defaults.items():
-                self.set_item(key, value)
-
         # Load the config from file in the config_dir
         if config_dir:
             self.__config_file = os.path.join(config_dir, filename)
         else:
             self.__config_file = get_default_config_dir(filename)
 
+        if defaults:
+            for key, value in defaults.items():
+                self.set_item(key, value)
+
         self.load()
 
+    def _scrab_passwords(self, value):
+        if self.__config_file.endswith('hostlist.conf'):
+            try:
+                if isinstance(value, dict):
+                    no_pass_value = [host[:-1] + ['**********'] for host in value['hosts']]
+                else:
+                    no_pass_value = [host[:-1] + ['**********'] for host in value]
+            except IndexError:
+                return ''
+            else:
+                return no_pass_value
+        return value
+
     def __contains__(self, item):
         return item in self.__config
 
@@ -171,7 +184,7 @@
         """"""
         if key not in self.__config:
             self.__config[key] = value
-            log.debug('Setting key ""%s"" to: %s (of type: %s)', key, value, type(value))
+            log.debug('Setting key ""%s"" to: %s (of type: %s)', key, self._scrab_passwords(value), type(value))
             return
 
         if self.__config[key] == value:
@@ -193,7 +206,7 @@
         if isinstance(value, bytes):
             value = value.decode('utf8')
 
-        log.debug('Setting key ""%s"" to: %s (of type: %s)', key, value, type(value))
+        log.debug('Setting key ""%s"" to: %s (of type: %s)', key, self._scrab_passwords(value), type(value))
         self.__config[key] = value
 
         global callLater
@@ -431,7 +444,7 @@
             filename,
             self.__version['format'],
             self.__version['file'],
-            self.__config,
+            self._scrab_passwords(self.__config),
         )
 
     def save(self, filename=None):

diff --git a/deluge/ui/hostlist.py b/deluge/ui/hostlist.py
--- a/deluge/ui/hostlist.py	(revision 8b0c8392b63f4af976c3046093f3ead96eddddc8)
+++ b/deluge/ui/hostlist.py	(date 1644059050119)
@@ -29,7 +29,7 @@
     """"""Create a new hosts key for hostlist with a localhost entry""""""
     host_id = uuid.uuid4().hex
     username, password = get_localhost_auth()
-    return {'hosts': [(host_id, DEFAULT_HOST, DEFAULT_PORT, username, password)]}
+    return {'hosts': [[host_id, DEFAULT_HOST, DEFAULT_PORT, username, password]]}
 
 
 def validate_host_info(hostname, port):
```"
1030612159,355,cas--,2022-02-05T12:21:48Z,"@DjLegolas I was just working on this myself including adding tests, I'll incorporate a few of your suggestions, thanks!"
2320226411,462,mtasaka,2024-08-30T06:37:49Z,Thank you for review. I think I've reflected your comments.
2323165402,462,mtasaka,2024-09-01T04:44:52Z,"So:
`test_httpdownloader.py::TestDownloadFile::test_download_with_rename_sanitised` is failing..

I did some investigation on python3.12/email, and accoding to: 
https://www.rfc-editor.org/rfc/rfc2183#section-2.3
```
2.3 The Filename Parameter
Current RFC2045  grammar restricts parameter values (and hence
   Content-Disposition filenames) to US-ASCII
```
and https://www.rfc-editor.org/rfc/rfc2045 :
```
     parameter := attribute ""="" value

     attribute := token
                  ; Matching of attributes
                  ; is ALWAYS case-insensitive.

     value := token / quoted-string

     token := 1*<any (US-ASCII) CHAR except SPACE, CTLs,
                 or tspecials>

     tspecials :=  ""("" / "")"" / ""<"" / "">"" / ""@"" /
                   "","" / "";"" / "":"" / ""\"" / <"">
                   ""/"" / ""["" / ""]"" / ""?"" / ""=""
                   ; Must be in quoted-string,
                   ; to use within parameter values
```

So python `email.message.EmailMessage()` assumes  `filename=/etc/passwd` as invalid and rejects this to parameter.

As RFC2045 says quoted value is valid, and actually if I change

```
diff --git a/deluge/tests/test_httpdownloader.py b/deluge/tests/test_httpdownloader.py
index 1c2704560..0a4695b5c 100644
--- a/deluge/tests/test_httpdownloader.py
+++ b/deluge/tests/test_httpdownloader.py
@@ -206,10 +206,10 @@ async def test_download_with_rename_exists(self):
         self.assert_contains(filename, 'This file should be called renamed')
 
     async def test_download_with_rename_sanitised(self):
-        url = self.get_url('rename?filename=/etc/passwd')
+        url = self.get_url('rename?filename=""/etc/passwd""')
         filename = await download_file(url, fname('original'))
         assert filename == fname('passwd')
-        self.assert_contains(filename, 'This file should be called /etc/passwd')
+        self.assert_contains(filename, 'This file should be called ""/etc/passwd""')
 
     async def test_download_with_attachment_no_filename(self):
         url = self.get_url('attachment')
```

Then test_download_with_rename_sanitised test passes. Is this okay?"
2327204618,462,cas--,2024-09-03T18:54:48Z,Ah good to find the test is exercising that code. Yeah I agree that the quotes are optional unless using special characters so that change makes sense
2329254738,462,mtasaka,2024-09-04T14:40:22Z,"> Ah good to find the test is exercising that code. Yeah I agree that the quotes are optional unless using special characters so that change makes sense

Okay, thank you for confirmation. I've updated the testcase."
2330630015,462,mtasaka,2024-09-05T05:25:23Z,Oops...  I've modified the last commit a bit (quoting the filename should be in 2 places)
2331387831,462,mtasaka,2024-09-05T12:23:28Z,"Now CI seems good, except that CI for windows with python3.7 is failing, but looking at the log, I don't think the failure is related to this PR."
65401868,16,cas--,2014-12-03T12:47:54Z,"Same of #14, needs other UIs updated too.
"
65429579,16,cas--,2014-12-03T15:41:15Z,"Added to develop: [2aaae7c6a1bec]
"
405008582,202,cas--,2018-07-14T08:29:37Z,"I would prefer to know why console is sending float and fix it there, it's notorious for buggy code. The function accepts int so lets leave it as that."
405035954,202,aresch,2018-07-14T16:56:14Z,Probably should add some more cases in the test: https://github.com/deluge-torrent/deluge/blob/develop/deluge/tests/test_common.py#L55
405134329,202,gazpachoking,2018-07-16T01:46:24Z,"Hmm, I can't get it to crash again, not exactly sure where the problem was coming from. It was totally unusable while it was happening, with the crash traceback being uncaught, and printing out everywhere all over the screen. I agree it'd be nice to know why it was getting a float, but I'm not exactly sure why we wouldn't want the time formatter to also handle floats. (Though I also agree the docstring and tests need updated if we do go that route.)

BTW: This works with floats in the 1.3 branch. `'%d' % a_float` is valid, so I suspect this started happening when switching to `'{:d}'.format(a_float)` style string formatting."
405262950,202,gazpachoking,2018-07-16T14:18:36Z,I suspect you are right on the eta being the thing. I'll defer to you on how you want to fix.
405286995,202,gazpachoking,2018-07-16T15:30:14Z,"You wanna scrap this then, in light of 1e6c02a?"
405288116,202,cas--,2018-07-16T15:33:27Z,I'm still not sure about the idea of supporting both int and float but let's go with your addition of float support too :)
408324554,202,cas--,2018-07-27T06:28:45Z,Merged
496286111,240,DjLegolas,2019-05-27T18:58:29Z,"> I don't want to make it 1.2-only yet so can this PR be just those changes to fix running on 1.2 (with deprecated enabled)

Ok, no problem.
For now the code will look a little silly as it will check in the relevant places with which version of `libtorrent` we currently run.

The only test I still didn't managed to resolve with 1.2 is `test_torrent_error_resume_data_unaltered()`.
The `state` of the torrent is `Downloading` while the test expects `Error`."
496311984,240,cas--,2019-05-27T21:59:02Z,"> The only test I still didn't managed to resolve with 1.2 is `test_torrent_error_resume_data_unaltered()`.
> The `state` of the torrent is `Downloading` while the test expects `Error`.

That could be a problem where the test is leaving files behind that are being found on next run. I have a branch with a fix for that. Could be a file in `~/Downloads'?"
497720004,240,DjLegolas,2019-05-31T14:02:39Z,"@cas-- can you add lt-1.2 binding to deluge's develop ppa?

in addition, there are no files in ~/Downloads no ~/downloads."
499105789,240,cas--,2019-06-05T14:25:23Z,"Merged with commit details in https://dev.deluge-torrent.org/ticket/3255

> still didn't managed to resolve with 1.2 is test_torrent_error_resume_data_unaltered()

Yeah it needs a bit of investigation, could be changes to the way resume_data is handled and may not produce the expected error any more. I have skipped the test for now.

> can you add lt-1.2 binding to deluge's develop ppa?

If you need 1.2 there is a ppa: https://launchpad.net/~libtorrent.org/+archive/ubuntu/1.2-daily/
"
1019542832,347,gazpachoking,2022-01-23T18:41:11Z,"> Oh did you push this branch to this repo? That will be deleted since it's a mirror of git.deluge repo

Doh, looks like I did! Didn't intend that. I'll recreate

> It's great to see you around again, what are the issues with setting up your env?

I didn't have the tools to compile libtorrent set up, and didn't find anything precompiled for windows. I'll get it set up eventually, just got impatient at the time it was taking to test a one line change. ðŸ˜› 

> Looking at the code it was probably overlooked instead. Thanks for making the suggestion but it likely needs tweaked to pass a kwarg to the callback.

That callback is nested inside get_torrents_status, so I'm not sure how adding that kwarg makes any difference, it should still have access to the args passed in to get_torrents_status. (my kwarg suggestion was to add a kwarg directly to get_torrents_status, but I'm not sure how nice that is, since it could end up conflicting depending on what pas passed in 'keys' argument.) If it isn't a performance concern, I think my initial method is still valid."
1019551013,347,gazpachoking,2022-01-23T19:26:06Z,"> > It's great to see you around again, what are the issues with setting up your env?
> 
> I didn't have the tools to compile libtorrent set up, and didn't find anything precompiled for windows. I'll get it set up eventually, just got impatient at the time it was taking to test a one line change. ðŸ˜›

Annnd I figured it out. The answer was in the github action, I forgot to handle libcrypto and libssl dlls. I'll do some testing later tonight."
1019583543,347,DjLegolas,2022-01-23T22:47:09Z,"There is an official release at [pypi](https://pypi.org/project/libtorrent/).
So just use `pip`."
1019585676,347,gazpachoking,2022-01-23T23:01:21Z,"> There is an official release at [pypi](https://pypi.org/project/libtorrent/).
> So just use `pip`.

Yep, that's what I ended up doing, but needed the libcrypto and libssl dlls manually copied in."
1019649334,347,gazpachoking,2022-01-24T02:13:51Z,"Okay, actually tested this now, and it works as expected."
1019908563,347,cas--,2022-01-24T09:47:50Z,"> That callback is nested inside get_torrents_status, so I'm not sure how adding that kwarg makes any difference, it should still have access to the args passed in to get_torrents_status.

I understand there isn't a scope issue here but it better to be explicit and using `all_keys` denotes that"
1019911160,347,cas--,2022-01-24T09:50:55Z,"> > There is an official release at [pypi](https://pypi.org/project/libtorrent/).
> > So just use `pip`.
> 
> Yep, that's what I ended up doing, but needed the libcrypto and libssl dlls manually copied in.

Hmm that it interesting, I assume just having openssl installed wasn't enough. What steps did you take to resolve it?"
1019977302,347,mhertz,2022-01-24T11:05:23Z,"Cas, gazpachoking - sorry for butting in, but with py3.8 and up, ""everything"" is about os.add_dll_directory(), as PATH not used for dll searching anymore, atleast through normal calls. The py-GTK wrappers adds the GTK-containing dirs to that call, from searching your PATH, without that it wouldn't even load the GTK-UI(and that is added in through gvsbuild patches, so not available in other methods obtained, manual builds and whatnot), but we still have the issue of the ""core-components""(non-GTK) like libcrypto and intl.dll etc(later tried loaded, before dir added from the py-wrappers(in GTK-dir), hence error's in log - still issue btw).

Either need copy it into ../site-packages dir, so next to the libtorrent pyd looking for it, or add e.g this into ""..\site-packages\deluge\\__init__.py"" or foo.pth file in site-packages(and I use direct path here, just for example):

`import os; os.add_dll_directory(""C:/OpenSSL-Win64/bin"")`

Edit: Sorry, system32 still used(as only thing from old PATH lookup-behavior retained) as Cas pointed out underneath - so still works for finding SSL if specifically using shinning installer and specifically selecting yes to the additional prompt of if wanting dlls copied also to system32 additionally. Bundled/freezed is a non-issue as pyds/dlls all placed into same folder(though my unfreezed bundling needed change from session PATH addition to said os.add_dll_directory addition at py3.8+). "
1020001164,347,cas--,2022-01-24T11:30:38Z,"Thanks @mhertz for details. So what I can see it that for development as long as OpenSSL libs are in the system it should work (different when bundling the app): 

A quick search to gather details about DLLs changes in 3.8+:  

https://bugs.python.org/issue43173
https://docs.python.org/3/library/os.html#os.add_dll_directory
https://docs.python.org/3/whatsnew/3.8.html#bpo-36085-whatsnew

The concern here is that the libtorrent wheel has a hard-requirement on openssl that is tricky to install correctly on Windows. Should it be bundled by libtorrent then? I would consider raising an upstream issue for this :thinking: 
"
1020162069,347,gazpachoking,2022-01-24T14:32:11Z,"> I understand there isn't a scope issue here but it better to be explicit and using `all_keys` denotes that

How do you feel about inline callbacks? Feels cleaner to me to just eliminate the callback all together. I also explicitly added all_keys for the check so it's clear what's happening."
1020760745,347,gazpachoking,2022-01-25T02:59:34Z,"This certainly isn't the right place to discuss, but, is IRC active anymore? Do we have a discord or something? (And do we perhaps [want one](https://discord.gg/BC9NspHU)?) If there is still activity in IRC we can bridge it to discord."
1021254959,347,gazpachoking,2022-01-25T14:43:42Z,"> Code looks good, if you could squash the commits and put the full url to ticket in the message that would be useful. I can merge it later in week, do you have access to deluge git repo?

I'll squash it and fix up the commit message. Not sure if I still have access to git, been a long time.

> I setup a libera.chat IRC channel but I don't have the bandwidth to be on IRC. I know that discord is popular, if you think it might help then can try it out.

I made it, we can try it out. I don't know how much action there is in IRC, I can enable a bridge for now while we are testing. I did the same for FlexGet, and it seems like over 99% of our action moved over to discord now."
1022450158,347,gazpachoking,2022-01-26T17:59:46Z,"Okay, squashed and updated message. Looks like I don't have access to the git repo anymore. Or I lost my ssh key."
1043379326,377,cas--,2022-02-17T20:12:05Z,thanks for your contribution but I think you might have missed other places where <key>j</key> and <key>k</key> need swapping since my testing didn't show it fixed on torrent view
1043607805,377,doadin,2022-02-17T23:20:19Z,"https://github.com/deluge-torrent/deluge/blob/develop/deluge/ui/console/modes/torrentdetail.py#L1018
https://github.com/deluge-torrent/deluge/blob/develop/deluge/ui/console/modes/torrentdetail.py#L1020

https://github.com/deluge-torrent/deluge/blob/develop/deluge/ui/console/modes/torrentlist/torrentview.py#L466
https://github.com/deluge-torrent/deluge/blob/develop/deluge/ui/console/modes/torrentlist/torrentview.py#L468"
1050566167,377,KtlTheBest,2022-02-25T06:31:05Z,"@cas-- @doadin Thank you and sorry. I was hasty initially, not quite properly testing the changes. I'll make sure to test correctly next time (including this PR). The code base is quite overwhelming so I decided to read it and try to make a sense of it. It looks a bit like spaghetti code with different methods can be called from anywhere with anything, I am surprised how you make sense of it. I also am new to concept of RPC and how ncurses work, so that also took me as a surprise when I started reading about them. I'll make sure to ask relevant questions about the project."
1153196539,386,mhertz,2022-06-12T14:57:32Z,"Thanks for hints, appreciated :)

Sorry I don't really understand much CI yet, so always run local, though same as your yaml, except newest python and few less gtk3 packages etc, but have tested py3.9.12/13 and your gtk3 build instead of mine, before making this PR.

I just did again now too.

I am thinking that the new gvsbuild setup(not running build.py directly anymore), broke that test-run and hence gtk3 and more specifically gi.repository not built, hence pyinstaller couldn't fail with that error. I checked a few jobs at your own repo and in one the deluge exe's was half'ish size, ""tell-tailing"" this(just scanned the log quick and when saw exe sizes, then didn't check more though, yet atleast), and in another run then it stated no log for freeze, though could be retention-rules was stated.

Anyway, i'll look more into it later, and if find I have messed up then will correct of-course, but just was preliminary thinking out loud :)

Edit: Hmm, maybe i'm completely wrong, sorry, as said will investigate this later."
1153276453,386,mhertz,2022-06-12T19:50:48Z,"I'm pretty sure this is correct, and I just got confused in my last post/edit as forgot gvsbuild was used from prebuilt etc - The logs showing pyinstaller 5.1 are producing too small exe artifacts and the runs producing propper size are having no logs though are from a date before pyinstaller 5.0 released, plus I can consistently reproduce here, done countless times in testing e.g. in what to do/exclude etc.

Let me know if need clarification on something, and please change my wording where needed thanks, or ask me to do it, whatever is easiest for you, and same with if you want readme fix splitted off, e.g. if unsure about the other part, blahblah you know what I mean :) 

Thanks!"
1153312804,386,cas--,2022-06-12T22:50:03Z,"I enabled the CI run for this PR and the package size is still lower, likely due to differences between Pyinstaller 4 vs 5. 

In meantime I would suggest we pin Pyinstaller to latest 4 version until issues can be properly investigated and resolved."
1153761206,386,mhertz,2022-06-13T10:44:29Z,"Gotcha. 

I'm very surpiced by that CI run, and will post back if finding something, but I don't really know how troubleshhot CI unfortunetly, so is like doing it in ""blind"" for me, but will post back if finding something.

I'll amend-commit/force-push later to trigger CI-rerun and hopefully resolve those errors currently showing - ussually helps but not this time, so will wait some more time.

Thanks again, appreciated you looking into this as said :)

Edit: Doh, I can run CI-runs myself on a fork! You learn something rew everyday! :)

Edit2: Still smaller-exes(missing gtk3 pickup) using this PR(pyinstaller 4.10).

Edit3: Okay I believe figured it out - I locally use another line to install pygobject/pycairo(getting filename with for-loop), though when using that '--find-links' mechanism as your yaml, then gets pycairo right, but not pygobject and tries build from source, which fails here locally, so probably also on your end, so producing smaller freezes because omiting gtk3 because missing py-bindings, and hence neither hitting original issue I raised here, as gi.repository not picked up because of it. I can fix that('--find-links') here later when have time, but then do you still prefer pinning to last pyinstaller v4.x to fix original raised issue, or the ""excludes"" fix for pyinstaller 5.1 I initially suggested? "
1153828389,386,cas--,2022-06-13T12:01:41Z,"For the record something external changed between [2nd Mar](https://github.com/deluge-torrent/deluge/actions/runs/1922416994) and [1st May](https://github.com/deluge-torrent/deluge/actions/runs/2254277977) and PyInstaller 4.10 was released on 5th Mar so let's trying going back to 4.9 and see if that works in the meantime. 

We should really have all deps pinned in CI to avoid these unexpected problems anyway, I will look to resolve that later.

Thanks for investigating and trying to fix it :+1: 

The other CI errors are due to GitHub outage: https://www.githubstatus.com/"
1154019245,386,mhertz,2022-06-13T14:48:40Z,"Thanks alot for your post, hints and all! :)

The part in edit3 I got fixed, so unless you still want pyinstaller v4.9 specifically, then this is latest v4.x and you can see the gst-missing-typelibs I talked about, which continues here in v4.x, but aborts hard in v5.x, hence previous suggested excludes ""workaround"".

Edit: Sorry here: https://github.com/mhertz/deluge/actions/runs/2489050626"
1154115374,386,cas--,2022-06-13T16:13:13Z,"Ah gotcha, excellent :+1: 

We'll go with 4.10 and look to resolve for 5 in future.

For reference try to detail the precise error so it easier to understand and search for

``` 
36738 INFO: Loading module hook 'hook-gi.repository.Gst.py' from 'C:\\hostedtoolcache\\windows\\Python\\3.9.13\\x64\\lib\\site-packages\\PyInstaller\\hooks'...
Traceback (most recent call last):
  File ""<string>"", line 7, in <module>
gi.repository.GLib.GError: g-irepository-error-quark: Typelib file for namespace 'Gst', version '1.0' not found (0)
36870 ERROR: gi repository 'GIRepository 2.0' not found. Please make sure corresponding package is installed.
Traceback (most recent call last):
  File ""<string>"", line 4, in <module>
  File ""C:\hostedtoolcache\windows\Python\3.9.13\x64\lib\site-packages\gi\__init__.py"", line 139, in require_version
    raise ValueError('Namespace %s not available' % namespace)
ValueError: Namespace Gst not available
```

https://github.com/mhertz/deluge/runs/6863381267?check_suite_focus=true#step:10:275"
1154126567,386,doadin,2022-06-13T16:23:29Z,idk if it will matter but you can see the branch i use for the builds I post to the forums which the latest got good feedback here: https://github.com/doadin/deluge/tree/dev-mine and you can see here: https://github.com/doadin/deluge/runs/6747148127?check_suite_focus=true it ran with pyinstaller 5.1.
1154186239,386,mhertz,2022-06-13T17:23:42Z,"Not Cas, but thanks mate :) I was actually gonna ask Cas if we shouldn't ask you how you proceded, though in end didn't need anyway - I did look at a point earlier though, but didn't found your branch :)

Puzzling me that you can run without --no-index for the py-bindings, as here, both locally and CI, tries to use tar.gz for pyobject and build from source and then failing. I haden't catched that before(as used other command locally, so didn't knew was issue) or else would have posted also that in your thread on forum previously, but for some reason you're not hitting it.

Anyway, thanks for the help, and Cas can ask you further if need more info."
1154199534,386,mhertz,2022-06-13T17:38:49Z,"Cas, forgive me for being complete moron here, but should I just reference 

`gi.repository.GLib.GError: g-irepository-error-quark: Typelib file for namespace 'Gst', version '1.0' not found (0)`

and/or

`36870 ERROR: gi repository 'GIRepository 2.0' not found. Please make sure corresponding package is installed.`

and/or

`ValueError: Namespace Gst not available`

or full message like you quoted, for one of the modules.

Edit: Took full-message, if is okay then please disregard above."
220827648,99,cas--,2016-05-22T11:33:52Z,"Just a few points on docstrings: 
- Every line should be finished with a full-stop as they are sentences and makes it clear there is no continuation of the text.
- The first line summary of a method should be on the same line as the triple-quote e.g. `""""""This is a module that...`
- I was discussing this before that unfortunately sphinx complains about indented lines in the `Returns` sections. I don't know if we should comply with it though...
  So the following is invalid according to sphinx:

```
Returns:
    tuple: some long text...
        continuing text....
```

and sphinx wants it to be:

```
Returns:
    tuple: some long text...
    continuing text....
```

To me it seems like a bug that needs reporting but may never be fixed ;)

[Docstrings examples](https://sphinxcontrib-napoleon.readthedocs.io/en/latest/example_google.html)
"
220828837,99,cas--,2016-05-22T12:05:14Z,"So based on that sphinx example you shared, I realised that for the `Returns` section issue we can use `::` to enable the use of indents.
"
254070668,115,cas--,2016-10-16T20:02:25Z,"I think until we have made all the other changes that require 1.1 we should wait to do this
"
254073743,115,aresch,2016-10-16T20:48:56Z,"I guess we could do it in a way that is backwards compatible, ie, check for **version** and if not available use version.
"
254074509,115,cas--,2016-10-16T21:00:58Z,"It's not worth it as it's only deprecated currently. It can be included in a wider change for develop to support 1.1 with no deprecated methods.
"
254075400,115,aresch,2016-10-16T21:13:47Z,"Are we not targeting >lt-1.1 for develop now?

The reason I want this patch in, is because I run with a non-deprecated functions libtorrent build and without this the thin client will not start on my desktop.
"
254075782,115,cas--,2016-10-16T21:19:49Z,"Yes but 1.1 is still backward compatible so we don't need to do anything and this PR would force a change for no real reason, meaning everyone else requires updating libtorrent. It makes sense for this change to be part of a larger branch that fixes all the deprecated methods. 
"
254076367,115,cas--,2016-10-16T21:29:41Z,"Ok I think I understand now that you mean it's a client side issue?
"
254077202,115,cas--,2016-10-16T21:42:28Z,"Is it an AttributeError so we can do this?

```
try:
    lt_version = libtorrent.version
except AttributeError:
    lt_version = libtorrent.__version__
```
"
254078413,115,cas--,2016-10-16T22:03:56Z,"This is a result of the overhaul of UI and I think better fixed in baseargparser: https://github.com/deluge-torrent/deluge/blob/develop/deluge/ui/baseargparser.py#L87

```
...
except (ImportError, AttributeError):
    pass
...
```
"
254080689,115,aresch,2016-10-16T22:45:40Z,"It needs to be fixed in 2 places.  The other place being _libtorrent.py where we read the libtorrent version to ensure we meet the minimum required version.
"
254081175,115,aresch,2016-10-16T22:53:18Z,"I just installed libtorrent 1.0.10 to see if **version** exists there and it does.  It looks like this change should work fine with older versions of libtorrent.

```
>>> libtorrent.__version__
'1.0.10.0'
>>> libtorrent.version
'1.0.10.0'
```
"
254173151,115,cas--,2016-10-17T10:39:49Z,"Ah it was added in 1.0.7 so the minimum version will need bumped to that.
"
254173577,115,cas--,2016-10-17T10:41:59Z,"It will also need changing in these places:

```
git grep lt.version
.travis.yml:43:  - python -c ""import libtorrent as lt; print lt.version""
deluge/core/core.py:60:        log.info(""Starting libtorrent %s (%s, %s) session..."", lt.version, client_id, client_version)
deluge/core/core.py:68:        settings[""user_agent""] = ""Deluge/%(deluge_version)s libtorrent/%(lt_version)s"" % {
deluge/core/core.py:70:            'lt_version': self.get_libtorrent_version().rpartition(""."")[0]
deluge/core/core.py:951:        return lt.version
deluge/ui/baseargparser.py:91:        version_str += ""libtorrent: %s\n"" % lt.version
deluge/ui/gtkui/aboutdialog.py:264:            def on_lt_version(result):
deluge/ui/gtkui/aboutdialog.py:273:                client.core.get_libtorrent_version().addCallback(on_lt_version)
deluge/ui/gtkui/aboutdialog.py:278:                client.core.get_libtorrent_version().addCallback(on_lt_version)
setup.py:234:            print('Found libtorrent version: %s' % lt.version)
tox.ini:50:    python -c ""import libtorrent as lt; print lt.version""
```
"
254184672,115,cas--,2016-10-17T11:43:18Z,"I decided to tidy up _libtorrent.py so have opened a new PR #116 with all the relevant changes.
"
356195651,175,AllSeeingEyeTolledEweSew,2018-01-09T06:49:50Z,"I thought of a bad case that happens when AlertManager is paused. See the comments.

If there's a better way to handle this in Twisted, please let me know."
356245986,175,cas--,2018-01-09T10:36:00Z,"Please use the develop or master code, 1.3-stable will not see any new features or changes only bugfixes. 


  "
357148249,175,AllSeeingEyeTolledEweSew,2018-01-12T05:41:34Z,"Thanks for your time. Unfortunately as I mentioned before, the project driving these PRs is tied to private trackers, so I won't be able to meaningfully test this code against a development branch for some time."
435009457,175,cas--,2018-11-01T11:14:41Z,Closing in favour of #221 
490640598,234,cas--,2019-05-08T20:34:05Z,"Thanks, merged: 2296906


"
1141252464,385,ibizaman,2022-05-30T14:58:44Z,@cas--  With pleasure!
1153228067,385,ibizaman,2022-06-12T16:36:04Z,Thanks @cas--
1787239495,430,rcarpa,2023-10-31T13:38:56Z,Sorry for taking so long. Was overwhelmed by a couple of more urgent tasks.  
1860737542,430,rcarpa,2023-12-18T15:02:11Z,"@cas-- , would it be possible to create a release ? (could be an -dev or an -alpha release). It would be very useful to be able to use this new features by just installing deluge from pip. "
56818926,10,cas--,2014-09-25T13:35:29Z,"Merged in 66f2739be7cda3d610
"
121777576,34,bendikro,2015-07-15T23:48:00Z,"@doadin Have these been translated with an automated translation tool, such as google translate?
"
121778085,34,doadin,2015-07-15T23:52:10Z,"something like that. with poedit which uses a mix of machine and human translation and already tanslated words from the translation file.
"
121778729,34,doadin,2015-07-15T23:56:20Z,"I was just testing probably don't want to accept this at least not some of it. Some of the translations are basically non-existent and imo should just be removed. 3% or less translated is not good.Anyways probably not the best translations but idk how you guys feel about it but something is better than nothing imo if youre gonna keep the translation as an option. Translatiing like 4 words is not really supporting a language. And for those we should auto translate so its at least somewhat usful or just remove support for it till we get better.
"
121783192,34,bendikro,2015-07-16T00:09:04Z,"There is no point is having a translation for a language that doesn't cover larger (most) parts of the text. Also, I don't think it's a good idea to use automated translation without manually being able to verify that the result is correct. It's better to have a proper English fallback text on phrases that aren't translated than to have a badly translated phrases.

Also, you keep pissing off cas every time you create a pull requests for branches that aren't ready for merging. It's better to create a ticket (http://dev.deluge-torrent.org/wiki/Development#BugTracking) and link to your github branch if you have questions :-) 
"
121785826,34,doadin,2015-07-16T00:15:15Z,"yea i meant to publish this one not push i instantly was like ut oh...he gonna hate me even more. The other one though i dont see any reason its not ready, other than it not being something hes wants to add.
"
133364106,34,cas--,2015-08-21T10:15:24Z,"All translation is done through Launchpad: http://dev.deluge-torrent.org/wiki/Development/Translation

I have just uploaded the latest template for develop here: https://translations.launchpad.net/deluge/develop
"
513501175,34,pereorga,2019-07-20T21:39:25Z,"Hi @cas-- , sorry for hijacking this thread, there is no information in the readme and the link [0] in the documentation [1] is broken. 

I would like to contribute to the Catalan translation. Is Launchpad still used for translations? The translation file is very outdated, for example, ""Files"" is not translated in https://github.com/deluge-torrent/deluge/blob/develop/deluge/i18n/ca.po#L4233 but the translation exists in Launchpad since 2007: https://translations.launchpad.net/deluge/develop/+pots/deluge/ca/1188/+translate

[0] https://deluge.readthedocs.io/en/develop/contributing/translations.html
[1] https://dev.deluge-torrent.org/wiki/Development"
514131825,34,cas--,2019-07-23T09:31:25Z,"@pereorga Yes. The deluge 2.0 translation files are rather outdated and should be updated using 1.3 as a basis. I have not had the time to sort it out but you can update Catalan

I have updated the documentation link."
514176097,34,pereorga,2019-07-23T11:47:35Z,"Great!

Should I work in Launchpad then? It's a bit confusing because current Launchpad data does not match these files. I'm also not familiarized with the workflow followed in Launchpad, but ideally, I would like to compile and open Deluge with the current and updated translation and start improving the translation from there. "
514203599,34,cas--,2019-07-23T13:12:43Z,"> It's a bit confusing because current Launchpad data does not match these files.

Which file? The git repository is always behind Launchpad as we need to wait for translations: https://deluge.readthedocs.io/en/latest/contributing/translations.html#translation-process

The Launchpad files can be exported: https://translations.launchpad.net/deluge/2.0/+pots/deluge/+export"
514271831,34,pereorga,2019-07-23T15:54:36Z,"Nevermind, I see that you just updated some translations in Launchpad. I'll work there, thanks!"
534478171,34,pereorga,2019-09-24T09:36:38Z,"I just completed the Catalan translation: https://translations.launchpad.net/deluge/2.0/+pots/deluge

@cas-- please, let me know if anything else is needed.
"
210412069,65,cas--,2016-04-15T10:44:46Z,"Would it be better to detect if the plugin has been enabled rather than use `standalone` attribute? It may help solve the issue of attempting to start both deluge-web and web plugin.
"
210557405,65,bendikro,2016-04-15T17:32:43Z,"What is the problem with both WebUI plugin and deluge-web?
"
211003095,65,cas--,2016-04-17T11:20:50Z,"In gtk `standalone` mode the webui plugin generates the following errors:

```
12:16:44.400 [ERROR   ][deluge.component                       :98  ] [Failure instance: Traceback: <class 'twisted.internet.error.CannotListenError'>: Couldn't listen on 0.0.0.0:8112: [Errno 98] Address already in use.
/home/ubuntu/deluge.git/deluge/core/pluginmanager.py:56:enable_plugin
/home/ubuntu/deluge.git/deluge/pluginmanagerbase.py:144:enable_plugin
/home/ubuntu/deluge.git/deluge/component.py:286:start
/home/ubuntu/deluge.git/deluge/component.py:104:_component_start
--- <exception caught here> ---
/usr/lib/python2.7/dist-packages/twisted/internet/defer.py:134:maybeDeferred
/home/ubuntu/deluge.git/deluge/plugins/WebUi/deluge/plugins/webui/core.py:74:start
/home/ubuntu/deluge.git/deluge/ui/web/server.py:589:start
/home/ubuntu/deluge.git/deluge/ui/web/server.py:597:start_normal
/usr/lib/python2.7/dist-packages/twisted/internet/posixbase.py:436:listenTCP
/usr/lib/python2.7/dist-packages/twisted/internet/tcp.py:622:startListening
]
12:16:44.410 [ERROR   ][deluge.plugins.init                    :28  ] Unable to enable plugin ""GtkPlugin.WebUi""!
12:16:44.410 [ERROR   ][deluge.plugins.init                    :1172] 'NoneType' object has no attribute 'send_request'
Traceback (most recent call last):
  File ""/home/ubuntu/deluge.git/deluge/plugins/init.py"", line 26, in enable
    self.plugin.enable()
  File ""/home/ubuntu/deluge.git/deluge/plugins/WebUi/deluge/plugins/webui/gtkui.py"", line 35, in enable
    client.webui.get_config().addCallback(self.cb_get_config)
  File ""/home/ubuntu/deluge.git/deluge/ui/client.py"", line 517, in __call__
    return self.daemon.call(self.base, *args, **kwargs)
  File ""/home/ubuntu/deluge.git/deluge/ui/client.py"", line 300, in call
    self.protocol.send_request(request)
AttributeError: 'NoneType' object has no attribute 'send_request'
12:16:44.411 [ERROR   ][deluge.core.eventmanager               :37  ] Event handler PluginEnabledEvent failed in <bound method PluginManager._on_plugin_enabled_event of <deluge.ui.gtkui.pluginmanager.PluginManager object at 0xa40ec6c>> with exception 'NoneType' object has no attribute 'send_request'
12:16:44.414 [ERROR   ][deluge.core.eventmanager               :37  ] Event handler PluginEnabledEvent failed in <bound method JSON.get_remote_methods of <deluge.ui.web.json_api.JSON object at 0xa835dac>> with exception 'NoneType' object has no attribute 'send_request'
12:16:45.094 [ERROR   ][twisted                                :532 ] Unhandled error in Deferred:
Unhandled error in Deferred:
12:16:45.098 [ERROR   ][twisted                                :532 ] Unhandled Error
Traceback (most recent call last):
  File ""/usr/lib/python2.7/dist-packages/twisted/internet/_glibbase.py"", line 282, in run
    self._run()
  File ""/usr/lib/python2.7/dist-packages/twisted/internet/_glibbase.py"", line 313, in _simulate
    self.runUntilCurrent()
  File ""/usr/lib/python2.7/dist-packages/twisted/internet/base.py"", line 800, in runUntilCurrent
    call.func(*call.args, **call.kw)
  File ""/usr/lib/python2.7/dist-packages/twisted/internet/task.py"", line 208, in __call__
    d = defer.maybeDeferred(self.f, *self.a, **self.kw)
--- <exception caught here> ---
  File ""/usr/lib/python2.7/dist-packages/twisted/internet/defer.py"", line 134, in maybeDeferred
    result = f(*args, **kw)
  File ""/home/ubuntu/deluge.git/deluge/ui/gtkui/statusbar.py"", line 367, in update
    self.send_status_request()
  File ""/home/ubuntu/deluge.git/deluge/ui/gtkui/statusbar.py"", line 271, in send_status_request
    client.core.get_session_status(keys).addCallback(self._on_get_session_status)
  File ""/home/ubuntu/deluge.git/deluge/ui/client.py"", line 517, in __call__
    return self.daemon.call(self.base, *args, **kwargs)
exceptions.AttributeError: 'NoneType' object has no attribute 'call'
```
"
211092064,65,bendikro,2016-04-17T19:29:10Z,"The `Couldn't listen on 0.0.0.0:8112: [Errno 98] Address already in use.` indicates the port is taken.
"
211093007,65,bendikro,2016-04-17T19:34:20Z,"If running deluge-web and GTKUI, and then trying to enable webui plugin I get that error, which is expected, no? [PR68](https://github.com/deluge-torrent/deluge/pull/68) includes improvements to handle this better.
"
211120839,65,cas--,2016-04-17T21:46:53Z,"I know that the error indicates that but nothing else is running and the issue doesn't occur in thinclient mode...
"
211122183,65,bendikro,2016-04-17T22:02:31Z,"Ahh, yeah, that is due to the webui plugin creating two DelugeWeb instances, where the second one causes this trace because the first one is already listening on that port. This is not a problem introduced in this commit, but has existed for a long time. The other PR fixes this.

This commit is not supposed to fix all webui bugs, but simply restore the old behavior (before the latest JSON/WebUI changes)
"
211329966,65,cas--,2016-04-18T11:02:34Z,"Merged 64c67a0 
"
214396051,79,cas--,2016-04-25T15:30:19Z,"Was this a planned change? Is it possible that it's disk i/o blocking that's causing #2814?
"
214504461,79,aresch,2016-04-25T20:10:06Z,"I think it's reasonable to assume it's the blocking calls on the main thread causing the issue. If disk i/o blocking in general was the problem, I think that you would be seeing more frequent pauses and much lower throughput in the normal case (non resume saving time).
"
214554923,79,bendikro,2016-04-25T22:50:55Z,"Well, I have not tested that disk I/O is the problem in [#2814](http://dev.deluge-torrent.org/ticket/2814), so I'm simply assuming that based on the ticket reporter's description only.

If it's correct that it has to do with saving fastresume data, it is either due to libtorrent workload + handling alerts in Deluge, or it's the disk I/O. Libtorrent workload is threaded anyways, so the only thing we can address is the disk I/O.
"
215419098,79,bendikro,2016-04-28T13:14:52Z,"Now only queue the last call on shutdown
"
231753058,105,bendikro,2016-07-11T14:35:22Z,"Since libtorrent v1.1 is backwards incompatible, we should aim for support without any deprecated functions in develop. Have you tried compiling without deprecated functions?
"
231812409,105,minus7,2016-07-11T17:54:23Z,"I didn't compile lt without backwards compatibility, I just used the version provided on ArchLinux. Doing away with deprecated APIs sounds like a good idea though.
"
233004644,105,minus7,2016-07-15T16:46:17Z,"I'd suggest to merge this, so that lt 1.1 at least works with develop since lt with disabled deprecated APIs seems like a bigger change
"
233921087,105,cas--,2016-07-20T11:15:01Z,"After a discussion on IRC lt 1.1.1 release should fix these compatibility issues, if not raise a libtorrent issue.
"
249574838,105,minus7,2016-09-26T13:50:37Z,"Apparently there's some more incomatibilities with lt 1.1.1:

```
  File ""/usr/lib/python2.7/site-packages/deluge/core/preferencesmanager.py"", line 448, in _on_set_geoip_db_location
    self.session.load_country_db(str(geoip_db))
exceptions.AttributeError: 'session' object has no attribute 'load_country_db'
```

and

```
  File ""/usr/lib/python2.7/site-packages/deluge/core/torrentmanager.py"", line 1042, in on_alert_tracker_reply
    torrent.scrape_tracker()
  File ""/usr/lib/python2.7/site-packages/deluge/core/torrent.py"", line 1244, in scrape_tracker
    self.handle.scrape_tracker()
Boost.Python.ArgumentError: Python argument types in
    torrent_handle.scrape_tracker(torrent_handle)
did not match C++ signature:
    scrape_tracker(libtorrent::torrent_handle {lvalue}, int)
```
"
249895074,105,cas--,2016-09-27T15:13:15Z,"Please report to libtorrent issue tracker
"
258037049,133,cas--,2016-11-03T00:10:14Z,"Fixed docstrings and added extra tests using proper documentation IPs: [rfc5737](https://tools.ietf.org/html/rfc5737), [rfc3849](https://tools.ietf.org/html/rfc3849) 
"
258090984,133,bendikro,2016-11-03T09:01:59Z,"Excellent!
"
258107994,133,cas--,2016-11-03T10:30:23Z,"Still need a decision on the return type...
"
258372114,133,cas--,2016-11-04T08:39:46Z,"I have rebased and pushed a modified is_ipv6
"
258576525,133,cas--,2016-11-05T00:10:16Z,"Need to add python-interface as optional dependency to DEPENDS and perhaps add to pip install for tests
"
279133509,139,cas--,2017-02-11T09:51:33Z,What was the reason for closing this?
279133682,139,N3X15,2017-02-11T09:55:25Z,"Well, since it's been tried before and the behaviour described is discouraged, I decided it wasn't worth trying to make a duplicate PR and step on established security norms.  Since I appear to be the only person having this difficulty, even though I plan on releasing a public Firefox extension that may end up using this, a fork sounds like a better bet since it's probably a niche requirement."
279133851,139,cas--,2017-02-11T09:58:31Z,"Yeah fair enough, is there a way to workaround the issue though? "
279134019,139,N3X15,2017-02-11T10:02:32Z,"Running a proxy application, as someone suggested to me a while ago.

Something tells me a browser extension running a script or executable just to modify HTTP requests is a bit scary to some folk, though."
279134513,139,cas--,2017-02-11T10:12:29Z,"You could create a simple plugin to override the methods. I'm just not sure about adding this to the code.

I know that some users want to enable `CORS` which is another security issue and would only be added with the addition of a config option to enable it as required."
279134810,139,N3X15,2017-02-11T10:18:40Z,"The problem is the session itself:  This messes with the core authentication methods to ensure that A. We're told what our session ID is (previously, we had to get it via cookies, which is hard if you don't have access to them) and B. That we can tell the webUI provider what that session is via means other than cookies.  

Sure, we could hack around the session login part, but what if I want to upload a torrent?  I'd have to reimplement that to include a session setter.  What if I want to upload a magnet? Same thing.  It'd basically involve reimplementing the entire webUI.  Then it all comes back to, ""well, the WebUI is doing pretty much the same thing, why not just add in a tweak to the authentication system and call it a day?""

Another suggestion was to implement the deluge RPC protocol, but I don't see a decent rencoding library for Javascript, and I'm not smart enough to do it myself."
279135468,139,cas--,2017-02-11T10:32:04Z,"Did you try using `with_credentials`, that is the issue you are facing?

https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/withCredentials
http://stackoverflow.com/a/37955635/175584

For the plugin you should only need to override the methods you modified in this PR."
1018898697,342,CirnoT,2022-01-21T22:06:29Z,"@cas-- I strongly recommend either copying the file directly or merging this via git (either as merge or squash) - it seems that you prefer to take edits from PR and apply them yourself however you've missed quite a few of smaller changes that I've requested and @doadin made (such as unused `build_version` or inlining of useless `tmp_ret`).

It also seems you've missed pretty important change of
```diff
- tmp_ret2 = collect_all('twisted')
+ hiddenimports += collect_submodules('twisted', filter=lambda name: 'test' not in name)
```
which brings both build speed improvements but also decreases package size, as it stops PyInstaller from bundling tests (actually, some tests might even execute during import and break build if they're designed to throw!) used by PyInstaller"
1018928869,342,doadin,2022-01-21T23:06:48Z,Not home to test and I can't add labels for the cd to run. I can test later but looks ok to me.
1019214269,342,cas--,2022-01-22T11:57:29Z,"Can we avoid the use of single letters for variables, better to use something descriptive to help readability. 

Also would be nice to lint/format the file with black since it's python code

```
black packaging/win/delugewin.spec
```"
1019322588,342,CirnoT,2022-01-22T17:52:49Z,">Can we avoid the use of single letters for variables, better to use something descriptive to help readability.

Any idea what we can use instead? `e` refers to entry in `executables` while `d` refers to dictionary of that entry. We could also change it to use only `i` so the result would be `executables[i]['gtk']`

> Also would be nice to lint/format the file with black since it's python code

Done."
1019339459,342,DjLegolas,2022-01-22T19:03:39Z,"> Any idea what we can use instead? `e` refers to entry in `executables` while `d` refers to dictionary of that entry. We could also change it to use only `i` so the result would be `executables[i]['gtk']`

Hmm, you can call them `executable` and `data_dict`.
In addition, maybe do everything in the `Perform analysis`, `Executable` and `Collect` sections in one loop?
Just remove the last 2 for loops, and fix the indentation of the comments.
```python
for executable, data_dict in executables.items():
    # Perform analysis
    ...

    # Executable
    ...

    # Collect
    ...
```"
1019488945,342,doadin,2022-01-23T13:45:17Z,"> 
@DjLegolas 
I could be wrong in all of this however, some thoughts. I don't think you are supposed to run collect before you are done with analysis/executable. Maybe it will not matter in our case. Also maybe instead of data_dict since we have variables data and execute maybe executables_dict would be more on the nose. Also maybe script_name instead of executable since its not actually referring to a executable and rather the name of the script we are building for.

Edit: ok yes I think coll += can go in loop but not COLLECT. Maybe that just shows another point maybe instead of coll it could be exe_plus_data?"
1019493443,342,DjLegolas,2022-01-23T14:08:30Z,"@doadin - I have no knowledge about `pyinstaller`, so you might be correct.
I only commented about the code, which can be totally wrong :sweat_smile:


"
1019493749,342,doadin,2022-01-23T14:10:07Z,@DjLegolas yea just small differences. Other than the things cas forgot to merge I feel like most of this is just cleanup that could be put off not really import things happening.
1712587372,433,doadin,2023-09-09T19:45:28Z,"The pillow change fixes pip trying to compile pillow from source but is missing zlib headers(maybe others), you could set these up on your system/CI/CD or 9.5.0 works. They also recommend using the wheel if you don't want setup the headers.

The change to pyinstaller fixes a typelib error in freeze on windows saying freetype 2.0 is missing."
1712588090,433,doadin,2023-09-09T19:49:37Z,"I don't know if you can do both greater and less then in requirements but also not sure that it matters in this case as I think the versions of the deps are old enough that versions older are not likely to be used with the versions of python deluge supports, but idk."
1712589166,433,doadin,2023-09-09T19:55:50Z,"So I thought zope.interface change fixes python 3.7 but apparently not test still pass on 3.10, so I guess this is a python 3.7 issue?

The other two deps changes I believe are valid."
1712919646,433,mhertz,2023-09-10T19:38:45Z,"It's same issue also for py3.9(zope.interface), and I just reverted pyopenssl and cryptography to earlier versions(22.0.0/37.0.4) for quick fix(trial/error) when I ran into it last week.

Anyway, I looked little into it now, and don't have more time now, but found seemingly for some reason an older setuptools(47.1.0) is installed for python's under 3.10(tested 3.7, 3.9 and 3.10), and when upgrading setuptools afterwards to newest, then works. Probably need pin setuptools to 68.0.0, as latter two versions are py3.8 and up.

Also, in requirements.txt, then I believe twisted should be pinned to 22.10(or below), like in CI, as else: ""Nameerror fdesc is not defined"", when newest twisted installed.

Thanks! :)

Edit: Setuptools version variances because included already(as dep) with pip/python.

Edit2(last): In quick test here(not CI though), then pyinstaller 4.10 doesn't fail(py3.9.8), though have as always displayed a bunch missing typelib errors, originating from one of the hooks being buggy, though not important for us, as a misunderstanding those messages. Pyinstaller 5 broke freezing completely(hence 4.10 pin added), as respected those errors instead of just forward/log and ignore, but they gracefully fixed it for us in next version(maybe next again, can't remember, and I made PR to update pyinstaller and drop 4.10 pin, but I closed it later, and Cas thought not important to update at the time). Sorry if misunderstanding and 4.10 has actual error blocking on CI now and not just cosmetic, or that you already knew these things. Granted might as well update pyinstaller as well, and is confusing to end-users looking at, and just elaborating. Sorry for wordyness, and butting in - please let me know if I can help with something, and i'll but out again now."
1715775201,433,doadin,2023-09-12T13:54:59Z,seems related: https://github.com/zopefoundation/zope.interface/issues/255
1715841068,433,doadin,2023-09-12T14:30:33Z,@mhertz the pyinstaller issue is when running deluge after packaging not in the packaging process sorry I was not clear.
1717486003,433,mhertz,2023-09-13T11:56:43Z,"> seems related: [zopefoundation/zope.interface#255](https://github.com/zopefoundation/zope.interface/issues/255)

Good catch, yeah must've been fixed here presumably then: https://github.com/pypa/setuptools/pull/3153 for setuptools 62. Just strange because first thing I tried myself was mess with that(change install name), to no avail, and see requirements.txt and setup.py has the canonical name regardless, but whatever.

I guess the setuptools change should be added little up too in CI file, as still old version in log.

Sorry didn't ment to butt in here again, unless called, but will adhere to now promise ;) Thin line to walk for guessing if beeing perceived helpful VS annoying you know :) Thanks as said. "
1717778818,433,doadin,2023-09-13T14:46:14Z,@mhertz @cas-- I think this is all the changes I am going to put forth. The team over at twisted are looking into the issue with v23 and looking to improve their CI to prevent issues in the future. For now v22.8 is latest working.
1723451871,433,cas--,2023-09-18T13:47:34Z,"Thanks for the work identifying the build issues, I prefer that we identify and resolve each issue separately to properly understand the issue that is being fixed, as such I referenced your changes in new commits. 

Just to note that the versions specified in requirements are usually there as a project minimum/maximum rather than for CI/CD and shouldn't be removed without checking the commit history. There are likely some improvements to how we handle the dependencies for project, packaging and CI/CD.

Also until we specifically drop support for Python 3.7 I still want the runners for it. The total number of Python versions to test against should also be small so we don't have to wait too long for them all to finish. There could be an improvement where we run a single Python version for the PR/tests and then run against all versions once merged to develop branch."
1724151514,433,doadin,2023-09-18T18:26:28Z,@cas-- Thank you for making the required changes. I am sorry though I might have not been clear maybe? Or I just didn't notice a reference to it in your commits. However the change for pillow is not just for compatibility with python versions but there is also missing header files for compiling from source.(and part of why move to wheel) So maybe a comment in a commit mentioning zlib source headers missing from pillow source code for compiling pillow from source? idk. Again sorry either way if you did or didn't. And big thanks for making the changes!
1724195163,433,cas--,2023-09-18T18:54:08Z,Ah yeah I did find the other Pillow issue which is isolated to Windows 32-bit builds which as you say is due to missing wheels and trying build from source: 6c9b058d81639
1574758007,427,DjLegolas,2023-06-03T07:43:00Z,"@cas-- - this is going to be a dependency for some other MRs, so it will be best to merge this first.
I'll link each MR that needs this one so it will be easier to manage."
1575208396,427,DjLegolas,2023-06-03T21:40:35Z,Don't know why I'm responding to each message when I can just write here - all changed as suggested :)
1819033816,427,cas--,2023-11-20T13:08:12Z,"Thanks for this!

I did change my mind about the naming of the function and settled on `daemon_version_check_min`. I wanted it to be descriptive but not verbose, almost chose `is_daemon_version_at_least`! I did ponder creating a DaemonConnection class but not sure it would have gained much more clarity here."
251183413,109,cas--,2016-10-03T18:19:20Z,"The most likely reason is magnets that have not yet retrieved metadata: https://github.com/deluge-torrent/deluge/blob/develop/deluge/core/torrent.py#L1035

So this is not the correct fix and instead the code at [L76](https://github.com/deluge-torrent/deluge/blob/develop/deluge/ui/gtkui/piecesbar.py#L76) should be altered to accommodate for this use-case.
"
251195467,109,elemongw,2016-10-03T19:03:16Z,"It does not happen every time I download with a magnet link through. Any ideas why that may be? I am gonna do some more testing tomorrow in case I have better luck reproducing it.
"
251216767,109,elemongw,2016-10-03T20:27:15Z,"Nevermind you were right. How does it look now?
"
252226466,109,elemongw,2016-10-07T11:29:11Z,"Okay this should be as you asked. However, as you brought up refactoring maybe we should also look at __draw_pieces() and __draw_pieces_completed() as they could probably be merged into one function.
"
252253330,109,cas--,2016-10-07T13:34:55Z,"Cheers. If you are happy to try refactoring it, go ahead, it does look rather copy-pasted.
"
252695669,109,cas--,2016-10-10T18:04:17Z,"I've merged this change to fix the issue but feel free to open a new PR with refactored code. 6b630c9 
"
307647807,158,ratoaq2,2017-06-11T18:33:36Z,Done
307726894,158,cas--,2017-06-12T08:44:11Z,"That's great thanks. One final thing, could you update the commit message with [Core] tag and move the second sentence out of the summary.

http://dev.deluge-torrent.org/wiki/GitTips#CommitMessages"
308006512,158,ratoaq2,2017-06-13T04:54:30Z,Done
218720233,92,cas--,2016-05-12T10:34:09Z,"Could the autogen apidoc be added to setup.py docs command
"
163423339,47,cas--,2015-12-09T22:37:32Z,"Did you investigate using the reset timer thread option?
"
164567474,47,cas--,2015-12-14T21:37:15Z,"Merged: d13fca251ed57cf8
"
207960165,55,cas--,2016-04-10T10:51:00Z,"Thanks for this! Merged 5d1aff157e4dac
"
254485953,117,cas--,2016-10-18T11:57:08Z,"That is helpful, it's odd that I missed some of these from my last sweep :)

I think the iteritems changes should be done with six or similar as it could have a memory performance hit on python 2. However if there are areas where is make no obvious difference then then less we rely on py2to3 shims the better.

Oh there are several pylint issues needing attention. 
"
254586887,117,aresch,2016-10-18T17:53:55Z,"Yes, there could be some performance changes due to removing iteritems, etc.. but I don't think it's going to be that big of a deal since most of our data structures don't contain that many items.  I really wanted this change to not introduce any outside dependencies, plus it will give us more incentive to get the rest of  things Python 3 ready :)

I'll try to fix the lint errors.
"
255284597,117,aresch,2016-10-21T03:22:29Z,"I have no idea why this isort run fails.  On my machine I get no diffs..

[aresch@squid deluge]$ isort -q --diff --recursive deluge docs packaging *.py
[aresch@squid deluge]$ echo $?
0
"
255304705,117,bendikro,2016-10-21T06:31:17Z,"What if you run `tox -e isort`?
"
255306675,117,aresch,2016-10-21T06:45:04Z,"Yea, if I run tox2 -e isort I get the same output from travis.  I'll just make a change based on that diff.
"
255326055,117,cas--,2016-10-21T08:38:37Z,"Those changes to `new` and `HTMLParser` imports are definitely incorrect, what version of isort is installed via pip? I have 4.2.5 and it gives the same output as tox.
"
255326945,117,cas--,2016-10-21T08:43:01Z,"Just noted that the `new` import should be changed for Py3 as that module has been [removed](https://docs.python.org/2/library/new.html). Which funnily enough if you also take into account that [HTMLParser](https://docs.python.org/2/library/htmlparser.html) is renamed in Py3 explains your isort issue... :P
"
255608212,117,aresch,2016-10-23T19:20:10Z,"I think this looks OK to merge now?  There are plenty more fixes necessary for Python 3, but we should get this merged now so we have a better base to work from for the future fixes.
"
255779054,117,cas--,2016-10-24T15:44:30Z,"I've a new pull request with the branch rebased and some extra changes #124
- Rebasing the develop branch rather than merging it in is better as it creates quite a commit mess otherwise.
- Using `git commit --fixup/--squash` or modifiyng the commits that need fixed is much easier to rebase into a short set of commits.
- For pylint we use the full name rather than the shortcode and place the disable comment inline with the offending code.
"
1006862850,334,cas--,2022-01-06T19:21:54Z,"Can you provide an example magnet to replicate this issue, I think there might be a deeper problem to solve here "
1006927666,334,mhertz,2022-01-06T20:54:14Z,"It's only issue in thinclient mode, not standalone.

Thanks alot DjLegolas, works great, much appreciated :)"
1006995347,334,cas--,2022-01-06T22:56:18Z,"The root of the problem is the sending of mixed str and bytes metadata dict to rencode. This can be solved by pickling the metadata dict and then encoding with base64 and reversing that process in the UI. 

Edit: I thought this might result in a breaking change between client and daemon but if it's already broken in thinclient... :smile: 

@mhertz Thanks for tip :slightly_smiling_face: "
1007008746,334,DjLegolas,2022-01-06T23:23:21Z,"@cas-- actually, seem as the metadata itself is only bytes inside the dict.
The info_hash is the only one that is being sent as a str/bytes, depending on standalone/thinclient."
1007550499,334,cas--,2022-01-07T16:34:58Z,"Sorry what I meant is it is a mix of raw bytes and encoded strs so there is no way to determine type when receiving without trying to catch the exception. 

It's certainly bad practice for the API calls to randomly switch types like this and we should be decoding as early as possible in the Python code when receiving data.

Further thought is to not bdecode the metadata in _on_uri_metadata. Instead send that metadata b64encoded and the client should use deluge.bencode.bdecode after b64decode.

It's up to you if you want to make that change, I can do it this weekend otherwise

Btw really don't worry about adding the GitHub PR close link, it's something I do from my end, just the Trac issue is required for future reference."
1008159935,334,DjLegolas,2022-01-08T21:46:24Z,"@cas-- tested your fix, still have an issue.
```
23:45:38.538 [WARNING ][deluge.transfer                   :72  ] Failed to decompress (26945 bytes) and load serialized data with rencode: 'utf-8' codec can't decode byte 0x87 in position 2: invalid start byte
```"
1008171328,334,cas--,2022-01-08T22:53:54Z,"Hmm okay. Did you update the daemon to latest code? I tested it here without issue so would need more information about how to replicate that

Edit: Oh I see you fix was for client side, I really don't want to have a hacky solution here though..."
1443823176,412,cas--,2023-02-24T15:09:59Z,"A quick review that this is a good start but we need to be aware of backward compatibility, both with libtorrent version and daemon version. "
1445288020,412,jiigen,2023-02-26T07:35:29Z,"> A quick review that this is a good start but we need to be aware of backward compatibility, both with libtorrent version and daemon version.

What requires the last version of libtorrent on git (and doesn't work with other versions) is the check on i2p_socket flag which can be eventually subsituted by a check on ip (i2p peers have 0.0.0.0:0 address) the ""pid"" i've introduced is even in older versions so it is not a problem. Anyway this code is just a matter of visualization everything works fine even without it but it's ""ugly"" to see an empty peer list :-)

What would be nice to add as a feature is the option to disable dht and pex (these are not yet available when using i2p in libtorrent) when selecting the i2p proxy and an option to enable mixed mode (this one is actually possible only with the ltconfig plugin)."
1567078552,412,cas--,2023-05-29T12:28:26Z,"> What requires the last version of libtorrent on git (and doesn't work with other versions) is the check on i2p_socket

I can see the relevant changes but the code actually needs to handle when that attribute is missing for backwards compatibility.

For the same reason the UI client code needs to handle connecting to older daemons that do not have `pid` or `i2p` keys in the peer dict from get_peers.

We really should have tests associated with the core changes.

"
1573302962,412,jiigen,2023-06-02T07:46:18Z,"> > What requires the last version of libtorrent on git (and doesn't work with other versions) is the check on i2p_socket
> 
> I can see the relevant changes but the code actually needs to handle when that attribute is missing for backwards compatibility.
> 
> For the same reason the UI client code needs to handle connecting to older daemons that do not have `pid` or `i2p` keys in the peer dict from get_peers.
> 
> We really should have tests associated with the core changes.

In the latest libtorrent version (2.0.9.0) there have been some changes in managing i2p:
1 - It's no more needed (but according to devs it has never) to set a proxy for i2p but it's enough to set i2p_hostname and i2p_port parameters.
2 - there's now a function to get the i2p address (destination): peer_info::i2p_destination() (which under my request has a python binding too) so using the pid can be now dropped.
3 - There are new option to fine-tune the i2p SAM connection: tunnels outbound and inbound lenght and quantity.

So I think that my pull request is now outdated.

"
2311069268,460,zakkarry,2024-08-26T20:50:09Z,rebased.
216031340,84,cas--,2016-05-01T09:48:24Z,"The problem I have with reverting that change is we don't have a ""why"" it is needed and I cannot replicate on Ubuntu. Also is was renamed to a `private` method suggests that we should not be using it.
"
216056877,84,doadin,2016-05-01T17:19:19Z,"Well im not 100% but it seems like connect is timing out when called the first time why exactly i don't know, and why it doesn't connect after deluge is like fully loaded since it shouldn't have a reason to time out i don't know.

And that brings me to the next part yes it is happening on windows(you dont test on windows?) so maybe its a windows only bug? So unless we can figure out a better fix or get twisted to fix it i believe its out of our control and at least for now have to revert it.
"
216058968,84,doadin,2016-05-01T17:55:46Z,"also did you read the log i added to the ticket?
"
216065252,84,doadin,2016-05-01T19:14:20Z,"Just to like super verify this i just remade an entire system os and all and still got this issue. Feel free to do the same and test windows if you like.
"
217566900,84,cas--,2016-05-06T21:45:42Z,"None of the current devs have Windows machines, I certainly would only test it closer to release in virtualbox.

Thanks for the PR but I need to write a slightly modified and descriptive commit: 21789e0692d36
"
217573601,84,doadin,2016-05-06T22:07:39Z,"All good, i kinda figured since there was this and that one other commit that broke windows, dont remember which but any who. Im thinking of adding a jenkins job to my build pc to keep a closer eye on commits so i dont have to revert and try 10 different commits or w.e. when a issue comes up.

Thanks for fixing.
"
221107550,101,cas--,2016-05-23T21:53:22Z,"Made some minor changes and updated docscrings
"
221108333,101,bendikro,2016-05-23T21:56:45Z,"Close to perfection :-)
"
257147394,128,cas--,2016-10-30T12:09:21Z,"I think `openbt.png` can be deleted, I removed the test but forgot about the icon.
"
257147519,128,bendikro,2016-10-30T12:12:11Z,"Removed
"
257152660,128,bendikro,2016-10-30T14:01:14Z,"Does this look better?
"
257559301,128,cas--,2016-11-01T12:54:23Z,"Merged, thanks!
"
394121285,186,doadin,2018-06-02T22:23:32Z,"It does take ip address on windows. there is no ""eth0"" or the like on windows. this breaks windows support. like @asavah said I think the only thing that should have changed is removing it setting 0.0.0.0 by default so you dont end up with a invalid setting on linux and then we should just either remove the is_ip check all together or only make it check if its an ip on windows.

https://github.com/arvidn/libtorrent/blob/master/include/libtorrent/settings_pack.hpp#L172

> Binding an outgoing connection to a local IP does
> not necessarily make the connection via the associated NIC/Adapter.

> not necessarily

not is an invalid option.

>Adapter names on unix systems are of the form ""eth0"", ""eth1"",
>""tun0"", etc.

on windows the only closest equivalent is a something like 40 character GUID. libtorrent does NOT accept that. nor does is accept the associated adapter ""name"" eg. ""Local Area Connection""."
394121718,186,doadin,2018-06-02T22:33:04Z,https://github.com/arvidn/libtorrent/blob/RC_1_1/include/libtorrent/string_util.hpp#L76
394141757,186,cas--,2018-06-03T07:00:45Z,"I wanted to fix the code quickly to what is written in the libtorrent docs
as it was broken for Linux.

You can make another PR to add Windows support. Perhaps some tests to
ensure that it is correct for Windows and Linux now that we have Appveyor.

Also ask Arvid to update docs

On Sat, 2 Jun 2018, 23:23 doadin, <notifications@github.com> wrote:

> It does take ip address on windows. there is no ""eth0"" or the like on
> windows. this breaks windows support. like @asavah
> <https://github.com/asavah> said I think the only thing that should have
> changed is removing it setting 0.0.0.0 by default so you dont end up with a
> invalid setting on linux and then we should just either remove the is_ip
> check all together or only make it check if its an ip on windows.
>
> â€”
> You are receiving this because you modified the open/close state.
> Reply to this email directly, view it on GitHub
> <https://github.com/deluge-torrent/deluge/pull/186#issuecomment-394121285>,
> or mute the threa
> <https://github.com/notifications/unsubscribe-auth/AAk_VgFJQOmMu1Rc0Fnn9Xo6-2cGTbMaks5t4xBlgaJpZM4UXyog>
> d
>
"
397685376,189,DjLegolas,2018-06-15T17:09:57Z,"ok, so i added everything but there is something strange.
It doesn't catch any errors returned.. for example look at the ```onAddClick``` in the file ```autoadd_options.js```.
Does the callbacks functions passed to the ajax are ```success``` and ```error```? as only the ```success``` callbacks are being called."
397907226,189,cas--,2018-06-17T21:17:59Z,"Excellent, I shall have a look. I also noticed the multiple listings of autoadd plugin, I'm sure I encountered this before with other plugins but cannot remember the fix atm."
397907989,189,DjLegolas,2018-06-17T21:32:53Z,"> I also noticed the multiple listings of autoadd plugin, I'm sure I encountered this before with other plugins but cannot remember the fix atm.

Currently I set the ```prefsPage``` of the plugin as a static member of the ```Deluge.plugins.AutoAddPlugin``` class and check it's value before adding a page."
404262038,189,cas--,2018-07-11T18:11:51Z,"> Does the callbacks functions passed to the ajax are success and error? as only the success callbacks are being called.

Just checked code and it should be `success` and `failure`"
404590187,189,DjLegolas,2018-07-12T17:33:42Z,"Ok, now everything suppose to work, including showing errors."
404604213,189,cas--,2018-07-12T18:19:28Z,"Thanks for this, merged!"
439000212,226,cas--,2018-11-15T10:55:02Z,"Ah okay, I was testing with x64.

As I said adding `GObject.threads_init` does nothing here. The change that made the difference is the removal of the `Gdk` `threads_init`, which has disabled threading. 

I did read the following so likely solution is to disable the use of Gtk/Gdk theading on Windows but perhaps it should removed entirely since it is deprecated in Gtk3.

> Using GTK+ from multiple threads on Windows doesn't work at all, and would require substantial work and complexity to fix. "
439185265,226,doadin,2018-11-15T20:50:34Z,"so far I have tested 3 VMs. working on a fourth. Trying to eliminate any environment issues. All builds I have tested using appveyor gtk build.
1. win7 ult x64 with x86 and x64 python windows themes enabled = threading issue(my build ive used for over a year now)
2. fresh win7 ult x86 with python x86 windows themes enabled = threading issue
3. fresh win7 ult x86 with python x86 windows themes disabled = NO threading issue
4. fresh win10 enterprise x64 with python x86 windows themes enabled OR disabled = NO threading issue
5. fresh win7 ult x64 with python x86 = in testing

Perhapse with a bit more testing we can maybe just exclude win7 in threading and leave for others. Im willing to test xp and 8.1 if this is a route to be considered."
439195866,226,doadin,2018-11-15T21:26:19Z,"Interesting results I have actually found that there windows theme influences the results. Being that im testing in a VM with default drivers windows aero doesn't load. However installing the WDDM driver and enabling aero deluge runs with threading. results 100% replicable by starting/stopping the ""Themes"" windows service. Will update this comment and previous with results.

being that aero isnt the same in 8+ im guessing it works in those and vista/7 would be the only ones requiring a change."
439205343,226,cas--,2018-11-15T21:58:28Z,"Those are interesting results.

It's really not an issue to disable threading, just need to be aware that this has been done and that in future if there are any UI lockups when running certain code then that code will need to be run in a thread."
502630313,226,cas--,2019-06-17T10:39:35Z,"Thanks for the suggested changes.

pywin32 is the official and latest version so this is not going to be changed.

"
429245744,215,cas--,2018-10-12T08:22:06Z,Please explain how this is bad?
429457530,215,PhilHudson,2018-10-12T20:47:37Z,"On a unix-alike OS -- GNU+Linux, MacOS X, *BSD, anything that supports symbolic links -- say my deluge config file is kept under source control at $HOME/scm/$OS/$HOST/$HOME/.config/deluge/core.conf and I have a symbolic link which points to it at the usual location $HOME/.config/deluge/core.conf -- currently when I save any config changes, a complete config file will replace that symlink -- *not* its target -- instead of Doing The Right Thing, which would be to follow the symlink (using os.path.realpath) and overwrite the target file it points to. Changing a file's type from symlink to text file tramples on the user's legitimate wishes and intentions, for no good reason and no benefit to anyone. The change I propose loses nobody anything and gains symlink users correct application behavior, would be my claim in support of it. (For clarity, os.path.realpath returns its argument unchanged if it is not a symlink). I hope this clarifies why the current behavior is bad."
429611433,215,cas--,2018-10-14T09:55:52Z,"Thanks, I just needed to know the use-case. The badness is completely subjective."
429620357,215,PhilHudson,2018-10-14T11:56:47Z,"It is unacceptable for any program to change a symbolic link to a data file without confirmation, at any time, for any reason, or as in this case, for no reason at all. Doing so is objectively a bug. This PR is the one-line fix you need. You lose nothing by doing the right thing; you gain nothing by doing the wrong thing. Please accept the change."
429627923,215,cas--,2018-10-14T13:48:10Z,"Please don't muddy PR discussion with unneeded hyperbole.

This is a feature request, there has never been an expectation that Deluge config files could be symlinks and a program overwriting it's own config files is perfectly acceptable, it is perhaps undesirable for a narrow use-case but that is all.

I am willing to accept the PR however from my point of view I first need to consider what the change is, why it is needed and if/how it will impact the thousands of other users who have never required this feature before. Also what happens if a user then requests that the state files or the entire config directory should be able to be symlinked, do we also make that change? How acceptable is it that the `.new` and `.bak` files will also be created in the symlinked location? Rarely are changes to a project trivial.

One change that will certainly be needed is the commit message to better describe why the change is being made, without any vague 'this is bad' comments.

"
429635232,215,PhilHudson,2018-10-14T15:22:57Z,"I take your point about hyperbole and vagueness. I will try to keep it calm and collected. I'm with you 100% on due diligence and will be glad to help in any way I can. Just to be clear though, I never advocated against the program overwriting its config files; quite the contrary! I am saying that overwriting a symlink which points to the config file is precisely *not* overwriting the config file, it's overwriting something else somewhere else. As to whether this PR is a bug or an RFE, I don't care what it's called so long as it gets in. I will simply observe that most programs exhibit the correct behavior. (deluge is definitely not the only one overwriting symlinks though.)

I also wondered about the `.new` and `.bak` files. As a first pass, I would suggest the right place for `.new` is `$TEMP` or `%TEMP%`, and for `.bak` it's the target config file's enclosing directory (no change for `.bak`, in other words)."
429646768,215,PhilHudson,2018-10-14T17:48:42Z,"I've updated the commit message. I think it still needs work, but is it at least a bit better now?"
431673314,215,cas--,2018-10-21T14:25:37Z,Updated the commit and merged: c01679de1f24ea11
1049024176,380,cas--,2022-02-23T17:24:07Z,"When adding the service file to the code I discussed that there was no need for a separate user service file since they are identical service files: https://dev.deluge-torrent.org/ticket/2034#comment:13

I'm not seeing anything here that would change that? Maybe what is missing is additional documentation for installing a user service file?"
1049102548,380,WhyNotHugo,2022-02-23T18:51:26Z,They have some differences identical: the user service includes a `Slice` and depends on a different target (the user service manager and system service manager have different targets). Copying one into the others location won't work.
1049164087,380,cas--,2022-02-23T20:03:29Z,"Ah I was unaware that user service doesn't include `multi-user.target`. Would setting the service to use `default.target` be a solution as I see it is usually symlinked to multi-user anyway? I know that the `wantedby` can be overridden but could that be more complicated that a separate service file :thinking: 

Why include `Slice`, I not sure I see the benefit here for the single deluged service? And why only for the user service?"
1049176970,380,WhyNotHugo,2022-02-23T20:18:13Z,"Including the Slice indicates to the service manager that this is a background service. This can be used to handle OOM situations, or prioritising foreground processes. There's no equivalent for system services.

I'm not sure about pulling the system service for `default.target`; I don't know how that interoperates when booting into rescue mode or other special modes. It might be fine, but I can't guarantee it.

Ultimately though, shipping the two distinct files makes life easier for packagers of systemd-based distros since it signals that they can just copy both of them to their respective locations. I would also like to include a `sysusers` file for the system service to automatically handle that user (mostly to de-duplicate work that being repeated downstream). I'd rather tackle that last item separately though to scope the PRa better."
1049208084,380,cas--,2022-02-23T20:55:39Z,"Okay this change makes sense, thanks for details.

We would need the same for web service though



"
1057088622,380,WhyNotHugo,2022-03-02T15:57:40Z,Thanks for wrapping this one up. :+1: 
1573980616,404,DjLegolas,2023-06-02T16:11:24Z,"I think I'll replace the torrent I use for the test with another one, with less inner files/dirs.
In addition, probably it will be best to also add tests for single file and hybrid torrents before merging."
1574417165,404,DjLegolas,2023-06-02T23:03:17Z,"Well, added both and must note that the default `FileTree` parser will be according to the BTv1 spec."
1037310929,372,cas--,2022-02-12T17:01:32Z,Nice set of tests :+1: 
1037314099,372,gazpachoking,2022-02-12T17:05:30Z,"> Nice set of tests ðŸ‘

Agreed. lgtm!"
211375833,68,bendikro,2016-04-18T13:18:28Z,"Updated to avoid stack trace when killing deluge-web with CTRL-C
"
211393798,68,cas--,2016-04-18T14:02:46Z,"could you rebase please
"
211407852,68,bendikro,2016-04-18T14:39:53Z,"Oops, sorry
"
211408683,68,bendikro,2016-04-18T14:42:24Z,"Fixed
"
211415644,68,cas--,2016-04-18T14:57:01Z,"Merged: [70d8b65f0a499]
"
254491657,112,bendikro,2016-10-18T12:25:52Z,"Ah, yeah, I forgot to label the last commit with the ticket #2875.
But I don't see what the web test should be a separate commit? It is added to verify that the bug is fixed.
I do see that it may look cleaner, but imo, tests and implementation really goes together.
"
254515286,112,cas--,2016-10-18T13:56:54Z,"To me it looks like Web test refactoring that's not directly related to the bug?
"
254527057,112,bendikro,2016-10-18T14:34:31Z,"Well, `deluge/tests/test_webserver.py` contains the new test, but there were some refactoring to reduce code reuse.
"
254573262,112,cas--,2016-10-18T17:04:59Z,"It'd be best to have an initial 'refactor web test code' then 'fix bencode' followed by 'fix filehash (with tests)'. Currently the commits are not distinct with filehash tests in bencode commit... (I think this was the original gist of my comments :)

Keeping issue commits clean is important for historical viewing, blame and merging especially where there is a clear defined bug and fix.
"
254750108,112,bendikro,2016-10-19T08:38:21Z,"Ahh, I see the misunderstanding. The test together with `[#2900] Fix Error loading torrent: invalid bencoded value` was not supposed to test the filehash field, but the bencode issue, but I think I forgot that somehow, and tested the filehash twice. After creating the new torrent with the filehash field, the bencode issue cannot be reproduced on that torrent, so the test is pointless atm.

I'll move the json issue into a separate PR.
"
256924572,112,cas--,2016-10-28T13:48:43Z,"Thanks for effort on this! Merged: 41fed16d
"
255901424,124,aresch,2016-10-25T00:14:24Z,"The changes to the commands/config.py look correct to me.  The next() function will call the correct function on the object to get the next iterable, .next() for Python2 or .**next**() for Python3.  Instead of passing the 'next function' to the atom function, we just pass it the object and let it do next(obj) instead of calling .next() or .**next**() on the object directly.
"
255901906,124,aresch,2016-10-25T00:17:49Z,"The changes to import the zip from future_builtins will require a new dependency for Deluge.  This is probably OK, but we need to make sure it ends up in DEPENDS at a minimum.  As an aside, have we considered creating a proper requirements.txt file instead of the DEPENDS file? This would make it easier for people to do a simple pip install -r requirements.txt to fetch (most) of what's necessary.
"
255902238,124,aresch,2016-10-25T00:20:02Z,"The fixes to division look good.  I was a bit worried about doing this and was going to do it in a separate PR, but I think what you've done makes sense.  The other option would have been to import in an old_division function from futurize but I wasn't terribly keen on that.
"
256001866,124,cas--,2016-10-25T10:48:43Z,"What new dependency for [future_builtins](https://docs.python.org/2/library/future_builtins.html)? It is included in Python 2. 

I have been looking at requirements.txt for pip but I'm not sure how much it will help on Linux as all the requirements are packaged and still need gtk and libtorrent from source or package. I am careful to ensure that dependencies are widely available to ensure ease of installation for end user.

We will need the dependency on python-future for the next stage of changes, it's unavoidable. But that is now available as a package for distros so not an issue.
"
256229825,124,aresch,2016-10-26T02:01:39Z,"So it is.  I must have tried importing it with python3.

This PR looks good to me.
"
256301593,124,cas--,2016-10-26T09:54:20Z,"@andar I have had to revert the iteritems changes as it has too many issues needing resolved. Namely `exceptions.RuntimeError: dictionary changed size during iteration`. Either we go through each change and decide what exact operation is needed or use `future` to apply the changes with the py2 shim.
"
256405201,124,aresch,2016-10-26T16:34:08Z,"Yup, that sound good to me.  We can fix it or import something from the futurize package like you said.
"
352585895,155,DjLegolas,2017-12-18T23:03:14Z,"I wrote a handler in ef6ca96.
On [`WM_QUERYENDSESSION`](https://msdn.microsoft.com/en-us/library/windows/desktop/aa376890(v=vs.85).aspx) message, Deluge will register itself as a Shutdown-Blocker.
Next, when receiving [`WM_ENDSESSION`](https://msdn.microsoft.com/en-us/library/windows/desktop/aa376889(v=vs.85).aspx) message, Deluge should have 30 seconds to save all the data - depending on whether critical shutdown or not.

But the lack of a proper tool for testing this makes me feel like the is something wrong with my work."
428009075,155,DjLegolas,2018-10-08T23:17:18Z,"So, I was trying to implement what you suggested, and now the GTK crashes...
The only errors I found related are `0xc0000005` (Access Violation) followed by `0xc000041d` (An unhandled exception was encountered during a user callback)... Still not sure why."
428111143,155,cas--,2018-10-09T08:44:50Z,"Oh hmm, probably some issue with setting up SetWindowLong. Don't worry about the pywin32 deprecation, it can wait, I posted it here as a reminder until everything is working."
336661750,170,cas--,2017-10-14T19:38:33Z,Yeah I have no idea why it was switched to a single file either and have been mulling this change to mitigate data loss and few reads/writes. I would not want to put this change into `1.3-stable` but more than welcome for it to go into `develop` for 2.0.
336674698,170,aresch,2017-10-14T23:30:13Z,"Sorry, I meant to reply to this when I first saw it.

This was a long time ago, but I think the reason to make it a single file was the same as you have now splitting it up -- performance.  I think writing a lot of small files (especially with very large sessions) could cause some slow downs, but it could have just been the way it was done at the time.  I could see a slow disk causing some issues.  For what it's worth, my original implementation was single files and my intention was to allow updating individual fast resume data without having to write out a large file each time.  *shrug*

I'm ok with changing it back to separate files, but I think cas is right that we should probably stage that for 2.0."
354626028,170,AllSeeingEyeTolledEweSew,2017-12-31T22:19:31Z,"I'm a little concerned that 2.0 is ... very far away. I found this bug of *7 years* slated to be fixed in 2.0: http://dev.deluge-torrent.org/ticket/1466

Is there any way I could modify this change so it's more acceptable for 1.3?"
354663964,170,cas--,2018-01-01T17:04:35Z,I am working on this currently so will be in a 2.0 release 
355792641,170,AllSeeingEyeTolledEweSew,2018-01-07T01:47:14Z,"Sorry -- is that to say you're currently working on state in multiple files, in 2.0?

One of the reasons I'm interested in 1.3 over 2.0 is that the (fairly large) private trackers I use allow 1.3 in their client whitelists, but not 2.0. Tracker administrators do not like beta clients at all."
356362505,170,cas--,2018-01-09T17:54:25Z,"There is nothing new going in to 1.3-stable only critical bugfixes. Help with getting 2.0 to release status is always appreciated. The problem has been that too many features were added to develop and squashing all the resulting issues takes time and in that time many many bugs in 1.3 needed also fixing...
  "
357148297,170,AllSeeingEyeTolledEweSew,2018-01-12T05:42:01Z,"Closing then.

Thanks for your time. Unfortunately as I mentioned before, the project driving these PRs is tied to private trackers, so I won't be able to meaningfully test this code against a development branch for some time."
500986759,244,cas--,2019-06-11T19:23:48Z,"Thanks merged!  a34543100c5



"
501449196,244,thelamer,2019-06-12T20:47:22Z,"@cas-- is there a disconnect with your downstream debs  or does stuff from this repo not go into those ? 
The latest release we pulled in does not have this change but you merged and tagged it properly here. 

Grab deb:
```
mkdir delugetmp
cd delugetmp
wget http://ppa.launchpad.net/deluge-team/stable/ubuntu/pool/main/d/deluge/deluge-web_2.0.3-1~201906082034~ubuntu18.04.1_all.deb
ar x deluge-web_2.0.3-1~201906082034~ubuntu18.04.1_all.deb
tar xf data.tar.xz 
```
output: 
```
thelamer@drop ~/delugetmp $ cat usr/lib/python3/dist-packages/deluge/ui/web/server.py |grep country
        request.country = path
        path = ('ui', 'data', 'pixmaps', 'flags', request.country.lower() + '.png')
```"
501457568,244,cas--,2019-06-12T21:13:10Z,Thanks!! I forgot that it needs to pull the git repo before hitting build button! I'll fix it just now
501458099,244,cas--,2019-06-12T21:14:58Z,I assume the version is still showing as 2.0.2 for `deluge-web --version`?
501471598,244,downtowns,2019-06-12T22:03:07Z,"the linuxserver/deluge docker container I pulled down earlier today reports:
deluge-web 2.0.3-1-201906082034-ubuntu18.04.1
libtorrent: 1.1.5.0
Python: 3.6.8
OS: Linux 4.9.125-linuxkit

Which aligns with ""latest"" listed at https://hub.docker.com/r/linuxserver/deluge/tags"
501478785,244,cas--,2019-06-12T22:32:26Z,A new version `2.0.3-2~201906121747` has been published
501484364,244,thelamer,2019-06-12T22:57:45Z,"![flags](https://user-images.githubusercontent.com/1852688/59391944-c4b74a00-8d2a-11e9-9d80-4e9d41f4e2db.png)
All good now thanks!"
548322833,256,cas--,2019-10-31T11:18:00Z,"> https://developer.gnome.org/gtk3/stable/GtkExpander.html#GtkExpander--s-expander-size
> GtkExpander:expander-size has been deprecated since version 3.20 and should not be used in newly-written code.

expander-size for GtkTreeview does not appear to have been deprecated. Also deprecated in 3.20 is not a big issue as we still target 3.10.

https://developer.gnome.org/gtk3/stable/GtkTreeView.html#GtkTreeView--s-expander-size"
548346453,256,doadin,2019-10-31T12:22:11Z,"> > https://developer.gnome.org/gtk3/stable/GtkExpander.html#GtkExpander--s-expander-size
> > GtkExpander:expander-size has been deprecated since version 3.20 and should not be used in newly-written code.
> 
> expander-size for GtkTreeview does not appear to have been deprecated. Also deprecated in 3.20 is not a big issue as we still target 3.10.
> 
> https://developer.gnome.org/gtk3/stable/GtkTreeView.html#GtkTreeView--s-expander-size

Does it not work in 3.10? Even though it hasn't been removed yet would it still be nice to get ahead for when we do move on/it is removed? Idk i was partly going based on gtk3 docs."
901875380,288,Erarshad,2021-08-19T12:31:38Z,"https://github.com/CCExtractor/Deluge-mobile-remote-client
now deluge mobile client is also available for android and ios. it is open source fork repository give star and feel free to send PR"
997355409,288,cas--,2021-12-19T09:16:22Z,"Looks good, I'll merge it next time I'm working on the code. 

I thought we might need to leave core method stub for deprecation but core should not be a hard dependency for a UI component. Try to include your reasoning for making changes in the commit message."
997356046,288,cas--,2021-12-19T09:21:37Z,I did actually find that the Console UI is also depending on a core module: https://dev.deluge-torrent.org/ticket/3491
997383042,288,DjLegolas,2021-12-19T12:21:43Z,"I'll look into it.

In addition, I have a problem with adding the security only unittest to the CI.
Do you have an idea?"
890389292,312,cas--,2021-07-31T18:48:26Z,fyi the failing tests are due to Twisted 21.7.0 release with incorrect twisted defer import in test_torrent
890425484,312,iczero,2021-08-01T00:58:42Z,"torrent_test.py `test_torrent_error_resume_data_unaltered` seems to fail with libtorrent 2.0, maybe it's the same issue as with 1.2?

`test_console_command_add` in test_ui_entry.py seems to hang, currently trying to figure out why

edit: ~~deluge-console seems to hang, but deluge-web and deluge-gtk work fine~~ deluge-console seems to work entirely fine outside of tests, but hangs when doing tests.
edit 2: deluge-console will silently hang if connecting to localhost, username/password aren't provided, and `localclient` isn't in the auth file. (this should be unrelated to tests)
edit 3: I give up, test_ui_entry refuses to work and I can't figure out why. I've got an instance running with libtorrent 2 for a day now and it's been stable"
890446310,312,iczero,2021-08-01T04:15:22Z,"It seems the disk cache was removed from libtorrent in favor of mmap, but I'm not sure. There's still a few places in deluge that request `disk.num_blocks_cache_hits` and `disk.read_cache_blocks`, which no longer exist."
896624624,312,ghost,2021-08-11T08:38:43Z,No releases in 2 years and you're adding v2 support!
924389304,312,cas--,2021-09-21T21:14:52Z,"I have merged the Stats plugin commit: ea609cd3e0193c395

I'll have a look at what is needed for libtorrent 2.0 support


"
933001794,312,cas--,2021-10-03T18:27:52Z,"Merged 89189adb24321c

"
933002129,312,cas--,2021-10-03T18:30:22Z,"Thanks @iczero

I added a workaround for lt 2.0 file_progress issue until fixed in 2.0.5 and the tests are very slow for some reason under lt 2.0"
52536086,7,cas--,2014-08-18T18:41:42Z,"The codepainter changes should be rebased into the original commit.
"
52561119,7,omaralvarez,2014-08-18T21:55:19Z,"Everything should be fixed, you were right in everything that you pointed out.
"
52614462,7,cas--,2014-08-19T10:16:42Z,"Ok it looks good, the only problem I can see is that the `Port` entry box is not given enough space and entering a port number causes `hBoxHost` to shift left. I think putting port on the line below would be better. The vertical space shouldn't be an issue as it's unlikely anyone is going to be putting more than a few entries in Recipients box, although you could use `hideHeaders` to match the gtk layout and save a little space. 
"
52614671,7,omaralvarez,2014-08-19T10:18:56Z,"Yup, I agree, I'll make the changes as soon as I can.
"
52643135,7,omaralvarez,2014-08-19T14:35:30Z,"Everything should fixed. I also made the password not visible.
"
52652417,7,cas--,2014-08-19T15:35:40Z,"Thanks, I added a commit with a few minor changes to fix alignment. 
"
59324763,20,doadin,2014-10-16T07:39:48Z,"If deluge is compiled and run from python, deluge_exe = C:\Python27\Deluge.exe when it should be C:\Python27\Scripts\deluge.exe in order to work. There for if the file path that is made by deluge_exe doesnt exist dont set a registry key to associate magnets with a non existing program.

I believe this is the only case this will happen. Since its just giving the path to python.exe and then adding deluge.exe we could maybe just set deluge_exe like it is but just add ""/Scripts"" to it in a try block or something but thats up to you devs.
"
59330542,20,doadin,2014-10-16T08:38:00Z,"Updated this to still work if run from python but still set the exe path like it was if its not. IMO the check to see if the file set by deluge_exe exists should still be in place to prevent any odd cases.
"
59330983,20,doadin,2014-10-16T08:42:26Z,"Fixed syntax issue should be all set now.
"
59331179,20,doadin,2014-10-16T08:44:23Z,"opps now it should be lol
"
60383636,20,doadin,2014-10-24T13:04:12Z,"is there anything else i should do?
"
61934843,20,doadin,2014-11-06T07:00:18Z,"This one is all clean too.
"
250022422,108,cas--,2016-09-27T22:52:28Z,"I'm sorry this has to be fixed in libtorrent as a deprecated method. By all means provide to package managers as interim workaround.
"
250068726,108,minus7,2016-09-28T04:27:24Z,"I'm not sure how this should be solved then. To my understanding, the method was removed at your request to be able to distinguish whether the feature is available or not: https://github.com/arvidn/libtorrent/issues/927
"
250085951,108,aresch,2016-09-28T06:49:43Z,"This seems like a reasonable fix to allow Deluge to work with newer versions of libtorrent.  Why don't we just include it? It's harmless if the function is re-added to future libtorrent versions.
"
250112196,108,cas--,2016-09-28T09:04:15Z,"I forgot about that change... So the actual fix is for the try block to also catch the AttributeError, at the time I think I assumed a RuntimeError would be raised.

@aresch I am trying to avoid any changes to 1.3 codebase so either 1.1 is backward compatible or it is not. I know this PR is for develop but these compatibility changes would have to be made to 1.3 as well.
"
250114444,108,cas--,2016-09-28T09:13:51Z,"Looking at the [1.3 code](https://github.com/deluge-torrent/deluge/blob/1.3-stable/deluge/core/preferencesmanager.py#L501) it has a general exception catch so that is fine.

I shall just commit the changes to develop code.

Thanks minus for investigating! :)
"
250120412,108,cas--,2016-09-28T09:40:46Z,"Fix details in [#2882](http://dev.deluge-torrent.org/ticket/2882)
"
255475693,122,elemongw,2016-10-21T21:59:50Z,"I wanted to avoid doing it this way so as to not introduce any extra potential slowness.
"
255480985,122,cas--,2016-10-21T22:32:53Z,"Which bit of code would be slow?
"
256302349,122,cas--,2016-10-26T09:57:49Z,"Thanks for these changes, I made a few tweaks and is now merged: c4282f29abbd
"
306238379,157,cas--,2017-06-05T16:41:40Z,"Thanks for this but how can this be scripted? All the png images under `deluge/ui/data` and `deluge/ui/web/icons` are generated from svgs.

Also this is failing the tests because you compressed a comparison png.
"
306244870,157,Fish2,2017-06-05T17:05:26Z,"I used AdvPNG and PNGOUT so you could probably use that but would have to add it to the build requirements which would then make the build bigger.

I have added a fix for the comparison test"
306249414,157,cas--,2017-06-05T17:22:19Z,It is a dev tool not for inclusion with build. I see that `advpng` is available for Ubuntu with `apt install advancecomp` so we can use that. The current scripts under `deluge/scripts` can be extended to run over the pngs and compress them.
306250425,157,Fish2,2017-06-05T17:26:14Z,that sounds good to me 
325446289,157,diogocp,2017-08-28T18:58:48Z,"advpng is not very good. pngcrush is also available in Ubuntu and will probably give you much better results. See https://css-ig.net/png-test-corpus for a comparison of various tools.

Converting the GIFs to PNG should also help."
399114868,157,cas--,2018-06-21T14:03:53Z,pngs have been compressed with zopflipng: fe42fb2c31d87b013
399701418,187,doadin,2018-06-23T19:03:06Z,this ok now?
399701962,187,cas--,2018-06-23T19:13:36Z,"I need to test what is and isn't allowed, I asked for clarification but no definitive answer: arvidn/libtorrent#3087"
426956647,187,cas--,2018-10-04T09:53:01Z,"After discussing with arvidn, I removed the checks and made the code changes: c415b097fe

Thanks for helping with this."
405284746,203,cas--,2018-07-16T15:23:33Z,"Merged, thanks."
626304275,289,cas--,2020-05-10T10:15:14Z,"In the commit message, please use [Core] instead of [TorrentManager], it's too specific. Can you also include a link to the github discussion, thanks"
789935024,289,kslr,2021-03-03T17:54:25Z,hey @cas--  Can you merge it ?
818581343,289,ghost,2021-04-13T09:10:45Z,why is it not being merged? why is deluge so dead?
821847878,289,cas--,2021-04-17T16:16:37Z,"thanks @DjLegolas, sorry took so long to merge: 8676a0d2a"
664199440,298,petersasi,2020-07-27T08:29:00Z,"AFAICS both updated files are about installing as service.
Correct me if I am wrong but as far as I know the EDIT: I am wrong. deluge-web-debug version of each executable is the one to be used for installation as a service. 

1. Maybe the above distinction is windows only? - EDIT: i have just installed a Focal, yes it, sorry it is confusing vs. Windows Deluge
2. I do find this very misleading, because in reality -L debug is the command line parameter that enables debug logging.
3. Not sure if it is my place to say, but I do usually promote using -L warning by default, this will log events that point to performance bottlenecks (e.g. reaching certain buffer / list  size / bandwidth limits)."
664387687,298,BenQuigley,2020-07-27T13:12:36Z,"> Maybe the above distinction is windows only? - EDIT: i have just installed a Focal, yes it, sorry it is confusing vs. Windows Deluge

No; you can see in the [code](https://github.com/deluge-torrent/deluge/blob/b1cdc32f7357e9777eb6cc2d90094c7d122af2eb/deluge/ui/web/web.py) that there's no `-d` option for `deluge-web` (which as you point out is a separate executable).

> I do find this very misleading, because in reality -L debug is the command line parameter that enables debug logging.
 
In the `deluged` executable, `-d` is for `--do-not-daemonize`. I think (but have not checked) this option may have once existed in `deluge-web` too, but either way, it needs to be removed from these service docs because when someone tries to build a systemd service that tells the system to run `deluge-web` with `-d`, it is going to fail:

```
$ deluge-web -d
Usage: deluge-web [options] [actions]

deluge-web: error: no such option: -d
```"
664451580,298,bendikro,2020-07-27T15:04:21Z,"> No; you can see in the [code](https://github.com/deluge-torrent/deluge/blob/b1cdc32f7357e9777eb6cc2d90094c7d122af2eb/deluge/ui/web/web.py) that there's no `-d` option for `deluge-web` (which as you point out is a separate executable).

On [line 63](https://github.com/deluge-torrent/deluge/blob/b1cdc32f7357e9777eb6cc2d90094c7d122af2eb/deluge/ui/web/web.py#L63) you find the statement `self.parser.add_process_arg_group()` which is a call on [deluge/ui/baseargparser.py:BaseArgParser.add_process_arg_group()](https://github.com/deluge-torrent/deluge/blob/b1cdc32f7357e9777eb6cc2d90094c7d122af2eb/deluge/ui/baseargparser.py#L347) which adds the `--do-not-daemonize` option when not on windows."
664456170,298,BenQuigley,2020-07-27T15:12:08Z,"Hmm, thanks for the correction @bendikro. 

I encountered that ""no such option"" error on a Raspberry Pi running deluge-web version 1.3.13."
664466942,298,bendikro,2020-07-27T15:30:48Z,"> Hmm, thanks for the correction @bendikro.
> 
> I encountered that ""no such option"" error on a Raspberry Pi running deluge-web version 1.3.13.

Yeah, the `-d` option in deluge-web is new in deluge v2"
664472987,298,BenQuigley,2020-07-27T15:41:47Z,Thanks!
1005952827,332,DjLegolas,2022-01-05T18:03:06Z,"> We can just replace with `message` attribute since `exception_msg` was removed with changes to RPC protocol: [9b812a4](https://github.com/deluge-torrent/deluge/commit/9b812a4eec6205b98d9d5c12c14f82611832217a)

I saw it in [another place](https://github.com/deluge-torrent/deluge/blob/44dcbee5f43b454994b3a6173bdd27802120e707/deluge/ui/console/cmdline/commands/connect.py#L61) so I copied the behavior in case it still exists.
Change that too?"
1005972433,332,cas--,2022-01-05T18:25:32Z,Yep change there too :+1: 
1005989667,332,cas--,2022-01-05T18:50:31Z,"That looks fine, do you mind updating the commit message to mention the reason for change and reference commit id 9b812a4"
1005996554,332,DjLegolas,2022-01-05T19:01:05Z,"> That looks fine, do you mind updating the commit message to mention the reason for change and reference commit id [9b812a4](https://github.com/deluge-torrent/deluge/commit/9b812a4eec6205b98d9d5c12c14f82611832217a)

Hope it is good enough ðŸ˜„"
1006439474,332,cas--,2022-01-06T10:11:02Z,"That was exactly what was needed :+1: 

Remember to add a reference to the Trac ticket in commit messages too, something like this:

![image](https://user-images.githubusercontent.com/606038/148366527-98602674-2754-4981-bfd1-9d8da505db7f.png)

I automatically add the pr close line to simplify workflow so don't worry about that.
"
