id,pr_number,user,created_at,body
974844960,15769,Mazino-Urek,2021-11-21T16:03:42Z,Opened in favor of #15758 rebase disaster.
974859638,15769,xavier2k6,2021-11-21T17:26:04Z,"Quick glance..........

PR Title & commit title are wrong

No `reannounce.svg` included in `icons.qrc` file & **spacing is wrong**

Here:
https://github.com/qbittorrent/qBittorrent/blob/29729196f00d807a193cc5537f575007a7889f8e/src/icons/icons.qrc#L308-L312

Here:
https://github.com/qbittorrent/qBittorrent/blob/29729196f00d807a193cc5537f575007a7889f8e/src/icons/icons.qrc#L361-L365

Here:
https://github.com/qbittorrent/qBittorrent/blob/29729196f00d807a193cc5537f575007a7889f8e/src/icons/icons.qrc#L368-L372

@Chocobo1 How come this passed the file health check?
____

You need to omit `.svg` 

https://github.com/qbittorrent/qBittorrent/blob/29729196f00d807a193cc5537f575007a7889f8e/src/gui/mainwindow.cpp#L156

Icon images for `user-group-delete.svg` & `user-group-new.svg` are reversed.

Image for `view-calendar-journal.svg` doesn't look good in GUI.
Same for `force-recheck.svg` IMO

Would suggest these:
![force recheck](https://user-images.githubusercontent.com/42386382/142772483-9072ed66-3da8-4600-9970-5b802757b793.png)
![logs](https://user-images.githubusercontent.com/42386382/142772484-1aa2ecb5-922f-48c1-997a-cd2d48c6e751.png)

"
974862245,15769,Mazino-Urek,2021-11-21T17:42:31Z,"For Forced Recheck:
![image](https://user-images.githubusercontent.com/22009014/142773017-ea1b76d5-f760-4d72-8048-4f153ae61552.png)
For view-calendar-journal:
![image](https://user-images.githubusercontent.com/22009014/142773036-58d47598-76df-437c-9b5d-44128d2cd50b.png)
"
974900150,15769,xavier2k6,2021-11-21T21:36:57Z,"I think those two icons are ok after seeing them in the GUI, still not sold on the matchstick/wand looking thing for `torrent-creator` but that's only just my opinion."
975106966,15769,Mazino-Urek,2021-11-22T04:44:52Z,I will look for some alternatives.
975356935,15769,xavier2k6,2021-11-22T10:06:31Z,">I will look for some alternatives.

I wouldn't spend too much time on it at this stage & would suggest we move on for now as more important work to be done than holding up this PR any longer for the sake of 1 icon. (we can come back to it if needs be)

**For example:**

TODO:
- [ ] Adhere to advice in https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-944923757 / https://github.com/qbittorrent/qBittorrent/pull/12169#discussion_r399816475.
- [ ] Make icons consistent where applicable across for e.g. `mainwindow/context/filter/tabs` views.

![categories consistency](https://user-images.githubusercontent.com/42386382/142837277-7b25191a-9d79-4424-8e4e-29a583737360.png)

![tags consistency](https://user-images.githubusercontent.com/42386382/142837626-03ac8418-8382-43c5-a1eb-a8c5e4617c2f.png)

![webseed consistency](https://user-images.githubusercontent.com/42386382/142839669-a736bb31-2fd0-473e-803b-d88e175bb166.png)

![tracker consitency](https://user-images.githubusercontent.com/42386382/142839673-aaf59a9d-c5c0-4b5f-90a2-90e6cf8eb661.png)

````
Remove tag
Remove category
Remove unused tag
Remove unused category
Remove Web seed
Remove tracker
````

Would prefer if these displayed `minus` symbol ![remove](https://user-images.githubusercontent.com/42386382/142838653-bc8064e3-0ed5-4ff1-be7c-428a6ed3df22.png).

This would make them consistent with context menu.
![plus and minus](https://user-images.githubusercontent.com/42386382/142838084-fb481358-a1a4-4462-a20d-ee178e927834.png)

Change:
`list-remove` -> `edit-clear`

**1x**
`/src/gui/properties/propertieswidget.cpp`
**1x**
`/src/gui/properties/trackerlistwidget.cpp`
**2x**
`/src/gui/tagfilterwidget.cpp`
**2x**
`/src/gui/categoryfilterwidget.cpp`

There may be other places that could be changed, but certain features I don't use/haven't looked into.

____
- [ ] Ensure below icon colors are distinguishable from each other & match their respective `Transfer List - RGB` text colors.
(Visible in Light & Dark theme - if possible)
- [ ] `Downloading`
- [ ] `Seeding`
- [ ] `Completed`
- [ ] `Paused`
- [ ] `Stalled Uploading`
- [ ] `Stalled Downloading`
- [ ] `Checking`
- [ ] `Errored`
- [ ] `Queued`
____
- [ ] Make necessary changes to `WebUI`
- [ ] Add screenshots of Icons being used & various in-app GUI Interfaces"
975531786,15769,Mazino-Urek,2021-11-22T13:38:28Z,"I think `text-plain` can be changed from this:
![image](https://user-images.githubusercontent.com/22009014/142868083-ea579fd4-63a8-4ea9-949f-2ac485e3b9a3.png)
to this: 
![image](https://user-images.githubusercontent.com/22009014/142868143-3b78185f-182b-4426-8258-19237cec6e3b.png)
Seems simpler.

In general, trash looks not very visible to me. I have two proposal:
![image](https://user-images.githubusercontent.com/22009014/142871084-6bf3d386-9e9e-462e-8e25-2bce9e12095b.png)
![image](https://user-images.githubusercontent.com/22009014/142871366-fabcc4d3-f9ea-47f8-bf71-156ecc55d0cb.png)
![image](https://user-images.githubusercontent.com/22009014/142873578-5da8fd79-93cb-4ef4-94de-8b8667ce797d.png)

Another issue caught my eyes. As icon names were based on Gnome icon naming spec, I suspect some icon doesn't have real action based names. This issue needs to be addressed. Some examples:
![image](https://user-images.githubusercontent.com/22009014/142873889-d0b4996f-c8cf-4525-b2a5-5bf2d7f9ee0e.png)
![image](https://user-images.githubusercontent.com/22009014/142873944-beaf4bca-d607-4aa4-aef4-4512a197eadc.png)
![image](https://user-images.githubusercontent.com/22009014/142873988-659689d8-6903-4e4a-a6e8-425397ebca59.png)
![image](https://user-images.githubusercontent.com/22009014/142874052-a1788c2e-34ed-4383-b9b3-15f368868e12.png)
![image](https://user-images.githubusercontent.com/22009014/142874079-d213c609-05a6-4262-83ee-0d030e9bbb76.png)

"
975552829,15769,Mazino-Urek,2021-11-22T13:58:07Z,"Besides, I am targeting this changes for QBT version 5.0, as most user has no idea what goes under the hood. It will be a nice change for them."
975620272,15769,ArcticGems,2021-11-22T15:05:58Z,"> 
> In general, trash looks not very visible to me. I have two proposal: ![image](https://user-images.githubusercontent.com/22009014/142873578-5da8fd79-93cb-4ef4-94de-8b8667ce797d.png)
> 

I like this one  👍 
"
975628553,15769,Mazino-Urek,2021-11-22T15:14:08Z,"I think this works best:
![image](https://user-images.githubusercontent.com/22009014/142885735-7fd2f10e-72ca-44fa-a420-a5d5625527e9.png)
![image](https://user-images.githubusercontent.com/22009014/142885883-abe1d627-178f-4412-bf6c-b1faf85fc1fa.png)
![image](https://user-images.githubusercontent.com/22009014/142885956-fe27ec8d-8bcc-42d7-b4f9-2e5eafefe67a.png)
![image](https://user-images.githubusercontent.com/22009014/142886046-3613d59b-c3f1-46cd-849c-ce97c963832e.png)
![image](https://user-images.githubusercontent.com/22009014/142886127-f903d435-e7af-457f-a1df-7d0789a89f9f.png)
1st and 4th works for me. Between them, 1st for me. "
975678440,15769,xavier2k6,2021-11-22T16:07:02Z,">I think `text-plain` can be changed

I don't see any issue with changing it, seems to be only used in one place in code from what I can see.

>As icon names were based on Gnome icon naming spec, I suspect some icon doesn't have real action based names. This issue needs to be addressed.

I will leave this to you.

The `bin` icon, I'd have concerns about how the swirling arrows would look in the GUI......may appear a bit scrunched but will see."
975744776,15769,Mazino-Urek,2021-11-22T17:14:57Z,"> I don't see any issue with changing it, seems to be only used in one place in code from what I can see.

I am deleting `text-plain` and replacing with `view-calendar-journal` then.

> I will leave this to you.

I will need some screenshots. My Linux distro can't run the artifact program file for this #12229.

> The bin icon, I'd have concerns about how the swirling arrows would look in the GUI......may appear a bit scrunched but will see.

Test it out.

"
975796719,15769,Mazino-Urek,2021-11-22T18:19:17Z,"@xavier2k6 @ArcticGems Please confirm.

**After some deep search, following icons are not used anywhere.** 
- [x] `dialog-cancel`
- [x] `dialog-information`
- [x] `document-encrypt`
- [x] `document-import`
- [x] `document-save`
- [x] `edit-clear-history`
- [x] `edit-cut`
- [x] `edit-paste`
- [x] `expand` (Possibly)
- [x] `rss-config`
- [x] `services` (Possibly)
- [x] `tab-close`
- [x] `tools-report-bug`

**Miscellaneous observation:**

- [x] `checking` can be replaced with `task-ongoing`
- [x] `completed` can be replaced with `checked` (Same Icon)
- [x] `document-properties` should be replaced with `checked` or a new icon I have in mind
- [x] `help-about` might need change
- [x] `mail-folder-inbox`, kindly look into it, might not be needed or should be changed.
- [x] `mail-mark-read`, kindly look into it, might need change.
- [x] `queued` deep search needed.
- [x]  `unavailable` and `task-reject` same icon. One can be removed.
- [x] Replace `edit-delete` by `list-remove`
- [x] Replace `document-edit` by `edit-rename`
- [x] Replace `mail-mark-read` by `task-complete`
- [x] Replace `task-attention` by `dialog-warning`"
975798063,15769,Mazino-Urek,2021-11-22T18:20:49Z,I am so sad right now. It broke my back designing those icons and yet so much of them are not really used. What a mess.
975816218,15769,xavier2k6,2021-11-22T18:44:31Z,"@nowshed-imran you may be right that some icons may not be used as over time features have been changed etc. & the icons may have remained but also some of those icons could be used by webui etc.

Edit:
I haven't researched them fully."
976181980,15769,Mazino-Urek,2021-11-23T05:41:28Z,"I did some thinking. These icons were designed for this project and strict coherence was maintained. Here is my proposal:

1. Ununsed icons are to be kept. I might add some following gnome guidelines. Each icon are less than 1 kilobytes, some are even half a kilobytes after optimization. These icons can be used in future if new features are added.
2. In case of repeated icons, only one is to be kept and other should be deleted."
976395918,15769,xavier2k6,2021-11-23T10:52:22Z,">Unused icons are to be kept. I might add some following gnome guidelines. Each icon are less than 1 kilobytes, some are even half a kilobytes after optimization. These icons can be used in future if new features are added.

I wouldn't be in favor of adding unnecessary bloat currently, if a new future feature was added & it required a new icon - we could give you a @mention.

>In case of repeated icons, only one is to be kept and other should be deleted.

In general I would agree with this......"
976399351,15769,Mazino-Urek,2021-11-23T10:56:00Z,"Another Idea. I will maintain a personal repository that will have the icons I have created. Links will be given in read me. In that way, the icons won't be lost and can be used in future."
976617932,15769,Mazino-Urek,2021-11-23T14:28:49Z,"I have created a [repo](https://github.com/nowshed-imran/flow-icon) for the archive purpose. Removing unused icons.
P.S Build fine. Trying renaming now."
976900676,15769,Mazino-Urek,2021-11-23T17:33:04Z,"@xavier2k6 Tracked a problem. `list-add` is a hard requirement.
It must stay as this:
![image](https://user-images.githubusercontent.com/22009014/143074737-be7cefa2-103e-48be-ba5d-b737ecb90a49.png)
We can't change it to this everywhere:
![image](https://user-images.githubusercontent.com/22009014/143074859-a282c2ef-a401-4899-a3da-455bdc038b6a.png)
It should be a new icon. Kindly help me with the code.
I propose `document-new` change into this and this can be used where ever needed. It is serving the same purpose now.

Another Trash candidate:
![image](https://user-images.githubusercontent.com/22009014/143310175-099e2bc9-e769-442b-8d6f-eaec5dc0bf03.png)
"
977072934,15769,Mazino-Urek,2021-11-23T19:38:00Z,"@xavier2k6 @ArcticGems I have made some very big changes. Kindly, test if everything works or not and provide me screenshots."
978207335,15769,xavier2k6,2021-11-24T20:43:55Z,"> I have made some very big changes

Oh boy! (Quantum Leap reference)

>Kindly, test if everything works

Nope! - missing icons. (Quick check & glaringly obvious)

>provide me screenshots.

Do you not have any system available at all to test these builds/changes??

Here ya go:

![new pr version](https://user-images.githubusercontent.com/42386382/143310084-7fe49bfd-3bc0-49b3-8573-43850883358e.png)

"
978213929,15769,Mazino-Urek,2021-11-24T20:56:31Z,"> Nope! - missing icons. (Quick check & glaringly obvious)

Sincerely, the sheer amount of change I have done yesterday, one icon mess up is nothing. https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-975796719 (Only three issues left)

> Do you not have any system available at all to test these builds/changes??

No, I exclusively use Linux. Ubuntu builds just doesn't work for me. I tried a lot.

I think this trash icon works.
![image](https://user-images.githubusercontent.com/22009014/143310175-099e2bc9-e769-442b-8d6f-eaec5dc0bf03.png)

Help me with this one https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-976900676 and RSS feed icon. Then, we can proceed with your checklist."
979227570,15769,Mazino-Urek,2021-11-25T13:45:01Z,"Ok, this is the first time I have been able to compile the package myself. IMO, the whole icon set is finger licking good.
![image](https://user-images.githubusercontent.com/22009014/143451795-334a1bba-7ebe-4c81-a63d-16f0e479a4b2.png)
This icon needs to be changed. 
I propose this new icon.
![image](https://user-images.githubusercontent.com/22009014/143452386-526f780c-9375-4289-be5c-172fc37cb8ec.png)

It needs some new icon.
![image](https://user-images.githubusercontent.com/22009014/143452080-90387a10-a707-427f-ae89-c2522b9ea0fc.png)
"
979277034,15769,Mazino-Urek,2021-11-25T14:51:45Z,"> Nope! - missing icons. (Quick check & glaringly obvious)

Fixed!

![image](https://user-images.githubusercontent.com/22009014/143462530-dde55ee8-e19f-4422-acab-0deca7ed286d.png)
"
979358949,15769,ArcticGems,2021-11-25T16:55:50Z,">  propose this new icon. 
>![image](https://user-images.githubusercontent.com/22009014/143452386-526f780c-9375-4289-be5c-172fc37cb8ec.png)
> 

Or maybe something similar to this?? =
![037_024_trigger_relay_switch_complete_cancel_switcher_change-512](https://user-images.githubusercontent.com/55046301/143479345-9f654121-3765-4adc-8b47-dc1f8e7f89aa.png)


"
979367474,15769,Mazino-Urek,2021-11-25T17:11:55Z,"@ArcticGems That is complex and most complex icons takes tremendous work and doesn't look well when very small and gets rejected most of the time. 
![image](https://user-images.githubusercontent.com/22009014/143481063-374a63c8-f48a-4c55-9a03-e08a34e0c816.png)
I have used this. Try a current build. I have been working on this more than 6 hours straight. Loads of improvement done. From my end it is in the final phase."
979397694,15769,ArcticGems,2021-11-25T18:01:14Z,"> @ArcticGems That is complex and most complex icons takes tremendous work and doesn't look well when very small and gets rejected most of the time.

Maybe it only looks good on my theme 😕 =

![onCompleteMenu](https://user-images.githubusercontent.com/55046301/143485823-09954627-de61-40ce-b8f0-e31f5a72e0d4.png)

>Try a current build. I have been working on this more than 6 hours straight. Loads of improvement done. From my end it is in the final phase.

Try Later 👍 "
979402399,15769,Mazino-Urek,2021-11-25T18:04:57Z,zoom out. That is the trick. Most user won't zoom in to see the icon. Just open the app and see if the icon still looks good or shows what it meant to show. That is the trick. I have changed and modified dozens of icon because of that for the last couple of days.
979424554,15769,Mazino-Urek,2021-11-25T18:56:27Z,"@xavier2k6 I think refactoring from my part is done. All excess icons have been removed. All duplicate icon has one remaining now. My best work till now. 
We can start with your checklist now."
979814626,15769,xavier2k6,2021-11-26T09:21:32Z,"@nowshed-imran There are still icons missing from the GUI, you've also deleted an icon that is being used in the transferlist."
979833924,15769,Mazino-Urek,2021-11-26T09:50:33Z,@xavier2k6 Can you kindly find those icons out? I have already chewed way more than I can. 
979878112,15769,Mazino-Urek,2021-11-26T10:53:21Z,"@ArcticGems This might work. It is simple and means direction change.
![image](https://user-images.githubusercontent.com/22009014/143569835-b78ff5e0-a0f0-47df-b743-07b4ee446e46.png)
"
979920693,15769,ArcticGems,2021-11-26T11:49:16Z,"> @ArcticGems This might work. It is simple and means direction change. 
>![image](https://user-images.githubusercontent.com/22009014/143569835-b78ff5e0-a0f0-47df-b743-07b4ee446e46.png)

Almost good, something is ""weird"" with the bent part of the arrow as a 16x16 icon, but I can't explain why. 😕 

Maybe it's just me."
979977930,15769,Mazino-Urek,2021-11-26T13:27:04Z,"@ArcticGems How about this one?
![image](https://user-images.githubusercontent.com/22009014/143588019-792e2fe7-b260-4d36-b66b-81290d821630.png)
"
980644917,15769,xavier2k6,2021-11-27T15:39:49Z,">Can you kindly find those icons out? I have already chewed way more than I can.

I already showed them in screenshot I posted previously in https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-978207335

>There are still icons missing from the GUI

Just to speed things up for you:

look at `checking/completed` in filter list in the screenshot or even open the app.

>you've also deleted an icon that is being used in the transferlist.

If you enable queueing in the settings - you will se the associated icon is missing from transferlist (you deleted it)"
980692951,15769,Mazino-Urek,2021-11-27T16:42:37Z,"@xavier2k6 Thanks for the pointers. Probably fixed all of them. Check it out.

@ArcticGems I think I have found a nice compromise.
![image](https://user-images.githubusercontent.com/22009014/143689671-426a80d1-73ee-4d17-97e6-749321616e80.png)
"
980696256,15769,Mazino-Urek,2021-11-27T16:46:12Z,"Keeping the link here for reference, and some renaming might be due.
https://specifications.freedesktop.org/icon-naming-spec/latest/ar01s04.html"
980779773,15769,ArcticGems,2021-11-27T18:15:54Z,"> @ArcticGems I think I have found a nice compromise. ![image](https://user-images.githubusercontent.com/22009014/143689671-426a80d1-73ee-4d17-97e6-749321616e80.png)

The arrow + dot didn't show well as 16x16 icon. 😞 Maybe make them bigger??

How about something similar to these (ignore colors) =

![2221487](https://user-images.githubusercontent.com/55046301/143694684-af659ea8-7ef1-4e45-a6ec-28b51d803b0f.png) 


![2909581](https://user-images.githubusercontent.com/55046301/143697514-a6be7aae-e2e5-4ca3-8630-41055a48acf2.png)



![1236902](https://user-images.githubusercontent.com/55046301/143697915-814497f8-635e-4afc-b02f-4d5b086a649d.png)

"
980780671,15769,Mazino-Urek,2021-11-27T18:22:43Z,"@ArcticGems Will this work?
![image](https://user-images.githubusercontent.com/22009014/143705445-d3cd3c14-bfdf-48fa-ada8-1163568e0f25.png)
"
980790021,15769,ArcticGems,2021-11-27T19:35:01Z,"> @ArcticGems Will this work? ![image](https://user-images.githubusercontent.com/22009014/143705445-d3cd3c14-bfdf-48fa-ada8-1163568e0f25.png)

It works! 👍 "
980791285,15769,Mazino-Urek,2021-11-27T19:45:22Z,@ArcticGems Done.
981088076,15769,xavier2k6,2021-11-28T13:44:06Z,"@nowshed-imran Just for clarification, Have you used release versions for `ionicons` / `la-capitaine-icon-theme` icon packs & what version has been used?

I haven't tested any recent build yet as there's been a few changes again."
981103010,15769,Mazino-Urek,2021-11-28T15:19:06Z,"@xavier2k6 For `ionicons` version [v5.5.4](https://github.com/ionic-team/ionicons/releases/tag/v5.5.4) Licensed under MIT and for `la-capitaine-icon-theme` [v0.6.2](https://github.com/keeferrourke/la-capitaine-icon-theme/releases/tag/v0.6.2) under GPL v3. I have used some whole icon from them, sometimes multiple icons were used to create one icon, some are original. 

I have made some changes, as loads of unused icons were deleted and some single used icons were redesigned to have multiple use. From my end, work is done. Now, only your issues remain unsolved. After that, it will be merge ready. I am targeting this change for version 5 though."
981151639,15769,xavier2k6,2021-11-28T21:03:09Z,"For anyone interested, these are the icons being proposed as of now:

![New icons nowshed v2](https://user-images.githubusercontent.com/42386382/143789807-1ccfccc9-2b67-41f4-ae9a-53ae82507e3c.png)

____

These are some of the icons as shown in the main GUI:
![New icons nowshed](https://user-images.githubusercontent.com/42386382/143785633-4960f95a-0603-4ac2-826e-127b9d410f3b.png)

![New options nowshed](https://user-images.githubusercontent.com/42386382/143785765-f53a875c-654e-4501-b02b-316baf9e12b9.png)

"
981151887,15769,xavier2k6,2021-11-28T21:04:41Z,"@nowshed-imran there are some issues in relation to the checking icon not appearing in the transfer list - I haven't looked through your code changes to find out where the issue lies.

I also think some of the icons need to be changed in places/can be used still in more than one place.....will follow-up - don't go changing them yet."
981152545,15769,Mazino-Urek,2021-11-28T21:09:29Z,"@xavier2k6 even if I wanted to, i most likely won't be able to. I am at my wits end.

"
981259971,15769,ArcticGems,2021-11-29T03:27:28Z,"I think all the icons looks great now! 👍 

@xavier2k6 
When it comes to the coding issues, can't you help nowshed-imran with it?? =

> @nowshed-imran there are some issues in relation to the checking icon not appearing in the transfer list - I haven't looked through your code changes to find out where the issue lies.
> 
> I also think some of the icons need to be changed in places/can be used still in more than one place.....will follow-up - don't go changing them yet.

"
981269451,15769,Chocobo1,2021-11-29T03:54:49Z,"Just some comment and questions, doesn't meant to be a blocker.

> [New icons image](https://user-images.githubusercontent.com/42386382/143785633-4960f95a-0603-4ac2-826e-127b9d410f3b.png)

It looks fine mostly. I noticed that the stalled icons are using a darker color, will that be suitable on a dark theme? Or compatibility with dark themes isn't a goal anymore?

> [New options image](https://user-images.githubusercontent.com/42386382/143785765-f53a875c-654e-4501-b02b-316baf9e12b9.png)

I would prefer icons be monochrome, having 2 or more colors in a icon seems a bit unstable.
And it is unusual for me to see red (a strong) color appearing in the bottom 3 icons. AFAIK strong colors are usually reserved for special uses, like something that requires user attention.
Also why don't RSS use the usual orange color? I mean the tone can be tweaked if the usual orange doesn't fit in with the rest."
981279373,15769,Mazino-Urek,2021-11-29T04:19:14Z,"> It looks fine mostly. I noticed that the stalled icons are using a darker color, will that be suitable on a dark theme? Or compatibility with dark themes isn't a goal anymore?

I have though about it. How about exchanging black with red/orange? In that way those icons can be visible in dark. Compatibility with dark theme initiated this project in the first place. It is a priority.



> I would prefer icons be monochrome, having 2 or more colors in a icon seems a bit unstable.
> And it is unusual for me to see red (a strong) color appearing in the bottom 3 icons. AFAIK strong colors are usually reserved for special uses, like something that requires user attention.

In that case, I can turn them all into blue. Which is a very neutral color IMO.

> Also why don't RSS use the usual orange color? I mean the tone can be tweaked if the usual orange doesn't fit in with the rest.

I am not getting it. I have used only one orange color in all the icon. There shouldn't be two variant."
981281098,15769,ArcticGems,2021-11-29T04:23:31Z,"I actually like the multiple colors.

Maybe we should get more peoples opinion about monochrome vs 'multiple colors'."
981287105,15769,Chocobo1,2021-11-29T04:40:52Z,"> > It looks fine mostly. I noticed that the stalled icons are using a darker color, will that be suitable on a dark theme? Or compatibility with dark themes isn't a goal anymore?
> 
> I have though about it. How about exchanging black with red/orange? In that way those icons can be visible in dark. Compatibility with dark theme initiated this project in the first place. It is a priority.

I'm fine with either.
I quite like the way you used gray/black icons for the stalled icons, IMO it looks good with a light theme and too bad it can't stay due to compatibility reasons."
981339818,15769,Mazino-Urek,2021-11-29T06:58:31Z,"For Reference, Adobe Contrast Analyzer tool can be used to find color that might work in both dark and white theme. 
If you got some spare time, can you find me a color. I am looking for darkish color for the `stale` icons.
https://color.adobe.com/create/color-contrast-analyzer"
981398662,15769,xavier2k6,2021-11-29T08:33:44Z,">When it comes to the coding issues, can't you help nowshed-imran with it??

Isn't that what I've been doing in, I don't know how many iterations now of this PR, I've already pointed out previously in different PR & an open issue of where the transfer list text colors need to be changed to match icon color & showed where certain icons for different menus/tabs reside.

I've put an awful lot of my time in to this in an effort to help get it over the line since the 1st attempt a year ago.

Unfortunately, there have been a few setbacks/changes that now calls for work/effort to be again refocused.

>It looks fine mostly. I noticed that the stalled icons are using a darker color, will that be suitable on a dark theme? Or compatibility with dark themes isn't a goal anymore?

thalieht had posted screenshots in one of the other PR's where we matched all but 2 icons that were visible in both dark/light, however this progress was lost when the rebasing went wrong for nowshed.

(IMO - I think it's achievable to match icon/text colors for both light/dark theme with exception of course as thalieht suggested previously the light/dark monochrome icons)

>I would prefer icons be monochrome, having 2 or more colors in a icon seems a bit unstable.
And it is unusual for me to see red (a strong) color appearing in the bottom 3 icons. AFAIK strong colors are usually reserved for special uses, like something that requires user attention.

I tend to agree & the rubbish icon seems to pop/draw attention to itself with 2 separate colors.

>In that case, I can turn them all into blue. Which is a very neutral color IMO.

👍 

>I also think some of the icons need to be changed in places/can be used still in more than one place

- IMO -the icon for `general` in the bottom menu bar should be the same as the `show logs` icon
- Also, I noticed in a previous iteration that the `stop watch` icon not be used - I think that still holds through.
- The `checking` icon in the filter list should be changed back to showing a `cog` icon"
981409344,15769,xavier2k6,2021-11-29T08:49:39Z,">even if I wanted to, i most likely won't be able to. I am at my wits end.

Are you willing to see this through to the end? If you're not, then I don't think there's any need for me or anyone else to spend anymore time here.
____

I know you mentioned in the past that you give permission for anyone to use these icons in the future.

I don't know if any other team member wants to take over this PR, do they?"
981414364,15769,Mazino-Urek,2021-11-29T08:56:21Z,"> Isn't that what I've been doing in, I don't know how many iterations now of this PR, I've already pointed out previously in different PR & an open issue of where the transfer list text colors need to be changed to match icon color & showed where certain icons for different menus/tabs reside.
> 
> I've put an awful lot of my time in to this in an effort to help get it over the line since the 1st attempt a year ago.
> 
> Unfortunately, there have been a few setbacks/changes that now calls for work/effort to be again refocused.

No one doubts that, my friend. Without you, I would have just made cosmetic changes and core problems would have remained unsolved. You should be equally credited for this PR, if merged.

> I tend to agree & the rubbish icon seems to pop/draw attention to itself with 2 separate colors.

I will provide both screenshot side by side later.

> * IMO -the icon for `general` in the bottom menu bar should be the same as the `show logs` icon
> 
> * Also, I noticed in a previous iteration that the `stop watch` icon not be used - I think that still holds through.
> 
> * The `checking` icon in the filter list should be changed back to showing a `cog` icon

Let me get back to home, I will make necessary change.

> I know you mentioned in the past that you give permission for anyone to use these icons in the future.
> 
> I don't know if any other team member wants to take over this PR, do they?

I meant from coding side. Icons I will manage. But, I will need help with codes like you have been doing. No one needs to take on this task yet, and yes I have made a personal icon repository that can be used if necessary for this project in the future."
981743281,15769,Mazino-Urek,2021-11-29T15:28:20Z,"@Chocobo1 @ArcticGems Change Side by side:
![image](https://user-images.githubusercontent.com/42386382/143785765-f53a875c-654e-4501-b02b-316baf9e12b9.png)
![image](https://user-images.githubusercontent.com/22009014/143895504-6345fac0-1e58-4d98-9b76-af53d219b031.png)
"
981759488,15769,ArcticGems,2021-11-29T15:45:46Z,"> @Chocobo1 @ArcticGems Change Side by side: 
> ![image](https://user-images.githubusercontent.com/22009014/143895504-6345fac0-1e58-4d98-9b76-af53d219b031.png)

👍 

Monochrome is fine if it's in 'Options window' only.

"
981760120,15769,Mazino-Urek,2021-11-29T15:46:25Z,"@xavier2k6 All requested changes have been made.
`task-ongoing` and `document-properties` can be removed now, they have been supplemented by other icons.
Please confirm."
981764871,15769,Mazino-Urek,2021-11-29T15:51:49Z,"@ArcticGems Other than RSS, all are blue option windows only, and it looks fine."
981843442,15769,xavier2k6,2021-11-29T17:17:16Z,">All requested changes have been made.
`task-ongoing` and `document-properties` can be removed now, they have been supplemented by other icons.
Please confirm.

One issue remains with checking icon not showing up in transfer list when run - ~I will investigate~ found it, when time permits I will walk you through it.
___

Suggested change:
icon for `on downloads done` under tools should be same as ![on downloads done](https://user-images.githubusercontent.com/42386382/143912994-1e7c33d1-af7d-44fe-8a7e-7da21cb4b7ce.png)"
981880568,15769,xavier2k6,2021-11-29T18:03:18Z,"Change x3 instances of `getCheckingIcon` to `getConfigureIcon`

Change `checking` to `confiure`:
`static QIcon cached = UIThemeManager::instance()->getIcon(QLatin1String(""checking""));`

reference:
`/src/gui/transferlistmodel.cpp`"
981905207,15769,Mazino-Urek,2021-11-29T18:34:34Z,@xavier2k6 Done and Thanks a lot!
981921297,15769,xavier2k6,2021-11-29T18:56:47Z,">Change `checking` to `confiure`:
`static QIcon cached = UIThemeManager::instance()->getIcon(QLatin1String(""checking""));`

>reference:
`/src/gui/transferlistmodel.cpp`

🤣 you actually changed it to my typo!

my apologies.....

Change `confiure` to `configure`:
`static QIcon cached = UIThemeManager::instance()->getIcon(QLatin1String(""confiure""));`

reference:
`/src/gui/transferlistmodel.cpp`"
981926569,15769,Mazino-Urek,2021-11-29T19:03:42Z,"> you actually changed it to my typo!

:man_facepalming:"
981946956,15769,xavier2k6,2021-11-29T19:29:01Z,">One issue remains with checking icon not showing up in transfer list when run

This is now resolved."
982044385,15769,xavier2k6,2021-11-29T21:34:51Z,"@nowshed-imran Can you adjust the color associated with these icons from the filter/transfer list:

`Completed` `#4285f4` change to `#009900`
`Queued` `#f25022` change to `#339966`"
982101307,15769,xavier2k6,2021-11-29T23:03:45Z,"just spotted another missing icon in the transfer list in further testing. (will have to check where the issue lies...no doubt it's due to a renamed icon or different icon in it's place)

EDIT:

Please rename `checked.svg` to `completed.svg`
____

You will also have to change back below & add a `checking.svg` (you can still use the configure image ie `cog`) & modify `icons.qrc` file accordingly. (This will allow us to change it's color to match text in transfer list)

x3 instances of `getConfigureIcon`  back to `getCheckingIcon`

`configure` back to `checking`:
`static QIcon cached = UIThemeManager::instance()->getIcon(QLatin1String(""configure""));`

reference:
`/src/gui/transferlistmodel.cpp`"
982238864,15769,ArcticGems,2021-11-30T03:04:52Z,"> @nowshed-imran Can you adjust the color associated with these icons from the filter/transfer list:
> 
> `Completed` `#4285f4` change to `#009900` `Queued` `#f25022` change to `#339966`

If you want 'Completed' to be 'green', then Download needs to be changed since it's green.

Personally, I like green for working download and blue icon/text + 100% blue progress bar  for completed torrents.

"
982433476,15769,xavier2k6,2021-11-30T09:13:05Z,">If you want 'Completed' to be 'green', then Download needs to be changed since it's green.

completed/checking/seeding are all the same color ""blue""

This is an effort to differentiate between the icons & their respective text colors in transfer list, I haven't requested the checking icon color to be changed yet.

Besides, it's a different shade of green to ""download""
"
982548430,15769,xavier2k6,2021-11-30T11:29:14Z,">100% blue progress bar

In an ideal world, for consistency I'd actually would like the progress bar color to also match with the respective icon/text color.

I'd also like the `Queued` status to be shown in `filter list`

But that is a conversation etc. for another time.

The changes we are attempting now are a real overhaul of the default qBittorrent theme & hopefully will be a better visual experience for users."
982716546,15769,Mazino-Urek,2021-11-30T14:59:35Z,@xavier2k6 update?
982785881,15769,xavier2k6,2021-11-30T16:11:33Z,">update?

You may have overlooked my previous instructions in https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-982101307"
982795948,15769,Mazino-Urek,2021-11-30T16:22:23Z,"@xavier2k6 I misunderstood it first. Why don't we use this icon for loading?
![image](https://user-images.githubusercontent.com/22009014/144086276-b7b72f9f-36b8-4b80-be24-a06009f2df0c.png)
"
982830394,15769,xavier2k6,2021-11-30T16:59:10Z,">Why don't we use this icon for loading?

the original loading icon is a `.png` file.........further discussion is needed on that & the other 4 remaining at another stage....

I must get onto the original creator of the qBittorrent `mascot` to give us an updated icon in `.svg` format.

`sphere.png` seems to be used in `RSS` & `sphere2.png` only seems to reside in the `icons.qrc` file but this was only a quick look."
982836122,15769,xavier2k6,2021-11-30T17:05:13Z,BTW........(for those looking on/interested in PR) I know the text in transfer list doesn't match the icons correctly (we haven't matched them yet!)
982863918,15769,Mazino-Urek,2021-11-30T17:36:24Z,@xavier2k6  I think all the changes you have request is done. I would like to change the color of `checking` so that it is exactly not like `configure`.
983295658,15769,Mazino-Urek,2021-12-01T05:11:30Z,"@xavier2k6 @ArcticGems Any idea how we can solve the stall icon problem?
The goal is to make stalled icon visible both light and dark theme."
983332344,15769,ArcticGems,2021-12-01T06:32:56Z,"> @xavier2k6 @ArcticGems Any idea how we can solve the stall icon problem? The goal is to make stalled icon visible both light and dark theme.

@nowshed-imran 
Tricky...

Either you choose a color that might be to close to others or give the icon a 'light' border or maybe something similar to this (quick edit)?? =

![stalled](https://user-images.githubusercontent.com/55046301/144183413-821a57e7-9217-42bc-afa2-e60f57721d5d.png)


"
983335769,15769,Mazino-Urek,2021-12-01T06:40:45Z,@Chocobo1 @xavier2k6 I think @ArcticGems has provided a probable solution. I think this works. What do you say?
983420435,15769,xavier2k6,2021-12-01T08:50:43Z,"I'd be against any two-tone icon colors especially for the transfer list.......which color should we choose to match with text?

Can you post a screenshot of what the icons look like in transfer list under dark theme..........

As I've said previously....there only seemed to be an issue with two icon colors in dark theme according to thalieht.....this was downloading......which happened to be a different green (I was experimenting with colors) to what we have now & the completed icon."
983439340,15769,Mazino-Urek,2021-12-01T09:13:23Z,"> I'd be against any two-tone icon colors especially for the transfer list.......which color should we choose to match with text?

Fair point. I will try that later in the day."
983447971,15769,ArcticGems,2021-12-01T09:23:32Z,"> I'd be against any two-tone icon colors especially for the transfer list.......which color should we choose to match with text?

The stalled icons are tricky.

If you use StalledDL from https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-983332344, you could use grey text and green underline (which need added code 😞).

Another idea is to add two sets of stalled icons, darker version for light theme and a lighter version for dark theme, but that goes against the concept of this PR of course 😞 

As I said, tricky...

We need more ideas 😕 



"
983467630,15769,xavier2k6,2021-12-01T09:47:53Z,"Another option if the stalled download icon is too dark is give the same color as stalled upload & we can give that icon then a lighter shaded grey.

Before anything is done to the icons though.......really need to see screenshots of them being shown in the transfer list."
983475781,15769,xavier2k6,2021-12-01T09:58:48Z,"Quick reference search & below is a screenshot from one of the other iterations of this PR showing the stalled download icon in the transfer list.

(it's not showing stalled upload - but both can be seen in filter list for reference)

![6e](https://user-images.githubusercontent.com/6451685/133940217-c9a47edd-6e4f-456b-a0b0-ace9726840ab.JPG)
____

>Before anything is done to the icons though.......really need to see screenshots of them being shown in the transfer list.

This comment of mine still holds, as It's no harm to have an updated image (text color will obviously not match as we haven't progressed to that yet.)"
983671716,15769,Mazino-Urek,2021-12-01T14:04:10Z,"I have an alternative proposal. Changing stalling from download black icon to an icon that represent as stop. Here is a mock-up. It means stop, and we don't need it to be black. Thoughts?
![image](https://user-images.githubusercontent.com/22009014/144248132-c36fd3f3-ea78-427f-b609-638825e4d787.png)
"
983681010,15769,xavier2k6,2021-12-01T14:12:17Z,"the stalled download & stalled upload aren't black, they are both different shades of grey.

the icons are fine as is, we just need to focus on colors & how they look currently in a black theme."
983693699,15769,Mazino-Urek,2021-12-01T14:26:11Z,"Consider this color, `#757FA1`
![image](https://user-images.githubusercontent.com/22009014/144251902-16bc2336-a16b-4ed4-8de2-d73638bdc650.png)

This color passes both white and black background in adobe contrast analyzer:
`#757575`
![image](https://user-images.githubusercontent.com/22009014/144252559-4a9e673b-e769-46a6-9e89-3b2f80206913.png)
![image](https://user-images.githubusercontent.com/22009014/144252621-a2d515b4-ff3f-465f-b14e-b809320332aa.png)


"
983702746,15769,xavier2k6,2021-12-01T14:35:59Z,">Consider this color, `#757FA1`

This may actually be useable for `checking`

>`#757575`

That should be ok."
983781824,15769,thalieht,2021-12-01T15:57:33Z,"Current:

![3](https://user-images.githubusercontent.com/6451685/144267753-83e8430d-679a-4c73-8c23-c30a656aceb5.png)


"
983812382,15769,xavier2k6,2021-12-01T16:28:21Z,"As-is, the stalled downloading/uploading icon colors look fine. IMO

I'd actually make the error icon a different shade of red....

@thalieht any other feedback?"
983820281,15769,Mazino-Urek,2021-12-01T16:37:24Z,"@Chocobo1 @thalieht @xavier2k6 After color improvement, I think the visibility is enough now.
![image](https://user-images.githubusercontent.com/22009014/144274943-8a395898-320a-42ea-a22c-bdeda10c6f4d.png)
"
983838022,15769,xavier2k6,2021-12-01T16:58:03Z,"see screenshot in https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-983781824 & my follow-up https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-983812382
____

![image](https://user-images.githubusercontent.com/22009014/144274943-8a395898-320a-42ea-a22c-bdeda10c6f4d.png)

as I've said numerous times we need to differentiate between icon colors......you've made stalled download/upload the same......."
983863740,15769,ArcticGems,2021-12-01T17:25:27Z,"In the right-click menu in screenshot https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-983781824, the icon for 'Queue' is missing."
983868190,15769,xavier2k6,2021-12-01T17:31:01Z,">the icon for 'Queue' is missing.

Is it in qBittorrent 4.3.9?

Nope! so that's not due to this PR."
983876346,15769,ArcticGems,2021-12-01T17:41:31Z,"> > the icon for 'Queue' is missing.
> 
> Is it in qBittorrent 4.3.9?
> 
> Nope! so that's not due to this PR.

Edit: ah, you mean because it's not in qBittorrent 4.3.9, it shouldn't be included in this PR.

OK"
983990258,15769,xavier2k6,2021-12-01T19:35:58Z,">ah, you mean because it's not in qBittorrent 4.3.9, it shouldn't be included in this PR.

no no......I meant that it wasn't broken because of changes in this PR - it was never there originally even with official version.

I don't see why it can't be added now as we already added an icon for `check for updates` under help & I consider this PR an overhaul as I've said previously."
985666403,15769,Mazino-Urek,2021-12-03T16:42:08Z,"What to do next?
"
985937993,15769,ArcticGems,2021-12-04T01:15:27Z,"I guess we start to add icons that aren't in qBit 4.3.9, right @xavier2k6 ??"
988771284,15769,xavier2k6,2021-12-08T12:31:09Z,">What to do next?

Do below:

>Consider this color, `#757FA1`

This may actually be useable for `checking`

>we start to add icons that aren't in qBit

I'd wait a while.......

N.B.: It's a bit difficult at times to see what has/hasn't been changed due to only one commit being used all the time to make numerous changes/deletions etc.

Keep your repo up-to-date periodically with `master` so that there's no more set-backs & have to re-do work that we've already covered like what happened previously on rebase gone wrong.

With xmas almost upon us.....we may need to put any further work on-hold......"
989017772,15769,Mazino-Urek,2021-12-08T17:25:18Z,"
> Keep your repo up-to-date periodically with `master` so that there's no more set-backs & have to re-do work that we've already covered like what happened previously on rebase gone wrong.

Successfully rebased. 

> This may actually be useable for `checking`

![image](https://user-images.githubusercontent.com/22009014/145254183-5044dd22-72c9-43ff-8082-ee8a9f69fcaf.png)
This one?

> With xmas almost upon us.....we may need to put any further work on-hold......

I am available. Feel free to knock anytime. 
"
989045837,15769,xavier2k6,2021-12-08T18:01:59Z,">This one?

👍 "
989051749,15769,Mazino-Urek,2021-12-08T18:09:32Z,Done.
989215717,15769,xavier2k6,2021-12-08T21:36:20Z,"change `configure` to `checking`

`checking->setData(Qt::DecorationRole, UIThemeManager::instance()->getIcon(QLatin1String(""configure"")));`

reference:
`/src/gui/transferlistfilterswidget.cpp`"
989758443,15769,Mazino-Urek,2021-12-09T11:17:07Z,Done.
991655637,15769,xavier2k6,2021-12-11T14:05:54Z,"To add `queued` icon to transfer widget

`/src/gui/transferlistwidget.cpp`

Change this `QMenu *queueMenu = listMenu->addMenu(tr(""Queue""));` to look like this:

````
QMenu *queueMenu = listMenu->addMenu(
    UIThemeManager::instance()->getIcon(""queued""), tr(""Queue""));
````
____

BTW: I think the paused icons can be toned down from ( `#F25022` `Outrageous Orange`)

Alternatives:
`#FFB85C` `Texas Rose`
`#FFA633` `Lightning Yellow`
`#FF9000` `Dark Orange`
`#FFB85C` `Texas Rose`
`#CC7300` `Mango Tango`

I'd also change the `queued` icon to one of these alternatives too but not make it the same as paused.

(I haven't tested any of these colors in-app myself)

EDIT:
`sphere2.png` could be potentially removed - I don't see anywhere in the code where it's used."
991669235,15769,Mazino-Urek,2021-12-11T14:47:11Z,"Current:
![image](https://user-images.githubusercontent.com/22009014/145679893-376bcbca-b4ab-42d2-bc9d-3ce2ab087740.png)

Proposed:
1. Texas Rose
![image](https://user-images.githubusercontent.com/22009014/145679930-e6cade1d-3343-4e15-85ad-629c4fbb914e.png)
2. Lightning Yellow
![image](https://user-images.githubusercontent.com/22009014/145679958-d90bb53f-1d3d-4713-a610-a46f147e8752.png)
3. Dark Orange
![image](https://user-images.githubusercontent.com/22009014/145679983-76da107c-49ad-44c7-996b-02222fb0f2b2.png)
4. Mango Tango
![image](https://user-images.githubusercontent.com/22009014/145680004-37c321b3-4727-4cf8-bb7e-7082f101ccf3.png)

I wanted to use a color that pops. Other than `dark orange`, all colors are muted. I wanted to use one orange color for coherence. Let's change all orange rather than one or two, if we must.

"
991679334,15769,xavier2k6,2021-12-11T15:18:24Z,">I wanted to use a color that pops. 

That's the thing....for me it just seems to pop too much hence why I suggested to tone it down.

`dark orange` still pops (IMO)

The reason I want the `queued` icon to be a similar shade of orange is to indicate that it isn't downloading/uploading (inactive)......similar to how we made the stalled icons similar in color but yet differentiable (transfer list)

How about?

`Dark Orange` for `paused`
`Outrageous Orange` for `queued`"
991685069,15769,Mazino-Urek,2021-12-11T15:34:38Z,"On a second thought, there can be two orange, one light and the other green. But, the use case needs to be conservative. The UI must not suffer from too many colors.



> How about?

> `Dark Orange` for `paused` 
> `Outrageous Orange` for `queued`

Done."
991688799,15769,xavier2k6,2021-12-11T15:45:02Z,">The UI must not suffer from too many colors.

The `transfer list` IMO is where we need 9 distinguishable icons & text colors."
991689125,15769,ArcticGems,2021-12-11T15:46:07Z,"
> How about?
> 
> `Dark Orange` for `paused` `Outrageous Orange` for `queued`

@xavier2k6 
For `paused` I like `#e38000` better, but `#FF9000` `Dark Orange` is good too. 👍 

"
991689286,15769,Mazino-Urek,2021-12-11T15:46:36Z,"I think it works.
![image](https://user-images.githubusercontent.com/22009014/145682659-a000899a-e1af-412d-a3fd-2d88980bcae2.png)
"
991691938,15769,Mazino-Urek,2021-12-11T15:54:47Z,"Why does this four place have no icon?
![image](https://user-images.githubusercontent.com/22009014/145682773-d72a594c-af09-476a-af1e-39e3a01b5fde.png)
We can easily add icons there. All icons are available. We just need the code.
1. For Speed in Title Bar: `office-chart-line.svg`
2. For Search Engine: `edit-find.svg`
3. For RSS Reader: `application-rss+xml.svg`
4. For Log: `view-calendar-journal.svg`

Edit:
Why left the upper two then? All icons gap will be filled.
1. For Top Toolbar: `preferences-other.svg`
2. For Status Bar: This might need a new icon.

@xavier2k6 What do you think?"
991707653,15769,xavier2k6,2021-12-11T16:45:26Z,">For `paused` I like `#e38000` better, but `#FF9000` `Dark Orange` is good too. 👍 

possibly yes...

>I think it works.

Is that `#e38000`?

>Why does this four place have no icon?
>Edit:
Why left the upper two then?

Ok, I'll explain.........(3 of 4) `Speed in Title Bar`/`Search Engine` & ` RSS Reader` are checkboxes just like `Top Toolbar`/`Status Bar` (upper two) hence why these two boxes have `ticks` showing that they've been selected/active.

`Log` (4 of 4) however doesn't have a checkbox or icon associated with it & could potentially get an icon for consistency."
991711625,15769,ArcticGems,2021-12-11T16:58:26Z,"> > For `paused` I like `#e38000` better, but `#FF9000` `Dark Orange` is good too. 👍
> 
> possibly yes...
> 
> > I think it works.
> 
> Is that `#e38000`?

@xavier2k6 

No. nowshed-imran posted almost immediately after me, so he had not seen my comment.

It's `#FF9000` in his screenshot"
991712437,15769,xavier2k6,2021-12-11T17:01:13Z,">To add `queued` icon to transfer widget
>
>`/src/gui/transferlistwidget.cpp`
>
>Change this `QMenu *queueMenu = listMenu->addMenu(tr(""Queue""));` to look like this:
>
>````
>QMenu *queueMenu = listMenu->addMenu(
>     UIThemeManager::instance()->getIcon(""queued""), tr(""Queue""));
>````
____

@nowshed-imran please fix spacing......See that the Capital `U` from `UIThemeManager` is directly under the lower case `u` of `QMenu`"
991715941,15769,Mazino-Urek,2021-12-11T17:11:58Z,"> For `paused` I like `#e38000` better, but `#FF9000` `Dark Orange` is good too.
`#e38000`
![image](https://user-images.githubusercontent.com/22009014/145685195-f4648bdd-0bb9-461a-b046-a2cd7a984925.png)
`#FF9000`
![image](https://user-images.githubusercontent.com/22009014/145685185-06dd8013-1c50-4175-b866-135057524a8b.png)

I think Dark orange works better.

@xavier2k6 Code spacing fixed.



> Ok, I'll explain.........(3 of 4) `Speed in Title Bar`/`Search Engine` & ` RSS Reader` are checkboxes just like `Top Toolbar`/`Status Bar` (upper two) hence why these two boxes have `ticks` showing that they've been selected/active.

If there were checkboxes instead of icons it might have worked. It has open space for icons that can look good with icons.

For example, [Kate](https://kate-editor.org/) has lots of dialogs with and without icons. 
![image](https://user-images.githubusercontent.com/22009014/145685384-c1ed4be0-8b0c-4214-9706-fe83447cf375.png)
![image](https://user-images.githubusercontent.com/22009014/145685405-6a06f801-ac4e-4ec3-8c48-ccf46df7fc3f.png)

@Chocobo1 What do you think? Can we add icons here or not?
![image](https://user-images.githubusercontent.com/22009014/145685436-0af0ec39-b24d-4822-a7a6-551cec8ad183.png)
"
991717747,15769,xavier2k6,2021-12-11T17:17:20Z,">If there were checkboxes instead of icons it might have worked. It has open space for icons that can look good with icons.

Maybe for linux or whatever but not on windows......checkboxes line up with icons.
![view](https://user-images.githubusercontent.com/42386382/145685572-9d4557e5-df3c-47ef-b1da-7e104374b7c8.png)

"
991718948,15769,Mazino-Urek,2021-12-11T17:21:08Z,"@xavier2k6 Ok, didn't know that. In that case, nothing can be done other than `log`."
991720215,15769,ArcticGems,2021-12-11T17:25:34Z,"> > If there were checkboxes instead of icons it might have worked. It has open space for icons that can look good with icons.
> 
> Maybe for linux or whatever but not on windows......checkboxes line up with icons. 

It's like that on linux and no one complained??

> @xavier2k6 Ok, didn't know that. In that case, nothing can be done other than `log`.

👍 

"
991722593,15769,Mazino-Urek,2021-12-11T17:32:41Z,"> It's like that on linux and no one complained??

Linux Operating System users are only 1% of the PC users. A great portion of them are ancient UI lovers(I am talking about Windows XP like UI). After I have started Linux in 2016, lots of changed though. Many great looking options available. For example, I use [KDE Plasma](https://kde.org/plasma-desktop/) which has improved tremendously for the last 2 years. More improvements are coming. "
991723513,15769,xavier2k6,2021-12-11T17:35:36Z,Look. maybe it can be done across all OS's but It's not something I'd be comfortable myself with code wise.
991725808,15769,Mazino-Urek,2021-12-11T17:43:18Z,"> Look. maybe it can be done across all OS's but It's not something I'd be comfortable myself with code wise.

I understand. Can you do the `Log`? Although I can't code, I understand all checkbox changes will need some big refactoring. I don't want to impose that much burden on you anyway."
991732077,15769,xavier2k6,2021-12-11T18:02:38Z,"> Can you do the `Log`?

`/src/gui/mainwindow.cpp`

Create this line:
`m_ui->menuLog->setIcon(UIThemeManager::instance()->getIcon(""view-calendar-journal""));`

For now put it under:
`m_ui->actionManageCookies->setIcon(UIThemeManager::instance()->getIcon(""preferences-web-browser-cookies""));`
"
991744051,15769,Mazino-Urek,2021-12-11T18:41:49Z,It worked. Thanks!
991796763,15769,xavier2k6,2021-12-11T22:17:58Z,Can you try `Tenne (Tawny)` `#CC6600` for `paused` & `Gamboge` `#CC9900` for `queued`
991798176,15769,xavier2k6,2021-12-11T22:31:03Z,"We also may need to swap out this icon for another:

![search plugins](https://user-images.githubusercontent.com/42386382/145693564-d42f0c3a-b746-4b38-a328-0431eddb54eb.png)

"
991799056,15769,xavier2k6,2021-12-11T22:39:02Z,"Since `unavailable.svg` was removed

`/src/gui/rss/feedlistwidget.cpp`

Change `unavailable` to `task-reject`

`        if (feed->hasError())
            return UIThemeManager::instance()->getIcon(QLatin1String(""unavailable""));`"
991799499,15769,xavier2k6,2021-12-11T22:43:15Z,May need to look into this https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-975796719 more. (putting this here as reminder to self)
991901188,15769,Mazino-Urek,2021-12-12T13:44:30Z,"`#CC6600`
![image](https://user-images.githubusercontent.com/22009014/145714457-9281fd05-3478-4226-8003-c0f42e7db756.png)

`#CC9900`
![image](https://user-images.githubusercontent.com/22009014/145714502-535f32e4-4778-4dbd-a2e0-84bf762c566c.png)

To be sincere, not liking these muted colors at all. We can explore different color options. But, I am in favor of brigthish color.



> We also may need to swap out this icon for another:
> 
> ![search plugins](https://user-images.githubusercontent.com/42386382/145693564-d42f0c3a-b746-4b38-a328-0431eddb54eb.png)

I think this icon fits the bill perfectly. It will need to be added as a new icon though. 
![image](https://user-images.githubusercontent.com/22009014/145714743-3fa42aa9-99ec-4aa9-b5a2-0899dfcb8fba.png)
![image](https://user-images.githubusercontent.com/22009014/145714782-a682d127-f3b7-4bc2-b430-91b8c422ae27.png)





> Since `unavailable.svg` was removed
> 
> `/src/gui/rss/feedlistwidget.cpp`
> 
> Change `unavailable` to `task-reject`
> 
> ` if (feed->hasError()) return UIThemeManager::instance()->getIcon(QLatin1String(""unavailable""));`

Done."
991905062,15769,Mazino-Urek,2021-12-12T14:09:21Z,I am using [Adobe Color Palette](https://color.adobe.com/explore) for colors. Give it a go. 
991918911,15769,ArcticGems,2021-12-12T15:33:18Z,"`#e8680c` is also nice for Paused, but chosing for Checking is tricky.

Does Checking really need to be close to the color of Paused? Can't Checking be in a shade of purple or something???
"
991921845,15769,xavier2k6,2021-12-12T15:51:22Z,"Checking is `#757FA1` `Ship Cove`

I presume you meant `queued` - I'd like it to be similar to stalled up/down as previously mentioned....slight differentiation........not active....ie no uploading/downloading etc. `queued` is essentially paused."
991924483,15769,xavier2k6,2021-12-12T16:06:50Z,"@nowshed-imran You've changed the `dialog-warning` & `error` icons......please leave a note etc in future as there's changes being made while we're discussing other changes.....just a bit hard to keep track of changes as I've said previously as you make only one commit.

I'm not against those icon changes by the way & would actually welcome them! to just the skinny exclamation mark that was there previously."
991924820,15769,xavier2k6,2021-12-12T16:08:34Z,">I think this icon fits the bill perfectly. It will need to be added as a new icon though.

I'd be ok with that icon if it looks ok. (blue color)"
991925346,15769,Mazino-Urek,2021-12-12T16:11:51Z,"@xavier2k6 I was experimenting with them while keeping a backup. I was unable to distinguish them in qBtittorrent. They are looking better now.


> Does Checking really need to be close to the color of Paused? Can't Checking be in a shade of purple or something???

We are avoiding more shades of color, if possible. 

"
991939446,15769,Mazino-Urek,2021-12-12T17:38:31Z,"> I'd be ok with that icon if it looks ok. (blue color)

![image](https://user-images.githubusercontent.com/22009014/145723192-7aecfb18-4690-4f2f-ba34-d1c29f9ded76.png)

Looks great."
991940170,15769,Mazino-Urek,2021-12-12T17:42:38Z,"In my opinion, two icon needs change.
![image](https://user-images.githubusercontent.com/22009014/145723241-f37a952a-d080-43e7-b235-9125cbd38a3b.png)
Log like icon doesn't work here. Something different is needed.
This might work:
![image](https://user-images.githubusercontent.com/22009014/145723504-f3749a7d-542d-4020-aea4-9bfb46d21b66.png)

.................
![image](https://user-images.githubusercontent.com/22009014/145723281-7458e29b-4a4b-4050-944e-561c0cac96bd.png)
WebUI icon can be simpler. Like this:
![image](https://user-images.githubusercontent.com/22009014/145723323-ea2b6a1d-ba7b-42b8-82d6-f920a5b4d7a4.png)
"
991943931,15769,xavier2k6,2021-12-12T18:06:15Z,">In my opinion, two icon needs change.
![image](https://user-images.githubusercontent.com/22009014/145723241-f37a952a-d080-43e7-b235-9125cbd38a3b.png)
Log like icon doesn't work here. Something different is needed.

I disagree, I think it does work as it's depicting just general information like a leaflet, I wouldn't be too keen on the map icon thing.

`WebUI` can be changed but I dunno about making it a compass icon......to me it doesn't signify that it's to do with a web user interface."
991946629,15769,ArcticGems,2021-12-12T18:23:04Z,"
> `WebUI` can be changed but I dunno about making it a compass icon......to me it doesn't signify that it's to do with a web user interface.

It also reminds me of Safari's logo."
991947750,15769,Mazino-Urek,2021-12-12T18:30:39Z,I am thinking about WebUI icon for very long. Nothing seems appropriate.
991948740,15769,ArcticGems,2021-12-12T18:37:22Z,"Something similar to these icons could be good for the WebUI icon =
![browser-512](https://user-images.githubusercontent.com/55046301/145725014-36a1a53a-bef5-4086-a3df-06bee08601d5.png)
![960775](https://user-images.githubusercontent.com/55046301/145725020-c57990cc-c2d9-4e81-b930-d316ec13c05d.png)
![968320](https://user-images.githubusercontent.com/55046301/145725024-7e11e5e0-e187-4788-bc82-68e1b6c50e54.png)
"
991950278,15769,xavier2k6,2021-12-12T18:47:47Z,could just use `application-x-mswinurl.svg` instead.........I suppose.
991950808,15769,Mazino-Urek,2021-12-12T18:51:15Z,"How about this?
![image](https://user-images.githubusercontent.com/22009014/145725518-17332584-ac1c-4960-b035-e7c0f593f4d5.png)
"
991951720,15769,xavier2k6,2021-12-12T18:57:23Z,">How about this?

No objections"
991952276,15769,xavier2k6,2021-12-12T19:01:27Z,"From:
`src/webui/www/private/views/filters.html`

Why did you change `checking.svg` to `configure.svg`?

`<li id=""checking_filter""><a href=""#"" onclick=""setFilter('checking'); return false;""><img src=""icons/configure.svg"" alt=""Checking"" />QBT_TR(Checking (0))QBT_TR[CONTEXT=StatusFilterWidget]</a></li>`"
991953309,15769,Mazino-Urek,2021-12-12T19:07:52Z,"I removed `checking` and used `configure`, as they were the same icon. You recommended keeping them. The change was not reverted. Fixing it now."
992109999,15769,Mazino-Urek,2021-12-13T04:54:29Z,"Let's fix the color now. Green, Blue, Red, Grey is done now. 

We need to have one more color that has two shades. Like, `Deep Orange` and `Light Orange` but not different two color like `Orange` and `Megenta`. However, after we change this color, it needs to be fixed.

I am open to new colors if we get a better color than orange. However, I think we need to use bright color. For example, `Light Orange` in most cases and `Dark Orange` in only some selected places. After this, we can focus on WebUI."
992344275,15769,xavier2k6,2021-12-13T10:58:58Z,">We need to have one more color that has two shades. Like, `Deep Orange` and `Light Orange` but not different two color like `Orange` and `Megenta`. However, after we change this color, it needs to be fixed.

What do you mean?, where?"
992725894,15769,Mazino-Urek,2021-12-13T17:55:07Z,"I am talking about changing this color `#f25022` if necessary.
Possibly having a second variation, like `#FF9000` `Dark Orange`.

But, I am against multiple iterations like current `pause` and `queued`. "
992899164,15769,xavier2k6,2021-12-13T20:53:42Z,Sorry......I'm not really seeing/understanding the need for another color change?!
992907060,15769,xavier2k6,2021-12-13T21:03:29Z,`tools-report-bug.svg` can also be removed.
993148894,15769,Mazino-Urek,2021-12-14T04:30:46Z,"> `tools-report-bug.svg` can also be removed.

Done.

> Sorry......I'm not really seeing/understanding the need for another color change?!

This is what I wanted to hear. I think. `#f25022` and `#FF9000` is a great combination. Let's use `#FF9000` for `pause` and for `queued` we can use `gray` `#909090`, if necessary. Let't not add any more colors?"
993301949,15769,xavier2k6,2021-12-14T08:36:35Z,so this is about having a hang up on the `pause`/`queued` icons.......I thought since you mentioned the `#f25022` color - you meant all the remaining icons with that color.......
993330725,15769,Mazino-Urek,2021-12-14T09:13:21Z,"I want color coherence, that's all."
998395935,15769,xavier2k6,2021-12-21T01:30:28Z,"I'd probably change `preferences-desktop.svg` (keeping blue color) to below:
![preferences-desktop](https://user-images.githubusercontent.com/42386382/146852465-8780c379-850f-46e0-a27d-c87cfa88d786.png)
____

Try `#707070` for `stalledDL.svg`
____

`force-recheck.svg` should probably be the same color as `checking.svg` = `#757fa1`
____

There's a few more icons that could be removed & substituted for others we already have in place. (naming scheme permitted)
Example:
Remove `seeding.svg`/`uploading.svg` & substitute with `kt-set-max-upload-speed.svg`
Remove `view-filter.svg` & substitute with `filterinactive.svg`
Remove `download.svg` & substitute with `downloading.svg`
`dialog-warning.svg`/`task-attention.svg` - Use only one if possible.
`media-playback-pause.svg`/`paused.svg` & `media-playback-start.svg`/`resumed.svg` - Use only one of each if possible. (keep `resumed` color)
____

Change `media-seek-forward.svg` color to that of `resumed`
____

Can you change color of `kt-magnet.svg` to Red `#db3236`/Grey `#909090` - like below example image:

![1258126351877027141coredump_Horseshoe_Magnet svg med](https://user-images.githubusercontent.com/42386382/146854828-d5bc0a34-76cd-4845-b418-e6e5e8752f80.png)

"
998827297,15769,Mazino-Urek,2021-12-21T14:32:46Z,"> I'd probably change `preferences-desktop.svg` (keeping blue color) to below:

![image](https://user-images.githubusercontent.com/22009014/146938504-edcf8dc2-5405-4c48-bc85-2d2387fdae8a.png)

> Try `#707070` for `stalledDL.svg`
> 
> `force-recheck.svg` should probably be the same color as `checking.svg` = `#757fa1`

Done.


> Remove `seeding.svg`/`uploading.svg` & substitute with `kt-set-max-upload-speed.svg`

I think `seeding.svg` can stay, as it has different color. Second part, done.

> Remove `view-filter.svg` & substitute with `filterinactive.svg`

Done.

> Remove `download.svg` & substitute with `downloading.svg`

I don't know if I got every `download`, as it is very common in this app.

> `dialog-warning.svg`/`task-attention.svg` - Use only one if possible.

I replaced `task-attention.svg` already. Forgot to delete the icon.

> `media-playback-pause.svg`/`paused.svg` & `media-playback-start.svg`/`resumed.svg` - Use only one of each if possible. (keep `resumed` color)

Kept `media-playback-pause.svg` and `media-playback-start.svg` for better discovery in the future.



> Change `media-seek-forward.svg` color to that of `resumed`

done.



> Can you change color of `kt-magnet.svg` to Red `#db3236`/Grey `#909090` - like below example image:

Again, let's not go wild with colors. We have fixed red and orange color. Possibly another orange variation `#FF9000` and grey colors. I will use them to make something."
998836563,15769,Mazino-Urek,2021-12-21T14:45:05Z,"Will this work? Used currently set red `#Db3236` and gray `#707070`.

![image](https://user-images.githubusercontent.com/22009014/146948561-c00d84b1-6c41-4101-8243-fb4c32a64e48.png)
"
998849924,15769,xavier2k6,2021-12-21T15:02:19Z,">I think `seeding.svg` can stay, as it has different color.

The reason I want it gone/changed is so that it matches the other download/upload icons & speed graph text.

>https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-998836563 👍

Can we rename `completed.svg` to `checked-completed`??"
998861908,15769,Mazino-Urek,2021-12-21T15:16:47Z,"> The reason I want it gone/changed is so that it matches the other download/upload icons & speed graph text.

Done."
998881084,15769,Mazino-Urek,2021-12-21T15:38:25Z,"Can we improve here?
![image](https://user-images.githubusercontent.com/22009014/146956536-70161867-04e6-4bd0-9f47-64f0c8c59ddb.png)
"
999052774,15769,xavier2k6,2021-12-21T19:52:48Z,"Name:
Perhaps a simple `ab` icon (do you know - like a spellcheck icon)

Info hash v1/Info hash v2
Hashtag Icon `#`?

Torrent ID:
Perhaps `help-about.svg`"
999057852,15769,xavier2k6,2021-12-21T20:01:36Z,"Oh man........you changed the orange colors back again that we had differentiated for transfer list.

You missed `uploading` to `kt-set-max-upload-speed` in `filter` & `transfer` list. (so icon doesn't show up)

I see you made an attempt at transfer list colors....they don't match.....I will go through this with you when we get most things sorted look & feel wise.

Also........(this is more for WebUI)
`/src/webui/www/private/index.html`

`downloading_small.svg` can be changed to `downloading.svg`
`checked.svg` can be changed to `checked-completed.svg`"
999145124,15769,xavier2k6,2021-12-21T22:47:11Z,"You asked previously about the `loading` icon.......how about using the `infinite/infinity` symbol for ""loading"" that way we can hopefully migrate another icon to `*.svg`

Can you find anything suitable to replace `sphere.png`?

We would only be left with `mascot.png` & `splash.png` then"
999625514,15769,Mazino-Urek,2021-12-22T14:40:19Z,"> You missed `uploading` to `kt-set-max-upload-speed` in `filter` & `transfer` list. (so icon doesn't show up)
Done.

> You asked previously about the `loading` icon.......how about using the `infinite/infinity` symbol for ""loading"" that way we can hopefully migrate another icon to `*.svg`

I have two candidates:
![image](https://user-images.githubusercontent.com/22009014/147108114-c8218eb3-211e-47f9-a4a4-717a516b4a74.png)
![image](https://user-images.githubusercontent.com/22009014/147108183-03ef61fe-389d-43c3-a783-13f019d164af.png)

> Can you find anything suitable to replace `sphere.png`?

I don't even understand what is this icon really, how can I find the replacement?


> We would only be left with `mascot.png` & `splash.png` then
These are brand icon. Changing them should be a different PR.


"
999643004,15769,Mazino-Urek,2021-12-22T15:05:28Z,"> Name: Perhaps a simple `ab` icon (do you know - like a spellcheck icon)
> 
> Info hash v1/Info hash v2 Hashtag Icon `#`?
> 
> Torrent ID: Perhaps `help-about.svg`

Done."
999698408,15769,xavier2k6,2021-12-22T16:16:27Z,">![image](https://user-images.githubusercontent.com/22009014/147108114-c8218eb3-211e-47f9-a4a4-717a516b4a74.png)

I'm thinking......this one (others may have a different opinion)
____

>I don't even understand what is this icon really, how can I find the replacement?

It's used in `rssArticle`....to be honest I'm not fully sure of it's purpose....I'd leave that for now & can revisit at a later stage.

>These are brand icon. Changing them should be a different PR.

I agree & was really only meant as a reference comment really.
____

Screenshot of icons added from https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-999643004 & reference https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-998881084 below:
![Screenshot 2021-12-22 160658](https://user-images.githubusercontent.com/42386382/147122522-2b94ae5f-3036-4800-8ea8-8a2a239ed147.png)

"
999711051,15769,Mazino-Urek,2021-12-22T16:34:28Z,"Changed `loading.png` to `loading.svg`. Icon: Infinity.

I think, sphere is kind of loading icon."
999747959,15769,xavier2k6,2021-12-22T17:30:31Z,"> Changed `loading.png` to `loading.svg`. Icon: Infinity.
> 
> I think, sphere is kind of loading icon.

That's my thinking too"
999773098,15769,Mazino-Urek,2021-12-22T18:14:30Z,Replaced `sphere` by `loading`. Let's see.
1000531145,15769,xavier2k6,2021-12-23T21:29:03Z,"`/src/webui/www/private/index.html`

Change `document-edit-verify.svg` to `force-recheck.svg`
`id=""recheckLink""><img class=""MyMenuIcon"" src=""icons/document-edit-verify.svg"" alt=""QBT_TR(Force Recheck)`

Change `document-edit-verify.svg` to `force-recheck.svg`
`href=""#forceRecheck""><img src=""icons/document-edit-verify.svg"" alt=""QBT_TR(Force recheck)`

Change `document-edit-verify.svg` to `reannounce.svg`
`href=""#forceReannounce""><img src=""icons/document-edit-verify.svg"" alt=""QBT_TR(Force reannounce)`

Change `edit-copy.svg` to `name.svg`
`href=""#"" id=""copyName"" class=""copyToClipboard""><img src=""icons/edit-copy.svg"" alt=""QBT_TR(Name)`

Change `edit-copy.svg` to `hash.svg`
`href=""#"" id=""copyInfohash1"" class=""copyToClipboard""><img src=""icons/edit-copy.svg"" alt=""QBT_TR(Info hash v1)`

Change `edit-copy.svg` to `hash.svg`
`href=""#"" id=""copyInfohash2"" class=""copyToClipboard""><img src=""icons/edit-copy.svg"" alt=""QBT_TR(Info hash v2)`

Change `edit-copy.svg` to `help-about.svg`
`href=""#"" id=""copyID"" class=""copyToClipboard""><img src=""icons/edit-copy.svg"" alt=""QBT_TR(Torrent ID)`
____

`/src/webui/www/private/scripts/client.js`

Change `inode-directory.svg` to `view-categories.svg`
``` 
           const html = '<a href=""#"" onclick=""setCategoryFilter(' + hash + ');return false;"">'
                + '<img src=""icons/inode-directory.svg""/>'
```

Change `inode-directory.svg` to `tags.svg`
```
            const html = '<a href=""#"" onclick=""setTagFilter(' + hash + ');return false;"">'
                + '<img src=""icons/inode-directory.svg""/>'
```

Change `network-server.svg` to `trackers.svg`
```
            const html = '<a href=""#"" onclick=""setTrackerFilter(' + hash + ');return false;"">'
                + '<img src=""icons/network-server.svg""/>'
```"
1000678029,15769,Mazino-Urek,2021-12-24T06:23:33Z,@xavier2k6 Wow. Thank you! It must have taken some time to find these.
1000793800,15769,xavier2k6,2021-12-24T11:07:21Z,">Thank you!

No problem, I forgot to paste one in!
____

`/src/webui/www/private/scripts/contextmenu.j`

Replace `inode-directory.svg` with `view-categories.svg` (There's only one)"
1000827946,15769,xavier2k6,2021-12-24T12:52:34Z,"`/src/webui/www/private/views/searchplugins.html`

Change `checked.svg` to checked-completed.svg`
```href=""#Enabled""><img src=""icons/checked.svg"" alt=""QBT_TR(Enabled)```
____

`/src/webui/www/private/scripts/dynamicTable.js`

Change `checked.svg` to `checked-completed.svg`

```
const html = '<a href=""#' + columnName + '"" ><img src=""icons/checked.svg""/>' + window.qBittorrent.Misc.escapeHtml(text) + '</a>';
```"
1000830032,15769,Mazino-Urek,2021-12-24T12:59:34Z,Done.
1000846048,15769,xavier2k6,2021-12-24T13:50:22Z,"`/src/webui/www/private/index.html`

Change `view-categories.svg` to `tags.svg`

`href=""#Tags"" class=""arrow-right""><img src=""icons/view-categories.svg"" alt=""QBT_TR(Tags)`"
1001079554,15769,xavier2k6,2021-12-25T22:28:46Z,Will be back to this asap.
1001101242,15769,Mazino-Urek,2021-12-26T03:21:28Z,Take your time. No problem.
1003629599,15769,xavier2k6,2022-01-01T22:36:14Z,"`/src/gui/search/searchjobwidget.cpp`

Change `downloading` to `kt-set-max-download-speed`

`menu->addAction(UIThemeManager::instance()->getIcon(""downloading""), tr(""Open download window"")`

EDIT: (Don't change the other `downloading` icon, just the one where I mentioned above)


Change `edit-copy` to `name`

`copySubMenu->addAction(UIThemeManager::instance()->getIcon(""edit-copy""), tr(""Name"")`


Change `edit-copy` to `insert-link`

`copySubMenu->addAction(UIThemeManager::instance()->getIcon(""edit-copy""), tr(""Download link"")`


Change `edit-copy` to `application-x-mswinurl`

`copySubMenu->addAction(UIThemeManager::instance()->getIcon(""edit-copy""), tr(""Description page URL"")`
____

`/src/webui/www/private/views/search.html`

Change `edit-copy` to `name`

`href=""#"" id=""copySearchTorrentName"" class=""copySearchDataToClipboard""><img src=""icons/edit-copy.svg"" alt=""QBT_TR(Name)`


Change `edit-copy` to `insert-link`

`href=""#"" id=""copySearchTorrentDownloadLink"" class=""copySearchDataToClipboard""><img src=""icons/edit-copy.svg"" alt=""QBT_TR(Download link)`


Change `edit-copy` to `application-x-mswinurl`

`href=""#"" id=""copySearchTorrentDescriptionUrl"" class=""copySearchDataToClipboard""><img src=""icons/edit-copy.svg"" alt=""QBT_TR(Description page URL)`

____"
1003749909,15769,Mazino-Urek,2022-01-02T17:35:02Z,Done.
1003763251,15769,xavier2k6,2022-01-02T19:26:55Z,">`/src/gui/search/searchjobwidget.cpp`
>
>Change `downloading` to `kt-set-max-download-speed`
>
>`menu->addAction(UIThemeManager::instance()->getIcon(""downloading""), tr(""Open download window"")`

I'm not 100% on this as being the right icon choice for this action.....but I'm going to leave it for now....
____

Seems to be a few issues in `WebUI` for some icons but that may just be a browser caching issue....(didn't clear it) or view box sizes need to be changed to accommodate new icon sizes.

Will look in to it again at a later stage.

@nowshed-imran Any questions?"
1003763397,15769,xavier2k6,2022-01-02T19:28:18Z,I'd change/re-work the `security-high.svg` & `security-low.svg` icons too.
1003976702,15769,Mazino-Urek,2022-01-03T09:51:05Z,"Tobe honest, I can't get the WebUI running. I have no idea how it looks.

> I'd change/re-work the `security-high.svg` & `security-low.svg` icons too.


Ideas?"
1007207400,15769,Mazino-Urek,2022-01-07T07:52:55Z,"Ping everyone. @xavier2k6
I think `security-high` can be this: 
![image](https://user-images.githubusercontent.com/22009014/148510477-f1415efd-b419-4f51-a22a-d8a3d113dd5e.png)

and  `security-low`:
![image](https://user-images.githubusercontent.com/22009014/148510609-2a2cc276-9e90-49a5-877f-b2f78a6d5168.png)
"
1007212492,15769,Mazino-Urek,2022-01-07T08:03:55Z,"Alternative,
`security-high`:
![image](https://user-images.githubusercontent.com/22009014/148511811-d7a6578a-fa24-4778-8891-23e1564d1cac.png)
`security-low`:
![image](https://user-images.githubusercontent.com/22009014/148511941-1cc04c95-694b-4a12-88b7-01a2ca69c95c.png)
"
1013242289,15769,Mazino-Urek,2022-01-14T15:51:05Z,@xavier2k6 @ArcticGems ping!
1013677779,15769,xavier2k6,2022-01-15T12:56:03Z,"@nowshed-imran Very little free time at moment - however for now, I'd suggest going with alternatives from https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1007212492 with a slight icon change for `security-high`:

![security-high](https://user-images.githubusercontent.com/42386382/149622400-c99ff404-233c-447f-a044-791d6f582571.png)

Edit:
Source - `ionicons`"
1013705736,15769,Mazino-Urek,2022-01-15T15:55:38Z,"@xavier2k6 I am putting the project on hold as long as you are not free. 
`security-high`
![image](https://user-images.githubusercontent.com/22009014/149628011-07789ed3-7691-42ce-86ef-38f4b3eeb825.png)
`security-low`
![image](https://user-images.githubusercontent.com/22009014/149628438-45cac097-8914-4323-ba42-5ee13f4f3ddd.png)
"
1013879890,15769,Mazino-Urek,2022-01-16T13:50:02Z,"Can we replace these two files?

- [ ] `qbittorrent.ico`
- [ ] `qbittorrent_file.ico`"
1019509392,15769,xavier2k6,2022-01-23T15:36:33Z,"> Can we replace these two files?
> 
> * [ ]  `qbittorrent.ico`
> * [ ]  `qbittorrent_file.ico`

Not sure, what would you suggest?

I should hopefully be able to have more time for this PR next week."
1019513260,15769,Mazino-Urek,2022-01-23T15:56:19Z,"@xavier2k6 We have exactly same SVG alternative.
![image](https://user-images.githubusercontent.com/22009014/150686817-408bd3b9-e759-4832-a0d1-f8b2c3eb5956.png)
![image](https://user-images.githubusercontent.com/22009014/150686834-4faad945-088d-4c9c-bb27-8ed57907e19d.png)
![image](https://user-images.githubusercontent.com/22009014/150686864-7d47c97c-8255-4dc3-bfd8-52876307404f.png)
We can replace this.



> I should hopefully be able to have more time for this PR next week.

No problem. I think version 5.0 will be very late. We can target 4.5, I think."
1022202772,15769,xavier2k6,2022-01-26T13:35:08Z,">We have exactly same SVG alternative.
>We can replace this.

Suggest keep naming (for now):
`qbittorrent.ico` -> `qbittorrent.svg`
`qbittorrent_file.ico` -> `qbittorrent_file.svg`

Haven't time to look through code to see where names need to be changed..."
1022224300,15769,Mazino-Urek,2022-01-26T14:01:16Z,"@xavier2k6 Done. If the program works correctly, I would like to keep just one."
1022244118,15769,xavier2k6,2022-01-26T14:22:58Z,"Failing to compile on windows!

Change:
`qbittorrent.ico` -> `qbittorrent.svg`
`qbittorrent_file.ico` -> `qbittorrent_file.svg`

`\src\qbittorrent.rc`"
1022253283,15769,Mazino-Urek,2022-01-26T14:32:41Z,@xavier2k6 Fixed.
1022344596,15769,Mazino-Urek,2022-01-26T16:02:57Z,Windows build failing.
1022377996,15769,xavier2k6,2022-01-26T16:37:45Z,"> Windows build failing.

Reason:
`D:\a\qBittorrent\qBittorrent\src\qbittorrent.rc(3) : error RC2175 : resource file icons\qbittorrent.svg is not in 3.00 format`"
1022467963,15769,Mazino-Urek,2022-01-26T18:19:37Z,"Fix is coming,
How about replacing this: 
![image](https://user-images.githubusercontent.com/22009014/151222633-433b2d04-55ea-40a3-9b90-40663136f5d5.png)

With this:
![image](https://user-images.githubusercontent.com/22009014/151222981-6acb7284-df44-43f3-90cb-039e1be15604.png)
"
1022479352,15769,Mazino-Urek,2022-01-26T18:33:55Z,"Or, simple but awesome, this one?
![image](https://user-images.githubusercontent.com/22009014/151225085-7feff4f3-b0d5-4665-b446-b001fe2c99cd.png)
"
1022480818,15769,Mazino-Urek,2022-01-26T18:35:41Z,"Or, better yet?
![image](https://user-images.githubusercontent.com/22009014/151225328-62947b58-0630-4518-9a93-5a267e916f1f.png)
@xavier2k6 @ArcticGems "
1022682966,15769,xavier2k6,2022-01-26T23:04:46Z,"I'd go with https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1022467963 for now.

Will be able to give more time/help/feedback soon.

Edit:
With the re-introduction of the `set location` option, we could add a new icon for this.....(name it accordingly)

Below example:
![set location](https://user-images.githubusercontent.com/42386382/151262185-8019bbd2-cf7f-46c5-92c1-8a52cfd59044.png)
____

![set location highlighted](https://user-images.githubusercontent.com/42386382/151262405-cab31046-750e-490e-beba-74bd4140e574.png)

Change `inode-directory` to `set-location` (or whatever you name it)

`auto *actionSetTorrentPath = new QAction(UIThemeManager::instance()->getIcon(""inode-directory""), tr(""Set location...""), listMenu);`

`/src/gui/transferlistwidget.cpp`"
1023284447,15769,Mazino-Urek,2022-01-27T14:45:42Z,Done.
1024897755,15769,xavier2k6,2022-01-29T11:58:13Z,@nowshed-imran Any particular reason `32x32` size was used/chosen instead of say `48x48`?
1024914168,15769,Mazino-Urek,2022-01-29T13:41:43Z,"Two reasons:
1. Icons shown in qBittorrent are very small, and 32×32 is more than enough for these cases. It is also keeping file sizes low after optimization.
2. We are using SVG icon formats which is scalable. It is a lossless icon format, even when the icon is blown to let's say 10 times. That is in `.ico` file, I have used 512×512 format."
1024940138,15769,xavier2k6,2022-01-29T16:15:00Z,"Well, we probably need to make the tray icons `48x48` as it doesn't maintain same size as previously throughout different places in the program/taskbar/tray or look at some other option......(this is on windows)"
1024942037,15769,Mazino-Urek,2022-01-29T16:26:14Z,"It really shouldn't happen. Current icons don't even have a standard size. Some icons are very small and some are even `512x 512` pixels. Yet, it works because the icons are in SVG format, not PNG.

I think what is really happening is icons are simpler now. However, if you insist, I can do it. However, changing all these icons will take time.

"
1024942905,15769,xavier2k6,2022-01-29T16:31:40Z,"I don't insist, not at the moment - it maybe something else causing the discrepancy.

I'm giving a build from this PR a whirl over the next few hours to see where we are/what's left to do."
1024944732,15769,xavier2k6,2022-01-29T16:42:35Z,"Can you make these 3x icons `48x48` as a test case example.
`qbittorrent-tray.svg`
`media-playback-pause.svg`
`media-playback-start.svg`"
1024947178,15769,Mazino-Urek,2022-01-29T16:56:51Z,Done.
1024961061,15769,xavier2k6,2022-01-29T18:15:43Z,"the discrepancy I'm seeing is actually because of the `qbittorrent.ico` - you were going to change this over to `svg` previously, is that still the plan??

`qbittorrent_file.ico` was changed too & not for the best. (Not as sharp/crisp/clean etc.)

#### Yours is on the left, original on right

![qbittorrent icon](https://user-images.githubusercontent.com/42386382/151672330-3e6f98b8-3f07-4e85-b34a-a31fdf3072d5.png)
____

![qbittorrent_file](https://user-images.githubusercontent.com/42386382/151672498-dd98756a-cf30-485e-93ca-78aee270c963.png)
____

I liked & would prefer that option ![image](https://user-images.githubusercontent.com/22009014/151222981-6acb7284-df44-43f3-90cb-039e1be15604.png) as it maintains the current logo scheme.
"
1024962988,15769,Mazino-Urek,2022-01-29T18:27:30Z,"> the discrepancy I'm seeing is actually because of the `qbittorrent.ico` - you were going to change this over to `svg` previously, is that still the plan??
> 
> `qbittorrent_file.ico` was changed too & not for the best.

`.ico` can't be changed to `svg`. I changed the shape size. I can restore previous size, though. 




> I liked & would prefer that option as it maintains the current logo scheme.

Done."
1025123409,15769,xavier2k6,2022-01-30T11:31:02Z,"The quality is still too low on those 2x files - they need further work or revert to the originals.

Regarding the 3x `48x48` test case icons - these can be reverted back to `32x32`."
1025143607,15769,Mazino-Urek,2022-01-30T13:27:29Z,"> The quality is still too low on those 2x files - they need further work or revert to the originals.

Can you provide me with some screenshot that is causing the problem?"
1025151088,15769,xavier2k6,2022-01-30T14:06:37Z,">Can you provide me with some screenshot that is causing the problem?

Look at the quality of the screenshots from https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1024961061 & my comment about them not being sharp/crisp

Also, the `qbittorrent` text in `qbittorrent_file.ico` is practically `illegible`

See:
![new file icon](https://user-images.githubusercontent.com/42386382/151702991-ed38376b-fcc4-4bbb-b968-17e52f83ee2f.png)


Maybe, it's just system/screen I'm testing on - (not using my own rig for testing)"
1025154488,15769,Mazino-Urek,2022-01-30T14:25:18Z,What about now?
1025196552,15769,xavier2k6,2022-01-30T18:03:08Z,"> What about now?

still problematic, please revert for now & we can possibly revisit.
____

Somehow - this got changed?? (created categories should also have the category icon)

![wrong icon for category](https://user-images.githubusercontent.com/42386382/151711412-e72f37a6-21a6-4c2b-a8ab-0d5373df22aa.png)
"
1025203801,15769,Mazino-Urek,2022-01-30T18:40:49Z,"This must be the result of rebasing.
Recent commit must have introduced these icons.
"
1025206873,15769,xavier2k6,2022-01-30T18:57:51Z,">Recent commit must have introduced these icons.

Ya, the reintroduction of the context menu items

#### Fix is below

`/src/gui/transferlistwidget.cpp`


Change `inode-directory` to `view-categories`
`QAction *categoryAction = categoryMenu->addAction(UIThemeManager::instance()->getIcon(""inode-directory""), escapedCategory`"
1025376644,15769,Mazino-Urek,2022-01-31T04:43:40Z,"Besides, shouldn't the `reset` action use a different button? I will change it later."
1025986881,15769,Mazino-Urek,2022-01-31T16:49:08Z,@xavier2k6 I have made some changes. What is the status now of the `.ico` problem?
1030862411,15769,xavier2k6,2022-02-06T16:05:00Z,"> What is the status now of the `.ico` problem?

Still issues....

I don't want to dwell too much on that at the moment.
____

`error.svg`/`dialog-warning` - exclamation mark is a little bit hard to see/make out:

![exclam_mark](https://user-images.githubusercontent.com/42386382/152689491-c91cd56f-11f0-4dd2-97e4-f3398b5b4dfc.png)

Can you also change `view-refresh` ![view_refresh](https://user-images.githubusercontent.com/42386382/152689597-3c640f70-2a5b-491c-85d6-bfb5f5283ba8.png) image to maybe same image as `sync` ![sync](https://user-images.githubusercontent.com/42386382/152689440-32c1c067-710b-463a-b26f-9054dfa26be6.png)

"
1033871414,15769,Mazino-Urek,2022-02-09T15:17:39Z,@xavier2k6 Check out the changes.
1033973624,15769,xavier2k6,2022-02-09T16:50:09Z,"`error/dialog-warning` All good! 👍 

Still unsure about `view-refresh` icon....lol

Can you use:

`ionicons (reload-circle)`
![solid refresh](https://user-images.githubusercontent.com/42386382/153248743-ae61a869-bac4-4614-a8f8-fe7502c68ca9.png)

"
1033980725,15769,Mazino-Urek,2022-02-09T16:57:05Z,Done.
1034667646,15769,xavier2k6,2022-02-10T09:08:11Z,"> Done.

Will take a look, please `rebase` first."
1034904308,15769,Mazino-Urek,2022-02-10T13:09:25Z,Rebased successfully.
1040321600,15769,Mazino-Urek,2022-02-15T14:12:48Z,@xavier2k6 Ping.
1044359549,15769,xavier2k6,2022-02-18T11:16:38Z,@nowshed-imran Not forgetting you.....busy with other things & also currently testing transfer list color matching.
1044377812,15769,Mazino-Urek,2022-02-18T11:34:25Z,Got it. No problem.
1046169132,15769,Pentaphon,2022-02-20T06:01:08Z,"This is great. The entire qBittorrent dark theme needs to be redone to **improve overall contrast** and this is a good first step. 

I can't believe this didn't make it into 4.4.0"
1046171938,15769,Mazino-Urek,2022-02-20T06:17:36Z,"@Pentaphon You will be surprise to know this initiative goes all the way back to 2018, initial PR being #8406. So, I am not too worried that it didn't make into 4.4.0 release. Hopefully 4.5 version.
qBittorrent needs a lot of work in dark mode for Windows users. For Linux users this will be 2000% better than the current UI."
1046180221,15769,Pentaphon,2022-02-20T07:31:36Z,"> For Linux users this will be 2000% better than the current UI.

I'm very glad, but on Linux this setting is on by default, replacing most of the icons that come with qBittorrent with the system icons, and most people won't change the setting unless they are told to. Perhaps this is a default that should instead be checked off so that Linux users get to see your customized work out of the box and instead have to check the box if they want to use their system icons. After all, nothing is better for an app than the icons that were custom designed for it, especially now with this PR. 

![icon](https://user-images.githubusercontent.com/49374058/154832982-62bcc01f-ca31-4186-92b3-766ef66a6173.png)
"
1046181381,15769,Mazino-Urek,2022-02-20T07:40:12Z,"@Pentaphon Excellent point.

@xavier2k6 I am leaving this as a reminder, kindly look into it when you are free. I think we shouldn't choose ""System Icon Theme"" as default anymore. At this point it would cause strange behaviors."
1046791857,15769,xavier2k6,2022-02-21T11:47:02Z,">I think we shouldn't choose ""System Icon Theme"" as default anymore. At this point it would cause strange behaviors.

I will let other team members decide on this at a later stage, if it needs to be a separate PR etc (Don't really use Linux myself & don't believe that setting is applicable to Windows OS)"
1046881737,15769,Mazino-Urek,2022-02-21T13:27:55Z,"@xavier2k6 How about this, after this PR gets, I will create an issue to discuss it with everyone?"
1053638773,15769,Mazino-Urek,2022-02-27T18:26:09Z,"@xavier2k6 I have seen your comment on another thread. Is there any way I can give you the credit you are due?

I would be glad to do my part."
1053651912,15769,xavier2k6,2022-02-27T19:18:24Z,"> @xavier2k6 I have seen your comment on another thread. Is there any way I can give you the credit you are due?
> 
> I would be glad to do my part.

Apologies.......we all need a little rant now & again, nothing personal to you or anyone else involved there.

There is a way to give me credit/co-author but is not hugely important for this PR or to me at this time.

I'm only trying to help best way I can."
1053894655,15769,Mazino-Urek,2022-02-28T05:07:09Z,"I have a proposal. What about you do `transfer list` coloring in a separate PR after this gets merged, and I will provide you feedback there?
Let's just tackle the other issues and get this done."
1054154306,15769,xavier2k6,2022-02-28T11:20:31Z,Mark it for review & let others comment/advise.
1054169523,15769,Mazino-Urek,2022-02-28T11:39:29Z,Got it.
1054259214,15769,Mazino-Urek,2022-02-28T13:30:43Z,@Chocobo1 @glassez Ready for review.
1054982361,15769,glassez,2022-03-01T04:01:38Z,"I see that a lot of icon names have been changed. I don't remember if this was mentioned earlier, but, IIRC, the icon names were initially chosen based on compatibility with those of the system themes used in Linux etc. Has anyone tried to enable a system theme support on top of this PR?"
1055012468,15769,Mazino-Urek,2022-03-01T04:44:40Z,"> I see that a lot of icon names have been changed. I don't remember if this was mentioned earlier, but, IIRC, the icon names were initially chosen based on compatibility with those of the system themes used in Linux etc. Has anyone tried to enable a system theme support on top of this PR?

One of the huge problem regarding redesigning the icons were that loads of icons were not reflecting its name. Plus, it was agreed that qbittorrent should keep as much previous icon names as possible but new icons will have simpler and better name. That is why some new icon names were introduced. As far as I understand only in Linux OSes it will have some issues."
1055244969,15769,xavier2k6,2022-03-01T09:58:10Z,"Feedback on these `text `colors for `transfer list`?

(Queued is left out  as this is a WIP & original icons are being used hence why they don't match up with text)

![new transfer list colors v4](https://user-images.githubusercontent.com/42386382/156146748-dbbde744-291d-401a-953b-f9833c561185.png)
____

![new transfer list colors v3](https://user-images.githubusercontent.com/42386382/156146764-40d276ba-7f47-46ce-99dd-a1b8beaf4cf1.png)

"
1055252605,15769,xavier2k6,2022-03-01T10:04:57Z,"One thing that bugs me with `Stalled` status is that if a torrent enters `stalled downloading` it's reflected as `Stalled` but if it enters `stalled uploading` it's reflected as `Seeding` still......

It would be better if the status for these two were able to be more defined i.e. `Stalled Downloading/Stalled Uploading` instead of just stalled."
1055521883,15769,Mazino-Urek,2022-03-01T14:46:48Z,"@xavier2k6 The issue is other than blue, no color is looking good in both dark and white theme. 
1. Light green is working well in dark theme, but not in dark theme. Opposite is with green color. 
2. Red is not working in dark mode.

You get the point. Can we do something like this from **`src/gui/transferlistmodel.cpp`**:
```
case BitTorrent::TorrentState::ForcedDownloadingMetadata:
        if (!dark)
            return {15, 187, 88}; // Deep Green
        else
            return {108, 194, 74}; // Light Green
```
"
1055589171,15769,xavier2k6,2022-03-01T15:54:36Z,">Light green is working well in dark theme, but not in dark theme. Opposite is with green color.

I think they look fine in both themes IMO & I'm not using different `RGB` colorings.

>Red is not working in dark mode.

Well, that's the color it's always been `master` & there's been no differentiation in the code for light/dark mode. Nobody's complained about it before until now.

https://github.com/qbittorrent/qBittorrent/blob/299f981441292b640459ae10fd344738bc920021/src/gui/transferlistmodel.cpp#L734-L736

https://github.com/qbittorrent/qBittorrent/blob/299f981441292b640459ae10fd344738bc920021/src/gui/transferlistmodel.cpp#L747-L751"
1055646467,15769,Mazino-Urek,2022-03-01T16:52:52Z,"@xavier2k6 I am not saying it is bad. It is good, actually. However, it can be better by tweaking a bit.

Try this in the place of red.
`
 {219, 50, 54}; // Bright Red`"
1055668061,15769,thalieht,2022-03-01T17:13:05Z,I remember @sledgehammer999 requested to be called before any major GUI changes are merged
1057067140,15769,Mazino-Urek,2022-03-02T15:36:27Z,"@xavier2k6 @thalieht I have figured the transfer list problem. 
Based on [World Wide Web Consortium (W3C)](https://www.w3.org/TR/WCAG20-TECHS/G18.html), if the background is one color, text color and back color should have 4.5:1 contrast ratio. I have applied this theory to the transfer list. To be safe, I maintained 5:1 ratio. Check out the result.
You can use this brilliant adobe [tool](https://color.adobe.com/create/color-contrast-analyzer) to experiment with colors.

Update: It is not working out. It works only in light theme. When I apply a dark theme, It still shows the light theme color. Which doesn't work.

Update 2: Rather than using two colors, I have applied one color that has 4.5:1 contrast ratio in both light and dark theme. This is as far as my brain allows."
1059712202,15769,Mazino-Urek,2022-03-05T07:24:46Z,@xavier2k6 Reverted most `transferlist` changes. Up to you now.
1059961349,15769,xavier2k6,2022-03-06T13:17:49Z,"> @xavier2k6 @thalieht I have figured the transfer list problem. Based on [World Wide Web Consortium (W3C)](https://www.w3.org/TR/WCAG20-TECHS/G18.html), if the background is one color, text color and back color should have 4.5:1 contrast ratio. I have applied this theory to the transfer list. To be safe, I maintained 5:1 ratio. Check out the result. You can use this brilliant adobe [tool](https://color.adobe.com/create/color-contrast-analyzer) to experiment with colors.
> 
> Update: It is not working out. It works only in light theme. When I apply a dark theme, It still shows the light theme color. Which doesn't work.
> 
> Update 2: Rather than using two colors, I have applied one color that has 4.5:1 contrast ratio in both light and dark theme. This is as far as my brain allows.

I'll look in to this for you more in next few days (that `color-contrast-analyzer` certainly looks promising), I think it is possible for the `transfer list text` to just use one color across both light/dark themes for each `torrent state`."
1059995373,15769,xavier2k6,2022-03-06T16:37:53Z,"@now-im we may need to change some icon colors to match text in transfer list especially when `orange` seems to be an issue with `contrast` etc.

Leave it with me for now....."
1059999519,15769,Mazino-Urek,2022-03-06T17:03:14Z,"Ok, if it is necessary. No problem."
1061015992,15769,xavier2k6,2022-03-07T18:50:27Z,"There was a menu action added in a previous PR that needs a change in icon naming otherwise with this PR the icon is missing.

`src/gui/transferlistfilterswidget.cpp`

Change `edit-delete` to `list-remove`
```
void StatusFilterWidget::showMenu()
{
    QMenu *menu = new QMenu(this);
    menu->setAttribute(Qt::WA_DeleteOnClose);

    menu->addAction(UIThemeManager::instance()->getIcon(""media-playback-start""), tr(""Resume torrents"")
        , transferList, &TransferListWidget::startVisibleTorrents);
    menu->addAction(UIThemeManager::instance()->getIcon(""media-playback-pause""), tr(""Pause torrents"")
        , transferList, &TransferListWidget::pauseVisibleTorrents);
    menu->addAction(UIThemeManager::instance()->getIcon(""edit-delete""), tr(""Delete torrents"")
        , transferList, &TransferListWidget::deleteVisibleTorrents);

    menu->popup(QCursor::pos());
}
```"
1061806298,15769,Mazino-Urek,2022-03-08T13:57:40Z,Done.
1067850152,15769,Mazino-Urek,2022-03-15T11:02:40Z,@xavier2k6 Ping.
1067979211,15769,ghost,2022-03-15T13:19:07Z,"The tray icon looks a bit small to me.
The speedometer icons everywhere looks like trash.
This icon also very bad view-calendar-journal.
Icon used for completed torrents is too bright."
1068557264,15769,xavier2k6,2022-03-15T23:21:16Z,"> The tray icon looks a bit small to me.

Has been highlighted before, will hopefully be sorted at later stage.

>The speedometer icons everywhere looks like trash.

They're better than what's currently available, although alternative icons were suggested previously in another PR.

>This icon also very bad view-calendar-journal.

Perhaps `help-contents.svg` can be used in-place of `view-calendar-journal.svg` for `Execution log` & `help-about.svg` can be used for `general tab`

>Icon used for completed torrents is too bright.

Colors aren't final yet.......still a WIP

Appreciate the feedback though.

"
1068700056,15769,Mazino-Urek,2022-03-16T03:43:32Z,"> Perhaps `help-contents.svg` can be used in-place of `view-calendar-journal.svg` for `Execution log` & `help-about.svg` can be used for `general tab`

I can get behind this.



> > Icon used for completed torrents is too bright.
> 
> Colors aren't final yet.......still a WIP

Only transfer list colors are incomplete. Icon colors are at this point fixed, I say."
1068909899,15769,xavier2k6,2022-03-16T09:26:18Z,">Icon colors are at this point fixed, I say.

Then we can't really use the `W3C` contrast ratio of `4.5:1` ""orange"" for example.....

We have to be practical too over vibrancy, IMO. (we aren't going to be able to cater to everyone or every use case.)"
1068923579,15769,Mazino-Urek,2022-03-16T09:41:14Z,"> Then we can't really use the `W3C` contrast ratio of `4.5:1` ""orange"" for example.....
> 
> We have to be practical too over vibrancy, IMO. (we aren't going to be able to cater to everyone or every use case.)

I get it. However, `4.5:1` is for text color in a solid background. 
In example, In a white Word document, the text color(which are by default in 10-12 size range) must have at least 4.5:1 contrast ratio. That is applicable to `transferlist` but icons are bigger and more easily visible. 
I am not saying I am against color change. I am willing to adjust them if necessary. The thing is, the original PR #8406 is dragging from February 2018. So, you might understand if I am not as enthusiastic as I used to be about bigger changes."
1069043008,15769,xavier2k6,2022-03-16T11:51:38Z,"@now-im I totally get where you're coming from.

I just think though - aiming for 100% `4.5:1` contrast for approximately 10 colors across both light & dark themes requires an awful lot of time/work especially when trying to keep differentiation between what the torrent `states` represent.

We've only had one real instance where `readability` was an issue across light/dark themes & this will hopefully be resolved soon elsewhere.

In relation to the speed icons, I don't really have an issue with them........so it's all down to users opinion, I will say though that the alternative (free) icons I had suggested have now been put under a pay-wall."
1069146728,15769,xavier2k6,2022-03-16T13:44:03Z,"I honestly think that the `example method` I used from https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1055244969 is currently the way to go due to it being practical/~eligible~ legible & this includes code wise too, with this method we can match the icons `HEX Value` to the `associated transfer list model text` perfectly to maintain consistency."
1069235956,15769,Mazino-Urek,2022-03-16T15:13:13Z,"> I honestly think that the `example method` I used from [#15769 (comment)](https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1055244969) is currently the way to go due to it being practical/eligible & this includes code wise too, with this method we can match the icons `HEX Value` to the `associated transfer list model text` perfectly to maintain consistency.

On second inspection, most of them are rather good. My only complaint is tone down the red just a bit. Others look ok."
1069727455,15769,Pentaphon,2022-03-16T23:06:49Z,"> We have to be practical too over vibrancy, IMO.

I agree with this. The single most important thing is legibility. This probably won't be merged until 4.5 so there's time to tweak it. "
1072298373,15769,xavier2k6,2022-03-18T10:57:24Z,"@now-im Quick glance, All CI failing to build due to below:

`        m_ui->lineEFilter->setStyleSheet(u""QLineEdit { color: #ff0000; }_qs"");`

It should be:

`        m_ui->lineEFilter->setStyleSheet(u""QLineEdit { color: #ff0000; }""_qs);`
____

[ Note the placement of quotation mark `""` by `_qs` ]

File reference (Line 818):
`/src/gui/rss/automatedrssdownloader.cpp`"
1072461524,15769,Mazino-Urek,2022-03-18T14:25:04Z,@xavier2k6 Fixed.
1072992762,15769,xavier2k6,2022-03-19T11:29:07Z,"> Fixed.

👍 
____

I think I've made some significant headway in transfer list text colors - just need `checked-completed` to be differentiated now from the rest. (Have to take in to account when the text is highlighted, that it's still legible)

Will update with screenshots at later stage."
1079079258,15769,Mazino-Urek,2022-03-25T14:25:06Z,"@thalieht Didn't get any reply from @sledgehammer999.
What now?"
1079194311,15769,thalieht,2022-03-25T16:28:24Z,"@now-im you should rebase. There were compilation errors last time you did and they are now fixed. As for @sledgehammer999 he is always pretty busy AFAIK. May take some time to respond. We now know he is aware of this PR so If he doesn't respond, it's up to the devs what happens."
1079254022,15769,Mazino-Urek,2022-03-25T17:37:47Z,"> @now-im you should rebase. There were compilation errors last time you did and they are now fixed.

Right now, this is PR is completely rebased without any problem. Build errors are from master.



> he is always pretty busy AFAIK. May take some time to respond. We now know he is aware of this PR so If he doesn't respond, it's up to the devs what happens.

Got it."
1079297733,15769,xavier2k6,2022-03-25T18:34:19Z,">> Perhaps `help-contents.svg` can be used in-place of `view-calendar-journal.svg` for `Execution log` & `help-about.svg` can be used for `general tab`
>
>I can get behind this.

@an0n666 Are you ok with this (examples below)?

![General](https://user-images.githubusercontent.com/42386382/160180601-184f1697-508c-43ea-8381-cdf837341cf4.png)
____

![Execution Log P2](https://user-images.githubusercontent.com/42386382/160180606-d45ce03e-59cd-4811-853c-15387ee4c036.png)
____

![Execution Log](https://user-images.githubusercontent.com/42386382/160180607-4bf498d5-163d-443f-8a05-b86bccf408c8.png)
____

![Execution Log P3](https://user-images.githubusercontent.com/42386382/160180604-515b5c64-1b3f-4a23-acfd-3f040edbc8c1.png)"
1079711769,15769,Mazino-Urek,2022-03-26T15:04:33Z,"@xavier2k6 We should at least add another one. It is getting overused.
What about this?
![image](https://user-images.githubusercontent.com/22009014/160245591-a96a304a-c906-46e7-b737-b6dcbe3ac1d0.png)
"
1079739124,15769,xavier2k6,2022-03-26T17:31:27Z,">>We should at least add another one. It is getting overused.
>
>>What about this?

It looks like the top-down view of the star ship enterprise & another ship! 🤣
I don't think it fits in & don't see the real need to change/add it.

Only icon that could be changed is `view-refresh` as I'm still not 100% sold on it in the GUI.....just doesn't look right on 1080p screen.......it looks ok on 125%+ scaling etc. (it could be just me & that I have a hang-up  about it) 🤣 
____

I have all transfer list text colors hopefully sorted now for `9 torrent states` & they match the associated icons from `filter list`.
(originally there was `7 torrent states` - some shared same color)

![new transfer filter list colors](https://user-images.githubusercontent.com/42386382/160250584-0488c518-b570-4bbd-be94-9a1fa23dba4a.png)
____

**Was also thinking of having variations of tracker icons.**

![tracker icons](https://user-images.githubusercontent.com/42386382/160254684-b55b020c-ad13-43c2-baba-6c14f5520d2d.png)"
1079842451,15769,Mazino-Urek,2022-03-27T05:17:03Z,"> It looks like the top-down view of the star ship enterprise & another ship! 🤣

Ok. I deserve this one.

> Only icon that could be changed is `view-refresh` as I'm still not 100% sold on it in the GUI.....just doesn't look right on 1080p screen.......it looks ok on 125%+ scaling etc. (it could be just me & that I have a hang-up about it) 🤣

I will have a look.

> I have all transfer list text colors hopefully sorted now for `9 torrent states` & they match the associated icons from `filter list`. (originally there was `7 torrent states` - some shared same color)

That is a lot of color. More color equals to more dark/light theme conflict.



"
1079949530,15769,Mazino-Urek,2022-03-27T15:04:55Z,@xavier2k6 I have changed `view-refresh` a bit. Check it out.
1081735352,15769,xavier2k6,2022-03-29T11:09:12Z,"Still unsure of it in `GUI`.....however, what do you think about using the `repeat` icon??....you used a flipped version of this for `force-recheck`.

![reset check](https://user-images.githubusercontent.com/42386382/160597163-21d91679-4498-4c49-9978-b2725dd19628.png)
____

![ip filter refresh](https://user-images.githubusercontent.com/42386382/160597166-35425ead-2c0c-4362-a2b7-fbb07b9824ed.png)
____

I know the text says `reset` here (as in reset-to-defaults) & you changed the icon for `view-refresh` but I think it should be reverted to `edit-clear`

![reset categories](https://user-images.githubusercontent.com/42386382/160597251-1e1b2556-1c86-435f-a20d-ca586e4af147.png)
____

We could re-word if really required to maybe `Remove` to be consistent with `Tags`.
![revert reset](https://user-images.githubusercontent.com/42386382/160598373-6a3fcdfc-677d-483f-b5d7-c59d6f224893.png)
"
1081872903,15769,Mazino-Urek,2022-03-29T13:28:22Z,"> Still unsure of it in `GUI`.....however, what do you think about using the `repeat` icon??....you used a flipped version of this for `force-recheck`.

@xavier2k6 What about, rather than shape cut, only this?
![image](https://user-images.githubusercontent.com/22009014/160617969-a76f316e-9675-4073-b574-aa71ff80c97b.png)

I think, `force-recheck` might work better as a square icon.
![image](https://user-images.githubusercontent.com/22009014/160622015-03810d05-d4b2-4245-8037-42d0e67482b8.png)

> We could re-word if really required to maybe `Remove` to be consistent with `Tags`.

Done.
"
1081924253,15769,xavier2k6,2022-03-29T14:12:55Z,">What about, rather than shape cut, only this?

That works except for the pointed edges....that kind of thing was mentioned previously by another member........another icon that could work is the `sync` icon, it was used previously but the arrow lines were a bit thin - if they were thickened.....could be a viable solution too."
1081959386,15769,Mazino-Urek,2022-03-29T14:42:33Z,@xavier2k6 Check out.
1082002293,15769,xavier2k6,2022-03-29T15:16:26Z,">Check out.

It's not as rounded as `sync` icon.....looks a bit like an oval `0` instead of circle `O` also I would take a tiny bit off the tail end of the arrow line to increase the gap (if you understand what I mean)

>I think, `force-recheck` might work better as a square icon.

If you're going to mage it square then line it up as much as possible that it looks like it's a square."
1082012001,15769,xavier2k6,2022-03-29T15:23:37Z,">> I have all transfer list text colors hopefully sorted now for `9 torrent states` & they match the associated icons from `filter list`. (originally there was `7 torrent states` - some shared same color)
>
>>That is a lot of color. More color equals to more dark/light theme conflict.

I don't think so........If you look at code, we currently have `12 text colors` for `7 torrent states` (in transfer list).

`Downloading` - 2x colors (1x light, 1x dark)
`Stalled Downloading/Stalled Uploading` - 2x colors (1x light, 1x dark - shared/no differentiation)
`Seeding` - 2x colors (1x light, 1x dark)
`Paused` - 1x color
`Completed` - 2x colors (1x light, 1x dark)
`Errored` - 1x color
`Queued / Checking / Moving` - 2x colors (1x light, 1x dark - shared/no differentiation)
____

Now I have `9 torrent states` differentiated with `9 text colors` which match the associated icons & are readable across both light/dark theme.
`Downloading` - 1x color
`Stalled Downloading` - 1x color
`Stalled Uploading` - 1x color
`Seeding` - 1x color
`Paused` - 1x color
`Completed` - 1x color
`Errored` - 1x color
`Queued` - 1x color
`Checking / Moving` - 1x color (shared/no differentiation for now as `moving` may be added to `filter list` in another PR)"
1082048078,15769,Mazino-Urek,2022-03-29T15:48:56Z,"@xavier2k6 Done.
On your change, I really don't have any major issue with it. In your PR, I will provide some feedback.
Will this work?
![image](https://user-images.githubusercontent.com/22009014/160654516-acef423e-5864-41f6-8b3b-d4a9e5e95825.png)

Alternative:
![image](https://user-images.githubusercontent.com/22009014/160657085-8170e229-7696-4102-9157-315afb546848.png)
"
1083370419,15769,xavier2k6,2022-03-30T16:38:19Z,"Reference: https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1082048078

>Will this work?

How about using something like that & give it the look of https://fontawesome.com/v5/icons/sync-alt?style=solid&s=solid (rounded edges) for `force-recheck`.

Perhaps then we could just use one icon for `force-recheck` & `checking`??

>Alternative:

👍 

Can you also change `stroke-width=""3""` to `stroke-width=""4""` for `set-location` just to thicken the icon lines.

Maybe the blue lines of relevant `speed` icons can be thickened slightly too.....this may improve the look & feel to help alleviate others comments."
1083406191,15769,Mazino-Urek,2022-03-30T17:13:27Z,"> How about using something like that & give it the look of https://fontawesome.com/v5/icons/sync-alt?style=solid&s=solid (rounded edges) for `force-recheck`.

![image](https://user-images.githubusercontent.com/22009014/160890357-535d4a2e-199d-4d7b-8517-f2972cb36e2d.png)



> Perhaps then we could just use one icon for `force-recheck` & `checking`??

Using, `force-recheck`, as it is more distinguishable.

> Can you also change `stroke-width=""3""` to `stroke-width=""4""` for `set-location` just to thicken the icon lines.
> 
> Maybe the blue lines of relevant `speed` icons can be thickened slightly too.....this may improve the look & feel to help alleviate others comments.

Done. 

Is the PR ready for final review?"
1083451546,15769,xavier2k6,2022-03-30T18:05:11Z,">Is the PR ready for final review?

For me...it's very very close....depends on transfer list text colors & change in icon colors being accepted.
(this would also mean a change in readme etc. for source of colors/naming.)

You may still have to make more than one commit to make it easier for review.....I will let others decide/give feedback on that.
As I said previously, this is a big `default theme overhaul` with newly added icons/differentiated icons/color changes etc.

If it does need to be split up in to different commits or even separate PR's - I will help with that or can do it/will make sure you get credited as `co-author` in the commits.

(feedback on below? from https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1079739124)

![new transfer filter list colors](https://user-images.githubusercontent.com/42386382/160250584-0488c518-b570-4bbd-be94-9a1fa23dba4a.png)
____

**Was also thinking of having variations of tracker icons.**

![tracker icons](https://user-images.githubusercontent.com/42386382/160254684-b55b020c-ad13-43c2-baba-6c14f5520d2d.png)
____

>Using, `force-recheck`, as it is more distinguishable.

Ok, you didn't substitute it for the `checking` icon/just deleted it......so code needs to be changed to reflect the change in filter list otherwise checking has no icon displayed."
1083545893,15769,Mazino-Urek,2022-03-30T19:34:00Z,"> For me...it's very very close....depends on transfer list text colors & change in icon colors being accepted. (this would also mean a change in readme etc. for source of colors/naming.)
> 
> You may still have to make more than one commit to make it easier for review.....I will let others decide/give feedback on that. As I said previously, this is a big `default theme overhaul` with newly added icons/differentiated icons/color changes etc.

As I have said, after this gets merged. You should do the icon and transfer list coloring. I will provide you feedback. I think current colors are OK. Version 4.5 will be released soon, and as I see you have already done lots of work.

If I didn't make this a single commit, there would have been more than 500 commits now. That would make things more 
complex. Looking at File Change in GitHub provides visual changelog. That should work.

> If it does need to be split up in to different commits or even separate PR's - I will help with that or can do it/will make sure you get credited as `co-author` in the commits.

No problem.

> Was also thinking of having variations of tracker icons.

I can do that. Thinking about:
1. tracker-good
2. tracker-less
3. tracker-error
4. tracker-warning

Help me with the code.

> Ok, you didn't substitute it for the `checking` icon/just deleted it......so code needs to be changed to reflect the change in filter list otherwise checking has no icon displayed.

Fixed.
"
1086637031,15769,ghost,2022-04-02T13:07:39Z,"You’ve done a great job but is it that the main devs don’t want to integrate such a big change which isn’t easily revert-able or switchable?
Why can’t we have this as a 2nd set of theme? Maybe I’m old school and want to stick to the old icons or switch back and forth. "
1086645177,15769,xavier2k6,2022-04-02T13:48:06Z,">You’ve done a great job but is it that the main devs don’t want to integrate such a big change which isn’t easily revert-able or switchable?

I've done an awful lot of work too helping with code etc.

Edit:
Also @an0n666 you may have missed this https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1079297733 & speed icons have been updated......have a look.

We've added icons where there wasn't any before. (this would actually close 1 open issue)
Removed unused icons.
Replaced similar icons.
Used appropriate icons in places that better reflect the actions etc.
____

Currently, icons from filter list don't match text colors from transfer list.......
This could be done here but @now-im seems to be against it.
We've had no further feedback from other team-members on separating commits (I think they should be)
Need to add before/after screenshots.

I would be willing to create a new PR with separated commits/screenshots etc. but not until there's some more feedback general consensus to drive forward with this.

Maintainer has final say anyway even after all this work!."
1086648876,15769,ghost,2022-04-02T14:09:59Z,"Checked it and it's better than before however,
Speedometer is too small/odd looking.
Icons for RSS and search engine are missing in View menu.
Taskbar icon is too small.
"
1086650060,15769,xavier2k6,2022-04-02T14:16:34Z,">Checked it and it's better than before however,
Speedometer is too small/odd looking.

Unsure of what can be used instead from the provided source `ionicons / la-capitain`.

>Icons for RSS and search engine are missing in View menu.

These are actually checkboxes.....If you click one of them & then go back to view menu again, you will see a `tick` next to it.

![search_rss_checkboxes](https://user-images.githubusercontent.com/42386382/161387397-0632285d-0c89-40a2-84db-de08696184c3.png)

If you run qBittorrent under `fusion style` - you will actually see the check boxes.

![search_rss_checkboxes_fusionstyle](https://user-images.githubusercontent.com/42386382/161387539-d16bb2c7-a4af-4192-9635-56fb1e7d8169.png)


>Taskbar icon is too small.

Can you elaborate?"
1086653110,15769,ghost,2022-04-02T14:33:35Z,">Can you elaborate?
>
I mean icon in notificaiton area is too small."
1086654290,15769,xavier2k6,2022-04-02T14:41:00Z,">>Can you elaborate?
>
I mean icon in notificaiton area is too small.

Ah yes I now know what you mean......that change was previously requested to be reverted."
1086655101,15769,Mazino-Urek,2022-04-02T14:46:04Z,"@an0n666 You might not know this is a five-year-old effort. I provided a demo, main devs liked it, and then I continued my work. First reviewers were @thalieht and @FranciscoPombal. I closed the PR for several times because of frustration. Finally, @xavier2k6 came along last year and really became an integral part of this project. @ArcticGems helped with icon choices too.

> Currently, icons from filter list don't match text colors from transfer list.......
> This could be done here but @now-im seems to be against it.

For two reasons:
1. In that way, you get the proper credit for these changes,
2. I still don't know if these will merge or not.

> Why can’t we have this as a 2nd set of theme? Maybe I’m old school and want to stick to the old icons or switch back and forth.

@jagannatharjun maintains a style sheet theme. He has mentioned before, he will update the pack to include the old theme."
1086658023,15769,xavier2k6,2022-04-02T15:03:05Z,">In that way, you get the proper credit for these changes

As I said previously you/me could be assigned as `co-author` so github history etc will show who contributed to this project....It's just a click of a button.

see an example of `co-author` commit.
![co-author example](https://user-images.githubusercontent.com/42386382/161388844-95f4b9a6-98ea-4984-97ac-81c1de255592.png)
____

>I still don't know if these will merge or not.

I think creating more than one commit would have a better chance or even separate PR's. (would really require more team-members participation/direction)

I am a team-member of this project so it would be really unethical of me to try & steal someone's work & not credit them!! if i was to undertake that work."
1086658679,15769,xavier2k6,2022-04-02T15:06:43Z,"> > > Can you elaborate?
> > 
> > 
> > I mean icon in notificaiton area is too small.
> 
> For me it isn't to small. Can you take a screenshot?

official qBittorrent 4.4.2 on left / this PR on right.

![taskbar_notification](https://user-images.githubusercontent.com/42386382/161389278-ff3abf51-5420-4f6a-af35-b013c71390a5.png)

"
1086661062,15769,Mazino-Urek,2022-04-02T15:21:25Z,"> As I said previously you/me could be assigned as `co-author` so github history etc will show who contributed to this project....It's just a click of a button.
> 
> see an example of `co-author` commit.

Ok, this works perfectly.

> official qBittorrent 4.4.2 on left / this PR on right.

Let me see, what went wrong."
1086688182,15769,Mazino-Urek,2022-04-02T17:44:13Z,"@xavier2k6 I need your email to add as co-author.

I have pushed a fix for notification area icon. Check it out."
1086695042,15769,xavier2k6,2022-04-02T18:16:21Z,"I use github desktop so only an `@` mention was required for `co-author`........ please try `42386382+xavier2k6@users.noreply.github.com`

>I have pushed a fix for notification area icon. Check it out.

Will check it......

Are you ok so with changing icon colors `hex value` & adding text color changes here too?"
1086696205,15769,Mazino-Urek,2022-04-02T18:22:20Z,"> I use github desktop so only an `@` mention was required for `co-author`........ please try `42386382+xavier2k6@users.noreply.github.com`
> 
> > I have pushed a fix for notification area icon. Check it out.
> 
> Will check it......
> 
> Are you ok so with changing icon colors `hex value` & adding text color changes here too?

Ok."
1092891496,15769,Mazino-Urek,2022-04-08T14:00:57Z,"@xavier2k6 Ping.
@glassez @Chocobo1 Can you review this PR now? It is mostly ready. Further improvement can be done in future PRs. "
1093412920,15769,xavier2k6,2022-04-08T22:20:43Z,">> Was also thinking of having variations of tracker icons.
>
>I can do that. Thinking about:
>1. tracker-good

I suggest just keeping `trackers.svg` for trackers (all)

![tracker icons](https://user-images.githubusercontent.com/42386382/160254684-b55b020c-ad13-43c2-baba-6c14f5520d2d.png)

>2. tracker-less

Just use `trackerless`

>3. tracker-error

👍 

>4. tracker-warning

👍 

>Help me with the code.

`/src/gui/transferlistfilterswidget.cpp`

Change `trackers` -> `trackerless`
'noTracker->setData(Qt::DecorationRole, UIThemeManager::instance()->getIcon(u""trackers""_qs));'

Change `error` -> `tracker-error`
`errorTracker->setData(Qt::DecorationRole, UIThemeManager::instance()->getIcon(u""error""_qs));`

Change `dialog-warning` -> `tracker-warning`
`warningTracker->setData(Qt::DecorationRole, UIThemeManager::instance()->getIcon(u""dialog-warning""_qs));`
____

Will follow up with icon color & transfer list text changes after that then."
1093749853,15769,Mazino-Urek,2022-04-09T06:44:30Z,"> I found one issue with the webui: the paused state icon is missing.

@xavier2k6 Help me here.

Tracker changes have been made."
1094056783,15769,xavier2k6,2022-04-09T14:44:17Z,"> > I found one issue with the webui: the paused state icon is missing.
> 
> @xavier2k6 Help me here.

`/src/webui/www/private/views/filters.html`


Change `checking.svg` to `force-recheck.svg`
`<li id=""checking_filter""><a href=""#"" onclick=""setFilter('checking'); return false;""><img src=""icons/checking.svg"" alt=""Checking""`

> Tracker changes have been made.

ok.

notification issue seems to be corrected too. (quick glance)"
1094073009,15769,thalieht,2022-04-09T15:52:51Z,">I found one issue with the webui: the paused state icon is missing.

Completed too and GUI checking icon is missing:

```
--- a/src/gui/transferlistmodel.cpp
+++ b/src/gui/transferlistmodel.cpp
@@ -793,7 +793,7 @@ QIcon getCompletedIcon()
 
 QIcon getCheckingIcon()
 {
-    static QIcon cached = UIThemeManager::instance()->getIcon(u""checking""_qs);
+    static QIcon cached = UIThemeManager::instance()->getIcon(u""force-recheck""_qs);
     return cached;
 }
 
diff --git a/src/webui/www/private/scripts/dynamicTable.js b/src/webui/www/private/scripts/dynamicTable.js
index 24db238fd..634a5c946 100644
--- a/src/webui/www/private/scripts/dynamicTable.js
+++ b/src/webui/www/private/scripts/dynamicTable.js
@@ -944,10 +944,10 @@ window.qBittorrent.DynamicTable = (function() {
                         state = ""uploading"";
                         break;
                     case ""pausedDL"":
-                        state = ""paused"";
+                        state = ""media-playback-pause"";
                         break;
                     case ""pausedUP"":
-                        state = ""completed"";
+                        state = ""checked-completed"";
                         break;
                     case ""queuedDL"":
                     case ""queuedUP"":
```

Also GUI and WebUI ""Set location..."" icons are different."
1094084196,15769,Mazino-Urek,2022-04-09T16:52:50Z,"@xavier2k6 Done.


> Also GUI and WebUI ""Set location..."" icons are different.

Help me here."
1094088182,15769,xavier2k6,2022-04-09T17:15:35Z,"> @xavier2k6 Done.
> 
> > Also GUI and WebUI ""Set location..."" icons are different.
> 
> Help me here.

`/src/webui/www/private/index.html`

Change `inode-directory.svg` to `set-location.svg`
`<a href=""#setLocation""><img src=""icons/inode-directory.svg"" alt=""QBT_TR(Set location...)QBT_TR[CONTEXT=TransferListWidget]""`"
1094088852,15769,Mazino-Urek,2022-04-09T17:19:38Z,@xavier2k6 @thalieht Done.
1094103151,15769,xavier2k6,2022-04-09T18:33:19Z,"You forgot a part of what thalieht pointed out.

`/src/webui/www/private/scripts/dynamicTable.js`

`state = ""paused"";` -> `state = ""media-playback-pause"";`

&

`state = ""completed"";` -> `state = ""checked-completed"";`"
1094103607,15769,thalieht,2022-04-09T18:36:17Z,"and
`state = ""checking""; -> state = ""force-recheck"";`"
1094104046,15769,Mazino-Urek,2022-04-09T18:39:04Z,Done.
1094104329,15769,xavier2k6,2022-04-09T18:40:53Z,"@thalieht seems to be an issue with `RSS Downloader` too (download rules)

`list-add` & `list-remove` icons are used here but are really zoomed-in if you know what I mean.

![rss downloader](https://user-images.githubusercontent.com/42386382/162587446-fcfe6654-1439-4e94-b70e-0ab99ab8ac30.png)

"
1094104947,15769,Mazino-Urek,2022-04-09T18:44:51Z,@xavier2k6 Shouldn't we use `edit-clear` in lieu of `list-remove`?
1094106992,15769,xavier2k6,2022-04-09T18:58:10Z,"> Shouldn't we use `edit-clear` in lieu of `list-remove`?

Ya, I think we should.

`GUI` & `WebUI`"
1094112420,15769,Mazino-Urek,2022-04-09T19:33:37Z,@xavier2k6 I might have fixed `WebUI`. Not sure about `GUI`.
1094132712,15769,xavier2k6,2022-04-09T22:13:58Z,">I might have fixed `WebUI`. Not sure about `GUI`.

Other way around `GUI` is fine, just for `WebUI`

`/src/webui/www/private/views/rssDownloader.html`

2x instances of `list-remove` -> `edit-clear`"
1094229379,15769,Mazino-Urek,2022-04-10T09:34:05Z,Done.
1096756282,15769,xavier2k6,2022-04-12T13:50:13Z,"Need to address this https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1079297733 & can remove `view-calendar-journal.svg` then.

There seems to be one more `WebUI` anomaly but need to see if that's in official version/master builds too or just from this PR."
1096887462,15769,Mazino-Urek,2022-04-12T15:37:43Z,"@xavier2k6 I have done my best, although I am not sure if I have done it entirely right. Kindly test.
These are the places, icon was found.
![image](https://user-images.githubusercontent.com/22009014/163000169-70a18d3b-ec65-464d-a70e-361575520e1c.png)
"
1097082598,15769,xavier2k6,2022-04-12T18:44:56Z,"`src/gui/properties/proptabbar.cpp` should have `help-about` instead of `help-contents` & it'll be fine then.

![General](https://user-images.githubusercontent.com/42386382/160180601-184f1697-508c-43ea-8381-cdf837341cf4.png)"
1097103658,15769,Mazino-Urek,2022-04-12T18:59:17Z,Fixed.
1097108750,15769,xavier2k6,2022-04-12T19:04:56Z,@now-im Can you make `office-chart-line` have two colors? `blue/green/blue/green` - this would better represent `download/upload` imo.
1097923692,15769,Mazino-Urek,2022-04-13T11:11:39Z,@xavier2k6 Done.
1098823513,15769,Mazino-Urek,2022-04-14T08:04:10Z,"@xavier2k6 @thalieht @Chocobo1 Any more changes?
The PR has been rebased to the master."
1098970321,15769,xavier2k6,2022-04-14T10:01:40Z,">Any more changes?

TODO:
- [ ] `WebUI` needs fixing around the collapse/expand area where `collapse` icon is used.

(this may be code related - haven't looked in to it fully, just quick observation)

![webui expand panel](https://user-images.githubusercontent.com/42386382/163361546-655e5ed7-035b-4912-a30c-43a3d59e58fb.png)
![webui collapse panel](https://user-images.githubusercontent.com/42386382/163361550-22cd1a36-097d-4136-b04e-c76a166b94ad.png)


- [x] All icon `HEX` values to be changed slightly

- [x] text transfer list match-up to `torrent state` icons

- [x] Possible `speed icon` changes to address others comments

(Variation of `time` icon perhaps?)

![speed icons](https://user-images.githubusercontent.com/42386382/163362055-44011e7a-882f-457c-be93-38487d0a1878.png)

After this, we are all good to go I'd say.

"
1099094576,15769,Mazino-Urek,2022-04-14T11:34:09Z,"@xavier2k6 I have made changes in speed icon. Made the stroke a bit thick as it might cause visibility issue.
I will need help on others.
"
1100647862,15769,xavier2k6,2022-04-16T11:54:49Z,"@now-im

Replace your current `transferlistmodel.cpp` file with the contents of `transferlistmodel.cpp` file below & change the `Hex Values` of listed icons to the values next to them.

(This is to match the colors of the 9 `torrent state` icons with their equivalent `text color`, we can change remaining colors later)

https://github.com/xavier2k6/qBittorrent/blob/GUI_Overhaul/src/gui/transferlistmodel.cpp

`downloading.svg` - `#008000`
`checked-completed.svg` - `#483d8b`
`force-recheck.svg` - `#008080`
`kt-set-max-upload-speed.svg` - `#4169e1`
`media-playback-pause.svg` - `#808080`
`queued.svg` - `#cd853f`
`stalledDL.svg` - `#3cb371`
`stalledUP.svg` - `#6495ed`
`error.svg` - `#ff0000`"
1100665450,15769,Mazino-Urek,2022-04-16T13:38:26Z,@xavier2k6 Done.
1100954066,15769,xavier2k6,2022-04-17T21:45:47Z,"Regarding `WebUI` - few small code changes left, will show you where later when I have more time."
1102861451,15769,xavier2k6,2022-04-19T16:38:02Z,"`/src/webui/www/private/index.html`

Replace 1x instance of `-3px` with `-4px`
Replace 1x instance of `1em` with `1.5em`
Replace 2x instances of `1.4em` with `1.5em`
____

`/src/webui/www/private/views/preferences.html`

Replace 2x instances of `1em` with `1.5em`"
1102954498,15769,Mazino-Urek,2022-04-19T18:24:56Z,"> `/src/webui/www/private/views/preferences.html`
> 
> Replace 2x instances of `1em` with `1.5em`

There are more than 2 `1em`, which one to change?"
1103130319,15769,xavier2k6,2022-04-19T20:39:42Z,"@now-im Apologies, I left out related to `slow.svg/slow_off.svg` in my prev. comment. (`Lines 371 & 389`)"
1103202881,15769,Mazino-Urek,2022-04-19T21:45:48Z,Done.
1105627233,15769,Mazino-Urek,2022-04-21T18:43:39Z,Anything left to do?
1105673858,15769,xavier2k6,2022-04-21T19:32:27Z,"> Anything left to do?

Yes, I'll be back to you....."
1107825399,15769,xavier2k6,2022-04-24T11:53:22Z,"@now-im as a heads up, there's been a new `export .torrent action` added in another PR....so we may need to change icon for this."
1107826607,15769,Mazino-Urek,2022-04-24T12:00:46Z,"@xavier2k6 `edit-copy` icon has been used for this action. Does it need a new icon?
I have rebased this PR to the master."
1110933847,15769,xavier2k6,2022-04-27T12:21:27Z,"> @xavier2k6 `edit-copy` icon has been used for this action. Does it need a new icon?

I'm ok with it, unless others oblect at a later stage...we can deal with it then if it comes to that.

Will move on to changing the rest of the color icons.

Will give input tonight.

Still haven't looked in to the webui icon issue but that's only a small thing.

"
1113168052,15769,xavier2k6,2022-04-29T10:50:08Z,"#### Step 1 of 6:

Change below icon colors to `#1e90ff`
____
`application-rss+xml`
`application-x-mswinurl`
`collapse`
`configure`
`edit-copy`
`edit-find`
`edit-find-user`
`edit-rename`
`folder-documents`
`folder-new`
`folder-remote`
`go-bottom`
`go-down`
`go-top`
`go-up`
`hash`
`help-about`
`help-contents`
`inode-directory`
`insert-link`
`kt-set-max-download-speed`
`list-add`
`loading`
`name`
`network-connect`
`network-server`
`plugins`
`preferences-desktop`
`preferences-other`
`preferences-system-network`
`preferences-web-browser-cookies`
`set-location`
`speedometer`
`tags`
`torrent-creator`
`trackers`
`view-categories`
`view-preview`
`view-refresh`
`webui`"
1113169465,15769,xavier2k6,2022-04-29T10:52:13Z,"#### Step 2 of 6:

Change below icon colors to `#008000`
____

`connected`
`security-high`
`task-complete`"
1113170038,15769,xavier2k6,2022-04-29T10:53:00Z,"#### Step 3 of 6:

Change below icon colors to `#32cd32`
____

`media-playback-start`
`media-seek-forward`
`reannounce`"
1113171918,15769,xavier2k6,2022-04-29T10:55:55Z,"#### Step 4 of 6:

Change below icon colors to `#ff8c00`
____

`dialog-warning`
`firewalled`
`object-locked`
`ratio`
`security-low`
`tracker-warning`"
1113174340,15769,xavier2k6,2022-04-29T10:59:24Z,"#### Step 5 of 6:

Change below icon colors to `#ff0000`
____

`application-exit`
`disconnected`
`edit-clear`
`filterinactive`
`list-remove`
`system-log-out`
`task-reject`
`tracker-error`
`wallet-open`"
1113176727,15769,xavier2k6,2022-04-29T11:02:56Z,"#### Step 6 of 6:

Change the `Hex Values` of listed icons to the values next to them.
____

`filteractive.svg` - `#bc8f8f`
`filterall.svg` - `#e9967a`
`filterstalled.svg` - `#40e0d0`
`trackerless.svg` - `#808080`"
1114211724,15769,xavier2k6,2022-05-01T11:39:56Z,"#### Mixed Color Icons:

Change the `Hex Values` of listed icons to the values next to them.
____

`kt-magnet.svg` - `#ff0000` & `#808080`
`mail-folder-inbox.svg` - `#1e90ff` & `#32cd32`
`office-chart-line.svg` - `#1e90ff` & `#32cd32`
`slow.svg` - `#1e90ff` & `#ff0000`
`slow_off.svg` - `#1e90ff` & `#008000`
`user-group-delete.svg` - `#1e90ff` & `#ff0000`
`user-group-new.svg` - `#1e90ff` & `#008000`
`view-statistics.svg` - `#1e90ff` & `#008000`"
1120431136,15769,Mazino-Urek,2022-05-08T14:42:37Z,Done.
1122543675,15769,Mazino-Urek,2022-05-10T15:26:54Z,"@xavier2k6 I just recovered from an extremely messy `git rebase` that I forced pushed to the branch. Kindly, finalize this. Other minor changes can be added later. This is getting really hard for me."
1122552310,15769,xavier2k6,2022-05-10T15:34:10Z,looks like you're able to recover from going back to previous commit...well done.
1122555427,15769,Mazino-Urek,2022-05-10T15:36:52Z,I was literally having a panic attack. An online guide to recover from force push helped me.
1122564916,15769,xavier2k6,2022-05-10T15:45:10Z,"> I was literally having a panic attack. An online guide to recover from force push helped me.

No problem.

@Chocobo1 When you have time, could you help/suggest a fix for WebUI issue from https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1098970321

@now-im After the WebUI issue above gets resolved....only 2x file changes required/screenshots to be added & job done."
1123134000,15769,Chocobo1,2022-05-11T03:12:57Z,">@Chocobo1 When you have time, could you help/suggest a fix for WebUI issue from https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1098970321

I took a quick look into it, it seems to be related to svg image resizing at HTML/css which I don't have much experience of..."
1125949207,15769,ArcticGems,2022-05-13T11:21:09Z,"> > @Chocobo1 When you have time, could you help/suggest a fix for WebUI issue from [#15769 (comment)](https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1098970321)
> 
> I took a quick look into it, it seems to be related to svg image resizing at HTML/css which I don't have much experience of...

@Piccirello Could you help here??
"
1126008986,15769,xavier2k6,2022-05-13T12:34:15Z,">I took a quick look into it, it seems to be related to svg image resizing at HTML/css which I don't have much experience of...

Ya, it seems to be tailored for `16x16` size....will look into layout margins...may need to be reconfigured to `0` ie `auto`"
1126302909,15769,Mazino-Urek,2022-05-13T17:58:23Z,@xavier2k6 Can you give me the color you have used? I will add them to the `readme`.
1126973316,15769,xavier2k6,2022-05-15T16:22:32Z,"> Can you give me the color you have used? I will add them to the `readme`.

Source for all colors I used is https://doc.qt.io/qt-6/qcolorconstants.html#svg-colors"
1133628035,15769,xavier2k6,2022-05-21T12:43:13Z,"@now-im 

>After the WebUI issue above gets resolved....

haven't had time to look in to this fully still but wouldn't consider it a blocker either......this can be sorted by someone who is more familiar with `WebUI` or whoever has the time at a later stage.

>only 2x file changes required

* Revert `qbittorrent-tray.svg` to same size (1024x1024) as `master`.
* Change `dialog-warning.svg` to use below image:
![image](https://user-images.githubusercontent.com/42386382/169653968-827588fd-1492-4582-a01d-fc64d3f5fc13.png)

>screenshots to be added & job done.

This is all that's basically left to do as far as I'm concerned outside of others instructions/review comments etc."
1133892372,15769,Mazino-Urek,2022-05-22T13:05:57Z,"@xavier2k6 Done.


> screenshots to be added & job done.

My Linux compilation is hitting errors. Provide me some screenshots. I will add them in the description."
1133914630,15769,xavier2k6,2022-05-22T15:01:12Z,"@now-im I meant to ask as well why some icons like `dialog-warning`, `error` & a few others have their `viewbox values` omitted?

ie `viewBox=""0 0 32 32""`"
1133931929,15769,Mazino-Urek,2022-05-22T16:39:04Z,@xavier2k6 Don't know. Added it manually in 14 icons now.
1134001959,15769,xavier2k6,2022-05-22T22:27:59Z,"@now-im `filterstalled` is slightly different thickness to other filters & IMO this thickness looks better in GUI....

would suggest to change the thickness on all for consistency.

![filter size](https://user-images.githubusercontent.com/42386382/169718411-52327896-ae31-4497-bc8b-da9f5d2d3dca.png)

I noticed this when viewing them in explorer as extra large icons....there's also a few icons that still don't fully have round edges.
"
1134631925,15769,Mazino-Urek,2022-05-23T12:46:14Z,"@xavier2k6 

> would suggest to change the thickness on all for consistency.

Fixed. 

> there's also a few icons that still don't fully have round edges.

Isn't this extreme nitpicking that no one will ever notice, as the icons are very small? 


"
1134777410,15769,xavier2k6,2022-05-23T14:51:55Z,">Isn't this extreme nitpicking that no one will ever notice, as the icons are very small?

I only mentioned it for clarity as others had mentioned/had issues previously......personally, I don't insist on any changes as I'd agree.......it is trivial but others may insist.

Thanks for the fixup.....will try & provide screenshots asap."
1140180346,15769,Chocobo1,2022-05-28T05:48:31Z,"All icons looks acceptable except one:
Can this icon (especially the sphere part) be updated to be more round? ![src/icons/webui.svg](https://raw.githubusercontent.com/qbittorrent/qBittorrent/af3b65eb736d689e59a7971bbecb4e44f2ff25cc/src/icons/webui.svg)
Currently it looks like it is squished from left and right.
"
1140189844,15769,Mazino-Urek,2022-05-28T06:59:44Z,@Chocobo1 All done. Checkout.
1140266162,15769,Mazino-Urek,2022-05-28T13:32:39Z,@Chocobo1 Done.
1140292888,15769,xavier2k6,2022-05-28T16:27:14Z,"This is what the `transferlist` text looks like (It matches the torrent states/icons)
____

[Torrents by State - Light](https://user-images.githubusercontent.com/42386382/170834044-c9f4a34d-cfab-4f5d-be70-e86231745a22.png)
____

[Torrents by State - Dark](https://user-images.githubusercontent.com/42386382/170834048-a580618d-bad7-48b6-b1b6-5f7a590ab823.png)

"
1140296650,15769,Mazino-Urek,2022-05-28T16:54:54Z,@xavier2k6 Screenshot added.
1140299786,15769,xavier2k6,2022-05-28T17:14:32Z,">Screenshot added.

OP updated."
1140300537,15769,Mazino-Urek,2022-05-28T17:19:51Z,OK.
1140324556,15769,thalieht,2022-05-28T20:20:32Z,"- ~~Color for ""Completed"" is unreadable in dark theme. Downloading is not very comfortable either but it's readable, i guess that's to be expected when you use the same colors for dark and light.~~ Ignore, bad monitor. I shouldn't comment on colors.
- The ""speedometer"" icon doesn't look like a speedometer to me, at least not at this size. Not to mention the thin green line which doesn't contrast well in dark theme.
![Screenshot 2022-05-28 231631](https://user-images.githubusercontent.com/6451685/170841528-761f405b-a7d0-4d74-8777-6f91b5cfae2b.png)
- The WebUI ""collapse"" icon still shows the top left part of the image if anyone cares."
1140328943,15769,xavier2k6,2022-05-28T20:59:57Z,">Color for ""Completed"" is unreadable in dark theme.

Will take a look at other alternatives but to me in dark mode it looks bright enough & is readable.....maybe monitor brightness settings?!

>The ""speedometer"" icon doesn't look like a speedometer to me, at least not at this size.
>Not to mention the thin green line which doesn't contrast well in dark theme.

Colour can be changed & icon can be thickened if we don't agree on an alternative source.

The speedometer was changed as another member didn't like the previous offering...(1st image set)

![1st offering](https://user-images.githubusercontent.com/42386382/170842468-f92a63f0-a241-40a5-a7c0-437f7561c118.png)

The sources for icons have limited options for speedometer.......

How about below?:

![2nd offering](https://user-images.githubusercontent.com/42386382/170842566-25357ecc-e681-4a26-9e77-1b20f49591b4.png)

>The WebUI ""collapse"" icon still shows the top left part of the image if anyone cares.

![webui collapse panel](https://user-images.githubusercontent.com/42386382/170842663-ea579d71-c03a-49c9-8c83-880681d49985.png)
![webui expand panel](https://user-images.githubusercontent.com/42386382/170842665-e14dbc2b-771e-4a59-8bcb-175644294313.png)

I didn't get around to try fixing that.....was hoping for someone with more experience in the meantime to have chimed in."
1140331176,15769,ArcticGems,2022-05-28T21:21:59Z,"> 
> ![1st offering](https://user-images.githubusercontent.com/42386382/170842468-f92a63f0-a241-40a5-a7c0-437f7561c118.png)

Maybe go back to these, they do look better as small icons.

> 
> ![2nd offering](https://user-images.githubusercontent.com/42386382/170842566-25357ecc-e681-4a26-9e77-1b20f49591b4.png)

I don't like these 👎  Also,  aren't they almost the same for office-chart-line.svg (Speed graph?).

.
> > Color for ""Completed"" is unreadable in dark theme.
> 
> Will take a look at other alternatives but to me in dark mode it looks bright enough & is readable.....maybe monitor brightness settings?!

It looks good to me too."
1140335298,15769,xavier2k6,2022-05-28T22:02:45Z,">Maybe go back to these, they do look better as small icons.

I thought they looked fine too, just needed a bit of thickening on the arc......we changed but didn't get any real feedback until now.

This was the reason for the change:
>The speedometer icons everywhere looks like trash.

https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1067979211

>I don't like these 👎 Also, aren't they almost the same for office-chart-line.svg (Speed graph?).

Similar yes - they represent the 2 speeds (uploading/downloading)

> > Color for ""Completed"" is unreadable in dark theme.
> 
> Will take a look at other alternatives but to me in dark mode it looks bright enough & is readable.....maybe monitor brightness settings?!
>
>It looks good to me too.

👍 , will wait for others opinions too before any changes."
1140368287,15769,thalieht,2022-05-29T03:12:16Z,">> Color for ""Completed"" is unreadable in dark theme.
>
>    Will take a look at other alternatives but to me in dark mode it looks bright enough & is readable.....maybe monitor brightness settings?!
>
>    It looks good to me too.

TN monitor :) or maybe some misconfiguration... looks ok in another one.

>I don't like these 👎

Me neither. I wasn't a fan of the previous speedometer but it was better than the current one IMO.
"
1140379674,15769,ArcticGems,2022-05-29T05:19:12Z,"> 
> ![1st offering](https://user-images.githubusercontent.com/42386382/170842468-f92a63f0-a241-40a5-a7c0-437f7561c118.png)
> 

Could also have a icon with a solid blue circle with a large red and green pointer.

Or maybe something similar to these like these? (maybe bigger/thicker pointers and remove the dot in the first one) =
![tools-and-utensils](https://user-images.githubusercontent.com/55046301/170853359-21bc0eb6-6be3-4dff-ba1b-0a69c4447714.png)
![speedometer](https://user-images.githubusercontent.com/55046301/170853362-0025edfe-5d86-4655-9709-0ca5ac1e92bc.png)
Hmm, but these two might look odd when used for slow (pointer points to the left),
maybe the speedometer on the top of my post really is the best."
1140443399,15769,Mazino-Urek,2022-05-29T12:53:05Z,"Whatever looks large doesn't always look good in small, and there will not always be the perfect icon for everything.
![image](https://user-images.githubusercontent.com/42386382/170842468-f92a63f0-a241-40a5-a7c0-437f7561c118.png)
IMO, these works. Rest is up to you. I will look into everyone's discussion and change one final time."
1140443716,15769,xavier2k6,2022-05-29T12:55:09Z,"Another option to signify `rate limits`:
![rate limts](https://user-images.githubusercontent.com/42386382/170869632-1a63e1a2-628a-41ca-8544-15b17629401f.png)

(the arrow colors could be changed to same as downloading/seeding & stalledup/down respectively......hope I explained that clear enough)

Edit: Example pic added.

![speed limits](https://user-images.githubusercontent.com/42386382/170892506-f5d151ad-1262-469a-976c-8ca1b45aca95.png)"
1140445512,15769,ArcticGems,2022-05-29T13:06:28Z,"> Another option to signify `rate limits`: ![rate limts](https://user-images.githubusercontent.com/42386382/170869632-1a63e1a2-628a-41ca-8544-15b17629401f.png)
> 
> (the arrow colors could be changed to same as downloading/seeding & stalledup/down respectively......hope I explained that clear enough)

Not bad, but is better suited for download/upload direction then speed.

If we follow your idea a bit, how does these look completely red(point left) or green(point right)? =
![image](https://user-images.githubusercontent.com/42386382/170842468-f92a63f0-a241-40a5-a7c0-437f7561c118.png) "
1140446555,15769,xavier2k6,2022-05-29T13:12:10Z,">Not bad, but is better suited for download/upload direction then speed.

As I said it's more of an indicator of `rate limits` (green - for go full throttle lol........red - for hey!, slow down) on download/upload actions.....

>If we follow your idea a bit, how does these look completely red(point left) or green(point right)? =

I'm not sure I understand what you mean?"
1140449262,15769,ArcticGems,2022-05-29T13:26:18Z,"
> > If we follow your idea a bit, how does these look completely red(point left) or green(point right)? =
> 
> I'm not sure I understand what you mean?

Very quick edit (so a bit ugly), but you get the idea =
![437f7561c118](https://user-images.githubusercontent.com/55046301/170871187-3563c6d4-0ad6-4252-9b2f-fd6aef4f26e9.png)


"
1140465982,15769,xavier2k6,2022-05-29T14:56:09Z,"@ArcticGems possible options....waiting on others comments/feedback.

example image added to https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1140443716"
1140662228,15769,ArcticGems,2022-05-30T03:50:18Z,"> @ArcticGems possible options....waiting on others comments/feedback.
> 
> example image added to [#15769 (comment)](https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1140443716)

The red/green ones are better. In your second example you can't see as clearly the differences when they are small icons.

Still... I prefer speedometer over these, let us see what others say."
1140841111,15769,Mazino-Urek,2022-05-30T08:11:08Z,@Chocobo1 what do you think about these icons
1141659466,15769,Chocobo1,2022-05-31T04:37:15Z,">@Chocobo1 what do you think about these icons

I don't have strong preferences here.

>![Screenshot 2022-05-28 231631](https://user-images.githubusercontent.com/6451685/170841528-761f405b-a7d0-4d74-8777-6f91b5cfae2b.png)

IMO the only thing that matters is that, the pointer direction of the speed icon should stand out and be easily observable. I would pick any one that satisfy this criteria."
1141675604,15769,ArcticGems,2022-05-31T05:15:34Z,"> > @Chocobo1 what do you think about these icons
> 
> I don't have strong preferences here.
> 
> > ![Screenshot 2022-05-28 231631](https://user-images.githubusercontent.com/6451685/170841528-761f405b-a7d0-4d74-8777-6f91b5cfae2b.png)
> 
> IMO the only thing that matters is that, the pointer direction of the speed icon should stand out and be easily observable. I would pick any one that satisfy this criteria.

So these achieve those criterias. The pointer direction stands out and 
is easily observable as a small icon=
![image](https://user-images.githubusercontent.com/42386382/170842468-f92a63f0-a241-40a5-a7c0-437f7561c118.png) 

@xavier2k6 @now-im  What do you guys think, you still want to look for others??"
1141756139,15769,Mazino-Urek,2022-05-31T07:18:22Z,"> is easily observable as a small icon=
> ![image](https://user-images.githubusercontent.com/42386382/170842468-f92a63f0-a241-40a5-a7c0-437f7561c118.png)

My vote is on this one. I think two color contrasts and pointy icon works better."
1141796594,15769,xavier2k6,2022-05-31T08:02:20Z,">My vote is on this one. I think two color contrasts and pointy icon works better.

👍 

I had no real issue 1st day either, we changed them to appease 1 person but they haven't given any feedback since......

Only suggestion would be like I said before is to make the blue arcs width a little thicker - leave pointers alone.
Keep blue/red colors same as they are now `#1e90ff` / `#ff0000`
Maybe use `#32cd32` for green?!"
1141801675,15769,xavier2k6,2022-05-31T08:07:31Z,">The WebUI ""collapse"" icon still shows the top left part of the image if anyone cares.

This can be rectified in a follow up PR as I'm not going to get time to fiddle around with this currently & I don't want to hold this PR up any longer than it should."
1141833139,15769,Mazino-Urek,2022-05-31T08:28:34Z,"@xavier2k6 Will make necessary changes tonight.

Have a look at the merge conflicts. Seems a bit extreme."
1142126079,15769,Mazino-Urek,2022-05-31T13:18:42Z,"Done.
![image](https://user-images.githubusercontent.com/22009014/171182713-0505a897-3ce1-48a5-8019-5e786541b7c7.png)
"
1142133153,15769,thalieht,2022-05-31T13:24:47Z,">Have a look at the merge conflicts. Seems a bit extreme.

Keep all changes from master but:
torrentcontentmodel: Just re-replace `text-plain` with `help-about` in its new location in the file.
transferlistmodel: 
- Replace the contents of `getDefaultColorByState` in it's new location with your changes, for your convenience (careful about the indendation, it may be copied wrong):
```
        switch (state)
        {
        case BitTorrent::TorrentState::Downloading:
        case BitTorrent::TorrentState::ForcedDownloading:
        case BitTorrent::TorrentState::DownloadingMetadata:
        case BitTorrent::TorrentState::ForcedDownloadingMetadata:
            return QColorConstants::Svg::green;
        case BitTorrent::TorrentState::StalledDownloading:
            return QColorConstants::Svg::mediumseagreen;
        case BitTorrent::TorrentState::StalledUploading:
            return QColorConstants::Svg::cornflowerblue;
        case BitTorrent::TorrentState::Uploading:
        case BitTorrent::TorrentState::ForcedUploading:
            return QColorConstants::Svg::royalblue;
        case BitTorrent::TorrentState::PausedDownloading:
            return QColorConstants::Svg::grey;
        case BitTorrent::TorrentState::PausedUploading:
            return QColorConstants::Svg::darkslateblue;
        case BitTorrent::TorrentState::QueuedDownloading:
        case BitTorrent::TorrentState::QueuedUploading:
            return QColorConstants::Svg::peru;
        case BitTorrent::TorrentState::CheckingDownloading:
        case BitTorrent::TorrentState::CheckingUploading:
        case BitTorrent::TorrentState::CheckingResumeData:
        case BitTorrent::TorrentState::Moving:
            return QColorConstants::Svg::teal;
        case BitTorrent::TorrentState::Error:
        case BitTorrent::TorrentState::MissingFiles:
        case BitTorrent::TorrentState::Unknown:
            return QColorConstants::Svg::red;
        default:
            Q_ASSERT(false);
            return QColorConstants::Svg::red;
        }
```
- Re-delete `isDarkTheme()`
- And finally 
```
TransferListModel::TransferListModel(QObject *parent)
           {BitTorrent::TorrentState::Error, tr(""Errored"", ""Torrent status, the torrent has an error"")}
     }
     , m_stateThemeColors {torrentStateColorsFromUITheme()}
-    , m_checkingIcon {UIThemeManager::instance()->getIcon(u""checking""_qs)}
-    , m_completedIcon {UIThemeManager::instance()->getIcon(u""completed""_qs)}
+    , m_checkingIcon {UIThemeManager::instance()->getIcon(u""force-recheck""_qs)}
+    , m_completedIcon {UIThemeManager::instance()->getIcon(u""checked-completed""_qs)}
     , m_downloadingIcon {UIThemeManager::instance()->getIcon(u""downloading""_qs)}
     , m_errorIcon {UIThemeManager::instance()->getIcon(u""error""_qs)}
-    , m_pausedIcon {UIThemeManager::instance()->getIcon(u""paused""_qs)}
+    , m_pausedIcon {UIThemeManager::instance()->getIcon(u""media-playback-pause""_qs)}
     , m_queuedIcon {UIThemeManager::instance()->getIcon(u""queued""_qs)}
     , m_stalledDLIcon {UIThemeManager::instance()->getIcon(u""stalledDL""_qs)}
     , m_stalledUPIcon {UIThemeManager::instance()->getIcon(u""stalledUP""_qs)}
-    , m_uploadingIcon {UIThemeManager::instance()->getIcon(u""uploading""_qs)}
+    , m_uploadingIcon {UIThemeManager::instance()->getIcon(u""kt-set-max-upload-speed""_qs)}
 {
     configure();
     connect(Preferences::instance(), &Preferences::changed, this, &TransferListModel::configure);

```
"
1142133896,15769,xavier2k6,2022-05-31T13:25:22Z,"@now-im `slow` needs to be flipped horizontally so pointer goes in opposite direction of `slow_off`

like below:
> ![image](https://user-images.githubusercontent.com/42386382/170842468-f92a63f0-a241-40a5-a7c0-437f7561c118.png)"
1142172753,15769,Mazino-Urek,2022-05-31T13:58:09Z,"@xavier2k6 

> like below:
> 
> > ![image](https://user-images.githubusercontent.com/42386382/170842468-f92a63f0-a241-40a5-a7c0-437f7561c118.png)

Done.

Check my changes on merge conflict. Also, thaliet has raised one issue above, have a look."
1142183558,15769,xavier2k6,2022-05-31T14:06:24Z,">Check my changes on merge conflict. Also, thaliet has raised one issue above, have a look.

quick glance...will need fix up - will advise later, ok."
1142202502,15769,xavier2k6,2022-05-31T14:21:35Z,"@thalieht Does the 3x iterations of `m_textPlainIcon` in `torrentcontentmodel.cpp` need changing too or are they to remain as-is?

https://github.com/qbittorrent/qBittorrent/blob/ab0c82965cdb1143c97b1e3a0ed64cc72874f3f9/src/gui/torrentcontentmodel.cpp#L73-L85"
1142206803,15769,thalieht,2022-05-31T14:25:03Z,">@thalieht Does the 3x iterations of m_textPlainIcon in torrentcontentmodel.cpp need changing too or are they to remain as-is?

No need."
1142221774,15769,xavier2k6,2022-05-31T14:36:58Z,"@now-im Use my `transferlistmodel.cpp` from https://github.com/xavier2k6/qBittorrent/blob/GUI_Overhaul/src/gui/transferlistmodel.cpp

This should address everything 🤞 "
1142308465,15769,xavier2k6,2022-05-31T15:47:58Z,"> @now-im Use my `transferlistmodel.cpp` from https://github.com/xavier2k6/qBittorrent/blob/GUI_Overhaul/src/gui/transferlistmodel.cpp
> 
> This should address everything 🤞

I knew I'd jinx myself. 🙄 

small typo `media-playbackpause` -> `media-playback-pause`"
1142339328,15769,xavier2k6,2022-05-31T16:16:03Z,Preview screenshot in OP updated with included `updated original speed icon set`
1142345369,15769,Mazino-Urek,2022-05-31T16:21:44Z,"@xavier2k6 Thanks.
Kindly have a look at the review @thaliet has left above about one icon causing a crash."
1142390825,15769,xavier2k6,2022-05-31T17:02:17Z,"> @xavier2k6 Thanks. Kindly have a look at the review @ThalieT has left above about one icon causing a crash.

See https://github.com/qbittorrent/qBittorrent/pull/15769#discussion_r885888279"
1142533057,15769,Mazino-Urek,2022-05-31T18:57:28Z,@xavier2k6 Maybe it is finally done now?
1143500694,15769,xavier2k6,2022-06-01T11:45:36Z,"> @xavier2k6 Maybe it is finally done now?

Please address comments of 'Qt' & 'empty line' & Yes, I would consider this done, barring:

* Any additional review comments/suggestions/screenshot requests etc.
* WebUI 'expand/collapse' icon issue (Can be resolved at later stage)"
1143594031,15769,Mazino-Urek,2022-06-01T13:11:21Z,"> Please address comments of 'Qt' & 'empty line' & Yes, I would consider this done, barring

Done."
1145363085,15769,xavier2k6,2022-06-02T21:32:42Z,@PriitUring Thanks for the new screenshot/OP Updated with it now.
1145417444,15769,Pentaphon,2022-06-02T22:52:35Z,@now-im I made this issue https://github.com/qbittorrent/qBittorrent/issues/17150  that should be addressed so that Linux users get to see your new custom icons by default instead of seeing whatever old icons came with their distro. It would be sad if all this hard work didn't show up on new installs just because of this checkbox when you are offering these custom icons to work with light and dark modes. 
1145555096,15769,Mazino-Urek,2022-06-03T03:44:52Z,"@PriitUring Thanks!

@Pentaphon After this PR gets merged, I was hoping to create a PR just to do that."
1145800690,15769,Mazino-Urek,2022-06-03T09:57:28Z,"@xavier2k6 @Chocobo1 @thalieht PR is done with all the changes made. 
Kindly consider merge."
1145861311,15769,ghost,2022-06-03T11:17:19Z,"<s>`Stalled` and `All`filter icons are not good.

Edit: Sorry I mean `Active filter` icon.</s> "
1145867583,15769,ArcticGems,2022-06-03T11:26:05Z,"> `Stalled` and `All` filter icons are not good.
> 
> Edit: Sorry I mean `Active filter` icon.

Can you explain more? Why aren't these good?"
1145886180,15769,xavier2k6,2022-06-03T11:53:15Z,"@summerqB Do you mean the colors, what do you think of below? (if that is the issue)

![new filter colors](https://user-images.githubusercontent.com/42386382/171847942-c6f9cf96-d699-45a9-9906-a3b1a82d87ae.png)
"
1145894578,15769,ghost,2022-06-03T12:04:46Z,"Sorry for mixing things up in last comment. Please disregard it.

What I actually wanted to mean : 
The `All` filter color does not look good when it's selected. It becomes kinda brownish ash and looks dead!
And the `Stalled` filter is hurting the eye on white theme when it's not selected."
1145900207,15769,Mazino-Urek,2022-06-03T12:12:16Z,@summerqB Further improvements can be made upon in future PRs. This one has been cooking for 5 years. Let's not nitpick for now.
1145916447,15769,ghost,2022-06-03T12:32:32Z,"> @summerqB Further improvements can be made upon in future PRs. This one has been cooking for 5 years. Let's not nitpick for now.

What if you're ded and nobody updates them lateron ;)"
1145919045,15769,glassez,2022-06-03T12:35:54Z,"> Linux users get to see your new custom icons by default instead of seeing whatever old icons came with their distro.

The problem with this is much broader (if I'm not mistaken, of course), and I mentioned this a long time ago, but my alertness was apparently not taken seriously.
Initially, the names of (most) icons were chosen in such a way as to match the (commonly used) names from the Linux system themes. So you probably killed ""Use system icon theme"" feature by renaming all these icons. You have undoubtedly improved the built-in theme and enriched it with new icons where the same ones were used before. But nevertheless, I interpret this problem as blocking for this PR until it is solved in one of the following ways: 
1. Completely remove ""Use system icon theme"" feature, 
2. Modify this PR so that ""Use system icon theme"" feature continues to work properly (i.e. it would use as many system icons as possible).

@Chocobo1, what do you think?"
1145922042,15769,Mazino-Urek,2022-06-03T12:39:40Z,"> > @summerqB Further improvements can be made upon in future PRs. This one has been cooking for 5 years. Let's not nitpick for now.
> 
> What if you're ded and nobody updates them lateron ;)

I am sure @xavier2k6 will carry this torch on my behalf."
1146006229,15769,Mazino-Urek,2022-06-03T14:12:36Z,"Again, @glassez these are the [guidelines](https://specifications.freedesktop.org/icon-naming-spec/icon-naming-spec-latest.html) for icon naming on Linux. A couple of points,
1. Not all Linux DE follow this guideline strictly. As per my understanding, KDE and its derivatives are a bit different. Besides, this guideline is from 2005,
2. Old qBittorrent icons are not well names according to this guide. The action didn't reflect the icons in some cases, and this guideline simply doesn't have icon names for `tracker, hash, donation` etc. I agree that most common actions were covered, but we tried to maintain compatibility as well,
3. qBittorrent is not a system application, it is not a simple application also. It can be compared with the like of VS code, RStudio, DBeaver, and none of them cares about system icon compatibility. This can't do that too.

My proposal is, go ahead with this. Linux world top icon theme maintainers, will adopt qBittorrent icon naming in their theme pack. Almost, none of us Linux users use our default icon themes. It won't impact us that much.

Rest is up to you guys."
1146143098,15769,glassez,2022-06-03T16:14:00Z,"> Linux world top icon theme maintainers, will adopt qBittorrent icon naming in their theme pack.

Sorry, I'm not familiar with how it works in the Linux world...
Are you saying that applications just use the icon names that they like (e.g., correspond to their purpose), and the icon theme maintainers provide (or do not provide) their own icons for all possible applications that they want to take care of? To be honest, I thought that everything was different - there is some standard set of icons, and applications just use the appropriate ones.

I'm just looking forward to a bunch of Issues like ""I turn on `Use system icon theme`, but it doesn't affect"".
But if everything really is as you said above, and icon theme maintainers should take care of it, then of course this should not become a problem and we can go further.

Anyway, I'd like to know @Chocobo1's opinion."
1146180090,15769,Mazino-Urek,2022-06-03T16:59:40Z,"> Sorry, I'm not familiar with how it works in the Linux world...
> Are you saying that applications just use the icon names that they like (e.g., correspond to their purpose), and the icon theme maintainers provide (or do not provide) their own icons for all possible applications that they want to take care of? To be honest, I thought that everything was different - there is some standard set of icons, and applications just use the appropriate ones.

They actually use system link to just use one icon to be used multiple of times. Here is a reference [project](https://github.com/PapirusDevelopmentTeam/papirus-icon-theme)."
1146187512,15769,glassez,2022-06-03T17:09:13Z,"> They actually use system link to just use one icon to be used multiple of times. Here is a reference [project](https://github.com/PapirusDevelopmentTeam/papirus-icon-theme).

The main thing is not how they care about providing icons for various applications, but that they are responsible for doing it or not. If they are really responsible for maintaining compatibility with various applications, then OK."
1146188385,15769,glassez,2022-06-03T17:10:25Z,"@now-im 
Personally I would really like to see your icons in v4.5."
1146237873,15769,Pentaphon,2022-06-03T18:16:41Z,"> 1. Completely remove ""Use system icon theme"" feature,

I think the dev team should just do this because:

a) the system icon themes that come with a distro are usually really old,  not very good looking,  not customized for qBittorrent and are usually not replacing all of qBittorrent's icons.
b) the custom icon themes people install are better looking and newer, but obviously not customized for qBittorrent, and are usually not replacing all of qBittorrent's icons.
c) you're putting in a lot of work to have icons that are handcrafted for qBittorrent by a community and to just have this option to hide them by default in favor of a distro's icons seems like a huge waste of effort. 
d) we should drop the ""use system icon theme"" checkbox in favor of only supporting the ""use theme file"" option so that if people don't like these new icons 4.5 ships with, they can work together as a community to create .qbtheme files that they prefer and just use that from now on the same way uTorrent used to do and that's that. 

So yeah, I'm all for removing the ""use system icon"" feature. It's just holding back the look of qBittorrent, IMHO. 
 "
1146527109,15769,ghost,2022-06-04T04:21:39Z,I think someone can remove that system icons feature for linux on another PR as this supersedes linux system icons. However it should not be considered a blocker.
1146540390,15769,Chocobo1,2022-06-04T05:27:23Z,"After trying this PR on linux, I consider the ""Use system icon theme"" is not so effective now. It is still usable but the result is not so great. It should be removed in the long run. 
For now, ""Use system icon theme"" should be defaulted to off (either in this PR or a separate PR) and later remove it entirely (since this job seems non-trivial)."
1146540907,15769,glassez,2022-06-04T05:31:09Z,"> After trying this PR on linux, I consider the ""Use system icon theme"" is not so effective now. It is still usable but the result is not so great. It should be removed in the long run. For now, ""Use system icon theme"" should be defaulted to off (either in this PR or a separate PR) and later remove it entirely (since this job seems non-trivial).

So let's merge it if there are no blocking nitpicking."
1146571772,15769,xavier2k6,2022-06-04T08:59:07Z,">I am sure @xavier2k6 will carry this torch on my behalf.

Exactly or others are free to offer changes in their own PR...if people aren't really happy with certain colors or icons, they can be easily changed now/any time or when these icons are included in a official public release & more extensive feedback is received.

For e.g. the `filter icons` could be changed to something like below:
![new filter icon set](https://user-images.githubusercontent.com/42386382/171998573-9a141f1f-86c3-44c7-bae4-9ec607f86aa6.png)
____

![new filter icons](https://user-images.githubusercontent.com/42386382/171992287-0be181e4-ea50-49a8-a9c2-284f86323645.png)"
1146579756,15769,Pentaphon,2022-06-04T09:48:52Z,"> and later remove it entirely (since this job seems non-trivial).

If we're going to remove it in the long run, which is a good idea, why not just remove it in 4.5 to coincide with the new icons in that release?

I'm sure @now-im would be able to create such a PR and get it done."
1146580220,15769,glassez,2022-06-04T09:53:00Z,"> > and later remove it entirely (since this job seems non-trivial).
> 
> If we're going to remove it in the long run, which is a good idea, why not just remove it in 4.5 to coincide with the new icons in that release?

It should be noted that if it is not deleted before v4.5 release, it will remain throughout the entire life cycle of v4.5.x branch."
1146581355,15769,glassez,2022-06-04T10:02:03Z,">Redesigned GUI with optimization

IMO, it's too vague/confusing a name for this commit. It should be something more concrete, e.g. ""Implement new icon/color theme""."
1146583445,15769,xavier2k6,2022-06-04T10:18:16Z,">It should be noted that if it is not deleted before v4.5 release, it will remain throughout the entire life cycle of v4.5.x branch.

Does it have to be done in another PR or could it be done here (in another commit)?

I'm not sure myself where all these changes/deletions would be required so would depend on others expertise in this area."
1146586794,15769,glassez,2022-06-04T10:47:22Z,"> Does it have to be done in another PR or could it be done here (in another commit)?

I would prefer separate PR."
1146598710,15769,xavier2k6,2022-06-04T12:18:52Z,">I would prefer separate PR.

@now-im Are you up-to/capable of doing this asap?"
1146617547,15769,Mazino-Urek,2022-06-04T13:57:56Z,"> For e.g. the `filter icons` could be changed to something like below:

Look at the colors, I have pushed new icons.



> Are you up-to/capable of doing this asap?

What to do?"
1146629585,15769,xavier2k6,2022-06-04T15:02:32Z,"`filter-active` `#1e90ff` -> `#4169e1`
`filter-stalled` (flip it) & use `#6495ed`/`#3cb371`

JUST NOTICED!!, since the execution log used the same icon as `filter-inactive` - we've now changed that from a `funnel` image to `up/down arrows` so we need to create an icon for it.

Would suggest changing icon to below:
![ban_block](https://user-images.githubusercontent.com/42386382/172008974-63b8377f-9ac7-474c-a17f-6b14b677d7c2.png)
Using `#ff0000`

`/src/gui/executionlogwidget.cpp`

Change `filter-inactive` to perhaps `IP-blocked` (I have no real preference on what it's to be called, add name to `icons.qrc` too)
`m_ui->tabConsole->setTabIcon(1, UIThemeManager::instance()->getIcon(u""filter-inactive""_qs));`"
1146645120,15769,Mazino-Urek,2022-06-04T16:27:54Z,@xavier2k6 All done.
1146674411,15769,xavier2k6,2022-06-04T19:35:59Z,">All done.

👍 

@PriitUring Could you provide crisp screenshot of icons to update original post with please?"
1146751400,15769,Mazino-Urek,2022-06-05T06:38:50Z,"@xavier2k6 We have two same icons with same color. `application-exit` and `task-reject`, one can be easily removed.
Which one?"
1146767041,15769,glassez,2022-06-05T08:50:23Z,"> @xavier2k6 We have two same icons with same color. `application-exit` and `task-reject`, one can be easily removed. Which one?

If they are used for different Actions/Controls, it is better to leave both so that the creators of custom themes can use different icons.
To make it more scalable, it is better to associate icon names with the Actions/Controls for which they are intended, and not with a specific icons we are using at the moment."
1146777438,15769,Mazino-Urek,2022-06-05T10:08:57Z,"> If they are used for different Actions/Controls, it is better to leave both so that the creators of custom themes can use different icons. To make it more scalable, it is better to associate icon names with the Actions/Controls for which they are intended, and not with a specific icons we are using at the moment.

They are actually doing the same thing, and thus have exactly the same icon with the same bold red color. You will find many new icons added that have only one use cases, but added as no other existing icons could represent them, i.e., `hash`, `tracker`. `application-exit` just has two use cases, and can easily be replaced with `task-reject`.

"
1146780916,15769,xavier2k6,2022-06-05T10:35:30Z,"> > @xavier2k6 We have two same icons with same color. `application-exit` and `task-reject`, one can be easily removed. Which one?
> 
> If they are used for different Actions/Controls, it is better to leave both so that the creators of custom themes can use different icons. To make it more scalable, it is better to associate icon names with the Actions/Controls for which they are intended, and not with a specific icons we are using at the moment.

~I'd leave `task-reject` as-is, the only 2 icons that have similar actions but are represented by 2 different icons are `application-exit` & `system-log-out`.~

~So perhaps we can get rid of `system-log-out` if necessary & use below icon image?~
![exit v1](https://user-images.githubusercontent.com/42386382/172046369-7ad32abb-2ecc-4993-b09c-0baac5315b12.png)

~If we got rid of `system-log-out` & replace it with `application-exit` we'd only have to modify 1 place in `src/webui/www/private/index.html` & delete it from `icons.qrc` too.~

~@glassez Thoughts?~

IGNORE!!"
1146895586,15769,xavier2k6,2022-06-05T22:35:25Z,"`application-exit` could be changed to this:

The `application-exit` being used here would look similar to `master`

![exit v5](https://user-images.githubusercontent.com/42386382/172073956-716840a2-6989-4867-8ef1-4cda66cdb2af.png)![exit v3](https://user-images.githubusercontent.com/42386382/172073312-2ee8d0d0-181b-48fa-ab79-ab506d22ca13.png)![exit og](https://user-images.githubusercontent.com/42386382/172074285-c959d8a2-b5e3-47e1-bc86-9cc6287aa49e.png)

____

`system-log-out` could be changed to:

![system-log-out](https://user-images.githubusercontent.com/42386382/172073943-cd7f6214-d0a6-4153-b470-b7ec281b10f8.png)
"
1147511795,15769,Mazino-Urek,2022-06-06T14:28:27Z,"@xavier2k6 I think, this is a bit more stylish.
![image](https://user-images.githubusercontent.com/22009014/172181249-4253b1fc-abcb-4148-9d33-00ecf461f62c.png)


> `system-log-out` could be changed to:

I think the existing icon is quite good. I need not be changed."
1147534068,15769,ArcticGems,2022-06-06T14:49:24Z,"> @xavier2k6 I think, this is a bit more stylish. ![image](https://user-images.githubusercontent.com/22009014/172181249-4253b1fc-abcb-4148-9d33-00ecf461f62c.png)
> 
> > `system-log-out` could be changed to:
> 
> I think the existing icon is quite good. I need not be changed.

I agree 👍 "
1147619545,15769,xavier2k6,2022-06-06T16:06:35Z,">I think, this is a bit more stylish.

Maybe, but again it's bringing back the case of pointed corners/edges etc that previously other members had issues with."
1147642669,15769,ArcticGems,2022-06-06T16:29:01Z,"> > I think, this is a bit more stylish.
> 
> Maybe, but again it's bringing back the case of pointed corners/edges etc that previously other members had issues with.

Maybe you're right.

I have forgotten if we talked about using something 
like this (but red instead) for `application-exit` =
![power-off](https://user-images.githubusercontent.com/55046301/172203377-235a0cd7-8506-46d3-b7b1-d5d9c40c0e5d.png)
"
1147810393,15769,xavier2k6,2022-06-06T19:20:19Z,"@ArcticGems I don't think we mentioned using that or similar like below?

![exit v6](https://user-images.githubusercontent.com/42386382/172230902-9db5eee8-ceb1-4171-afe6-8b87ccb0e3c1.png)


Anyway, I don't want to dwell too long on this......just pick one & let others decide afterwards........so we can all move on to other things."
1147826738,15769,xavier2k6,2022-06-06T19:33:32Z,"@PriitUring

>seems filter-inactive icon you suggested to replace with IP-Blocked file was not deleted or did you wish to keep both

I intended to keep both as previously the `filter-inactive` icon was just a filter which represented the 2 actions purposes, then we changed the `filter-inactive` icon to red up/down arrows which to me (& maybe it was just me who had an issue with it) didn't represent that something was being blocked hence why we created a ne icon for that action in the `execution log`.

Thanks for the `powertoys` suggestion, I do have it on my machine but the reason I asked you for the screenshot was time constraints & wasn't at pc.

>how to force my qBittorrent on Windows 11 to be with dark background, so if anyone has tips

1. quickest way would be to open a `command prompt` (it doesn't have to be elevated ie admin)
2. navigate to where you have qbittorrent installed or where you are testing unpacked (this PR perhaps)
3. Type `qbittorrent -platform windows:darkmode=2` & hit enter

e.g.
![qBittorrent dark-mode](https://user-images.githubusercontent.com/42386382/172233684-a411d676-345f-4bdb-954d-8f33a723339d.png)

**NOTE:** The dark mode version is to be considered **experimental** as it has issues/limitations."
1147924339,15769,ArcticGems,2022-06-06T20:59:25Z,"> @ArcticGems I don't think we mentioned using that or similar like below?
> 
> ![exit v6](https://user-images.githubusercontent.com/42386382/172230902-9db5eee8-ceb1-4171-afe6-8b87ccb0e3c1.png)
> 
> Anyway, I don't want to dwell too long on this......just pick one & let others decide afterwards........so we can all move on to other things.

I prefer this one or the one I suggested (whichever looks better as small icon).

@now-im which one do you prefer, a 'X' or a 'Shutdown' symbol??"
1148202081,15769,Mazino-Urek,2022-06-07T05:07:31Z,"> which one do you prefer, a 'X' or a 'Shutdown' symbol??

I will go with the shutdown icon. It adds an original new icon to the pack, and can be used in the future. Will push changes later today."
1148827542,15769,Mazino-Urek,2022-06-07T15:29:07Z,"![image](https://user-images.githubusercontent.com/22009014/172420430-bb7c78d5-eb1e-48fd-8300-d03410cf9257.png)

Done."
1148963231,15769,Mazino-Urek,2022-06-07T17:26:58Z,"Updated screenshots.
Sorry to say, that is a yikes dark mode."
1148969926,15769,ArcticGems,2022-06-07T17:32:33Z,"> Updated screenshots. Sorry to say, that is a yikes dark mode.

/offtopic
Indeed, Win 10/11's contrast themes aren't pretty."
1149052431,15769,ghost,2022-06-07T19:00:46Z,Congratulations! This PR now has 500+ comments
1149084545,15769,xavier2k6,2022-06-07T19:35:51Z,"> Congratulations! This PR now has 500+ comments

Ya, the largest commented PR this project has had!! 🤣

OP updated with a lot more in-depth icon screenshots (light mode mainly) -> https://github.com/qbittorrent/qBittorrent/pull/15769#issue-1059416864"
1149089430,15769,xavier2k6,2022-06-07T19:41:15Z,"@now-im Done as much as I can now with the free time I've had, can't do no more."
1149443563,15769,Mazino-Urek,2022-06-08T04:22:53Z,"> Congratulations! This PR now has 500+ comments

If you consider 4 PRs I have made before on this(#8406, #12169, #12926, #12965), it has collectively 738 comments. First PR is from 2018.



> @now-im Done as much as I can now with the free time I've had, can't do no more.

Can't thank you enough for this. You have done a great job here. Your effort has done this redesign, a couple of times better."
1150688163,15769,Mazino-Urek,2022-06-09T05:32:38Z,"> Although the new exit icon is too small and thus details are kinda lost in that. I liked the simple cross better.

@summerqB Can you provide a screenshot from the app? Maybe I can do something about it.



"
1150914861,15769,xavier2k6,2022-06-09T09:51:28Z,">Can you provide a screenshot from the app?

Look at `file menu` screenshot in OP.

>details are kinda lost in that

The whiteness in the power symbol is too thin, is what I think they mean.

>I liked the simple cross better.

Personally, I did too.......

(There are other fixup's/changes needed to be done in separate PR's so this could be done there.....)
____

@Chocobo1 @glassez
As @thalieht has mentioned a few times, Do we still need sledge's approval?"
1150916917,15769,Mazino-Urek,2022-06-09T09:53:15Z,"> Look at `file menu` screenshot in OP.

I get it. Will change it to cross later today.

> (There are other fixup's/changes needed to be done in separate PR's so this could be done there.....)

Yes, please.
"
1150973378,15769,glassez,2022-06-09T10:54:03Z,"> There are other fixup's/changes needed to be done in separate PR's

I hope you don't mean that as soon as we merge this PR, it will be followed by an (endless) series of PRa like ""Slightly change Nth pixel of Mth icon"", etc."
1150975789,15769,xavier2k6,2022-06-09T10:56:53Z,">I hope you don't mean that as soon as we merge this PR, it will be followed by an (endless) series of PRa like ""Slightly change Nth pixel of Mth icon"", etc.

NO, I mean the `linux system icon theme` removal & the `WebUI - expand/collapse` icon issue that were discussed here."
1151019155,15769,Mazino-Urek,2022-06-09T11:44:40Z,"@xavier2k6 Changes made.
![image](https://user-images.githubusercontent.com/22009014/172838971-14138c10-6751-41f7-83db-1dce0323e6d9.png)

> I hope you don't mean that as soon as we merge this PR, it will be followed by an (endless) series of PRa like ""Slightly change Nth pixel of Mth icon"", etc.

@glassez I can assure you that won't happen. @xavier2k6 and I have painstakingly made sure of that.
"
1151300614,15769,glassez,2022-06-09T15:44:35Z,"> > I hope you don't mean that as soon as we merge this PR, it will be followed by an (endless) series of PRa like ""Slightly change Nth pixel of Mth icon"", etc.
> 
> NO, I mean the `linux system icon theme` removal & the `WebUI - expand/collapse` icon issue that were discussed here.

But I mean, that you guys have been saying for many times now - everything is ready, let's review and merge it. And immediately it is followed by a bunch of new comments and changes."
1151304706,15769,Mazino-Urek,2022-06-09T15:47:13Z,"@glassez It is done now. The problem was we took everyone's feedback seriously, we shouldn't have done that. Everyone can't be pleased. Tough lesson.
I will not make another commit, unless there is a merge conflict. How about that?"
1151327467,15769,xavier2k6,2022-06-09T16:06:07Z,">I will not make another commit, unless there is a merge conflict. How about that?

Don't touch this PR anymore! 🤣 

I've approved it, so those with merging rights can go ahead & merge unless we still need go ahead from sledge.

Apologies to all who may feel frustrated with the @ mentions & approval dismissals."
1151344726,15769,xavier2k6,2022-06-09T16:24:24Z,"@PriitUring Done!, thank you."
1151347488,15769,glassez,2022-06-09T16:27:14Z,"Another problem with all these icon renaming is the breaking the existing custom themes. (I don't remember if this was mentioned earlier, but in any case, it's worth making a final decision on this issue now.) Are there any real reasons to force breaking compatibility with existing custom themes? After all, saving it does not seem to be something difficult, since we still have a fallback mechanism that allows us to specify an alternative icon identifier in `UIThemeManager::getIcon()`, and we could simply specify the old identifier there."
1151367630,15769,Mazino-Urek,2022-06-09T16:50:17Z,"@glassez It was discussed before. @jagannatharjun said, he would modify his custom theme pack."
1151370008,15769,xavier2k6,2022-06-09T16:53:13Z,"Breaking theme compatibility was discussed previously in one of the many many many iterations of this PR.
Reference: https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-944920020"
1151995638,15769,jagannatharjun,2022-06-10T06:17:33Z,"> it's worth making a final decision on this issue now.) Are there any real reasons to force breaking compatibility with existing custom themes?

> It was discussed before. @jagannatharjun said, he would modify his custom theme pack.

It's not only me who has a theme. There are other authors too. and there is no way to automatically update the themes so everyone has to manually update them.  I would really like this to preserve backward compatibility unless it's really necessary to break

Is it really necessary to break it?"
1151999924,15769,jagannatharjun,2022-06-10T06:22:13Z,"
![image](https://user-images.githubusercontent.com/34717789/173003171-bc2164ec-6697-4c12-b754-d38780fa8dd1.png)

this looks odd

![image](https://user-images.githubusercontent.com/34717789/173003230-a867332a-c37c-4679-9848-e107860ad7f7.png)

this shade of gray doesn't really go well with your other colors"
1152003601,15769,Mazino-Urek,2022-06-10T06:25:47Z,"@jagannatharjun Yes, it is necessary. We have added new icons. If you see that checklist of work done here, you will get the idea how messed up previous icons were. 

1. There were loads of unused icons,
2. Icons were named badly for Linux compatibility purposes.

It is a complete redesign by today's standard. This will be usable for a long time. Theming is necessary because of current UI. It took us 2-3 years to create this, and we tried backward compatibility for a long time. If we didn't consider that from the beginning, it wouldn't have taken this long. I am hoping theme maintainers would humble us by taking a bit of trouble."
1152004181,15769,glassez,2022-06-10T06:26:21Z,"> Is it really necessary to break it?

Personally I see no valid reason since we can provide it via existing fallback mechanism.

Of course, it can be done in separate PR."
1152031473,15769,jagannatharjun,2022-06-10T06:51:49Z,"> Yes, it is necessary. We have added new icons. 
>  I am hoping theme maintainers would humble us by taking a bit of trouble.

The themes are being used by a lot of people. So it's not only theme maintainers who would get troubled. Do see if you can preserve backward compatibility."
1152061034,15769,ArcticGems,2022-06-10T07:31:00Z,"IMO it's ok to break things for custom themes, 
because major overhaul is very rarly done to qBit,
so it's not like it happens often.

Also, a program should not adapt according to custom themes,
custom themes should adapt to the program.

Jagannatharjun could update his themes, then other theme maintainers can follow his example or read updated wiki."
1152078532,15769,Pentaphon,2022-06-10T07:52:04Z,"> It's not only me who has a theme. There are other authors too. and there is no way to automatically update the themes so everyone has to manually update them. I would really like this to preserve backward compatibility unless it's really necessary to break

I can't think of a single program that has had to support older themes. It is always theme developers that have to keep up with the program, not the other way around. We can't go backwards just to support themes that most people don't use or even know about. We have to keep qBittorrent moving forward as a project and that includes new theming and new software to keep running on new OS's. Theme developers should keep up with the bigger project if they want their themes to work because the software can't stay the same forever. "
1152194970,15769,xavier2k6,2022-06-10T10:03:06Z,"> Breaking theme compatibility was discussed previously in one of the many many many iterations of this PR. Reference: [#15453 (comment)](https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-944920020)

It was discussed, the go-ahead was given as far as I'm concerned & has been delivered upon.

To me it seems now people are trying to move the goal posts so to speak.

>this looks odd

In what way??.......a bit more context please.

>this shade of gray doesn't really go well with your other colors

It can be lightened if really necessary (@now-im PLEASE!!! don't take me literally here & make changes/push any commits - there's **5** team members approval now)"
1152223868,15769,glassez,2022-06-10T10:36:58Z,"> It was discussed, the go-ahead was given as far as I'm concerned & has been delivered upon.
> 
> To me it seems now people are trying to move the goal posts so to speak.

IIRC, at that time, the question was whether to change identifiers OR maintain backward compatibility.
But all of you who are talking about some kind of ""step back"", apparently, do not understand (or do not want to understand) that there is a way to do it at the same time, which I mentioned several times above. You just need to replace the old calls `getIcon(""old-icon-id"")` not with `getIcon(""new-icon-id"")`, but with `getIcon(""new-icon-id"", ""old-icon-id"")`.
"
1152255155,15769,xavier2k6,2022-06-10T11:19:42Z,">But all of you who are talking about some kind of ""step back"", apparently, do not understand (or do not want to understand) that there is a way to do it at the same time

I do understand what you are saying/where you are coming from but this should have been made more clearer at the time or before more & more extensive work was put in after that.

There's been some push-back because of changes that have been made over & over & again when we've perceived it as finished because of received feedback.

What do you suggest we do for icons that have been created where there was no icon in place before?!

If theming support is really going to be an issue then should we postpone/block this PR from official builds until `5.x` & we can announce that pre-existing themes are not compatible?"
1152276338,15769,glassez,2022-06-10T11:48:45Z,"> What do you suggest we do for icons that have been created where there was no icon in place before?!

Just does nothing! I.e. don't provide any fallback. If some theme doesn't provide some icons then built-in icons are shown. This is less of a problem if the update just adds a couple of new icons to the interface than if most of the theme icons stop working.



> If theming support is really going to be an issue then should we postpone/block this PR from official builds until `5.x` & we can announce that pre-existing themes are not compatible?

There is no such problem for me. We can simply announce that the old themes are no longer supported with the release of version 4.5, although the old themes may remain partially compatible, or even finally add metadata support to the theme files (in particular the format version) and completely discard incompatible themes. Or make the transition soft, and let users continue to use their themes further, if they are satisfied with how they look in version 4.5.

P.S. If you remain convinced that we should not care about maintaining compatibility with old themes, then please do not forget to put your heads under all the shit that can flow from the mouths of grateful users with the release of v4.5."
1152287760,15769,xavier2k6,2022-06-10T12:04:36Z,">P.S. If you remain convinced that we should not care about maintaining compatibility with old themes

I didn't say that we shouldn't care, I'm just saying those concerns should have been more adamantly imposed so we could've adhered to them as we progressed.

>, then please do not forget to put your heads under all the shit that can flow from the mouths of grateful users with the release of v4.5.

Am I being thrown under the bus here?! - this PR could very easily have been disapproved/changes requested.
There was more than just me who approved it, so collectively we can all deal with any shit storm if it arises..."
1152348762,15769,Pentaphon,2022-06-10T13:14:49Z,"> If theming support is really going to be an issue then should we postpone/block this PR from official builds until `5.x` & we can announce that pre-existing themes are not compatible?

It's not an issue. Nothing should be postponed. You should just announce that theme developers have to re-do their themes if they want them to work with 4.5 onwards. They simply have to adapt, as they would for the countless other software that theme developers have had to keep up with. qBittorrent isn't a special case where theme developers never have to keep their themes up to date. "
1152423445,15769,Mazino-Urek,2022-06-10T14:29:42Z,"I have a proposal, @glassez hear me out. I get your point, now, didn't understand it before.

1. Leave this PR like this.
2. After this gets merge, I will make another PR that adds some backward compatibility,
3. When 4.5 is released, it is announced that theme developers must adopt new the new theme, as old one is deprecated,
4. In version 5, the second PR gets reverted, and backward compatibility will be easily removed without much effort.

I also think you are being unfair to @xavier2k6. With every release, there will be some feature that some people won't like. Something like, GUI which people directly interacts with will definitely have some responses. The problem is when people like it, they will just say “Cool”, and that is it. But, when someone doesn't like it, they will most likely complain it here. 

I don't know about @xavier2k6, but this project has had a mental toll on me. You guys are developer, when you code in a project you get better at it. I am not a graphics or UI designer, this is probably the last time I will attempt this with any other FOSS project.

We have tried our best. I can confidently say, more than 99%+ people will like the new UI, but a bit of 1% will complain here. It is not right to put the blame on one person. This is open source, it is meant be about everyone.
"
1152463661,15769,glassez,2022-06-10T15:09:00Z,"> I also think you are being unfair to @xavier2k6.

I'm not accusing @xavier2k6 of anything in any way (if it was like that, then let him excuse me). I didn't address anyone personally at all. I was just talking about two points of view.
>The problem is when people like it, they will just say “Cool”, and that is it. But, when someone doesn't like it, they will most likely complain it here.

You just can't imagine how many vile trolls come out at such a moment, who believe that you took their own thing and ruined it for no good reason, and pour vile shit on you, without hesitating in expressions, completely forgetting that they use the product of your work for free, in which you put your soul, and never even tried to say ""Cool"".
You guys have done a really great job and I have given my general approval for a very long time. I just don't want anything to upset your sense of satisfaction when it is released. If there is such a simple solution to smooth out the sharp corners, then why not apply it? The choice is yours.


> I have a proposal
...

👍 "
1152498626,15769,egorik4,2022-06-10T15:46:04Z,"Dear developers, as well as those who help the project, I express my gratitude to you for your hard work. 🧡 These changes are great! What you do is great! :)"
1152527156,15769,xavier2k6,2022-06-10T16:17:43Z,"@now-im Thanks, but it's all ok.

@glassez There's nothing to excuse you for, I don't have any issue with you personally & never have.

I agree with you that your points were valid & my only gripe was/is that the backwards compatibility could've been included from scratch in this PR as I said if it was adamantly imposed, this would've possibly saved us all this back & forth, plus we now wouldn't have to make another PR to add it back in."
1159840265,15769,sledgehammer999,2022-06-20T00:14:31Z,"@now-im Thank you for the hard effort.
And to be clear: Are the icons your designs or are they based off of other work?
I am asking for licensing reasons.
If these are your designs, then do you want to license them under some more icon-specific license? The default qbt license (aka GPL) might not be so suitable for icons."
1159915116,15769,Mazino-Urek,2022-06-20T03:05:03Z,"> These icons will be judged by user feedback during the alpha/beta releases.

Based on user feedback, further user improvement can be done in future.



> And to be clear: Are the icons your designs or are they based off of other work?

Some are my own creation, most of them are modification and amalgamation from two project, [la-capitaine-icon-theme](https://github.com/keeferrourke/la-capitaine-icon-theme) and [ionicons](https://github.com/ionic-team/ionicons). Both project license is compatible with qBittorrent.

The owner of first project has given his permission in https://github.com/qbittorrent/qBittorrent/issues/8406#issuecomment-566260702 and second project is under MIT license. I have also mentioned both of this project in the `Read Me`.



> To tell you the truth, personally, I am not really fond of this blue in the pallette. And I don't think it fits well in the general Windows UI theming (I am using win 7 for comparison).

Give it a bit of time to set in. You might find it lovely,"
1160055688,15769,sledgehammer999,2022-06-20T07:06:17Z,"From the La Capitaine README:

>Much of the artwork in La Capitaine is based on Numix Circle and El General GNOME (now known as Antu), with significant additions and changes. This art is to be treated as a GPLv3 licensed library.

So I don't think the La Capitaine author can relicense those icons (to us) to less than GPLv3.

@glassez @Chocobo1 @xavier2k6 any thoughts on this?"
1160124802,15769,Mazino-Urek,2022-06-20T08:19:06Z,"@sledgehammer999 As a workaround, we might license this Icon Pack as, GPLv3. 
As MIT is compatible with GPL, not the other way around."
1160154703,15769,xavier2k6,2022-06-20T08:44:59Z,">So I don't think the La Capitaine author can relicense those icons (to us) to less than GPLv3.

Well my own personal preference previously (IIRC) was to have used the original source `fontawesome` & where necessary use an alternative source using `MIT` license as @now-im has previously suggested or where we had the author's permission to do so. (this author's permission is now called in to question)

Would it be best if we start fresh & can also take in to account @glassez concerns about (naming/themes backwards compatibility)??"
1160157992,15769,Mazino-Urek,2022-06-20T08:48:03Z,"@xavier2k6 If we are talking about starting from scratch again, kindly count me out.
I have had enough."
1160164330,15769,xavier2k6,2022-06-20T08:53:46Z,"> @xavier2k6 If we are talking about starting from scratch again, kindly count me out. I have had enough.

If it is neccessary then yes, I am willing to create a new PR but I'm not 100% that I will have the time to get this in to a `4.5.0` as not sure what sort of cut-off deadline I'd be dealing with for an official release."
1160612305,15769,sledgehammer999,2022-06-20T15:55:06Z,Are the one's from `La Capitaine` separate from the ones from `ionicons`? Are they many?
1160795794,15769,glassez,2022-06-20T19:51:15Z,"> As a workaround, we might license this Icon Pack as, GPLv3.

Then qBittorrent builds that include this Icon Pack should be restricted to GPLv3, no? Or we are able to declare that qBittorrent is still distributed under GPLv2+ except the icons, that are under GPLv3? @sledgehammer999, @Chocobo1, what do you think?"
1160881653,15769,sledgehammer999,2022-06-20T22:02:27Z,">Or we are able to declare that qBittorrent is still distributed under GPLv2+ except the icons, that are under GPLv3?
 
I am not sure we can. See: https://stackoverflow.com/questions/47989/using-icons-licensed-under-gpl-or-lgpl-in-a-closed-source-commercial-software
I assume we could circumvent license problems if we packaged the SVGs separately and loaded them on runtime from disk."
1160957141,15769,xavier2k6,2022-06-20T23:39:27Z,"`speed icons`  are from `La Capitaine` & possibly `ratio`, `security-high/security-low` too.

`application-x-mswinurl`,  `application-rss+xml` seem to be originally from `fontawesome`

`connected/disconnected` - were these created by you?"
1160990562,15769,xavier2k6,2022-06-21T00:34:32Z,"![fontawesome_ionicons_hybrid](https://user-images.githubusercontent.com/42386382/174692624-57d415b0-d40e-41c2-aee0-b3cf67b52644.png)


Here's a quickly thrown together look of `fontawesome/ionicons` hybrid.

Icons weren't resized etc......just grabbed mostly from `fontawesome` & threw in a few from `ionicons`"
1161099455,15769,ArcticGems,2022-06-21T02:06:46Z,"> Here's a quickly thrown together look of `fontawesome/ionicons` hybrid.
> 
> Icons weren't resized etc......just grabbed mostly from `fontawesome` & threw in a few from `ionicons`

Nice, but reannounce, speedometer & 'force recheck' would not look good as small icons.

Connected & Disconnected could just be a simple 'plug' that is either green or red (would look better as small icons).

For speedometer, ""maybe"" we could use location-arrow in green (fontawesome) and 
also flip it to the left and make it red. Btw, are you allowed to modify fontawesome icons?

fontawesome 'arrows-rotate' might be better for 'force recheck'.

Maybe fontawesome 'bullhorn' could work for 'reannounce'.
"
1161202049,15769,Mazino-Urek,2022-06-21T03:31:12Z,"@sledgehammer999 @glassez @Chocobo1 
As per my understanding, qBittorrent is licensed under GPLv2 or later. According to [GNU](https://www.gnu.org/licenses/gpl-faq.html#AllCompatibility) website, GPLv2 or later is compatible with GPLv3 or later, as long are not copying code which is strictly GPLv2. I think it can be done.
Kindly have a look."
1161242514,15769,glassez,2022-06-21T04:13:21Z,"> GPLv2 or later is compatible with GPLv3 or later,

Yes, they are compatible. But if we mix GPLv2+ and GPLv3+ things, then the final product should be distributed under GPLv3+.


> I assume we could circumvent license problems if we packaged the SVGs separately and loaded them on runtime from disk.

And I suppose they should also be located in a separate repository, right?"
1161299596,15769,Chocobo1,2022-06-21T05:59:23Z,"> > GPLv2 or later is compatible with GPLv3 or later,
> 
> Yes, they are compatible. But if we mix GPLv2+ and GPLv3+ things, then the final product should be distributed under GPLv3+.

I agree.
An additional note, even if the final product is GPLv3+ we don't really want to change the current license text of qbt (see: https://opensource.stackexchange.com/a/1036)

> > I assume we could circumvent license problems if we packaged the SVGs separately and loaded them on runtime from disk.
> 
> And I suppose they should also be located in a separate repository, right?

Not necessary, for example see: https://github.com/keeferrourke/la-capitaine-icon-theme#license
It specifies which file has which license.

---

Currently it seems qbt is compatible with the icon projects aforementioned so I think it is all ok here."
1161637955,15769,sledgehammer999,2022-06-21T11:46:21Z,">Currently it seems qbt is compatible with the icon projects aforementioned so I think it is all ok here.

Sure.
But as I understand it, if we make releases as-is then we're forced to GPLv3, because the icons will be embedded into the final executable.
If we want to keep the source code GPLv2+, then we would need to stop embedding the icons into the executable.
At least, that's my understanding. @Chocobo1 did you mean something else above?"
1161840646,15769,glassez,2022-06-21T14:41:22Z,"> But as I understand it, if we make releases as-is then we're forced to GPLv3, because the icons will be embedded into the final executable.
> If we want to keep the source code GPLv2+, then we would need to stop embedding the icons into the executable.

I understand it the same way.
But, IIRC, some projects (like Firefox) manage to include some proprietary components (I'm not sure that it is about icons), so even Linux distros that strive to be completely free include the forks that do not contain such components. Although maybe their licenses are less restrictive than the GPL..."
1161875260,15769,glassez,2022-06-21T15:02:49Z,"The distributed program must have a license that is simultaneously compatible with the licenses of all its components.
Using the components separately under their own licenses is possible only if you obtained them separately from the program mentioned above. Theoretically, if we develop the codebase separately from icons (even having them in the same repo), they will be able to remain under their own licenses, and binaries will be distributed under a compatible license.
"
1162174097,15769,sledgehammer999,2022-06-21T18:39:47Z,">**The distributed program must have a license that is simultaneously compatible with the licenses of all its components.**
Using the components separately under their own licenses is possible only if you obtained them separately from the program mentioned above.

Can you elaborate on this?
For the bold part: Do you by any chance mean ""to have notices in the GUI that document the 2 different licenses and the components they apply to""?"
1162195494,15769,glassez,2022-06-21T18:55:37Z,"> Can you elaborate on this?

It means the same thing as you said above:

> if we make releases as-is then we're forced to GPLv3, because the icons will be embedded into the final executable.

I.e. we will need to distribute such executable under GPLv3 that is simultaneously compatible with both GPLv2+ of source code and GPLv3 of icons.
But formally, this should not prevent us from continuing to use GPLv2+ for source code, since icons do not mix directly with it, so we can assume that the source code is (can be) distributed separately from the icons. IMO, I don't see any contradictions in this point of view. You can try to refute it."
1162203459,15769,sledgehammer999,2022-06-21T19:02:55Z,">I.e. we will need to distribute such executable under GPLv3 that is simultaneously compatible with both GPLv2+ of source code and GPLv3 of icons.

So you're talking about the case where icons are embedded, right?
What about if icons are distributed as extra files alongside the binary? Then the binary can stay as gplv2+? (in your POV)."
1162223554,15769,glassez,2022-06-21T19:19:16Z,"> So you're talking about the case where icons are embedded, right?

Yes.


> What about if icons are distributed as extra files alongside the binary? Then the binary can stay as gplv2+? (in your POV).

To be honest, I didn't think in that direction. But if we draw an analogy with libraries, then dynamically linked libraries are also usually considered part of the program.

I don't know why the icon authors chose GPL as a license. As far as I know, GPL is considered unsuitable for such things (I have met mentions of it somewhere)."
1162231088,15769,glassez,2022-06-21T19:25:43Z,">Then the binary can stay as gplv2+

Is it so important?
IMO, the main thing is to continue qBittorrent development without changing license. In this case the license of distributed binary is just a formality."
1162259223,15769,glassez,2022-06-21T19:47:21Z,"> What about if icons are distributed as extra files alongside the binary? Then the binary can stay as gplv2+? (in your POV).

The another situation is when qBittorrent doesn't require these icons and distributed without them.
Then it can be distributed under its original license. And the user is free to obtain any icon pack he wants and use it with qBittorrent."
1162644783,15769,Chocobo1,2022-06-22T05:04:01Z,">And the user is free to obtain any icon pack he wants and use it with qBittorrent.

And if we use the current mechanism of qbt themes, we'll face another problem (IIRC): the compiled theme pack is not universally compatible with all Qt versions. This is a big problem in the linux world where every distro stays on different versions of Qt. And when distro updates it, that theme pack is also required to be recompiled with newer Qt versions in order to be compatible.

Bundling/embedding icons in the binary has the least problem in this regard."
1162650995,15769,glassez,2022-06-22T05:13:53Z,"> And if we use the current mechanism of qbt themes, we'll face another problem (IIRC): the compiled theme pack is not universally compatible with all Qt versions.

Now you can use ""theme as a folder"".

> Bundling/embedding icons in the binary has the least problem in this regard.

Well, if my conclusions above are correct, then we can do it. But we still have to change the license information distributed with binaries to explicitly indicate that the entire package is distributed under GPLv3, but the source codes are (separately) available under GPLv2+."
1162793011,15769,Chocobo1,2022-06-22T08:14:29Z,">But we still have to change the license information distributed with binaries to explicitly indicate that the entire package is distributed under GPLv3, but the source codes are (separately) available under GPLv2+.

In short, the final result would be like this:
* Binary package: GPLv3+.
  Although I have no idea how to announce this. Maybe just mention the icons are GPLv3+ in the root `COPYING` file?
* Source code, tarball, zip, git repo: The icons are GPLv3+. Other source code are GPLv2+."
1162810688,15769,glassez,2022-06-22T08:31:47Z,"> * Binary package: GPLv3+

Aren't icons under GPLv3 (w/o ""and later"")?

> From the La Capitaine README:
> 
> > Much of the artwork in La Capitaine is based on Numix Circle and El General GNOME (now known as Antu), with significant additions and changes. This art is to be treated as a GPLv3 licensed library.

"
1163527590,15769,sledgehammer999,2022-06-22T19:38:09Z,Is it a viable alternative to consider stopping embedding the icons and start distributing them as separate files?
1163528175,15769,sledgehammer999,2022-06-22T19:38:53Z,">Is it a viable alternative to consider stopping embedding the icons and start distributing them as separate files?

In the same installer/dmg/appimage/etc package ofc."
1163905726,15769,Chocobo1,2022-06-23T04:11:21Z,">Aren't icons under GPLv3 (w/o ""and later"")?

Read this: https://github.com/keeferrourke/la-capitaine-icon-theme/blob/master/LICENSE#L3-L4"
1163909997,15769,Chocobo1,2022-06-23T04:19:02Z,">In the same installer/dmg/appimage/etc package ofc.

Not sure about others, in linux installing the icons to ""/usr/share/qBittorrent/icons"" seems viable to me."
1163928365,15769,glassez,2022-06-23T04:56:53Z,"> > Is it a viable alternative to consider stopping embedding the icons and start distributing them as separate files?
> 
> In the same installer/dmg/appimage/etc package ofc.

Isn't AppImage considered as a single executable?"
1164373172,15769,glassez,2022-06-23T12:54:27Z,"That's what I realized by reading licenses, faqs and discussions.

It is not prohibited to distribute (convey) several products/works under different licenses via the same medium, archive, repository, etc. if there is a clear separation between them, for example (they may be located in different folders). Since the qBittorrent source codes do not depend on specific icons, we can safely have icons under a different license in a separate repository folder as a separate work/product (I think we should put a separate license statement there, plus a top-level statement should indicate which products are contained in the repository and their licenses).
When someone combines the source code with these particular icons into a single product (e.g. by building executable), then such a product can be distributed taking into account the license requirements of all its parts (source codes and icons), i.e. it will have a GPLv3+ license (this will not affect the sources in repo).

> Is it a viable alternative to consider stopping embedding the icons and start distributing them as separate files?

I don't think it will help you distribute qBittorrent executable under GPLv2+ as long as the icons are an integral part of the application. I think the only way to avoid the impact of their license on the executable being distributed (if this is a prerequisite for you) is to distribute icons separately as an UI theme."
1164462693,15769,Mazino-Urek,2022-06-23T14:14:52Z,"@PriitUring I need to make a list of them, I am waiting for core devs to decide on the final direction.

I can assure you there is no icon other than, `la-capitane` and `ionicons`. I have created some icon myself, none has been taken from any other source. "
1164516933,15769,xavier2k6,2022-06-23T14:57:57Z,Was `force-recheck` not `font-awesome`? or maybe it was a suggestion to use that style......
1164560538,15769,ghost,2022-06-23T15:31:24Z,Why not make all icons from scratch and get rid of licensing issues? It seems to have become way complicated with these different licenses.
1164569422,15769,xavier2k6,2022-06-23T15:38:42Z,">Why not make all icons from scratch and get rid of licensing issues?

I suggested that previously, we could use just one source `fontawesome` like we did previously or a `fotntawesome/ionicons hybrid` or alternatively as well look for alternative sources.

We'd already be creating another PR anyway to address the theming backwards compatibility & WebUI icons issues......Could kill 2 birds with the one stone if new PR tackled all these."
1164604681,15769,Mazino-Urek,2022-06-23T16:08:25Z,"As far as I know I really didn't try to take icons from other project, If it is just one it can be replaced.

I respect whatever decision core developers and community make. However, if the decision is to totally start from the scratch, I can't be part of that process. I neither have that time nor energy. I have tried my best here, and tried to meet everyone's need. I can't continue this again and again. 
This project can use the icons I have created on the process or modified. "
1164614022,15769,sledgehammer999,2022-06-23T16:17:04Z,"@glassez (and other people)
OK. I understand that licensing the **binary** distributions of qbt as GPLv3 is the more viable solution. (If this PR is merged)

@now-im Would it be hard for you to enumerate the icons which are based on `la-capitane`? Can you at least estimate their number? If they are low enough we could elect to partially merge this PR and replace the `la-capitaine` icons at a later date."
1164629633,15769,xavier2k6,2022-06-23T16:32:43Z,"@sledgehammer999 

>`speed icons`  are from `La Capitaine` & possibly `ratio`, `security-high/security-low` too.

see https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1160957141

We had used a variant of time previously from `ionicons` which has `MIT License` reference:
https://github.com/qbittorrent/qBittorrent/pull/15769#issuecomment-1098970321, these could be tweaked again?!
"
1164632775,15769,sledgehammer999,2022-06-23T16:36:01Z,">`speed icons` are from La Capitaine & possibly `ratio`, `security-high/security-low` too.

Only those? Those are quite few and could be replaced with non-gplv3 versions."
1164651931,15769,Mazino-Urek,2022-06-23T16:56:38Z,"@sledgehammer999 Give me a bit of time, I will provide the complete icon source list."
1164684622,15769,Mazino-Urek,2022-06-23T17:31:37Z,"@sledgehammer999 Complete List:

**La-Capitaine:** `application-rss+xml, application-x-mswinurl, connected, disconnected, checked-completed, configure, edit-copy, edit-rename, folder-documents, folder-new, folder-remote, go-bottom, go-down, go-top, go-up, hash, inode-directory, insert-link, kt-magnet, media-playback-pause, media-playback-start, media-seek-forward, network-connect, object-locked, queued, ratio, reannounce, slow_off, slow, speedometer, system-log-out, tags, task-complete, task-reject, tracker-error, tracker-warning, trackerless, trackers, view-categories`

**Ionicons:** `application-exit, collapse, dialog-warning, edit-find-user, edit-find, filter-all, firewalled, help-about, help-contents, ip-blocked, list-remove, loading, mail-folder-inbox, name, network-server, office-chart-line, plugins, preferences-desktop, preferences-other, preferences-system-network, security-high, security-low, set-location, torrent-creator, user-group-delete, user-group-new, view-preview, view-refresh, view-statistics, wallet-open, webui`

**Font-Awesome:** `force-recheck` (I have no idea, how it got in)

**My Own:** `downloading, edit-clear, error, filter-active, filter-inactive, filter-stalled, kt-set-max-download-speed, kt-set-max-upload-speed, list-add, preferences-web-browser-cookies, stalledDL, stalledUP`

I have also chosen to include some of my icons in their original origin, although I have modified them so much, they can be considered original."
1164747752,15769,xavier2k6,2022-06-23T18:42:02Z,"`La-Capitaine` **x39**
`Ionicons` **x31**
`Font-Awesome` **x1**
`My Own` **x12**

It's alot for `La-Capitaine` in terms of licensing woes perhaps......"
1165760694,15769,xavier2k6,2022-06-24T16:58:29Z,@Chocobo1 @glassez @sledgehammer999 We are allowed to use `cc0 licensed` images in our project if I understand that correctly yes?!
1166197083,15769,Chocobo1,2022-06-25T05:27:32Z,">We are allowed to use cc0 licensed images in our project if I understand that correctly yes?!

Seems so, it is listed on this table: https://www.gnu.org/licenses/license-list.en.html#CC0
"
1166553812,15769,sledgehammer999,2022-06-26T14:45:24Z,"Let's summarise a bit:

It is my understanding that there is no objection to the following solution:
1. Merge this PR
2. Do necessary work to mention that binary releases are GPLv3 and that source code is GPLv2+
3. Explore possibility for future replacement of gplv3 icons

If I am correct in my summary, then I'll go ahead in merging this in the next ~24hours.

PS: Step 3 is not mandatory for making a release."
1166567014,15769,xavier2k6,2022-06-26T15:37:49Z,">Explore possibility for future replacement of gplv3 icons

This can be done by using icons with `CC0 License` via a source like [SVG Repo](https://www.svgrepo.com/)

example:
[Speedometer](https://www.svgrepo.com/svg/36548/speedometer)
[Speedometer v2](https://www.svgrepo.com/svg/9822/speed-meter)"
1169195858,15769,sledgehammer999,2022-06-28T20:23:17Z,"So I am going ahead and merge this according to the afforementioned plan.
Thank you goes to @now-im and everybody else who participated in the PR (and its previous incarnations)."
1169545776,15769,Mazino-Urek,2022-06-29T05:22:02Z,"This is a tear-jerking moment for me. It has taken too long, and I had no idea it would have been this hard when I made the first PR in 2018. Special thanks to, @xavier2k6, without his contribution and feedback, this project would have been severely lacking. 

I was adamant about changes at first, and thought my version was the best version. With hindsight, I can safely say, I was mostly wrong. But, I can safely say, I have laid down a foundation, which will make future work easier.

Thanks a lot, everyone, it has been a wild ride."
1169954635,15769,xavier2k6,2022-06-29T13:04:19Z,@now-im You're most welcome.
1170073966,15769,Pentaphon,2022-06-29T14:44:12Z,"@now-im are you guys going to remove the Linux system icons checkbox altogether or leave it unchecked by default? 

https://github.com/qbittorrent/qBittorrent/issues/17150

Probably should be addressed now that your PR is going to 4.5 for sure. "
1170233163,15769,Mazino-Urek,2022-06-29T16:50:46Z,"> are you guys going to remove the Linux system icons checkbox altogether or leave it unchecked by default?

It should be removed. But, I don't have the necessary skills to do that. I will make an attempt though."
1331271493,15769,notevenaperson,2022-11-29T20:39:56Z,it's over
1331357042,15769,sheeit,2022-11-29T21:42:52Z,"No hate, but I really prefer the old theme, to be honest."
1331734439,15769,sheeit,2022-11-30T07:16:56Z,"@PriitUring
I would just like to emphasize that I was in no way blaming anyone or belittling their effort. I was simply expressing my personal opinion (which, granted, is not really needed at this point).

Maybe I'm just too resistant to change, but it would've been nice to leave the option to use the old look.

> Too few users gave feedback or even bothered to try any any builds before v4.5.0

I only noticed the change after upgrading to 4.5.0, which I assume is the case for most users.

Anyway, you're right, this is definitely not the place or time for this discussion, now that it's merged."
1374586190,15769,BEEFY-JOE,2023-01-07T19:35:44Z,"Hello, correct me if I am wrong, but the svg image format can be leveraged as an attack vector. 
SVG images are capable of executing arbitrary code embedded within the image
https://rietta.com/blog/svg-xss-injection-attacks/
https://blog.talosintelligence.com/html-smugglers-turn-to-svg-images/
https://security.stackexchange.com/questions/143141/i-received-a-suspicious-svg-file-via-facebook-message-what-does-it-do
I understand the benefit from a graphics designer standpoint of using svg for its superior scaling capabilities, but as we see in these examples SVG image files are a known and used attack vector for malicious attackers. 
Would it not make more sense to convert SVG images to more secure image formats that cannot execute arbitrary code from the browser?"
337502679,7610,glassez,2017-10-18T08:29:53Z,">Normalize Web API method names.

As this is a major update, proposals to change any other API method names are welcome.
"
337526142,7610,zeule,2017-10-18T09:37:11Z,Why did you change 'command' to 'api' prefix?
337533359,7610,glassez,2017-10-18T09:58:18Z,">Why did you change 'command' to 'api' prefix?

Not only 'command'. Now all API methods are under `api` prefix. All other paths are considered as regular files.
Having subprefixes is meaningless, IMO. Besides, the web developers mixed/confused it in the current code."
337655996,7610,WolfganP,2017-10-18T16:53:34Z,"Thx a lot @glassez... again. As per https://github.com/qbittorrent/qBittorrent/pull/7610/files#diff-177e7d5725be515944f83f47a0dc59bb I assume it can be enabled at run time via the preferences file, right?

What I couldn't detect from the commit is if the alt webUI is cached somehow at start, or it can be interactively changed while running and be reloaded on page refresh... could you please confirm?
Thx again!

@naikel do you mind to open a repository for your current alt webUI so we adapt it and avoid starting from scratch?"
337657039,7610,naikel,2017-10-18T16:56:57Z,"My WebUI has almost nothing implemented only the transfer list!!  Not even stop/start buttons! Sadly I haven't got the time to implement more features, but it uses ReactJS and Bootstrap for look n' feel and menus and stuff (and jQuery as well)."
337660940,7610,glassez,2017-10-18T17:10:17Z,"@WolfganP, you can enable alternative UI either during runtime via Preferences (e.g. via Options dialog) or via configuration file editing (when application is not running)."
337663613,7610,glassez,2017-10-18T17:19:53Z,">What I couldn't detect from the commit is if the alt webUI is cached somehow at start, or it can be interactively changed while running and be reloaded on page refresh... 

AFAIK, the application use file translation that caches already translated files. So if you switch to another UI source folder you can refresh, but if you update files in currently used source folder you need to restart the application. Unless I missed something... Need to be tested."
337933580,7610,glassez,2017-10-19T14:53:36Z,"PR updated:
Improve Web UI translation code (retranslate changed UI files)."
337933910,7610,glassez,2017-10-19T14:54:34Z,">if you update files in currently used source folder you need to restart the application.

@WolfganP, fixed."
337934862,7610,zeule,2017-10-19T14:57:32Z,"I did not read the PR completely, but already want to know what could you, @glassez, comment on the following. I can't see how we separate a Web UI from qBt HTTP API. "
337937630,7610,glassez,2017-10-19T15:06:13Z,">I can't see how we separate a Web UI from qBt HTTP API.

What exactly do you want to know? How is it separated in the code? Or in the request path?
The paths starting with `/api` is handled as qBt HTTP API requests. All other paths handled as some kind of HTTP source files. Default path (`/`) has special meaning; if session isn't active yet we send `login.html`, otherwise `index.html`."
337945506,7610,zeule,2017-10-19T15:31:15Z,"> What exactly do you want to know?

Consider yet another qBt API, which differs from the HTTP one mainly by marshaling scheme. For example, DBus. Should there be an object `qBtRemoveService`, one would just add another marshaling and export scheme. But right now the HTTP service and UI are quite bound to each other."
337951188,7610,glassez,2017-10-19T15:49:06Z,">But right now the HTTP service and UI are quite bound to each other.

Ok. I think I undestand you.
This is a long-existing behavior. This PR is not to change it.
Honestly, I don't imagine how to unify it. Currently Web API methods mainly doing a little service work: analyze the received parameters and (based on it) execute some command or sending some data.
When someone starts to implement a different API, it will be clear what code can be reused."
338165005,7610,zeule,2017-10-20T10:08:41Z,"@glassez: when opening via localhost and authentication for localhost is disabled in options, the UI is broken until actual authentication is performed."
338262595,7610,glassez,2017-10-20T16:53:57Z,">@glassez: when opening via localhost and authentication for localhost is disabled in options, the UI is broken until actual authentication is performed.

Fixed."
338290378,7610,glassez,2017-10-20T18:42:20Z,"@WolfganP, @qbittorrent, the two remaining questions:
1. Should we provide alternative UI as a replacement for the built-in one (as it is implemented now) or both built-in and alternative (if enabled) simultaneously?
2. Should we allow to configure alternative UI source location or just have the predefined one (e.g. `$qBittorrentDataDir/www`)?"
338300846,7610,WolfganP,2017-10-20T19:26:34Z,"@glassez Just a quick question to start testing. If I want just to initially replicate the core webUI copying the files at the src/webui/www folder in github, what Preferences/WebUI/RootFolder should point to? 
<somepath>/www or <somepath>/www/private or point to the start html file (ie <somepath>/www/private/index.html ?
Thx."
338365456,7610,glassez,2017-10-21T05:27:44Z,"@WolfganP, please wait until I get to finally determine the structure of the file locations. Now please give your answers to the questions from my last comment above.
I'll provide instructions how to start with copy of built-in UI later."
338376532,7610,Chocobo1,2017-10-21T08:55:01Z,">Should we provide alternative UI as a replacement for the built-in one (as it is implemented now) or both built-in and alternative (if enabled) simultaneously?

I think they should not be enabled simultaneously, in case the user forget to turn off the alternative and leaving it as a security hole (assuming the alternative one had a hole in it).

>Should we allow to configure alternative UI source location or just have the predefined one (e.g. $qBittorrentDataDir/www)?

I think it's preferable to let user to point wherever they want.
Also, it should be much secure if the public, private folder model is adopted, one can just point to a folder which contains the public & private folders. And it is easy to see what is shared to the open web and what is not."
338379726,7610,zeule,2017-10-21T09:56:13Z,"> Also, it should be much secure if the public, private folder model is adopted, one can just point to a folder which contains the public & private folders. 

+1, that would mostly remove the hole."
338387487,7610,WolfganP,2017-10-21T12:05:28Z,"> Should we provide alternative UI as a replacement for the built-in one (as it is implemented now) or both built-in and alternative (if enabled) simultaneously?

As I commented my experience with uTorrent miniUI in my OP (https://github.com/qbittorrent/qBittorrent/issues/7217#issue-248253874), I prefer both to be present simultaneously just in case anything goes wrong with the alt webUI (assuming core webUI will be always present and rock solid), with altUI being an extension of the current one (ie http://<ip>:8080/altUI/<somepage>). 
Maybe considering it an extension of the core one will also solve security concerns with off limits navigation and the like.

> Should we allow to configure alternative UI source location or just have the predefined one (e.g. $qBittorrentDataDir/www)?

My take is the easier, the better. If limiting the files location improves other areas (ie code simplicity, security, etc) then I'll go for documenting the decision in the code, implement a fix location and let the user accommodate to the restrictions."
338392089,7610,glassez,2017-10-21T12:48:25Z,">Please, make it impossible to get contents of any file by setting alternative UI path to any of its parent directories and typing its path in qBt web UI HTTP GET request.

I didn't understand what you mean..."
338392666,7610,WolfganP,2017-10-21T12:57:14Z,">> Please, make it impossible to get contents of any file by setting alternative UI path to any of its parent directories and typing its path in qBt web UI HTTP GET request.

> I didn't understand what you mean...

I assume @evsh refers to block any attempts to be able to navigate to http://:8080/altUI/../../../etc/passwd or similar..."
338392873,7610,glassez,2017-10-21T13:01:06Z,">I'll provide instructions how to start with copy of built-in UI later.

1. Copy `$(qBittorrent-repo)/src/webui/www` to any location
2. Copy `$(qBittorrent-repo)/src/icons` into `public` subfolder of the folder copied above and rename it to `images`
3. Point `Preferences/WebUI/RootFolder` to the folder copied above"
338392950,7610,glassez,2017-10-21T13:02:33Z,">I assume @evsh refers to block any attempts to be able to navigate to http://:8080/altUI/../../../etc/passwd or similar...

It's already done (even in legacy code). We forbid any path containing `..` in it."
338393005,7610,glassez,2017-10-21T13:03:33Z,PR updated.
338456971,7610,glassez,2017-10-22T07:08:27Z,PR updated. FileSystemPathEdit is used in OptionsDialog.
338467568,7610,zeule,2017-10-22T10:37:22Z,"> I assume @evsh refers ...

No, I mean that when alt UI directory is set, qBt returns contents of any file from that directory, whether it is part of the UI or not."
338471725,7610,glassez,2017-10-22T11:54:50Z,">No, I mean that when alt UI directory is set, qBt returns contents of any file from that directory, whether it is part of the UI or not.

qBt can't know exactly whether some file is part of the Alternative Web UI or not :)
>Please, make it impossible to get contents of any file by setting alternative UI path to any of its parent directories and typing its path in qBt web UI HTTP GET request.

This statement isn't understandable, as I said before. ""setting alternative UI path to any of its parent directories"" is nonsense.

Current behavior is:
1. When request is from unauthorized user we return files from ""public"" subfolder only (i.e. ""$altui/public""),
2. When request is from authorized user we return files from both ""private"" and ""public"" subfolders (i.e.""$altui/private"" and ""$altui/public"").

What should I change?"
338502149,7610,zeule,2017-10-22T19:21:58Z,"> qBt can't know exactly whether some file is part of the Alternative Web UI or not :)

And that is exactly the problem.

> This statement isn't understandable…

Sorry, I try to reword into a positive form: qBt may return only files of its web UI in response to any HTTP request.

> setting alternative UI path to any of its parent directories"" is nonsense.

If alt UI directory is set to '/', it is possible to get contents of any file readable by a local user. Even a misconfigured web application must not allow to use itself as a free gateway to the file system.

I see no sense to repeat these obvious things over an over here. @glassez, if you don't agree to the aforesaid, I suggest you to read an introduction to network security of your choice. Sorry, I'm not able to give you even a brief overview of the topic in a GitHub PR thread. "
338545291,7610,glassez,2017-10-23T04:32:06Z,">And that is exactly the problem.

Agree. But it isn't application wide problem. It can't be resolved at our code level. Web server can't know exactly  whether some file is part of the Web application or not unless the user (web server/application admin) declare it in some way. So we take this assumption as a basis (as is done everywhere). We just assume all the files from directory pointed as qBt AltUI root folder are part of AltUI (even more, only from private/public subdirectories of it).
If you think that's not enough, what can we do else? For example, we may rely on some config file in AltUI root (e.g. `.qbtwww`) containing more exact declarations.

>If alt UI directory is set to '/', it is possible to get contents of any file readable by a local user. Even a misconfigured web application must not allow to use itself as a free gateway to the file system.

Unfortunately, I can't imagine a way to differentiate whether app is misconfigured or that's exactly what user want.
>I see no sense to repeat these obvious things over an over here.

There are many problems in the world that have no solutions (at least, no acceptable solutions).

What I suggest, is used everywhere. I did not invent and do not want to do it. If you know any other acceptable method, just show it."
338615447,7610,zeule,2017-10-23T10:23:50Z,"> Web server can't know exactly whether some file is part of the Web application or not unless the user (web server/application admin) declare it in some way. 

qBt is not a Web server, such functionality is not expected from it. At a glance the very first version looks like a Trojan software. Now, with public & private sub-directories it is much better, of course. However, I did not find checks for symbolic links that point out from these directories (for files and for the public/private dirs themselves).

> Unfortunately, I can't imagine a way to differentiate whether app is misconfigured or that's exactly what user want.

User wants an alternative Web UI, which is located in a set of files. We just need to isolate this set explicitly (using directories, for example) and that is.

> There are many problems in the world that have no solutions…

Fortunately, the problem of creating a safe theming for a web application one is not one of those.

> What I suggest, is used everywhere. I did not invent and do not want to do it. If you know any other acceptable method, just show it.

Sorry, I'm not aware of this ""everywhere"". Of course an acceptable method is widely known and I suggested it from the very beginning: the application should look for UI files in a pre-defined set of directories and put an attention on symlinks (and other special file types)."
338760869,7610,glassez,2017-10-23T18:54:35Z,">creating a safe theming for a web application

Not just theming but the web application itself."
338980250,7610,Chocobo1,2017-10-24T12:55:53Z,This is looking real nice! I'll find to test it.
338981344,7610,glassez,2017-10-24T12:59:48Z,"The one more question.
I have stripped subpaths in API calls (since they was misused/confused). Should I fix/rearrange it instead?"
338984885,7610,Chocobo1,2017-10-24T13:12:00Z,">I have stripped subpaths in API calls (since they was misused/confused). Should I fix/rearrange it instead?

you mean something like `command/setGlobalDlLimit` -> `api/setGlobalDlLimit`?
I don't think it matters.

Also I keep forgetting, you should also update the API document in the wiki too, I mean update the current content and paste it to a new page, then obsolete the current page.
"
339043111,7610,glassez,2017-10-24T16:06:23Z,">Also I keep forgetting, you should also update the API document in the wiki too, I mean update the current content and paste it to a new page, then obsolete the current page.

I think, it should be done after merge into master."
339062270,7610,glassez,2017-10-24T17:06:53Z,">symbolic links that point out from these directories (for files and for the public/private dirs themselves).

Symlinks can be a problem in case of distributed WebUI packages. AFAIK, symlinks can be extracted from archives."
339066246,7610,glassez,2017-10-24T17:19:53Z,"PR updated. Added checking for ""bad"" symlinks."
339067133,7610,glassez,2017-10-24T17:22:56Z,"@lgallard, please review this PR."
339085623,7610,lgallard,2017-10-24T18:24:35Z,"@glassez while apps can use the old API commands it's okay. I would set the legacy behavior as the default, this way developer can get used to the new API and current 3rd-party apps won't break/crash . Then if needed future releases can set the new UI/API as the default.

Thanks for your notice. If the API will changes I would like to know to  adapt the Android app."
339099077,7610,glassez,2017-10-24T19:10:01Z,"I had not intended to add new API beside the old one. When this PR is merged, only the new API will be accessible. However, this should not require major changes of client applications, only the names of the API methods. You can check API version and select API method names format to use, if you want to support both new and old API. Of course, outdated applications will be broken."
339247795,7610,glassez,2017-10-25T08:00:23Z,">I had not intended to add new API beside the old one. When this PR is merged, only the new API will be accessible. However, this should not require major changes of client applications, only the names of the API methods. You can check API version and select API method names format to use, if you want to support both new and old API. Of course, outdated applications will be broken.

I can, of course, support both new and old names (having some performance loss, relatively small), but I'm afraid this temporary solution will become permanent."
339249682,7610,glassez,2017-10-25T08:08:18Z,PR updated. All symlinks inside WWW root folder are rejected now.
339278995,7610,Chocobo1,2017-10-25T09:58:34Z,">However, this should not require major changes of client applications, only the names of the API methods. 

We should compensate this by providing a test build/binary for webAPI devs, at the time when PR merged."
339302111,7610,zeule,2017-10-25T11:40:30Z,"> I can, of course, support both new and old names (having some performance loss, relatively small), but I'm afraid this temporary solution will become permanent.

It can be announced in advance when (with what version) the old API will be gone."
339317786,7610,glassez,2017-10-25T12:45:08Z,">It can be announced in advance when (with what version) the old API will be gone.

It can be done without both api supporting. Once the main contradiction of this PR will be solved, we can assign the version of the new API release, and announce it."
339318338,7610,lgallard,2017-10-25T12:47:26Z,Is there any pre-release available? This way 3rd-party programmers will be able to check their integrations! 
339329449,7610,glassez,2017-10-25T13:27:55Z,"@sledgehammer999, what do you say about this PR?"
339631881,7610,Chocobo1,2017-10-26T11:09:20Z,"Now it seems easy to add a new private webAPI: `getAvailableAPI`, which will return all available API names:
```json
{
  ""public"": [""API1"", ""API2""],
  ""private"": [""API3"", ""API4""]
}
```
This isn't required to this PR, so I'm just asking.

---

Also I've finished testing this PR, only minor issues left as I listed above."
339686005,7610,glassez,2017-10-26T14:33:25Z,">Now it seems easy to add a new private webAPI: getAvailableAPI, which will return all available API names:
>>{
  ""public"": [""API1"", ""API2""],
  ""private"": [""API3"", ""API4""]
}

One of my goals of this PR is to make the WebApplication code more declarative (using as much Qt builtin features as possible). Now all you need to add a new API method, is to declare the corresponding WebApplication method (annotated with PUBLIC_API to make it public).
If API enumeration is really needed for some reason I would implement it using Qt Meta Object system as well.

"
339868696,7610,Chocobo1,2017-10-27T04:22:27Z,">If API enumeration is really needed for some reason I would implement it using Qt Meta Object system as well.

I was exactly thinking about that too.
Also I think API enumeration is convenience for webAPI devs, this should be on TODO list.
"
340276627,7610,glassez,2017-10-29T16:53:58Z,">I still not convinced that dropping old API immediately is not a terrible idea.

Ok. I will implement compatibility layer."
341361173,7610,glassez,2017-11-02T09:16:37Z,PR updated. Built-in WebUI html switched to HTML5.
341886836,7610,glassez,2017-11-04T10:33:41Z,"PR updated. Added old API compatibility.
NOTE: I send version info in new format as a response for both old ""version/api"" and ""version/api_min"". Should I send some backward compatible responses (e.g. 16 as current API version)? I don't like this idea since we have to maintain two version numbering while we have compatibility layer."
341890226,7610,Chocobo1,2017-11-04T11:38:22Z,">Added old API compatibility.

How long this compatibility layer is going to stay?

>Should I send some backward compatible responses (e.g. 16 as current API version)? 

Not sure either, but the point of compat layer is being compat...
"
341890549,7610,glassez,2017-11-04T11:45:04Z,">How long this compatibility layer is going to stay?

I don't know. Personally I wouldn't have it at all.
Maybe until next minor release (v4.1)?

>Not sure either, but the point of compat layer is being compat...

@evsh?"
341921227,7610,glassez,2017-11-04T18:54:32Z,PR updated. Added API for RSS subsystem.
342133756,7610,glassez,2017-11-06T12:25:52Z,">Not sure either, but the point of compat layer is being compat...

Send old-style version for legacy requests (""/version/api"" and ""/version/api_min"")."
342182931,7610,JackDandy,2017-11-06T15:27:38Z,"Hi people,

This thread is a little long for me to get a good grasp of, so apologies if what I say is already taken care of.

The golden rule for an API is never change the I/O interface (unless adding something that wasn't there). Imagine the API shell copy command, what if someone decided to rename `copy` to `dupeit` thus breaking all scripts and OS functions that rely on `copy`. 

To prevent sudden overnight breakage and a nightmare for qB users, whereever API endpoints are being changed from `fred` to anything that is not `fred`, then method `fred` should be kept to instead pass its input params to `apiNewFred(...)`, and output in exactly the same way as always.
 
Then, `apiNewFred` can output differently, as long as `fred` realigns that output into what `fred` output originally (even dropping new detail if required) -- this way, developers or script writers can read your API changelog news and have time to implement `apiNewFred` changing 3rd party code to facilitate new output, time even to give feedback on new and improved functions. But `fred` must continue to return expected data structures for a stable eco system.  This is a smooth gentle way to deprecate a function over time. 

""_But i don't like those old function names_"" - fine, move those interfaces to a file you never touch, import it, and then you can forget about it - perfect for stability.

This applies to every external facing endpoint url and parameter, whether that be RSS, REST, RPC, whatever technique is used, stability comes first for the users and for the developers supporting the tool ;)

That's my 2 cents,

Thanks for reading."
350556605,7610,glassez,2017-12-10T15:37:02Z,"@Chocobo1, I've found some inconsistencies in WebAPI. Currently actions handle parameters and return result in a different way. Some of them use JSON, the others use different format. The lists are encoded also differently, values are either separated by '\n' or '|', etc. Should we care about it and normalize it here or leave it as is (at least in APIv2)?"
350606933,7610,Chocobo1,2017-12-11T02:25:38Z,">Should we care about it and normalize it here or leave it as is (at least in APIv2)?

I would chose to leave it for now."
352264140,7610,glassez,2017-12-17T15:36:37Z,"@Chocobo1, @evsh, @sledgehammer999, I think that the main work is completed, it remains only to identify and eliminate defects. You can start to review now.

Finally I merged AbstractWebApplication with WebApplication classes since it seems this was an unreasonable splitting

What has not been done: I'm still not extracted scopes into separate classes (this can be done later if you must). I am experiencing a _critical lack of time_ for the project, so I fear it will not be completed if I continue to add something here (so I ask you not to get to less important things when you review this)."
354020319,7610,sledgehammer999,2017-12-26T22:32:19Z,"@glassez since I don't care much about WebUI, you can proceed based on the others' comments.
PS: I also ""approveFeature"" of allowing alternative WebUIs to be loaded."
354062597,7610,glassez,2017-12-27T06:47:03Z,">you can proceed based on the others' comments.

@Chocobo1, waiting for your review. It seems like @evsh is not available now."
354646762,7610,glassez,2018-01-01T10:32:51Z,"@Chocobo1, I hope I addressed all your current comments."
355043366,7610,Chocobo1,2018-01-03T15:40:49Z,"I've skim through the rest, seems ok.
@glassez 
If you have code pieces you wish me to review, let me know."
355048998,7610,glassez,2018-01-03T16:01:06Z,">If you have code pieces you wish me to review, let me know.

I have no specific code pieces for review. I still want to implement separate ""webapi scope controllers"" (but in the one of following PRs) so some of the current code is in ""semi-final"" state now.
I would be very thankful if you helped me with testing. Overall, it works, but you need to do a final check and to see ""fresh"" look."
355904622,7610,Chocobo1,2018-01-08T08:17:16Z,"@glassez 
there are merge conflicts."
356611826,7610,glassez,2018-01-10T14:07:00Z,"@Chocobo1, I'm here again! I had some free time so I decided to implement some more changes. Please look at this again (hopefully for the last time in this PR). I finally implemented the API scope controllers and move appropriate logic from WebApplication class to these controllers. I also changed (simplified) the Action declaration logic (now without any tags, just any controller slot ended with ""Action"" is Action, public actions declared in WebApplication explicitly). I also made some more structural changes. In fact, I need to make more of them, but I already ran out of time (I don't know when I'll be able to come back to this)."
357967881,7610,glassez,2018-01-16T13:57:05Z,"@Chocobo1, ping!"
361040512,7610,Chocobo1,2018-01-28T05:55:41Z,urgh... this change set has become so large that github couldn't open diff for some files...
361041340,7610,Chocobo1,2018-01-28T06:19:29Z,"Although cmake builds can fail, you should try fixing errors in it:
https://travis-ci.org/qbittorrent/qBittorrent/jobs/334050974#L1428
This also appears as warning in my local machine."
361054996,7610,glassez,2018-01-28T11:14:17Z,">Although cmake builds can fail, you should try fixing errors in it:

Should be fixed now.
>urgh... this change set has become so large that github couldn't open diff for some files...

Moreover, I have some new changes on top of it, so we need review+merge this PR as soon as possible otherwise it will be ""unreviewable""."
361069069,7610,Chocobo1,2018-01-28T14:57:37Z,"I'll just comment here instead:
>findAPICall() || findLegacyAPICall();

please replace to the dumb `if (!findAPICall()) findLegacyAPICall();`, took me a few seconds to see what is beneath the surface."
361074551,7610,glassez,2018-01-28T16:16:58Z,">please replace to the dumb

replaced"
362386683,7610,WolfganP,2018-02-01T20:08:52Z,"I'm eagerly waiting for this PR to be merged to master to start experimenting with alternate webUIs and while trying to asses how stable will be to merge it in my local dev env; I looked back at the blocker issues (@evsh requesting changes) and it seems the original request goes back to Oct 22nd 2017. 
I understand those root browsing concerns were superseeded with the subsequent commits?"
362472605,7610,glassez,2018-02-02T03:06:55Z,"@WolfganP, this PR is ready and it will be merged once v4.0.4 is released."
366160236,7610,glassez,2018-02-16T07:10:34Z,Thanks to all the reviewers!
366267285,7610,WolfganP,2018-02-16T15:29:57Z,"Excellent work, thx a lot to all devs and reviewers.
@glassez do you mind to briefly document how to run an alternate webUI? (ie files names and locations, program switches / config entries, etc etc)
My first test will be copy the existing core webUI files to a new location and run them as alt, and then start modifying them, but just want to make sure I run them as intended by this feature.
Thx again!"
366848642,7610,Piccirello,2018-02-20T02:19:24Z,"@glassez Can you document the updated API urls on the wiki? This will be really useful for other applications that make use of the qBittorrent api.

Also, is it a good idea to introduce such a major API overhaul with a minor version bump? 4.1.0 seems far more appropriate."
367431756,7610,WolfganP,2018-02-21T18:54:44Z,"I fiddled a bit with the current API documentation in the wiki and made sure each article explicitly states which version it applies to, updating also the Home page in preparation for whatever documentation comes up for this new release.

I also created https://github.com/qbittorrent/qBittorrent/wiki/Alternate-WebUI-notes to start documenting the feature and its usage (ie files names and locations, program switches / config entries, etc etc), which I'll initially work out from the current code but it will need a review from @glassez for sure.

I agree with @Piccirello that this API overhaul should be tied to a major version rather than a v.4.0.5 minor one."
367558857,7610,Chocobo1,2018-02-22T03:48:10Z,">I fiddled a bit with the current API documentation in the wiki and made sure each article explicitly states which version it applies to

Please revert the document title (the current API one), as it is tied to the page URL and someone might already bookmark it. 
You can still keep the displayed link in Home page.

>I also created https://github.com/qbittorrent/qBittorrent/wiki/Alternate-WebUI-notes to start documenting the feature 

Great!
You might want to pick a title that needn't be changed for some time, e.g. ""How to Use Alternate WebUI"" or just ""Alternate WebUI"". 
And nitpick, it's WebUI instead of webUI."
367662869,7610,WolfganP,2018-02-22T12:15:47Z,@Chocobo1 Changes done!
367674762,7610,glassez,2018-02-22T13:06:36Z,">I agree with @Piccirello that this API overhaul should be tied to a major version rather than a v.4.0.5 minor one.

Guys, what exactly is your concern?
Legacy API is still available (via compatibility layer) and it will available, at least, until v4.1.
>Can you document the updated API urls on the wiki? This will be really useful for other applications that make use of the qBittorrent api.

Of course, I'll do it when I have some time for this job."
368637110,7610,Piccirello,2018-02-26T20:22:12Z,"> Legacy API is still available (via compatibility layer) and it will available, at least, until v4.1.

A majority of the legacy apis are no longer working. With some quick testing, I was able to identify these as broken (non-inclusive):

* /command/* (`m_apiLegacyPathPattern` doesn't contain the path ""command"")
* /version/api
* /version/api_min
* /version/qbittorrent (log contains `File :/www/public/version/qbittorrent was not found!
`)
* /sync/torrent_peers
* /query/torrents
* /query/propertiesGeneral
* /query/propertiesTrackers
* /query/propertiesFiles
* /query/getPieceHashes
* /query/getPieceStates

Please test all of the legacy apis to catch any additional ones that are broken."
368727865,7610,glassez,2018-02-27T02:44:16Z,">Please test all of the legacy apis to catch any additional ones that are broken.

OK. I'll fix it. Thank you for testing."
368956674,7610,glassez,2018-02-27T17:22:14Z,">/version/api
/version/api_min

Fixed via `QString::number()`
>/command/* (m_apiLegacyPathPattern doesn't contain the path ""command"")

Fixed via fixing regexp (for some reason I put ""control"" instead of ""command"" there)
>/query/torrents
/query/propertiesGeneral
/query/propertiesTrackers
/query/propertiesFiles
/query/getPieceHashes
/query/getPieceStates

Work for me.
>/version/qbittorrent

Fixed."
368960374,7610,glassez,2018-02-27T17:33:09Z,"@Piccirello, see #8515."
371060057,7610,Piccirello,2018-03-07T08:21:52Z,"@glassez It looks like [TransferController::infoAction()](https://github.com/qbittorrent/qBittorrent/blob/c759c4301e5a19f641c92ebe703df4801ac56903/src/webui/api/transfercontroller.cpp#L55) is no longer used, and its logic migrated to `SyncController::maindataAction()`. This would mean we can get rid of `TransferController::infoAction()`. Can you confirm?"
371064612,7610,glassez,2018-03-07T08:40:23Z,"If some API isn't used in official Web UI, it's not a reason to drop it out. Some other apps may want to use it, or may want to use it in the future."
371329974,7610,Piccirello,2018-03-08T00:03:24Z,"Good point, it makes sense to leave it in."
372115812,7610,glassez,2018-03-11T13:31:23Z,"@WolfganP, @Piccirello, @Chocobo1, the documentation for new API is [here](https://github.com/qbittorrent/qBittorrent/wiki/Web-API-Documentation). I followed the style of legacy API documentation, even though I don't like it (I have no time to mess with it). Please correct any errors or inaccuracies you have noticed."
372116430,7610,WolfganP,2018-03-11T13:40:43Z,@glassez do you mind to get a quick review & editing to this article https://github.com/qbittorrent/qBittorrent/wiki/Alternate-WebUI-usage so there's a base in the docs for those who want to start fiddling with alt WebUIs?
572816586,7610,ngodber,2020-01-10T00:18:39Z,"@glassez Is there a recommended/durable/invariant method to check appropriate webAPI to use? I'm a tad confused as it seems you need to know/guess the correct API to use to check the webAPI version, eg

![image](https://user-images.githubusercontent.com/11834846/72115329-64f15200-3392-11ea-8579-a038d9b605b3.png)

vs 

![image](https://user-images.githubusercontent.com/11834846/72115369-86523e00-3392-11ea-8d83-72dc9e18d7b7.png)

Or am I misunderstanding something?"
623166493,12746,FranciscoPombal,2020-05-03T19:24:07Z,"~Note: Until I rebase, please don't submit full fat reviews~ DONE"
623168940,12746,jagannatharjun,2020-05-03T19:39:56Z,"Hi, I left some comments, since recent CMake changes affected me too much and I think I'm the only one who actually uses CMake regularly with qBitTorrent, so I chipped in, hope you guys don't mind.

> Note: Until I rebase, please don't submit full fat reviews

Sorry I missed this"
623169219,12746,jagannatharjun,2020-05-03T19:41:48Z,"> Should build fast with VS generators on Windows thanks to unconditionally passing /MP to the compile options; I have not personally benchmarked against the Ninja or JOM Makefiles generators (will do it later), but so far it seems pretty fast to me, about what is expected from my test system.

CMake automatically adds this based on generator."
623171952,12746,FranciscoPombal,2020-05-03T20:00:49Z,"@jagannatharjun 
>Hi, I left some comments, since recent CMake changes affected me too much and I think I'm the only one who actually uses CMake regularly with qBitTorrent, so I chipped in, hope you guys don't mind.

No problem at all! If I had known that, I'd have tagged you as well in the OP. I've also been building qBittorrent with CMake exclusively for a while (on Linux).

> CMake automatically adds this based on generator.

This was not my experience, but I will test again. Perhaps vcpkg is also fiddling with the flags? We'll see...

>Sorry I missed this

No sweat. :+1:"
623275457,12746,NotTsunami,2020-05-04T06:08:15Z,"Initially I was using qmake, but I started using CMake as well right before I submitted my CMake PRs. This is a very big change, and at a glance there might be a few things to extract into separate PRs or commits. Tomorrow I'll disect this and review."
623537587,12746,FranciscoPombal,2020-05-04T15:36:27Z,"@glassez @NotTsunami I guess it would be convenient to split this up into different commits (and I'll try to that), but this is such a big change that I'd encourage you to look at the overall result rather than each individual change.

The goal right now is to get feature-parity with the current CMake scripts, while using the most modern features possible that enable us to simplify the implementation.

The hope is to facilitate work in follow-up PRs that, in this order:
- Move to a more target-centric build approach
- Reach feature-parity with the qmake build system
- Add additional features, mainly the ability to build installers for the Windows and macOS platforms using CPack

A good, simple build script system enables one to quickly visualize and reason about the high-level architecture of the project and its dependencies. This is what the dependency graph looks lke currently on Ubuntu 18.04 (ouput of `cmake -S . -B build --graphviz=build/graph/graph.dot` visualized with `xdot`; the red color has no special meaning, it merely indicates the currently selected node at the time the screenshot was taken):

EDIT:Obsolete. See new graph: https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-653964262

![screenshot](https://user-images.githubusercontent.com/17580742/80983746-d1ea9500-8e24-11ea-92d3-36be407bdd0e.png)
"
623580610,12746,glassez,2020-05-04T16:53:41Z,">Add additional features, mainly the ability to build installers for the Windows and macOS platforms using CPack

CPack related stuff is definitely an alien here."
623588211,12746,FranciscoPombal,2020-05-04T17:08:27Z,"@glassez 
> CPack related stuff is definitely an alien here.

Any sort of proper discussion about it is pretty far into the future at this point anyway. I'm just floating the idea, haven't looked into it in depth either."
623599461,12746,zeule,2020-05-04T17:30:43Z,"> Any sort of proper discussion about it is pretty far into the future at this point anyway.

Out of curiosity, what will replace it for MacOS in the meantime, since you remove the DeployQt utility?"
623605128,12746,FranciscoPombal,2020-05-04T17:41:37Z,"@zeule 
> Out of curiosity, what will replace it for MacOS in the meantime, since you remove the DeployQt utility?

That's definitely a hole in the plan, good point. I guess at least for macOS the CPack stuff will have to be done before, as I don't think saying ""just use the qmake build in the meantime, bro"" is a good solution."
623690228,12746,zeule,2020-05-04T20:33:20Z,"> * Top-level file just handles features, required versions and summary
> * Nothing is toggled via ""spooky action at a distance"" of `Package_FOUND` variables, everything is controlled by the features

Would be super fun to read, as I used to hear and read similar opinions some 20 years ago from people fighting encapsulation principle, as well as from those from the pro C (and anti-C++) camp, but not in 2020. Nowadays things like that sound just scary.

> * The overall dependencies between internal components, which means some stuff is still (and has to be) based on the directory-scope commands like add_compile_definitions instead of their target- focused counterparts.

You'd better harry up until @glassez turn the CMake build program into a doppelganger of the qmake one, with the only a single target for the executable. :D

`VERBOSE_CONFIGURE` turned off by default is, frankly speaking, a stupid idea, because the verbose output is what you need from users when build fails. It would make sense if there will be a way to show the full log in case of a compilation/installation error.

What's the point of printing out default values for options? Do you think people can't recall did they just run cmake with additional flags or not? And if you really want to produce that noise on output, why it's done manually? You pass the default value to the `feature_option`, it can print it out for you. 


  
  "
623707962,12746,FranciscoPombal,2020-05-04T21:11:11Z,"@zeule
> Would be super fun to read, as I used to hear and read similar opinions some 20 years ago from people fighting encapsulation principle, as well as from those from the pro C (and anti-C++) camp, but not in 2020. Nowadays things like that sound just scary.

I hope you're not saying you did not read the files at all. I may not have expressed myself clearly enough in those bullet points, and you might be getting a distorted picture of what I actually did. But even so, personally I prefer the current technique vs the previous ""feature activation/build by side-effect based on found packages"" that was happening before.

My goal was to maximize discoverability and declarativeness:
- the configure output always tells you all available options and how they depend on one another + the defaults
- the user of the build system just specifies the features they want, the build script figures out the details by itself to achieve the desired feature set.

If you have suggestions about how the current patches can be improved without compromising these goals, feel free to share them. I am also open to totally changing my mind about the general direction of the changes, should you present convincing arguments as to why I should eschew these goals completely in favor of some other, possibly completely different ones.

>`VERBOSE_CONFIGURE` turned off by default is, frankly speaking, a stupid idea, because the verbose output is what you need from users when build fails. It would make sense if there will be a way to show the full log in case of a compilation/installation error.

Thankfully, thanks to the built-in discoverability, the user will automatically know it exists and hopefully use it. It can also be mentioned in the build documentation in the wiki ""if you have problems, turn on this flag"". In case they miss all of that, it's just a matter of having a ""Build system"" issue template with a requirement of ""post output of cmake configure with `-DVERBOSE_CONFIGURE`"". But I don't mind too much if this is on by default. If the majority agrees it should be so, I'll accept it.

>What's the point of printing out default values for options? Do you think people can't recall did they just run cmake with additional flags or not?

Discoverability. One should be able to know all they need to know without having to look at the build script (unless they explicitly want to hack on it).

> And if you really want to produce that noise on output, why it's done manually?

About the manual part, you're right, I can improve the macro to print the default for me.

About the ""noise"" argument, it's minimal noise for the QoL it provides, especially compared to what you're advocating about having the ""found package XXX"" spam turned on by default.

> You'd better harry up until @glassez turn the CMake build program into a doppelganger of the qmake one, with the only a single target for the executable. :D

I'm ok with not having a fully target-based CMake script just now. The goal is to have a ""clean slate"" to start from that can be easily understood, hopefully with feature-parity with the qmake system. The current scripts have too much clutter to efficiently manipulate IMO. The idea is: first, simplification; then targets; after that, refinement of targets."
623749679,12746,eli-schwartz,2020-05-04T22:53:16Z,"I checked out this PR and tried configuring, IMO it makes it a lot easier to understand what has happened.

FWIW, it initially failed to configure until I restored FindLibtorrentRasterbar.cmake -- my system libtorrent-rasterbar package is apparently built with autotools instead of cmake, both of which produce pkg-config files... but only the cmake build produces *.cmake files.

It should be possible to always find it with FindPkgConfig's

```
pkg_check_modules(LIBTORRENT_RASTERBAR libtorrent-rasterbar IMPORTED_TARGET GLOBAL)

target_link_libraries(mylib PkgConfig::LIBTORRENT_RASTERBAR)
```

And surely you could also add some fallback mode to try both."
623755233,12746,FranciscoPombal,2020-05-04T23:10:32Z,"@eli-schwartz thanks for the feedback. The failure to find libtorrent if it was not built with CMake is expected in the current state of the patch.

if I add this as fallback mode,

> ```
> pkg_check_modules(LIBTORRENT_RASTERBAR libtorrent-rasterbar IMPORTED_TARGET GLOBAL)
> 
> target_link_libraries(mylib PkgConfig::LIBTORRENT_RASTERBAR)
> ```

is there any advantage in additionally including `FindLibtorrentRasterbar.cmake` locally (and also adding that as a fallback)? So far I was convinced that I _had_ to include it, but if all cases are covered by the regular `find_package` + this `pkgconfig` method, I'd rather not include another big ""blob"" that has to be maintained or at least kept synced with the upstream.

However, I suspect that including `FindLibtorrentRasterbar.cmake` might still be needed for Windows users that are not using `vcpkg`, right?

I guess we can always inform the user that they can manually specify libtorrent library/include files locations with appropriate variables, but that's a last resort."
624249980,12746,zeule,2020-05-05T19:10:00Z,"> @zeule
> I hope you're not saying you did not read the files at all. I may not have expressed myself clearly enough in those bullet points, and you might be getting a distorted picture of what I actually did. But even so, personally I prefer the current technique vs the previous ""feature activation/build by side-effect based on found packages"" that was happening before.

I did read the changeset, but my understanding is that those points draw the final goal. No matter which technique you prefer, those bullets outline a certain view on the build configuration and building this peace of software. And that did not connect with the changes in the PR.

> 
> My goal was to maximize discoverability and declarativeness:
> 
> * the configure output always tells you all available options and how they depend on one another + the defaults

Then you might consider investing time in `mark_as_advanced()` and `cmake -LH`

> * the user of the build system just specifies the features they want, the build script figures out the details by itself to achieve the desired feature set.

This is the fundamental task for all build systems and they all solve it in one way or another.


> About the ""noise"" argument, it's minimal noise for the QoL it provides, especially compared to what you're advocating about having the ""found package XXX"" spam turned on by default.

a ""noise"" is a signal without information, like those default values, because when I read them I always know already what options I provided to cmake a few second ago. The messages about found packages, on the other hand, can tell about changed dependencies. Yes, most of the time there are no dependency changes and the messages are boring.

"
624307237,12746,zywo,2020-05-05T21:08:34Z,"`LibtorrentRasterbar_DIR` option is not configurable via `ccmake .` command.

PS: This PR solves the `cmake_minimum_required()` >= 3.15 slow compilation issue for me.

"
624326811,12746,FranciscoPombal,2020-05-05T21:53:48Z,"@zeule 

> Then you might consider investing time in `mark_as_advanced()` and `cmake -LH`

The docs for the `mark_as_advanced()` command say:

> An advanced variable will not be displayed in any of the cmake GUIs unless the show advanced option is on. In script mode, the advanced/non-advanced state has no effect.

I don't use CMake GUIs, so this is not really relevant to my points. It could be useful to prune some low-level details for GUI users by default though. If there turns out to be demand for this, I'll experiment with it and try to improve the GUI experience.

As for `cmake -LH`, it does show the option descriptions for application features (although it does not show the default for the setting, unless you embed it as part of the description like I did anyway). But it also shows many lines with stuff like this:

> // The directory containing a CMake configuration file for Qt5LinguistTools.
Qt5LinguistTools_DIR:PATH=/usr/lib/x86_64-linux-gnu/cmake/Qt5LinguistTools

Who cares about this? Some people under some circumstances do, but most under most circumstances don't. Those that do want to see this will know that they have to run `cmake -LH` (or possibly even `cmake -LAH`) to see this anyway. I think listing the defaults for the important application features in the main output fills the gap of showing details about important stuff, but not _too much detail by default_.

> This is the fundamental task for all build systems and they all solve it in one way or another.

My point here was that you want your build system to some housekeeping on its own, but not to make very important decisions about the application itself automatically. For example, I don't think it is desirable for your build system to do decide defaults for application features based on installed packages. However, there are other things that it is most welcome to decide the defaults for. For instance, it is obviously desirable that CMake do certain things related to toolchain setup based on whether it's running on Windows or Linux without bothering you too much. IMO it is not desirable to build GUI by default on systems that have certain packages, and not do the same on others that don't. This hurts reproducibility (although I must state that having fully reproducible builds is not a goal at this point anyway) and most importantly, it makes it confusing to use IMO.

> a ""noise"" is a signal without information, like those default values, because when I read them I always know already what options I provided to cmake a few second ago. The messages about found packages, on the other hand, can tell about changed dependencies. Yes, most of the time there are no dependency changes and the messages are boring.

""One man's noise is another man's freedom fighter"". Or something like that.
For most people it is very convenient that the script tells them the defaults. If you were compiling qBittorrent for the first time (or after some time where new options may have been added), wouldn't you like to see the defaults listed so that you know what you may want to override? There's information in this signal for the user of the build script. Of course if you already know all options and their defaults by heart, you might not care about this information.

Yes, the options and their defaults can (and should, regardless) be listed in the documentation. But it's much more convenient this way, and even has the advantage that makes updating documentation easier. If we require that contributors keep the ""default: ..."" text updated in the build script itself, it serves as an authoritative source for the documentation. Consider the current wiki article about CMake compilation in the wiki. A lot of the documentation about options and their defaults are very outdated. If this patch goes through, they will be even more so. Someone will have to update the page eventually (I don't mind doing it myself). If the configure output lists the defaults, this will be trivial. Otherwise, you'd have to go mucking through the script to figure it out (this is especially unpleasant if the defaults change based on packages found). I know what I'd much rather have to do.

> And that did not connect with the changes in the PR.

Care to elaborate on the changes you find to be counter-productive to achieving the stated goals?

@zywo 

> `LibtorrentRasterbar_DIR` option is not configurable via `ccmake .` command.

Yes, stuff related to `libtorrent` configuration and discovery is lacking right now, I want to address this but have had a few setbacks with my usual environment, apologies for the delay."
624452163,12746,glassez,2020-05-06T05:40:21Z,">IMO it is not desirable to build GUI by default on systems that have certain packages, and not do the same on others that don't.

:+1:
This was especially annoying if you need to build ""no-GUI"" version in an environment where QtWidgets package is installed."
624771335,12746,zeule,2020-05-06T17:04:05Z,"> As for `cmake -LH`, it does show the option descriptions for application features (although it does not show the default for the setting…

Let me repeat once again: the defaults are obvious from the cmake command that was used to run the configuration.
> 
> > // The directory containing a CMake configuration file for Qt5LinguistTools.
> > Qt5LinguistTools_DIR:PATH=/usr/lib/x86_64-linux-gnu/cmake/Qt5LinguistTools
> 
> Who cares about this? 

Those who have several Qt versions installed? 

> My point here was that you want your build system to some housekeeping on its own, but not to make very important decisions about the application itself automatically. For example, I don't think it is desirable for your build system to do decide defaults for application features based on installed packages.

That is a significant part of what the configure systems are needed for and what they do, actually. For example, if I have systemd installed, obviously most of the time I want systemd service units from all packages that support systemd. When I have ICU installed, obviously it is for software to use it. When I build qBittorrent in a Linux environment I want it to detect that and show desktop notifications in the way my DE can understand them. Maybe the GUI/headless switch is not the one that suits this paradigm in the best way, but nevertheless, the find package -> enable feature paradigm it is widely used. 

Let's take a look at the main Gentoo package tree. Packages supporting CMake usually do that inheriting `cmake-utils` eclass. That gibberish means one can find those packages grep-ing for ""cmake-utils"" in the ebuild (Gentoo package format) files. Let's do that:
```sh
$ find . -name '*.ebuild' -exec grep -l 'cmake-utils' {} \; | cut -f 2-3 -d/ | uniq | wc -l  # cut + uniq to join various package versions and count each package name only once
710
```
Among those 710, 57 contains no user choices (`grep -l 'cmake-utils' | .. | grep -L 'IUSE'`, the ""IUSE"" variable contains user choices).
Now, there are 62 packages that use `CMAKE_DISABLE_FIND_PACKAGE` directly (`grep -lR 'CMAKE_DISABLE_FIND_PACKAGE' | cut -d/ -f 1-2 | uniq | wc -l`) and 177 that use it via a wrapper in `cmake-utils` eclass (`grep -lR 'use_find_package' | cut -d/ -f 1-2 | uniq | wc -l`)
Thus, 239 packages (did not check that no packages use `use_find_package` + `CMAKE_DISABLE_FIND_PACKAGE` but I doubt there are any) out of 653 configurable CMake-based packages use `CMAKE_DISABLE_FIND_PACKAGE`, and this switch is relatively new.

And (surprise!) CMake itself relies on `find_package(Qt5Widgets)` to decide whether to build its GUI part.

> ""One man's noise is another man's freedom fighter"". Or something like that.
> For most people it is very convenient that the script tells them the defaults. If you were compiling qBittorrent for the first time (or after some time where new options may have been added), wouldn't you like to see the defaults listed so that you know what you may want to override?

That is what I am talkig about: when I run cmake (e.g. without options), the enabled features are obviously enabled by default, because I did not enable them.

> Care to elaborate on the changes you find to be counter-productive to achieving the stated goals?

The biggest change in CMake 3.0 is the encapsulation. Targets became kind of objects which you can set up at one place, and they invoke ""spooky action at a distance"" when used. But you declared a move in the opposite direction as the goal, yet you also declared desire to use the modern CMake."
624936324,12746,FranciscoPombal,2020-05-06T23:06:46Z,"@zeule 
> Let me repeat once again: the defaults are obvious from the cmake command that was used to run the configuration.

> That is what I am talking about: when I run cmake (e.g. without options), the enabled features are obviously enabled by default, because I did not enable them.

Well, I guess that's true, but only as long as _all_ features are listed, both the enabled _and_ the disabled ones. Otherwise how can one easily learn about all the available flags?

Ironically, however, seeing as it is such a widespread practice to surprise the user with feature activation based on installed packages, I think there's still value in informing the user that in qBittorrent's script, these are the defaults and that's it. No surprises.

Besides defaults, would you expect the user to ""guess"" relationships such as `SYSTEMD, (...) depends on condition: NOT GUI`? I think this should also be printed out to the user.

> Those who have several Qt versions installed?

In that case you'd have to pass a few flags to select the correct one already, no (I really don't know, I never had more than one Qt version at a time in my Linux system)? If you're doing that anyway, it's not much more work to pass `-DVERBOSE_CONFIGURE` also. I doubt the majority of people building qBittorrent have multiple Qt versions installed (although I'm aware I'm 100% speculating here). That flag is there precisely to support advanced use-cases.

> That is a significant part of what the configure systems are needed for and what they do, actually. For example, if I have systemd installed, obviously most of the time I want systemd service units from all packages that support systemd. When I have ICU installed, obviously it is for software to use it. When I build qBittorrent in a Linux environment I want it to detect that and show desktop notifications in the way my DE can understand them.

You're not always building for your own system, and even if you are, this way just provides sane defaults. It still tells you all about them so that you may further tailor the build to your needs

> But most packages do it like this now at the moment!

No offense, but not an argument. What if most of those packages are not following best practices? What if their CMake scripts were written long ago? Or what if someone started doing like that _just because_ and everyone else followed suit because it was the done thing?

I've stated my logical reasons: don't do surprising things depending on the user's environment, and make it obvious what you need to do to disable each feature. In your way of doing things, suppose you see ""found packages X11, ZLIB, QtDbus and QtWidgets"" and ""enabled GUI, POWER_MANAGEMENT, and NOTIFICATIONS"" in the output. Even if you know ""oh, I must disable a corresponding package"", can you immediately guess which of those will be disabled by passing `-DCMAKE_DISABLE_FIND_PACKAGE_QtDbus=OFF` (it could disable more than one!)? I don't think it's very user-friendly.

 If you want to convince me that your way is better, you'll have to argue with something stronger than ""everybody does it"". If you can link to a book, blog post, video, etc arguing convincingly in favor, I'll be thankful and gladly educate myself on the subject.

> The biggest change in CMake 3.0 is the encapsulation. Targets became kind of objects which you can set up at one place, and they invoke ""spooky action at a distance"" when used. But you declared a move in the opposite direction as the goal, yet you also declared desire to use the modern CMake.

What move, specifically? I already stated that it won't be in _this_ PR that qBittorrent's CMake build script will fully migrate to just using `target_*` commands. This is just an attempt at simplifying the script, so that the move to a more target-based approach becomes easier, in a follow-up PR.

I think so far, the changes will help the migration. For example, previously, the feature options macro called `add_definitions`. Now it doesn't, and it will be simpler to convert the resulting `add_compile_definitions` into `target_compile_definitions`. Also, the script that added compile options directly manipulated the `CXX_FLAGS` and had a lot of unneeded stuff. Now it doesn't, and this will make future changes easier."
624954878,12746,FranciscoPombal,2020-05-07T00:07:53Z,"I can't find (an easy) way to enforce C++ standard based on what libtorrent was compiled with. Libtorrent's `INTERFACE_COMPILE_FEATURES` simply enforces a _minimum_, so even if it says `cxx_std_14`, the user will override that if they set `CMAKE_CXX_STANDARD=17`. The same would happen if the libtorrent target defined the `CXX_STANDARD` property, it just gets overriden.

So what I can think of right now is to:
- check libtorrent's `INTERFACE_COMPILE_FEATURES` early 
- convert that to the corresponding standard integer
- enforce it, regardless of what is set as the default `CXX_STANDARD` or the user passes.

It's a bit messy, not to mention that it only covers the case where libtorrent itself was also built with CMake. So I think the current `NOTICE: Building in C++XY mode. Make sure libtorrent was built with the same C++ mode for ABI compatibility.` is what I'm going to go with for now."
624964332,12746,zeule,2020-05-07T00:42:59Z,"> I can't find (an easy) way to enforce C++ standard based on what libtorrent was compiled with. 

Two wild ideas.

1. Collect libtorrent versions and C++ standard versions that they accept and care about. For example, the current master requires C++14 and this is the latest it knows about.  If the found libtorrent version was build with the highest version libtorrent is aware about, qBt can safely use anything newer.

2. A very wild idea: grep libtorrent include files for `__cplusplus ([<>=]+) ([0-9]+)`, find the highest one and then safely use any newer C++ version. "
624974771,12746,FranciscoPombal,2020-05-07T01:21:43Z,"@zeule

> qBt can safely use anything newer.

I though it was not enough to ensure that C++14 was used as the minimum. I thought it had to be the exact same version (i.e. if libtorrent was build with C++14, qBittorrent shouldn't use C++17). But this belief is based on this comment, https://github.com/qbittorrent/qBittorrent/issues/11879#issuecomment-581599783, which I may be misinterpreting or misunderstanding."
624978824,12746,zeule,2020-05-07T01:37:40Z,"@FranciscoPombal, C++ standard versions are backward compatible ""if it compiles"". The sizes of std types should be the same. If libtorrent uses condition `__cplusplus < 201402`, than there will be no difference between C++14 and C++17, 20, etc., right? If it compiles, of course."
624985491,12746,FranciscoPombal,2020-05-07T02:03:06Z,"@zeule 

> @FranciscoPombal, C++ standard versions are backward compatible ""if it compiles"". The sizes of std types should be the same. If libtorrent uses condition `__cplusplus < 201402`, than there will be no difference between C++14 and C++17, 20, etc., right? If it compiles, of course.

I mean I sure hope you're right. @arvidn comments, please? Context: this comment (https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-624974771) and the comment linked within it."
625031380,12746,glassez,2020-05-07T05:05:46Z,">enforce it, regardless of what is set as the default CXX_STANDARD **or the user passes**.

IMO, it's generally bad idea to override explicit user choice."
625043558,12746,glassez,2020-05-07T05:51:45Z,">PS: This PR solves the cmake_minimum_required() >= 3.15 slow compilation issue for me.

What OS/compiler do you use?
It really annoys me why it's so much slower than QMake+JOM for me (Windows 10 x64, Qt 5.14, MSVC2017)."
625183811,12746,FranciscoPombal,2020-05-07T11:00:00Z,"@glassez 
> IMO, it's generally bad idea to override explicit user choice.

In general I would agree, but in this case it's done to prevent further problems, and the user would be informed that their choice was not being taken into account. Of course, I would rather respect user choice. If it is confirmed that there is no problem with compiling qBittorrent with a later C++ standard than libtorrent/boost, we can do that.

> > PS: This PR solves the cmake_minimum_required() >= 3.15 slow compilation issue for me.
> 
> What OS/compiler do you use?
> It really annoys me why it's so much slower than QMake+JOM for me (Windows 10 x64, Qt 5.14, MSVC2017).

Not them, but for reference, my environment is: Windows 10 1909 latest updates, MSVC2019 latest updates, Qt 5.14.2/Qt 5.12.8, CMake 3.17.2. Basically a Windows 10 dev VM (https://developer.microsoft.com/en-us/windows/downloads/virtual-machines/), but I also downloaded the latest CMake version (IIRC the one that comes with the VM is 3.16.x)."
625231765,12746,zywo,2020-05-07T12:42:53Z,"> 
> 
> > PS: This PR solves the cmake_minimum_required() >= 3.15 slow compilation issue for me.
> 
> What OS/compiler do you use?
> It really annoys me why it's so much slower than QMake+JOM for me (Windows 10 x64, Qt 5.14, MSVC2017).

Arch Linux:
Qt 5.14.2
gcc 9.3.0
CMake 3.17.2

Debian Unstable:
Qt 5.12.5
gcc 9.3.0
CMake 3.16.3"
625239324,12746,glassez,2020-05-07T12:58:12Z,">my environment is: Windows 10 1909 latest updates, MSVC2019 latest updates, Qt 5.14.2/Qt 5.12.8, CMake 3.17.2. 

Can you compare compilation speed between CMake (with and without these changes) and QMake?"
625390252,12746,FranciscoPombal,2020-05-07T17:23:24Z,"@glassez 

> Can you compare compilation speed between CMake (with and without these changes) and QMake?

Just tested, QMake clocked about 3:15 (this result is only meaningful in comparison to https://github.com/qbittorrent/qBittorrent/pull/12746#discussion_r420873722), which I'd say is about on par with the others. The changes to CMake don't make much difference (or they are within margin of error of my benchmark). I tried to keep the environment as clean as possible for every benchmark run. No weird WIndows background stuff going on, clean command prompts each time, nothing else running at the same time. I think that's acceptable."
625814423,12746,FranciscoPombal,2020-05-08T13:25:14Z,"Well, guess I'll have to rebase on top of https://github.com/qbittorrent/qBittorrent/pull/12779 once that's merged."
625951633,12746,Kolcha,2020-05-08T18:23:44Z,"tried to build this on macOS, faced next issues:

First of all, it **requires QtDBus**, previously that was optional (what I think is more correct)
```
CMake Error at /Users/nick/Documents/Qt/qbt/ext/lib/cmake/Qt5/Qt5Config.cmake:28 (find_package):
  Could not find a package configuration file provided by ""Qt5DBus"" with any
  of the following names:

    Qt5DBusConfig.cmake
    qt5dbus-config.cmake

  Add the installation prefix of ""Qt5DBus"" to CMAKE_PREFIX_PATH or set
  ""Qt5DBus_DIR"" to a directory containing one of the above files.  If
  ""Qt5DBus"" provides a separate development package or SDK, be sure it has
  been installed.
Call Stack (most recent call first):
  src/CMakeLists.txt:9 (find_package)
```
Found because I build Qt without QtDBus module for macOS (yes, it is available even in official installation, but it completely useless, because there is no server side).
D-Bus is Linux-only system, there is no such thing on macOS, maybe this can be installed through Homebrew or other similar ways trying to get Linux environment on macOS.

Next issue is even more strange - it **asks for X11**... previous implementation didn't ask such things.
```
CMake Error at /Users/nick/Qt/Tools/CMake/CMake.app/Contents/share/cmake-3.16/Modules/FindPackageHandleStandardArgs.cmake:146 (message):
  Could NOT find X11 (missing: X11_X11_INCLUDE_PATH X11_X11_LIB)
Call Stack (most recent call first):
  /Users/nick/Qt/Tools/CMake/CMake.app/Contents/share/cmake-3.16/Modules/FindPackageHandleStandardArgs.cmake:393 (_FPHSA_FAILURE_MESSAGE)
  /Users/nick/Qt/Tools/CMake/CMake.app/Contents/share/cmake-3.16/Modules/FindX11.cmake:366 (find_package_handle_standard_args)
  src/gui/CMakeLists.txt:227 (find_package)
```
many years ago there was possibility to install X11 on macOS, but that gone long time ago...
again, looks like some remnants of Homebrew...

successfully overcame these issues adding `-DDBUS=OFF -DPOWER_MANAGEMENT=OFF` to cmake arguments. there were no such issues with previous implementation.

good news that **libtorrent was detected** as expected, NO any [tricks](https://github.com/qbittorrent/qBittorrent/wiki/Compilation-guide-for-macOS-systems#building-qbittorrent) are required.

what about app bundle content, it is the same as it was in previous implementation - it contains app/file icons, Qt translations, and executable itself (+ Info.plist, but this required component).
Qt runtime deployment is required (expected, I don't think that such task is a part of build stage).

cmake command line is the same as in [updated Wiki page](https://github.com/qbittorrent/qBittorrent/wiki/Compilation-guide-for-macOS-systems). ready to test any new changes."
626009612,12746,Kolcha,2020-05-08T20:37:21Z,"I noticed concerns about performance, so I decided to test this on macOS. everything was tested on the same hardware, with the same libraries and same features set (e.g. WebUI, stacktrace, etc.). commit used for previous implementation testing is the start point of this branch, at the moment of writing it was ccb9cc632ec530e6824b60d4c7dd4a2c84a867db, so results must be fair. there are some results:
build system | build time 1 | build time 2
-------------|--------------|-------------
cmake (this PR) | 3:46.71 | 3:40.87
qmake | 4:49.64 | 4:43.68
cmake (previous) | 8:04.80 | 7:59.72

I tested each option twice, each time waited some time until CPU temperature become normal. as you can see, this cmake implementation ~1.5x faster than qmake and ~2x faster than previous one.

I noticed slightly strange thing: executable file size varies depending on build system, qmake produces lightest, and this cmake implementation produces heaviest (but very close to previous implementation). I thought that qmake just strips executable, but it is not:
build system | not stripped | stripped
-------------|--------------|---------
cmake (this PR) | 18.1 MiB (19 003 840) | 15.2 MiB (15 929 832)
cmake (previous) | 17.9 MiB (18 811 336) | 15.0 MiB (15 737 312)
qmake | 14.4 MiB (15 149 528) | 11.5 MiB (12 076 512)

as you can see, difference between executables produced by cmake and qmake is significant - about 4 MiB. I didn't analyze compiler flags in both cases yet, I'll do it later, this is just a statistic."
626092396,12746,FranciscoPombal,2020-05-09T02:38:06Z,"@Kolcha thanks for the feedback. I will attempt to address the macOS concerns you mentioned later.

> good news that **libtorrent was detected** as expected

Currently this only happens if libtorrent was also built with CMake because the needed CMake scripts will get picked up by the `CMAKE_PREFIX_PATH` (or alternatively but slightly different, `LibtorrentRasterbar_ROOT`) passed to qBittorrent.
I think it is reasonable to expect libtorrent to be built with CMake, but if I have time and if it is not too messy, I'll add a fallback to cover the case where libtorrent was not built with CMake on Windows. For linux I expect to be able to use the `pkg-config` method mentioned above, which I have yet to test.

So far it looks like the current changes work well on Windows with or without vcpkg, but I still have some things to test out.

About the compilation speed and binary sizes difference:

- Not sure why you're getting such a huge discrepancy on compile times. Could it be Probably some macOS oddity? Either way, not a problem since this version is the fastest
- The differences in binary sizes could be due to a multitude of things. If someone has a suggestion of how to remove the extra weight, that would be great, but if not I don't think an extra 4 MiB is a big concern.

Right now I also have to fix an issue that I can currently reproduce on Windows and Linux: In the about dialog, the ""Special Thanks"", ""Translators"" and ""License"" tabs are blank."
626190582,12746,FranciscoPombal,2020-05-09T15:13:15Z,@Kolcha the macOS issue you reported should be fixed.
626194051,12746,FranciscoPombal,2020-05-09T15:38:32Z,Rebased accumulated fixes + https://github.com/qbittorrent/qBittorrent/pull/12779
626203047,12746,FranciscoPombal,2020-05-09T16:39:55Z,"> Right now I also have to fix an issue that I can currently reproduce on Windows and Linux: In the about dialog, the ""Special Thanks"", ""Translators"" and ""License"" tabs are blank.

~I'm also getting warnings in the execution log about failure to load translations. Looks like I'll have to address translations and resources in this PR after all.~ https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-627008548"
626230507,12746,Kolcha,2020-05-09T20:21:49Z,"> @Kolcha the macOS issue you reported should be fixed.

checked, now everything is fine, no mentioned workarounds are required. cmake command line exactly the same as in Wiki page, no any additional options. 👍 "
627008548,12746,FranciscoPombal,2020-05-11T22:55:41Z,"> I'm also getting warnings in the execution log about failure to load translations. Looks like I'll have to address translations and resources in this PR after all.

This is the translation error I was getting:

> Couldn't load Web UI translation for selected locale (en).

However, I'm also getting this error both in the release builds as well as latest master.
It only happens when language is set to `English` and does not seem to be of any consequence. Just a heads up.

So, I've addressed the remaining resource bugs and left the translation stuff as-is in the end.

@Kolcha 
Two questions about building in macOS:

- What is the final directory structure of the build directory on macOS? Do you get the qBittorrent executable and `.pdb` at top level, in a separate folder, or what? I just want to know if it's ""sane"".

- Does `sudo cmake --install $your_build_directory` work (you might need `sudo`)? If so, what does it do?"
627232816,12746,Kolcha,2020-05-12T09:44:19Z,">     * What is the final directory structure of the build directory on macOS?

at top level build directory has next content:
```
-rw-r--r--   1 nick  staff  24834 May 12 11:48 CMakeCache.txt
drwxr-xr-x  13 nick  staff    416 May 12 11:52 CMakeFiles
-rw-r--r--   1 nick  staff   9921 May 12 11:48 Makefile
-rw-r--r--   1 nick  staff   1727 May 12 11:48 cmake_install.cmake
drwxr-xr-x   6 nick  staff    192 May 12 11:48 dist
drwxr-xr-x   3 nick  staff     96 May 12 11:48 qbittorrent.app
drwxr-xr-x  10 nick  staff    320 May 12 11:48 src
```
as you can see, app bundle is here. there is no .pdb file, such files are Win-only. on *nix platforms debug symbols usually built-in in the binary, but they can be extracted. this is possible on Linux, know nothing about macOS, never saw macOS app with separate debug symbols, but some time ago Qt was shipped with frameworks which had dbgSym suffix, but now it has debug version of libraries, so maybe it was unusual.



>     * Does `sudo cmake --install $your_build_directory` work (you might need `sudo`)? If so, what does it do?

tried this without `sudo` (I never run suspicious things with `sudo`, especially something containing ""install""), got next output (I expected something similar, but not so strange):
```
nick@Nicks-MacBook-Pro ~/tmp/fork/qBittorrent/build % ~/Qt/Tools/CMake/CMake.app/Contents/bin/cmake --install .
-- Install configuration: ""Release""
-- Installing: /usr/local/./qbittorrent.app
CMake Error at src/app/cmake_install.cmake:36 (file):
  file INSTALL cannot make directory ""/usr/local/./qbittorrent.app"":
  Permission denied.
Call Stack (most recent call first):
  src/cmake_install.cmake:37 (include)
  cmake_install.cmake:37 (include)
```
also tried to change install directory passing `-DCMAKE_INSTALL_PREFIX` to cmake before build, and set it to user-writable directory. as expected, app was ""installed"", it just copied app bundle to destination directory, nothing more. Qt frameworks were not integrated into it (`macdeployqt` was not called). I think, install step is completely useless in case of macOS, macOS apps are ""portable"" by its nature.

only one thing I want to note, that this ""install step"" produces very strange paths (note dot in them):
```
-- Installing: /Users/nick/tmp/q/./qbittorrent.app
-- Installing: /Users/nick/tmp/q/./qbittorrent.app/Contents
-- Installing: /Users/nick/tmp/q/./qbittorrent.app/Contents/MacOS
-- Installing: /Users/nick/tmp/q/./qbittorrent.app/Contents/MacOS/qbittorrent
-- Installing: /Users/nick/tmp/q/./qbittorrent.app/Contents/Resources
-- Installing: /Users/nick/tmp/q/./qbittorrent.app/Contents/Resources/qbittorrent_mac.icns
```
I passed this ""dot"" as argument for this ""install"" (according to `$your_build_directory` placeholder), `/Users/nick/tmp/q` was passed to `-DCMAKE_INSTALL_PREFIX`. so, I think this argument is not a path to build directory, this a path where to install relative to install `CMAKE_INSTALL_PREFIX` (e.g. `usr/lib` in case of libs), but this is offtopic."
627236948,12746,FranciscoPombal,2020-05-12T09:52:30Z,"@Kolcha Thanks for the detailed reply

> at top level build directory has next content:

Nice, looks good.

>as expected, app was ""installed"", it just copied app bundle to destination directory, nothing more. Qt frameworks were not integrated into it (`macdeployqt` was not called). I think, install step is completely useless in case of macOS, macOS apps are ""portable"" by its nature.

Sorry, I don't know what `macdeployqt` is or does. Do we need it? Are you saying that the `.app` is already fully runnable from any directory anyway?

so, I think this argument is not a path to build directory, this a path where to install relative to install `CMAKE_INSTALL_PREFIX` (e.g. `usr/lib` in case of libs), but this is offtopic.

You are correct. Apparently on macOS it defaults to `/usr/local/`. The dot just means `current directory`, right? So it should not matter. Or are you saying that passing the `.` to `cmake --install` resulted in a path with a directory literally named `.`?"
627258479,12746,Kolcha,2020-05-12T10:33:46Z,"> I don't know what `macdeployqt` is or does. Do we need it? Are you saying that the `.app` is already fully runnable from any directory anyway?

if Qt is build dynamically (usually), `macdeployqt` embeds required Qt frameworks (aka libs, but actually they are directories like app bundle) into app bundle. without running it, app bundle can't be launched just due to the lack of Qt runtime in it. moreover, `macdeployqt` slightly modifies executable to change links to dependencies (i.e. Qt) to Frameworks directory inside app bundle.
in case of qBittorrent even OpenSSL libraries are copied alongside with Qt (maybe because Qt depend on it). also it copies essential Qt plugins (e.g. platform-specific, 'cocoa' in case of macOS).
note the app bundle content difference. app bundle content befor running `macdeployqt`:
```
-rw-r--r--   1 nick  staff  2871 May 12 11:48 Info.plist
drwxr-xr-x   3 nick  staff    96 May 12 11:52 MacOS
drwxr-xr-x   5 nick  staff   160 May 12 11:52 Resources
drwxr-xr-x  30 nick  staff   960 May 12 11:52 translations
```
and after running it (Frameworks directory appears):
```
drwxr-xr-x  12 nick  staff   384 May 12 13:18 Frameworks
-rw-r--r--   1 nick  staff  2871 May 12 11:48 Info.plist
drwxr-xr-x   3 nick  staff    96 May 12 13:18 MacOS
drwxr-xr-x   8 nick  staff   256 May 12 13:18 PlugIns
drwxr-xr-x   5 nick  staff   160 May 12 11:52 Resources
drwxr-xr-x  30 nick  staff   960 May 12 11:52 translations
```
it also generates `qt.conf`. on Windows, similar tool called `windeployqt` generates even Qt translations (includes only required by modules used in your app), but `macdeployqt` doesn't do this for some reason...

this is required only in case of dynamic Qt, in case of static build this not required. building dynamic Qt is my preference, I had a lot of issues with Qt 5 since its beginning, at least on Windows, and they a gone with dynamic Qt. maybe now everything is fine, but I don't like static linking in general (but there are few cases when I prefer static linking).

in any case, I don't think that running `macdeployqt` (or own implementation of similar things) must be a part of some build step. end user (aka ""builder"") should decide what and how to use.


> The dot just means `current directory`, right? So it should not matter. Or are you saying that passing the `.` to `cmake --install` resulted in a path with a directory literally named `.`?

you are right. everything is fine, dot just was ignored as in any other *nix shells, and I got app bundle where was expected."
627295867,12746,FranciscoPombal,2020-05-12T11:53:21Z,"@Kolcha So, just to be clear: right now, the `.app` bundle gets generated correctly, and if the user so chooses, they can run `macdeployqt` manually afterwards and will work?

If so, I'd say macOS support is good enough for now then."
627300664,12746,Kolcha,2020-05-12T12:04:56Z,"> right now, the `.app` bundle gets generated correctly, and if the user so chooses, they can run `macdeployqt` manually afterwards and will work?

you are completely right. I'm using app build from this branch. I successfully downloaded few torrents using it."
627630548,12746,FranciscoPombal,2020-05-12T22:23:05Z,"@eli-schwartz it should now be possible to find libtorrent via pkg-config. Mind giving this a spin? On my system, it seems to use the exact same build flags as with the native cmake config file (but in slightly different order in the command line)."
627660461,12746,FranciscoPombal,2020-05-12T23:51:44Z,"@zeule 
> This is silly. Wrap it up in a find module here, or make a PR to libtorrrent (there is one there).

I don't think this is small or generic enough to be factored out to a module. Besides a `Find` module here is just another script that has to be maintained. This code's intention is: ""try to find libtorrent's _generated_ target configuration, either via cmake or pkg-config, if available, and rely on that completely. Nothing else is acceptable, including ""guessing"" a default set of definitions"". If `b2` were capable of generating similar information, I guess I'd add a fallback for that too, but AFAIK that's not the case.

I think if a user is at a point where they need more than this to find libtorrent, they are better off grabbing the `FindLibtorrent.cmake` module directly from libtorrent's examples dir, or manually specifying all libtorrent target variables or something.
Perhaps I should introduce a feature called `CUSTOM_LIBTORRENT` that facilitates this? If you think there's anything getting in the way of that right now."
629564830,12746,FranciscoPombal,2020-05-16T00:58:55Z,"Alright, at this point I have tested everything on Windows that needed to be tested IMO. In particular, I tried the following, successfully:

- Followed the steps at https://github.com/qbittorrent/qBittorrent/wiki/Compiling-with-MSVC-2019-(static-linkage) (which is basically the same as the official MSVC2017 method but with some version bumps for convenience when using the latest toolchain) to compile every dependency **except** `libtorrent`.
- Instead of compiling `libtorrent` like in the tutorial, I did the equivalent CMake build:
    ```
    cd libtorrent
    cmake -S . -B cmake-build-dir -DCMAKE_CXX_STANDARD=14 -Ddeveloper-options=ON -Ddeprecated-functions=OFF -Dstatic_runtime=ON -DBUILD_SHARED_LIBS=OFF -DCMAKE_PREFIX_PATH=G:\QBITTORRENT\install_msvc64\base -DBoost_ROOT=G:\QBITTORRENT\boost_1_72_0\stage -DCMAKE_INSTALL_PREFIX=G:\QBITTORRENT\install_msvc64\base
    cmake --build .\cmake-build-dir\ --config RelWithDebInfo && cmake --install .\cmake-build-dir\ --config RelWithDebInfo
    ```
    This is so that the `libtorrent` build produces the needed CMake config files to use in the actual qBIttorrent compilation.
- Compiled qBittorrent itself using the manually-built dependencies:
    ```
    cd qBittorrent
    cmake -S . -B build -DVERBOSE_CONFIGURE=ON -DCMAKE_PREFIX_PATH=G:\QBITTORRENT\install_msvc64\base -DBoost_ROOT=G:\QBITTORRENT\boost_1_72_0\stage -DBoost_USE_STATIC_RUNTIME=ON -DQt5_DIR=G:\QBITTORRENT\install_msvc64\qt5\lib\cmake\Qt5
    cmake --build .\build\ --config RelWithDebInfo
    ```

and... it worked! Note that other configure flag combinations would have achieved the same result; for instance, you could use the necessary OpenSSL, Libtorrent and possibly zlib hints instead of `CMAKE_PREFIX_PATH`.

This is just to prove that the new scripts are not dependent on the usage of `vcpkg` or anything like that. The user can manually specify the paths to the dependency artifacts in the command-line and it will build just fine. The only requirement is that libtorrent is built with the CMake method, so that it produces the necessary CMake configuration files.

The best thing is that one can even ""fly blind"", because CMake holds your hand and gives useful suggestions. For example, suppose that after building the required dependencies, you were trying to build qBittorrent (but did not know how to) and started with this:

```
cd qBittorrent
cmake -S . -B build -DVERBOSE_CONFIGURE=ON
```

CMake would then complain ""Could not find package XYZ, please specify `Xyz_DIR` blah blah"". You add what it asks for and run it again (let's say it was `Qt5`):

```
cmake -S . -B build -DVERBOSE_CONFIGURE=ON -DQt5_DIR=/path/to/directory/of/Qt5Config.cmake
```

Then the process repeats for each required package, until the configure is successful.
Then the build can actually be executed:

```
cmake --build .\build\ --config RelWithDebInfo
```

Note that in all of these examples I did not specify a generator. Since this was tested on an x64 Windows installation with MSVC2019, this is equivalent to `-G ""Visual Studio 16 2019"" -A x64`. I also tested with `-G ""Ninja Multi-Config""`, `-G ""Ninja""` and `-G ""NMake Makefiles JOM""`. Note that in the latter 2 cases, the `--config` flag at build/install time is ignored due to them being single config generators, so one must specify the build config with `-DCMAKE_BUILD_TYPE` at configure time.

One cool thing that the CMake scripts now easily enable, it the possibility of using dependencies from different sources very 

In summary, these are the advantages that CMake scripts at this point over qmake:

- Feedback-rich configure step
- No need to manually edit files - all useful configuration options can be specified via the command line.
- Integrates well with modern ""dependency package managers"" like `vcpkg`
- At least as fast

and vs. the current CMake setup:

- Simpler and cleaned up (and thus more readable and easily understandable for further development)
- Usability improvements
- Less surprising behavior
- Easier to further evolve to a more target-based architecture

Right now there are still two outstanding TODOs:
- The libtorrent C++ standard ABI compatibility question (could allow dropping another file)
- The version bumps. Though, to be fair, at this point I'll probably just leave them in, and wait out for things like `RC_1_1` support removal, Qt 5.15 (because it makes OpenSSL 1.1.1 mandatory), and for people to realize that boost <1.60 is irrelevant because it hasn't been used for official Windows/macOS builds in a very long time, and we don't even support Debian/Ubuntu releases that support such old boost versions.

After that, this PR will exit draft and will be ready to be properly reviewed and merged. I'll probably need to split this up into multiple commits as well."
643769023,12746,jagannatharjun,2020-06-14T13:47:55Z,"man this PR made cmake compilation more then 2 times faster and I double checked it 

# https://github.com/qbittorrent/qBittorrent/commit/9dfeeb9e81475bac465ebf9842d19783e8c10ff4r

kernal time: 1.468750
user time: 1.515625
total time: 239.215759

# this PR based on  https://github.com/qbittorrent/qBittorrent/commit/9dfeeb9e81475bac465ebf9842d19783e8c10ff4r

kernal time: 2.312500
user time: 1.515625
total time: 98.949888

though I did make following changes to make it compile based on upstream but I don't see it affecting compile time though
```diff
diff --git a/src/gui/rss/articlelistwidget.cpp b/src/gui/rss/articlelistwidget.cpp
index 7ce1115e9..2b58f8e33 100644
--- a/src/gui/rss/articlelistwidget.cpp
+++ b/src/gui/rss/articlelistwidget.cpp
@@ -33,7 +33,7 @@
 #include ""base/global.h""
 #include ""base/rss/rss_article.h""
 #include ""base/rss/rss_item.h""
-#include ""uithememanager.h""
+#include ""../uithememanager.h""

 ArticleListWidget::ArticleListWidget(QWidget *parent)
     : QListWidget(parent)
```"
643774997,12746,jagannatharjun,2020-06-14T14:34:37Z,"> man this PR made cmake compilation more then 2 times faster and I double checked it
> 
> # [9dfeeb9](https://github.com/qbittorrent/qBittorrent/commit/9dfeeb9e81475bac465ebf9842d19783e8c10ff4r)
> kernal time: 1.468750
> user time: 1.515625
> total time: 239.215759
> 
> # this PR based on [9dfeeb9](https://github.com/qbittorrent/qBittorrent/commit/9dfeeb9e81475bac465ebf9842d19783e8c10ff4r)
> kernal time: 2.312500
> user time: 1.515625
> total time: 98.949888
> 
> though I did make following changes to make it compile based on upstream but I don't see it affecting compile time though
> 
> ```diff
> diff --git a/src/gui/rss/articlelistwidget.cpp b/src/gui/rss/articlelistwidget.cpp
> index 7ce1115e9..2b58f8e33 100644
> --- a/src/gui/rss/articlelistwidget.cpp
> +++ b/src/gui/rss/articlelistwidget.cpp
> @@ -33,7 +33,7 @@
>  #include ""base/global.h""
>  #include ""base/rss/rss_article.h""
>  #include ""base/rss/rss_item.h""
> -#include ""uithememanager.h""
> +#include ""../uithememanager.h""
> 
>  ArticleListWidget::ArticleListWidget(QWidget *parent)
>      : QListWidget(parent)
> ```

@FranciscoPombal @glassez I think speed improvements should be enough to reconsider this PR if possible, "
643776513,12746,FranciscoPombal,2020-06-14T14:45:49Z,"@jagannatharjun

This PR has never stopped being considered (at least for me), it's just that it has been stuck in `find_package()` flamewar purgatory (besides the 2 outstanding items in the OP checklist that also need to be addressed). Now I'm just waiting for an authoritative decision from the members with merging rights (https://github.com/qbittorrent/qBittorrent/pull/12746#discussion_r431213529, https://github.com/qbittorrent/qBittorrent/pull/12746#discussion_r433549825).

The speed improvements are just the cherry on top - as far as speed goes, I was only concerned with making it ""at least as fast as previously"". The great benefit of this PR (and its original purpose), in my opinion, is the architectural improvements, simplification, and more usage of more modern CMake features, that will enable further enhancements still in the future. The end goal is of course to further flesh it out to truly replace autotools and the current manually-done release procedure, including generation of the NSIS installer for Windows, for example."
643779347,12746,zywo,2020-06-14T15:07:30Z,"For me, this PR solved 3 issues encountered in current master. "
643779810,12746,jagannatharjun,2020-06-14T15:10:57Z,"@FranciscoPombal you needed to add this too 
```diff
diff --git a/src/base/CMakeLists.txt b/src/base/CMakeLists.txt
index 1b30c3972..e9b8575de 100644
--- a/src/base/CMakeLists.txt
+++ b/src/base/CMakeLists.txt
@@ -162,7 +162,7 @@ target_link_libraries(qbt_base
         ZLIB::ZLIB
     PUBLIC
         LibtorrentRasterbar::torrent-rasterbar
-        Qt5::Core Qt5::Network Qt5::Xml
+        Qt5::Core Qt5::Network Qt5::Xml Iphlpapi
 )
```
It may not be the correct place to add the library I just wanted to make it compile 

also, I am getting this linker warning 
> LIBCMTD.lib(initializers.obj) : warning LNK4098: defaultlib 'msvcrtd.lib' conflicts with use of other libs; use /NODEFAULTLIB:library


"
643780349,12746,FranciscoPombal,2020-06-14T15:15:40Z,"@zywo 

> For me, this PR solved 3 issues encountered in current master.

Can you please elaborate on what these specific issues are, or link to relevant comments, issues?"
643787666,12746,zywo,2020-06-14T16:11:22Z,"> @zywo
> 
> > For me, this PR solved 3 issues encountered in current master.
> 
> Can you please elaborate on what these specific issues are, or link to relevant comments, issues?

All these issues are about the compilation slow.
1- cmake_minimum_required >= 3.15;
2- On Arch Linux, with current master, I have to force CMake to look in /usr/include instead of /usr/lib64/cmake to find boost;

I don't remember the third one."
644322615,12746,FranciscoPombal,2020-06-15T19:07:07Z,"@jagannatharjun 

> though I did make following changes to make it compile based on upstream but I don't see it affecting compile time though
> 
> ```diff
> diff --git a/src/gui/rss/articlelistwidget.cpp b/src/gui/rss/articlelistwidget.cpp
> index 7ce1115e9..2b58f8e33 100644
> --- a/src/gui/rss/articlelistwidget.cpp
> +++ b/src/gui/rss/articlelistwidget.cpp
> @@ -33,7 +33,7 @@
>  #include ""base/global.h""
>  #include ""base/rss/rss_article.h""
>  #include ""base/rss/rss_item.h""
> -#include ""uithememanager.h""
> +#include ""../uithememanager.h""
> 
>  ArticleListWidget::ArticleListWidget(QWidget *parent)
>      : QListWidget(parent)
> ```

Rebased and fixed."
644592640,12746,glassez,2020-06-16T07:42:14Z,"@FranciscoPombal, you still need to fix the issues that are mentioned in https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-643779810. Build failing on Link step."
645503725,12746,FranciscoPombal,2020-06-17T17:10:43Z,"@jagannatharjun @glassez 

> @FranciscoPombal you needed to add this too
> 
> ```diff
> diff --git a/src/base/CMakeLists.txt b/src/base/CMakeLists.txt
> index 1b30c3972..e9b8575de 100644
> --- a/src/base/CMakeLists.txt
> +++ b/src/base/CMakeLists.txt
> @@ -162,7 +162,7 @@ target_link_libraries(qbt_base
>          ZLIB::ZLIB
>      PUBLIC
>          LibtorrentRasterbar::torrent-rasterbar
> -        Qt5::Core Qt5::Network Qt5::Xml
> +        Qt5::Core Qt5::Network Qt5::Xml Iphlpapi
>  )
> ```
> 
> It may not be the correct place to add the library I just wanted to make it compile

> @FranciscoPombal, you still need to fix the issues that are mentioned in #12746 (comment). Build failing on Link step.

Took me a while to reproduce it, but I managed to do it - the problem was non-static builds. The fix I applied was similar to the proposed patch, except limited to Windows-only and `PRIVATE` instead of `PUBLIC` (because there is no need to be `PUBLIC`).

> also, I am getting this linker warning
> 
> > LIBCMTD.lib(initializers.obj) : warning LNK4098: defaultlib 'msvcrtd.lib' conflicts with use of other libs; use /NODEFAULTLIB:library

I can't reproduce this one, either with the traditional Wiki procedure or using `vcpkg` (any `x64-*` triplet). You are most likely mixing debug and non-debug versions of a library inadvertently."
645636277,12746,zywo,2020-06-17T21:32:07Z,"Just a reminder:
`LibtorrentRasterbar_DIR` option is not reconfigurable via `ccmake .` when it was first configured with `cmake` command line."
645667005,12746,FranciscoPombal,2020-06-17T22:52:14Z,"@zywo 

> Just a reminder:
> `LibtorrentRasterbar_DIR` option is not reconfigurable via `ccmake .` when it was first configured with `cmake` command line.

1. Was it possible before?
2. Should this be possible now? If so, how?"
645697330,12746,zywo,2020-06-18T00:29:00Z,"> @zywo
> 
> > Just a reminder:
> > `LibtorrentRasterbar_DIR` option is not reconfigurable via `ccmake .` when it was first configured with `cmake` command line.
> 
>     1. Was it possible before?
> 
>     2. Should this be possible now? If so, how?

Your questions are about master branch or this PR?"
645699218,12746,FranciscoPombal,2020-06-18T00:35:43Z,"@zywo 

""Before"" means ""master"", ""now"" means ""this PR""."
645977895,12746,zywo,2020-06-18T12:12:27Z,"> @zywo
> 
> ""Before"" means ""master"", ""now"" means ""this PR"".

We have two options with master:
`LibtorrentRasterbar_INCLUDE_DIR` and `LibtorrentRasterbar_LIBRARY` both are reconfigurable with `ccmake .`

Now, we have only one option:
`LibtorrentRasterbar_DIR` which is reconfigurable with `ccmake .` only if this option was not passed to `cmake` command line the first time."
649142411,12746,FranciscoPombal,2020-06-25T00:23:25Z,"@zywo

> We have two options with master:
> `LibtorrentRasterbar_INCLUDE_DIR` and `LibtorrentRasterbar_LIBRARY` both are reconfigurable with `ccmake .`
> 
> Now, we have only one option:
> `LibtorrentRasterbar_DIR` which is reconfigurable with `ccmake .` only if this option was not passed to `cmake` command line the first time.

Just tried to reproduce on my machine (even before this latest commit), and either I can't reproduce or I'm not fully understanding the problem. If CMake finds libtorrent (i.e., if find_package is successful), `LibtorrentRasterbar_DIR` is always set to the directory where CMake found it, regardless of of whether or not you specified it in the command line (if there is more than one valid choice, you can edit the variable to choose between them; by default, CMake will choose the most specific alternative according to the search procedure outlined in https://cmake.org/cmake/help/latest/command/find_package.html#search-procedure). If it doesn't find it, you can edit `LibtorrentRasterbar_DIR` with `ccmake` just fine, again, regardless of of whether or not you specified it in the command line initially."
649508273,12746,zywo,2020-06-25T12:23:46Z,"The problem is when you pass `-DLibtorrentRasterbar_DIR` to cmake command line, for example: 
`cmake -DLibtorrentRasterbar_DIR=~/build/libt/LibtorrentRasterbar/ ~/qbittorrent_cmake/`

Then this option is not reconfigurable via `ccmake .`"
649523506,12746,FranciscoPombal,2020-06-25T12:56:41Z,"@zywo 

Let me try to explain more clearly:

I could reconfigure `LibtorrentRasterbar_DIR` just fine in any case, as long as it's a _valid_ directory.

Suppose I have two valid cmake config files directories for libtorrent at the locations `/usr/local/lib/cmake/LibtorrentRasterbar` and `~/Documents/libtorrent/cmake-build-dir/RelWithDebInfo/LibtorrentRasterbar`. When I first run configure and then `ccmake` to examine the generated config, I observe that `LibtorrentRasterbar_DIR` is set to `/usr/local/lib/cmake/LibtorrentRasterbar`, because that is the most specific that CMake found on my system according to the documented search procedure. So far, so good.

I can then change it within `ccmake` to `~/Documents/libtorrent/cmake-build-dir/RelWithDebInfo/LibtorrentRasterbar`, press `c` to (re)configure, and `ccmake` will show that `LibtorrentRasterbar_DIR` has changed to the new value.

However, if I set `LibtorrentRasterbar_DIR` to an _invalid_ value, say `/opt/does-not-exist` and press `c`, it will automatically reset the value of `LibtorrentRasterbar_DIR` back to `/usr/local/lib/cmake/LibtorrentRasterbar` - maybe you were not expecting this?

Either way, this is the same regardless of whether or not I passed  `LibtorrentRasterbar_DIR` in the initial `cmake` command line."
649821459,12746,zywo,2020-06-25T21:15:44Z,But if you first run `cmake ~/Documents/libtorrent/cmake-build-dir/RelWithDebInfo/LibtorrentRasterbar ~/qbittorrent_cmake` you cannot change it with `ccmake .` because the option is not present in the dialog.
651426132,12746,FranciscoPombal,2020-06-29T23:45:01Z,"@zywo 

> But if you first run `cmake ~/Documents/libtorrent/cmake-build-dir/RelWithDebInfo/LibtorrentRasterbar ~/qbittorrent_cmake` you cannot change it with `ccmake .` because the option is not present in the dialog.

I'm sorry, I don't quite understand what you mean by this command-line. You are specifying 2 directories as positional arguments, this is almost certainly not doing what you want or what you think it is doing. Usually the way you would invoke CMake for building qBittorrent (or anything) would be `cmake -S path/to/source/dir -B path/to/build/dir`, or `cd path/to/build/dir && cmake path/to/source/dir`(*). In both these circumstances it will be possible to configure `LibtorrentRasterbar_DIR` as described in https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-649523506.

(*)there is also a third way, `cmake path/to/build/dir`, but this requires a `CMakeCache.txt` generated by a previous run of CMake from which to read the path to the source dir to be present in that directory."
651760248,12746,zywo,2020-06-30T12:29:47Z,"Sorry, it should be:
`cmake -DLibtorrentRasterbar_DIR=~/build/libtorrent/LibtorrentRasterbar ~/qbittorrent_sources`"
652331113,12746,FranciscoPombal,2020-07-01T10:17:18Z,"@zywo 

> Sorry, it should be:
> `cmake -DLibtorrentRasterbar_DIR=~/build/libtorrent/LibtorrentRasterbar ~/qbittorrent_sources`

Ok, I can indeed reproduce that. But it looks like simply adding the type makes it work: `cmake -DLibtorrentRasterbar_DIR:PATH=~/build/libtorrent/LibtorrentRasterbar ~/qbittorrent_sources`. I investigated the generated CMake cache in both cases, and it seems the problem is the CMake GUIs don't expose `UNINITIALIZED` variables for the user to change.

I pushed a  new commit to make it so that CMake always knows `LibtorrentRasterbar_DIR` is a `PATH`, by setting it as a `CACHE` variable. Now, even if you don't specify the type in the command line, the variable will always show up and be configurable in a GUI such as `ccmake`."
652453467,12746,zywo,2020-07-01T14:30:19Z,"Fixed, thank you."
652537235,12746,FranciscoPombal,2020-07-01T17:00:03Z,"@arvidn

If libtorrent and boost are both compiled with C++ standard X, can qBittorrent always be compiled with C++ standard Y > X (and linked with the aforementioned libtorrent and boost compiled and linked with C++ X) without problems? Or should we always guaranteed that the C++ standard is always the same throughout?

This is a question due to a concern in relation to this old comment: https://github.com/qbittorrent/qBittorrent/issues/11879#issuecomment-581599783."
652545649,12746,glassez,2020-07-01T17:16:27Z,"IIRC, the problem is not in C++ standard itself but in the way libtorrent uses it in some particular case. E.g. there were problems in libtorrent-1.1 since it uses c++ built-in types when it is compiled in c++11 and boost types when it is compiled in older c++ and these types are exported and used in libtorrent headers so when qBittorrent uses different c++ standard there are conflicts and unresolved externals."
652551274,12746,FranciscoPombal,2020-07-01T17:28:17Z,"@glassez

> IIRC, the problem is not in C++ standard itself but in the way libtorrent uses it in some particular case. E.g. there were problems in libtorrent-1.1 since it uses c++ built-in types when it is compiled in c++11 and boost types when it is compiled in older c++ and these types are exported and used in libtorrent headers so when qBittorrent uses different c++ standard there are conflicts and unresolved externals.

Thanks for the explanation. I don't suppose this is going to stop being a problem even when using only libtorrent > 1.2, because there is always the possibility that some boost type is used in place of a built-in (`std`) one (or vice-versa) between versions, as libtorrent evolves and picks up features from ever-newer C++ standards. So I guess the best way around this would be to obtain the standard from the usage requirements (if it's possible).

I'll investigate that possibility and take a stab at it. If it's not possible, the current solution is good enough for now. After that, I'll just squash/rearrange the commits and mark this as ready for review."
653153184,12746,FranciscoPombal,2020-07-02T18:15:21Z,"@glassez 

Looks like CMake takes care of the minimum C++ standard for libtorrent behind the scenes with its `INTERFACE_COMPILE_FEATURES`/`INTERFACE_COMPILE_OPTIONS`, depending on whether it was found with CMake or pkg-config, respectively. The value of the `-std` flag passed to the compiler will always be big enough to pass those requirements. 

It would be best to use `target_compile_features` on targets to force minimum language standards and compiler features, rather than relying on always forcing `CMAKE_CXX_STANDARD` to at least the minimum supported version (I think this is somewhat unexpected), or relying on `CMAKE_CXX${_min_std}_STANDARD__HAS_FULL_SUPPORT`, which is can be too limiting.
However, I think this can be addressed in another PR, and then we can also look more closely at potential problems arising from compiling libtorrent with too old/new C++ versions, and what we can do to inform the user of how to proceed in that case.

I'll squash the commits."
653176866,12746,glassez,2020-07-02T19:11:17Z,">However, I think this can be addressed in another PR, and then we can also look more closely at potential problems arising from compiling libtorrent with too old/new C++ versions, and what we can do to inform the user of how to proceed in that case.

:+1:"
653964262,12746,FranciscoPombal,2020-07-06T00:52:05Z,"Alright, just a couple comments left to address. Here is how the linkage dependency graph looks now (`autogen` custom targets suppressed as per the supplied `CMakeGraphVizOptions.cmake` options) on Ubuntu 18.04:

![screenshot](https://user-images.githubusercontent.com/17580742/86546152-33190c80-bf2b-11ea-9b1f-555a6682b0eb.png)"
654147530,12746,glassez,2020-07-06T10:19:44Z,">Fix compilation without COUNTRIES_RESOLUTION

I really don't understand what happens. This is long time existing option. Doesn't it works all that time?
Or maybe its support was removed from the sources and there is just some leftover in configuration files?
@Chocobo1?"
654158340,12746,FranciscoPombal,2020-07-06T10:45:43Z,"@glassez 

> I really don't understand what happens. This is long time existing option. Doesn't it works all that time?
> Or maybe its support was removed from the sources and there is just some leftover in configuration files?
> @Chocobo1?

You can try building with the commit before the `Fix compilation without COUNTRIES_RESOLUTION` commit to look at the errors that popped up. To me it simply looks like that some preprocessor directives were missing, so I fixed that. I then tried building with/without the option, and everything worked correctly (e.g, when off, the setting doesn't show up in the preferences nor does the ""Country/region"" column in the Peers tab). That commit can be extracted to a separate PR, if needed."
654163631,12746,glassez,2020-07-06T10:58:31Z,">That commit can be extracted to a separate PR, if needed.

Yes, please.

I remember it was once discussed that such options that disables all these features (except GUI and maybe STACKTRACE) at compile time do not make much sense for us (besides, they make confusion in the source code and in the WebAPI). I guess we'd better get rid of them after all."
654181327,12746,FranciscoPombal,2020-07-06T11:39:07Z,"@glassez 

> I remember it was once discussed that such options that disables all these features (except GUI and maybe STACKTRACE) at compile time do not make much sense for us (besides, they make confusion in the source code and in the WebAPI). I guess we'd better get rid of them after all.

Yeah I noticed there isn't really a nice way of removing the relevant UI elements from the WebUI when the option is disabled. So we end up with an empty column and checkboxes in the preferences that are clickable but do nothing. To be fair, the latter was already the case with features dependent on libtorrent version. Anyway I'll extract the commit to another PR so we can continue the discussion there."
654197260,12746,Chocobo1,2020-07-06T12:14:25Z,"> 
> 
> > Fix compilation without COUNTRIES_RESOLUTION
> 
> I really don't understand what happens. This is long time existing option. Doesn't it works all that time?
> Or maybe its support was removed from the sources and there is just some leftover in configuration files?
> @Chocobo1?

`COUNTRIES_RESOLUTION` exists in cmake and source code but not in autotools. I would prefer we remove this define/configure option from our codebase."
654206163,12746,FranciscoPombal,2020-07-06T12:32:43Z,"~Not really a blocker, but relevant: https://gitlab.kitware.com/cmake/cmake/-/issues/20921~

~See https://github.com/qbittorrent/qBittorrent/pull/12746#discussion_r450184249. Until the aforementioned issue is fixed, `qt.conf` will not be copied to the correct location in the build tree when using multi-config generators. The copy at install time will still work fine, as before.~

EDIT: fixed."
654237374,12746,glassez,2020-07-06T13:27:21Z,"It becomes really impossible to review this PR. I ask once again:
1. Address all remaining comments,
2. Extract all unclear/questionable changes into separate PRs,
3. Don't produce any new changes especially unrelated (not strictly related)."
657070063,12746,FranciscoPombal,2020-07-11T14:17:37Z,"@glassez

While attempting to solve compilation with MinGW I also made everything more target-based with the help of generator expressions (that commit is not squashed, for now). As a side-effect, the platform-specific requirements for each target are much clearer now; where possible, all the information is conveyed in single `target_*` calls, instead of having to navigate through multiple, scattered, possibly nested `if ()` chains that affect targets everywhere. Note: the only exception is one `include_directories()` statement. I think that's the only directory-scope command left, but I'm ok with that for now.

In the latest force-push I also fixed the `SYSTEMD` feature, which was actually broken before, but that's unrelated.

However, the MinGW compilation is still not fixed. The good news is I think the problem is no longer due to the new changes to the CMake scripts; I'm getting the same error as https://github.com/qbittorrent/qBittorrent/issues/12979#issuecomment-649739966, which I believe the user was having with the previous CMake scripts or even autotools as well. What is the correct way to fix it? Please see the `TODO` at the bottom of the `cmake/Modules/MacroQbtCommonConfig.cmake`.

EDIT: for reference, I'm using the latest x86_64 mingw via msys2"
657215046,12746,glassez,2020-07-12T12:24:52Z,">for reference, I'm using the latest x86_64 mingw via msys2

I'm sorry, it's hard for you to give me a specific version, and you're suggesting that I do the investigation myself?
 I am using version 8.1 32-bit shipped by Qt installer and I have no such problem. I think your problem is in some compile definition the PROCESS_INFORMATION_CLASS is declared under (like MEMORY_PRIORITY_INFORMATION is currently). You can inspect ""winbase.h"" to understand it."
657215318,12746,glassez,2020-07-12T12:27:35Z,"> I also made everything more target-based with the help of generator expressions (that commit is not squashed, for now). As a side-effect, the platform-specific requirements for each target are much clearer now;

Scripts from last commit look much less readable for me..."
657365992,12746,jagannatharjun,2020-07-13T05:26:06Z," > MSYS compilation error

`SetProcessInformation` ( `PROCESS_INFORMATION_CLASS`) is only available on windows 8 and above https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessinformation

but your defines are something like this 
```
            NTDDI_VERSION=0x06010000
            _WIN32_WINNT=0x0601
            _WIN32_IE=0x0601
```
which is Windows 7

but we dynamically load this function anyway, so may your best bet is to define your own enum"
657459434,12746,FranciscoPombal,2020-07-13T09:59:10Z,"@glassez 

> I'm sorry, it's hard for you to give me a specific version, and you're suggesting that I do the investigation myself?

> I am using version 8.1 32-bit shipped by Qt installer and I have no such problem. 

Is it hard for you to help test something for which you seem to be the only interested party here? This PR could just as well be merged without proper MinGW support for all I care (it was surely a happy accident that it worked until now, if that was the case).

I said I used the ""latest versions"" which means:

https://packages.msys2.org/package/mingw-w64-x86_64-gcc?repo=mingw64
https://packages.msys2.org/package/mingw-w64-x86_64-headers-git?repo=mingw64

The versions used were `10.1.0-3` and `8.0.0.5941.736c7a24-1`, respectively, which are still the same at the time of writing.

You didn't give me a version before either, you just said:

> I just install everything needed using official Qt installer. The only thing left for me to build myself (apart from libtorrent and qBittorrent) is a Boost.System (this is not much different from the build using MSVC).

So I assumed you were using something somewhat recent, and that you didn't necessarily mean ""I don't care if it's broken on a more recent version that the special one I currently use"".
Like I said, the problem is the same as https://github.com/qbittorrent/qBittorrent/issues/12979#issuecomment-649739966 which was using also the latest version of MinGW through MSYS2, AFAIK, and has nothing to do with this PR. Don't you think it's a problem if the code builds with a certain version but doesn't build with the latest? We've got to fix that, otherwise we accrue technical debt and get stuck in the past forever.

> I think your problem is in some compile definition the PROCESS_INFORMATION_CLASS is declared under (like MEMORY_PRIORITY_INFORMATION is currently). You can inspect ""winbase.h"" to understand it.

We already include the appropriate headers (see https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessinformation, only `Windows.h` is needed) and there should be no additional compile definitions necessary from what I've seen both in the docs and by inspecting the relevant include files.

> `SetProcessInformation` ( `PROCESS_INFORMATION_CLASS`) is only available on windows 8 and above https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessinformation
> 
> but your defines are something like this
> 
> ```
>             NTDDI_VERSION=0x06010000
>             _WIN32_WINNT=0x0601
>             _WIN32_IE=0x0601
> ```
> 
> which is Windows 7
> 
> but we dynamically load this function anyway, so may your best bet is to define your own enum

Sigh, this is exactly the kind of headache and waste of time I would be expecting for supporting an EOL OS...
Thanks for the heads up, @jagannatharjun.

I guess the solution mentioned in https://github.com/qbittorrent/qBittorrent/issues/12979#issuecomment-649739966 might be the most appropriate after all.

I'm away from the computer I can use to test this right now, though, but I'll look into this further as soon as I can. If someone wants to do so in the meantime, that would be appreciated.

_And please reconsider dropping support for Windows 7 (before or after this PR). Supporting Windows 7 in 2020 is like supporting Windows 98 in 2010 (which, by the way, qBittorrent never actually supported). The 90's were 30 years ago!_
"
657476593,12746,FranciscoPombal,2020-07-13T10:28:55Z,"@glassez 

> Scripts from last commit look much less readable for me...

I assume this complaint refers to the increased use of generator expressions. I agree that generator expressions can be rather... unsightly, but there are some nice benefits of doing it this way.

Now, each target has at most one `target_link_libraries()` call, one `target_compile_definitions()` call, etc (basically, only one call of each of the `target_*` commands per target). No need to hunt down multiple calls of `target_xyz()` inside multiple conditional branches, possibly across multiple CMake files, to figure out the final set of compile defintions, options, etc for a given target in a given configuration/feature selection. Thus, the scripts become more readable and maintainable (despite the fact that generator expressions themselves are not very readable).

For example, to know _all_ the compile definitions of `base`, you just read the _single_ `target_compile_definitions()` call for it and the `INTERFACE`/`PUBLIC` compile definitions of the targets it links to (the latter is easy if the targets `base` links to also have a _single_  `target_compile_definitions()` call, and so forth, recursively). Then, depending on the features selected, compiler used, and OS, you add or subtract the corresponding definitions by looking at the generator expressions inside the call (e.g. if you're on Linux, you can ignore anything resembling `$<AND:$<PLATFORM_ID:Windows>, ...`). Very little imperative logic to reason about.

Additionally, IMO it provides a sort of nice heuristic to reason about complexity, akin to the classic ""if you've got greater than 3 levels of nested loops, it's probably doing to much"":
""if your generator expressions are becoming too long, you probably need to rethink some aspect of your build script"". (this is also an attempt at a preemptive counter-argument against ""this approach does not scale because generator expressions become exponentially unreadable with their length"").

If you look at the build scripts now, the vast majority of the complexity comes from the translation handling and macOS bundle stuff in `src/app`, which has to be done in a complex, imperative way that's hard to follow, but that's mostly Qt's fault. As Qt's CMake support improves with Qt6, I would expect that particular situation to improve, so that that bit can be re-written in a clearer way in the future.
Everything else is easier to follow and reason about, IMO."
657496848,12746,glassez,2020-07-13T11:13:21Z,">Is it hard for you to help test something for which you seem to be the only interested party here? 

Yes, it's hard for me. As I mentioned, I am forced to use MinGW environment not from a good life, but because of a critical lack of computing resources at certain times, so it is impossible for me to rebuild it many times in different ways.
However, I'm not asking you to do any fancy tests or anything like that. I just want you not to break something that worked before. I pointed out the affected places to you.
If you want to personally test it, you are free to install MinGW environment to your liking, I just pointed out to you the method that I use myself as the easiest. If ""Install everything possible using the Qt installer"" is too difficult for you, then you can go another way. Or do not go there at all, but just fix the shortcomings I noticed, which is quite trivial."
657506420,12746,glassez,2020-07-13T11:33:40Z,">I assume this complaint refers to the increased use of generator expressions. I agree that generator expressions can be rather... unsightly, but there are some nice benefits of doing it this way.

As I said before:
>It becomes really impossible to review this PR. 

But instead of simplifying it and dividing it into several parts, you add more and more changes that need to be discussed on their own. It can die without being born..."
657541226,12746,FranciscoPombal,2020-07-13T12:50:07Z,"@glassez 

Force pushed to fix the `qt.conf` problem and building on BSDs.

> If ""Install everything possible using the Qt installer"" is too difficult for you, then you can go another way. Or do not go there at all, but just fix the shortcomings I noticed, which is quite trivial.

The point is that ultimately, we're just putting a band-aid on the problem. Anyway like I said, once I have access to the machine where I can fix it, I will if no one does in the meantime.

> But instead of simplifying it and dividing it into several parts, you add more and more changes that need to be discussed on their own. It can die without being born...

I was also hesitant to make this change now... But among other things, it made it easier to figure out what's wrong with compiling in MinGW and not resorting to blanket `link_libraries` statements. Perhaps I should have kept this as draft for a bit longer, but things like the MinGW problem popped out of the blue.

At least now that all the comments in the review were addressed, I _really_ don't expect anything else to change. I left the generator expressions commit separate (and will keep it so for a while) to make it easier for you and others to see the changes."
664053809,12746,FranciscoPombal,2020-07-26T23:23:42Z,"Rebased + adjusted some indentation here and there.

Also fixed up the latest target_*/generator expression commit by getting rid of the dubiously maintainable and kind of dumb `FunctionQbtCXXCompilerAndModeCheck.cmake` in favor of this much better snippet:

```cmake
# Full C++ 14 support is required
target_compile_features(qbt_common_cfg
    INTERFACE
        cxx_std_14
        cxx_contextual_conversions
        cxx_binary_literals
        cxx_decltype_auto
        cxx_lambda_init_captures
        cxx_generic_lambdas
        cxx_variable_templates
        cxx_relaxed_constexpr
        cxx_attribute_deprecated
        cxx_digit_separators
)
```

This change should have already been there but I forgot about it, sorry about that. Doesn't change anything else though. The list of compile features was obtained by starting with `cxx_std_14` and then adding all the features listed in https://cmake.org/cmake/help/v3.16/prop_gbl/CMAKE_CXX_KNOWN_FEATURES.html#prop_gbl:CMAKE_CXX_KNOWN_FEATURES that correspond to the ones listed in https://gcc.gnu.org/projects/cxx-status.html#cxx14 and https://clang.llvm.org/cxx_status.html#cxx14. Tested, works as expected, and will be easy to work with once we move to require C++17, 20, ... at a minimum.

Tomorrow I should be able to tackle the remaining MinGW issue and wrap this up."
665025357,12746,FranciscoPombal,2020-07-28T13:01:33Z,"@glassez 

Alright, finally got around to properly test with Qt's MinGW64 distribution. After deleting a single line (I'll force push in a bit), looks like everything builds and runs alright. Here's how I built it (all commands executed in the Qt5 MingGW64 shell):

Boost:

```
bootstrap.bat gcc
.\b2 build -a -q --with=all -j2 --toolset=gcc
```

libtorrent:

```
cmake -S . -B cmake-build-dir -G ""Ninja"" -DOPENSSL_ROOT_DIR=C:\Qt\Tools\OpenSSL\Win_x64 -DBoost_DIR=C:\Users\User\Documents\dev\boost_1_73_0\stage\lib\cmake\Boost-1.73.0 -Ddeprecated-functions=OFF -DCMAKE_CXX_STANDARD=14 -DBUILD_SHARED_LIBS=OFF -DCMAKE_BUILD_TYPE=Release
cmake --build cmake-build-dir
```

zlib:

```
cmake -S . -B build -G ""Ninja"" -DCMAKE_BUILD_TYPE=Release
cmake --build build
```

qbittorrent:

```
cmake -S . -B build -G ""Ninja"" -DOPENSSL_ROOT_DIR=C:\Qt\Tools\OpenSSL\Win_x64 -DLibtorrentRasterbar_DIR=C:\Users\User\Documents\dev\libtorrent\cmake-build-dir\LibtorrentRasterbar -DBoost_DIR=C:\Users\User\Documents\dev\boost_1_73_0\stage\lib\cmake\Boost-1.73.0 -DZLIB_INCLUDE_DIR=C:\Users\User\Documents\dev\zlib-1.2.11\build -DZLIB_LIBRARY=C:\Users\User\Documents\dev\zlib-1.2.11\build\libzlibstatic.a -DCMAKE_BUILD_TYPE=Release
cmake --build build
windeployqt build\qbittorrent.exe
```

I also had to manually copy in the OpenSSL library files, but presumably, if the static libraries were available, one would only need to pass `-DOPENSSL_USE_STATIC_LIBS=ON` for everything to work automatically."
665079220,12746,FranciscoPombal,2020-07-28T14:37:42Z,"@glassez @Chocobo1 rebased, cleaned up commit message, and undid the dependency version bumps. Everything is ready now."
669115337,12746,glassez,2020-08-05T10:28:57Z,">You guys are arguing ""don't use this nice feature of modern CMake because I don't understand it"".

It is not a good way to defend your point of view by insulting/humiliating your opponents. My life experience tells me that this is usually done by someone who really has no valuable cards to play.
You may not believe me, but I can still understand things more complex than that, although I'm not a ""cool hacker"".
No one told you ""don't use it,"" but ""don't use it unnecessarily"". But you are probably one of those who immediately rush to use some ""new nice feature"" instead of everything that existed before, believing that it is intended to displace everything else.
>""I want to read/write modern C++, but I don't want to learn anything new about C++ >= 11"".

This is one of the extremes that I don't support.
But I also do not support those who believe that all existing things are outdated and should not be used for the sake of modern features (for example, write some wrapper over an integer type, only to use a modern range based `for` loop instead of the ""old shit"" `for` loop, because ""now there is range based `for` loop since c++11, and we should use only it"").

I'm sorry, but this is still a public project. So when I write some correct code, but the guys tell me ""it's confusing my eyes, could you reformat it?"", I have to change it so that someone else can more easily understand it and fix it if necessary. When there are several ways to do something without a noticeable difference in effectiveness, we should take into account the aspects of maintainability (even subjective aspects, if this is the concern of other collaborators).
"
669129098,12746,FranciscoPombal,2020-08-05T11:02:53Z,"@glassez 

> It is not a good way to defend your point of view by insulting/humiliating your opponents. My life experience tells me that this is usually done by someone who really has no valuable cards to play.

I think you are misunderstanding my intentions while not playing valuable cards yourself. I have posted _multiple_ times explaining the benefits of this approach, including the most recent post with a nice, easily digestible video reference, _with timestamps_ and all I have gotten in return is pretty much ""I don't like the syntax"", without actual counter-arguments against the main points. I think this kind of stubbornness is starting to border on disrespectful against my willingness to provide detailed explanations and arguments for the way I do the things that I do. I feel like I'm not getting much in return even after going as far as spoon-feeding a lot of relevant information.

""don't use this nice feature of modern CMake because I don't understand it"". is not an attempt at humiliating anyone (sorry if you feel that way) - it's just a wake-up call after multiple unproductive exchanges. Everybody can be a little stubborn or resistant to change sometimes, and that's OK. It's just the duty of others to point it out to them when it happens.

> You may not believe me, but I can still understand things more complex than that, although I'm not a ""cool hacker"".

Of course I know you could easily understand this. You are just coming off as stubborn.

> No one told you ""don't use it,"" but ""don't use it unnecessarily"". But you are probably one of those who immediately rush to use some ""new nice feature"" instead of everything that existed before, believing that it is intended to displace everything else.

Feel free to point out where it is ""used unnecessarily"". By their very nature, genexps are only even available where it makes sense for them to be available. In fact, if anything, they are still not available in every place they would come in handy (see the lines below the `# There is no generator expression for CMAKE_GENERATOR yet` comment).

I should remind you once again that the example you initially referred to, `$<$<AND:$<BOOL:${UNIX}>,$<NOT:$<BOOL:${APPLE}>>,$<NOT:$<BOOL:${CYGWIN}>>>:_DEFAULT_SOURCE>` is an uncommon worst case scenario; plus, its complexity mostly arises from the fact that it is not so easy to say ""just regular *nix systems"" in CMake, not genexps in general. It's also not that comfortable/ideal to read/write `if (UNIX AND NOT APPLE AND NOT CYGWIN)` just to convey this simple idea.

> > ""I want to read/write modern C++, but I don't want to learn anything new about C++ >= 11"".
> 
> This is one of the extremes that I don't support.
> But I also do not support those who believe that all existing things are outdated and should not be used for the sake of modern features (for example, write some wrapper over an integer type, only to use a modern range based `for` loop instead of the ""old shit"" `for` loop, because ""now there is range based `for` loop since c++11, and we should use only it"").

This is not just me ""using something just because it's new"" just like a new JS framework, the way I used genexps is meaningful and has real benefits, as I have explained multiple times above.

> I'm sorry, but this is still a public project. So when I write some correct code, but the guys tell me ""it's confusing my eyes, could you reformat it?"", I have to change it so that someone else can more easily understand it and fix it if necessary. When there are several ways to do something without a noticeable difference in effectiveness, we should take into account the aspects of maintainability (even subjective aspects, if this is the concern of other collaborators).

I already pointed out multiple reasons why there is a _noticeable_ difference in effectiveness and maintainability doing it this way vs. `if ()`s. It's not like this is simply ""a different syntax for doing the same thing"". In situations where a range-based `for` loop is actually much better than a traditional one, would you accept ""I don't like its syntax/don't understand it"" as a valid reason against it being in the code? Maintainability also suffers if someone keeps rejecting new better ways of doing things, because it increases technical debt. It's not just a matter of writing everything in the lowest common denominator style that everyone understands. Sometimes the onus is on people to learn new tricks for a greater good. As an additional, perhaps better example than `for` loops, consider large plain JS-based projects switching over to Typescript. Sure, such a change forces everyone to learn Typescript, but the maintainability of the project goes up significantly despite that initial hurdle, because of the benefits of the new technology itself.

EDIT: I should also point out that _overall readability_ of the buildscripts does not depend exclusively on the syntax used to write them, but also on form. Despite the disadvantage in syntax readability at times, using genexps this way enables a structure that is massively advantaged in terms of form. That's another way of explaining why overall, the buildscripts are much more readable and maintainable now, despite the odd ""pathological"" genexp like `$<$<AND:$<BOOL:${UNIX}>,$<NOT:$<BOOL:${APPLE}>>,$<NOT:$<BOOL:${CYGWIN}>>>:_DEFAULT_SOURCE>`."
669318755,12746,glassez,2020-08-05T17:13:56Z,">its complexity mostly arises from the fact that it is not so easy to say ""just regular *nix systems"" in CMake

Isn't it possible to create a new variable that stores the desired value (the resault of `UNIX AND NOT APPLE AND NOT CYGWIN`) and then use it? If so, CMake is even more flawed than I had previously assumed..."
669347511,12746,glassez,2020-08-05T18:05:41Z,">I have posted multiple times explaining the benefits of this approach

Well, here are your benefits...:
>Now, each target has at most one `target_link_libraries()` call, one `target_compile_definitions()` call, etc (basically, only one call of each of the` target_*` commands per target).

Why is using `target_*` command multiple times evil? It seems to be created for the purpose of being applied many times, otherwise it is meaningless, and it can all be put in one command, such as `add_target(name COMPILE_DEFINITIONS <definitions> LINK_LIBRARIES <libraries> )`.
>No need to hunt down multiple calls of target_xyz() inside multiple conditional branches, possibly across multiple CMake files, 

Whether or not to split the project into multiple files is a separate issue. You can have everything in a single file, but still use `if`s.
As for multiple conditional branches, this is also not a problem if they are structured optimally.
>the platform-specific requirements for each target are much clearer now;

Really? The following looks clearer for me:
```cmake
if (SOME_PLATFORM)
    target_link_libraries(...)
    target_compile_definitions(...)
    target_something_other(...)
elseif (SOME_OTHER_PLATFORM)
   target_*(...)
   ...
endif()
```
>For example, to know all the compile definitions of base, you just read the single `target_compile_definitions()` call for it and the INTERFACE/PUBLIC compile definitions of the targets it links to

Another one-sided view... You didn't mention that you usually don't need to know **all **the definitions, but only platform-specific ones. So you still have to poke around inside single `target_compile_definitions()` call, instead of looking at couple `target_compile_definitions()` calls located in interesting platform-specific branches.

So it doesn't look ""obviously the best"" to me. It has only one undeniable advantage, which is access to generation time values that cannot be accessed in other ways. In all other cases, its advantages are not obvious.

But since I always assume that I may be wrong, that I am blind and do not see all the unprecedented usefulness of the changes discussed, and I do not want to prevent the incredible progress that it can give to our project, I will prefer to remain neutral on this issue and leave it to others to decide its fate."
669348599,12746,FranciscoPombal,2020-08-05T18:07:54Z,"@glassez 

> Isn't it possible to create a new variable that stores the desired value (the resault of `UNIX AND NOT APPLE AND NOT CYGWIN`) and then use it? If so, CMake is even more flawed than I had previously assumed...

It is not wise to rely excessively on loose variables, but your suggestion gave me an idea... I think it is possible to simplify `$<$<AND:$<BOOL:${UNIX}>,$<NOT:$<BOOL:${APPLE}>>,$<NOT:$<BOOL:${CYGWIN}>>>:_DEFAULT_SOURCE>` to something like `$<$<BOOL:""${${UNIX} AND NOT ${APPLE} AND NOT ${CYGWIN}}"">:_DEFAULT_SOURCE>` (not sure if syntax is exactly correct), and likewise for other similar cases.

Alternatively, setting a variable equal to `UNIX AND NOT APPLE AND NOT CYGWIN` and using it in the genexp will probably also work, but it must not be possible for the user to edit/change it.

I will try it out and report back."
669359391,12746,glassez,2020-08-05T18:21:11Z,"> Alternatively, setting a variable equal to `UNIX AND NOT APPLE AND NOT CYGWIN` and using it in the genexp will probably also work, but it must not be possible for the user to edit/change it.

It's even possible to change the predefined one, e.g. `set(APPLE TRUE)`, so your requirement doesn't matter to care about, IMO."
669393779,12746,FranciscoPombal,2020-08-05T18:46:00Z,"@glassez 

> Why is using `target_*` command multiple times evil? It seems to be created for the purpose of being applied many times, otherwise it is meaningless, and it can all be put in one command, such as `add_target(name COMPILE_DEFINITIONS <definitions> LINK_LIBRARIES <libraries> )`. 

> Whether or not to split the project into multiple files is a separate issue. You can have everything in a single file, but still use `if`s.
> As for multiple conditional branches, this is also not a problem if they are structured optimally.

It's not ""evil"", but it's better if you can avoid it/not overdo it. Otherwise, you have to carefully examine each file, hunting for `target_*` calls inside conditionals that might apply to your case. For example, it doesn't make much sense to me if there are `target_*` calls for the `qbt_app` target all over other files for other components/targets.

> Really? The following looks clearer for me:
> 
> ```cmake
> if (SOME_PLATFORM)
>     target_link_libraries(...)
>     target_compile_definitions(...)
>     target_something_other(...)
> elseif (SOME_OTHER_PLATFORM)
>    target_*(...)
>    ...
> endif()
> ```

Come on, that is a ""hello world"" example, we both know that does not scale (this is my main point) and is certainly not the case for qBittorrent.

In qBittorrent it would be more like (assume all these calls are with respect to some target FOO):

File A:

 ```cmake
 if (SOME_PLATFORM)
     target_link_libraries(...)
     target_compile_definitions(...)
     target_something_other(...)
 elseif (SOME_OTHER_PLATFORM)
        if(X_FEATURE)
            target_*(...)
        endif()
    target_*(...)
    ...
 endif()
 ```


File B:

 ```cmake
 if (SOME_PLATFORM)
     target_link_libraries(...)
     target_compile_definitions(...)
     target_something_other(...)
     if(X_FEATURE AND SOMETHING)
         target_*(...)
     endif()
 elseif (SOME_OTHER_PLATFORM)
    if(X_FEATURE AND SOMETHING)
        target_*(...)
    endif()
    target_*(...)
    ...
 endif()
 ```

File C:
....

Not fun to hunt them all down and keep all this state in your head. The more everything related to a `target_*` call is in one place, the better.

> Another one-sided view... You didn't mention that you usually don't need to know **all **the definitions, but only platform-specific ones. So you still have to poke around inside single `target_compile_definitions()` call, instead of looking at couple `target_compile_definitions()` calls located in interesting platform-specific branches.

Of course in both cases you have to ignore those that don't apply to your case... You only look at the ones that interest you. In neither case do you have to _know all_ the definitions, don't know how you got the idea that the genexps force you to do this. You can think of the advantage of the genexp approach as a ""locality"" advantage.

To me this seems much better:

- ""Ah, here in this _one_ place are all the compile definitions for target FOO, I just need to look at those that apply to my platform/case.""

than this:

- ""Ok, here are some compile definitions for target FOO, now I just have to look at the rest of all the other files to see if there are some more inside conditionals that apply to my case. I must make sure I don't miss any!""

And this is only from the perspective of the user. Now think from the perspective of a developer/maintainer of these scripts (e.g. me), who has to take into account all combinations of platforms and features. Bonus: In the first case, it is much easier to debug/comment out/add/remove definitions...

> It has only one undeniable advantage, which is access to generation time values that cannot be accessed in other ways.

You can always echo the value at build time, but I assume you are coming from a perspective of ""I want to _debug_ the scripts at configure-time"" (which is more than reasonable, everyone wants this; actually triggering the build just to debug some build script value is kind of silly). Debugging CMake scripts has always sucked, whether or not you use generator expressions. You are pretty much forced to edit the file to strategically place `message(STATUS ""XXX FOO: ${FOO}"")` statements and look at the output. Taking that into account, placing `file(GENERATE OUTPUT foo.txt CONTENT <string-with-generator-expression>)` is not that much worse. In fact, it has a small advantage: in many cases, it does not matter where you put it. For example, `file(GENERATE OUTPUT foo.txt CONTENT ""$<$<AND:$<BOOL:${UNIX}>,$<NOT:$<BOOL:${APPLE}>>,$<NOT:$<BOOL:${CYGWIN}>>>:_DEFAULT_SOURCE>"")` can be put pretty much anywhere and the result will always be the same.

> But since I always assume that I may be wrong, that I am blind and do not see all the unprecedented usefulness of the changes discussed, and I do not want to prevent the incredible progress that it can give to our project, I will prefer to remain neutral on this issue and leave it to others to decide its fate.

Yeah this sarcasm isn't helping. It's not like I haven't been listening. I have been listening and providing my reasoning. I am more than willing to further explain my points, change my mind, and accept actual suggestions. But first, actual suggestions and arguments need to be provided. https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-669318755 and this post with the exception of this final statement were a good start.

EDIT:

> and it can all be put in one command, such as `add_target(name COMPILE_DEFINITIONS <definitions> LINK_LIBRARIES <libraries> )`.

Don't know where you got this idea, but you cannot do this. Here is the relevant documentation:
https://cmake.org/cmake/help/latest/command/add_executable.html
https://cmake.org/cmake/help/latest/command/add_library.html

At most you can add sources in that command as a ""shortcut"", but even that is discouraged (adding the sources only in (a) `target_sources()` call(s) is preferable for better/easier IDE integration). That is something that I would like to change eventually as well, but certainly not in this PR at this point - and for us, for now, it is an inconsequential change, anyway."
669395252,12746,FranciscoPombal,2020-08-05T18:47:58Z,"@glassez 

> It's even possible to change the predefined one, e.g. `set(APPLE TRUE)`, so your requirement doesn't matter to care about, IMO.

`set(APPLE TRUE)` is not something either we or the user should ever do, though."
669433763,12746,glassez,2020-08-05T19:26:13Z,">Don't know where you got this idea, but you cannot do this

Yes, I know.
I meant that if `target_*()` instruction is not intended for multiple use, then there is no point in having it, and a single instruction that could look like what I described is enough.
>#12746 (comment) and this post with the exception of this final statement were a good start.

A good start was a long time ago, when I strongly suggested not to mix too many disputable changes in a single PR. But you rejected it...
>Otherwise, you have to carefully examine each file...

Didn't you understand my previous comment? `Whether or not to split the project into multiple files is a separate issue`. It is only correct to compare the use of ""generator expressions"" and ""if-else"" if all other things being equal."
669519362,12746,FranciscoPombal,2020-08-05T21:24:25Z,"@glassez 

> Yes, I know.
> I meant that if `target_*()` instruction is not intended for multiple use, then there is no point in having it, and a single instruction that could look like what I described is enough.

They _can_ be used multiple times, which is good for flexibility. But the more you use them in different places for a certain target, the more you throw away its (potential) advantages.

> > #12746 (comment) and this post with the exception of this final statement were a good start.
> 
> A good start was a long time ago, when I strongly suggested not to mix too many disputable changes in a single PR. But you rejected it...

As I have said before, it was a natural evolution. It was becoming tiresome of going through the process of ""PR is ready -> something about platform FOO isn't quite right -> attempt to fix it -> repeat"". And I've already admitted that arguably, I should have seen this, and not take it out of draft state so soon. The result of the change was a net positive though - there were no regressions with regards to the platforms that were previously OK, and the MinGW problem was solved super easily.

> Didn't you understand my previous comment? `Whether or not to split the project into multiple files is a separate issue`. It is only correct to compare the use of ""generator expressions"" and ""if-else"" if all other things being equal.

""All [other] things"" _are equal_ - we are comparing ""multiple file setup with `if ()`s"" (the way this PR was, initially) vs. ""multiple file setup with genexps"" (the way it is now), right? Only one variable is changing here - genexps vs. `if ()`s - in both cases, we are talking about a ""multiple file"" setup.

Unless what you meant was that it would have been preferable to change the whole build system to be a single CML file with `if()`s, as opposed to using genexps in any capacity? That would have been a much more contentious and jarring change for sure though, and I honestly believe you are underestimating the complexity of the conditionals you'd end up with regardless. Even in that scenario (single file), using genexps would have been preferable.

Take a look at this excerpt we currently have (in `master`) in the CML in `src/app`:

```cmake
if (STACKTRACE)
    if (UNIX)
        target_sources(qBittorrent PRIVATE stacktrace.h)
    else()
        target_sources(qBittorrent PRIVATE stacktrace_win.h)
        if (GUI)
            target_sources(qBittorrent PRIVATE stacktracedialog.cpp stacktracedialog.h)
        endif()

        if (MSVC)
            if (NOT ""${WINXXBITS}"" STREQUAL ""Win64"")
                # i686 arch requires frame pointer preservation
                add_compile_options(-Oy-)
            endif()

            add_compile_options(-Zi)
            target_link_libraries(qBittorrent PUBLIC dbghelp -DEBUG)
        else()
            if (NOT ""${WINXXBITS}"" STREQUAL ""Win64"")
                add_compile_options(-fno-omit-frame-pointer)
            endif()

            target_link_libraries(qBittorrent PUBLIC dbghelp -Wl,--export-all-symbols)
        endif()
    endif()
endif()
```

There's 5 (!) levels of nesting. Granted, in this particular example you could easily get rid of one of them by doing `if (STACKTRACE AND UNIX)` at the top, but what if, in the future, you want to add something that needs ""STACKTRACE, but not UNIX""? You are either forced to add that nesting level back, or add another `if ()` below/above just for that. This is much harder to read and maintain vs. the alternative, which just requires you to locate the appropriate `target_*()` call (depending on whether you want to add a compile definition, link option, ...) for the target in question, and plop a new generator expression right in there, possibly without even looking at what's already there, no need to reason about complex conditional branch structures.

Now imagine a huge, single file filled with stuff like this..."
669939782,12746,glassez,2020-08-06T13:52:09Z,">in both cases, we are talking about a ""multiple file"" setup.

Maybe I did not understand correctly... in your previous comment, you indicate that the advantage of using genexps is that everything is in one place, and disadvantage of using ""if-else"" is that settings is located in several files. Seems such a comparison isn't correct if you insist on the fact that genexp way is better in itself."
669943552,12746,glassez,2020-08-06T13:58:03Z,">There's 5 (!) levels of nesting.

Didn't you just collapse those levels, making the code less readable? This can be done without generator expressions... even using ""if-else"" we can have a more compact code with fewer levels, and also less readable. Well, can we see it as an improvement?"
669947472,12746,glassez,2020-08-06T14:04:02Z,"> Granted, in this particular example you could easily get rid of one of them by doing if (STACKTRACE AND UNIX) at the top, but what if, in the future, you want to add something that needs ""STACKTRACE, but not UNIX""?

Is it going to be much harder to change it than corresponding "" genexp"" code?
But if we have all these five levels that reflect the real logical structure of dependencies, it will not be difficult to add something that needs ""STACKTRACE, but not UNIX""."
669949894,12746,glassez,2020-08-06T14:08:05Z,">Yeah this sarcasm isn't helping.

This was not sarcasm (except, perhaps, a couple of flattering epithets about the possible benefits of these changes). If the community decides that it is really useful, then I will not prevent it from merging."
670009173,12746,FranciscoPombal,2020-08-06T15:43:55Z,"@glassez 

> Maybe I did not understand correctly... in your previous comment, you indicate that the advantage of using genexps is that everything is in one place, and disadvantage of using ""if-else"" is that settings is located in several files. Seems such a comparison isn't correct if you insist on the fact that genexp way is better in itself.

By ""one place"" I did not mean necessarily ""in the same file"" - it's independent of that. I was referring to the fact that for any given important aspect of a target (definitions, link options, compile options, ...), you only have to refer to, ideally, 1 place. Take the `qbt_gui` target and its compile definitions as an example. It is a better user, developer and maintainer experience if all the information you need about its compile definitions is in one place (or at least, as few as possible), that you then examine according the specific platform you want to know details about, vs hunting down multiple `target_compile_definitions()` calls across conditional branches.

I think it's clear that genexps help in this matter of ""increasing locality"" both in the single file and multiple file case, though honestly I would also guess that the advantage is probably more pronounced in the single file case.

> Didn't you just collapse those levels, making the code less readable?

Thanks to ""better locality"", I would argue the code is more readable now.

In that snippet above, in total there were:

- 3 calls to `target_sources`
- 3 calls to `add_compile_options` (this changed to `target_compile_options`, so we treat it as such for this example)
- 2 calls to ` target_link_libraries`, which in the modern approach also conceal 2 more calls to `target_link_options` (but one of these was dropped, so we'll count only 1).

All of them interspersed throughout a somewhat complex branching structure you had to carefully analyze to understand what was going on. If you cared about only one thing, such as `compile options` (imagine you wanted to change it or something), and did not care about linked libraries or options, you'd still have to look at it all. Plus, depending on other features, you might also have to repeat the process for more `if ()` chains somewhere else in the file.

In total, there are now, in that file:

- 2 calls to `target_sources` (this could, and should have easily been reduced to 1 by putting a single `target_sources` call after the whole `# Translations, resources and bundle stuff` section, but it's not that much of a problem and I'm not going to change it now)
- 1 call to `target_compile_options`
- 1 call to `target_link_libraries`
- 1 call to `target_link_options`

All of them nicely separated from one another. Want to know about the linked libraries? Just look at the single `target_link_libraries()` command, you are not forced to look at anything else by a branching structure.

Now, if you only care about compile options, you just look at the single `target_compile_options(qBittorrent ...)` call; no other conditions/link options/etc distracting you. Then, you look at the genexps, which are not even that hard to parse, and figure out the ones that apply to your case. In this particular case, suppose you are on Linux; you don't even need to read them all; just notice they all start with `$<$<AND:$<PLATFORM_ID:Windows>,...` and come to the conclusion that no additional compile options are added to the target.

>Is it going to be much harder to change it than corresponding "" genexp"" code?

I believe so; this has been my experience. With `if()`s, depending on the scope of the refactoring, you might have to carefully rearrange the branching structure. With genexps you will most often add new ones or remove existing ones, or occasionally tweak existing ones, but their order inside the `target_*()` call does not matter, for example, which is a big plus. You basically don't need to think about control flow.

> But if we have all these five levels that reflect the real logical structure of dependencies, it will not be difficult to add something that needs ""STACKTRACE, but not UNIX"".

What exactly do you mean by ""real logical structure of dependencies""? If you mean ""modeling of target requirements"", I think a genexp-based approach does a better job at this, because first and foremost, every target in any project is made up of compile options, definitions, link options, etc. Then, adjustments to each of these may be made based on the platform or chosen feature set (this is what genexps do). The `if ()` approach leads to ""thinking backwards"", i.e., you first think in terms of platform and feature set, and then add compile options/definitions/etc piece-meal. Based on my previous explanations, I hope I have convinced you that this is more brittle, because requirements become more entangled by the imperative logic. Plus, in terms of structure, what has ""precedence""? The feature, the platform, something else, or does it depend on whichever approach yields the simplest structure? In the snippet above, `if(STACKTRACE)` is on the outside and `if(MSVC)` is on the inside (so, the feature has precedence), but would have this remained consistent? With genexps there is no decision to be made.

Imagine you wanted to remove the `WEBUI` and/or the `STACKTRACE` feature; I think it's easy to see this would be easier and faster to do correctly with the genexp approach vs the `if()` approach in general.

EDIT: I realize now that this last sentence, excluding the ""in general"" part, is a poor example, since I believe before it also happened to be possible to remove these features easily."
670040938,12746,FranciscoPombal,2020-08-06T16:38:01Z,"@glassez 

I recently made a PR that includes similar changes for another project: https://github.com/Rudde/mktorrent/pull/50 (direct link to the CML file: https://github.com/FranciscoPombal/mktorrent/blob/3da0d97f78d629b2b771e8bee1d3b5937100a088/CMakeLists.txt). You can see the same ""style"" in action; unlike qBittorrent, in this project a ""single file"" setup is used, a decision that is mostly due to the simplicity of the project itself."
671087394,12746,FranciscoPombal,2020-08-09T18:45:42Z,"@glassez 

I tried out the ideas from https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-669318755 and https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-669348599, here is the resulting example patch of what I came up with (on top of the current PR):

```diff
diff --git a/cmake/Modules/MacroQbtCommonConfig.cmake b/cmake/Modules/MacroQbtCommonConfig.cmake
index 3c986c4fd..2c8f64e3f 100644
--- a/cmake/Modules/MacroQbtCommonConfig.cmake
+++ b/cmake/Modules/MacroQbtCommonConfig.cmake
@@ -38,6 +38,8 @@ macro(qbt_common_config)
             cxx_digit_separators
     )
 
+    set(REGULAR_UNIX ""$<AND:$<BOOL:${UNIX}>,$<NOT:$<BOOL:${APPLE}>>,$<NOT:$<BOOL:${CYGWIN}>>>"")
+
     target_compile_definitions(qbt_common_cfg
         INTERFACE
             QBT_VERSION=""v${PROJECT_VERSION}""
@@ -48,7 +50,7 @@ macro(qbt_common_config)
             QT_USE_QSTRINGBUILDER
             QT_STRICT_ITERATORS
             $<$<NOT:$<CONFIG:Debug>>:QT_NO_DEBUG_OUTPUT>
-            $<$<AND:$<BOOL:${UNIX}>,$<NOT:$<BOOL:${APPLE}>>,$<NOT:$<BOOL:${CYGWIN}>>>:_DEFAULT_SOURCE>
+            $<$<BOOL:${REGULAR_UNIX}>:_DEFAULT_SOURCE>
             $<$<PLATFORM_ID:Windows>:
                 NTDDI_VERSION=0x06010000
                 _WIN32_WINNT=0x0601
@@ -64,6 +66,7 @@ macro(qbt_common_config)
     # Clang 11 still doesn't support -Wstrict-null-sentinel
     include(CheckCXXCompilerFlag)
     check_cxx_compiler_flag(-Wstrict-null-sentinel SNS_SUPPORT)
+    set(COMPILER_SNS_SUPPORTED ""$<AND:$<CXX_COMPILER_ID:GNU,Clang,AppleClang>,$<BOOL:${SNS_SUPPORT}>>"")
     target_compile_options(qbt_common_cfg
         INTERFACE
             $<$<CXX_COMPILER_ID:GNU,Clang,AppleClang>:
@@ -77,7 +80,7 @@ macro(qbt_common_config)
                 -Wnon-virtual-dtor
                 -pedantic
                 -pedantic-errors>
-            $<$<AND:$<CXX_COMPILER_ID:GNU,Clang,AppleClang>,$<BOOL:${SNS_SUPPORT}>>:-Wstrict-null-sentinel>
+            $<$<BOOL:${COMPILER_SNS_SUPPORTED}>:-Wstrict-null-sentinel>
     )
 
     target_link_options(qbt_common_cfg
diff --git a/src/app/CMakeLists.txt b/src/app/CMakeLists.txt
index e7cbcbae0..0f4f39709 100644
--- a/src/app/CMakeLists.txt
+++ b/src/app/CMakeLists.txt
@@ -17,14 +17,17 @@ add_executable(qBittorrent
     upgrade.cpp
 )
 
+set(WINDOWS_AND_STACKTRACE ""$<PLATFORM_ID:Windows>,$<BOOL:${STACKTRACE}>"")
+set(WINDOWS_AND_32_BIT_AND_STACKTRACE ""${WINDOWS_AND_STACKTRACE},$<EQUAL:${CMAKE_SIZEOF_VOID_P},4>"")
+
 target_sources(qBittorrent
     PRIVATE
         $<$<PLATFORM_ID:Windows>:${CMAKE_SOURCE_DIR}/src/qbittorrent.exe.manifest>
         $<$<AND:$<PLATFORM_ID:Windows>,$<BOOL:${MINGW}>>:${CMAKE_SOURCE_DIR}/src/qbittorrent_mingw.rc>
         $<$<AND:$<PLATFORM_ID:Windows>,$<NOT:$<BOOL:${MINGW}>>>:${CMAKE_SOURCE_DIR}/src/qbittorrent.rc>
-        $<$<AND:$<PLATFORM_ID:Windows>,$<BOOL:${STACKTRACE}>>:stacktrace_win.h>
+        $<$<AND:${WINDOWS_AND_STACKTRACE}>:stacktrace_win.h>
         $<$<AND:$<NOT:$<PLATFORM_ID:Windows>>,$<BOOL:${STACKTRACE}>>:stacktrace.h>
-        $<$<AND:$<PLATFORM_ID:Windows>,$<BOOL:${STACKTRACE}>,$<BOOL:${GUI}>>:
+        $<$<AND:${WINDOWS_AND_STACKTRACE},$<BOOL:${GUI}>>:
             stacktracedialog.cpp
             stacktracedialog.h
             stacktracedialog.ui>
@@ -34,10 +37,10 @@ target_compile_definitions(qBittorrent PRIVATE $<$<BOOL:${STACKTRACE}>:STACKTRAC
 
 target_compile_options(qBittorrent
     PRIVATE
-        $<$<AND:$<PLATFORM_ID:Windows>,$<BOOL:${STACKTRACE}>,$<BOOL:${MSVC}>>:/Zi>
+        $<$<AND:${WINDOWS_AND_STACKTRACE},$<BOOL:${MSVC}>>:/Zi>
         # i686 arch on Windows requires frame pointer preservation
-        $<$<AND:$<PLATFORM_ID:Windows>,$<BOOL:${STACKTRACE}>,$<EQUAL:${CMAKE_SIZEOF_VOID_P},4>,$<BOOL:${MSVC}>>:/Oy->
-        $<$<AND:$<PLATFORM_ID:Windows>,$<BOOL:${STACKTRACE}>,$<EQUAL:${CMAKE_SIZEOF_VOID_P},4>,$<NOT:$<BOOL:${MSVC}>>>:-fno-omit-frame-pointer>
+        $<$<AND:${WINDOWS_AND_32_BIT_AND_STACKTRACE},$<BOOL:${MSVC}>>:/Oy->
+        $<$<AND:${WINDOWS_AND_32_BIT_AND_STACKTRACE},$<NOT:$<BOOL:${MSVC}>>>:-fno-omit-frame-pointer>
 )
 
 target_link_libraries(qBittorrent
@@ -47,12 +50,12 @@ target_link_libraries(qBittorrent
         $<$<BOOL:${WEBUI}>:qbt_webui>
         qbt_version_definitions
     PUBLIC
-        $<$<AND:$<PLATFORM_ID:Windows>,$<BOOL:${STACKTRACE}>>:dbghelp>
+        $<$<AND:${WINDOWS_AND_STACKTRACE}>:dbghelp>
 )
 
 target_link_options(qBittorrent
     PUBLIC
-        $<$<AND:$<PLATFORM_ID:Windows>,$<BOOL:${STACKTRACE}>,$<BOOL:${MSVC}>>:/DEBUG>
+        $<$<AND:${WINDOWS_AND_STACKTRACE},$<BOOL:${MSVC}>>:/DEBUG>
 )
 
 set_target_properties(qBittorrent
```

Do you think it's an improvement?

Personally, I don't think it is...
Although the new variables can make the script be more descriptive about the intent (e.g. `REGULAR_UNIX` better conveys the purpose of the boolean expression), the genexp is simply being moved somewhere else - the variable is just used for simple text substitution. Plus, modifying the genexp implies modifying the variable name, because the variable name ends up being coupled to the logic of the genexp it abbreviates. I think we would achieve the same result (of better communicating intent) more effectively simply by placing a descriptive comment next to the complex genexps that ""need it"". In the case of the `_DEFAULT_SOURCE` genexp, something like `# only for ""regular"" UNIX-like systems, such as Linux,*BSD, ...`.

Alternatively, in my testing I found it is indeed also possible to do this:

```cmake
if (UNIX AND (NOT APPLE) AND (NOT CYGWIN))
    set(REGULAR_UNIX ON)
endif()

target_compile_definitions(qbt_common_cfg
    INTERFACE
        ...
        $<$<BOOL:${REGULAR_UNIX}>:_DEFAULT_SOURCE>
        ...
)
```

Which, is more readable, at the price of eroding the ""locality"" of conditionals that I mention above - if we start doing it this way, why not go `if ()`s all the way? Also, again, I don't think it is justified vs. simply adding a descriptive comment next to the generator expression, when needed."
672564634,12746,glassez,2020-08-12T04:25:06Z,">I tried out the ideas from 

My idea was about logically atomic concepts only (e.g. ""regular Unix"").

```cmake
if (UNIX AND (NOT APPLE) AND (NOT CYGWIN))
    set(REGULAR_UNIX ON)
endif()
```
to be honest, I was mistaken about the fact that it could have been done in a different way..."
672822792,12746,FranciscoPombal,2020-08-12T11:46:39Z,"@glassez 

> My idea was about logically atomic concepts only (e.g. ""regular Unix"").

It is possible as shown in the latter part of https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-671087394, but as I mentioned there as well, I don't think it's a significant improvement over just adding an explanatory comment when needed.

Do you agree or disagree with this? Should I add a comment in this case? If you don't feel strongly about this either way, we can move on. Maybe later if someone feels the need to add explanatory comments they can do so in a follow-up PR.

> to be honest, I was mistaken about the fact that it could have been done in a different way...

Well, we have to work with what we got..."
680132819,12746,FranciscoPombal,2020-08-25T16:29:01Z,"The force push was just some minor fixes and rebase on current master, to better support basing https://github.com/qbittorrent/qBittorrent/pull/13288 fresh on top of this."
683182530,12746,FranciscoPombal,2020-08-28T23:04:37Z,"This force-push is basically a ""no change"" rebase.

- Removed the old mechanism of determining the version via the `.pri` file, which was kept by mistake (so now the CMake scripts are fully independent of the qmake stuff).
- Renamed the `app` target to `qbt_app` so that it does not clash with the project name. It was not causing any problems AFAIK, but better safe than sorry and it's less confusing this way.
- Final refactor to `src/app/CML`. It's finally in a state I'm happy with - handling of extra macOS resources/Windows stuff/translations is now much smoother, understandable and consistent. Sadly, support for generator expressions among a few relevant properties is not there yet, particularly under `Additional macOS/Windows specific configuration`) - one `if (CMAKE_SYSTEM_NAME MATCHES ""Darwin"") ... elseif (CMAKE_SYSTEM_NAME MATCHES ""Windows"")` construct was inevitable. The practical consequence is that the logic is not as encapsulated as it could be and it's more order-sensitive than it could be - but not by much, not a big deal; certainly better than previously. I have verified that behavior is exactly the same as previously both on macOS and Windows though."
683789150,12746,FranciscoPombal,2020-08-31T13:46:46Z,"@glassez @Chocobo1 ping, can we please get this over with? Let me know if you still think it's a good idea to try to split this up into individual commits."
684837158,12746,glassez,2020-09-01T13:04:30Z,">@glassez @Chocobo1 ping, can we please get this over with? Let me know if you still think it's a good idea to try to split this up into individual commits.

I have already expressed my final opinion. And I do not yet see any strong opinions from other members for accepting these changes in their current form."
685056762,12746,FranciscoPombal,2020-09-01T18:31:56Z,"Well I guess this is dead then, and so are other nice PRs that depend on this, for now. Sad. I'll keep it open for when you change your mind."
685308949,12746,glassez,2020-09-02T05:29:06Z,">Well I guess this is dead then, and so are other nice PRs that depend on this, for now. Sad. I'll keep it open for when you change your mind.

Just please don't make me feel guilty. My current opinion doesn't determine anything, because I don't intend to block this PR. Even if I approved it explicitly, it wouldn't be enough to merge it. Besides, I originally suggested that you don't put everything together. If you had followed my advice, perhaps most of your changes would have already been merged (and perhaps it would have been easier for you to show the possible benefits of your other changes)."
685947159,12746,FranciscoPombal,2020-09-02T19:23:33Z,"@glassez 

> Just please don't make me feel guilty. My current opinion doesn't determine anything, because I don't intend to block this PR. Even if I approved it explicitly, it wouldn't be enough to merge it. 

If you feel guilty that's on you, I'm just pointing out the current state of affairs. You can try to wash your hands of your responsibility in this not getting merged, but you know full well what's going on... namely, @Chocobo1 has been snubbing me (really mature btw), so without your approval _and_ your push for getting this merged, it won't go anywhere anytime soon. By not actively supporting it, you are blocking it, in a way. These bullshit office politics are holding the project back.
This is a good PR that is an objective improvement, in which I invested a lot of time. I don't think my work is getting the respect it deserves.

There are many nice QoL changes that can be harmoniously implemented on top of this, such as:
- optional git versioning,
- ""developer options"" switch (to enable hidden-by-default options that do things like inject arbitrary global compile definitions/options specified in the command line)
- use of `target_include_directories()` + project file hierarchy change to put the header files in a separate `include/` directory (to conform to a more reasonable source directory layout standard, https://api.csswg.org/bikeshed/?force=1&url=https://raw.githubusercontent.com/vector-of-bool/pitchfork/develop/data/spec.bs, and hopefully to better reason about and improve the project's overall component architecture as a result)
- optional automatic download+build of specified libtorrent versions by using `FetchContent`
- etc...

I notice I'm putting much more effort, detail, and analysis into my posts and replies than what I'm getting back.
Especially in the later exchanges, your messages have been often unhelpful and/or un-actionable (i.e., lack of constructive criticism). Most recent example example: https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-672564634, then radio silence for days (What is it that you _want_, specifically? What is your concrete suggestion?). This is not good collaboration.

> Besides, I originally suggested that you don't put everything together.

Yes, others suggested it before, even, https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-623275457, and that was my intention early on as well (https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-623537587).
But things change and now looking at the diff, it doesn't make so much sense to me, so I asked if your opinion had changed https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-683789150. This is a simple YES/NO question:

> Let me know if you _still_ think it's a good idea to try to split this up into individual commits.

to which again you've failed to give a proper actionable YES/NO answer (ideally, it would also include a small justification for the YES/NO).

> If you had followed my advice, perhaps most of your changes would have already been merged

The PR was always in a state of flux until all features (including proper MinGW functionality, which you requested) were implemented. It makes much more sense to merge this whole set of changes at once (even if split up in different commits). I explained multiple times that the genexps change did not affect the flow of the logic that was previously reviewed. It was still the same logic, just implemented in a more robust way that enabled changing/adding/fixing things like MinGW support much easier.

> (and perhaps it would have been easier for you to show the possible benefits of your other changes).

I have shown multiple times the benefits of _all_ my changes. In the comment chain up to https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-670009173, I believe I have convincingly demonstrated how they are better than what you proposed, syntax ugliness notwithstanding. I even linked talks, and other learning resources that back up my claims and approach."
686213901,12746,Chocobo1,2020-09-03T02:43:38Z,">@Chocobo1 has been snubbing me (really mature btw), so without your approval and your push for getting this merged,

I've presented my viewpoints fairly in your PRs and most of the time you don't really want to make an effort to meet them. 
And I lost count of the times you resorted to do personal attacks / snarky comments. It is really not something I would expect to see someone on the team to behave, you better tone it down, that attitude won't get you anywhere.

>These bullshit office politics are holding the project back.

@glassez 
Just because we do the reviews and held account for it, we are the bad guys holding the PR author back. I never realize I would stuck myself in such situation, funny... I'm tired of this shit.

Also I think you should be confident in approving PRs: either its quality is acceptable or it is not. You shouldn't feel pressured when making that decision. A rushed decision is rarely good."
686646396,12746,FranciscoPombal,2020-09-03T17:40:42Z,"@Chocobo1 

> I've presented my viewpoints fairly in your PRs and most of the time you don't really want to make an effort to meet them.

Complete and utter BS, basically any exchange between me and others publicly available on this repo proves the contrary. In fact, in this very PR, there are many such examples of others doing what you describe _to me_, and _initiating_ responses/conversations with snarky remarks/jerky italics/insultingly condescending tone/etc in seemingly bad faith, when there was absolutely no need to. I fucking WISH all discussions here could be plain discussions centered purely on technical points. You call this (https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-671087394) not making an effort to meet others halfway?

Every time something reasonable was asked for/suggested, I complied:

- Separating the `COUNTRIES_RESOLUTION` removal
- Separating the graphviz option file
- Undoing some dependency version bumps (this was less reasonable, for reasons I've pointed out many times before, but I still complied, for the sake of easing review and expediting the merge of this PR)
- Suggestions for properly justified changes (examples: https://github.com/qbittorrent/qBittorrent/pull/12746#discussion_r462026052, https://github.com/qbittorrent/qBittorrent/pull/12746#discussion_r420558482)
- Probably others

>And I lost count of the times you resorted to do personal attacks / snarky comments. It is really not something I would expect to see someone on the team to behave, you better tone it down, that attitude won't get you anywhere.

Like I said above, I only resort to this tone in response to snarky remarks/jerky italics/insultingly condescending tone/etc. I respond proportionately. Yes, it's a waste of time - but time is already wasted once those toxic comments are made - I prefer punching back. I'm not the one who's responsible for starting it. Can you blame people for defending themselves against toxic behavior?

>Also I think you should be confident in approving PRs: either its quality is acceptable or it is not.

Great, you're welcome to address the technical merits of this PR.

As requested in https://github.com/qbittorrent/qBittorrent/pull/12746#discussion_r462952917, I have explained in great detail the reasons for, and advantages of the use of generator expressions. As of yet, I have yet to hear feedback from you on the matter.

I'm waiting for technical arguments and suggestions based on the objective points made in https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-670009173 and previous comments leading up to that. Arguments that point out some great disadvantage with the current approach (and it can't be stuff like ""muh syntax""), and hopefully suggestions for an alternative solution (something actionable). So far the logical conclusion is that this PR provides an objective benefit to the project, and it does so in an objectively good way (i.e., it's not a ""quick hack""). You're welcome to try to argue convincingly why this is not the case. If you can, I'll gladly implement your alternative. If you can't, but still stall this, you're just holding back the project for egotistical reasons (like a stupid grudge or something).

> Just because we do the reviews and held account for it, we are the bad guys holding the PR author back. I never realize I would stuck myself in such situation, funny... I'm tired of this shit.

If you don't do a good job with the review and collaborating in the PR, expect to be called out for holding the project back. This isn't even the only case.

For example, you're welcome to explain to others why stuff like this https://github.com/qbittorrent/qBittorrent/pull/13070 hasn't even received a single comment from you, despite your activity in the repo. Yet that PR has been demonstrated to have great value and to work, and has been approved by others. Meanwhile, enthusiastic users who want to test with recent Windows builds are doomed to either compile themselves or wait for me or xavier2k6 to diligently provide a test build, when it could've all been done automatically by GitHub. Plus I shouldn't have to explain why it's a bad for security to foster a culture of users sharing DIY binaries with each other.

EDIT: another example: https://github.com/qbittorrent/qBittorrent/pull/12697 - a pretty easy one to review, implementing a very nice feature, that's basically just missing a simple executive decision on your part."
686871224,12746,Chocobo1,2020-09-04T02:58:36Z,">Complete and utter BS, basically any exchange between me and others publicly available on this repo proves the contrary. 

Contrary of what? You only proved your harsh attitude to the ones who held opposite opinions and non-stop whining for not merging your PRs early enough.

>I fucking WISH all discussions here could be plain discussions centered purely on technical points. 

Finally a point that I can agree mostly. However, even for technical discussions, there is always subjective preferences involved.

>I'm not the one who's responsible for starting it. Can you blame people for defending themselves against toxic behavior?

You're targeting the wrong person, I'm not the one throwing aggressive words here, at least not before you start on me. Generally speaking, using salty attitude to response to others only demonstrates your personality, it doesn't make you better or get even with others. And I must add, that trait of yours is already having negative effects with at least one of the team members. 

>As of yet, I have yet to hear feedback from you on the matter.

Hey, you must be very opinionated, well I'm not.
Also Let me remind you for the last time: I'm only interested in what interest me and I would say something when I feel the need so stop bossing me and the others on how we do our part, otherwise it makes you look like a tyrant.

>If you can, I'll gladly implement your alternative. If you can't, but still stall this, 

In your words: ""Complete and utter BS"". You live in a binary world, but others are not.

>If you don't do a good job with the review ...

I think I did the best I could. And who gives you the rights to judge others? You're merely given the permission to help with the issue list, isn't?

I believe it is time, let me ask this upmost important question: What would I need to do to get you off my back?
"
686882415,12746,eli-schwartz,2020-09-04T03:35:14Z,"Since the current blocker seems to be ""I don't like genexp"" and the arguments on both sides seem to be ""I think my preference looks prettier"", I think it's becoming increasingly obvious that the PR would benefit by being split out into logically distinctive changes.

> But things change and now looking at the diff, it doesn't make so much sense to me, so I asked if your opinion had changed

Maybe I'm just a boring mailing list lover and patch file review fan (yes, I do consider commit messages something to review as well). And it's not like I am important here. But I actually don't ever see a reason to *avoid* splitting out logically distinct changes; it's a sign of development hygiene and helps to let changes be reviewed simultaneously, backported easily, and merged in arbitrary order.

More importantly, it would let useful changes everyone can agree on, be accepted *now*, which I actually do have strong feelings about w.r.t. feature/summary improvements, because I don't develop qBittorrent and don't spend much time reading its build system, but I *do* maintain it for a Linux distro and if qmake is dropped due to Qt 6 and cmake is chosen to be the sole build system, I want to be able to build it using cmake without gouging out my eyes every time I want to pass options to it. :)

(I would also be willing to help port this to meson, and I've already added at least one new feature to meson specifically because while glancing at the qBittorrent compilation process, I discovered something that could not be done easily and I wanted to make it easier. https://github.com/mesonbuild/meson/commit/1de1cc22e2fcc56860ee8174e375070c062f5b30 IMHO meson now has *the* nicest way to handle qrc-based translations out of any build system.)"
686929010,12746,glassez,2020-09-04T05:59:57Z,">the current blocker seems to be ""I don't like genexp"" 

Personally, I am not against genexps, I am against their overuse. I expressed this opinion as soon as it was added as a separate commit. There were also other similar opinions (at least one), but @FranciscoPombal merged it with other changes despite that attentions.
>the arguments on both sides seem to be ""I think my preference looks prettier""

You're wrong. My argument is that there is some community here (a team, however small). And if two out of three say that something is ""shit"", then it is (at least within this community, even if there are many supporters of the opposite opinion outside). What is more important is not the abstract ""improvements"" themselves, but only the benefits they can bring to the project. But what might be the benefit if something causes inconvenience to the majority of the members of the team? Even if this is due to the lack of coolness of the team, but in any case, it will be more useful if we use the tools that are convenient for us, than to try to achieve some ideals, making it an end in itself. If an idea is good in its essence, it will still find its application when people grow up to it. But then it will be really useful.

"
687066018,12746,FranciscoPombal,2020-09-04T10:33:47Z,"@Chocobo1 

> Contrary of what? You only proved your harsh attitude to the ones who held opposite opinions and non-stop whining for not merging your PRs early enough.

This point isn't specifically about _my_ PRs. Previously I gave https://github.com/qbittorrent/qBittorrent/pull/13070 and https://github.com/qbittorrent/qBittorrent/pull/12697 as an example. I'm rightfully complaining about useful PRs not getting the attention they deserve in a timely fashion.

> You're targeting the wrong person, I'm not the one throwing aggressive words here, at least not before you start on me. Generally speaking, using salty attitude to response to others only demonstrates your personality, it doesn't make you better or get even with others. And I must add, that trait of yours is already having negative effects with at least one of the team members.

In that specific comment and in the context of this PR, you were not really the target of that comment, that's true. I'm just saying that I deal with BS comments a certain way. It's fine by me if you disagree with my methods of dealing with such things, and decide to employ other methods for yourself. But I don't think it's fair for you to tell me that I ""better tone it down"", as if there wasn't a good reason for me to act this way. Additionally, saying stuff like ""most of the time you don't really want to make an effort to meet them [my viewpoints]."" is just unfair and a misrepresentation of facts.

> Hey, you must be very opinionated, well I'm not.
Also Let me remind you for the last time: I'm only interested in what interest me and I would say something when I feel the need so stop bossing me and the others on how we do our part, otherwise it makes you look like a tyrant.

I'm not bossing anyone around. Certain people have certain responsibilities in a project. If you feel you are being ""bossed around"", couldn't that be a symptom of something? Is it too much to expect that one of the only two contributors with merge access be a little more proactive in certain PRs? Especially now that the maintainer has been missing for so long. Honestly, even a little comment like ""hey, I can't really address this right now, but I'll check it out""/""Thanks for the links and explanations, I'll think about the genexp changes and post some feedback later"" would have been nice.

> In your words: ""Complete and utter BS"". You live in a binary world, but others are not.

I think expecting at least a little feedback is reasonable.

>I think I did the best I could. And who gives you the rights to judge others? You're merely given the permission to help with the issue list, isn't?

I don't need permission to judge others. It's not like I'm saying you're doing a terrible job all around. You do review many PRs and submit nice improvements to the project. I think I'm judging you fairly. On my part, I have helped solve, close, and lock _hundreds_ of issues, including very important ones about performance, and issues that ended up exposing bugs in libtorrent. All this despite the deck being stacked against me - my PRs about new issue templates and contributing guidelines have been stalled for a long time, which means low-quality/information issues keep getting posted, which makes my task more difficult. There's a reason why we're still below 2900 issues without resorting to extreme tactics, and it's not magic. I think I'm doing a good job overall - not a perfect one, as I do recognize I could do a better job labeling issues, for instance (I think I need to add a few labels... I should get around to that). But if you don't think so, or have other criticisms that I'm not thinking of, you're more than welcome to share them.  The team page would be a good place for this, to not derail this further. A team member has done so in the past, and things went very well.

>I believe it is time, let me ask this upmost important question: What would I need to do to get you off my back?

Provide timely feedback to help expedite merging important PRs for the project. If during a certain time period, the reason you don't do so is because you go on vacation or have other IRL stuff to attend to, that's fine. But considering your position in the project, I don't think it's reasonable to keep ignoring PRs like https://github.com/qbittorrent/qBittorrent/pull/13070 and https://github.com/qbittorrent/qBittorrent/pull/12697, or providing feedback in this one, when you're otherwise active in the repo.

@eli-schwartz @glassez 

> There were also other similar opinions (at least one), but @FranciscoPombal merged it with other changes despite that attentions.

It's not like the genexp change came out of the blue. it came naturally, and out of necessity, as I've stated before. The overall logic that had already been reviewed remained the same. You can think of genexps as just a refactoring. Also, as I recall, you were the only one that at least attempted to provide some arguments against the change other than ""genexp syntax bad"" (feel free to point if there is indeed such a comment from someone else, I don't feel like digging through everything else right now).

> ... https://github.com/mesonbuild/meson/commit/1de1cc22e2fcc56860ee8174e375070c062f5b30 IMHO meson now has *the* nicest way to handle qrc-based translations out of any build system.)

That does seem nice, especially because they fully embrace this:

> Sometimes, translations are embedded inside the binary using qresource files.

But personally, at least for now, I see a great future in CMake in this project. Have you tried out this PR, recently? Is there anything in particular you think should be done in a significantly different way? What are the itches that remain to be scratched, in your opinion? As a reminder, a list of future improvements I plan to build on top of this are listed in the middle of this comment: https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-685947159

---

I have decided what I am going to do. I'm going to submit an alternative PR called ""CMake scripts overhaul, alternative implementation"" (sorry for the unoriginal name). In this PR, I will attempt to do a bug-for-bug implementation of this one, but with no (or at least, as little as possible) genexps, so that we can all clearly see the difference and better reason about the differences in implementation and pros and cons of each. I don't think everyone will be happy, but at least it's a positive result for the project if one of the PRs gets merged (and, of course, whichever one gets approved, I'll separate the commits into discrete changes as best as I can)."
687077527,12746,glassez,2020-09-04T11:03:15Z,"> I'm going to submit an alternative PR [...]. In this PR, I will attempt to do a bug-for-bug implementation of this one

I would even ask you to publish all trivial changes as a separate PR.

>so that we can all clearly see the difference and better reason about the differences in implementation and pros and cons of each. 

I hope you don't intend to make the alternative version deliberately worse... To show real differences in approaches, you have to make it as high-quality as the existing one (just imagine that you really want it, but genexps don't exist, at least where it's not strictly required)."
687085914,12746,Chocobo1,2020-09-04T11:24:54Z,">But I don't think it's fair for you to tell me that I ""better tone it down"", as if there wasn't a good reason for me to act this way. 

Yes I can, as I said before, (some of) your behavior is already affecting the team morale.

>If you feel you are being ""bossed around"", couldn't that be a symptom of something?

Yes, in a way, I do feel being harassed. I expect you to respect my (and all others) way of participating in this project, how I participate is my freedom and you shouldn't step on it.

>Is it too much to expect that one of the only two contributors with merge access be a little more proactive in certain PRs? 

There used to be 3 of us (without counting the maintainer), but at that time things wasn't prettier than now. 
I would expect the new member to be able to work with other members **harmoniously**.

>I don't need permission to judge others. 

You're missing the point: you don't judge others. If you do, you can drop expectation of having mutual respect (and you can go straight full rampage mode if you like).

>Provide timely feedback to help expedite merging important PRs for the project. If during a certain time period, the reason you don't do so is because you go on vacation or have other IRL stuff to attend to, that's fine.

Are you going to compensate me for putting more time in this project? I guess not. Then I'm sorry you don't get to tell me how I allocate my free time or the way I go.
BTW, this is the last warning I will give you, if you keep acting like a dictator, don't be surprised I get you on my block list again, this is the only way I could do to keep your distance from me.

>I don't think it's reasonable to keep ignoring PRs like #13070 and #12697, or providing feedback in this one, when you're otherwise active in the repo.

No comments until others express active supporting (and or approval) of them.
"
687135686,12746,eli-schwartz,2020-09-04T13:11:41Z,"@glassez 

> You're wrong. My argument is that there is some community here (a team, however small). And if two out of three say that something is ""shit"", then it is (at least within this community, even if there are many supporters of the opposite opinion outside). What is more important is not the abstract ""improvements"" themselves, but only the benefits they can bring to the project. But what might be the benefit if something causes inconvenience to the majority of the members of the team? Even if this is due to the lack of coolness of the team, but in any case, it will be more useful if we use the tools that are convenient for us, than to try to achieve some ideals, making it an end in itself. If an idea is good in its essence, it will still find its application when people grow up to it. But then it will be really useful.

I'm not disputing that. From what I can tell, the objection is not ""this makes the build system less efficient"" but rather ""I don't like the syntax"". The obvious application of ""I don't like the syntax"" is that it makes it less pleasant to have to personally deal with. That means it inconveniences you without bringing benefits. But

> something is ""shit""

is not an accurate summary, because it gives the (false?) impression that you'd recommend to the world that no one use them, when all that matters is whether it helps the qBittorrent maintainers keep track of their own build system.

Personal taste in syntax *does* matter and can have very real effects on maintainability. All I'm saying is that it's helpful to keep in mind that that is, in the end, what it is.

I think we more or less agree with each other on that, though. :)

@FranciscoPombal opening a new PR with an alternative implementation is slightly missing the point of what I said, which is that given there is currently a conflict of opinions in how to approach this case, it would be best to separately PR individual changes that can be agreed on, and get them cleared out of the way. Yes, it's more work than one mega-commit, but in the end it is more readable and bisectable, and brings some improvements to everyone, faster, even if it isn't *everything* you wanted to do.

It will then be easier to reason about the effect that genexps have on the codebase, and which precise benefits it might have."
687137672,12746,glassez,2020-09-04T13:15:11Z,">Also, as I recall, you were the only one that at least attempted to provide some arguments against the change other than ""genexp syntax bad"" 

Yes, and I'll sum it up here.
I do not mind using genexps, at least to solve the tasks for which they are intended (let me remind you, they are not intended to replace other tools).
I don't even mind if genexps are used in some other places, as long as the use is justified.
But you overuse them, which leads to the fact that the CMake project becomes an end in itself (or Vice versa, you treat the CMake project as the basis of the basics, so you overuse its concepts, in particular genexps).
BUT the build system is just a ""slave"" within the entire PROJECT, so it should modestly do its job, not dictate its own rules. All its elements are just tools, and they should not define the logical structure of the PROJECT, but be used according to the existing one.
So I think it's much more convenient to see the following CMake project structure (generally):
1. Common declarations 
2. Platform dependent declarations (per platform)
3. Feature dependent declarations (per feature)
3.1. Common declarations 
3.2. Platform dependent declarations (per platform)

By overusing genexps all this structure is lost in CMake entities."
687204823,12746,FranciscoPombal,2020-09-04T15:03:04Z,"@glassez 

> > I'm going to submit an alternative PR [...]. In this PR, I will attempt to do a bug-for-bug implementation of this one
> 
> I would even ask you to publish all trivial changes as a separate PR.

Out of all these changes, which ones exactly/what type of changes do you consider good ""trivial"" candidates to extract from the main PR? You don't need to list every case, just a few examples so I can get the picture.

> I hope you don't intend to make the alternative version deliberately worse... To show real differences in approaches, you have to make it as high-quality as the existing one (just imagine that you really want it, but genexps don't exist, at least where it's not strictly required).

Of course I won't make it deliberately worse, I intend to give it the best possible choice (in fact, I will be basically doing the exact same thing I did before the genexp change, with some improvements that I've learned along the way...). Otherwise it would just be a pointless exercise in pettiness. I want to get a real improvement merged as much as anyone else.

@eli-schwartz 

>@FranciscoPombal opening a new PR with an alternative implementation is slightly missing the point of what I said, which is that given there is currently a conflict of opinions in how to approach this case, it would be best to separately PR individual changes that can be agreed on, and get them cleared out of the way. Yes, it's more work than one mega-commit, but in the end it is more readable and bisectable, and brings some improvements to everyone, faster, even if it isn't *everything* you wanted to do.
>
>It will then be easier to reason about the effect that genexps have on the codebase, and which precise benefits it might have.

I guess we disagree then. The way I see it: regardless of how I split up these changes, there is fundamental disagreement about the overall approach. Others are not convinced that current way is the best one to do things, syntax notwithstanding. So I think splitting the commits now would be extra work that would not really get us anywhere, as there is no disagreement about that. The plan then becomes to make an equivalent PR but without genexps (as one mega-commit as well), to compare both overall approaches. After a decision is made between both PRs, I'll work on splitting commits until a good degree of separation is achieved. Actually, we might end up reaching a consensus about the final change being a mix of the two.

---

@glassez 

> BUT the build system is just a ""slave"" within the entire PROJECT, so it should modestly do its job, not dictate its own rules. All its elements are just tools, and they should not define the logical structure of the PROJECT, but be used according to the existing one.

I agree. But the changes I made require absolutely no changes to the current organization of the project. I believe that a well thought-out buildsystem gets out of your way, and ideally, even helps you reason about the overall structure and architecture of your project. Much the same way a well-thought out directory structure for the project helps you in this regard a little bit as well.

The current architecture reads like this:

- There is a project
- The project is made up of components (gui, base, webui, app)
- Each component is a build target that has requirements (source files, compile options, definitions, link options, ...) and a relationship to other targets
- Each requirement is specified in place, and its logic depends on platform and features, but is specified independently of other targets' requirements
- It's easy to add new components, change the requirements for existing ones, or otherwise switch things around to a great extent without fear of breaking anything else (i.e., it is not brittle).

The problem with

>So I think it's much more convenient to see the following CMake project structure (generally):
>1. Common declarations 
>2. Platform dependent declarations (per platform)
>3. Feature dependent declarations (per feature)
>3.1. Common declarations 
>3.2. Platform dependent declarations (per platform)

Is that does not allow for the same kind of separation of logic. Every requirement for every target is potentially all over the place.

Wait for the other PR to see the difference. I hope I can show it more clealy. "
687232307,12746,FranciscoPombal,2020-09-04T15:48:01Z,"@Chocobo1 

> Yes I can, as I said before, (some of) your behavior is already affecting the team morale.

> There used to be 3 of us (without counting the maintainer), but at that time things wasn't prettier than now.
I would expect the new member to be able to work with other members **harmoniously.**

Some of _others_ behavior at times is affecting _my_ morale as well. I expect my posts to be interpreted in that context. Again, in the context of this specific PR, some of this kind of behavior I speak of is not referencing you.

> You're missing the point: you don't judge others. If you do, you can drop expectation of having mutual respect (and you can go straight full rampage mode if you like).

I guess we agree to disagree here, but I don't want to continue this discussion.

> Yes, in a way, I do feel being harassed. I expect you to respect my (and all others) way of participating in this project, how I participate is my freedom and you shouldn't step on it.

>Are you going to compensate me for putting more time in this project? I guess not. Then I'm sorry you don't get to tell me how I allocate my free time or the way I go.

At times, the ball is in your court, and your the only one that make a play. Sometimes, there are a things that may stall because they depend on such a play. Certain ways of not participating in the project can limit other's freedom to participate as well.

The thing is, there are times where your input has been required and you simply did not do anything despite being otherwise active in the repo. I'm sorry, but due to the project's organizational structure, such responsibilities fall on you. If your action is radio silence, that is going to be interpreted as carelessness, disrespect or some kind of discrimination against the other project members/contributors (no, not necessarily of the ""SJW"" kind, could be just ""I don't like them""). For example, I felt like ignoring https://github.com/qbittorrent/qBittorrent/pull/13070 was starting to become disrespectful to the ones who take their time to prepare test builds. To me, not devoting enough attention to such PRs, even after judicious tagging (and bear in mind this is a span of months), makes me feel like that kind of work is being taken for granted.

>BTW, this is the last warning I will give you, if you keep acting like a dictator, don't be surprised I get you on my block list again, this is the only way I could do to keep your distance from me.

This is far from me being a dictator. There are some responsibilities that I feel like you haven't lived up to lately.

> No comments until others express active supporting (and or approval) of them.

Right; I appreciate that you have already engaged in https://github.com/qbittorrent/qBittorrent/pull/13070, but in https://github.com/qbittorrent/qBittorrent/pull/12697, it's precisely your input (and later, approval) that's needed now, to start converging on a concrete decision. It's obvious that people are waiting on _your_ decision and will maybe even consider changing/adjusting their own positions based on it. You are one of the two main active contributors _and_ you have commit access, so your opinion/decision bears a lot of weight and swaying power. This is the kind of responsibility I refer to."
687245210,12746,Chocobo1,2020-09-04T16:12:47Z,">> BTW, this is the last warning I will give you, if you keep acting like a dictator, don't be surprised I get you on my block list again, this is the only way I could do to keep your distance from me.
>
>This is far from me being a dictator. There are some responsibilities that I feel like you haven't lived up to lately.

Those are the exact words that would come out from a dictator (or in another word, micromanagement): pointing fingers to others and micromanage their job. I really do hope you get the warning and keep your distance.
"
687461506,12746,FranciscoPombal,2020-09-04T23:20:44Z,https://github.com/qbittorrent/qBittorrent/pull/13327
150964356,3989,Pireo,2015-10-25T20:06:18Z,"Demonoid can eventually make use of this function, since it does search in description too.
"
151027736,3989,DoumanAsh,2015-10-26T05:23:44Z,"Can you please also add screenshot of how it looks with current code at the head's message?
"
151040707,3989,DoumanAsh,2015-10-26T06:26:05Z,"I made small review for you. This is mostly style though
"
151091244,3989,glassez,2015-10-26T10:19:16Z,"@evsh NOTE: This PR may interfere and conflicts with #3832.
"
151115095,3989,zeule,2015-10-26T12:14:21Z,"Thanks to all of you for the edits and suggestions. It seems to me that rebasing commits from PR #3832  on top of this one is easier than vice-versa.
"
151118099,3989,zeule,2015-10-26T12:29:50Z,"> Can you please also add screenshot of how it looks with current code at the head's message?

Yes, please. (Screenshot moved into the top post)
"
151137522,3989,glassez,2015-10-26T13:43:39Z,"> It seems to me that rebasing commits from PR #3832 on top of this one is easier than vice-versa.

I don't think so. Usually, when there is simultaneous change and move, have to manually add some things.
Okay, let maintainer decides which one of us will have to suffer.
"
151151251,3989,zeule,2015-10-26T14:19:08Z,"> Usually, when there is simultaneous change and move, have to manually add some things.

Yes, I meant that resolving a conflict before the files got renamed and split should be easier. 
"
151197558,3989,DoumanAsh,2015-10-26T16:29:47Z,"I looked over picture and in my opinion it looks good without extending vertically space for filter bar.
Compact and nice!
I will leave review to someone more capable :)

**UPD:**
But maybe you should change a bit flag `Names only` it looks strange a bit comparing to other fields i.e. you should follow the same style for all fields i think
"
151228526,3989,zeule,2015-10-26T18:01:49Z,"> But maybe you should change a bit flag Names only it looks strange a bit comparing to other fields i.e. you should follow the same style for all fields i think

@DoumanAsh can you suggest something, please? Because I can't understand what style do you mean.
"
151296779,3989,DoumanAsh,2015-10-26T22:01:01Z,"@evsh Sorry.
I'll try to illustrate it with my _awful_ Paint skills:
http://i.imgur.com/aVsRGDo.png

Green is name and red is value.
`Names only` flag looks off comparing to Seeds/Size filters

At least for me.
"
151302309,3989,zeule,2015-10-26T22:25:51Z,"@DoumanAsh thank toy for the illustration. Do you mean that the label in ""Names only"" is at the right side from the value widget, while all other labels are at the left side? If so, I do not know what can I do about this. QCheckBox looks like it looks, I do not want to change it. Neither I want to move all other label to the right side.  What to you want to change?
"
151371223,3989,glassez,2015-10-27T04:21:12Z,"@DoumanAsh is right here. You need to put the label before the checkbox (you never seen one?).
"
151371997,3989,zeule,2015-10-27T04:30:36Z,"Dou you want a checkbox without a label and a separate label at the left side of the checkbox?
"
151379678,3989,DoumanAsh,2015-10-27T05:35:15Z,"OH... sorry. i actually didn't put much though about how CheckBox works.
Yes, if it doesn't allow to specify how CheckBox label is placed, then it would be better to place separate label.

It is just difficult not to notice how it is off comparing to other boxes,
"
151385572,3989,glassez,2015-10-27T06:15:51Z,"@evsh You can change QCheckBox layoutDirection property to Qt::RightToLeft.
"
151465828,3989,zeule,2015-10-27T11:47:10Z,"Since such HIG rules violation is new to me, I did not know hot to properly do that. So, @glassez , thanks for the help! 
But before committing this sin, could you evaluate the following variant, please?
![qbt-filter-search-new-layout](https://cloud.githubusercontent.com/assets/394621/10756999/04bd5082-7ca8-11e5-9979-466f8fa71fbd.png)
"
151469569,3989,Pireo,2015-10-27T12:03:49Z,"I would call it ""Search in TORRENT names only"" because ""names"" can also refer to files.
"
151480141,3989,glassez,2015-10-27T12:45:58Z,"> Since such HIG rules violation is new to me, I did not know hot to properly do that

Horizontally arranged checkboxes it's the same HIG violation!
If you want to avoid this, why don't you try to use a different control? For example, QComboBox with following values: ""Everywhere"", ""Torrent names only"", and with ""Search in:"" label?
"
151482608,3989,zeule,2015-10-27T12:54:22Z,"> Horizontally arranged checkboxes it's the same HIG violation!

Agree, combobox would not cause such problem. Checkbox is used because it is much easier to click it than to select a value from a combobox. I've rejected combobox but maybe it is better to return to this option?
"
151538861,3989,DoumanAsh,2015-10-27T15:22:34Z,"@evsh Not sure, but i think there is no need to add ""Enable"" after checkbox

Anyway i have no idea about HIG :D so dunno what to say...
Combobox might as well work. Mostly it will be the same checkbox
"
151539855,3989,glassez,2015-10-27T15:25:59Z,"IMO, it should be either checkbox without ""Enabled"" after it or combobox.
"
151552486,3989,zeule,2015-10-27T16:06:18Z,"I thank all of you for the suggestions. Let it be a combobox.
"
152278873,3989,ngosang,2015-10-29T18:35:07Z,"Why you don't replace the ""no limit"" string with ""min"" and ""max"" so we can remove the labels and save space. Example:
![](https://camo.githubusercontent.com/efe6a6ffe7ea5ea5fae71941d09cf65642d7ba8c/687474703a2f2f692e696d6775722e636f6d2f4d5257415a6a6b2e706e67)
"
152286475,3989,zeule,2015-10-29T18:55:40Z,"If both spin boxes show numbers but not ""min"" or ""max"", this part of the panel would reads ""Seeds  xx xx"" which is understandable (additionally, we can put a dash between the spin boxes ), but if on of them contains a number and the other one a special string, the phrase becomes too incorrect. We can change labels text a bit to shorten them. For instance, ""Seeds from xx to xx"" reads almost correctly and is already shorter. Maybe even ""Seeds: xx to xx"" is it still clear? Special cases are also not a problem then: ""Seeds: 100500 to no limit"". What do you think?
"
152726821,3989,Pireo,2015-10-31T11:55:18Z,"@ngosang do you think demonoid can be restored to its original behavior (searches among description too) and let these filters do their work on it?
"
152726867,3989,DoumanAsh,2015-10-31T11:56:53Z,"@Pireo 
This is intention of this commit.
Once it will be delivered, all filtering will be done via new interface in search tab.
Nothing will be done in search engines
"
152740226,3989,Pireo,2015-10-31T14:39:10Z,"@DoumanAsh I'm just saying this in case someone didn't notice the current behavior of demonoid.
"
152822120,3989,sledgehammer999,2015-11-01T12:11:59Z,"Sorry for the very late input in this PR and to #3812. Yes, I agree with the scope of this.
I didn't review the code. I looked at both discussions and the screenshots posted.

First of all I agree with this:

> For instance, ""Seeds from xx to xx"" reads almost correctly and is already shorter. Maybe even ""Seeds: xx to xx"" is it still clear? Special cases are also not a problem then: ""Seeds: 100500 to no limit"". What do you think?

And the same be done to ""size"" filter. In this cases (seeds/size) no size should be indicated by `-`.

Something else that occurred to me to save space(@evsh I am not expecting you to do it if you don't want to):
To get rid of the search status line. Like most browsers we should indicate the status in the tab via an icon. eg completed->a check icon, ongoing->throbber icon, canceled->""x""/stop icon.
Note: we already have `src/icons/skin/spinner.gif`

PS: I'm going to review/merge this for v3.3.1.
"
152864140,3989,DoumanAsh,2015-11-01T21:08:36Z,"@evsh 
For next update, please, add `Closes #972` into commit title.
This is some old wish to have such filters, found it while looking for search engine issues.
"
153096672,3989,zeule,2015-11-02T17:43:44Z,"@DoumanAsh  Thank you, I've changed the title. Filtering by date is not implemented, thus only ""partially closes"".
"
153097100,3989,sledgehammer999,2015-11-02T17:45:28Z,"@evsh he change the commit message. You can do it for the last commit `git commit --amend` and then `git push --force <your repo alias>`
"
153103756,3989,zeule,2015-11-02T18:04:53Z,"@ngosang , @sledgehammer999 
The labels were changed. Now they read: ""Seeds: xx (or ""no limit"") to yy (or ""no limit"")"". I don't like the idea to replace ""no limit"" with ""-"". Is it really that much better in your opinion to have a bit shorter widget but to loose correctness of the sentence?  Do all languages use dash as a replacement for absence of data? Otherwise in those which do not the filter panel will be significantly longer than in English.
"
153117333,3989,DoumanAsh,2015-11-02T18:30:13Z,"@evsh Oh... i wasn't very attentive when looking over search issues.
well at least there will be reference to this RP so that the one who raised issue will be able to see that something is changed.

About no limit.
I think we can use the same symbol as for other limits in qBt:

# ∞

What do you think guys?
I think infinity should work out, besides we already have it in use.
"
153123459,3989,zeule,2015-11-02T18:53:54Z,"And what then should be used for the smallest possible value? ε?
"
153124904,3989,DoumanAsh,2015-11-02T18:59:38Z,"@evsh 
Umm... shouldn't infinity works both ways?

p.s. well that's the only thing i remember from math :D
"
153126996,3989,zeule,2015-11-02T19:08:26Z,"I guess the discussion yields that special symbol for minimal values is not needed, because neither seeds number nor size can not be smaller than zero. So we can use zero.
"
153127532,3989,DoumanAsh,2015-11-02T19:10:24Z,"Oh yes... that's the most obvious approach...
"
153151479,3989,sledgehammer999,2015-11-02T20:46:25Z,"Yeah, use 0 for min and [C_INFINITY](https://github.com/qbittorrent/qBittorrent/blob/master/src/core/unicodestrings.h#L37) for max
"
153176890,3989,zeule,2015-11-02T22:23:48Z,"> Yeah, use 0 for min and C_INFINITY for max

Done.
"
153340614,3989,Pireo,2015-11-03T12:41:46Z,"Guys, just a question: do you believe torrentreactor is better now making use of this option, or with the in-py file filters? Because it doesn't search in description or files, just fakes, and I guess nobody would like to have them.
"
153413508,3989,DoumanAsh,2015-11-03T16:48:47Z,"@Pireo 
It is difficult to implement search in description by ourself.
And it would be more right to make it on torrentreactor side.

These filters will work only with currently available data and nothing more.
"
153484462,3989,Pireo,2015-11-03T20:51:11Z,"@DoumanAsh no, I was just saying to let it already filtered of the fakes, without any option filter to work on it.
"
153498757,3989,ngosang,2015-11-03T21:43:29Z,"@all I'm living aboard and I don't have a machine with linux to test the code. I will be back next month but you can keep working on this and merge without my review. :smile: 
"
153682530,3989,Pireo,2015-11-04T10:52:49Z,"I was thinking about a filter that only displays torrents with the exact word and not as part one another one
ex. if I search ""night"" and I don't wish to find ""nightmare"" this could help. Worth it?
So the menu can be similar to the ones for seeds and size. ""Find: everything; torrent names; exact word"".
"
153761840,3989,zeule,2015-11-04T15:25:07Z,"@Pireo , do you mean that the in this mode an item is not rejected only if the search term is followed by a delimiter character or end of string?
"
153855367,3989,Pireo,2015-11-04T20:38:17Z,"@evsh only if it is followed and preceded by space I guess, it's just an idea.
"
154753570,3989,ngosang,2015-11-07T21:36:45Z,"Crash in linux with qt5.
Steps to reproduce:
1) Type ""test"" without quotes
2) Press Enter or click the Search button

```
*************************************************************
Catching SIGSEGV, please report a bug at http://bug.qbittorrent.org
and provide the following backtrace:
qBittorrent version: v3.3.0beta
stack trace:
  /usr/lib/libQt5Core.so.5 : QString::operator=(QString const&)+0x20  [0x7fa1c679dbb0]
  /usr/lib/libQt5Widgets.so.5 : QAbstractSpinBox::setSpecialValueText(QString const&)+0x11  [0x7fa1c7f3db41]
  ./src/qbittorrent : SearchTab::SearchTab(SearchEngine*)+0x550  [0x652a50]
  ./src/qbittorrent : SearchEngine::on_search_button_clicked()+0xcc  [0x64845c]
  ./src/qbittorrent() [0x66c955]
  ./src/qbittorrent : SearchEngine::qt_metacall(QMetaObject::Call, int, void**)+0x35  [0x66cb45]
  /usr/lib/libQt5Core.so.5 : QMetaObject::activate(QObject*, int, int, void**)+0x970  [0x7fa1c691e2e0]
  /usr/lib/libQt5Widgets.so.5 : QAbstractButton::clicked(bool)+0x42  [0x7fa1c81d6a92]
  /usr/lib/libQt5Widgets.so.5 : ()+0x279114  [0x7fa1c7f39114]
  /usr/lib/libQt5Widgets.so.5 : QAbstractButton::click()+0x71  [0x7fa1c7f397b1]
  /usr/lib/libQt5Widgets.so.5 : ()+0x516cc5  [0x7fa1c81d6cc5]
  /usr/lib/libQt5Core.so.5 : QMetaObject::activate(QObject*, int, int, void**)+0x7ba  [0x7fa1c691e12a]
  /usr/lib/libQt5Widgets.so.5 : ()+0x2d21d5  [0x7fa1c7f921d5]
  /usr/lib/libQt5Core.so.5 : QMetaObject::activate(QObject*, int, int, void**)+0x7ba  [0x7fa1c691e12a]
  /usr/lib/libQt5Widgets.so.5 : QWidgetLineControl::processKeyEvent(QKeyEvent*)+0x31f  [0x7fa1c801c95f]
  /usr/lib/libQt5Widgets.so.5 : QLineEdit::keyPressEvent(QKeyEvent*)+0x1a  [0x7fa1c7f8bb3a]
  /usr/lib/libQt5Widgets.so.5 : QWidget::event(QEvent*)+0x997  [0x7fa1c7e7f367]
  /usr/lib/libQt5Widgets.so.5 : QLineEdit::event(QEvent*)+0x79  [0x7fa1c7f925f9]
  /usr/lib/libQt5Widgets.so.5 : QApplicationPrivate::notify_helper(QObject*, QEvent*)+0x8c  [0x7fa1c7e3c01c]
  /usr/lib/libQt5Widgets.so.5 : QApplication::notify(QObject*, QEvent*)+0x1e43  [0x7fa1c7e430e3]
  ./src/qbittorrent : Application::notify(QObject*, QEvent*)+0x22  [0x4ac9c2]
  /usr/lib/libQt5Core.so.5 : QCoreApplication::notifyInternal(QObject*, QEvent*)+0xdb  [0x7fa1c68ef9ab]
  /usr/lib/libQt5Widgets.so.5 : ()+0x1dbb43  [0x7fa1c7e9bb43]
  /usr/lib/libQt5Widgets.so.5 : QApplicationPrivate::notify_helper(QObject*, QEvent*)+0x8c  [0x7fa1c7e3c01c]
  /usr/lib/libQt5Widgets.so.5 : QApplication::notify(QObject*, QEvent*)+0x256  [0x7fa1c7e414f6]
  ./src/qbittorrent : Application::notify(QObject*, QEvent*)+0x22  [0x4ac9c2]
  /usr/lib/libQt5Core.so.5 : QCoreApplication::notifyInternal(QObject*, QEvent*)+0xdb  [0x7fa1c68ef9ab]
  /usr/lib/libQt5Gui.so.5 : QGuiApplicationPrivate::processKeyEvent(QWindowSystemInterfacePrivate::KeyEvent*)+0x12e  [0x7fa1c7661d2e]
  /usr/lib/libQt5Gui.so.5 : QGuiApplicationPrivate::processWindowSystemEvent(QWindowSystemInterfacePrivate::WindowSystemEvent*)+0x115  [0x7fa1c7666dc5]
  /usr/lib/libQt5Gui.so.5 : QWindowSystemInterface::sendWindowSystemEvents(QFlags<QEventLoop::ProcessEventsFlag>)+0x28  [0x7fa1c764c208]
  /usr/lib/libQt5XcbQpa.so.5 : ()+0x6b3c0  [0x7fa1bc86f3c0]
  /usr/lib/libglib-2.0.so.0 : g_main_context_dispatch()+0x2a7  [0x7fa1c47badc7]
  /usr/lib/libglib-2.0.so.0 : ()+0x4a020  [0x7fa1c47bb020]
  /usr/lib/libglib-2.0.so.0 : g_main_context_iteration()+0x2c  [0x7fa1c47bb0cc]
  /usr/lib/libQt5Core.so.5 : QEventDispatcherGlib::processEvents(QFlags<QEventLoop::ProcessEventsFlag>)+0x5f  [0x7fa1c694634f]
  /usr/lib/libQt5Core.so.5 : QEventLoop::exec(QFlags<QEventLoop::ProcessEventsFlag>)+0x10a  [0x7fa1c68ed37a]
  /usr/lib/libQt5Core.so.5 : QCoreApplication::exec()+0x9c  [0x7fa1c68f533c]
  ./src/qbittorrent : Application::exec(QStringList const&)+0x1d3  [0x4af2d3]
  ./src/qbittorrent : main()+0x48d  [0x4a6aad]
  /usr/lib/libc.so.6 : __libc_start_main()+0xf0  [0x7fa1c581c610]
  ./src/qbittorrent : _start()+0x29  [0x4aa999]
./compilerun.sh: line 2: 11551 Segmentation fault      (core dumped) ./src/qbittorrent
```
"
154754060,3989,ngosang,2015-11-07T21:45:18Z,"I want this changes:
1) Search in Options should be: ""Torrent name"" and ""Torrent name and files""
2) By default Search in option should be ""Torrent name""
3) Remove B, PiB and EiB from combos
4) Max torrent size should be 1000 TiB by default instead of 1000 B
"
154885421,3989,zeule,2015-11-08T23:09:39Z,"> Crash in linux with qt5.

Mea culpa! Committing without testing is... Well, you know that.
BTW, @sledgehammer999 , I've put code which sets special value text for search control into a wrong file (searchtab.cpp instead of searchengine.cpp), hence the crash. But compilation passed because SearchTab class also inherited Ui::search_engine. I guess it is a leftover from a refactoring, because when I removed the inheritance compilation passed. Is it correct guess?  
"
154886118,3989,zeule,2015-11-08T23:22:39Z,"@ngosang , could you clarify the reasoning behind your suggestions, please?

> I want this changes:
> 1) Search in Options should be: ""Torrent name"" and ""Torrent name and files""

Why? Are we sure that all search engines do not (and will not) search anywhere else except file names and torrent names? 

> 3) Remove B, PiB and EiB from combos

Why? I could understand that you do not believe in usefulness of PiB and EiP, but why remove bytes? 

> 4) Max torrent size should be 1000 TiB by default instead of 1000 B

It is actually equal to infinity by default.  I will fix the UI. The panel even should be disabled before the search gets activated.  Do you want the limit be 1000 TiB instead? 
"
154890519,3989,sledgehammer999,2015-11-09T00:16:24Z,"> But compilation passed because SearchTab class also inherited Ui::search_engine. I guess it is a leftover from a refactoring, because when I removed the inheritance compilation passed. Is it correct guess? 

Are you talking about `#include ""ui_search.h""` in searchtab.h? Well, git blame shows that line was introduce back in 2008. I wasn't part of the project then. If it compiles, then I guess you can remove it.

I don't think it is wise to drop B, unless we want to equate the lack of unit as ""bytes"".
About the where to search(names/files): Current behavior should be preserved.
Max size should be unlimited by default.
"
154915235,3989,glassez,2015-11-09T04:15:14Z,"> Are you talking about  #include ""ui_search.h""  in searchtab.h? Well, git blame shows that line was introduce back in 2008. I wasn't part of the project then. If it compiles, then I guess you can remove it.

This was fixed in #3832 about 2 months ago.
"
155030916,3989,sledgehammer999,2015-11-09T11:13:23Z,"@evsh I'll give priority to #3832 since it touches the core/base of the are you are touching. And maybe it will result in cleaner implementation by you. I target both PRs for v3.3.1.
"
155075104,3989,ngosang,2015-11-09T14:15:42Z,">  I want this changes:
>     1) Search in Options should be: ""Torrent name"" and ""Torrent name and files""
> 
> Why? Are we sure that all search engines do not (and will not) search anywhere else except file names and torrent names? 

We have 9 official search engines. 7 search only in the torrent name, btdigg search in the torrent name and in the names of the files, torrentreactor returns some unrelated results.The thing is that we can't tell btdigg to search only in torrent name.

1) Torrent name (default option)
We search in all engines. Most will return torrents with the search words in the torrent name. Btdigg will return some results with the search words in the torrent name and other without it (the search words are in the torrent files name). Torrentreactor will return some unrelated... **We filter the results to show only those which contains the search words in the torrent name.**

2) Torrent name and files (you can let ""Everything"" if you prefer)
The same as in 1) but **we don't filter the results**, we show everything. This mode will include Btdigg search in files and Torrentreactor unrelated results.

>  3) Remove B, PiB and EiB from combos
> 
> Why? I could understand that you do not believe in usefulness of PiB and EiP, but why remove bytes? 

Ok, remove PiB and EiP and let B.

> 4) Max torrent size should be 1000 TiB by default instead of 1000 B
> 
> It is actually equal to infinity by default. I will fix the UI. The panel even should be disabled before the search gets activated. Do you want the limit be 1000 TiB instead? 

I prefer to see **∞**. What will be the default unit? In think **∞ TiB** is ok.

Since ""search status"" and ""search filters"" are independent for each tab should be inside the tab. We should also save some space, for example, moving the number of results to the tab name.
![](http://i.imgur.com/wLz2n2k.png)
"
155083333,3989,sledgehammer999,2015-11-09T14:46:18Z,"Number in tab name is maybe out the scope of this. And @evsh might not want (or be able) to do it.
"
155093362,3989,zeule,2015-11-09T15:19:10Z,"I agree that the number is another story. Can do that in a separate commit.
"
155097266,3989,zeule,2015-11-09T15:33:14Z,"@ngosang , agree with you regarding the widgets placement and will move the filter bar inside the results tab once #3832 got merged.

Do not agree about PiB and EiP: they don't make UI any worse, as to me, but the code is a bit cleaner with them (since we handle all the prefixes which can be inside of int64). And still I insist that default option in the mode list has to have meaning ""unfiltered"", because we do not know what search plugins might do (in future and custom ones). Actually, I would put ""Unfiltered"" there, but that creates interference with the other filtering parameters. 
"
155099598,3989,ngosang,2015-11-09T15:41:42Z,"> Do not agree about PiB and EiP

You can let those but change the default Max size unit to GiB. if you set by default `∞ EiB` i have to change the number and the unit always.

> And still I insist that default option in the mode list has to have meaning ""unfiltered""

I am strongly against. Btdigg and TorrentReactor will fill the list with not related results, this is the behavior we were trying to avoid when we added the filters within the plugins. The default search should be only in the torrent names.
"
155101708,3989,ngosang,2015-11-09T15:49:37Z,"@evsh you have to change src/searchengine/nova/engines/versions.txt and src/searchengine/nova3/engines/versions.txt because you updated 2 search engines.
"
155127188,3989,Pireo,2015-11-09T17:07:28Z,"@ngosang demonoid also does search in description.
"
155131057,3989,sledgehammer999,2015-11-09T17:21:56Z,"I think I already resolved how symbolize lower/upper limits here: https://github.com/qbittorrent/qBittorrent/pull/3989#issuecomment-153151479
"
155131750,3989,glassez,2015-11-09T17:24:56Z,"Offtopic: ∞ EiB = ∞ B :)
"
155132408,3989,sledgehammer999,2015-11-09T17:27:37Z,"> Offtopic: ∞ EiB = ∞ B :)

Exactly.
"
160708648,3989,Pireo,2015-11-30T18:05:23Z,"Any news?
"
160709393,3989,zeule,2015-11-30T18:08:24Z,"Nope. Waiting for #3832.
"
162330039,3989,sledgehammer999,2015-12-06T17:17:29Z,"Either rebase now or wait for #3832 to do only one rebase(if needed).
"
162330956,3989,zeule,2015-12-06T17:35:29Z,"@sledgehammer999 I want to move ui elements from the search bar into the search results tab. Wiil do this after #3832 
"
166363004,3989,sledgehammer999,2015-12-21T17:14:20Z,"#3832 is merged. Rebase when you can.
"
170989998,3989,zeule,2016-01-12T17:48:07Z,"Sorry, I'm busy these days. Hope to do this during the next weekend.
"
178599071,3989,zeule,2016-02-02T14:31:13Z,"Feel the same as you do :) 
"
189263470,3989,zywo,2016-02-26T12:55:43Z,"@evsh 
Can you rebase?
"
189698644,3989,zeule,2016-02-27T18:19:54Z,"I'm very sorry for the long delay and that I was not able to do this earlier.
So, it is rebased and filter widgets were moved inside of the search tab. The search status label was transformed into an tab icon and tooltip, and as such 3 new icons were added to resources.
The code in SearchTab and SearchWidget classes needs a new review.
"
189721064,3989,zeule,2016-02-27T20:43:19Z,"New UI:
![qbt-filter-search-new](https://cloud.githubusercontent.com/assets/394621/13375248/f211dae4-dd9a-11e5-81da-f81b93c8ff57.png)
"
189734336,3989,DoumanAsh,2016-02-27T21:42:42Z,"Looks nice. Though `inf` is kinda out of place :D
"
189899564,3989,glassez,2016-02-28T16:31:53Z,"`inf`???
"
189906432,3989,zeule,2016-02-28T17:03:18Z,"Do you think this abbreviation is ambiguous or unclear? What then? Infty? Full, unabbreviated word?
"
189915325,3989,DoumanAsh,2016-02-28T17:57:30Z,"It might only me, but i believe symbol `∞` are better suited here rather than named it as `inf.`
Mostly i think it is inconsistent because you use it with numeric lists.
`0 to 999` - is ok
`0 to ∞` - is ok
`0 to inf.` - is kinda strange looking

It is just how i see it, i do not suggest you to change it.
But i believe it is as inconsistent when you present numeric ranges mixed with words.

P.S. But i'm not sure if this abbreviation `inf.` is commonly known or used and neither i'm capable of confirming it.
"
189917211,3989,glassez,2016-02-28T18:21:25Z,"> symbol  ∞  are better suited here rather than named it as  inf. 

+1
"
189921389,3989,zeule,2016-02-28T18:46:32Z,"OK, it is `∞` now.
"
190492527,3989,zeule,2016-03-01T01:56:42Z,"Speed limit widgets already use ∞, thus the same symbol has to be used here, for the sake of consistency.
"
190802585,3989,glassez,2016-03-01T16:40:50Z,"@evsh Do your PR fixes #4790?
"
190911240,3989,zeule,2016-03-01T21:23:02Z,"No, it does not. 
@glassez , I believe that all your comments except the one on came cased parameter names have been addressed now.
"
201500593,3989,ngosang,2016-03-25T21:02:29Z,"Several thoughts:
1) When you change the search engine plugins you have to update the version and the version.txt files. I think you should update the search engine plugins in other PR because we already made several changes in that plugins => #4997 This way will be easy to merge.
2) If while qBittorrent is searching I click the Stop button I see an error message. You should display the message ""The search was aborted by user"" and the task-complete.png icon.
![](http://i.imgur.com/3gkOMGA.png)
3) Default value for Search in combo should be
![](http://i.imgur.com/j74BqLb.png)

Thank you very much. With this little changes this PR is ready for merge.
"
201520739,3989,zywo,2016-03-25T21:33:05Z,"@ngosang 
This is what I get when I click the stop button while qBittorrent is searching:

![screenshot from 2016-03-25 22-26-39](https://cloud.githubusercontent.com/assets/4026304/14054420/6116da0e-f2d9-11e5-8c28-5507372494d2.png)
"
201566760,3989,ngosang,2016-03-25T22:56:22Z,"I'm using Linux + KDE 5 + Qt5 + Python3 and that is the result.
"
201606882,3989,Pireo,2016-03-26T00:14:17Z,"@ngosang demonoid plugin by default does search in torrent names only, but the site does in description too.
"
201647763,3989,zeule,2016-03-26T01:26:54Z,"@ngosang , thank you for the suggestions!

>  I think you should update the search engine plugins in other PR because...

Shouldn't git handle the merge? If it says that version change can not be merged, I change that.

> If while qBittorrent is searching I click the Stop button...

I'lll look into it. This is my mistake, probably.

> Default value for Search in combo should be ""Torrent names only""

Disagree with you. We do filtering here, why should I have most of the results filtered out by default? If you believe that that mode is better, let's make it user selectable. I'm sure there is enough space in the filter bar to add a small button which will save current filter as default one. 
"
201679674,3989,ngosang,2016-03-26T02:31:30Z,"> We do filtering here, why should I have most of the results filtered out by default? 

Because btdigg and torrentreactor are included with qBittorrent and they reruns a lot of unrelated results. When a new qBittorrent user tries the search engine for the first time he will see a ton of unrelated results and he will open an issue here in GitHub. That was the reason because we implemented the filter inside the python code for those two search engines. The user complaints stopped after filtering the results.
I know you want to search inside description and that's the reason for this PR but you are just one user, we should think in the majority. 
"
201680601,3989,ngosang,2016-03-26T02:33:02Z,"> @ngosang demonoid plugin by default does search in torrent names only, but the site does in description too.

We can change that after this PR is merged.
"
201681662,3989,zeule,2016-03-26T02:35:38Z,"So, what about saving defaults then? And ""default default"" is ""Torrent names only"".
"
201688280,3989,ngosang,2016-03-26T02:48:21Z,"> So, what about saving defaults then? And ""default default"" is ""Torrent names only"".

Ok, maybe the ""Save"" button is not necessary. Just save the combo value when changed. Also put ""Torrent names only"" first in the combo list.
"
201702846,3989,glassez,2016-03-26T04:18:59Z,"> Just save the combo value when changed. Also put ""Torrent names only"" first in the combo list.

+1
"
202608826,3989,zeule,2016-03-28T22:39:05Z,"@ngosang , @zywo : regarding the icon and status after activating the ""Stop"" button. The answer why we see different icons is that there is different behaviour on Linux and Windows (see commit 7c00e80f). In particular, different status are set in case of Linux and Windows (see [here](https://github.com/qbittorrent/qBittorrent/pull/3989/files#diff-041a48be399affd80d91222cff11ea17R314)). This PR simply does not change that behaviour. Could the search team clarify this for me, please?
"
202641814,3989,zeule,2016-03-29T00:25:29Z,"Search in torrent names only (old behaviour) is the default one now. Selected search mode is saved in preferences.
"
203589621,3989,zeule,2016-03-30T19:11:37Z,"From the other hand, PR #4800 deals with the status problem already. Let' us merge this as it is, since there are no new mistakes with respect to search termination in it (well, I hope), and then rebase #4800 which will fix the status icons.
"
203591074,3989,zeule,2016-03-30T19:16:18Z,"Maybe one more addition I would consider is to extend the results count text and show filtered results number too. Like `Results (showing 15 out of 299792458)`
"
204011325,3989,zeule,2016-03-31T16:33:06Z,"The ""Results"" label not shows both filtered and unfiltered counts. 
"
204011875,3989,zeule,2016-03-31T16:35:00Z,"Shouldn't the ""Search in"" label be rephrased as ""Match in""? 
"
204789438,3989,ngosang,2016-04-02T19:53:41Z,"@evsh Undo the changes in the *.py files. I did more changes in  #5058.
"
204795192,3989,zeule,2016-04-02T20:15:17Z,"yep, thank you for the note!
"
205051685,3989,zeule,2016-04-03T20:46:49Z,"@sledgehammer999, thank you for the suggestions!
"
205052717,3989,sledgehammer999,2016-04-03T20:53:01Z,"I am done with the review. I have left some comments that are easy to fix.

@ everyone
I know there has been a shitload of discussion from my last comment in this thread. I haven't read anything. If something needs my attention for decisions(or opinion) please comment below here. Otherwise, once @evsh fixes my comments I am going to merge this.
"
205053470,3989,sledgehammer999,2016-04-03T20:56:56Z,"I forgot to mention that I didn't compile/run this. It will be my final step before merging. I hope I don't find any UI weirdness.
"
205076514,3989,zeule,2016-04-03T23:28:38Z,"@sledgehammer999 
I've implemented your edits and suggestions. Seems to be working and is ready to be merged. Let me remind you to merge #5058, as the changes in the plugins code moved there. 
"
205076811,3989,zeule,2016-04-03T23:31:36Z,"Ups... Checks failed
"
205082299,3989,zeule,2016-04-04T00:23:44Z,"> Ups... Checks failed

I've replaced model file include in the `searchtab.h` header with forward declaration. I don't know why Qt4 Travis build was failing with 

``` C++
#include <QMetaType>
#include <QWidget>
```

in `searchtab.h`. My local clean build was compiling fine. So, I've added an illogical include into that file, `<QVariant>`. The build passed OK then, but I can't understand what was wrong because the error was in moc_ file, and my local moc_ file is obviously different from the one in Travis. 
"
205084621,3989,zeule,2016-04-04T00:32:55Z,"If somebody wants to help to sort it out, to reproduce just replace 

``` C++
#include <QVariant>
```

with

``` C++
#include <QMetaType>
```

in `searchtab.h` and compile via qmake and Qt4. CMake build compiles fine, obviously due to the fact that CMake generates a ""super-moc"" file, which includes all the project moc-files and compile that file instead. A required include comes from one of the other headers in this case. 
"
205086155,3989,zeule,2016-04-04T00:38:41Z,"@sledgehammer999, I think this can be merged as it is, with the crazy include.
"
205446164,3989,ngosang,2016-04-04T18:54:26Z,"Works fine for me.
"
206007383,3989,sledgehammer999,2016-04-05T22:17:19Z,"I think everything works fine. Thank you for the work.

PS: qt4+qmake+QMetaType works for me on Windows and Debian unstable. But isn't very important to find out why travis(ubuntu trusty) fails.
PS1: The ""ongoing"" icon looks ridiculous but what can you do? It is the oxygen theme.
"
206009527,3989,zeule,2016-04-05T22:23:03Z,"I agree with you that the icons are ugly. AFAIK they were made without designer. We can take an icon from another theme.
"
206012513,3989,sledgehammer999,2016-04-05T22:27:58Z,"No need. On linux it should use the ones from the system's theme. On Windows/OSX see #4253
"
206016555,3989,zeule,2016-04-05T22:35:36Z,"Unfortunately, those names (""task-"") are specific to the Oxygen style.
"
206017422,3989,zeule,2016-04-05T22:37:26Z,"#5058?
"
206020630,3989,zeule,2016-04-05T22:43:01Z,"Oh, I see now your question there. OK. Thank you!
"
375884804,8584,glassez,2018-03-24T12:33:35Z,"@Piccirello, as I expected, WebSearchHandler is quite useless class. It just senselessly duplicates the data and it fragments logic (pulling it out of the context of the controller). All you need is to store SearchHandler and use it to obtain data.

BTW, why do you need mutexes?"
375889153,8584,Piccirello,2018-03-24T13:24:49Z,"Actually, what it does is build a queue of results. It then returns a subset of that data on each results call.

You’d like all of this logic to live in searchcontroller? That would seem to go against the goal of keeping the controller as stateless as possible. I’d prefer to encapsulate this logic in a separate class and keep the controller dead simple.

If others are in agreement I can modify my implementation. "
375889285,8584,Piccirello,2018-03-24T13:26:52Z,"> BTW, why do you need mutexes?

This is very possibly over engineering on my part. The goal was to make search results retrieval thread safe, but if we know there’ll only ever be one thread accessing results then this is obviously unnecessary."
375889815,8584,glassez,2018-03-24T13:34:48Z,"> The goal was to make search results retrieval thread safe, but if we know there’ll only ever be one thread accessing results then this is obviously unnecessary.

qBittorrent web server is single-threated.

>That would seem to go against the goal of keeping the controller as stateless as possible.

I see no goal in your implementation. Like I said, you were just fragmenting the logic. In fact, it is doing the same thing now, only indirectly. Instead of storing SearchHandler you store WebSearchHandler (which wraps SearchHandler in it). What stateless you are talking about? Please describe in detail (with workflow example).
>Actually, what it does is build a queue of results. It then returns a subset of that data on each results call.

Actually, it just duplicates data. SearchHandler already stores all data. Why not return its subset?"
375941110,8584,Piccirello,2018-03-25T02:46:14Z,"> Actually, it just duplicates data. SearchHandler already stores all data. Why not return its subset?

I didn't realize the recent search changes added `QList<SearchResult> m_results`. Previously new results were only emitted. I now agree with your previous statement; the need for a separate `WebSearchHandler` has been obviated. Will update once the changes have been pushed."
375949977,8584,glassez,2018-03-25T07:00:56Z,"@Piccirello, another thing that confuses me is you share searches between sessions (i.e. you can obtain results from search started in another session). I don't think that's right. @Chocobo1?"
375953222,8584,Piccirello,2018-03-25T08:13:11Z,"> i.e. you can obtain results from search started in another session

The sessions all belong to the same user, just in different instances of the WebUI. I don't think there's any reason to restrict access within the api."
375962059,8584,glassez,2018-03-25T11:05:29Z,">The sessions all belong to the same user, just in different instances of the WebUI.

There is one step only from single-user mode to multi-user mode... But it's not so important now.
Another task of sessions is the timely release of resources when a user ends the session (or when the session becomes outdated)."
376022534,8584,Piccirello,2018-03-26T01:36:34Z,`WebSearchHandler` has now been removed and `SearchHandler` is used directly.
395308887,8584,Piccirello,2018-06-07T06:33:30Z,"@glassez After a short hiatus, the API now more closely models the interface you described. It still needs extensive testing and more robust search job cleanup."
395836029,8584,Piccirello,2018-06-08T17:45:10Z,"If the `SearchHandler` instance were to live inside the user's session, and thus get deleted when the session ends, who should own it? The `WebSession` class?

I'll of course have a timer to delete results after some period. But also deleting searches upon that session's demise seems like the right approach."
395840407,8584,glassez,2018-06-08T18:00:20Z,">who should own it? The WebSession class?

Apparantly, Yes.
I haven't seen your current implementation yet. I'll take care of that later."
396562833,8584,glassez,2018-06-12T11:53:43Z,">par. 4: ""Get current results of search job (either all available or some subset)"".

E.g. see how torrents subset can be obtained in TorrentsController:
https://github.com/qbittorrent/qBittorrent/blob/4100282673beae10f32588808551b0ea1d93175b/src/webui/api/torrentscontroller.cpp#L183"
397509633,8584,Piccirello,2018-06-15T04:24:38Z,"I believe I've addressed all comments and concerns. The `SearchHandler` instances are stored in a hash table- keyed by session id and then search id- and are owned by `SearchController`. They get deleted when the user calls the delete api endpoint, or a 30 minute timer expires."
399819137,8584,Piccirello,2018-06-25T03:16:49Z,Addressed comments and squashed commits.
404349717,8584,Piccirello,2018-07-12T00:16:55Z,Rebased onto master. Please review and approve.
406831973,8584,Piccirello,2018-07-22T00:21:53Z,I've implemented the limit of 10 concurrent active searches.
406881663,8584,glassez,2018-07-22T17:02:30Z,">What limit would you impose?

Personally, I would prefer to allow only one search per session. This would greatly simplify the server-side implementation and eliminate many security problems. Even in GUI we do not allow to have several active searches! We only allow you to have a lot of completed searches (or interrupted), but in the case of a WebUI it can be implemented on the client side.

>My point is that a search job may exist long after it's actually ""active,"" simply because the webui does not provide a good means of setting the search job as inactive. This is just a byproduct of how people use webpages.

Let's summarize!
**Implementation 1** (one search is allowed):
1. User can start search and get its results. 
2. When user starts new search the current one is destroyed. 
3. If user want to store results of any previous search it make it on the client-side.
4. (Possible optimization) Search controller tracks last access time and destroys the inactive search (in case user still use the current session but it doesn't use search controller anymore).

**Implementation 2** (one active search is allowed, like in GUI):
1. User can start search and get results of any previous search by its ID. 
2. When user starts new search the current one is interrupted. 
3. User can manually delete any existing search.
4. Search controller tracks last access time and destroys the inactive searches (in case user still use the search controller but it doesn't use some particular searches and didn't delete them itself).
5. Max searches count is limited. When user starts new search and it exceeds the limit, the least active search is deleted.
6. (Possible optimization) Search controller destroys the inactive searches (in case user still use the current session but it doesn't use search controller anymore).

**Implementation 3** (several active searches are allowed):
*Same as above except par. 2*
But why should we allow such implementation??? Each search job can starts several threads/processes. Even if we allow 10 concurrent searches this can create unnecessary load on the server side. But the main question, why this need? Why do you need to run multiple concurrent searches?

I don't want to delay this PR, it's already taking too long. But we cannot move forward without addressing these fundamental issues.
@Chocobo1, please comment the overall feature implementation without code details."
406882339,8584,Piccirello,2018-07-22T17:13:03Z,"> Personally, I would prefer to allow only one search per session.

This is not a limit I plan to impose. The search classes were recently rearchitected to allow multiple concurrent searches; we should use this.

> Even if we allow 10 concurrent searches this can create unnecessary load on the server side.

We can reduce this number to 5 if you wish, but I don't see a reason to drop it any lower. The default WebUI may not even end up supporting concurrent searches, but the API still should.

Besides, how is the load ""unnecessary""? The user is taking explicit action to perform these searches."
406882537,8584,glassez,2018-07-22T17:16:02Z,">The default WebUI may not even end up supporting concurrent searches, but the API still should.

But why? What is the practical need? Why do you need to run multiple concurrent searches?"
406882766,8584,glassez,2018-07-22T17:19:27Z,"Anyway waiting for more reviewers.
@zeule, please review the feature (without going into code details)! Please comment on https://github.com/qbittorrent/qBittorrent/pull/8584#issuecomment-406881663"
406882822,8584,Piccirello,2018-07-22T17:20:09Z,"> But why? What is the practical need? Why do you need to run multiple concurrent searches?

To search for multiple torrents at once... Have you never run simultaneous google searches?

Torrent searches can take upwards of a minute, especially with the Jackett plugin. If there are several items I want to search, why should I have to wait over a minute before I can run my next search? There is no technical limitation, just your ""belief"" that no one would ever want to do it."
406883464,8584,Chocobo1,2018-07-22T17:30:55Z,">If there are several items I want to search, why should I have to wait over a minute before I can run my next search? 

Agree with this.
Offtopic, I somehow wish GUI can also allow parallel search too.

>We can reduce this number to 5 if you wish

+1"
406883619,8584,glassez,2018-07-22T17:33:30Z,">There is no technical limitation, just your ""belief"" that no one would ever want to do it.

My ""belief"" has nothing to do. I just want you to give me a little reason for your assumptions, not just a little talk. What, for example, sense to launch 10 searches simultaneously, if they will really hinder each other (I not tested this, this your work here to test it). If ten parallel searches can be completed in the same time as one, then I agree that it makes sense. But if they take ten times longer, I will get the results of my first query ten times later..."
406884836,8584,zeule,2018-07-22T17:54:04Z,"> If there are several items I want to search, why should I have to wait over a minute before I can run my next search? 

+1. Even if one searches for a single item, it is worth to try various queries.

> Offtopic, I somehow wish GUI can also allow parallel search too.

+1 

> There is no technical limitation, just your ""belief"" that no one would ever want to do it.

+2

It's only natural to instantiate a conception multiple times, and it is the duty of the opposite party to provide a reason why there can't be many of ""them"". "
406886827,8584,glassez,2018-07-22T18:26:52Z,">It's only natural to instantiate a conception multiple times, and it is the duty of the opposite party to provide a reason why there can't be many of ""them"".

It's not a problem for me personally. Because I understand how this can end, and I can measure my desires with the capabilities of my computer. So I won't mind anymore. In addition, support for Search feature outside my area of interest (at least in its current form), I only use it from time to time (very rarely).

So please comment on other implementation details suggested above."
406887836,8584,sledgehammer999,2018-07-22T18:44:37Z,Just my 2 cents since I don't particularly care about search or webui modules: IIRC ~2 years ago multiple searches were implemented. But for some (technical) reason they were  dropped after 1-3 releases. I might remember wrongly though.
406903371,8584,Piccirello,2018-07-22T22:51:54Z,"> Offtopic, I somehow wish GUI can also allow parallel search too.

I would like this as well. It likely wouldn't be too difficult to support, just some UI changes and how the search/stop button is handled. I can create a Github issue for it and try to get around to it, but the GUI isn't my specialization or my top priority.


> IIRC ~2 years ago multiple searches were implemented. But for some (technical) reason they were dropped after 1-3 releases.

This is intriguing. I searched all closed closed PRs with the word ""search"" but couldn't find anything that seemed to address this. Does anyone else remember more info on this issue?

"
407040055,8584,thalieht,2018-07-23T12:25:03Z,"Who doesn't _want_ parallel searches. I searched too in changelog, commit messages PR's and i can't find anything and yet some guys in this issue: https://github.com/qbittorrent/qBittorrent/issues/2175#issuecomment-260147572 claim it was possible. Personally i don't remember qBt ever having parallel searches but i wasn't using this functionality back then. If this doesn't work out may i suggest a queue? Where subsequent searches wait for the one before them to finish before they start.
>IIRC ~2 years ago multiple searches were implemented.

Maybe you remember #2550 and its corresponding changelog entry?
>SEARCH: Perform searches in parallel (DoumanAsh) "
407629736,8584,Piccirello,2018-07-25T04:29:19Z,"> now you must add copyAsConst():
for (const QString &source : copyAsConst(params()[""sources""].split('|')))

I'll just reverse that part of the commit. The code was simpler before."
407632897,8584,Piccirello,2018-07-25T04:54:00Z,"> @Piccirello, could you comment on this, please?

I've changed this to also accept negative values."
407723504,8584,zeule,2018-07-25T11:32:43Z,">>   now you must add copyAsConst():
>>    for (const QString &source : copyAsConst(params()[""sources""].split('|')))

> I'll just reverse that part of the commit. The code was simpler before.

@Chocobo1: does `detach()` make a deep copy if refCount ==1? "
407735436,8584,glassez,2018-07-25T12:20:17Z,">does detach() make a deep copy if refCount ==1?

Are you sure `refCount ==1` is here?"
407737895,8584,Chocobo1,2018-07-25T12:30:16Z,">@Chocobo1: does detach() make a deep copy if refCount ==1?

Am I suppose to answer what you can find out within seconds with a IDE?"
407754764,8584,zeule,2018-07-25T13:31:11Z,"> Am I suppose to answer what you can find out within seconds with a IDE?

Looks like you did it already and can answer, please,  why did you write:
> now you must add copyAsConst():
"
407757824,8584,Chocobo1,2018-07-25T13:41:01Z,">Looks like you did it already and can answer, please, why did you write:

Why don't you ask so in the first place?? To avoid detachment.
"
407761288,8584,zeule,2018-07-25T13:51:45Z,Asking was the first action I did (https://github.com/qbittorrent/qBittorrent/pull/8584#issuecomment-407723504). I repeat: why do you think detachment is possible in those cases?
407762898,8584,Chocobo1,2018-07-25T13:56:33Z,">Asking was the first action I did (#8584 (comment)).

No, there you did not asked me about my motivation.

>I repeat: why do you think detachment is possible in those cases?

I incline to think `refCount > 1` is true, is it not?"
407765754,8584,zeule,2018-07-25T14:05:11Z,"> I incline to think refCount > 1 is true, is it not?

Are we talking about the same code snippet?
```c++
QString f();

for (const auto& s: f().split('|')) {
}
```
"
407773060,8584,Chocobo1,2018-07-25T14:25:25Z,">Are we talking about the same code snippet?

Of course!
I've given you 3 answers already, please no more heckling if you already possess the answer and please do share with us (@glassez and me).
"
407778279,8584,zeule,2018-07-25T14:40:09Z,"The whole thing seems to be so obvious to me, that I can't believe both of you missing it. I wonder, how freshly created rvalue could have been copied anywhere to increase its reference count? I even did a test. But firstly @glassez asked am I sure that the counter is equal to 1, now you wrote you think it's value > 1, so I doubt my view now."
407781700,8584,Chocobo1,2018-07-25T14:49:44Z,">I wonder, how freshly created rvalue could have been copied anywhere to increase its reference count? 

I think it is coming from https://en.cppreference.com/w/cpp/language/range-for :
>If range_expression is an expression of a class type C that has both a member named begin and a member named end (regardless of the type or accessibility of such member), then begin_expr is __range.begin() and end_expr is __range.end(); 

>The whole thing seems to be so obvious to me, that I can't believe both of you missing it. 

If what I thought is wrong then truly sorry, I'm not as smart.
"
407814390,8584,zeule,2018-07-25T16:25:14Z,"@Chocobo1, excuse me, I did not understand the explanation, but seems like you do revoke the suggestion to add `copyAsConst()`, right?"
407819790,8584,Chocobo1,2018-07-25T16:43:07Z,">but seems like you do revoke the suggestion to add copyAsConst(), right?

:\ no...

From your example:
```c++
QStringList t = f().split('|');
for (const auto &s : t)
// 1 call for t.begin(), has side effect of t.detach(), refCount = 1
// 1 call for t.end(), has side effect of t.detach(), refCount = 2
{
}
```
If that is not true, you might as well go ask on https://www.kdab.com/goodbye-q_foreach/ , as their example is not much that different."
407820672,8584,zeule,2018-07-25T16:46:07Z,"Uhm... My example is [here](https://github.com/qbittorrent/qBittorrent/pull/8584#issuecomment-407765754) and it reads:
```c++
for (const auto &s : f().split()) {
```"
407820955,8584,Chocobo1,2018-07-25T16:47:10Z,">Uhm... My example is here and it reads:

I don't see the difference??"
407823556,8584,Chocobo1,2018-07-25T16:55:54Z,"Then how do range-based `for` work exactly in your example? do you mind might break it down step by step for me to understand?
"
407824557,8584,zeule,2018-07-25T16:59:12Z,From what you wrote follows that `begin()` and `end()` inside the loop points to various containers and that is obviously not true.
407825019,8584,Chocobo1,2018-07-25T17:00:38Z,">From what you wrote follows that begin() and end() inside the loop points to various containers and that is obviously not true.

I've made an update to it, is it better?"
407825059,8584,zeule,2018-07-25T17:00:46Z,"> Then how do range-based for work exactly in your example? do you mind might break it down step by step for me to understand?

`detach()` tests if container is shared and does nothing if it's not. Thus both calls (`begin()` and `end()`) do not result in detaching."
407825555,8584,zeule,2018-07-25T17:02:26Z,"> I've made an update to it, is it better?

Sorry, but no."
407842448,8584,Chocobo1,2018-07-25T17:58:35Z,">detach() tests if container is shared and does nothing if it's not. Thus both calls (begin() and end()) do not result in detaching.

OK, I see your point now, good lesson BTW.
However I still don't think removing `copyAsConst` in my previous suggestion.
Without it doesn't detach is because `isShared()` is guarding it, my point is it still calls the `detach()` function, *trying* to detach()... whereas using `copyAsConst` it doesn't ever gets into `detach()`.
I should change my wording to: ""now you **should** add copyAsConst():"", if this is what you are after.

I think that is all, I've nothing more to say."
407853085,8584,zeule,2018-07-25T18:34:26Z,"Thanks, I wanted to learn why did you say casting to `const` is necessary there, thank for explaining!"
411953857,8584,Piccirello,2018-08-10T02:09:43Z,All comments addressed and commits squashed.
416015098,8584,Piccirello,2018-08-26T05:27:41Z,Please approve if there are no further comments
418286892,8584,glassez,2018-09-04T08:36:19Z,"When I look at ""everything turns out crooked here"", one thought haunts me. Why we're ""pulling out of one's ass""? Wouldn't it be easier to implement ""search engine"" at web-client side?
Just thinking out loud... Can we recreate the search plugins on the JavaScript? Then we won't need that leaky API at all."
418362226,8584,Piccirello,2018-09-04T13:13:46Z,"With a massive amount of effort I’m sure it’s technically possible. Practically, I don’t think it makes sense to ditch the entire current process, including the python engine and all existing search engines."
420053014,8584,Piccirello,2018-09-10T20:39:59Z,"If no more comments, please approve"
421207214,8584,Piccirello,2018-09-14T02:03:51Z,"@glassez Are you referring to reimplementing the entire search feature in JS?

All other commenters, please reapprove 😃 "
421229645,8584,glassez,2018-09-14T04:45:34Z,">@glassez Are you referring to reimplementing the entire search feature in JS?

No, of course."
421231309,8584,Piccirello,2018-09-14T04:58:44Z,What comments were you referring to?
422307268,8584,glassez,2018-09-18T08:38:53Z,">Well, if you ignore my comments for some reason (apparently they are unfounded, or they just go against the General trend of qBittorrent WebAPI/WebUI development), then you can continue this without my approval.

It's about other reviewers.

>What comments were you referring to?

E.g. [this comment](https://github.com/qbittorrent/qBittorrent/pull/8584#pullrequestreview-106992375).

I asked the reviewers to speak about the design of the feature as a whole, and then check the details of its implementation. But I did not see any clear comments about the proposed model or your own proposals.
It's not a trivial bugfix. It's Feature Implementation PR, but you just checked some code details and approved it! Why? It looks like you don't even have a clue about its overall design...

The second detail, which I did not see any reasonable reviews, is the life time of the ""search job"". Why it's controlled by some timer with ""pulled from one's ass"" timeout? It's just a rough, based on nothing solution."
423778885,8584,Piccirello,2018-09-22T22:50:29Z,"> I asked the reviewers to speak about the design of the feature as a whole, and then check the details of its implementation. But I did not see any clear comments about the proposed model or your own proposals.

I think this PR clearly satisfies the design you proposed in your linked comment.

> The second detail, which I did not see any reasonable reviews, is the life time of the ""search job"". Why it's controlled by some timer with ""pulled from one's ass"" timeout? It's just a rough, based on nothing solution.

Searches time out after 3 minutes. Was this number not ""pulled from one's ass?"" I believe one hour is a reasonable balance between maintaining state and not unnecessarily holding on to resources. This can probably even be increased by several times. If you have a suggestion for a new timeout, please propose one.

I do not want to delay this PR any longer. Let's get this merged already."
425489146,8584,glassez,2018-09-28T16:20:15Z,">Searches time out after 3 minutes. Was this number not ""pulled from one's ass?""

I do not mean the duration of the ""search job"" <timeout, but its existence in itself. Besides, you compare incomparable things.
The process of performing a search is finite in nature. You can discuss the timeout value and the need to limit it or just not limit it at all and wait for its natural completion (apparently, this timeout exists to complete hung processes). In any case, this is not the subject of my claims. I'm talking about the lifetime of a ""search job"", which not only searches, but also stores the results.
>I believe one hour is a reasonable balance between maintaining state and not unnecessarily holding on to resources. 

""holding on to resources"" is not really a problem. What's the point of freeing up a resource if you let it take over right after? That is, if you allow to have N ""search jobs"" at the same time, in General, the user can have them for the entire lifetime of the application (in this particular case, during the entire web session).
So the timeout here is meaningless. Especially one as clumsy as yours! It absolutely does not take into account the intensity of use of the protected object. Why are you counting down from creating a ""search job""? Do you think that a constantly used resource is as worthy of death as an unused one?

I suggest not to limit the lifetime of ""search jobs"" within a session at all.
<del>Or use the ""displacement mechanism"", i.e. consider outdated jobs as a candidate for replacement with a new one if the user tries to start a new search with 5 existing ones. But it should be ""outdated"" job, not ""old"", i.e. you should track its ""last access time"".</del>

>I do not want to delay this PR any longer. Let's get this merged already.

I do not want to delay it too. But I can't approve of what I think is wrong.
If the above does not make sense to you, then either make a reasonable objection (not ""I believe""), or continue without me. As I said before, if the rest of @qbittorrent/demigods thinks it's ready to be released in its current state, let them merge it."
425762528,8584,Piccirello,2018-10-01T00:06:23Z,I'm removing the web search job timeout. If we face issues we can add it back later.
431265296,8584,Piccirello,2018-10-19T07:02:36Z,Any further comments on this? Ready for merge?
432279888,8584,Piccirello,2018-10-23T14:51:49Z,The sooner this is merged the sooner I can start looking into WebUI RSS support 😜 
432494100,8584,Piccirello,2018-10-24T02:54:50Z,"Preliminary webapi documentation. This isn't finished yet and is missing fields

# Search #

### Start search ###
```http
POST /api/v2/search/start HTTP/1.1
Host: 127.0.0.1
Cookie: SID=your_sid
Content-Type: application/x-www-form-urlencoded
Content-Length: length

pattern=test&category=all&plugins=enabled
```

### Stop search ###
```http
POST /api/v2/search/stop HTTP/1.1
Host: 127.0.0.1
Cookie: SID=your_sid
Content-Type: application/x-www-form-urlencoded
Content-Length: length

id=123456
```

### Get search status ###
```http
GET /api/v2/search/status?id=123456 HTTP/1.1
Host: 127.0.0.1
```

### Get search results ###
```http
POST /api/v2/search/results HTTP/1.1
Host: 127.0.0.1
Cookie: SID=your_sid
Content-Type: application/x-www-form-urlencoded
Content-Length: length

id=123456
```

### Delete search ###
```http
POST /api/v2/search/delete HTTP/1.1
Host: 127.0.0.1
Cookie: SID=your_sid
Content-Type: application/x-www-form-urlencoded
Content-Length: length

id=123456
```

### Get search categories ###
```http
GET /api/v2/search/categories?pluginName=legittorrents HTTP/1.1
Host: 127.0.0.1
```

### Get search plugins ###
```http
GET /api/v2/search/plugins HTTP/1.1
Host: 127.0.0.1
```

### Install search plugin ###
```http
POST /api/v2/search/installPlugin HTTP/1.1
Host: 127.0.0.1
Cookie: SID=your_sid
Content-Type: application/x-www-form-urlencoded
Content-Length: length

sources=https://url.to/plugin
```

### Uninstall search plugin ###
```http
POST /api/v2/search/uninstallPlugin HTTP/1.1
Host: 127.0.0.1
Cookie: SID=your_sid
Content-Type: application/x-www-form-urlencoded
Content-Length: length

names=legittorrents
```

### Enable search plugin ###
```http
POST /api/v2/search/enablePlugin HTTP/1.1
Host: 127.0.0.1
Cookie: SID=your_sid
Content-Type: application/x-www-form-urlencoded
Content-Length: length

names=legittorrents&enabled=true
```

### Update search plugins ###
```http
POST /api/v2/search/updatePlugins HTTP/1.1
Host: 127.0.0.1
Cookie: SID=your_sid
Content-Type: application/x-www-form-urlencoded
Content-Length: length
```
"
432546553,8584,glassez,2018-10-24T07:36:56Z,"I never liked the (legacy) format of the Web API documentation. Why do you keep repeating all these HTTP headers etc.? It's so obvious, and therefore it is absolutely unnecessary here. Please consider RSS Web API documentation format."
432598248,8584,glassez,2018-10-24T10:12:43Z,">The sooner this is merged the sooner I can start looking into WebUI RSS support 

Well, blackmail is a powerful weapon!
I actually wanted to postpone it until the next release. But I assumed v4.0.4 would come out soon. Unfortunately, the release cycle is ""frozen"" again. I see no reason to delay it any longer."
432598552,8584,glassez,2018-10-24T10:13:49Z,Thank you all!
432921846,8584,Piccirello,2018-10-25T05:43:05Z,"@glassez I've [updated](https://github.com/qbittorrent/qBittorrent/wiki/Web-API-Documentation#search) the wiki with Search info using a slightly modified version of your RSS documentation format. Namely, I've added HTTP status codes. This format is definitely more concise than the old style with all the extra headers."
433515601,8584,FranciscoPombal,2018-10-26T19:18:00Z,"@glassez @Piccirello I quite like the new Web API documentation format, but wouldn't it be good to also specify the type of method in the description (GET, POST, ...)? I agree that the other headers are unnecessary.
"
433516595,8584,glassez,2018-10-26T19:21:45Z,Currently both methods are allowed.
433517114,8584,FranciscoPombal,2018-10-26T19:23:50Z,"@glassez So to be clear, the request type can be either GET or POST for _all_ methods of the WebAPI?"
433519880,8584,glassez,2018-10-26T19:34:48Z,Yes.
433521315,8584,FranciscoPombal,2018-10-26T19:40:12Z,@glassez Thanks for the clarification. Perhaps that should be mentioned in the Wiki page for the Web API? I could edit that now and perhaps star converting the documentation of older methods into the new format.
433522464,8584,glassez,2018-10-26T19:44:39Z,">converting the documentation of older methods into the new format.

It would be nice!"
433523429,8584,Piccirello,2018-10-26T19:48:43Z,"I’ve avoided documenting this because I actually think it’s something we should be more strict about, and something I’d like to enforce. Any non-idempotent methods should be a POST, and all others GET."
433540194,8584,FranciscoPombal,2018-10-26T20:53:05Z,"@Piccirello I have started the conversion to the new documentation format. However, there are some things I don't know. 

For example, in the old documentation format, a lot of methods had examples of successful execution. In the new documentation format, there is an ""HTTP status code/scenario"" table instead of such examples.

The problem is that I often did not know what to put in the ""HTTP status code/Scenario"" table, since I do not know what all methods do in all scenarios (and the old documentation format did not specify what happened in all scenarios), so I marked such entries as TODO. I preferred this approach rather than add a single entry to all with ""200 | Success"" since this way it is more obvious that it needs to be better documented.

Can you take a look and fill those entries in, since you know the WebAPI much better? Just Ctrl+F TODO. Thanks."
434886914,8584,Piccirello,2018-10-31T23:57:21Z,"@FranciscoPombal I've [filled in](https://github.com/qbittorrent/qBittorrent/wiki/Web-API-Documentation/_compare/caa93252f23a8db3b1843404ac9862ba54bbb322...331d39ff208921dc798c86d982260e9504b81c09) all HTTP status codes marked TODO. There's only one remaining TODO, which is JSON response info for `/sync/torrentPeers`. Also discovered that I hadn't documented `/torrents/editCategory` from a previous PR, so that's in there now.

I noticed there were several APIs erroneously documented as always returning `200`, despite them also returning other status codes. Please be careful with how liberally you're assigning the 200-only info. I've updated these codes as well.

I'm not sure if there's value in keeping the `Requires authentication` field in our documentation. We only have two Web APIs that don't require auth, while all others do (I actually think it's three and our documentation is just outdated- I'll look into this further). Since these are the special case, we should probably just mark these specifically and omit the info elsewhere.

Thanks again for transitioning this info to the new format. I really think the updated format and status codes will be useful to people leveraging the qBittorrent Web API."
434902221,8584,Piccirello,2018-11-01T01:36:42Z,"It appears `/api/v2/app/version` and `/api/v2/app/webapiVersion` do in fact require authentication. It's the legacy APIs `/version/api`,` /version/api_min`, and` /version/qbittorrent` (which we still support) that do not require auth.

@glassez @Chocobo1 What are your thoughts on the best way forward? Should we just document this as-is? Ideally the three `/app/` API calls wouldn't require auth, but this is a slightly bigger change involving `webapplication.cpp`. I'm fine making these changes, but want to get your thoughts before doing so."
434925974,8584,Chocobo1,2018-11-01T04:19:54Z,">What are your thoughts on the best way forward? 

IIRC it has discussed before, personally I don't think it is wise to give out version number to everyone for free. So ideally getting version number would require auth when the legacy APIs are deprecated."
434931044,8584,FranciscoPombal,2018-11-01T05:00:08Z,"@Piccirello 
> I noticed there were several APIs erroneously documented as always returning `200`, despite them also returning other status codes. Please be careful with how liberally you're assigning the 200-only info. I've updated these codes as well.

I only copied the content that was there before. I would advise you to actually revise the document thoroughly after it is fully converted to the new format; other things may be wrong/missing.

"
435049282,8584,Piccirello,2018-11-01T14:00:00Z,"@FranciscoPombal Oh yeah, I do see that now. This documentation is seriously outdated. A mass cleanup is probably required to fix everything. "
435052650,8584,Piccirello,2018-11-01T14:12:01Z,"@Chocobo1 Could there be benefit to exposing the API version/min without auth? If we ever change the login API, other apps won’t be able to determine which login flow to use without trying + catching failure."
435070947,8584,Chocobo1,2018-11-01T15:07:57Z,">Could there be benefit to exposing the API version/min without auth? 

Other than letting strangers fingerprint you easily, none I am aware of.

>If we ever change the login API...

I doubt we will easily do backward-incompatible changes to this part...
"
440362863,8584,sledgehammer999,2018-11-20T17:35:14Z,"@Piccirello this PR instatiates the SearchPluginManager at program start. This is a bad idea.
The SearchPluginManager does initialization stuff which depend on python being present. This might not be the case on windows. It results in warning messages in the log. Remember that search+python is optional in qbt. User might not choose to enable it--> the search tab might be disabled/hidden. User might not have python installed.
Searching for the interpreter on startup might introduce delays.
Please revise this approach and make it optional upon user's explicit enablement."
440381731,8584,glassez,2018-11-20T18:28:29Z,">User might not choose to enable it--> the search tab might be disabled/hidden.

Depending core Search feature from its UI it was legacy qBittorrent behavior. Now it doesn't fit since SearchPluginManager should be accessible from different places.
>Remember that search+python is optional in qbt. 

We should make it optional at all. I.e. we should allow to disable entire Search subsystem, not only its UI (search tab)."
440383577,8584,glassez,2018-11-20T18:34:30Z,">The SearchPluginManager does initialization stuff which depend on python being present. This might not be the case on windows.

There is some legacy (bad) code related to Search subsystem in qBittorrent. E.g. SearchPluginManager doesn't handle all the management and some other code parts do python related stuff directly. It should be really improved."
440383985,8584,sledgehammer999,2018-11-20T18:35:49Z,">We should make it optional at all. I.e. we should allow to disable entire Search subsystem, not only its UI (search tab).

IIRC, before this PR the subsystem was entirely disabled if the tab wasn't enabled.

I am not against disengaging the connection between the subsystem and the UI tab. We could have it as a config option. But still an option."
440521670,8584,Piccirello,2018-11-21T04:00:25Z,Opened #9889 to rectify this. Let's discuss the implementation over there.
306345992,6911,tgregerson,2017-06-06T00:16:56Z,@glassez you were suggested for review due to familiarity with the Category system.
306632738,6911,sledgehammer999,2017-06-06T22:13:35Z,"FYI, I approve this feature on principle.

Personally I don't care about the categories/filtering because I don't have many torrents sitting in the list.
However this author has put a good amount of work into this, and it seems that a lot of people have requested it already. And someone put the work and delivered.

These 2 points are sweet(if I needed filtering):
1. >Tags are a set of user defined text strings that serve as arbitrary metadata for the purpose of organizing and filtering torrents.
2. >Tags are not linked into other torrent management systems, like save path assignment. Hence they can be added & removed without any complex side effects.

Also judging from the provided screenshots the GUI implementation seems pretty spot on and I doubt it needs any major revising."
306984104,6911,tgregerson,2017-06-08T02:55:04Z,"> why filtering is done by a single tag only, but not by a list of tags?

I think multi-tag filtering is a promising idea, but requires some thought on how to do it properly in the UI. What is the interface for selecting multiple tags? Is filtering an AND operation or OR? And so on. On the other hand, filtering by a single tag is very straightforward to integrate seamlessly with the UI, since that is what we already do with statuses, categories, and trackers.

Given that people have been asking for a multi-label feature for almost 5 years, I thought it was best to do the straightforward thing first. I'm happy to look at adding more advanced features in the future if there is demand for them."
306988597,6911,glassez,2017-06-08T03:30:42Z,Agree with above.
307084816,6911,zeule,2017-06-08T12:11:26Z,"> I think multi-tag filtering is a promising idea, but requires some thought on how to do it properly in the UI. 

Filtering by a single tag does not add much comfort as comparing to categories. From the other hand, very little needs to be done to support filtering by multiple tags joined by logical ""and"", both in the tags model and in the GUI. In the model you just need to pass list of tags instead of a single string, which will give you explicit ""no tags"" value (empty list). In the GUI you just create a second sorted list view in the tags panel and append selected tags there. I believe this will be a great addition for little costs.

What would be exciting, IMO, is to integrate filtering by tags with the filtering by name and show tag filtering widget as drop down widget near the name filter."
307095005,6911,glassez,2017-06-08T12:57:25Z,">In the GUI you just create a second sorted list view in the tags panel and append selected tags there. I believe this will be a great addition for little costs.

>What would be exciting, IMO, is to integrate filtering by tags with the filtering by name and show tag filtering widget as drop down new the name filter.

I don't understand what you mean in these two suggestions."
307114611,6911,zeule,2017-06-08T14:08:09Z,"Illustration to the first proposal:
![qbt-tags-proposal](https://user-images.githubusercontent.com/394621/26932197-1f509f8a-4c63-11e7-9f99-7d8e93842d62.png)

First list shows selected tags, the second shows all but selected ones. Double clicking on items moves them between the lists. Also, this PR displays tags in a tree view. Why? Tags may not be nested.

The second suggestion is just an idea. Tagging is a way to filter items, so why then we show name filter in the upper right corner of the main window, while tags in the lower left? I would like to find both of them close to each other. For example, there can be a button near the name search toolbox, that activates a drop down tags cloud widget.  
"
307115567,6911,tgregerson,2017-06-08T14:11:16Z,"> Filtering by a single tag does not add much comfort as comparing to categories. 

Being able to assign multiple tags on a given torrent is a valuable property that is not supplied by categories. Single-tag filtering with multiple tags per torrent at least brings parity with other clients in that regard. I would love to support more powerful filtering in the future, but I think this should be the first priority.

> From the other hand, very little needs to be done to support filtering by multiple tags joined by logical ""and"", both in the tags model and in the GUI. In the model you just need to pass list of tags instead of a single string, which will give you explicit ""no tags"" value (empty list). In the GUI you just create a second sorted list view in the tags panel and append selected tags there. I believe this will be a great addition for little costs.
> 
> What would be exciting, IMO, is to integrate filtering by tags with the filtering by name and show tag filtering widget as drop down widget near the name filter.

Implementation cost aside, I think there will be some disagreement over the best way to present such a UI to the user, so some time will be required to consider alternatives and achieve consensus. Although such an advanced system appeals to me as a power user with thousands of torrents, I feel like I am probably in the minority on that, and there will be some push back on presenting an unfamiliar UI to users if the majority of them do not want to use the advanced features.

Bottom line, ""basic tagging system"" and ""advanced multi-tag filtering UI"" seem like separable features, IMO. I don't think we should block progress on the former due to the latter. There have already been 5 years spent since the original request for multiple labels spent debating such things. Let's get the straightforward thing done that serves the needs of most users, then start thinking about whether the power user features make sense. At least that's my 2c."
307116421,6911,tgregerson,2017-06-08T14:14:06Z,"> Also, this PR displays tags in a tree view. Why? Tags may not be nested.

Primarily for code and look consistency with the pre-existing widgets. I experimented with using a list view as well, but it didn't seem to provide any advantage, and required some extra code to handle things like autoscaling the widget area."
307124584,6911,zeule,2017-06-08T14:41:18Z,"> Primarily for code and look consistency with the pre-existing widgets.

Is that good? Excuse me, I repeat myself: categories show a tree of nested objects, while tags widget shows just a list. "
307140779,6911,glassez,2017-06-08T15:34:31Z,">First list shows selected tags, the second shows all but selected ones. 

Just selecting multiple list items isn't enough?"
307142277,6911,zeule,2017-06-08T15:39:49Z,"> Just selecting multiple list items isn't enough?

List of all tags can be long and as such selecting multiple items would be inconvenient, and inspecting what is selected would be even more tricky."
307142580,6911,glassez,2017-06-08T15:40:57Z,"The main question is what filtering behavior is expected with multiple tags selected?
1. Show torrents having exactly the same tag set as selected.
2. Show torrents having tag set containing all selected tags as subset.
3. Show torrents having any tag/tags from selected set."
307144062,6911,glassez,2017-06-08T15:45:55Z,">List of all tags can be long and as such selecting multiple items would be inconvenient, and inspecting what is selected would be even more tricky.

Two tag lists look ugly. Maybe it would be better to have only one list with selected tags and append items from some other list not shown permanently (like GitHub Labels/Reviewers lists)?"
307149243,6911,zeule,2017-06-08T16:03:07Z,"> Two tag lists look ugly. Maybe it would be better to have only one list with selected tags and append items from some other list not shown permanently (like GitHub Labels/Reviewers lists)?

Agree, but this requires a special widget, which needs to be implemented. Does the author want to do that? The variant with two list, from the other hand, sets a more or less correct restrictions for the implementation. Whenever I use tag search, provided by websites, I always can find what I need using either simple ""and"" or ""or"" tags combination. 

![qbt-tags-proposal](https://user-images.githubusercontent.com/394621/26938198-d26c5c48-4c73-11e7-9238-542024118f76.png)

The lower list could be collapsed, of course, and hid under a ""+"" button, for example."
307159858,6911,tgregerson,2017-06-08T16:40:44Z,"> Is that good? Excuse me, I repeat myself: categories show a tree of nested objects, while tags widget shows just a list.

Yes, using common code patterns across classes is good if there is no other drawback. It makes it easier to do bulk modification and maintenance. Say you want to add some feature to all of the widgets in the future. It is better to only have to figure out how to do it once for a single type than for multiple different types. 

TreeView is currently working as intended. Switching to ListView requires more effort be spent on fixing scaling issues, which TreeView does automatically. I would prefer not to spend this effort unless there is some material benefit to doing so.

> Agree, but this requires a special widget, which needs to be implemented. Does the author want to do that?

As stated, I do not want to implement any multi-tag filtering in this PR, regardless of whether it requires a custom widget. I think a separate feature request should be filed, and then we can discuss the pros and cons of various advanced filtering systems to our hearts' content without further delaying or expanding the scope of this PR, which is already pretty large."
307161997,6911,zeule,2017-06-08T16:49:02Z,">  It makes it easier to do bulk modification and maintenance. 

Nonsense! This has to be implemented on the code level via, e.g., class inheritance or other code sharing technique."
307371334,6911,tgregerson,2017-06-09T12:05:49Z,"> Nonsense! This has to be implemented on the code level via, e.g., class inheritance or other code sharing technique.

Let's table the philosophical discussion.

As a practical matter, do you consider it a dealbreaker that we have to switch to ListView? As I mentioned, I experimented briefly with ListView, and it looked pretty similar to TreeView, but had some unresolved issues I would need to fix like autoscaling based on the contents, among others.

My suggestion is this: TreeView currently works as desired for single-tag selection, which is my objective for this PR. You've also expressed some interest in supporting multi-tag selection in the UI, which I plan to do, but as a follow-on PR. Given that multi-selection might require a different Widget anyway, I propose that we move forward with the existing TreeView code in this PR. Then we change the Widget type (if necessary) when adding multi-selection. This avoids the potential of throw away work if we decide a widget type is better for multi-selection. Let me know if there are any objections to this plan."
307375259,6911,zeule,2017-06-09T12:27:34Z,"Could you use `QAbstractListModel` for the `TagFilterModel` class implementation, please? If you plan to work on a custom widget for the tag filter, then, of course, it makes a little sense to change widget type in this PR."
307963574,6911,tgregerson,2017-06-12T23:29:25Z,"> Could you use QAbstractListModel for the TagFilterModel class implementation, please? 

Done.

> If you plan to work on a custom widget for the tag filter, then, of course, it makes a little sense to change widget type in this PR.

Acknowledged."
308876226,6911,tgregerson,2017-06-15T21:53:19Z,"> Done?..
> It's still here!

Misunderstood which line you were pointing to. Believe I got the right one this time."
309216181,6911,glassez,2017-06-17T13:47:41Z,"Ok. I have no more comments.
If no one has too you can squash your fixup commits into main.
@evsh, @Chocobo1?
"
309634593,6911,glassez,2017-06-20T03:27:16Z,Waiting for @evsh...
309793428,6911,zeule,2017-06-20T15:21:06Z,"> Waiting for @evsh...

Excuse me, guys, have tight schedule these days..."
310849857,6911,tgregerson,2017-06-24T16:46:29Z,"> Isn't something wrong with this line?

Strange...some weirdness from the text editor I guess. Cut and pasted the line back and it went away."
310918435,6911,glassez,2017-06-25T18:11:07Z,"@evsh, @Chocobo1, I think we should merge it to hit v3.4 beta. Some minor polish can be done later.
@tgregerson, please, squash your commits."
310921010,6911,tgregerson,2017-06-25T18:56:37Z,"> @tgregerson, please, squash your commits.

Squashed."
311054149,6911,zeule,2017-06-26T13:08:04Z,"Thanks, @tgregerson, and thanks to each reviewer!"
308289621,6779,Piccirello,2017-06-14T00:59:34Z,"@evsh, @glassez , @Chocobo1, @sledgehammer999: would someone be able to review this PR, or at least comment on it? This is a highly requested feature and I know a lot of people would benefit from having it."
308316870,6779,Chocobo1,2017-06-14T04:31:27Z,">This is a highly requested feature 

Don't think so, care to point it out?

>I know a lot of people would benefit from having it.

How so? having a simple/mindless password is better than none.
~~Or do you mind to talk about your specific usage that will need this PR?~~
"
308318605,6779,Chocobo1,2017-06-14T04:46:58Z,">This feature is useful when qBitttorrent is used behind a reverse proxy with its own authentication scheme, or when it's running on a local network.

I agree we could have an option for bypassing auth for users on LAN, for WAN, it's best to keep auth on."
308322327,6779,Piccirello,2017-06-14T05:19:37Z,"> Don't think so, care to point it out?

#924 
#4581 
#6518 
[Disable authentification of webGUI](https://github.com/qbittorrent/qBittorrent/wiki/Disable-authentification-of-webGUI)
[\[Solved\] Disable Webui Authorization](https://forum.resilio.com/topic/25291-solved-disable-webui-authorization/)

A method of disabling webgui auth is even provided in the [Compiling qBittorrent on Debian and Ubuntu](https://github.com/qbittorrent/qBittorrent/wiki/Compiling-qBittorrent-on-Debian-and-Ubuntu#compiling-qbittorrent-without-the-gui-aka-qbittorrent-nox-aka-headless) guide. However, that method requires users to modify their login.html file.
"
308330313,6779,Chocobo1,2017-06-14T06:16:38Z,">And if users disable authentication, while on public Wi-Fi, how does that protect them then?

I don't get what you're trying to say.
It seems you're talking about different layers of security measures (e.g. public wifi, wifi with WPA2 or not, qbt session auth, http or https).
While a security measure prevents possible exploits (as side effect or not), you shouldn't mix it (multiple security measures) up when thinking about disabling a specific measure.

@Piccirello 
Thank you.
However, after skimming through those issues, I read that bypassing LAN is the common request, not bypassing all.

If I wasn't clear enough, I **only** support the idea of adding a checkbox stated: ""Bypass authentication for users on LAN""."
308361100,6779,glassez,2017-06-14T08:30:47Z,">the idea of adding a checkbox stated: ""Bypass authentication for users on LAN"".

But this checkbox exists, isn't it?"
308363890,6779,Chocobo1,2017-06-14T08:40:21Z,">But this checkbox exists, isn't it?

No, the one exists is `Bypass authentication for localhost`."
308498401,6779,Piccirello,2017-06-14T17:14:35Z,"I agree that the ""disable for LAN"" option makes more sense from a security standpoint. I'll modify my changes and update when finished."
310217510,6779,Piccirello,2017-06-21T22:00:23Z,"I see that `env_.clientAddress` is storing my ipv4 address `10.0.0.3` in the ipv6 format `::ffff:10.0.0.3`. Will this behavior be exhibited by all clients, or will `env_.clientAddress` ever be in ipv4 format for some users?"
310274421,6779,Chocobo1,2017-06-22T04:48:09Z,">or will env_.clientAddress ever be in ipv4 format for some users?

you'll need to handle 3 formats: 
1. ipv6
2. ipv4 mapped ipv6, see: https://en.wikipedia.org/wiki/IPv6#IPv4-mapped_IPv6_addresses
3. ipv4
"
310883977,6779,Piccirello,2017-06-25T05:40:11Z,"Ok, all three scenarios are now handled by the LAN check. Commits are also squashed. What're your thoughts?"
310891135,6779,Chocobo1,2017-06-25T08:59:28Z,"my review is finished.
👍 for this PR.
"
310894495,6779,glassez,2017-06-25T10:20:42Z,And one more question. Is bypass auth for lan but require it for localhost the expected behavior?
310896106,6779,Piccirello,2017-06-25T10:59:30Z,"> Is bypass auth for lan but require it for localhost the expected behavior?

Sure, I don't see any reason not to offer the ability. Including it does not introduce any complexity, and actually reduces it."
310904886,6779,Chocobo1,2017-06-25T14:11:34Z,"@Piccirello 
You accidentally included an unrelated commit: https://github.com/qbittorrent/qBittorrent/pull/6779/commits/d7cd703b41e177f428313b345143dfd7f80d2495

And I think you can squash all commits to 1 now, also try get rid of the ""Merge branch..."" commit.
If no further comments coming in in a week period, we can merge this in.
"
310927575,6779,Piccirello,2017-06-25T20:53:35Z,"> You accidentally included an unrelated commit: d7cd703

Whoops, removed that."
310927897,6779,Piccirello,2017-06-25T20:58:34Z,"> And I think you can squash all commits to 1 now, also try get rid of the ""Merge branch..."" commit.

Hmm, I don't seem to be able to get around the merge conflict in `optionsdlg.cpp`. I can create a new branch if desired."
310937369,6779,Chocobo1,2017-06-26T00:03:46Z,">Hmm, I don't seem to be able to get around the merge conflict in optionsdlg.cpp

You should resort to `git rebase` instead of `git merge`.
basically
1. roll back to your first commit in this PR
2. make sure your local master branch is synced with this repo, then `git rebase master`
3. fix conflicts then `git add` the fixed files
4. `git rebase --continue`
"
311252018,6779,Piccirello,2017-06-27T04:48:09Z,Thanks for the help. The changes are all in one commit now.
311419786,6779,glassez,2017-06-27T16:56:44Z,"@Piccirello, can you also see #6862? It seems the auth process has a bug but the author of fixing PR is not accessible."
311569516,6779,Piccirello,2017-06-28T06:33:37Z,"Sure thing, I'll have a look at that PR tomorrow."
316266713,6779,Piccirello,2017-07-19T04:04:47Z,"Note to self: update the [wiki](https://github.com/qbittorrent/qBittorrent/wiki/WebUI-API-Documentation#get-qbittorrent-preferences).

* `bypass_auth_subnet_whitelist_enabled` | bool | True if webui authentication should be bypassed for clients whose ip resides within (at least) one of the subnets on the whitelist
* `bypass_auth_subnet_whitelist` | string | (White)list of ipv4/ipv6 subnets for which webui authentication should be bypassed; list entries are separated by commas
"
326967625,6779,Piccirello,2017-09-04T13:47:29Z,"I attempted to rebase onto master, but it seems not to have worked out very well."
327038959,6779,Piccirello,2017-09-04T23:30:40Z,"@LordNyriox 
Just `git rebase upstream/master`"
327073111,6779,glassez,2017-09-05T05:13:59Z,"@Piccirello, it looks like you did a few merges... besides, there are unrelated commits from other people's PRs."
329396554,6779,Piccirello,2017-09-14T07:22:44Z,I went through the commits and pulled out the relevant ones. They've all been rolled up into one now.
337080577,6779,Piccirello,2017-10-17T00:19:13Z,All requested changes have been addressed. Is this PR ready to move forward? @evsh @glassez @Chocobo1 
341883237,6779,Chocobo1,2017-11-04T09:21:51Z,"@Piccirello 
There are conflicts."
341917806,6779,glassez,2017-11-04T18:06:52Z,"@Piccirello, you forgot one more time that you shouldn't merge master into your PR branch. You should rebase your branch on top of master."
341918756,6779,Piccirello,2017-11-04T18:18:30Z,"@glassez GitHub's ""Resolve conflicts"" editor is just too tempting!

The conflict has been resolved and locally nothing is complaining, but GitHub insists there's still a conflict."
341949765,6779,glassez,2017-11-05T05:13:58Z,"@Piccirello, I've done it for you (rebased and squashed). You need to force update your local branch."
341949924,6779,glassez,2017-11-05T05:18:19Z,">GitHub's ""Resolve conflicts"" editor is just too tempting!

You shouldn't use GitHub editor. When you need to resolve conflicts in your PR, you need to rebase your local branch on top of current qBittorrent master (manually resolving some conflicts if required) and then force push it on GitHub."
342023518,6779,Piccirello,2017-11-06T01:26:29Z,Thanks @glassez.
342505310,6779,glassez,2017-11-07T14:49:37Z,">Thanks @glassez.

@Piccirello, what the hell are you doing? Are you kidding me?
I squashed your fixup commits for you, I even fixed the remaining coding style issues for you... You don't have to do anything anymore. The only thing you had to do is ""to force update your local branch"" (as I suggested you), to make it identical with PR branch on GitHub. But what did you do? You did the opposite! You just returned everything as it was (with the exception of fixed conflict). I don't even know what to say... Maybe ""Please squash your commits and fix the coding style"".
(I'm sorry if I was overly emotional)."
342527168,6779,glassez,2017-11-07T15:53:56Z,">Please squash your commits and fix the coding style

Ok. You can forget about commits squashing since they are unrelated. But coding style issues are still be fixed."
342530020,6779,Piccirello,2017-11-07T16:01:47Z,">Fix coding style.
The rest is ok.

Care to point out the style issues? I re-pushed the repo because you squashed unrelated commits."
345549313,6779,Piccirello,2017-11-19T21:02:14Z,@evsh @Chocobo1 Any further changes required?
345782917,6779,WolfganP,2017-11-20T18:20:22Z,"Great work @Piccirello 
I hope this great addition is promptly merged into master."
345792089,6779,glassez,2017-11-20T18:54:07Z,"@Piccirello, thank you!
Thanks for all reviewers as well!"
345860686,6779,Piccirello,2017-11-20T23:01:47Z,"Woohoo! Glad we were able to get this merged.

Thanks for the back and forth over many months @Chocobo1 @glassez @evsh "
406951325,6779,nomandera,2018-07-23T06:18:53Z,"Posting for posterity. If you wish to turn of authentication completely, say in the scenario where the web interface is protected by a separate TLS nginx/apache/trafik/haproxy reverse proxy you can add `0.0.0.0\0` to allow the entire IPv4 space which includes the internet.

Insert obvious warning: dont do this if dont know what you are doing, authentication is there for a reason."
297590444,6698,Chocobo1,2017-04-27T02:01:53Z,">I expect themes to be used in WebUI too. That is why most of the code reside in base/theme. 

I don't think WebUI matters much in this case, there are 3rd party interfaces to use.

>I would prefer to have a separate app for the theme creating and editing

+1, something like a basic mockup of qbt.

>Theme may inherit another theme

Doesn't this boost up the complexity? for devs, dependency cycles? for users also, imagine a creator shares one of his theme but the theme depends on another one he didn't share....
I don't think this is a good idea, most users can live without it.

>Where these files should go?

I imagine there will be import button and maybe export button, then this shouldn't be an issue.
"
297631930,6698,zeule,2017-04-27T07:15:58Z,"> I don't think WebUI matters much in this case, there are 3rd party interfaces to use.

This would greatly simplify things. 

> Doesn't this boost up the complexity? 

Yes, but advantages outweigh, I think. We can deal with the problem you mentioned in the following way: when a theme inherits a non-existent one, or inherits nothing, we can modify it on loading to inherit one of the base qBt themes. In this way the theme will continue to work somehow. But what we get in return is flexibility to add new elements to our base themes without breaking all the user ones.

>> Where these files should go?

> I imagine there will be import button and maybe export button, then this shouldn't be an issue.

I meant not a theme file, but implementation of a new color scheme, like `QPalette` but for Plasma."
298567792,6698,zeule,2017-05-02T09:07:01Z,"PR Updated: all files are now in `src/gui/theme`, initialisation is done by the `MainWindow` class. Added base font theme support. Open question: how to denote ""Application default font"" in the theme file? Just write and empty string as value or use a special keyword?"
298705159,6698,zeule,2017-05-02T17:32:20Z,Before making the final push and polishing I would very much appreciate your opinions.
299189825,6698,zeule,2017-05-04T13:46:50Z,"Here is another question. Consider font themes. Quite likely the default font theme should use default application font. In terms of `QFont::fromString()` this is an empty string. OK, then out default theme looks as follows:
```ini
[Info]
Name=Default
Description=Default qBittorrent font theme.

[Fonts]
TransferList=QFont:
TorrentProperties=QFont:
ExecutionLog=QFont:
```
which is not very good, because of the empty descriptions. @LordNyriox believes that a descriptive placeholder is better:
```ini
[Fonts]
TransferList=QFont:<default>
TorrentProperties=QFont:<default>
ExecutionLog=QFont:<default>
```
But here is another decision: when exporting a font theme, should we compare fonts to the default one and write empty string or the placeholder? Or should we write full font string? I tend towards the latter, because if user wants the default font, they can simply erase the description string from the theme. Or, we may check whether theme contains default fonts and ask user first how they need to be serialized: as full descriptions of as empty strings. "
299250775,6698,glassez,2017-05-04T17:15:54Z,"Why should default theme define something? It has only default values, isn't it?"
299251042,6698,zeule,2017-05-04T17:16:58Z,"Well, default colour theme define colours. Why default font theme can't?"
299260851,6698,glassez,2017-05-04T17:53:09Z,I just mean we can omit default values...
299268516,6698,zeule,2017-05-04T18:22:14Z,"If you suggest to omit entries with default values in the default theme files, then I disagree. It would perplex theme loading code and theme interface. Naturally, inherited values are omitted in a theme. But they are simply loaded from the inherited theme. Otherwise, the theme loading code (resides in the theme class now) needs to know what value is the default one, and while it is more or less obvious for fonts, there is no a single default value for colours. That is why I decided that it will be simpler for us to control default values via default theme files, but not from source code. Those theme files are bundled as resources and always present. The only thing code needs to know is the name of the default theme. "
299270155,6698,glassez,2017-05-04T18:28:37Z,"Then I don't know how the previous questions? If you need explicit values, then use them. What empty strings and placeholders?"
299274007,6698,zeule,2017-05-04T18:43:11Z,"> If you need explicit values, then use them.

Because I also need ""default application font"" value. 

OK, thank you for the discussion. I think to implement empty strings and optionally replace them with font descriptions when exporting a font theme."
299399151,6698,glassez,2017-05-05T07:21:33Z,">Because I also need ""default application font"" value.

What do you mean by that?"
299662248,6698,zeule,2017-05-06T19:52:29Z,PR updated: font themes are used in the app now. Implementation borrowed from #6196 and I thank @Zalewa for that.
299662330,6698,zeule,2017-05-06T19:53:45Z,">> Because I also need ""default application font"" value.

>What do you mean by that?

Please see the current built-in font theme. It contains empty values which mean ""application default font""."
299662700,6698,Zalewa,2017-05-06T20:00:49Z,Thanks for notification. I'm glad to know that this is being worked on.
299668921,6698,zeule,2017-05-06T22:10:12Z,"@thalieht: thanks, addressed!"
299692821,6698,glassez,2017-05-07T09:24:44Z,">Please see the current built-in font theme. It contains empty values which mean ""application default font"".

I still don't understand why you can't omit these entries instead of having empty values.
"
299698120,6698,zeule,2017-05-07T11:03:26Z,"> I still don't understand why you can't omit these entries instead of having empty values.

Suppose you are modifying a theme element or extending theme type. For example, you are renaming theme element. You have to rename it in base theme file and in the source code. And suppose you forgot to change its name in one of the places or mistyped it. With current approach you get error during theme loading, while in the opposite case you would silently get default font.

It is even more important, I think, that themes of both types behave uniformly, because there is no ""default colour"" and one may not omit colour elements."
301295957,6698,glassez,2017-05-14T07:27:18Z,"@evsh, by the way, why not implement theme support using Qt style sheets?"
301318266,6698,zeule,2017-05-14T14:53:32Z,"Stylesheets change widget rendering engine, and the widgets do not look native anymore. While with this PR I try yo get more native look for qBt. However, this PR offers a way to add more theme types."
301863518,6698,Chocobo1,2017-05-16T17:58:03Z,"It's impossible to review it all in one run, I'll find time later...
In the meantime, can we see some screenshots for .ui files changes?
Also what the theme files look like? (a link to gist would be nice)
"
301889322,6698,zeule,2017-05-16T19:26:06Z,"Thanks, @Chocobo1!  
>In the meantime, can we see some screenshots for .ui files changes?
Also what the theme files look like? (a link to gist would be nice)

Included in the top post."
302186292,6698,glassez,2017-05-17T18:29:11Z,"@evsh, sorry, I have too little free time now to consider such a large PR. I dedicated it for smaller and more urgent PRs in the last time. Now, when most of them completed, I'm going to pay attention here. Most likely I will be able to do this only parts. I want to start with the interface (points of contact between your new code and the existing application)."
302314323,6698,zeule,2017-05-18T06:35:44Z,"@LordNyriox: if people want, why not?"
302700573,6698,zeule,2017-05-19T13:19:22Z,"PR updated. With these many commits fixup commits create a mess (at least I can't handle them without mistakes), so updated everything."
303285835,6698,Brylord,2017-05-23T04:14:36Z,"I'm a semi-professional graphic designer, and I'd enjoy making new icons/graphics for qbittorent. As I don't expect to return here often, please contact me via email if interested:
bry.d.reed@gmail.com"
303356166,6698,zeule,2017-05-23T10:21:36Z,"@LordNirox, I like the idea and will add these themes. Thank you for the links."
303448935,6698,zeule,2017-05-23T16:06:36Z,"@LordNyriox, I think the icons colouring is independent from the exact colour set in use. But if @magao is active no more, I can  re-submit that PR."
303891554,6698,LordNyriox,2017-05-25T00:44:57Z,"@evsh:  Ugh.  I replied when I was half-asleep, and have a far too literal mind.  

The reason I support [<https://github.com/qbittorrent/qBittorrent/pull/6186>] is because the status icons originally correlated to the colors of the text they were associated with.  

The colors I referenced from [<https://github.com/qbittorrent/qBittorrent/commit/276ca0ab8463433daeec473746fe38ad03c14e14>] confirm this.  (Orange for seeding, grey for checking, undefined for paused, etc.)  

The intent behind my request was to bring the status icons closer to their origins, while retaining the adaptivity of this new theme system.  

I hope that makes more sense…  

"
303972625,6698,zeule,2017-05-25T09:59:34Z,"@LordNyriox, I see. May I use your SVG icons from https://github.com/qbittorrent/qBittorrent/pull/6186/commits/1b9a368769388adf35a3a7acea8931b754b2446d, please? We can change their colors pretty easily on the fly."
304477843,6698,zeule,2017-05-27T21:34:55Z,"@LordNyriox, excuse me, I missed your question somehow. Yes, you are right, default theme is inherited when `Inherits` keyword is missing. There is one more refinement: the default them is either 'Default (Light)' or 'Default (Dark)' depending on the current palette: if background colour is dark, the dark default theme is selected."
305569985,6698,glassez,2017-06-01T17:53:01Z,"I'm follower of native appearance so I can not to understand some things about this issue. But I'll still ask some questions.
First. It is really needed per-element assigning colors/fonts? Why don't you define some font/color classes and assigning it to gui elements. I mean something like QPalette. E.g. some GUI element uses ColorTheme::WindowText color and we assign its real value in theme file. Do users really need more fine-tunings?"
305571660,6698,glassez,2017-06-01T17:59:18Z,"And again. I understand that someone wants to have it in the next release. I believe that this feature is still too young. There is still something to think about. The main thing is that it relates to user scope, and it will be difficult to change this after release."
305590594,6698,sledgehammer999,2017-06-01T19:07:45Z,">I understand that someone wants to have it in the next release. I believe that this feature is still too young. There is still something to think about.

I skimmed the thread and I am also torn about it and the direction is seems to have gotten to. I can't say something **specific** atm. I have it open in a browser tab. I want to prioritize #5766 and #6156. Then I can come back here and see what the fuss is about."
305591660,6698,zeule,2017-06-01T19:11:56Z,"> I'm follower of native appearance so I can not to understand some things about this issue.

Me too. I started all this to get native Plasma colours in the app. You might remember that I was trying two times before this PR.  

> And again. I understand that someone wants to have it in the next release.

I don't, it is not only untested, but contains many questionable design decisions."
305592311,6698,sledgehammer999,2017-06-01T19:14:30Z,">I don't, it is not only untested, but contains many questionable design decisions.

Then is it prudent to tag this with a v3.4.1 milestone and focus for v3.4.0?"
305607177,6698,zeule,2017-06-01T20:13:28Z,"> Why don't you define some font/color classes and assigning it to gui elements. 

@glassez, could you explain this in more details, please?"
305684969,6698,glassez,2017-06-02T04:15:06Z,"I am presuming all elements of the same type have to look alike. E.g. all list widgets have same appearance (colors and fonts), all buttons have same appearance etc. Moreover, many elements of different types can have the same parts (eg. text), as well as it works in the native look'n'feel. So we can not to assign font/color to each gui component (e.g. transfer list widget, properties widget etc.) but do it for gui element types (e.g. list view, button, checkbox etc.) or even create classes of fonts (e.g. WindowText, WindowCaption, and so on, like Qt has) and colors (like in QPalette) and use it (e.g. all list/tree/table use same text, same background, as it is now)."
305734059,6698,zeule,2017-06-02T09:13:03Z,"Thank you for the explanation. This PR does not touch look of the standard widgets in any way. Here I try to solve the following problem (it is a problem for me, at least): qBt uses colours in its GUI for various UI elements, and those colours clash with the rest of desktop. For example, red colour is used for alert messages and negative statuses, but the pure red colour produces much of eye strain with dark backgrounds and thus is not used by the rest of the applications, that follow Plasma color scheme. 

Unfortunately, `QPalette` is designed to be the least common denominator for all platforms and it contains only the very basic set of colours (probably because Qt developers see it only as a way to communicate with `QStyle`). However, there are applications that need colours for communicating with users and a handful or colour roles offered by `QPalette` is not enough. For example, KDE apps use another approach to application colour palette. There palette defines (in addition to `QPalette`) colours for active, positive, neutral, and negative elements, and 2 colour effects to produce inactive and disabled sets of colours as well as a standard way to make complementary colours.

So, this PR adds a way to define colours for those UI elements that need colours not from the basic `QPalette` set. I can understand that Windows users might be interested in a custom colours for all UI elements (to make a dark UI). For this case we may override default app palette and switch style to e.g. Fusion. I would like to note that this PR makes it possible to implement such things later on, i.e. the proposed theme design allows to extend base themes and then provide more colour roles for users.    "
305765425,6698,glassez,2017-06-02T11:52:51Z,"Are you saying that using this feature, I can't really change the theme? I can only change the appearance of those elements that originally have an altered (non native) appearance?"
305771213,6698,zeule,2017-06-02T12:24:14Z,"You are on Windows, and as such the only way for you to ""change the theme"" is to change style via UXTheme API, AFAIK. Or use one of the Qt custom widget styles, that look as aliens everywhere (example: https://gist.github.com/QuantumCD/6245215). Such theming we can add easily with this PR.

This PR offers:
1. A framework for adding themes: theme files lookups, theme inheriting, framework to add various sources for theme elements (like Plasma colours were added). In the very same way one can add GTK colours, for example, or colour theme from any other desktop environment. Themes can be extended with additional elements and this will not destroy existing ones (including user themes).
2. The framework from item 1 is used to setup colours for transfers list, download progress bar and log window. And Plasma colours theme gives theme native appearance."
305792981,6698,zeule,2017-06-02T13:50:59Z,"@LordNyriox I've tried to find all explicit blue colours and replace theme with `QPalette::Link` colours. This has to be in master already. Do you say that with your custom colour theme the link colour is still bright blue? Or do you mean there are still places in qBt where explicit blue color is used?

Parsing of Windows theme files is not a big deal, but I don't see any colour there that can be used for our purposes. Could you suggest, for example, which ones to use for the download progress bar? "
312643039,6698,zeule,2017-07-03T13:17:02Z,"PR changed significantly.  There were too many commits for me to handle, and I squashed most of them. Added many changes to icons. See the update in the top post.
"
313061178,6698,zeule,2017-07-05T10:10:15Z,"@LordNyriox: thanks, the typo was corrected."
313425389,6698,zeule,2017-07-06T15:10:23Z,"Added screenshots with de-colorized icons. @vit9696, does it  look OK for MacOS?"
313447979,6698,vit9696,2017-07-06T16:27:33Z,"@evsh, ok, I got to compile your themes branch.  
I haven't merged anything from my changes, so it is purely as is.  
The result is a bit aesthetic: [screen shot](https://user-images.githubusercontent.com/4348897/27921394-5c86be10-6280-11e7-9675-a49bf90b0ac4.png). Same for both default and monochrome themes.  
I see nothing obvious in the [compilation log](https://ghostbin.com/paste/3959o) or [at launch](https://ghostbin.com/paste/fxspp). Do you have any ideas what could it be?

Also, by the way, I noticed that Appearance is borked on the screens above. Is that a known issue?"
313449125,6698,zeule,2017-07-06T16:31:37Z,"@vit9696, thank for the test! The monochrome icons have to be created in a temporary dir. Could you, check, please, return value of `GuiIconProvider::colorizedIconsDir()` and look into that directory?"
313449827,6698,zeule,2017-07-06T16:34:06Z,"> Also, by the way, I noticed that Appearance is borked on the screens above. Is that a known issue?

It is absent. qbt icons set does not contain an icon for this new page an I have no idea how to get it. Maybe we can ask @bertyhell to make one? When qBt was using KDE icons it was easy to borrow one. I don't know how it was supposed to work with the custom set."
313450207,6698,zeule,2017-07-06T16:35:27Z,"> The result is a bit aesthetic: screen shot. Same for both default and monochrome themes.

Hmm, if it shows no icons for the default theme, does it mean Qt fails to render SVG icons in general?"
313451729,6698,vit9696,2017-07-06T16:41:17Z,"It gives me `~/Library/Application Support/qBittorrent_icons_` and that directory does not exist at all (creating it changes nothing either). I think that no SVG icons are rendered indeed. At least because we could see some png ones.

On this VM I have Qt 5.9.0 from homebrew, are you aware of any issues affecting this version? Could compile from the source, but I personally have strong doubts it will be any different."
313456678,6698,zeule,2017-07-06T16:59:29Z,@LordNyriox: I have no idea how to get an icon from there.
313457067,6698,zeule,2017-07-06T17:00:54Z,"> It gives me ~/Library/Application Support/qBittorrent_icons_

There has to be a random affix in that name. For example, in Linux I get /run/user/1000/qBittorrent_icons_3HkUSo."
313457573,6698,vit9696,2017-07-06T17:02:50Z,"Oh, I added a print inside the function and did not notice it at first.  
Yes, now I do see the folder created, and it actually has the svg files."
313458392,6698,vit9696,2017-07-06T17:06:08Z,Tracked it down. PlugIns/iconengines/libqsvgicon.dylib was not added to the app bundle for some unknown reason. After I copied the dylib manually I got the icons. Should there be some flag in CmakeLists?
313459665,6698,zeule,2017-07-06T17:10:59Z,I was pretty sure that `fixup_bundle()` collect all required dependencies. But I see on the Net that folks install plugins manually (first link from Google:  https://github.com/MITK/MITK/blob/master/CMake/mitkInstallRules.cmake). 
313464091,6698,vit9696,2017-07-06T17:27:42Z,"Well, here are some screens:
![screen shot 2017-07-06 at 10 08 47](https://user-images.githubusercontent.com/4348897/27923630-be0fcd3c-6287-11e7-8188-839a547a6581.png)
![screen shot 2017-07-06 at 10 09 46](https://user-images.githubusercontent.com/4348897/27923633-be58ae26-6287-11e7-892b-d9f41a0b06bd.png)
![screen shot 2017-07-06 at 10 09 59](https://user-images.githubusercontent.com/4348897/27923635-be5affbe-6287-11e7-9b23-5ad432ee1357.png)
![screen shot 2017-07-06 at 10 10 06](https://user-images.githubusercontent.com/4348897/27923632-be5793ec-6287-11e7-88f8-465afa5f4dd8.png)
![screen shot 2017-07-06 at 10 10 15](https://user-images.githubusercontent.com/4348897/27923634-be5a72f6-6287-11e7-8152-b55c675e838c.png)
![screen shot 2017-07-06 at 10 11 06](https://user-images.githubusercontent.com/4348897/27923631-be57565c-6287-11e7-8f9c-e7a015bfe042.png)

I would say the result is discussible:
* That first icon with a plus sign (add url?) looks pretty terrible, the rest look more or less ok;
* Appearance icon in prefs is gone no idea where;
* Sidebar font differs between monochrome and default;
* Sidebar/status icons are unchanged and look very far from nice.

As for the last one, compare to e.g. [Xcode](https://user-images.githubusercontent.com/4348897/27923931-cd122f68-6288-11e7-893d-791a647708ec.png). I think the beginning of the issue is that something is done with the colour of the highlighted line. This is not what happens in native mac apps. Do you have an idea how to turn it off? Once this is done it should be more or less visible whether it is necessary to make the icons brighter.

EDITED by evsh to enable image previews."
313473782,6698,zeule,2017-07-06T18:03:45Z,"Thanks for the details!

> That first icon with a plus sign (add url?) looks pretty terrible, the rest look more or less ok;

Original one contains two colours, that make it readable. When we replace both with black, I don't know what else to expect.
 
>Appearance icon in prefs is gone no idea where;

It is absent. See discussion with @LordNyriox just above.

> Sidebar font differs between monochrome and default;

Font? I don't touch font with icons changes. And do not see that in your screenshot. Could you point out where does it differ?

> Sidebar/status icons are unchanged and look very far from nice.

They are unchanged because some of them differ by colour only. You can control their colours with colour theme."
313477996,6698,vit9696,2017-07-06T18:19:50Z,"Could be just the size actually: [screen](https://user-images.githubusercontent.com/4348897/27925879-02236eaa-628f-11e7-9299-eae1eef34215.png). 

The outer + border should be removed I guess, so that it visually looks somewhat like [this](https://user-images.githubusercontent.com/4348897/27925940-437a7a38-628f-11e7-8a05-6de1ceab6be6.png)?"
313533010,6698,zeule,2017-07-06T22:09:32Z,@LordNyriox : thanks! Managed to add an icon. 
313615003,6698,vit9696,2017-07-07T08:00:20Z,"@evsh, got my hands onto that tachometer icon. Could you replace this misunderstanding once and forever? [tachometer.zip](https://github.com/qbittorrent/qBittorrent/files/1130356/tachometer.zip)


"
313642193,6698,vit9696,2017-07-07T10:07:30Z,"Ok, checked status icon colouring. To disable colour modification on selection it seems to be necessary to add something like:  
```
QIcon icon = QIcon("":/icons/skin/paused.png"");
icon.addPixmap(QPixmap("":/icons/skin/paused.png""),QIcon::Selected);
```
This produces the correct behaviour on macOS for all list-like icons (so sidebar, torrent statuses, countries in peer list). I was thinking of adding such stuff in my pull-request, but given the amount of changes you made to icon loading (it is a real mess in trunk at the moment), I think it will be better to do such stuff either right in this pull request or later.

Is this going to be merged any soon? At the moment I see Error and Warning icons being incomplete plus that speed limiter thing I posted above, but I guess there is other stuff to be done?"
313683563,6698,zeule,2017-07-07T13:40:41Z,"> To disable colour modification on selection it seems to be necessary to add something like:…

We can easily do this for status icons (with the correction for SVG, using `QIcon::addFile()` instead of `QIcon::addPixmap()`). Thanks!

> Is this going to be merged any soon?

I doubt it will be merged for 3.4.0, that would require a lot of review work given the size of the PR. Maybe 3.4.1 will catch this.

> At the moment I see Error and Warning icons being incomplete…

Don't understand what do you mean. Could you explain, please?

>…plus that speed limiter thing I posted above,

See the end of the first post. Basically, I want to use an icon from Linux theme for the limiter. But I can't get a file path from Qt to flip the SVG. Most likely I will flip the pixmap in the icon.

 > …but I guess there is other stuff to be done?

Apart from the listed above, I plan to add a widget to select color for the monochrome icons, and maybe  I can find a few more icons for torrent status in order to give all of them different shape.   "
313692811,6698,vit9696,2017-07-07T14:09:19Z,"> Don't understand what do you mean. Could you explain, please?

I meant that for a complete svg transition there still are no svg icons for the error/warning icons in the sidebar.

> See the end of the first post. Basically, I want to use an icon from Linux theme for the limiter. But I can't get a file path from Qt to flip the SVG. Most likely I will flip the pixmap in the icon.

Alright.

> Apart from the listed above, I plan to add a widget to select color for the monochrome icons, and maybe I can find a few more icons for torrent status in order to give all of them different shape.

Ideally none of them have holes inside, since they make things look much worse when selected on macOS, try to keep it in mind.

"
313697434,6698,zeule,2017-07-07T14:26:46Z,"> I meant that for a complete svg transition there still are no svg icons for the error/warning icons in the sidebar.

What is sidebar? Do you mean torrent states or something else?"
313698358,6698,vit9696,2017-07-07T14:30:05Z,"Oh, sorry. Was talking about [this](https://user-images.githubusercontent.com/4348897/27962223-e0d13c86-6339-11e7-8eae-4e6887e51523.png).
"
313699714,6698,zeule,2017-07-07T14:35:13Z,"Thanks. I guess, `QStyle::standardIcon()` has to be used there."
315327267,6698,zeule,2017-07-14T10:27:51Z,@vit9696  #7103 should fix the problem with svg plugin. I would appreciate a test from you with that one when merged.
315523603,6698,vit9696,2017-07-15T09:53:17Z,"@evsh wanted to check it, but rebasing finds way too many commits with master. Could you please update your pull request so that the work is not done twice for no reason?"
315527081,6698,zeule,2017-07-15T11:05:18Z,"Oops, pardon. Forgot to push rebased changes. Done now."
315527681,6698,vit9696,2017-07-15T11:16:57Z,"Alright, works just fine now."
315527919,6698,zeule,2017-07-15T11:22:30Z,Thank you!
315629836,6698,sledgehammer999,2017-07-16T19:04:04Z,"@evsh I see a lot of posts in this thread. I assume that you might have re-architectured things since you first started this. So I am asking if the info in your opening comment are still valid.
Second question: Is there any soft/hard conflict with other devs in the direction taken here? If so, please point me to the relevant comment OR just summarize it.

Otherwise, I can start reviewing the direction + commits. Thanks."
315664996,6698,glassez,2017-07-17T04:09:50Z,">Then is it prudent to tag this with a v3.4.1 milestone and focus for v3.4.0?

I think we should release v3.4.0 without this feature. IIRC, all features we scheduled for v3.4.0 are completed and merged. What bothers to release its public beta now?"
315730473,6698,zeule,2017-07-17T11:30:57Z,"@sledgehammer999, the opening text is valid (made a little change to mark one more task as completed). 
The colour part of this PR is ready for a review. It consists of commits until the one entitled  ""Refactor icons handling"". The icons part is still under development. 

I support @glassez opinion about 3.4.0. This PR is probably too large for that milestone and it will significantly delay release, especially as I can not invest much time into qBt right now.

> Second question: Is there any soft/hard conflict with other devs in the direction taken here? If so, please point me to the relevant comment OR just summarize it.

I stole commits from #6196, so there is no conflict there. There is a conflict with #6186, as this one implements icons colorization in a different way (transforming SVG source but not bitmaps)."
316560980,6698,sledgehammer999,2017-07-20T00:26:22Z,"I finally released 3.3.14 today.
New plan for tomorrow/day-after-tomorrow:
1. Branch off master to make `v3_4_x`.
2. Take necessary actions for pushing strings to Transifex.
3. Release a beta the weekend or the coming week.
4. Wait to see what gets reported back.
5. In the meantime investigate any possible items under the v3.4.0 milestone(eg #6484).
6. Depending on step 4 we might do the stable release at the end of July or at the start of August.

Regardless of the above, I will continue reviewing this."
316609614,6698,glassez,2017-07-20T06:29:00Z,">New plan for tomorrow/day-after-tomorrow:
>
>Branch off master to make v3_4_x.
Take necessary actions for pushing strings to Transifex.
Release a beta the weekend or the coming week.
Wait to see what gets reported back.
In the meantime investigate any possible items under the v3.4.0 milestone(eg #6484).
Depending on step 4 we might do the stable release at the end of July or at the start of August.

👍 "
316641383,6698,zeule,2017-07-20T08:57:05Z,"> New plan for tomorrow/day-after-tomorrow:…

Fine. Let me know if you want to split this PR onto two (themes + icon changes). 

P.S. Updated the opening post removing outdated parts."
332175563,6698,silverqx,2017-09-26T11:57:31Z,Should the dark theme work? I tried on win10 and ubuntu gnome and without success.
332176943,6698,zeule,2017-09-26T12:04:31Z,"Please explain what does not work, I don't understand what do you mean by ""dark theme"". This PR controls only colours of the custom-drawn UI elements (i.e. the widget colours are controlled by a system style). The whole aim of this PR is to fit qBt internal colours into the existing colour/style environments."
332181744,6698,silverqx,2017-09-26T12:25:51Z,"I meant `Options - Themes - Color theme - Default (Dark)`, I expected that when i select dark theme, it will look like screenshot in first post."
332182281,6698,zeule,2017-09-26T12:28:12Z,"No, it will not, sorry. That is controlled by Qt Style."
332183023,6698,zero77,2017-09-26T12:31:24Z,"@evsh 
Will this be implemented in the web-ui."
332188838,6698,zeule,2017-09-26T12:54:57Z,"@zero77: no, there are no such plans at the moment, and see the discussion above, please."
332191001,6698,silverqx,2017-09-26T13:02:43Z,"> No, it will not, sorry. That is controlled by Qt Style.

So it for now change colors for `TorrentState` and `Log messages`, if I understand.

Missing icons for `toolButtonExportColorTheme` and `toolButtonExportFontTheme` and get this wanrings during compile:
```
..\..\qBittorrent\src\gui\optionsdlg.ui: Warning: The name 'horizontalLayout_12' (QHBoxLayout) is already in use, defaulting to 'horizontalLayout_121'.
..\..\qBittorrent\src\gui\optionsdlg.ui: Warning: The name 'label_24' (QLabel) is already in use, defaulting to 'label_241'.
..\..\qBittorrent\src\gui\optionsdlg.ui: Warning: The name 'verticalLayout_25' (QVBoxLayout) is already in use, defaulting to 'verticalLayout_251'.
..\..\qBittorrent\src\gui\optionsdlg.ui: Warning: The name 'scrollArea_5' (QScrollArea) is already in use, defaulting to 'scrollArea_51'.
..\..\qBittorrent\src\gui\optionsdlg.ui: Warning: The name 'scrollAreaWidgetContents_5' (QWidget) is already in use, defaulting to 'scrollAreaWidgetContents_51'.
..\..\qBittorrent\src\gui\optionsdlg.ui: Warning: The name 'verticalLayout_26' (QVBoxLayout) is already in use, defaulting to 'verticalLayout_261'.
..\..\qBittorrent\src\gui\optionsdlg.ui: Warning: The name 'verticalLayout_21' (QVBoxLayout) is already in use, defaulting to 'verticalLayout_211'.
..\..\qBittorrent\src\gui\optionsdlg.ui: Warning: The name 'verticalSpacer_5' (QSpacerItem) is already in use, defaulting to 'verticalSpacer_51'.
..\..\qBittorrent\src\gui\optionsdlg.ui: Warning: The name 'horizontalLayout_10' (QHBoxLayout) is already in use, defaulting to 'horizontalLayout_101'.
```

Progress bar in General panel should reflect this color scheme too."
332191951,6698,zeule,2017-09-26T13:06:23Z,"> So it for now change colors for TorrentState and Log messages, if I understand.

Also for the download progress bar, i.e. all the custom qBt colours.

> Progress bar in General panel should reflect this color scheme too.

Yes, it is covered too. 

> Missing icons for toolButtonExportColorTheme and toolButtonExportFontTheme

Thanks!"
334117980,6698,glassez,2017-10-04T10:46:12Z,"@evsh, this PR became unmaintainable. 13 commits (not so bad) and 315 changed files (!!!). GitHub is terribly slow here, and navigation is not working.
Maybe you should separate independent changes in another PR (I mean coding style fixes and so on)? We could merge them first."
334990458,6698,zeule,2017-10-08T08:07:54Z,@LordNyriox: thanks!
336432175,6698,zeule,2017-10-13T11:58:49Z,"@LordNyriox: could you redo the status icons inversion with the updated icons, please?"
336548264,6698,zeule,2017-10-13T19:38:16Z,@LordNyriox: thanks a lot! I don't need PNGs for this PR (which in fact drops PNG icons in favor of SVG files).
366261171,6698,Symbai,2018-02-16T15:09:18Z,Is this still being worked on?
377020178,6698,Adowrath,2018-03-28T20:12:04Z,"Guys, it's been quite some time of silence on this. Can we expect theming in any version, at all, considering it's been almost a year since the PR came up? I'd love the feature to be in qbit. I wish I could help even, but I don't have much knowledge of C++ and Qt. :/"
378902085,6698,5ay3h,2018-04-05T11:16:45Z,Will fix #6434 
485147182,6698,danilaml,2019-04-20T17:56:33Z,Sad it's been closed. The simplistic yet informative uTorrent look is the only thing keeping me from switching to qBittorrent completely.
596218536,12144,jagannatharjun,2020-03-08T15:37:51Z,"This is the original work of @sledgehammer999 https://github.com/qbittorrent/qBittorrent/pull/10384
It seems to be not continued but it fixes a style bug and was implemented in a way that will be a bit difficult for me to achieve the quality of, so I took the initiative and opened a PR, hope @sledgehammer999  is okay with this 🤞😊 "
596440440,12144,glassez,2020-03-09T10:12:56Z,"@jagannatharjun
Well, what is the current status of this PR? You just copied the original one and that's it?"
599563823,12144,jagannatharjun,2020-03-16T14:22:46Z,"> Well, what is the current status of this PR? You just copied the original one and that's it?

Well I didn't, I thought sledgehammer remodel the PR, and do you have anything specific in mind"
599572333,12144,glassez,2020-03-16T14:38:02Z,"@jagannatharjun, if you really want to finish  #10384 first of all you should to consider all unaddressed comments there."
599603509,12144,jagannatharjun,2020-03-16T15:35:37Z,@Chocobo1 I did try to address your comments can you take a look?
599696410,12144,jagannatharjun,2020-03-16T18:33:19Z,"Doesn't seem to understand why @sledgehammer999 used QTreeView instead of QListView, IMHO QListView make more sense so I reverted to use QListView instead"
599991903,12144,glassez,2020-03-17T10:22:52Z,"Here s my general review.
First of all I strongly object the development way when you adjust base classes to fit upper level needs. Ideally any base class should implement some subject domain model and it should has corresponding interface (that has a meaning in terms of implement subject domain).
As of Logger class the complete interface could be the following, IMO:
1. Add message of some type
2. Get messages (either all or the rest since some timepoint, assuming we have precision of ""timepoint"" type that is enough to keep timepoints unique)
3. Notify when new message is added

There is no point to obtain some specific message of from log since user wants to see either all log or its part starting from some timepoint it didn't see before.

Of course it requires the messages to be cached in ""presentation"" model. But as far as I can tell, it shouldn't cause any significant problems. On the contrary, I see some additional improvements:
1. Don't touch Logger several times per ""presentation"" model item access (currently you call it for each data role)
2. Store view-friendly data to avoid multiple conversions.
3. Have differed item count than the log itself (IMO, it's a really good idea to show less messages than logger itself can contain).

Current Model/View classes have the following disadvantages:
1. Many of duplicated code due to the fact we have Log and PeerLog that provide the similar functionality except the item type.
2. Unjustifiably creating specific to ""logging""  view types that don't actually have any specific logic, so we can use generic types instead."
600042289,12144,jagannatharjun,2020-03-17T12:25:08Z,"> 2\. Get messages (either all or the rest since some timepoint, assuming we have precision of ""timepoint"" type that is enough to keep timepoints unique)

I can't think of something with such precision, we currently store timepoints in milliseconds which is IMO is not enough to maintain the uniqueness, I don't think even nanosecond will be able to give what we needl, also since the logmsg can be called from different threads we can't assume the messages are inserted in order of the timestamps that will make searching the message after the timepoint a linear operation. the current method is constant time. we can use std::set(QSet is unordered)


> 1. Add message of some type
> 3\. Notify when new message is added

Isn't what current Logger class does.





> There is no point to obtain some specific message of from log since user wants to see either all log or its part starting from some timepoint it didn't see before.
> 
> Of course it requires the messages to be cached in ""presentation"" model. But as far as I can tell, it shouldn't cause any significant problems.

I infer the following -> you don't want to store the messages in `Logger` anymore, it should just forward them and the consumers should catch it do whatever they need to do. But logger is initialized way before the ExecutionLogWidget, so GUI will miss plenty of important logs. Fun Fact - all that `getMessagesRange` does is this. it was only called once with lastKnownId = -1 so I think the logic can be greatly simplified. It actually provides the range of the message before the ""**timepoint**"" (-1) it was called. 
"
600052036,12144,glassez,2020-03-17T12:48:48Z,">I infer the following -> you don't want to store the messages in Logger anymore,

You're wrong. Otherwise it can't provide the following:
>Get messages (either all or the rest since some timepoint,

It's still needed since some component needs to obtain messages that are posted before its creation. Also some ""clients"" can't track message addition synchronously.
> I don't think even nanosecond will be able to give what we needl

Well, we can still use current ""message number"" way."
600054313,12144,jagannatharjun,2020-03-17T12:53:56Z,"> Well, we can still use current ""message number"" way.

What do you propose, message number simplifies things and just does everything we need in an acceptable manner(my understanding can be limited though?)"
600059537,12144,glassez,2020-03-17T13:04:55Z,">What do you propose

It's still [here](https://github.com/qbittorrent/qBittorrent/pull/12144#issuecomment-599991903) (simply using sequential numbering as timepoints)."
600074484,12144,jagannatharjun,2020-03-17T13:34:51Z,"@glassez  I am very sorry I read it - 
> Well, we can **not** still use current ""message number"" way.


but it was 
>Well, we can still use current ""message number"" way.

sorry 👀😢😜
"
600147510,12144,glassez,2020-03-17T15:52:46Z,">also, the display functions are only called for the items in the view

Seems like a good compromise between maintaining own message queue in LogModel and always retrieve messages from Logger is to have a tiny cache in LogModel that will contain recently obtained (and converted to display friendly form) messages."
600777360,12144,jagannatharjun,2020-03-18T17:56:42Z,"@glassez @Chocobo1  the cache really does its job
the time spent in BaseLogModel::data
```
debug
uncached BaseLogModel ->  1.089s
cached BaseLogModel ->  0.178s
cached, insert latest message in the cache in addNewMessage BaseLogModel ->  0.187s

release 
uncached BaseLogModel -> 0.366s
cached BaseLogModel -> 0.067s
cached, insert latest message in the cache in addNewMessage BaseLogModel -> 0.048s
```

script.py
```python
import pyautogui
import time
import win32api
import win32con 

def mouse_scroll_3(value= -100, steps = 10):
    for i in range(steps):
        win32api.mouse_event(win32con.MOUSEEVENTF_WHEEL, 0, 0 , value, 0)
        time.sleep(.01)
    return

pyautogui.click(200, 111)  # rss tab
pyautogui.click(251,151,50, .5) # click update all button
pyautogui.click(229, 111) # exection log
pyautogui.move(229, 133) # goto the view
pyautogui.click() # focus
mouse_scroll_3(-20, 1000) # scoll
```
"
601615940,12144,glassez,2020-03-20T09:54:29Z,Why do you want to reset model via LogListView? Why not call its method directly? Or even connect action signal to model slot?
601617064,12144,jagannatharjun,2020-03-20T09:57:27Z,">Why do you want to reset model via LogListView?

LogListView's contextmenu action sends the request to clear the model, will connect directly through slot."
601618308,12144,jagannatharjun,2020-03-20T10:00:48Z,"> even connect action signal to model slot?

action is controlled by LogListView, and LogListView doesn't know about BaseLogModel, so have to forward the signal to model vie ExecutionLogWidget"
601635531,12144,glassez,2020-03-20T10:44:01Z,">action is controlled by LogListView, and LogListView doesn't know about BaseLogModel

Yes. It's your mistake. As I suggested before you should connect Menu to View from outside of it (in ExecutionLogWidget where all models are accessible).
Please don't spread the logic across many classes."
607643160,12144,jagannatharjun,2020-04-02T06:14:49Z,"done some fresh benchmarking 
I added an extra click after every scroll in above script, that's why differ bit from previous data
```
cache(max_size - 64)                      0.052s
cache(max_size - 128)                     0.048s
cache(max_size - 256)                     0.045s
use QVector and store messages explicitly 0.028s
```

IMHO max size for the cache should be the maximum number of visible rows for the view,"
607945213,12144,glassez,2020-04-02T16:16:51Z,">max size for the cache should be the maximum number of visible rows for the view

I think it should be even a little greater.
But how can you obtain it?
Although the model should know nothing about any particular view."
607946718,12144,jagannatharjun,2020-04-02T16:19:23Z,"> But how can you obtain it?


I was thinking about some static value like 64 or 100"
607948739,12144,glassez,2020-04-02T16:23:02Z,">I was thinking about some static value like 64 or 100

I think it should be enough. Although the main purpose of this cache is to prevent subsequent calls to logger when the same item is queried for different data roles."
609956615,12144,Chocobo1,2020-04-06T18:17:49Z,"> > But how can you obtain it?
> 
> I was thinking about some static value like 64 or 100

How about `128`? Having more than sufficient won't hurt in this case and who knows users will have what kind of crazy setup that can show a lot of lines....
"
610269754,12144,jagannatharjun,2020-04-07T09:06:15Z,"@glassez @Chocobo1 

now I preserve the existing behavior of different font colors of time and message using `QStyledItemDelegate`

![image](https://user-images.githubusercontent.com/34717789/78650710-e9de0000-78dc-11ea-8a8e-78eff0f3ccfe.png)

custom style
![image](https://user-images.githubusercontent.com/34717789/78650811-109c3680-78dd-11ea-94de-d205da748883.png)
"
610287030,12144,glassez,2020-04-07T09:42:45Z,">now I preserve the existing behavior of different font colors of time and message using `QStyledItemDelegate`

Can you test it with some language that uses non-latin characters (and provide screenshots)?"
610296891,12144,jagannatharjun,2020-04-07T10:04:10Z,"does these qualify?
![image](https://user-images.githubusercontent.com/34717789/78656359-e3ec1d00-78e4-11ea-9b67-cc7e961c10da.png)
![image](https://user-images.githubusercontent.com/34717789/78656468-10079e00-78e5-11ea-854e-20ed86b1099c.png)
![image](https://user-images.githubusercontent.com/34717789/78656531-2ca3d600-78e5-11ea-99bd-cabaac851b71.png)

"
610877004,12144,jagannatharjun,2020-04-08T10:21:42Z,"This PR has a  problem, once the max log message will be reached, the cache will become useless with every new message, the one fix I can see is to revert it how sledgehammer was doing in this PR but huh, another thing is I still didn't get the word from glassez if he is satisfied from work in `logger` class which I assume he is not (XD). If you don't see the max log message as error and @glassez is good with core classes, then don't further read and HaHa react on this post (XD)

so I will propose to revert all changes related to core classes, explicitly store messages and paint using `LogItemDelegate`, which will be better when compared to the current method, where we store messages in form of `QLabel` and use rich text formatting, ""New"" way would be better in space, speed, and styling. Then may if any maintainer can go and make changes in Core classes to remove the use of QVector, 

It would be easier to review partially because a lot of code will be used from this PR and no changes in Core Classes.

@glassez @Chocobo1 opinions?

"
610885972,12144,glassez,2020-04-08T10:43:50Z,">This PR has a problem, once the max log message will be reached, the cache will become useless with every new message

What exactly is wrong with cache?
>*(the rest of previous comment)*

I'm sorry, I didn't understand... you always use hints instead of something specific. And your verbosity makes it even more incomprehensible. 

I would prefer to see formalized and structured explanation instead."
610890890,12144,Chocobo1,2020-04-08T10:56:36Z,">so I will propose to revert all changes related to core classes, explicitly store messages and paint using LogItemDelegate, which will be better when compared to the current method, where we store messages in form of QLabel and use rich text formatting

You really need to look into the history a bit... Please really read/search in the issues! There is a huge deal of performance penalty of using ""QLabel and rich text formatting"" when the number of log msg is over 10000.
Basically you need to test at 50000 (or even more at 200000) log messages with no noticeable (or acceptable) UI slowdown when scrolling, adding new messages and clearing all messages."
610902665,12144,jagannatharjun,2020-04-08T11:25:43Z,"> This PR has a problem, once the max log message will be reached, the cache will become useless with every new message,

as `Logger` use a circular buffer and we directly query the message from the buffer using indices, once the limit is reached the first messages in the original queue will become the last and this invalidates the cache which hashes by indices

> I'm sorry, I didn't understand... you always use hints instead of something specific. And your verbosity makes it even more incomprehensible.

>You really need to look into the history a bit. There is a huge deal of performance penalty of using ""QLabel and rich text formatting"" when log msg is over 10000.


sorry, it seems I failed to explain myself.
I would like to convert the existing machinery of the current master brach to use `QStyledItemDelegate(LogItemDelegate of this PR)` instead of rich-text formatting.

My thinking is that I'm not the correct guy to do Core Classes related changes that's why this PR is taking too much time

That's why basically I would like to remove all the changes of Core Classes (Logger) and caching from this PR, For caching to work properly we require more changes to Core Classes which I don't want to do anymore. Now Caching out of the way, I can store messages as I get them from signals, and then do painting using`QStyledItemDelegate`, this would remove usage of QLabel and Rich Text formatting, somewhat decreasing memory usage, improving speed and also support styling.

With that implemented, One can add caching in follow up PRs"
610974230,12144,Chocobo1,2020-04-08T13:54:43Z,">That's why basically I would like to remove all the changes of Core Classes (Logger) and caching from this PR, 

I may not have understand your new plan fully, however I think this PR has made good structural changes and is not far from finished. I hope you don't imply you're going to drop it.
IMO even if this PR doesn't solve the logger widget performance issues, as long as it doesn't perform worse than before, it is still acceptable."
610978656,12144,jagannatharjun,2020-04-08T14:02:41Z,"> I hope you don't imply you're going to drop it.

The problem is how to fix the caching problem, the best way I can think of is to revert back to sledgehammer's original implementation of `Logger` i.e using id rather than indexes @glassez what do you say?

the easiest way I can think is to store messages instead of querying from Logger classes and I am leaning towards the easiest way."
611027971,12144,glassez,2020-04-08T15:32:09Z,"@jagannatharjun, I don't remember recommending you to use internal indexes on the outside of class implementation (i.e. in Logger interface)... or did I do it? Maybe there is some misunderstanding? Can you point me to the place where I did it?"
611041735,12144,glassez,2020-04-08T15:56:31Z,"@jagannatharjun, my general opinion is still [here](https://github.com/qbittorrent/qBittorrent/pull/12144#issuecomment-599991903). Although I still think the model described there is the most correct, it requires storing all messages in the presentation model layer. So the compromise option is to allow you to get a specific message by its timepoint for which we agreed to use sequential numbering (suggested [here](https://github.com/qbittorrent/qBittorrent/pull/12144#issuecomment-600052036)), i.e. ID (although this does not make sense from the Logger subject area perspective)."
611045517,12144,jagannatharjun,2020-04-08T16:03:30Z,"> I don't remember recommending you to use internal indexes on the outside of class implementation

https://github.com/qbittorrent/qBittorrent/pull/12144#discussion_r393895971 you specifically mentioned ""real index"""
611049953,12144,jagannatharjun,2020-04-08T16:11:41Z,"Now at this point, I only want myself to be concerned with the styling side of this PR and don't touch the Core classes. Isn't the current way store all the messages in the presentation layer (in form of QLabel), I would like to follow it but rather provide a model to store the messages in ready to be displayed form something like 
```
    struct Item
    {
        QVariant time;
        QVariant message;
        QVariant foregroundRole;
        QVariant userRole;
    };
```
and display them `LogItemDelegate` of this PR.
That should fix styling and improve performance as well."
611052569,12144,glassez,2020-04-08T16:16:44Z,">#12144 (comment) you specifically mentioned ""real index"", idk could be a language gap or something

Yes, it must have been me...
Apparently I was at a crossroads between my real vision and finding some kind of compromise...
Although I am sure that it is possible to fix the caching logic in this situation, but I am more inclined to think that ""double mapping"" (meantioned in https://github.com/qbittorrent/qBittorrent/pull/12144#discussion_r393895971) is a much smaller evil than having an ""too much out of subject domain"" interface."
611056014,12144,glassez,2020-04-08T16:22:58Z,">Now at this point, I only want myself to be concerned with the styling side of this PR and don't touch the Core classes. Isn't the current way store all the messages in the presentation layer (in form of QLabel), I would like to follow it but rather provide a model to store the messages in ready to be displayed form

This satisfies my [general opinion](https://github.com/qbittorrent/qBittorrent/pull/12144#issuecomment-599991903). It can be improved later if necessary."
611121452,12144,jagannatharjun,2020-04-08T18:34:26Z,"I removed all the changes related to `Logger` class and reimplemented Model classes, please take some time to review @glassez @Chocobo1 "
611350369,12144,Chocobo1,2020-04-09T06:17:28Z,"Would it be a nice idea to move your new proposal to a new PR? Because this thread is long and slow to open in browser, at least for me."
611380388,12144,jagannatharjun,2020-04-09T07:38:32Z,"> Would it be a nice idea to move your new proposal to a new PR? Because this thread is long and slow to open in browser, at least for me.

please see #12458 "
495933064,10702,jagannatharjun,2019-05-25T16:58:39Z,"ok i took the ""stylemanager"" approach, i thought this may help in future"
495986794,10702,Chocobo1,2019-05-26T10:22:53Z,"Why not just let user select the qss file? Having to place qss file under a special directory is unintuitive IMO.
It can be a combo box with a fixed first entry ""System default"" and a second entry ""Select..."" which will pop up a file selector. And this way you probably could scrap the stylemanager class...

BTW, qss works better than I thought!"
495988842,10702,glassez,2019-05-26T10:52:32Z,">BTW, qss works better than I thought!

I have always been surprised by the attempts of some contributors to implement theme support in some custom way, although I initially pointed them to the built-in support..."
495988922,10702,jagannatharjun,2019-05-26T10:53:40Z,"@Chocobo1 
I am planning a follow up for icons,
Idea is to search icons in stylefolder()/{style-name}/*, that's why I choose `stylemanager`
I think it will be more systematic and people can then distribute these files without letting end-user worry about the details

I can try that if you insist but i don't like that way"
495989848,10702,jagannatharjun,2019-05-26T11:04:11Z,"How about changing the style folder to the install directory, this way it will be easier to find
or add `open style folder` button along side the `styleComboBox`"
495990749,10702,glassez,2019-05-26T11:14:36Z,">i am planning a follow up for icons,
idea is to search icons in stylefolder()/{style-name}/*,
I think it will be more systematic and people can then distribute these files without letting end-user the details

We can implement some kind of theme bundles (i.e. set of ""stylename.qss"" and appropriate ""stylename"" folder with resource files, probably zipped in single file)."
495991034,10702,jagannatharjun,2019-05-26T11:17:49Z,"@glassez this can be done in follow up pr for icons,
Bundles can be extracted in stylefolder()"
495992605,10702,Chocobo1,2019-05-26T11:39:52Z,">Idea is to search icons in stylefolder()/{style-name}/*, that's why I choose stylemanager

I really think showing style name/bundle name is redundant, user don't care about what name it is and it is just a file name.

>I think it will be more systematic and people can then distribute these files without letting end-user worry about the details

Maybe stylemanager could still be useful, we'll see then.

>We can implement some kind of theme bundles (i.e. set of ""stylename.qss"" and appropriate ""stylename"" folder with resource files, probably zipped in single file).

I imagine we could let user select a .zip bundle (only .zip as we have zlib already, otherwise too many dependencies...) and qbt will extract it to `<config path>/guibundle` folder. qbt will clear the `guibundle` folder before extracting.
And the UI could show as ""GUI theme:"" and a combo box with options: [""Default"", ""Custom"", ""<seperator>"", ""Select...""]. ""Custom"" will be auto selected after user imports a bundle via ""Select..."".

ADDED: The ""Custom"" entry could also be named after the .zip bundle name, but there should be only one custom bundle at most as to cut down maintenance for novice users.

@jagannatharjun 
If you're up to, some of the ideas here is eligible for this PR, no pressure."
495993287,10702,jagannatharjun,2019-05-26T11:51:16Z,"I want a dark theme in the official repository because let's face it many users are lazy to google search and download files that's why bing is still out there.
I don't know how this can be done using ""custom"". Identifying styles by names will allow user to quickly change styles and test what better matches his style."
495993786,10702,Chocobo1,2019-05-26T11:58:45Z,">I want a dark theme in the official repository because let's face it many users are lazy to google search and download files that's why bing is still out there.

Do you pledge to maintain the dark theme for some time? I won't.
And are you sure a single (dark) theme will satisfy all users ranging from windows to linux and also macOS?

>I don't know how this can be done using ""custom"". Identifying styles by names will allow user to quickly change styles and test what better matches his style.

I'm not sure what you mean by don't know.
When ""Custom"" is selected, qbt will search in `guibundle` folder and will apply the first found qss file and icons (when we are there).
Also the ""Custom"" could be named after the .zip bundle name, as mentioned before."
495994474,10702,jagannatharjun,2019-05-26T12:07:57Z,"May be have it in the official repo but mark it as unofficial just like cmake support,
Having it in official repo will attract more audiences and support

I like the style-name way and having multiple qss to choose from. Do you assert your method? @qbt-users opinions?

"
495995240,10702,Chocobo1,2019-05-26T12:19:55Z,">May be have it in the official repo but mark it as unofficial just like cmake support,

Big difference! cmake will work or is suitable on many platforms while a single theme will not.

>I like the style-name way and having multiple qss to choose from.

Multiple qss entry leads to the needs of removing it, you'll then have to introduce an UI element to delete the entries. Users will request it sooner or later.

>Do you assert your method? 

:) So far, I can only speak for myself (I do not represent this project). And from my limited experiences shared my own opinion about a (feasible) way to realize it, if anyone have better ideas, they are welcome!"
495995472,10702,jagannatharjun,2019-05-26T12:23:48Z,I will do the delete and install button. how about that?
495995699,10702,Chocobo1,2019-05-26T12:26:47Z,">I will do the delete and install button. how about that?

No problem for me.

Also what you are going to do when name collision occurs when importing?
"
495995747,10702,jagannatharjun,2019-05-26T12:27:29Z,"Ok then it doesn't make much sense if you will not have the dark theme in official repo. I can't maintain the theme myself. I am not a designer.

Any designer up for it?"
495996262,10702,jagannatharjun,2019-05-26T12:35:24Z,"Well I am sure some one someday will request to have multiple themes.

and about the collision we can check in `availableStyles()` then abort it or concatenate some suffix and try again "
495997519,10702,glassez,2019-05-26T12:53:25Z,"Hey, guys, stop, otherwise we'll be stuck with it, as has happened with other theme support implementations.
As I mentioned, I am a supporter of the minimum cost implementation of minor features. So I approve of the way ""Select some theme file or reset to the default"" (no need for any installation and other management). And when I mentioned ""theme bundles"", I meant nothing more than the ability to ""Select some theme file or reset to the default"" (again no management, just take the specified file and apply the resources bundled in it).
>Well I am sure some one someday will request to have multiple themes.

Just have multiple theme (bundle) files somewhere in filesystem."
495998587,10702,glassez,2019-05-26T13:06:50Z,">only .zip as we have zlib already, otherwise too many dependencies

AFAIK, zlib isn't about ZIP, it's just about .gz. Of course, it can be used to compress files inside the ZIP archive... But then you have to implement the ZIP parser manually. In addition, it can only extract a subset of .zip files.

Anyway we can just start with .qss only support until it died before it was born."
496004639,10702,jagannatharjun,2019-05-26T14:24:11Z,`styleCombo` has additional text `Select...` which let user select new Qss file
496235786,10702,jagannatharjun,2019-05-27T14:45:23Z,@glassez @chocobo1 review?
496399490,10702,jagannatharjun,2019-05-28T07:31:58Z,@glassez  @Chocobo1 now?
496418769,10702,glassez,2019-05-28T08:31:57Z,">@glassez @Chocobo1 now?

@jagannatharjun, sorry, but as I stated in
https://github.com/qbittorrent/qBittorrent/pull/10702#issuecomment-495997519 I'm against any kind of management of stylesheet files (I.e. install/uninstall etc.) unless it's strongly required."
496420338,10702,jagannatharjun,2019-05-28T08:36:23Z,"No, as per chocobo1 suggested, now I am only copying the ""User selected Style.qss"" to style folder, nothing else, 
 

> I imagine we could let user select a .zip bundle (only .zip as we have zlib already, otherwise too many dependencies...) and qbt will extract it to `<config path>/guibundle` folder. qbt will clear the `guibundle` folder before extracting.
> And the UI could show as ""GUI theme:"" and a combo box with options: [""Default"", ""Custom"", """", ""Select...""]. ""Custom"" will be auto selected after user imports a bundle via ""Select..."".

I see may be you get it by `searchAndInstallStyle`, but that only finds qss and copy it to the stylefolder, so that can be accessed easily in startup 

"
496421039,10702,jagannatharjun,2019-05-28T08:38:16Z,"Do you want me directly access the style from user provided path?

also I can't understand what happened to Travis."
496422539,10702,jagannatharjun,2019-05-28T08:42:30Z,"only one style[""Custom""] or [""System Default""] at a time is allowed, no style is cached"
496425095,10702,glassez,2019-05-28T08:49:28Z,">No, as per chocobo1 suggested, now I am only copying the ""User selected Style.qss"" to style folder, nothing else,

...and then use it unconditionally. So it doesn't reflects any changes in specified file, isn't it?

>Do you want me directly access the style from user provided path?

Yes, exactly."
496439036,10702,jagannatharjun,2019-05-28T09:28:15Z,now?
496463025,10702,glassez,2019-05-28T10:40:08Z,">now?

I would be opting into to consider and define the common design of this feature, and then to consider/review its implementation. I expressed my vision. Let's wait for another opinion (at least let's wait for @Chocobo1 comment). @thalieht, have you to comment on it too?"
496463740,10702,glassez,2019-05-28T10:42:42Z,"Also I thing ComboBox isn't appropriate control for it. IMO, CheckBox (""Use custom style sheet"") + PathEdit could fit it better."
496478068,10702,jagannatharjun,2019-05-28T11:32:11Z,"I am thinking of follow up for icons in other PR.
So here is what I would like to do in this PR - 
I like [chocobo1's idea](https://github.com/qbittorrent/qBittorrent/pull/10702#issuecomment-495992605), so I would like to implement that, cache the user chosen qss, identify the new style as  ""Custom"". I would like to retain the current combobox GUI arrangement as that can be easily extendable for bundle based theming. Bundles(zip) has to be extracted somewhere because there will be some components expecting solid files. PathEdit will be not be much usefull then."
496483747,10702,glassez,2019-05-28T11:50:05Z,">Bundles(zip) has to be extracted somewhere because there will be some components expecting solid files. PathEdit will be not be much usefull then.

Neither the bundles nor the caching contradicts the (lightweight) feature design proposed by me. Both ""bundles"" and ""caching"" can work behind the scenes (moreover caching is required to work behind the scenes). User just specifies the needed file and it works appropriately from user's POV. Of course you can cache/unpack it (transparently for the user) if this is really needed for some reason (it isn't in case of single .qss file)."
496487213,10702,jagannatharjun,2019-05-28T12:01:41Z,"So is it ok with the latest commit? No caching just using the user specified qss and can be extended for bundles in the future(maybe?). I can implement checkbox ""Use custom stylesheet"" but that will be changed in the future so I don't see the point there. "
496493239,10702,glassez,2019-05-28T12:21:43Z,">I can implement checkbox ""Use custom stylesheet"" but that will be changed in the future so I don't see the point there.

What for? If we later replace the stylesheet file with a theme bundle file, the user will continue to deal only with a single file, so it will not make sense to change it, isn't it? Well, except that the text (""Use custom theme"").

Do not rush to produce a new code after each of my or someone else's proposals, at least until some other reviewer agrees with it. Otherwise, you risk unnecessarily creating a bunch of code that will eventually be rejected.
Instead, you could use my advice to learn the qBittorrent Coding Style (and common patterns we use) to speed up further review of your code (when we agree on the feature design and start reviewing its implementation)."
496495261,10702,jagannatharjun,2019-05-28T12:28:10Z,"> What for? If we later replace the stylesheet file with a theme bundle file, the user will continue to deal only with a single file, so it will not make sense to change it, isn't it? Well, except that the text (""Use custom theme"").

The Path in PathEdit doesn't have any meaning, styling will continue to work even after the user has removed the bundle file. That's why I like the three key based ComboBox [""System Default"", ""Custom"", ""Select""]"
496506144,10702,glassez,2019-05-28T13:00:19Z,">The Path in PathEdit doesn't have any meaning, styling will continue to work even after the user has removed the bundle file. 

I think you're thinking backwards... What are you coming from? If it is meant to work in a certain way, it will only work differently if you implement it incorrectly.

Don't try to base on your current code. Let's just come to a decision on how it should work, and then we'll discuss how to implement it correctly."
496508843,10702,jagannatharjun,2019-05-28T13:08:11Z,"my Proposal is simply the original one [proposed](https://github.com/qbittorrent/qBittorrent/pull/10702#issuecomment-495992605) by @Chocobo1 

What do you want in PathEdit?"
496570342,10702,glassez,2019-05-28T15:36:53Z,">What do you want in PathEdit?

I just suggest using something like the following as an alternative to @Chocobo1 proposal:
![pathedit](https://user-images.githubusercontent.com/5063477/58489900-da4a4280-8174-11e9-8f02-157762077731.png)

That's all I wrote. I'm waiting for other people's comments...
"
496748777,10702,thalieht,2019-05-29T01:27:20Z,"I like the concept of choosing from a combobox for the ease-of-use factor but if there are no multiple entries etc. then in that case @glassez's idea makes most sense to me.

P.S. What am i reading guys? ""Select..."" in a combobox? Surely you meant a button near it."
496763982,10702,Chocobo1,2019-05-29T02:56:03Z,">The Path in PathEdit doesn't have any meaning, styling will continue to work even after the user has removed the bundle file. That's why I like the three key based ComboBox [""System Default"", ""Custom"", ""Select""]

Also I think there is the problem of caching the bundle zip/qss. When using a path widget, qbt must unzip the bundle every time on startup to ensure the file is up-to-date. Of course there are tricks to work around it but it is more like a hack. I meant if we are *importing* something, a path widget won't make sense; a path widget is useful when we only *read* something.

Also the combo box might be useful in displaying the bundle name, assuming the bundle is named/versioned properly.
Here is a mockup:
* This is the initial state:
  ![scrn1](https://user-images.githubusercontent.com/9395168/58525647-188c4400-81ff-11e9-869e-62b3d1e5f3f8.png)
* This is after user has selected ""qdark v1.0.qss"":
  ![scrn2](https://user-images.githubusercontent.com/9395168/58525646-188c4400-81ff-11e9-8559-db05313df57f.png)

Note the separator should be replaced by `QComboBox::insertSeparator` in real code.

>P.S. What am i reading guys? ""Select..."" in a combobox? Surely you meant a button near it.

personally I like the ""select..."" in combobox better, better coherency than a separate button that modifies the nearby combobox. A similar one is the search plugin selection combobox which has ""select..."" entry that popup a dialog."
496828215,10702,jagannatharjun,2019-05-29T07:57:30Z,"Ok here is what I want to do in this PR.

Lets' have a ComboBox In Appearance Tab with three entries [Default, Custom, Select], 
Select will get a qss file, copy it somewhere inside our config folder for easy access, deleting the qss from the previous `select` and loads the qss as a stylesheet. We will only handle one qss at a time. 
Custom will be only available if any qss is already present in our cache folder, for easy toggle between Default and Last used Style.

This means reverting my last commit `Don't cache Style`

> personally I like the ""select..."" in combobox better

I too find it weirdly intuitive.
"
497357808,10702,glassez,2019-05-30T14:51:30Z,">Also I think there is the problem of caching the bundle zip/qss. When using a path widget, qbt must unzip the bundle every time on startup to ensure the file is up-to-date. Of course there are tricks to work around it but it is more like a hack.

I don't know what ""terrible"" problem you saw. There is nothing extraordinary here. Keeping cached data up-to-date in one way or another, depending on the specific task, is an integral part of the caching technology itself.
Oh well. Let's not go on about it, since you all prefer to deal with ""installed"" themes. Let's work on its implementation. I will formulate some questions about feature design and general remarks later (hopefully everyone understands in what sense I use the word ""design"" here)."
497717498,10702,glassez,2019-05-31T13:55:13Z,"> ""Select..."" in a combobox

Since qBittorrent will not use the selected file, but only install/import data from it, it should be obvious for the user from the UI. ""Select"" can be misleading. It is better to call this action according to what it does (e.g. install)."
497725730,10702,jagannatharjun,2019-05-31T14:19:47Z,"@glassez are you okay with rest of [this](https://github.com/qbittorrent/qBittorrent/pull/10702#issuecomment-496828215)?

"
497748538,10702,glassez,2019-05-31T15:20:27Z,"@jagannatharjun, I'm sorry, I don't have enough free time to comment on it all at once, so I'll continue in portions. Please be patient."
497939864,10702,glassez,2019-06-01T12:12:51Z,">Select will get a qss file, copy it somewhere inside our config folder for easy access, deleting the qss from the previous select and loads the qss as a stylesheet.

So you intend to immediately apply the selected theme without waiting for the other settings to be applied (when user presses OK or Apply button)? Is it desired behavior? @Chocobo1?"
497940388,10702,jagannatharjun,2019-06-01T12:17:39Z,"Ok now i think about it we should wait for apply button.
But I will like to hear from @Chocobo1."
497941546,10702,glassez,2019-06-01T12:32:59Z,"<b>Coding Style and so on (unmeantioned in Coding Guidelines)</b>

The use of the term Style in all local names is too vague (because it has too broad a concept). You should use Stylesheet (or even, e.g., UITheme, if you really plan to extend this feature).
Your manager class is misdesigned. It shouldn't manages ""all the world"" (i.e. all the things related to this feature more or less). Particularly we prefer to separate UI and internal logic. So you need to redesign manager class to remove any user interaction from it (i.e. showing dialogs etc.).
Please bring the singleton implementation (in manager class) in line with the form we use (see for e.g. BitTorrent::Session class).

Next, I'll look directly at the code, after you fix these basic flaws (mentioned above)."
497950183,10702,Chocobo1,2019-06-01T14:38:54Z,">Ok now i think about it we should wait for apply button.

Yes you should."
497951181,10702,jagannatharjun,2019-06-01T14:53:11Z,It does with the latest commit.
498029749,10702,glassez,2019-06-02T13:09:16Z,">It does with the latest commit.

With the latest commit only ""theme changing"" waits for Apply button. But you still rewrite custom theme without it so user can't undo this action. Is it acceptable behavior? @Chocobo1?"
498034416,10702,jagannatharjun,2019-06-02T14:06:43Z,I agree with you. It should wait for accept button.
498034604,10702,Chocobo1,2019-06-02T14:09:03Z,">With the latest commit only ""theme changing"" waits for Apply button. But you still rewrite custom theme without it so user can't undo this action. 

Personally I think it is fine."
498049390,10702,glassez,2019-06-02T17:19:39Z,">Personally I think it is fine.

Then why wait for pressing the Apply button if you still won't able to cancel this action?

IMO, it should either apply selected theme immediately (although it is inconsistent with the other options applying) or does nothing (just keep selected file path) until Apply (or OK) button is pressed. Otherwise it has undefined behavior."
498729080,10702,jagannatharjun,2019-06-04T15:46:26Z,"I tried to redesign things a bit.
Rather than using `availablestyles`, I am using enum based solution now. I thought this might be more ""clean"" and better separate things. Also now qss is only moved on `accept` button.
@glassez, @Chocobo1, @thalieht?"
499922522,10702,jagannatharjun,2019-06-07T15:09:23Z,I did try to follow the coding guidelines as much as possible.
500186443,10702,jagannatharjun,2019-06-09T05:35:01Z,"![image](https://user-images.githubusercontent.com/34717789/59155405-3f236800-8aa6-11e9-9b4c-cfbe5b02677d.png)
![image](https://user-images.githubusercontent.com/34717789/59155407-4a769380-8aa6-11e9-8dd2-c133c090b574.png)
sorry if I am disturbing or something. @glassez @Chocobo1?
Also may be `User Interface Language` -> `Language`"
502172348,10702,jagannatharjun,2019-06-14T16:21:13Z,"Easiest and cleanest way to implement for icons, is to require restart.
I am thinking to separate UI styling and icons i.e to provide seaperate combo box based style option for ui and icons. Qss can be applied on `accept` and icons change on restart.
@glassez, @Chocobo1?"
502362133,10702,glassez,2019-06-15T12:17:53Z,">Please try to refactor UIThemeManager class into GUITheme namespace first, IMO current class implementation feels unnatural.

I wouldn't be in a hurry to do that. At least until this feature is complete (icon support, etc., that is beyond the scope of this PR).

In addition, I do not feel that the implementation of some feature can be in the form of a set of free functions... Although all can be, but this will be clear only when it will complete, as I already said."
502362837,10702,jagannatharjun,2019-06-15T12:28:04Z,"I did start working on icon support and think I will only require changes inside `Guiiconprovider` and replacing direct access to icons folder to `GuiIconProvider` function calls, so I think it's safe to replace this class with namespace.
Also there is no need to store anything inside `GuiTheme`.

Do you agree with name changes suggested by chocobo1?"
502380222,10702,glassez,2019-06-15T16:25:43Z,"

I would, on the contrary, merge all functionality related with appearance/theming into GUIThemeManager class instead of spreading it across the different code places."
502382675,10702,jagannatharjun,2019-06-15T16:59:11Z,"no, I have added `getIconDir` in `UIThemeManager` and `GuiIconProvider` call this function instead of directly quoting `:icons/` folder "
502382741,10702,glassez,2019-06-15T17:00:00Z,"By the way, I have an idea about the theme bundle file format. No external dependencies, only Qt.
We can use **The Qt Resource System** for this in the form of **External Binary Resources**."
502382789,10702,jagannatharjun,2019-06-15T17:00:44Z,"also, @glassez  do you agree on `namespace` idea of @Chocobo1 ? I have done the changes, should I push?"
502382941,10702,glassez,2019-06-15T17:02:31Z,">also, @glassez do you agree on namespace idea of @Chocobo1 ? I have done the changes, should I push?

https://github.com/qbittorrent/qBittorrent/pull/10702#issuecomment-502362133"
502382976,10702,jagannatharjun,2019-06-15T17:03:02Z,"> y the way, I have an idea about the theme bundle file format. No external dependencies, only Qt.
> We can use **The Qt Resource System** for this in the form of **External Binary Resources**.

How about like here we ask for qss, we can ask for a folder of icons, with the same structure as of qbittorent's icon dir, and for `custom` icon theme load icons from this folder. It's easy XD, user can extract there own zip file(""bundles"") in folder"
502383982,10702,jagannatharjun,2019-06-15T17:17:25Z,"@glassez  do you mean by [this](https://doc.qt.io/qt-5/resources.html#external-binary-resources).
I am very much open to the new ideas and free this summer, will try to implement.
Can you elaborate?"
502388240,10702,Chocobo1,2019-06-15T18:15:36Z,">External Binary Resources.

If I understand correctly, the external resource will need to be in compiled form which will be cumbersome for users/modders. But on the other hand, it would greatly simplify the requried code in qbt. Decisions, decisions..."
502447105,10702,glassez,2019-06-16T12:18:08Z,">Can you elaborate?

Stylesheet file and all other Theme resources can be compiled into RCC file and then loaded with [QResource](https://doc.qt.io/qt-5/qresource.html) so we can access them as regular files. We don't even need to install anything, so we can use the simplified management suggested by me above (the user just sets some theme file from anywhere in the file system).
The downside is that compiling of such theme file is a little more difficult than to pack the ZIP archive."
502448007,10702,glassez,2019-06-16T12:31:01Z,">@glassez do you agree on namespace idea of @Chocobo1 ? 

I gathered my thoughts. I am categorically against having anything that is part of the application workflow (in any of its aspects) in the form of free functions. This is a clear lack of design. Only some utilities can be ""free"". Everything else should have its place and be manageable. "
502448028,10702,jagannatharjun,2019-06-16T12:31:23Z,"Then creators will require qt package for creating themes, for example qt package on windows is well above a gb or two but then also if he knows about qss then qt will be already installed on his pc. 
We can also use https://github.com/madler/zlib/blob/master/contrib/minizip/unzip.h "
502750308,10702,jagannatharjun,2019-06-17T16:13:35Z,"uses rcc files for resources
```
<!DOCTYPE RCC><RCC version=""1.0"">
<qresource>
    <file>stylesheet.qss</file>
</qresource>
</RCC>
```

![image](https://user-images.githubusercontent.com/34717789/59619595-8239a700-9148-11e9-80ac-563ae3e94bd4.png)
![image](https://user-images.githubusercontent.com/34717789/59619771-eb211f00-9148-11e9-98cf-8f9022d7bd74.png)
"
506724749,10702,jagannatharjun,2019-06-28T12:59:20Z,@Chocobo1? @glassez? @thalieht? anyone XD.
508442921,10702,glassez,2019-07-04T11:06:59Z,Are you sure we still need to install something in case of using the QResource driven approach? @Chocobo1?
508447240,10702,Chocobo1,2019-07-04T11:22:30Z,">Are you sure we still need to install something in case of using the QResource driven approach? @Chocobo1?

In this case no."
508448896,10702,jagannatharjun,2019-07-04T11:29:01Z,"> > Are you sure we still need to install something in case of using the QResource driven approach? @Chocobo1?
> 
> In this case no.

```
Default
<Previously Selected Theme Resource File>
...
Select
```

and store the resource file path instead of selection index, empty indicated `Default` theme

hmm?"
508449597,10702,jagannatharjun,2019-07-04T11:31:49Z,or Maybe store custom file path with the selection index (separate values) as to show previously selected resource file in the combo box.
508455157,10702,glassez,2019-07-04T11:53:15Z,">or Maybe store custom file path with the selection index (separate values) as to show previously selected resource file in the combo box.

If you mean to be able to switch between the default theme and the previously selected  custom theme, then Yes."
508536269,10702,jagannatharjun,2019-07-04T16:41:12Z,@glassez @Chocobo1 now?
508930795,10702,glassez,2019-07-06T14:33:14Z,I think it's ready for merging in master. Waiting for @Chocobo1 opinion...
509616304,10702,jagannatharjun,2019-07-09T12:09:39Z,"> 
> 
> What's the point in wrapping the reason part by commas? E.g. `Reason: no such file` is readable enough, isn't it?

@Chocobo1 asked me to put the errors in quotes for other message and the previous message also.
Will remove it if you ask.

"
509646950,10702,Chocobo1,2019-07-09T13:41:01Z,"@jagannatharjun 
Please fix those warnings:
https://ci.appveyor.com/project/qbittorrent/qbittorrent/builds/25848426#L357"
509649336,10702,glassez,2019-07-09T13:47:23Z,">Please fix those warnings

@Chocobo1, I think we shouldn't wait after this is done and commits are squashed. All sorts of unnoticed little things can be fixed later. In addition, it is assumed that this feature will be expanded further."
509651465,10702,Chocobo1,2019-07-09T13:52:47Z,">@Chocobo1, I think we shouldn't wait after this is done and commits are squashed. All sorts of unnoticed little things can be fixed later. In addition, it is assumed that this feature will be expanded further.

What do you mean? This PR is still evolving or do you suggest merging it as-is?"
509655058,10702,glassez,2019-07-09T14:01:31Z,">What do you mean? This PR is still evolving or do you suggest merging it as-is?

I think this PR is done within its scope and the feature can be expanded further without breaking its main interface. So it should be merged now (unless you find some critical flaws at the last moment)."
509664881,10702,Chocobo1,2019-07-09T14:26:21Z,">So it should be merged now (unless you find some critical flaws at the last moment).

IMO the current state is very close to being finished judging by our standards, one last thing is squash the commits into the first one and I can approve."
509667165,10702,glassez,2019-07-09T14:31:56Z,"@jagannatharjun, can you create appropriate wiki page with some info about theme format and creation instructions? You can attach your theme as an example there."
509727085,10702,jagannatharjun,2019-07-09T17:09:01Z,"for icons, I would replace all direct references of `:icons` with helper function from `iconprovider` classes, for example, there are lots of direct references of icons in `skin` directory, would like to replace this with `guiiconprovider::getSkinIconPath`. This with `getIconPath` will internally call `UIThemeManager::getIconDir` for icons dir. `UIThemeManager::getIconDir` will return `:icons\` or `:uitheme\icons` based upon settings.  "
509731945,10702,glassez,2019-07-09T17:23:46Z,"IMO, current icons layout not so good to support theming in a convenient way. So I would make changes on both sides - how the icons are handled by the app and how the theme will provide them.
I have some suggestions (maybe not much thought). I want you to open up the relevant Issue where we can discuss the main aspects of the required changes before you start coding it. I really do not want this feature to be implemented in a lazy manner as some kind of patch to the existing code. It should have a well defined design."
509735468,10702,jagannatharjun,2019-07-09T17:33:55Z,@glassez #10903 
510023970,10702,Chocobo1,2019-07-10T11:33:10Z,"@jagannatharjun 
Thanks for fulfilling many people's wish."
510125345,10702,jagannatharjun,2019-07-10T16:05:02Z,"It was my first big PR to any repo, so thanks to you guys for bearing with me for 2 months XD"
510127558,10702,glassez,2019-07-10T16:10:42Z,"@jagannatharjun, thank you for bringing this matter to an end, despite all the difficulties :+1:
Many people throw their ideas unfinished when they realize that there are rules and requirements and we do not allow the wrong/unsuitable code, even if the idea is good in itself."
513694115,10702,Piccirello,2019-07-22T08:28:38Z,"This feature will be used by so many more people if we bundle a dark mode theme in qBittorrent. #6434 has 293 👍 , [the most](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+sort%3Areactions-%2B1-desc) of any issue (and 4x the number of the next highest issue).

@jagannatharjun if you're willing to maintain the dark theme, I think we should bundle it with qBittorrent."
513700144,10702,glassez,2019-07-22T08:45:36Z,">bundle a dark mode theme in qBittorrent. 

Personally, I would not consider this possibility until the entire ""Theme support"" feature is fully implemented and tested. ""Dark mode"" theme can't be complete (to release it officially) without having the appropriate icons to match it in color.
But until then, we can provide the appropriate resources in another way (e.g. Wiki page, pinned GitHub Issue etc.)."
513705218,10702,Piccirello,2019-07-22T09:00:04Z,"Completely agree regarding waiting for matching icons. We can use the wiki in the mean time. Once #10903 is resolved, we should bundle the dark theme with the app (assuming someone can support it)."
513707372,10702,Chocobo1,2019-07-22T09:05:55Z,">Once #10903 is resolved, we should bundle the dark theme with the app (assuming someone can support it).

I would say ""support"" as in long-term support otherwise I think it would be wise to have contributors maintaining their own repo/forks."
514502043,10702,Piccirello,2019-07-24T06:41:51Z,I think their stance is the only correct one- bundle a dark mode only if we’re able to support it long term. It would be a disservice to our users to provide a tool that breaks in future versions. 
536380024,10702,Stanzilla,2019-09-30T02:52:53Z,"Where would I put style.qss files so the client sees them? 

I tried `%APPDATA%\qBittorrent` and `%APPDATA%\qBittorrent\styles\` and `%APPDATA%\qBittorrent\styles\test\`"
538626029,10702,jagannatharjun,2019-10-05T07:33:52Z,"@Stanzilla the method is changed in the course of PR (first post updated accordingly), I will try to write documents after #10948 or if 4.2 is released before that.

Meanwhile, you can use any style file(*.qbtheme) from [here](https://github.com/jagannatharjun/qbt-theme) with 4.2 alphas.
"
194786910,4936,sledgehammer999,2016-03-10T10:45:52Z,"> You should probably close [#4867] and use this one instead.

No! Don't do that.
You'll just rebase this after merge the other PR.
"
194802124,4936,zeule,2016-03-10T11:35:49Z,"@LordNyriox , thank you! I always forget to replace those Q_DECL_OVERRIDE inserted by Qt Creator...
"
195753409,4936,Danny3,2016-03-12T14:59:18Z,"@evsh 
Since you're working on this...
Could you maybe add the the actual progress bar that exists in μTorrent but it's missing here?
It's 4 pixels tall surrounded by a 1 pixel pixel grey border as far as I can tell.
![progress_bar_cropped](https://cloud.githubusercontent.com/assets/1429543/13723479/0d9c2db0-e867-11e5-9ae2-e365516a6e88.png)
This exist in the older version of μTorrent (1.8.5) that I'm using.
This matches the percentage and can be seen how it's moving when downloading a torrent fast or when the torrent is rechecked.

It's a little unexpected for me that the progress bar doesn't really show the progress of downloading torrent, but the downloaded parts of it and the real progress bar is just the small one shown int the Done column.
"
195761744,4936,zeule,2016-03-12T15:33:26Z,"@Danny3 to me this ""progress line"" looks like a separate widget. Why does the progress percentage not satisfy you? Do you want just a graphical representation or there is something more in this progress bar? 
"
196337357,4936,Danny3,2016-03-14T14:35:17Z,"@evsh

I found the ""progress line"" to be useful in 2 cases:
**1**. A little trick that I found myself:
When I'm taking a break, like going o eat or something, I just leave the pointer of my mouse at the end of it.
When I get back, I look how much the end of line has moved from where my mouse pointer is.
If it didn't move, it's clear to me that it didn't download anything more.
I don't think I'll remember the percentange, especially if it's a floating point number and this method seems faster than writing the number in a text file for later comparison.
**2**. Good to detect slowdowns on hard drives.
If i remember right, I think that once I detected that the antivirus was running an automated scan because I was looking at the progress line after doing a force rechek on a torrent and it seemed to me that the line was moving too slow compared to other times.
I think that I wouldn't have noticed anything looking at the percentage number.
Maybe it's my brain that likes graphs more than numbers...
And it's easier for it to see a grahical overview than the exact number.

I thought that  qBittorrent tried to offer a simmilar UI to μTorrent keeping as much as possible of the good features in μTorrent.
This seems to me like a good feature which takes little vertical space.
If you can't add it, don't wory, it's ok.
Thanks for asking why do I need it for.
BTW, about this PR, showing the files in the tooltip looks like a nice feature.
"
196347093,4936,zeule,2016-03-14T14:49:36Z,"@Danny3, thank you for the explanations! Thinking about this progress bar, may I ask just one more question? Why don't you use the ETA column in the torrent list? Is it because the column relies on instantaneous speed? What do you think about a small addition to this progress line: to show completed in blue and active (donwloading) in green if the width of this addition is big enough (> 1px?)? 
"
196406956,4936,Chocobo1,2016-03-14T16:49:49Z,"Just tried it out, it's cool!

Here's some bugs I observed:
- I start qbt with empty jobs, the bars looks like it's floating, but it should be flat as before, see pics below:
  Before:
  ![before_hover](https://cloud.githubusercontent.com/assets/9395168/13751642/144591e8-ea46-11e5-9407-bf0ffc275a19.png)
  After I hover mouse over Progress bar, it becomes normal:
  ![after_hover](https://cloud.githubusercontent.com/assets/9395168/13751643/1445e4c2-ea46-11e5-9d8e-fae13372aff0.png)
  This floating bug is also observed when I have only 1 jobs and then I remove it, then the bar starts floating.
- About the tooltips text, maybe it's better to switch the legends and pieces info and use the string ""This piece contains:"" as title.

```
White: .....
(and other legends)

This piece contains:
```
- in tooltips, use only filename, leave out it's path.

What do you think?
"
196412147,4936,zeule,2016-03-14T17:01:30Z,"@Chocobo1,thank you for the comments! I will definitely investigate the first problem, because the strange thing is I changed the bar drawing code to avoid the same ""hovered"" impression on my system. Perhaps this is just because of the difference between light and dark backgrounds. 
I think that the path in the tooltip is useful. Think about a torrent with series of something. Than each subdirectory may contain files with names like 001, 002, 003, .. Without path information they all will be indistinguishable.
"
196417251,4936,zeule,2016-03-14T17:13:28Z,"I implemented this feature for the following situation. Suppose I want to download a book. I launch a search and (see PR #3989) obtain a number of book collections where this particular book is present. Then I start to download a torrent and find that it is incomplete with current peers. But do they have the book I need? Now I can overview the torrent and check. If no, I can try another one.
And here is the question: perhaps I should instead add an ""Availability"" column to the ""Contents"" tab? This column might show instantaneous availability for the torrent files.
"
196418345,4936,Chocobo1,2016-03-14T17:15:37Z,"> Without path information they all will be indistinguishable.

yeah, then it's better to have path included.
But I just felt too much text crammed together (not sure how to describe it precisely).

Another idea, is it better to move file size to the start of a line? that way I can quickly know what file (the piece contains) by simply looking from the end (of a string).
"
196418357,4936,Danny3,2016-03-14T17:15:38Z,"@evsh 
Most of the times the ETA column shows ∞ (Infinity symbol)
The tracker could be down or the only one seeder could be offline at that moment.
IMO, not showing anything it would be the same, either way, it doesn't help me at all.
When it works it's just a smart guess based on the current speed.
Unfortunately it has a major problem that's impossible to fix.
It assumes that the speed will remain constant, (tracker will stay online and peers will remain online and upload at the same speed).
Anyway, it gives you an idea by predicting the **future**, it's good enough, it's nice.
I will rephrase my example with taking a break from the computer:
Let's say I add a tutorial torrent in the evening.
ETA or no ETA, this will take a while and I put my mouse pointer to the end of the progress line and go to bed.
When I wake up and come to computer I take a look how much progress the torrent made over the night from where I left the mouse.
I don't care about the time, because I know it, it's from when I went to bed until now when I'm looking.
So I don't care that much about the future that ETA shows, but the progress in the **past**, that has already happened and it's accurate.
I think the progress it's useful for multiple days ETA torrents too, if you want to quickly see how much progress the torrent made each night. leaving the mouse there, for curiosity.

Normally I like simple straight progress bar (one color), but your idea seems interesting and good for showing more detailed information without requiring extra space and I will like to give it a try.
I assume making both versions with a settings toggle would be too much work.
BTW, are you sure that having the second color ""green"" wouldn't be a problem for color blind people like the ones that have Deuteranopia (problem seeing green)?
http://www.color-blindness.com/deuteranopia-red-green-color-blindness/
Maybe they will see only the first part (blue) and not the the second (green), so they will see half a line...
"
196423450,4936,Chocobo1,2016-03-14T17:27:47Z,"@evsh 
One last thing for this round :p
were you using tabs for indentation? IMO it took too much (precious) spaces, maybe just 2~3 spaces is enough?
"
196425621,4936,zeule,2016-03-14T17:33:16Z,"No, this is the default indentation from HTML `<ul>` tag.
"
199084955,4936,zeule,2016-03-21T01:59:25Z,"Can I mark somehow the PR as not yet ready for merge? There is a bug in it: if I select a torrent with downloaded metadata and after that a torrent without it, the progress bar shows the progress of the former one after mouse moved out of it.
"
199126666,4936,Chocobo1,2016-03-21T05:04:30Z,"> Can I mark somehow the PR as not yet ready for merge? 

just add something like `[don't merge]` in the title or in the first post
"
199325911,4936,zeule,2016-03-21T14:57:42Z,"Thank you all for the suggestion! I've worked around the bug by cleaning piece information in `clear()`. Perhaps it is better to do that anyway.
"
199337510,4936,zeule,2016-03-21T15:24:02Z,"Fixed drawing error, now with light theme it should be correct. Tried to remove indentation from the list, but without success (can someone help me, please? How to change indentation in `<ul>` element rendered in tooltip?). Tried to typeset the files information in a table. The code is there, under TYPESET_FILELIST_AS_TABLE define. However, I got strange alignment with hieroglyphs in file names: file names were shifted downwards for approx 0.1-0.2 ex. Maybe somebody can tell what's wrong there? Moved file size information to the beginning of the list items.
"
199756811,4936,ngosang,2016-03-22T11:02:47Z,"I'd prefer the Legend at the top of the tooltip. Also remove some spaces. 
Example:

```
White: ...
Green: ...
Blue: ...
Files in these pieces:
- Image....
```
"
199774705,4936,zeule,2016-03-22T11:40:51Z,"I decided to put the legend at the bottom because otherwise the tooltip text looks like a filled with water balloon, pinned by mouse pointer, which is not aesthetic. Could you, maybe, suggest how to avoid that look? Which spaces do you want to remove?
"
199890475,4936,ngosang,2016-03-22T16:27:32Z,"> Could you, maybe, suggest how to avoid that look? 

No, but most relevant/important info should be first. For users it is more important to understand the graphic.

> Which spaces do you want to remove?

Before:

```
Files in these pieces:

   *  Image....

White: ...
Green: ...
Blue: ...
```

After:

```
White: ...
Green: ...
Blue: ...
Files in these pieces:
- Image....
```
"
200021978,4936,zeule,2016-03-22T20:57:02Z,"@ngosang, @Chocobo1  What do you think about the following: we can show the ""simple"" tooltip (only legend), but if one of the modifier keys is pressed, we show another tooltip which contains _only_ the file list.  Additionally, we can hide file size with another modifier (or this is too much?)
So, the simple tooltip contains the following:
White: ...
Green: ...
Blue: ...
Hold Shift for detailed information

And the detailed tooltip does not contain the legend at all. This saves us from ugly text pyramid and from annoying spaces, but leaves the tooltips clear and readable.  
"
200233904,4936,Chocobo1,2016-03-23T07:52:30Z,"@evsh 
Good idea!

> we can show the ""simple"" tooltip (only legend), but if one of the modifier keys is pressed, we show another tooltip which contains only the file list. 

agree.

> we can hide file size with another modifier (or this is too much?)

too cumbersome.

better add parentheses: `(Hold Shift for detailed information)`
"
200397944,4936,zeule,2016-03-23T15:35:38Z,"Implemented the tooltips split. Activated table rendering by default for the detailed tooltip, because I think that vertically aligned cells look good. I did not add the suggested parentheses because, as to me, now the simple tooltip is clean and nice.
"
202614150,4936,zeule,2016-03-28T22:48:16Z,"Detailed tooltip caption is left-aligned now
"
216654688,4936,zeule,2016-05-03T20:28:08Z,"I think this is ready for merging.
"
217631149,4936,ngosang,2016-05-07T11:49:59Z,"Sometimes I see the size in two lines but I think it should be always in one line. Maybe using a non-breaking space...
![](http://storage5.static.itmages.com/i/16/0507/h_1462621722_3737736_a648343370.png)
"
219194128,4936,zeule,2016-05-14T01:50:33Z,"@ngosang: I've added 'white-space:nowrap' to the style of the size table cell. Seems to be working here. Could you test, please? But I agree with you that there has to be the thin unbreakable space between the number and the unit.
"
219579212,4936,sledgehammer999,2016-05-16T23:33:44Z,"I think I am done with the code review. I didn't check it architecturally-wise much. I don't see something obvious.
I see that @glassez hasn't commented. Can you take a look too?

PS: The use of `{}` instead of `()` for initializing stuff becomes annoying to read and IMO breaks the style the rest of the repo uses.
"
219579791,4936,zeule,2016-05-16T23:37:31Z,"@glassez  did that already.
"
219580713,4936,sledgehammer999,2016-05-16T23:43:17Z,"> @glassez did that already.

Are you sure? I don't see him in the ""participants"" list at the right-panel of this page.
"
219581477,4936,zeule,2016-05-16T23:48:01Z,"> Are you sure? 

He did that in #4994, which includes these changes.
"
219582626,4936,sledgehammer999,2016-05-16T23:55:23Z,"Some design decision which I think is intentional but I am asking generally in case others agree. (I am not pushing this change unless other people agree): The file size in the tooltip is printed in the middle of each filename. Wouldn't it be better to print it at the top?
"
219584203,4936,zeule,2016-05-17T00:05:12Z,"On my system and with my files the file names usually occupy two lines. Aligned to the middle size labels allow me to match them easily.
"
219584806,4936,sledgehammer999,2016-05-17T00:09:12Z,"Can you run uncrustify on your first commit? I noticed if/elses that don't need braces and some that have their braces in the wrong line.
PS: If it gives too much trouble with the 2nd commit, then I guess you should do it for the downloadedpiecesbar.h/cpp files and merge the changes into the 2nd commit.
"
219619794,4936,glassez,2016-05-17T05:01:18Z,"> He did that in #4994, which includes these changes.

I'm not sure I did it in detail. So I'll see it here .
"
219702831,4936,zeule,2016-05-17T12:29:21Z,"@sledgehammer999, I believe all your comments have been addressed. Give me a note, please, when to remove `#define TYPESET_FILELIST_AS_TABLE`.
"
219853483,4936,sledgehammer999,2016-05-17T21:04:26Z,"Those were my final comments I think. I tested the code it looks good. So now I am waiting for @glassez 
"
220045337,4936,glassez,2016-05-18T14:33:45Z,"@evsh `Follow project coding style. Issue #2192.` means ""Fix indentation"" only again?
"
220045702,4936,zeule,2016-05-18T14:34:52Z,"means ""run uncrustify""
"
220063147,4936,glassez,2016-05-18T15:27:04Z,"> means ""run uncrustify""

Then rename commit accordingly, please.
"
220066961,4936,glassez,2016-05-18T15:39:01Z,"@evsh I've finished commenting. Please don't force push here some time after you answered to my comments to not complicate our dialogue (so I don't have to look outdated diffs every time).
"
220067687,4936,glassez,2016-05-18T15:41:17Z,"@evsh it would be better if you will first add a separate commit with fixes, and then (after I review it) meld it into previous.
"
220076964,4936,zeule,2016-05-18T16:09:53Z,"> @evsh it would be better if you will first add a separate commit with fixes, and then (after I review it) meld it into previous.

OK, take a look, please.
"
220090131,4936,glassez,2016-05-18T16:54:32Z,"@evsh, @sledgehammer999 I've finished reviewing. I have not delved into the rendering code, I hope it works correctly. 
"
220563785,4936,zeule,2016-05-20T09:50:23Z,"@qbittorrent/qbittorrent-frequent-contributors this PR adds `QPair<int, int> TorrentInfo::piecesForFile(int fileIndex) const` which returns indices of first and last pieces that contain a given file. At the same time, there is `QPair<int, int> TorrentHandle::fileExtremityPieces(int index) const` function with the same purpose. My bad I had not found the latter. However, implementations are different. I believe that `TorrentInfo::piecesForFile` is better, of course. For instance, `TorrentHandle::fileExtremityPieces` incorrectly behaves in corner cases (take files_offset =  n \* piece_size - 1 and file_size = n \* piece_size). 

So, what should we do? Could someone, please confirm or reject my conclusion (the function in  `TorrentInfo` does not have corner cases, the one in `TorrentHandle` does). And we shall remove one of them. I believe this function belongs to `TorrentInfo` class since it needs only the torrent metadata to work.
"
220574195,4936,glassez,2016-05-20T10:42:17Z,"> I believe this function belongs to TorrentInfo class since it needs only the torrent metadata to work.

Ok.

> I believe that  TorrentInfo::piecesForFile  is better, of course. 

At least it has incorrect name.
"
220574462,4936,zeule,2016-05-20T10:43:46Z,"> At least it has incorrect name.

Then suggest the correct one, please.
"
220575973,4936,glassez,2016-05-20T10:52:21Z,"> Then suggest the correct one, please.

Why not to use the old one? I mean fileExtremityPieces.
"
220577209,4936,glassez,2016-05-20T10:59:25Z,"@evsh your method is better (if it's correct of course) since it doesn't use floating point arithmetic.
"
220577560,4936,zeule,2016-05-20T11:01:35Z,"> Why not to use the old one? I mean fileExtremityPieces.

Simple and nice :)

> @evsh your method is better (**if it's correct of course**)

That's the question :) I feel like I want to add unit tests to qBt.
"
220578789,4936,glassez,2016-05-20T11:08:59Z,"> That's the question :) I feel like I want to add unit tests to qBt.

I think it would be easy to prove it in this case. Enough to do it for the boundary cases.
"
220580130,4936,zeule,2016-05-20T11:16:52Z,"I would like to get a confirmation from at least one more person.
"
220581065,4936,glassez,2016-05-20T11:22:40Z,"Ok.
`firstOffset / pieceLength` is correct for each correct firstOffset.
But...
`(firstOffset + fileSize) / pieceLength` isn't correct since `(firstOffset + fileSize)` is the next file offset and we should check the last file byte offset instead: `(firstOffset + fileSize - 1)`.
"
220582441,4936,zeule,2016-05-20T11:30:52Z,"Bingo! Thank you!

Another question: wouldn't client code become simpler if we return not [first,last] pair, but [first,one after the last) range? Additionally, that will be consistent with STL interfaces and the second number will be equal to the number of pieces, into which the file extends.
"
220589450,4936,glassez,2016-05-20T12:11:38Z,"> Another question: wouldn't client code become simpler if we return not [first,last] pair, but [first,one after the last) range? 

What good to us getting ""one after the last"" piece number?

> Additionally, that will be consistent with STL interfaces and the second number will be equal to the number of pieces, into which the file extends.

""number of pieces, into which the file extends"" is not the same as ""one after the last file piece""
"
220594844,4936,zeule,2016-05-20T12:39:57Z,"Because this is what we are used to get from arrays and sequences: index of the first element and size (index of the element after the last one).

> ""number of pieces, into which the file extends"" is not the same as ""one after the last file piece""

plus the start index, of course.
"
220616227,4936,glassez,2016-05-20T14:11:17Z,"So what value are you going to return? If ""number of pieces, into which the file extends"" then it requires some more complex algorithm. If ""one after the last"" then why don't you just cut this method to `fileFirstPieceIndex()` and to call it twice: fileFirstPieceIndex(i) and fileFirstPieceIndex(i + 1)?

Besides, I am confused by what term can be called a pair of different entities (firstPieceIndex, numberOfPieces) or even pair of first and last+1 indexes?

> that will be consistent with STL interfaces

IMO, we should not aspire to be like STL for no additional reason. I don't think client code become simpler.
"
220623576,4936,zeule,2016-05-20T14:37:54Z,"This entity usually called a range. Why is it good? Because having 

``` C++
auto range = info.fileRange(fileIndex)
```

one can write enumerations as he is used to:

``` C++
for (auto index = range.first; index != range.second; ++index)
for (auto index = range.first; index < range.second; ++index)
```

or use STL algorithms with a range.
"
220638787,4936,glassez,2016-05-20T15:32:26Z,"> one can write enumerations

The other can write differently (assuming filePiecesRange returns first and last index):

``` c++
auto range = info.filePiecesRange(fileIndex);
for (auto index = range.first; index <= range.second; ++index)
```

Why not?
Besides, we don't have to alter existing code.
"
220671731,4936,glassez,2016-05-20T17:42:10Z,"> This entity usually called a range.

I am confused by the fact that your range includes out-of-range value too.
You probably want to show the analogy with the iterators. But it is somewhat different.
"
220673312,4936,zeule,2016-05-20T17:48:28Z," http://www.cs.utexas.edu/~EWD/transcriptions/EWD08xx/EWD831.html
"
220676227,4936,zeule,2016-05-20T17:59:58Z,"BTW, with this agreement the code in the function which determines a range is simpler too:  there is no need to subtract 1 from the file size.
"
220681314,4936,glassez,2016-05-20T18:20:38Z,"> there is no need to subtract 1 from the file size.

This will work incorrectly in some cases for last file.
UPD: not only for last file but for each file which last byte isn't last byte of piece.
"
220700487,4936,zeule,2016-05-20T19:42:17Z,"~~We do integer division thus I think everything would be OK for all mentioned cases.~~ Understood what did you say.
"
220760858,4936,glassez,2016-05-21T06:01:28Z,"> Understood what did you say.

Now you have a simple and reliable algorithm of search the first and last piece. No need to complicate it. Everything else can be done on its basis.
"
221041415,4936,zeule,2016-05-23T17:39:39Z,"PR updated: 
1. Instead of `QPair<int, int>` use class `IndexRange<int>`  (added) which allows removing ambiguity of the `QPair` `first` and `second` meanings. Also, explicit return type allowed to simplify the function name which is just `TorrentInfo::filePieces()` now.
2. Added commit which replaces `TorrentHandle::fileExtremityPieces()` with `TorrentInfo::filePieces()` because we do not need the handle for acessing torrent layout.
"
221831707,4936,zeule,2016-05-26T10:11:03Z,"I don't want to change anything more with this PR, unless there will be any suggestions (or errors). @sledgehammer999, consider this for merging, please.
"
221872862,4936,zeule,2016-05-26T13:37:50Z,"> I don't want to change anything more with this PR

Broke the promise and uncrustified  `src/gui/properties/propertieswidget.cpp` in the first commit too. This is just to simplify merging in my fork.
"
222334220,4936,sledgehammer999,2016-05-28T23:22:33Z,"> I don't want to change anything more with this PR, unless there will be any suggestions (or errors). @sledgehammer999, consider this for merging, please.

I am going to review this tomorrow.
"
222566351,4936,sledgehammer999,2016-05-30T23:42:59Z,"Would it be easy for you to undo almost all your curly braces usage? eg on initializer lists and when declaring a variable? It breaks the style the rest of the project uses (and it annoys me reading it).

As for the PR: My only gripe so far is the calculation I commented on. I could be wrong. I am waiting your input.
"
222648773,4936,zeule,2016-05-31T10:18:10Z,"PR updated: approximation is mentioned in a source comment, integer overflow error was corrected. 
"
223154205,4936,sledgehammer999,2016-06-01T23:24:19Z,"I think the code is ok for merging. I did a test run and I noticed something different from a previous version I had tested. I don't know if this is intentional or not. When hovering over the progress/availability bars I don't see the relevant piece being highlighted! Or was it the file you were highlighting? In any case nothing gets highlighted now.
"
223159366,4936,zeule,2016-06-01T23:55:36Z,"> When hovering over the progress/availability bars I don't see the relevant piece being highlighted!

This is a bug, which I can't reproduce. Could you look what happens inside of `PiecesBar::highlightFile(int imagePos)`? In particular, what are the values of `pieceIndex`, `filePieces`, and `imageRange`?
"
223161004,4936,zeule,2016-06-02T00:05:19Z,"@sledgehammer999 there was a bug on one of the previous iterations: integer overflow which broke highlighting if position was far than 2GB from the beginning of a torrent. Do you observe something similar?
"
223163008,4936,zeule,2016-06-02T00:18:43Z,"and in that case `imageRange` contains negative values.
"
223170918,4936,sledgehammer999,2016-06-02T01:17:52Z,"The issue is that inside `PieceIndexToImagePos::imagePos()` the torrentInfo is invalid so pieceLength is -1. I cannot understand why it is invalid. You are initializing it in the constructor.

On another note:
**2 negative side-effects of curly brace initializations**
1. When using them in the initialization list of a constructor QtCreator gets confused about the rest of the class. For example take class `PieceIndexToImagePos` and go inside imagePos(). Hit enter after `const qlonglong pieceLength = m_torrentInfo.pieceLength();`. The newline gets indented too far to the right.
2. In `QRect newHighlitedRegion {imageRange.first(), 0, imageRange.size(), m_image.height()};` hover over newHighlitedRegion. The tooltip doesn't show the constructor signature.
"
223171932,4936,sledgehammer999,2016-06-02T01:25:30Z,"There's something very wrong here.
If I put in `PiecesBar::highlightFile()` this:

``` c++
PieceIndexToImagePos transform {m_torrent->info(), m_image};
qCritical() << m_torrent->info().isValid();
```

it works!!!

Vanilla code(without qCritical()) doesn't work.
"
223227626,4936,zeule,2016-06-02T08:26:44Z,"OMG, I thought that `TorrentHandle::info()` returns `const TorrentInfo&`...  
"
223228920,4936,zeule,2016-06-02T08:32:44Z,"> > There's something very wrong here.
> 
> OMG, I thought that TorrentHandle::info() returns const TorrentInfo&...

Fixed.
"
223231593,4936,zeule,2016-06-02T08:45:08Z,"BTW, GCC with -Wextra should warn about this error. Unfortunately, we do not pass neither -Wextra nor other warning options to it.
"
223240325,4936,glassez,2016-06-02T09:24:08Z,"> OMG, I thought that TorrentHandle::info() returns const TorrentInfo&... 

@evsh So what was the problem? I was lost in recent code changes...
"
223241299,4936,zeule,2016-06-02T09:28:23Z,"@glassez `PieceIndexToImagePos` was keeping const reference to a temporary `TorrentInfo` object, obtained via `TorrentHandle::info()`
"
223256941,4936,sledgehammer999,2016-06-02T10:42:34Z,"I'll be able to check in a couple of hours. In the meantime, please take a look at my  inline comment in `constexpr IndexType last() const`.

PS: Aren't you able to define extra CXXFLAGS before compiling?
"
223288574,4936,zeule,2016-06-02T13:18:42Z,"> PS: Aren't you able to define extra CXXFLAGS before compiling?

If I modify cmake files, each git command will ask me to commit or stash those changes.
"
223316927,4936,sledgehammer999,2016-06-02T14:54:08Z,"Thanks for this.

> If I modify cmake files, each git command will ask me to commit or stash those changes.

Not true. It asks about that edited file only when you are rebasing or pulling a branch that modifies that same file. But this is solved easily. You do your necessary changes and stash them. Each time you clean your working dir you just need ""git stash apply"" to reapply them. The ""apply"" verb keeps the stash and doesn't delete it. 
This may not work so well if you want to keep multiple stashes. You'll need to remember the index too then.
"
223371897,4936,zeule,2016-06-02T18:00:28Z,"Thank you for merging, and I very much thankful to all those who took part in the discussion!

@sledgehammer999, I hope that you ran it one more time and that highlighting work. Does it? 

>  It asks about that edited file only when you are rebasing or pulling a branch that modifies that same file.

And rebasing appears to be the most frequent operation :( Especially to amend a HEAD^n commit. 
"
223378717,4936,Chocobo1,2016-06-02T18:23:55Z,"Was just playing this, found a minor issue:
![pic](https://cloud.githubusercontent.com/assets/9395168/15756031/01fb9cd2-2932-11e6-8024-566d29be52e3.png)
This happens when I point to the very start (and end) of the progress bar.
"
223379286,4936,zeule,2016-06-02T18:25:45Z,"@Chocobo1: I can't understand what is in your image. What is the dark rectangle? What is supposed to be there?
"
223379835,4936,Chocobo1,2016-06-02T18:27:44Z,"Forgot to say, the box is supposed to show detailed information (holding down shift).
I was holding down shift and moving mouse around.
"
223380281,4936,zeule,2016-06-02T18:29:13Z,"So the detailed tooltips for the very first piece and the very last ones are empty. Is it correct?
"
223381042,4936,Chocobo1,2016-06-02T18:32:04Z,"Not sure, it only happens on/near the border of the box.
"
223387908,4936,zeule,2016-06-02T18:55:53Z,"Fixed in #5339 
"
1003724138,15915,glassez,2022-01-02T14:26:43Z,"It is still not fully completed. I posted it in advance to discuss some things before I can continue:

1.<del> Initially, the first thing that came to my mind as a class name was `Utils::Fs::Path`. But now it looks like a very bad idea. Path handling is a pretty big (fundamental) part of the qBittorrent logic, so I would put `Path` class in the global namespace.</del>
2.<del> Since the `Path` normalizes the string representation of the path, I made its constructor explicit. I think it's better to leave it like that.</del>
3. <del>`Path` has two methods for getting a string representation (`toString()` and `toNative()`). But they are different. Using `toString()` is cheaper, because it does not perform any transformations, but simply returns an internal string. Maybe we should indicate this in the interface? For example, call it just `string()` or `str()`? And maybe add an `operator QString() const`?</del>
4. <del>Currently `Path` has only component based concatenation `operator/()` so if you want to add extension you should do `Path(path.toString() + "".ext"")`. I think I should add `operator+()` that will add something to the path without inserting separator.</del>
5. Despite the par.2 it can be useful to provide operator/(String) to simplify code: `path = Path(pathStr) / ""subpath"";` vs `path = Path(pathStr) / Path(""subpath"");`
6. <del>It can be useful to provide constructor/operators for `const char []` to avoid use `QLatin1String` with hardcoded paths.</del>

@Chocobo1"
1005385874,15915,Chocobo1,2022-01-05T05:06:33Z,"I don't have time to look into closely. As for the discussion points, I agree with all except 2, 3 which I cannot comment since I haven't looked into the code. I'll come back later when I have more time.."
1007126143,15915,Chocobo1,2022-01-07T04:10:38Z,"I agree with point 2.

As for point 3:
>Using toString() is cheaper, because it does not perform any transformations, but simply returns an internal string. Maybe we should indicate this in the interface? For example, call it just string() or str()? 

I'll leave it as is (`toString()`).

>And maybe add an operator QString() const?

👍 

"
1010751159,15915,Chocobo1,2022-01-12T08:06:22Z,also one new warning: https://ci.appveyor.com/project/qbittorrent/qbittorrent/builds/42156349#L272
1011671729,15915,thalieht,2022-01-13T02:05:32Z,"I didn't test all this stuff in master, i will tomorrow. I hope i didn't write all this for nothing...

I tested with both qt5 and qt6

Qt5 only:
Adding torrent before metadata are retrieved: It starts downloading but status is stuck at ""Downloading metadata"". Pause has no effect i.e. status changes but it keeps downloading. Content tab is never populated not even after qBt restart,
After testing Qt6 (and purging torrent and files) i came back to Qt5 to test again and now i get crashes mid-download. `fileIndex` is -1
```                                                                                                                                                                                                  
1   raise                                                                                                                                                                                                        0x7ffff5db5d22 
2   abort                                                                                                                                                                                                        0x7ffff5d9f862 
3   QMessageLogger::fatal(const char *, ...) const                                                                                                                                                               0x7ffff637cf26 
4   qt_assert(const char *, const char *, int)                                                                                                                                                                   0x7ffff637cf86 
5   BitTorrent::TorrentImpl::handleFileCompletedAlert                                                                                                                                    torrentimpl.cpp    1913 0x55555567e2be 
6   BitTorrent::TorrentImpl::handleAlert                                                                                                                                                 torrentimpl.cpp    1985 0x55555567e998 
7   BitTorrent::Session::dispatchTorrentAlert                                                                                                                                            session.cpp        4570 0x555555644bb2 
8   BitTorrent::Session::handleAlert                                                                                                                                                     session.cpp        4498 0x555555644759 
9   BitTorrent::Session::readAlerts                                                                                                                                                      session.cpp        4473 0x5555556445e1 
10  QtPrivate::FunctorCall<QtPrivate::IndexesList<>, QtPrivate::List<>, void, void (BitTorrent::Session:: *)()>::call(void (BitTorrent::Session:: *)(), BitTorrent::Session *, void * *) qobjectdefs_impl.h 152  0x55555566bcb7 
11  QtPrivate::FunctionPointer<void (BitTorrent::Session:: *)()>::call<QtPrivate::List<>, void>(void (BitTorrent::Session:: *)(), BitTorrent::Session *, void * *)                       qobjectdefs_impl.h 185  0x555555668ee4 
12  QtPrivate::QSlotObject<void (BitTorrent::Session:: *)(), QtPrivate::List<>, void>::impl(int, QtPrivate::QSlotObjectBase *, QObject *, void * *, bool *)                              qobjectdefs_impl.h 418  0x555555663451 
13  QObject::event(QEvent *)                                                                                                                                                                                     0x7ffff658bd26 
14  QApplicationPrivate::notify_helper(QObject *, QEvent *)                                                                                                                                                      0x7ffff7a831a6 
15  QCoreApplication::notifyInternal2(QObject *, QEvent *)                                                                                                                                                       0x7ffff656801a 
16  QCoreApplicationPrivate::sendPostedEvents(QObject *, int, QThreadData *)                                                                                                                                     0x7ffff6568b19 
17  ??                                                                                                                                                                                                           0x7ffff65af3d8 
18  g_main_context_dispatch                                                                                                                                                                                      0x7ffff52b6fd3 
19  ??                                                                                                                                                                                                           0x7ffff530d049 
20  g_main_context_iteration                                                                                                                                                                                     0x7ffff52b4545 
```                                                                                                                                                                                                            


Qt5 only:
Adding a torrent _with_ metadata (or from .torrent) is not added to the list, and re-trying to add it before restart results in 
""Magnet link is already queued for processing"". After restart it is lost.

Both:
Renaming a folder in a torrent results in: creating a parent folder for that folder and that parent has the new name (repeatable).

I first tested with qt5 and then i compiled with qt6. On startup, a torrent which i thought wasn't added, appeared and shortly after i get a crash every time: https://github.com/qbittorrent/qBittorrent/issues/16033#issuecomment-1011614101
Deleting that torrent stops the crashes.

```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
1   raise                                                                                                                                                                                                                                                                           0x7ffff5b08d22 
2   abort                                                                                                                                                                                                                                                                           0x7ffff5af2862 
3   QMessageLogger::fatal(const char *, ...) const                                                                                                                                                                                                                                  0x7ffff60cb34b 
4   qt_assert_x(const char *, const char *, const char *, int)                                                                                                                                                                                                                      0x7ffff60cb40e 
5   QList<Path>::at                                                                                                                                                                                                                                    qlist.h                 407  0x555555621b3a 
6   BitTorrent::TorrentImpl::filePath                                                                                                                                                                                                                  torrentimpl.cpp         800  0x5555556c1c4e 
7   TorrentContentModel::setupModelData                                                                                                                                                                                                                torrentcontentmodel.cpp 506  0x5555558c05f4 
8   PropertiesWidget::loadDynamicData                                                                                                                                                                                                                  propertieswidget.cpp    531  0x55555585869e 
9   PropertiesWidget::loadTorrentInfos                                                                                                                                                                                                                 propertieswidget.cpp    367  0x5555558566d0 
10  PropertiesWidget::updateTorrentInfos                                                                                                                                                                                                               propertieswidget.cpp    334  0x5555558560fb 
11  QtPrivate::FunctorCall<QtPrivate::IndexesList<0>, QtPrivate::List<BitTorrent::Torrent *>, void, void (PropertiesWidget:: *)(BitTorrent::Torrent *)>::call                                                                                          qobjectdefs_impl.h      152  0x555555811fed 
12  QtPrivate::FunctionPointer<void (PropertiesWidget:: *)(BitTorrent::Torrent *)>::call<QtPrivate::List<BitTorrent::Torrent *>, void>                                                                                                                 qobjectdefs_impl.h      185  0x5555558111bc 
13  QtPrivate::QSlotObject<void (PropertiesWidget:: *)(BitTorrent::Torrent *), QtPrivate::List<BitTorrent::Torrent *>, void>::impl                                                                                                                     qobjectdefs_impl.h      395  0x55555580fb1d 
14  ??                                                                                                                                                                                                                                                                              0x7ffff61c95a0 
15  BitTorrent::Session::torrentMetadataReceived                                                                                                                                                                                                       moc_session.cpp         781  0x555555607bea 
16  BitTorrent::Session::handleTorrentMetadataReceived                                                                                                                                                                                                 session.cpp             3946 0x5555556736de 
17  BitTorrent::TorrentImpl::endReceivedMetadataHandling                                                                                                                                                                                               torrentimpl.cpp         1523 0x5555556c4df3 
18  BitTorrent::TorrentImpl::fileSearchFinished                                                                                                                                                                                                        torrentimpl.cpp         1486 0x5555556c49bf 
19  BitTorrent::Session::fileSearchFinished                                                                                                                                                                                                            session.cpp             1717 0x555555668cb4 
20  QtPrivate::FunctorCall<QtPrivate::IndexesList<0, 1, 2>, QtPrivate::List<BitTorrent::TorrentID const&, Path const&, QList<Path> const&>, void, void (BitTorrent::Session:: *)(BitTorrent::TorrentID const&, Path const&, QList<Path> const&)>::call qobjectdefs_impl.h      152  0x5555556a6ffc                                                                                                                                                                                                                                                                                
```                                                                                                

Qt6 only:
Add torrent before metadata are retrieved: Torrent goes in ""Downloading metadata"" status and shortly after ""Checking resume data"" and then it crashes. Happens with and without using incomplete folder. Similar to https://github.com/qbittorrent/qBittorrent/issues/16033#issuecomment-1011614101 . This happens only once because on restart the torrent has downloaded the metadata.
```                                                                                                                                              
1   raise                                                                                                                                                                                                        0x7ffff5b08d22 
2   abort                                                                                                                                                                                                        0x7ffff5af2862 
3   QMessageLogger::fatal(const char *, ...) const                                                                                                                                                               0x7ffff60cb34b 
4   qt_assert_x(const char *, const char *, const char *, int)                                                                                                                                                   0x7ffff60cb40e 
5   QList<Path>::at                                                                                                                                                                      qlist.h            407  0x555555621b3a 
6   BitTorrent::TorrentImpl::filePath                                                                                                                                                    torrentimpl.cpp    800  0x5555556c1c4e 
7   BitTorrent::TorrentImpl::manageIncompleteFiles                                                                                                                                       torrentimpl.cpp    2041 0x5555556c7c74 
8   BitTorrent::TorrentImpl::handleTorrentCheckedAlert                                                                                                                                   torrentimpl.cpp    1722 0x5555556c5cd6 
9   BitTorrent::TorrentImpl::handleAlert                                                                                                                                                 torrentimpl.cpp    2021 0x5555556c7b4b 
10  BitTorrent::Session::dispatchTorrentAlert                                                                                                                                            session.cpp        4570 0x555555677fe6 
11  BitTorrent::Session::handleAlert                                                                                                                                                     session.cpp        4498 0x555555677b4f 
12  BitTorrent::Session::readAlerts                                                                                                                                                      session.cpp        4473 0x5555556779d7 
13  QtPrivate::FunctorCall<QtPrivate::IndexesList<>, QtPrivate::List<>, void, void (BitTorrent::Session:: *)()>::call(void (BitTorrent::Session:: *)(), BitTorrent::Session *, void * *) qobjectdefs_impl.h 152  0x5555556a6ba7 
14  QtPrivate::FunctionPointer<void (BitTorrent::Session:: *)()>::call<QtPrivate::List<>, void>(void (BitTorrent::Session:: *)(), BitTorrent::Session *, void * *)                       qobjectdefs_impl.h 185  0x55555569e898 
15  QtPrivate::QSlotObject<void (BitTorrent::Session:: *)(), QtPrivate::List<>, void>::impl(int, QtPrivate::QSlotObjectBase *, QObject *, void * *, bool *)                              qobjectdefs_impl.h 395  0x5555556954ad 
16  QObject::event(QEvent *)                                                                                                                                                                                     0x7ffff61baedb 
17  QApplicationPrivate::notify_helper(QObject *, QEvent *)                                                                                                                                                      0x7ffff7a11f4d 
18  QCoreApplication::notifyInternal2(QObject *, QEvent *)                                                                                                                                                       0x7ffff6174eba 
19  QCoreApplicationPrivate::sendPostedEvents(QObject *, int, QThreadData *)                                                                                                                                     0x7ffff6175098 
20  ??                                                                                                                                                                                                           0x7ffff6361238                                                                                                                                                                                                                
```
"
1011857044,15915,glassez,2022-01-13T07:10:25Z,"> I hope i didn't write all this for nothing...

Not for nothing!
Although, apparently, the crash problem does not apply to this particular PR (because there are similar reports about v4.4), but I am glad that you can achieve it. Please try to work with it using the builds from the master branch. If you find a reliable way to reproduce it, then you'll be great to help me fix it (even if I can't reproduce it myself, I'll be able to provide you with test PRs)."
1012263052,15915,glassez,2022-01-13T15:50:16Z,"@thalieht 
Well, I still managed to reproduce it. And it seems that we are faced with a problem not caused by recent changes, but surfaced thanks to them (a kind of mine with a delayed action). Probably, it has not manifested itself so destructively before.
Exploring it..."
1012267503,15915,thalieht,2022-01-13T15:55:04Z,I just finished testing master for all the things i mention in https://github.com/qbittorrent/qBittorrent/pull/15915#issuecomment-1011671729 and i can't reproduce any of them. Neither with Qt5 nor Qt6.
1012358512,15915,glassez,2022-01-13T17:37:00Z,"> I just finished testing master for all the things i mention in [#15915 (comment)](https://github.com/qbittorrent/qBittorrent/pull/15915#issuecomment-1011671729) and i can't reproduce any of them. Neither with Qt5 nor Qt6.

Well, there is still a problem with the current PR. And it contributes to the manifestation of another problem (although it exists in any case, because we have similar crash reports about v4.4).
>It starts downloading but status is stuck at ""Downloading metadata"".

This is about this PR.
>Pause has no effect i.e. status changes but it keeps downloading.

This (and crash as well) is existing bug.

Exploring it..."
1016657189,15915,thalieht,2022-01-19T16:45:19Z,">https://github.com/qbittorrent/qBittorrent/pull/15915#issuecomment-1011671729
Renaming a folder in a torrent results in: creating a parent folder for that folder and that parent has the new name (repeatable).

You didn't comment on it and it is still happening so i must assume you missed it. After the renaming, another torrent has to be selected and then back to the renamed one in order to be able to see what really happened in the Contents tab."
1017582277,15915,glassez,2022-01-20T14:45:32Z,"> > [#15915 (comment)](https://github.com/qbittorrent/qBittorrent/pull/15915#issuecomment-1011671729)
> > Renaming a folder in a torrent results in: creating a parent folder for that folder and that parent has the new name (repeatable).
> 
> You didn't comment on it and it is still happening so i must assume you missed it. After the renaming, another torrent has to be selected and then back to the renamed one in order to be able to see what really happened in the Contents tab.

I'll look at it when I finish the core changes."
1024857248,15915,glassez,2022-01-29T07:35:31Z,"> I'll look at it when I finish the core changes.

Should be fixed now.

@Chocobo1 
I checked it again and adjusted something. If you have no fundamental objections let's finish it. We'll have enough time ti test it detailed before v4.5 release."
1024946499,15915,thalieht,2022-01-29T16:53:10Z,"All paths in options are reset to default i.e. Default Save Path is reset to /Downloads Temp path is reset to /temp, logs location is reset to whatever is the default, Copy .torrent options are empty and i didn't have a theme to test that option but we can assume it's affected like everything else. Going back to master they are all restored to their modified path.

Can't find any other problems."
1025072848,15915,Chocobo1,2022-01-30T05:18:40Z,">I checked it again and adjusted something. If you have no fundamental objections let's finish it. We'll have enough time ti test it detailed before v4.5 release.

OK, I'll try to review it in the following days."
1025101502,15915,glassez,2022-01-30T09:12:00Z,">All paths in options are reset to default i.e. Default Save Path is reset to /Downloads Temp path is reset to /temp,

Should be fixed now.
@Chocobo1 
I believe that storing Paths in settings as strings is the best idea (and it lets to avoid implementing any upgrade logic) . There are two ways to do this:
1. Use `SettingValue<QString>` for them and perform conversion `Path` -> `QString` ""manually"" 
2. Add direct support of `Path` to `SettingsStorage`. I preferred the second option, given that the `Path` is a fundamental class for qBittorrent."
1025165494,15915,Chocobo1,2022-01-30T15:19:52Z,">Add direct support of Path to SettingsStorage. I preferred the second option, given that the Path is a fundamental class for qBittorrent.

OK.

Off topic. I often thought of this conversion action should have an official trait/interface that every class that supports it can implement it so that `SettingsStorage` won't need to know the specific conversions of each classes... "
1025166326,15915,glassez,2022-01-30T15:24:17Z,"> this conversion action should have an official trait/interface that every class that supports it can implement it so that `SettingsStorage` won't need to know the specific conversions of each classes...

Looks good at first glance..."
1025367283,15915,Chocobo1,2022-01-31T04:24:29Z,">Looks good at first glance...

Except I still haven't got a clear idea how to do it, still just an idea so far...
Can you pause pushing to this PR while I'm reviewing? for about 3 days."
1025380816,15915,glassez,2022-01-31T04:57:30Z,"> Can you pause pushing to this PR while I'm reviewing? for about 3 days.

OK.
"
1029972134,15915,Chocobo1,2022-02-04T13:10:08Z,"@glassez 
I think this PR is almost done and I would like to give priority to it: that means pause merging other PRs until this one is finished to avoid conflicts."
1029975560,15915,glassez,2022-02-04T13:14:45Z,"> @glassez I think this PR is almost done and I would like to give priority to it: that means pause merging other PRs until this one is finished to avoid conflicts.

How should I provide next changes? As a separate fixup commit?"
1029979943,15915,Chocobo1,2022-02-04T13:20:36Z,">How should I provide next changes? As a separate fixup commit?

You can squash the current fixup commit and provide another one."
1030762024,15915,Chocobo1,2022-02-06T06:35:30Z,"OK, looks good. One last step, please squash the fixup commit and resolve the merge conflicts. "
1030824469,15915,glassez,2022-02-06T12:38:12Z,"> OK, looks good. One last step, please squash the fixup commit and resolve the merge conflicts.

Done!"
1030884340,15915,glassez,2022-02-06T18:08:40Z,"@Chocobo1 
Not to delay this PR...
Ever since I saw your great attachment to native paths, I've been wondering if we could make Path completely native (at the application level, of course). I think the performance loss that this will entail can be regarded as acceptable, or not?"
1031073166,15915,Chocobo1,2022-02-07T04:53:50Z,">I think the performance loss that this will entail can be regarded as acceptable, or not?

It is hard to say, maybe this can be improved later when we have more experience with it.
However there are a few places that require uniform path, so not all of them can be native path."
1032164330,15915,glassez,2022-02-08T03:04:38Z,Thanks to all the reviewers!
1033174853,15915,xavier2k6,2022-02-08T23:45:36Z,"@glassez There's an issue with this PR!

Just checked the CI Windows build of this PR in portable mode/default profile & if I add a torrent, it doesn't show up in transfer list....after a few mins if I try to add the same torrent it says `torrent is already queued for processing` but still isn't visible.
Exit the program & no fastresume or torrent files are created either.
Re-open & try to add same torrent file again & it's like as if it was never added before/doesn't show again etc.

I've gone through all Windows CI builds in master branch from`#948` up to the build associated with this PR `#991` & that's when the issue arose.

https://github.com/qbittorrent/qBittorrent/actions/workflows/ci_windows.yaml?query=branch%3Amaster"
1033282686,15915,glassez,2022-02-09T02:35:15Z,"@xavier2k6 
Confirmed with CI build but it works fine with my own build (Qt6 based). Most likely something wrong with Qt5 compatibility. I'll check it out as soon as I get to Qt5-based environment."
1033679212,15915,thalieht,2022-02-09T11:52:35Z,"Yep Qt5 only bug confirmed. I reported it in https://github.com/qbittorrent/qBittorrent/pull/15915#issuecomment-1011671729 but it looks like i forgot to re-test with Qt5. Or it was fixed and then broken again, don't remember."
1033754123,15915,mzso,2022-02-09T13:20:28Z,Does this touch on relative paths?
1033934667,15915,glassez,2022-02-09T16:14:39Z,#16411
257096319,5877,sledgehammer999,2016-10-29T15:01:00Z,"I wonder if this is better suited as a dialog/window under the 'Tools' menu item.
@qbittorrent/qbittorrent-frequent-contributors any input on the design?
"
257136570,5877,dzmat,2016-10-30T07:29:08Z,"I think separated dialog window may  add more confusion, because connection related things suddenly become scattered at different places.
"
257186340,5877,sledgehammer999,2016-10-30T22:57:17Z,"FYI, I am in the middle of fixing up and merging #5342. I actually almost finished fixing the first commit of that PR.
In any case, we might need to redo this PR. The other PR takes precedence because of its sheer size. It is very difficult to resolve merge conflicts on that PR.
"
257199085,5877,dzmat,2016-10-31T02:04:25Z,"Ok. I'll wait and rewrite my PR when you have done it.  Just notify all of us sitting and waiting here with our PRs.
"
257357071,5877,Chocobo1,2016-10-31T17:15:59Z,"I would prefer this: add a button in settings and put the new controls in another dialog: [mockup1](https://cloud.githubusercontent.com/assets/9395168/19863509/6cd7b1c6-9fcf-11e6-985b-7c14d881dd20.png), [mockup2](https://cloud.githubusercontent.com/assets/9395168/19863693/284226bc-9fd0-11e6-8a0a-e939b57d9804.png).

we could refactor to this later if the maintainer approves.
"
257926444,5877,dzmat,2016-11-02T16:53:05Z,"rebase & rewrite
"
260222983,5877,sledgehammer999,2016-11-13T23:55:04Z,"@dzmat could you implement what @Chocobo1 shows in his mockups?
"
260320634,5877,dzmat,2016-11-14T12:15:55Z,"@sledgehammer999 ok, I will try to do that. Not sure that at webui I will be able do such refactoring. If not, I will call for a help. Give me 3-5 days for refactoring.
"
260339719,5877,sledgehammer999,2016-11-14T13:54:20Z,"Just so you know, for me it is acceptable to do only the GUI. And for the web parts, you only need to expose the API (if any) and let someone else code the WebUI if you can't.
"
260703305,5877,dzmat,2016-11-15T17:10:33Z,"@sledgehammer999 GUI refactored as it is shown on mockups.  I did'n touch Webui, left there old interface justto give to an user any opportunity to deal with ban list.
"
266407999,5877,zeule,2016-12-12T11:43:02Z,"What if a user uses a rule file (which might contain thousands of IPs)? All of them will appear in the `Session::m_bannedIPs` and as such in the ""User banned IP list"" listbox?"
266420265,5877,dzmat,2016-12-12T12:31:41Z,"As I understood this, qbittorrent saves in settings file 2 things:
1. list of manually banned IP addresses (yes, it is placed directly in settings file);
2. the name of file containing third party ban list (which can be quite large).

At every startup qbittorrent  loads both lists separated. Entries from the third party list are not stored in the list of manually banned IP addresses.

BTW we should use some acronym for that list, LOMBIP possibly? ;)"
266461912,5877,dzmat,2016-12-12T15:35:02Z,"Now it look like that:
![screenshot_2016-12-12](https://cloud.githubusercontent.com/assets/14874367/21104961/17a5c3de-c0bb-11e6-9ae0-0f176651fa4c.png)
"
266480451,5877,thalieht,2016-12-12T16:39:16Z,"There are 2 lists as you said and the manually banned IPs are in the same section as the 3rd party IPs. This can be confusing and make people think it'll show the IPs of the 3rd party list. Maybe change the name of the button to
`List of manually banned IP addresses`?"
266482580,5877,zeule,2016-12-12T16:46:24Z,"@dzmat: thanks you, it is clear now."
266486269,5877,zeule,2016-12-12T16:59:06Z,"> Maybe change the name of the button to ""List of manually banned IP addresses""?

As to me, the button caption has to describe an action but not an object (obviously because activating it triggers an action), e.g. ""Show/List manually banned addresses"" or ""Manage/Edit ..."", since a user may change those addresses. ""IP"" might be superfluous here, since the group name clarifies this already for all its child elements."
267059898,5877,dzmat,2016-12-14T15:15:30Z,"So, for button caption we have these variations supposed:
[Open|Edit|Manage] [List of] [manually] banned [IP] addresses.
Total is 32 variations.
How we would made **the final decision**? Would we roll a dice or draw lots? Or summon more developers here? For example, Sledgehummer has not said his opinion.
Or would you give me dictatorship rights to make final definitive definition? 😄 "
267067294,5877,dzmat,2016-12-14T15:42:01Z,"Renamed the button to the ""Open the list of manually banned IP addresses"". 
I know than the word ""manually"" is not encountered later in the dialog. It is not bad, I think. Because user already knows that this list is a ""manual"" list."
267109673,5877,zeule,2016-12-14T18:12:15Z,"> So, for button caption we have these variations supposed:

You have freedom to choose any variant you like, as well as to argue with an author of a hypothetical future PR who would like to change it.

I'm for a short caption and long hint. For instance, the caption ""Edit manual list"" and the hint ""Manage manually banned IP addresses"". "
267822449,5877,zeule,2016-12-18T13:55:00Z,I believe nothing stops you now from correcting the file names (`options_banlist` → `optionsbanlist`) and squashing the commits. Aside from that I have no more suggestions or comments. 
267948863,5877,dzmat,2016-12-19T12:05:43Z,Rebased & squashed in 1 commit.
273640002,5877,sledgehammer999,2017-01-18T23:54:46Z,"FYI, this stays in an open tab in my browser from now. Hopefully tomorrow, I'll be able to review+merge it."
274269259,5877,sledgehammer999,2017-01-21T15:45:54Z,I have read until the commit named `leftover backtick fix` and I approve all those. So if you want you can `fixup` them.
275900203,5877,dzmat,2017-01-29T08:09:16Z,@LordNyriox of course I'll squash and rebase as soon as all problems will be resolved and maintainer will be satisfied. Earlier it is pointless.
277802686,5877,sledgehammer999,2017-02-06T20:25:53Z,"I was wrong. There are 2 places where `m_bannedIPs` is getting modified. Here is how to ensure that `m_bannedIPs` stays sorted.

1. During initialization in the constructor. So instead of
```c++
, m_bannedIPs(""State/BannedIPs"")
```
do
```c++
, m_bannedIPs(""State/BannedIPs"", QStringList(), [](const QStringList &value) { QStringList tmp = value; tmp.sort(); return tmp; })
```
2. It is modified in `Session::banIP(const QString &ip)`. Just do `bannedIPs.sort();` before assigning it to `m_bannedIPs`"
277804042,5877,sledgehammer999,2017-02-06T20:31:04Z,"I believe all those are the required steps for merging. I don't think I'll find something else. So feel free to fixup.

There is slight race-condition in current implementation. But I am willing to fix it myself after merge. But if you want to do it, I won't stop you. Currently both `processBannedIPs();` and the IPFilter parser operate directly on the set libtorrent filter. So when clearing the filter and reparsing, there is a small time frame where all IPs are allowed. I want to refactor those 2 functions so they operate on a `libtorrent::ip_filter` variable and populate. And after we have it populated we set it directly, without first clearing the old one."
278031089,5877,dzmat,2017-02-07T15:19:28Z,"Rebased & squished. There are still some open questions:
1. It is unclear why manually banned IPs are applied into ipfilter even when checkbox ""IPFiltering"" is cleared. Such behavior is already present in code and I didn't touch it. But it definitely needs clarification.
2. Race condition. I did not touch them also.
3. Suddenly I discovered that QListWidget  and QStringList sort items in different order. Exactly it looks like that they treat symbol ':' in different ways. Don't even know what to do here, I'm not so familiar with Qt. So in the my widget and in the webGUI display order is different."
278463592,5877,sledgehammer999,2017-02-08T21:14:21Z,OK. I'll handle the remaining issues myself after merge. I just hope I'll find time this weekend.
284270580,5877,sledgehammer999,2017-03-05T22:57:43Z,Can you do a final rebase? We dropped qt4 support and it finds a conflict in base.pri. Thank you.
284389975,5877,dzmat,2017-03-06T13:02:26Z,@sledgehammer999 rebased.
284535838,5877,sledgehammer999,2017-03-06T21:19:11Z,">Suddenly I discovered that QListWidget and QStringList sort items in different order. Exactly it looks like that they treat symbol ':' in different ways. Don't even know what to do here, I'm not so familiar with Qt. So in the my widget and in the webGUI display order is different.

Can you give me an example of this so I can try it?"
284547760,5877,sledgehammer999,2017-03-06T22:01:37Z,">Can you give me an example of this so I can try it?

Nevermind. I found out that QListWidget sorts:
```
::1
192.168.1.1
```

while QStringList::sort()
```
192.168.1.1
::1
```

I think those 2 components use different sorting criteria. And I don't see any way of controlling it via the API."
284592369,5877,sledgehammer999,2017-03-07T01:33:10Z,"I have solved the 3 remaining issues with 3 commits in this branch: https://github.com/sledgehammer999/qBittorrent/commits/dzmat-to_pull_request
Can you guys take a look and confirm?
PS: Apparently QListView is hard to work with. I couldn't figure out how to tell it to use the sort proxy..."
284861192,5877,sledgehammer999,2017-03-07T21:14:15Z,"I any case I am merging this and applying my commits on top. If something is wrong we can fix it with new commits.
@dzmat thanks for this PR."
216655230,5214,sledgehammer999,2016-05-03T20:30:13Z,"Unless I am mistaken you actually implement #465 in some way. However, under this light an environment variable isn't very desirable :p
"
216657923,5214,zeule,2016-05-03T20:41:04Z,"Hm... Kind of... I just tired of qBt rechecking my files over and over again. 

As to me, the environment variable approach gives flexibility for developers. One can have separate configurations for different tests, check how qBt behaves with an empty configuration (by the way, it crashes with LC_COLLATE=C when opening the options dialogue) in no time.

Do you suggest to add a command line switch to set this variable for the portable version?
"
216658510,5214,zeule,2016-05-03T20:43:22Z,"> Do you suggest to add a command line switch to set this variable for the portable version?

And, of course, a code that will check that variable contents for an absolute path, which will be used as is but not appended.
"
216660724,5214,sledgehammer999,2016-05-03T20:51:38Z,"> check how qBt behaves with an empty configuration (by the way, it crashes with LC_COLLATE=C when opening the options dialogue) in no time.

This shouldn't happen. Clean installs should just work.

> Do you suggest to add a command line switch to set this variable for the portable version?

If it isn't trouble for you. Am I wrong or did the last merges greatly simplified the code for ""portable version"" implementation?

> And, of course, a code that will check that variable contents for an absolute path, which will be used as is but not appended.

In portable versions the config could reside in the same folder as the binary. So relative paths should work too.
"
216663396,5214,zeule,2016-05-03T21:01:28Z,"Configuration name is appended to the paths like `QDir::homePath()`.
"
216666351,5214,zeule,2016-05-03T21:13:14Z,"I'm going to pack  Utils::Fs::QDesktopServices implementations into a class, add an override version with manually specified root path and instantiate one or another basing on the command line switch. What do you think? 
"
216681984,5214,zeule,2016-05-03T22:19:41Z,"@qbittorrent/qbittorrent-frequent-contributors Can someone do me a favor, please, and make extensive tests on Windows and OS X for the portable version?
"
218277061,5214,zeule,2016-05-10T20:13:53Z,"PR updated. Now it implements portable mode. Needs testing. 

@sledgehammer999: support for command line switches has been added, but environment variables are supported too. I believe they are better for debugging and may be of use for users too.

Two settings are proposed: 
`--profile=<dir>` allows to set configuration prefix. Inside of it directories `cache`, `config`, `data`, `downloads` are created. If the switch is not supplied, default system dirs are used.
Option `--portable` is a shortcut for `--profile=<exe dir>/profile`. 
`--configuration=<name>` option allows to have different configuration inside of a configuration prefix.

If `--profile` option is not empty, `SettingStorage` serialises settings in `QSettings::IniFormat` to make them portable between platforms.
"
218281524,5214,zeule,2016-05-10T20:30:27Z,"There is a destructive change: usage help text does not contain the Web UI port number from settings anymore because options parsing needs to be done before preferences initialisation.
"
218440139,5214,zeule,2016-05-11T12:07:06Z,"This closes #4887 too
"
218445751,5214,zeule,2016-05-11T12:33:46Z,"@qbittorrent/qbittorrent-frequent-contributors:
This is more or less ready. With two exceptions (see below) `strace qbittorrent --profile /tmp/qbt_profile` does not show any app-specific file activity in ${HOME}.

The first exception is `${HOME}/.config/qBittorrentrc`, but I guess it is used by KF5, and we can do nothing about it. The file keeps `KFileDialog` settings.

The second exception is the `QIniSettings` class. It is used in statistics and RSS. And my question is: may I remove the `QIniSettings` class? Why is it needed? May I replace it with `Utils::Environment::SpecialFolders::applicationSettings()` calls? We can add an overloaded `applicationSettings()` for that cases to pass `QSettings::Format`.
"
218517863,5214,glassez,2016-05-11T16:43:18Z,"> This is more or less ready.

@evsh less than you think.
Your biggest error here is that you changed the order of things in `main()`, without knowing how it actually works.
Application instance MUST be created BEFORE we parse command line since QApplication should parse and filter the parameters destined for it. Otherwise you will get an exception if the user wants to specify such command line parameters. The second (minor) mistake is you cannot use any translations before Application is initialized.
I'm not going to dwell on other (less important) issues. First you need to fix this.
"
218518907,5214,zeule,2016-05-11T16:47:02Z,"> Application instance MUST be created BEFORE we parse command line since QApplication should parse and filter the parameters destined for it. Otherwise you will get an exception if the user wants to specify such command line parameters.

Can't understand you, sorry. Could you explain it, please?
"
218520250,5214,glassez,2016-05-11T16:51:50Z,"> The second exception is the `QIniSettings` class. It is used in statistics and RSS. And my question is: may I remove the `QIniSettings` class? Why is it needed?

If you look carefully the code, it becomes clear that it is completely useless. That's why I refused to use it in `SettingsStorage` class.

> May I replace it with Utils::Environment::SpecialFolders::applicationSettings() calls?

IIRC, yes.

BTW, the last time we use the `QSettings` class not for its intended purpose, and only for serialization of settings into the file. It's all the same to shoot with a Bazooka on the wheel. Isn't it time for us to think about using something more suitable? @sledgehammer999, what do you say?
"
218523252,5214,glassez,2016-05-11T17:01:59Z,"> Can't understand you, sorry. Could you explain it, please?

For example, QApplication recognizes `-style=<style>` argument. IIRC, If user pass it your code throws an exception since it unknown option for qBittorrent. But if you pass command line to QApplication constructor first it filters all known options and modifies `argc`/`argv`. Then you can do custom parsing the rest.
"
218523774,5214,zeule,2016-05-11T17:03:52Z,"Oh, I get it now. Thanks! Indeed, I forgot about tanslations and Qt options completetly.
"
218524121,5214,zeule,2016-05-11T17:05:09Z,"> If you look carefully the code, it becomes clear that it is completely useless.

I did look, did make the same conclusion and that is why I'm asking. 
"
218527904,5214,glassez,2016-05-11T17:18:41Z,"> Oh, I get it now. Thanks! Indeed, I forgot about tanslations and Qt options completetly.

You should keep current order and try other solution. E.g. you may parse command line in Application constructor and then use parsed params outside it via some Application method (something like `Application::commandLineArgs()`).
"
218529017,5214,zeule,2016-05-11T17:22:36Z,"Yes, thanks. It is obvious that parameters parsing has to be done in `Application::Application()`, because this is the onle place between `QApplication::QApplication()` and `Preferences` initialisation.
"
218537732,5214,glassez,2016-05-11T17:53:14Z,"> Option --portable is a shortcut for --profile=<exe dir>/profile.
> --configuration=<name> option allows to have different configuration inside of a configuration prefix.

What happens if the user set `--portable` and `--profile=some_path` together?
"
218538384,5214,zeule,2016-05-11T17:55:33Z,"`Application::Application()` [throws](https://github.com/qbittorrent/qBittorrent/pull/5214/files#diff-83197ed34f0ea23a0ccd7edfa47822eeR103) an exception which is shown to the user and the program aborts.
"
218541134,5214,glassez,2016-05-11T18:05:04Z,"> Application::Application() throws an exception which is shown to the user and the program aborts.

Ok.
"
218541552,5214,glassez,2016-05-11T18:06:49Z,"@evsh For some reason we need to know the original number of parameters. This can only be done before calling the QApplication constructor.
"
218563519,5214,zeule,2016-05-11T19:26:05Z,">  For some reason we need to know the original number of parameters.

Actually, I don't understand this. If a user wants to display the dialogue with the usage text using specific style or stylesheet, why not? 
"
218622533,5214,zeule,2016-05-11T23:46:23Z,"PR updated: options parsing was moved into the `Application` constructor, `QIniSettings` class was removed.
"
218623739,5214,zeule,2016-05-11T23:53:56Z,"And I would like to add that all the playing with characters in `QString`s after working with `boost::filesystem::path` is like using C after C++.
"
218661278,5214,glassez,2016-05-12T05:06:13Z,"> Actually, I don't understand this. If a user wants to display the dialogue with the usage text using specific style or stylesheet, why not?

Ok.
"
218673406,5214,glassez,2016-05-12T06:43:48Z,"@evsh, the user downloads the torrent to removable disk beside portable qBittorrent, and he continues to do this on another computer - it's real use case of portable app?
If yes your implementation is incomplete since we store absolute save paths in resume data.
"
218676265,5214,glassez,2016-05-12T07:02:14Z,"> And I would like to add that all the playing with characters in  QString s after working with  boost::filesystem::path  is like using C after C++.

Unfortunately it's incompatible with QString and we would often convert strings to use it. We also can implement QString/QDir based Path class.
"
218684666,5214,zeule,2016-05-12T07:49:49Z,"> Unfortunately it's incompatible with QString and we would often convert strings to use it. We also can implement QString/QDir based Path class.

The change would make sense only together with replacing the whole Qt I/O, of course.
"
218684802,5214,zeule,2016-05-12T07:50:38Z,"> @evsh, the user downloads the torrent to removable disk beside portable qBittorrent, and he continues to do this on another computer - it's real use case of portable app?
> If yes your implementation is incomplete since we store absolute save paths in resume data.

Do you mean libtorrent and its ""save_path"" attribute?
"
218688111,5214,glassez,2016-05-12T08:07:20Z,"> Do you mean libtorrent and its ""save_path"" attribute?

Both libtorrent save_path and qBittorrent qBt-savePath.
"
218690667,5214,zeule,2016-05-12T08:19:43Z,"Would it be OK if I hook up into the save/load sequences and replace both attributes with a path, relative to the $HOME or profile dir?
"
218691885,5214,zeule,2016-05-12T08:25:34Z,"> Would it be OK if I hook up into the save/load sequences and replace both attributes with a path, relative to the $HOME or profile dir?

Oh, no! Windows might have several filesystem roots! What to do then?
"
218695405,5214,glassez,2016-05-12T08:41:55Z,"> The change would make sense only together with replacing the whole Qt I/O, of course.

Well, in that case, I prefer not to continue further on this topic.

> Oh, no! Windows might have several filesystem roots! What to do then?

We need to carefully consider it. I have no solution yet...
"
218697185,5214,glassez,2016-05-12T08:50:03Z,"@evsh, you can abandon claims for portable mode here, complete everything else, and then you can start to think about it.
"
218698346,5214,zeule,2016-05-12T08:55:12Z,"> We need to carefully consider it. I have no solution yet...

I see it in the following way. On saving:
`<windows only>` If `profile_dir` drive letter is the same as save_path drive letter`</windows only>` make save_path relative to the `profile_dir`.
On loading:
If save_path is relative, make it absolute using `profile_dir`.

`profile_dir` is `${HOME}` or the one specified via `--profile`/`${QBT_PROFILE}`
"
218698715,5214,zeule,2016-05-12T08:56:50Z,"The alternative is to make path relative only if it is inside of `profile_dir` 
"
218699153,5214,zeule,2016-05-12T08:58:38Z,"> @evsh, you can abandon claims for portable mode here, complete everything else, and then you can start to think about it.

If we are one step from it, why dont't we make it work?
"
218716346,5214,Chocobo1,2016-05-12T10:15:13Z,"> @evsh, the user downloads the torrent to removable disk beside portable qBittorrent, and he continues to do this on another computer - it's real use case of portable app?

Yes. 
This usage is interesting but I think its optional not mandatory.

IMO, if an app can be moved to anywhere without losing its settings, it can be called a portable app. This doesn't imply/require the artifacts that the app produces is also portable.

Here's another scenario I can think of: qbt portable was in dir `C:\qbt` and seed torrents in `C:\seed` & `e:\`, now the user move portable  dir to `d:\qbt` and relaunch, the user might expect the seeding continue to work.
In this scenario, it might be best to use absolute path.
"
218724539,5214,glassez,2016-05-12T10:55:13Z,"> The alternative is to make path relative only if it is inside of profile_dir

It is a good idea.
Then we can just set `profile_dir` as working directory when the application is run, if `--portable` is set.
"
218729676,5214,zeule,2016-05-12T11:22:31Z,"But that rules out interesting cases with qbt on an external drive, where it is not convenient to download inside of the qbt directory. I incline towards the first option (relative path if on the same drive).
"
218731344,5214,glassez,2016-05-12T11:31:54Z,"> I incline towards the first option (relative path if on the same drive).

But only if `--portable` parameter is set.
But we could offer the user to make a choice when adding a torrent (in portable mode).
"
218739510,5214,glassez,2016-05-12T12:15:53Z,"@evsh when you're done most of the work here, check and fix coding style. The main mistakes that I noticed a cursory glance, is naming (namespace names must start with Capital letter) and statement breaks (operators must placed not at the end of the line and at the beginning of the next one).
"
218741490,5214,zeule,2016-05-12T12:25:43Z,"> But only if --portable parameter is set.

@glassez why? what shortcomings do you see?
"
218742763,5214,glassez,2016-05-12T12:31:39Z,"> @glassez why? what shortcomings do you see?

I just don't want qBittorrent was doing some extra work in the normal (non-portable) mode.
"
218749024,5214,zeule,2016-05-12T12:58:11Z,"We can add two methods

``` C++
QString toPortablePath(const QString &absolutePath);
QString fromPortablePath(const QString &portablePath);
```

to the `Profile` class (see the updated diffs). Those in the `Impl::DefaultProfile` will do nothing.
"
218753424,5214,glassez,2016-05-12T13:16:20Z,"They should do nothing even if we set `--profile` but not `--portable`.
"
218755066,5214,zeule,2016-05-12T13:22:15Z,"Disagree with you: current meanings of `--portable` and `--profile` are identical.
"
218760903,5214,glassez,2016-05-12T13:43:01Z,"> current meanings of --portable and --profile are identical.

Really?

> Option --portable is a shortcut for --profile=<exe dir>/profile

They are identical in only one case. And the rest?
When I want to use a different profile (e.g. for testing), it does not mean that I want to enable portable mode.
"
218767745,5214,zeule,2016-05-12T14:06:38Z,"> Really?

Yes, they both set profile directory.

> They are identical in only one case. And the rest?
> When I want to use a different profile (e.g. for testing), it does not mean that I want to enable portable mode.

For testing you may use different configurations. I'd better add an option `--no-portable-fastresume`, because otherwise most of the users of portable mode would need to pass two options. While a developer could use the second command line argument/environment variable. 
"
218768469,5214,zeule,2016-05-12T14:09:02Z,"Or, we add `--portable-fastresume` and `--portable` implies `--profile=x` _and_ `--portable-fastresume`.
"
218772049,5214,glassez,2016-05-12T14:20:57Z,"> Yes, they both set profile directory.

But only one set portable mode!

> For testing you may use different configurations. I'd better add an option --no-portable-fastresume, because otherwise most of the users of portable mode would need to pass two options. While a developer could use the second command line argument/environment variable. 
> Or, we add --portable-fastresume and --portable implies --profile=x and --portable-fastresume.

What is all this? Why you need to have a separate `--portable-fastresume`?

> otherwise most of the users of portable mode would need to pass two options

Why? They should pass only `--portable`. Other (normal mode users) may pass `--profile=<profile_path>`. And that's all!
"
218773728,5214,zeule,2016-05-12T14:26:09Z,"> Why? They should pass only --portable.

Because portable mode user may want to keep the qBt profile not in the default location but somewhere else. 
"
218775408,5214,glassez,2016-05-12T14:31:16Z,"> Because portable mode user may want to keep the qBt profile not in the default location but somewhere else. 

Ok. Then you just should allow to set `--profile' together with`--portable`.
But, IMO, if you go on about all the desires of the user, nothing good happens.
"
218785841,5214,zeule,2016-05-12T15:04:10Z,"A few moments ago you've pointed out that profile directory and relative paths in the fastresume files are independent options. Why don't we associate each with a command line parameter then? That's all. No more variations, no more desires. That would be logical, IMO. And then we introduce the `--portable` switch to give reasonable defaults for portable configurations. 
"
218797453,5214,glassez,2016-05-12T15:41:33Z,"And then we introduce lot of possible undefined behaviors!

> A few moments ago you've pointed out that profile directory and relative paths in the fastresume files are independent options. 

Yes. But ""relative paths in the fastresume files"" is not separate option, it's just attribute of ""portable mode"" option.
"
218799090,5214,zeule,2016-05-12T15:46:34Z,"> And then we introduce lot of possible undefined behaviors!

Namely?

> Yes. But ""relative paths in the fastresume files"" is not separate option, it's just attribute of ""portable mode"" option.

I begin to suspect that the name `--portable` for the command line switch is wrong :)  ""relative paths in the profile directory"" is the attribute of the portable mode as well. 
"
219265144,5214,Chocobo1,2016-05-15T04:04:42Z,"Compiled & tested, the command line switches works fine!

Some minor document issues:
1. in command line help, the Options list should have sorted alphabetically.
2. `For example, to disable the splash screen: QBT_NO_SPLASH=1 qbittorrent`, the last `qbittorrent` should be replaced by `argv[0]`.
3. `Bad command line: Portable mode and explicit profile directory options are mutually exclusive`, the incompatibility of 2 options should have been mentioned under `--portable` or `--profile` point.
4. `Bad command line: Portable mode and explicit profile directory options are mutually exclusive`, here the `Portable mode` & `explicit profile` are mentioned and so command line help should also mention it.
"
219299212,5214,glassez,2016-05-15T17:33:42Z,"I don't like this idea of portable mode. There are too many contradictions. Or it is necessary to apply some restrictions to make it consistent (for example, allow to store portable torrents only in a single directory, specified explicitly or by default in the subdirectory of the profile, etc.).
"
219299494,5214,glassez,2016-05-15T17:38:27Z,"Frankly, the use applications of this type in portable mode is generally suspicious for me.
"
219301636,5214,Chocobo1,2016-05-15T18:19:43Z,"> allow to store portable torrents only in a single directory, specified explicitly or by default in the subdirectory of the profile, etc

+1, thought about this. For example a folder called ""Download"" located at the same folder as qbt.exe or in the Profile folder is good and easy for users to follow.
"
219314423,5214,zeule,2016-05-15T22:22:03Z,"> > allow to store portable torrents only in a single directory, specified explicitly or by default in the subdirectory of the profile, etc
> 
> +1, thought about this. For example a folder called ""Download"" located at the same folder as qbt.exe or in the Profile folder is good and easy for users to follow.

Can not understand your concerns, but want to note that, IMO, users with portable drivers most likely would prefer to keep the qBt in a subfolder, because they use their drives for, well... portable data and qBt may be just a tool, but not a _ding an sich_.
"
219315912,5214,sledgehammer999,2016-05-15T22:46:56Z,"I tried to follow the out-of-code comments and I hope I didn't miss something.
1. There shouldn't be 2 switches for setting the profile dir. Only one. If the user chooses to override the profile path then he should specify the exact path(absolute or relative to current path).
2. An interesting question was ""What happens if user downloads something in computer A and moves to continue downloading in computer B""? And something about relative paths. Maybe we should investigate what other clients do(if they have portable mode). Saving as relative path should be done if the files are saved on the same media as the qbt binary. But this is difficult to detect on linux, right?

I haven't looked at the code, so what is the current situation on the above items? Have you come on a solution? Or is this too hard to implement correctly? I wouldn't mind having the option to only set the profile dir without any other assurances.
"
219346251,5214,glassez,2016-05-16T04:26:53Z,"@evsh ""to store portable torrents only in a single directory"" is main idea of my comment. The second thing is ""specified explicitly or by default in the subdirectory of the profile"" so I think it covers your case.
Also we should disable incomplete folder for portable torrents and probably apply some other restrictions.
"
219346729,5214,glassez,2016-05-16T04:32:09Z,"> I wouldn't mind having the option to only set the profile dir without any other assurances.

+1
Since portable mode is more complex task and it requires very serious consideration to do it correctly.
"
219417603,5214,zeule,2016-05-16T12:53:05Z,"> 1. There shouldn't be 2 switches for setting the profile dir. Only one. If the user chooses to override the profile path then he should specify the exact path(absolute or relative to current path).

There is only one.

> An interesting question was ""What happens if user downloads something in computer A and moves to continue downloading in computer B""?...

On Windows relative paths are written into the .fastresume files if the profile dir and the save path is on the same drive and always on the other platforms. 

> Also we should disable incomplete folder for portable torrents and probably apply some other restrictions.

Why not require it to be inside of the profile dir?
"
219742574,5214,zeule,2016-05-17T14:51:30Z,"PR update addressing the raised questions and comments. 

Perhaps we should split it and merge the first five commits and think about the portable mode and fastresume later? I very much want to get configurations support for debugging purposes.
"
221287614,5214,zeule,2016-05-24T14:24:46Z,"PR updated: moved the `Profile` class into the global namespace, implementation classes into namespace `Private`. Moved files to `base/` and `base/private/` respectively.
"
227243615,5214,zeule,2016-06-20T19:27:03Z,"@qbittorrent/qbittorrent-frequent-contributors:
I really-really want this to be merged (at least partially). This would make debugging so much simpler! What can I do to make it happen?
"
227398758,5214,glassez,2016-06-21T10:16:27Z,"For me, there is no portable mode should be here. I'm really not sure it's implemented correctly now. It requires more thinking about so it's another task.
"
227459968,5214,zeule,2016-06-21T14:37:05Z,"@glassez, thank you for the opinion, but this is not an answer to my question. Let me remind the initial motivation: to make development easier it makes sense to load different list of torrents in the debugging mode than that of a regular run. 
Attempts to implement a full-fledged portable mode did not only improved the initial implementation, but also raised requirements quite high. And the latter complicates any efforts to merge this code into the master branch. That is why my questions is: what can be done to merge at least the configurations support? 
"
227477246,5214,glassez,2016-06-21T15:29:14Z,"@evsh I don't understand what does not suit you in my answer... You say that ""portable mode"" prevents merging this request:

> Attempts to implement a full-fledged portable mode did not only improved the initial implementation, but also raised requirements quite high. And the latter complicates any efforts to merge this code into the master branch.

So you just need to remove it from here and leave only ""configuration"" part.
"
260200902,5214,Owyn,2016-11-13T17:51:27Z,"> command line

so no support for file association? 

I mean when you associate .torrent file with qbittorrent - it won't use any command lines switches, would it?
"
267768236,5214,zeule,2016-12-17T15:21:43Z,"@sledgehammer999: would you accept this PR without the very last commit? Or, better, with it, please :)"
269723495,5214,zeule,2016-12-30T02:23:12Z,@sledgehammer999 ping?
273750717,5214,zeule,2017-01-19T11:23:01Z,@sledgehammer999: ping? Don't you agree that profiles would make debugging so much simpler? 
276239559,5214,zeule,2017-01-31T00:46:39Z,@sledgehammer999 ping?
277808815,5214,zeule,2017-02-06T20:49:52Z,@sledgehammer999 ping again?
278009784,5214,sledgehammer999,2017-02-07T14:08:41Z,@evsh can you rebase? There are merge conflicts.
278022392,5214,zeule,2017-02-07T14:52:51Z,Rebased
281208553,5214,sledgehammer999,2017-02-20T23:55:50Z,"@evsh I am actively reviewing this. If you have time, rebase. I think the new rand() PR was the cause."
281209563,5214,zeule,2017-02-21T00:04:03Z,@sledgehammer999 rebased.
284270676,5214,sledgehammer999,2017-03-05T22:59:00Z,Please do a final rebase. The qt4 drop messed up 2 files.
285003113,5214,sledgehammer999,2017-03-08T10:20:43Z,@evsh any news?
285004469,5214,zeule,2017-03-08T10:26:40Z,"Oh, missed the previous message, sorry. Will rebase right away."
285009260,5214,zeule,2017-03-08T10:48:26Z,Rebased
285029000,5214,zeule,2017-03-08T12:32:49Z,"Corrected commit 11b93d6 (a few changes from commit fb79260, the next one) were mistakenly put into it (during a rebase, probably)."
285030166,5214,zeule,2017-03-08T12:38:57Z,And did it one more time.
288978192,5214,zeule,2017-03-24T09:49:36Z,@sledgehammer999: are there any news or problems?
289051552,5214,glassez,2017-03-24T15:15:23Z,"Apparently, the main problem is the lack of @sledgehammer999 free time. IMO, this is the ""bottleneck"" of the project."
293126309,5214,sledgehammer999,2017-04-11T01:47:58Z,Only the last commit remains. Will be done tomorrow when I have a non-sleepy and clear mind. I expect to find minimal problems. So @evsh if in the meantime you want to address things from the 1st commit feel free to push changes to it.
293253612,5214,zeule,2017-04-11T13:02:32Z,"> Partially true. The old code has an ifdef when creating the QSettings object. In linux it uses NativeFormat, which are ini files with .conf extension. On Windows+macOS it uses IniFormat which forces .ini as extension.

Shall I then add the same ifdef here?"
293260538,5214,sledgehammer999,2017-04-11T13:22:13Z,">Shall I then add the same ifdef here?

If you do then it won't be cross-platform as you want. (linux files won't load on Windows+macOS and vice versa)"
293264744,5214,zeule,2017-04-11T13:35:51Z,"> it won't be cross-platform as you want.

I, frankly, do not remember my intentions regarding cross-platform profiles... But if it seems possible, why not? Then we need to leave .conf extension, right?"
293278679,5214,sledgehammer999,2017-04-11T14:20:59Z,">I, frankly, do not remember my intentions regarding cross-platform profiles... But if it seems possible, why not? Then we need to leave .conf extension, right?

I don't understand why you are so against having `.ini` extension in profile case.
As for the use case, IMO it makes sense for someone to be able to transfer profiles between PCs/operating systems. Especially in the case of `--portable`."
293306948,5214,zeule,2017-04-11T15:49:01Z,"> I don't understand why you are so against having .ini extension in profile case.

No, I'm for the same extension for settings files whether they are portable profile or in the $HOME/.config. IMO, copying profiles between different OSes is less frequent operation than copying them into each other (making a portable profile default or vise versa) within the same OS. "
293333240,5214,sledgehammer999,2017-04-11T17:14:26Z,">No, I'm for the same extension for settings files whether they are portable profile or in the $HOME/.config.

IIRC, the default profile will continue to use the old ifdefs anyway. Question is what we do about the new cases?

>IMO, copying profiles between different OSes is less frequent operation than copying them into each other (making a portable profile default or vise versa) within the same OS.

I agree. But why not do portability across OSes possible too? Is it because the user can't copy those files into the default path in case of Linux? (assuming he wants to make some profile his main profile).
If that's the reason, then switch to idefs for this case too instead of hardcoding the extension."
293351739,5214,zeule,2017-04-11T18:12:28Z,"> But why not do portability across OSes possible too? Is it because the user can't copy those files into the default path in case of Linux? 

Do you mean copying `qBittorrent.ini` into `qBittorrent.conf`, which is of course possible, because both are in the same format. But is this convenient? For a user in this situation it would be convenient, perhaps, if app takes whichever file it finds, .ini or .conf. But what to do if there are two? Maybe indeed take this way and signal error if there are two configuration files in a profile?"
293375726,5214,sledgehammer999,2017-04-11T19:32:02Z,"Let me rephrase:
If we want seamless portability between OSes we need to use the same file extension for all OSes. I prefer `.ini` since this is what IniFormat uses.
The caveat of this is that the Linux users cannot interchange between their default and custom profiles manually(making a custom profile default) by just dropping the files to the correct path.
So we are left with 2 options:
1. Go ahead and use `.ini` for non-default profiles and let the linux users rename their extensions manually when they wish to interchange manually profiles.
2. Don't actually implement seamless OSes portability and use ifdefs to ensure portability only between the same type of OS. Users can still rename the necessary files manually.

I don't have any preference between those 2 options. So I leave the choice upon you. Make the choice, do any other needed changes, push and comment so I can merge this."
293377325,5214,glassez,2017-04-11T19:38:24Z,"You guys are stalled in one place. If you want to make it portable, it must have the same extension regardless of platform. It remains only to choose an .ini or .conf (it does not matter, purely subjective question).
>The caveat of this is that the Linux users cannot interchange between their default and custom profiles manually(making a custom profile default) by just dropping the files to the correct path.

Why can't linux users use the same extension for default and custom profiles? Let's use .ini everywhere! Or let's use .conf. What's the real problem here?"
293380893,5214,sledgehammer999,2017-04-11T19:52:32Z,">Why can't linux users use the same extension for default and custom profiles? Let's use .ini everywhere! Or let's use .conf. What's the real problem here?

The problem comes from the current way(before this PR) of saving. Linux uses `NativeFormat` which uses the .conf extension while the Windows+macOS use `IniFormat` which uses the .ini extension."
293381510,5214,zeule,2017-04-11T19:54:31Z,Would suggest .conf everywhere and migration to JSON later.
293387581,5214,sledgehammer999,2017-04-11T20:17:39Z,"I predict this will start going in circles and result in more delays and possibly new code to write.
So it is better(for the time being) to write `Private::CustomProfile::applicationSettings()` as:
```c++
SettingsPtr Private::CustomProfile::applicationSettings(const QString &name) const
{
    // here we force QSettings::IniFormat format always because we need it to be portable across platforms
#if defined(Q_OS_WIN) || defined(Q_OS_MAC)
    const QString settingsFileName {QDir(configLocation()).absoluteFilePath(name + QLatin1String("".ini""))};
#else
    const QString settingsFileName {QDir(configLocation()).absoluteFilePath(name + QLatin1String("".conf""))};
#endif

    return SettingsPtr(new QSettings(settingsFileName, QSettings::IniFormat));
}
```

And we can see in the future if we migrate to something universal for all configs."
293406435,5214,zeule,2017-04-11T21:32:05Z,OK
293423413,5214,zeule,2017-04-11T22:53:40Z,"All the comments were addressed, I believe. "
293427972,5214,sledgehammer999,2017-04-11T23:20:01Z,"I believe this is ready. Thank you all for the code, reviews, suggestions etc."
293428815,5214,zeule,2017-04-11T23:24:57Z,"Oh, yes! Thanks to all of you! 

Was never happier with a single merged PR before, despite I'm pretty sure that this one will require a lot of post-merge care :) "
233228922,5532,briankendall,2016-07-18T05:01:18Z,"> Having both add-started and add-paused params is bad idea. One of them is redundant.

I've replaced it with a single argument, --status=[started|paused]

Since this pull request adds some new arguments that specify a value in addition to the existing one (--webui-port), I factored out the logic for parsing them and made it a bit more flexible. These arguments can now be followed by an equal sign (=) or a space. This fixes an inconsistency in my earlier commit where --webui-port required an equal sign but the ones I added required a space.

> Here and in similar places you break coding style rule. You must insert spaces around arithmetic operators.

Damn! I was really trying to follow all of the code styling rules, but I slipped up in that one place. Hopefully I got it right this time.
"
233563224,5532,glassez,2016-07-19T08:21:22Z,"@briankendall you should squash all these commits into one (there are not so many changes to have multiple commits in the qBittorrent history). You can leave it as is now but the maintainer will ask you doing it before merging.
"
233772357,5532,briankendall,2016-07-19T21:30:21Z,"> you should squash all these commits into one

Done.
"
242787219,5532,briankendall,2016-08-26T16:43:43Z,"I just cleaned up the code style a bit more (was using curly braces for one-line if statements) and added one more command line argument for downloading first and last pieces first.
"
250798955,5532,wiiaboo,2016-09-30T17:06:52Z,"I've been using qBittorrent master with this patch for a few weeks with no issues.
I can confirm it also works with 3.3.7. Both on Windows 10 64-bit.
This is a very useful feature for use with scripts and other programs.
"
269677920,5532,briankendall,2016-12-29T19:10:29Z,"Any chance of this being merged in soon? I've been maintaining my own builds of qBittorrent for myself and a few friends that has this feature compiled in, and would love it if I didn't have to do that anymore. It's been working great for me, my aforementioned friends, and @wiiaboo."
281978908,5532,MatrixView,2017-02-23T12:27:08Z,"Please, please, please... merge this. It's been over 6 months and this solves many related requests. The patch is pretty much ESSENTIAL for automation/scripting users... "
282195432,5532,uncleungie,2017-02-24T03:38:39Z,Please merge this! It's an extremely useful feature for scripting and automation. I can't use qBittorrent without it.
284884360,5532,sledgehammer999,2017-03-07T22:41:29Z,"@briankendall I think this will conflict (source-wise) with #5214 which I currently am reviewing. I am waiting for the author to rebase.
Can you kindly watch it, and when I merge it, rebase this if needed and remind me to review it too?"
284942008,5532,briankendall,2017-03-08T04:14:03Z,"@sledgehammer999 Quite right, that will surely cause conflicts.

> Can you kindly watch it, and when I merge it, rebase this if needed and remind me to review it too?

Will do."
293479428,5532,briankendall,2017-04-12T05:42:21Z,"@sledgehammer999 Now that #5214 is merged, I've rebased using latest master. (In doing so I cleaned up the formatting for the command line usage text again -- I just can't abide poorly formatted text! 😜) Let me know if things look good or if there's further changes to be made. I'm hoping we can finally get this merged soon!"
295795767,5532,briankendall,2017-04-20T16:11:17Z,Resolved latest merge conflicts.
296170352,5532,glassez,2017-04-21T11:49:09Z,"@evsh, you recently had to deal with handling command line parameters. I think you have something to say here."
296281210,5532,briankendall,2017-04-21T19:09:39Z,"Just updated my branch. Changes include:

- `status=<started|paused>` is now `add-paused=<true|false>`
- `path` is now `save-path`
- Combined `wrapOptionText` and `wrapText` into one function
- Fixed inconsistent use of translatable strings
- Added directions for translators when using English words is necessary in the translation
- Added `TriStateBoolOption` class for implementing `add-paused`
- Added `skip-dialog` option as per @evsh 's suggestion"
296346854,5532,glassez,2017-04-22T04:33:42Z,"I have one more (apparently, late) idea.
To not pollute command line with many parameters we can have some serialized form of AddTorrentParams (e.g. JSON) and pass only one parameter (e.g. `--add-torrent-params=""<serialized_params>""`)."
296350667,5532,briankendall,2017-04-22T06:03:09Z,"@glassez No, I think that's a bad idea. It makes specifying options for adding torrents much more difficult and obtuse, and completely breaks away from the conventions of the command line. It would frustrate and confuse users for seemingly no benefit.

Besides, there's nothing wrong with having lots of command line options. The whole point of them being there in the first place is that it gives you a convenient way to specify behavior from the command line, and you can use as many or as few as you want. With this PR, qBittorrent doesn't even have a lot of options in comparison to lots of other command line tools that are used constantly."
296350833,5532,Chocobo1,2017-04-22T06:06:29Z,">Besides, there's nothing wrong with having lots of command line options. 

And I started to wonder, is qBittorrent a cmdline tool/daemon? GUI program? web interface? or a Chimera?
"
296350995,5532,briankendall,2017-04-22T06:09:25Z,"Just updated again. Changes:

- Updated `AddNewTorrentDialog` so that it works with these command line options
- Changed the behavior of all the options other than `--skip-dialog` so that they have no effect on whether the new torrent dialog opens.
- `--skip-dialog` is now a tri-state bool option"
296354256,5532,MatrixView,2017-04-22T07:18:10Z,"Hi guys, thanx for all the hard work! And even though I can't follow all your input, it seems you're really thinking this thing through.

Now, I don't want to be a party pooper, but..., can any of you tell me if these commandline options will also work if I don't specify a .torrent file, but a **.MAGNET file** (or a magnet-link)...?

As a scripting/automation person I would mostly like to use it in something similar like this:
**qBitTorrent.exe ""D:\file.magnet"" --category=""Documentary"" --save-path=""D:\Docu"" --add-paused=false --skip-dialog**

...where the D:\file.magnet (a text file) contains the magnet link(s).
"
296487951,5532,briankendall,2017-04-23T20:54:34Z,"Updated again. Fixed merge conflicts with master, and fixed the issue where specifying --first-and-last with a magnet link wouldn't work."
296488176,5532,briankendall,2017-04-23T20:58:21Z,"@MatrixView I don't think qBittorrent supports opening .magnet files like that. However, you can pass in the magnet link itself as part of the command line argument with those options, e.g.:

    qBitTorrent.exe ""magnet:..."" --category=""Documentary"" --save-path=""D:\Docu"" --add-paused=false --skip-dialog"
296491673,5532,MatrixView,2017-04-23T21:56:47Z,"Ok, thx Brian!  qBitTorrent needs .magnet files (containing the magnet link) if you've setup watchfolder(s). But a direct magnet-link will be fine in most cases too...   except for magnet-links that contain special-chars like quotes and redirects chars such as: >, <, |, &
This would break the complete input to qBT due to the OS interpreting it differently. So in that case a .magnet file would be better."
296495282,5532,briankendall,2017-04-23T23:01:00Z,@evsh I believe I've addressed everything from your review but it's still blocking merging. Can you clear that up?
296721957,5532,briankendall,2017-04-24T16:07:27Z,@evsh @glassez Just updated again to address the latest review. How're we doing now?
296746550,5532,briankendall,2017-04-24T17:03:58Z,@evsh It is done.
296751860,5532,briankendall,2017-04-24T17:14:31Z,"@evsh Whoops. Good catch, now fixed."
296806130,5532,briankendall,2017-04-24T20:02:16Z,"Updated again because I forgot to uncomment some code in `AddNewTorrentDialog`'s initializer that properly set up the ""create subfolder"" checkbox."
297104274,5532,briankendall,2017-04-25T17:24:58Z,"Okay, just updated again. *Hopefully* we're in a good state. Changes:

- Changed `m_firstLastPiecePriority` back to `m_needsToSetFirstLastPiecePriority`
- Restored `hasFirstLastPiecePriority()` back to how it was before but with one change: if there is no metadata, the value of `m_needsToSetFirstLastPiecePriority` is returned
- Moved logic for calling `setSequentialDownload` and `setFirstLastPiecePriority` out of `Session::createTorrentHandle` and into the constructor of `TorrentHandle`, with a comment explaining why it's written the way it is
- Add comment explaining need to store `sequential` and `firstLastPiecePriority` in resume data when there is no metadata

As near as I can tell, torrent resuming is working correctly again. Sequential and first/last piece priority can be properly set from the command line, and is saved and restored for magnet links without metadata, magnet links with metadata, and regular torrents.

The one slightly complicated bit I just added is the logic for calling `setSequentialDownload` and `setFirstLastPiecePriority` in the constructor of `TorrentHandle`. I put a comment explaining why I wrote it that way that I tried to make as clear and as accurate as possible. But the way it's written now is equivalent logic to how it was before, and I believe it is correct."
297129750,5532,briankendall,2017-04-25T18:52:40Z,"Updated. Changes:

- Reorganized code in `AddNewTorrentDialog` slightly so that replacements are easier to follow
- Removed default value to `parent` argument in constructor of `AddNewTorrentDialog`
- Removed defunct `hasPreviewableFile` variable in `TorrentHandle::setFirstLastPiecePriority()`"
297236531,5532,briankendall,2017-04-26T04:44:34Z,@glassez Updated to remove `m_needsToSetFirstLastPiecePriority = false;` line in `TorrentHandle::setFirstLastPiecePriority()`.
297263714,5532,zeule,2017-04-26T07:22:13Z,"> @glassez Updated to remove m_needsToSetFirstLastPiecePriority = false; line in TorrentHandle::setFirstLastPiecePriority().

Why?"
297275793,5532,glassez,2017-04-26T07:51:40Z,"@evsh, you apparently missed my comment about this. If we reach this line then torrent has its metadata and `m_needsToSetFirstLastPiecePriority` is already false."
297277225,5532,zeule,2017-04-26T07:55:25Z,"@glassez, can't understand how that can be true when we came from `handleMetadataReceivedAlert()`."
297281533,5532,glassez,2017-04-26T08:07:17Z,"Oops... My mistake.
I was confused by the fact that we have it at every function call, and must do it only once, when metadata is loaded. That is, it is more logical to do it in handleMetadataReceivedAlert."
297412621,5532,briankendall,2017-04-26T13:43:06Z,@glassez @evsh Do you want me to make any other changes regarding `m_needsToSetFirstLastPiecePriority = false;`? I think it's okay if we keep that line removed because as soon as a `TorrentHandle` has metadata we never use the flag again.
297417731,5532,zeule,2017-04-26T14:00:41Z,"@briankendall, I want that change, in order to make `m_needsToSetFirstLastPiecePriority` value correspond to the variable name and to make code intention clean at that place."
297418746,5532,briankendall,2017-04-26T14:04:17Z,"@evsh Ok, done. I also rebased to fix another merge conflict."
297447124,5532,glassez,2017-04-26T15:27:02Z,"@evsh, IMO, there are no large changes in the core and we can not wait for @sledgehammer999 approval, isn't it?"
297448407,5532,zeule,2017-04-26T15:30:15Z,He was around these days. Let's wait until tomorrow?
297448952,5532,glassez,2017-04-26T15:31:38Z,">He was around these days. Let's wait until tomorrow?

Ok."
297874290,5532,zeule,2017-04-28T00:21:56Z,"Apparently, he is not around anymore. Then we need an approval from @Chocobo1."
297943659,5532,zeule,2017-04-28T08:46:56Z,"@Chocobo1, could you review this PR, please?"
298175689,5532,briankendall,2017-04-29T15:27:50Z,@Chocobo1 Rebased and made the changes you requested
298237125,5532,briankendall,2017-04-30T14:59:23Z,@evsh Made the changes
298248199,5532,briankendall,2017-04-30T18:23:07Z,@sledgehammer999 Made the requested changes
298251479,5532,sledgehammer999,2017-04-30T19:25:17Z,Thx for PR.
298251657,5532,briankendall,2017-04-30T19:29:17Z,Hooray! 🎉👍 Thanks everyone!
298252360,5532,MatrixView,2017-04-30T19:42:22Z,Yeah!!! Thanx to all coders!  Can't wait for the release/version!
298253013,5532,zeule,2017-04-30T19:54:11Z,"Thank you, @briankendall, thanks to all the reviewers! "
293658912,6627,glassez,2017-04-12T17:58:50Z,"@magao, @mgziminsky, you are welcome.
I gave a General description above. The changes are very large, so I propose to begin not with the view diffs, but with testing. I hope for your help since I do not use these features for personal reasons so I can miss something. I tried not to change the user-visible logic, with the exception of some places (where I thought it was wrong). So I want to get from you a report what is not working as it should (differs from the existing behavior).

@sledgehammer999 approveFeature
Even though you already approved it in #6505, but it affects the GUI a bit, so I want you to look at that part. 

@evsh, @Chocobo1, @ngosang, Although, as I understand it, you are not interested in RSS, but look here too. At least you can notice any visible problems with the code."
293748994,6627,mgziminsky,2017-04-13T01:08:23Z,I'll try to test this out and review it this weekend
294007935,6627,sledgehammer999,2017-04-13T20:06:02Z,">@sledgehammer999 approveFeature
Even though you already approved it in #6505, but it affects the GUI a bit, so I want you to look at that part.

I already approved as you said. Plus as we talked recently I don't really care about the rss subsystem. So you review and merge this without me being much involved.
I see that you touch parts of session and the main gui. I'll look into them sometime tomorrow and confirm that I am ok with them."
294223396,6627,glassez,2017-04-14T19:49:44Z,"@evsh, @Chocobo1, @thalieht, I responded to your comments and corrected code."
294336404,6627,zywo,2017-04-16T06:31:36Z,"qbt crashes when removing a download rule (just after pressing OK)


[gdb.txt](https://github.com/qbittorrent/qBittorrent/files/924119/gdb.txt)
"
294494662,6627,glassez,2017-04-17T14:22:32Z,">qbt crashes when removing a download rule (just after pressing OK)

@zywo, Fixed now! Thanks."
294511200,6627,glassez,2017-04-17T15:38:04Z,"@mgziminsky, @Chocobo1, @evsh, all your comments are addressed (I hope I didn't forget something).
Rebased ot top of current master.
Waiting for your new comments...
@sledgehammer999, you promised to check some part of this too."
294672873,6627,glassez,2017-04-18T04:25:06Z,">This seems very similar to functionality from DownloadManager. What is the advantage of AsyncFileStorage over it?

I don't understand what similarity you found in these classes... They do different things. The first loads the data from the network, the second saves the data to disk.
The main AsyncFileStorage goals:
1. Storing the data asynchronously (e.g. in separate thread)
2. Do not save outdated file data if updated is available (when updated file data is ready but the outdated one is still in queue we don't append new job, we replace the old one)

And Yes, I plan to use it globally later."
294725136,6627,glassez,2017-04-18T08:18:21Z,"@evsh, I don't know whether it is your changes on the portable settings result or not, but I noticed that `specialFolderLocation(SpecialFolder::Config)` is not the same folder where application settings are stored. What do you say?
"
294725822,6627,glassez,2017-04-18T08:20:37Z,"@magao, are you able to test this PR too (since you are interested in RSS, IIRC)?"
294797821,6627,zeule,2017-04-18T11:36:41Z,">  I noticed that `specialFolderLocation(SpecialFolder::Config)` is not the same folder where application settings are stored. What do you say?

Explain, please. Don't understand what do you mean. Specifically, what do you expect and what do you get from it?"
294820319,6627,glassez,2017-04-18T12:30:59Z,">Explain, please. Don't understand what do you mean. Specifically, what do you expect and what do you get from it?

I expect it is the folder where qBittorrent.ini are stored (I can't provide you exact path since I'm far from my computer) but it really is `config` subfolder under qBittorrent data folder (where we have BT_backup etc.). If you need exact path, I can provide it later."
294845382,6627,zeule,2017-04-18T13:32:57Z,"With 3.3.12 installation, `qBittorrent.ini` is located in `%USERPROFILE%/AppData/Roaming/qBittorrent`. `Private::DefaultProfile::configLocation()` on Windows returns `Private::DefaultProfile::dataLocation()` plus `/config/`, which must be wrong. Additionally, Windows sub-path ignores configuration name. See #6651, please."
294854374,6627,sledgehammer999,2017-04-18T14:02:58Z,">I don't understand what similarity you found in these classes... They do different things. The first loads the data from the network, the second saves the data to disk.
The main AsyncFileStorage goals:
>1. Storing the data asynchronously (e.g. in separate thread)
>2. Do not save outdated file data if updated is available (when updated file data is ready but the outdated one is still in queue we don't append new job, we replace the old one)
>
>And Yes, I plan to use it globally later.

First of all I didn't look at the usage of the class. Just it's implementation. So it wasn't clear to me from where the data came from. I assumed you save something that you download. Under this light I don't understand why you don't tell the downloadhandler to save to file.
Now I see that you use the new class to store JSON(?) objects. Since I don't want to look at the whole RSS subsystem, can you describe very shortly what is the workflow? (so I can get an idea)"
294880770,6627,glassez,2017-04-18T15:25:32Z,"When the RSS feeds are updated, the AutDownoloader starts to process the Articles, applying to them the rules. Because this is done in the main thread, we don't process them all at once, and use deferred processing while the application is idle. Each time the rule matched some article we download its torrent, mark article as read and update rule matchDate. Then we store file with rules data and file with affected feed data. (This is current behavior). Since disk io is slow it's better to do it in non gui thread. The steps described above can be repeated frequently within a short period of time, so we can get updated data for some file not yet written.
This is my first approach to optimize it."
294891697,6627,sledgehammer999,2017-04-18T16:00:32Z,">When the RSS feeds are updated, the AutDownoloader starts to process the Articles, applying to them the rules. Because this is done in the main thread, we don't process them all at once, and use deferred processing while the application is idle. Each time the rule matched some article we download its torrent, mark article as read and update rule matchDate. Then we store file with rules data and file with affected feed data. (This is current behavior). Since disk io is slow it's better to do it in non gui thread. The steps described above can be repeated frequently within a short period of time, so we can get updated data for some file not yet written.
This is my first approach to optimize it.

OK. So you make AsyncFileStorage run on its own thread to do the saving...
Just a thought for the **future**(I haven't seen the whole interaction so I might be talking rubbish here): It would be interesting to use AsyncFileStorage to savefiles to disk in the `DownloadHandler` class.(which takes an argument when to saveToFile or keep in memory)"
294904173,6627,glassez,2017-04-18T16:38:43Z,">It would be interesting to use AsyncFileStorage to savefiles to disk in the DownloadHandler class.(which takes an argument when to saveToFile or keep in memory)

It makes sense to use it everywhere we need non interactive file saving. I want to do this in the future, because there are some issues associated with non-interactive save data (like what to do in case of failure, etc.). We discussed this with @evsh here, but while this is only theoretical arguments and suggestions. This topic deserves special attention."
294906916,6627,glassez,2017-04-18T16:48:01Z,"I want to simplify AsyncDataStorage by removing jobs rewriting. I want optimize the RSS classes to perform delayed data saving (like in SettingsStorage). But I want to do it in separate PR to not delay this PR merging. There are some other jobs need to be done on top of it.
@sledgehammer999?"
294908839,6627,sledgehammer999,2017-04-18T16:53:36Z,"@glassez The only think you didn't answer is if you need to put `Q_DISABLE_COPY(Session)` too.
PS: @evsh your request is blocking merge. If you're done, approve so @glassez can merge.

EDIT:
>But I want to do it in separate PR to not delay this PR merging. 

+1"
294912692,6627,zeule,2017-04-18T17:06:43Z,"I don't understand yet what is planned to do with the `AsyncFileStorage` class. Right now it looks self-inconsistent: its interface gives some error-handling hint, but implementation does not provide this opportunity. And there are two little suggestions (I'll write them right away)."
294913325,6627,glassez,2017-04-18T17:08:52Z,">The only think you didn't answer is if you need to put Q_DISABLE_COPY(Session) too.

I'll do it."
294954858,6627,sledgehammer999,2017-04-18T19:31:15Z,"One stupid question/reminder, because I don't intend to read the whole RSS code. Did you remember to cleanup the files written by `AsyncFileStorage` when they're not needed anymore?"
294959241,6627,glassez,2017-04-18T19:49:14Z,"When user remove some feed it removes associated file. All other rss files are used permanently. If you mean lock file, it is deleted in destructor."
295132388,6627,glassez,2017-04-19T07:05:43Z,">Selecting an item while viewing the ""Unread"" entries doesn't mark the article as read

It's not bug, it's a feature (at least it should be). The reason is when we select some article it immediately become read and it should be removed from unread list so we don't have time to read it actually. Although now I see that I chose the wrong approach. Why don't we mark articles as read after the user has selected a different article?"
295152606,6627,glassez,2017-04-19T08:06:17Z,"@mgziminsky, can you provide me some non-private feed urls for testing?"
295312240,6627,mgziminsky,2017-04-19T15:32:59Z,"@glassez here are a couple feeds.
https://www.nyaa.se/?page=rss
https://www.nyaa.se/?page=rss&user=64513"
295367930,6627,glassez,2017-04-19T17:58:21Z,">The alert message about download rules being disabled shouldn't resize with the rest of the dialog

I don't understand what do you mean..."
295369121,6627,glassez,2017-04-19T18:01:29Z,"@mgziminsky, I've updated the code. The issue with application crash when downloading torrent from RSS should be fixed now. Also I've changed ""read article"" behavior, as I suggested above."
295372391,6627,mgziminsky,2017-04-19T18:09:46Z,"If you disable download rules in the settings, then open the download rules dialog, there is a message at the top informing you that rules are disabled globally. If you resise the dialog, the section at the top with the message scales up as well, filling the dialog with empty space.

I'll test again when I get off work tonight."
295380833,6627,glassez,2017-04-19T18:31:42Z,">If you resise the dialog, the section at the top with the message scales up as well, filling the dialog with empty space.

OK. I realized what it was. But I'm not so familiar with GUI design, so I can't fix it. I can't understand why it works differently here and in the main window."
295528460,6627,mgziminsky,2017-04-20T01:19:14Z,"To fix the UI issue, you just need to set the vertical size policy of hsplitter to expanding. One more question about the rules dialog though. Did you disable the import/export buttons because you are planning to re-implement that feature? If not, I think it would be better to just remove them entirely. 

Other than that, I'm not seeing any more crashes and things seem to be working."
295590502,6627,glassez,2017-04-20T05:55:19Z,">To fix the UI issue, you just need to set the vertical size policy of hsplitter to expanding.

Ok. Fixed now.
>One more question about the rules dialog though. Did you disable the import/export buttons because you are planning to re-implement that feature? If not, I think it would be better to just remove them entirely.

I'll remove it before next release unless we have some other ideas about it."
295594947,6627,glassez,2017-04-20T06:17:34Z,"@mgziminsky I've pushed one more commit. Please review it.
The reason is we should add new articles in chronological order (I mean the adding process only - the article list is in reverse order as expected) to prevent wrong ignore behavior (when rule ignores more recent article)."
295595719,6627,Matth7878,2017-04-20T06:21:17Z,"Not that I use import/export feature but I think a lot of people would want it back. Besides isn't it bad to loose feature which are perceived as basic?
Once again I really don't care about this feature and I'm really glad (and grateful) to see RSS being overhauled but it should be important to know why people are using it. IMHO it's to automatically download from rules or to start downloading​ from a webui."
295612306,6627,glassez,2017-04-20T07:39:58Z,"One more thing I want to fix here (or in the following PR) is ""paranoid"" data saving policy of RSS classes (it was be in old code and I still leave it as is).

As for imports/exports... Previously, these functions were used to transfer the rules between instances of the qBittorrent (e.g. on different computer), because it is stored inside the other settings, and it was impossible to transfer them directly. Now rules are stored in a separate file and we can just copy it. So import/export in the old sense is no longer needed. Maybe this need for exchange of rules with the third-party apps..."
295783009,6627,glassez,2017-04-20T15:35:19Z,"@mgziminsky, shouldn't we mark all articles as read after AutoDownloader has it processed (regardless of whether matched any rule or not)? I think it's logical, it read them all!"
295793934,6627,mgziminsky,2017-04-20T16:06:22Z,"Good catch on the article load order.

As for marking them all read from the AutoDownloader, I think we should definitely not do that. When I set up rules, it's because there are specific entries I expect to show up in a feed. In those cases, it's desired for the rule to ""read"" the article on my behalf because I will know when they were there because they will show up in my torrent downloads. For the others, I still want to manually inspect what new entries are showing up in my feeds so that I can decide if I want to create new rules or not.

Along those lines, one feature I've been considering adding is ""ignore rules"" which would filter articles I know that I don't care about out of the feed. Then you would have the ability to only ever see ""new types"" of articles."
295804514,6627,glassez,2017-04-20T16:35:01Z,">Along those lines, one feature I've been considering adding is ""ignore rules"" which would filter articles I know I know that I don't care about out of the feed. Then you would have the ability to only ever see ""new types"" of articles.

I think it's separate job (out of this PR), isn't it?"
295826068,6627,mgziminsky,2017-04-20T17:31:28Z,"yes, definitely a separate PR, I'm not asking you to add it to this one. Once this is merged, I plan to continue where I left off with my currently open PRs, so I'll probably add it myself."
296217796,6627,glassez,2017-04-21T15:10:21Z,"@mgziminsky, I've pushed one more commit (probably the last in this PR). Please test it. If it's OK, i'll merge this PR."
296422541,6627,glassez,2017-04-23T06:19:29Z,"@evsh, Cmake build is broken now (after this PR was meged). Please fix it."
296422637,6627,glassez,2017-04-23T06:22:02Z,"@mgziminsky, @evsh, @thalieht, @zywo, @Chocobo1, thank you for your cooperation."
296422936,6627,glassez,2017-04-23T06:30:41Z,"@mgziminsky, @magao, apparently, I will oversee RSS subsystem for a while until we get a handle on ""hot"" PRs. Please make revision of all RSS PRs in terms of their relevance, and give your comments about them."
215602789,5196,Chocobo1,2016-04-29T00:43:05Z,"Add a new commit: Add SettingsStorageHelper template
"
215613890,5196,zeule,2016-04-29T02:35:17Z,"~~Could you change the last commit title, please, in accordance with the new class name?~~
Thanks
"
215614151,5196,zeule,2016-04-29T02:38:34Z,"Can I vote for merging the last commit ASAP, please? :D
"
215699841,5196,Chocobo1,2016-04-29T12:37:34Z,"PR updated.
The template usage now is flexible, the default value can be set at instantiation or when calling `operator()`.
"
215717712,5196,Chocobo1,2016-04-29T13:47:44Z,"PR updated. Thanks everyone for the suggestions. :)
Hopefully we could settle on this template version.
"
215719551,5196,zeule,2016-04-29T13:51:14Z,"> Hopefully we could settle on this template version.

I'm sorry, but could you update it one more time and add the constructor with `std::string&&` argument, please?  
"
215722911,5196,Chocobo1,2016-04-29T13:57:11Z,"> I'm sorry, but could you update it one more time and add the constructor with std::string&& argument, please?

You don't trust the compiler optimization for this case?
"
215727503,5196,glassez,2016-04-29T14:07:51Z,"> I'm sorry, but could you update it one more time and add the constructor with std::string&& argument, please? 

Stop, stop, stop!!! I have already brains boil from your pseudo-optimizations. As odd as it may seem, but the best option was using a QString:
Minus: QString stores data as UTF-16
Plus: QString don't copy its data on read-only access so we don't need any additional transformation when working with the SettingsStorage, no additional constructors, etc.
@evsh are you still going to argue that Minus is more significant than Plus here?
"
215728352,5196,zeule,2016-04-29T14:09:59Z,"`std::string` bears the same advantages.
"
215729562,5196,glassez,2016-04-29T14:13:05Z,"> std::string bears the same advantages.

These are empty words in this context.
Not you propose to add additional constructors for `std::string&&`?
How do you propose to handle `QVariantMap` with `std::string`?
"
215729954,5196,zeule,2016-04-29T14:14:11Z,"And, actually, the question is why do we index config keys using a UTF-16 string? I.e. wouldn't it be better to replace `QVariantHash` inside of the `SettingStorage` class with, say, `std::unordered_map<std::string, QVariant>` or `QHash<std::string, QVariant>`?
"
215730754,5196,zeule,2016-04-29T14:16:04Z,"> Not you propose to add additional constructors for `std::string&&`?
> How do you propose to handle `QVariantMap` with `std::string`?

Yes, it was me. What's wrong with that proposition? As to the indexing, the `QString::fromLatin1()` is super fast, see no problem here.
"
215733177,5196,zeule,2016-04-29T14:22:04Z,"@Chocobo1: 

> You don't trust the compiler optimization for this case?

Well, I do for strings. But the same can be applied to the `defaultValue` argument. A complex type might be used for it and in this case I don't trust the compiler. 
"
215734455,5196,Chocobo1,2016-04-29T14:26:21Z,"@evsh 

Now that @glassez said in https://github.com/qbittorrent/qBittorrent/pull/5196#issuecomment-215727503, I remembered this: http://doc.qt.io/qt-4.8/implicit-sharing.html

Then it should be

``` c++
const QString m_keyName;
const QVariant m_defaultValue;
```

to minimize copies and transforms, no?
"
215736683,5196,zeule,2016-04-29T14:30:58Z,"Do you plan to copy the `StorageValue` objects?
"
215738372,5196,Chocobo1,2016-04-29T14:35:51Z,"> Do you plan to copy the StorageValue objects?

why you lead to this way?
minimize copies and transforms to `SettingsStorage::loadValue` & `SettingsStorage::storeValue`, no?
"
215738719,5196,glassez,2016-04-29T14:37:09Z,"> I.e. wouldn't it be better to replace QVariantHash inside of the SettingStorage class with, say, std::unordered_map<std::string, QVariant> or QHash<std::string, QVariant>?

And what are you going to replace `QSettings`?
"
215739491,5196,glassez,2016-04-29T14:39:51Z,"> As to the indexing, the QString::fromLatin1() is super fast, see no problem here.

Isn't it creates a new object and does not copy the data into it?
Isn't it converts the data to UTF-16?
"
215739902,5196,zeule,2016-04-29T14:41:23Z,"@Chocobo1: Do you think it is the question of speed? I think no, parameter names are short, and there is a mutex lock inside of the `StorageSettings`, which kills any performance optimisations. But the memory footprint is always with you because most likely those `StorageValue` objects are long living ones (and even globals).

@glassez:

> And what are you going to replace QSettings?

Why should I?

> Isn't it creates a new object and does not copy the data into it?

Yes, but those objects are temporary ones.
"
215750121,5196,Chocobo1,2016-04-29T15:15:22Z,"@evsh 

> I.e. wouldn't it be better to replace QVariantHash inside of the SettingStorage class with, say, std::unordered_map<std::string, QVariant> or QHash<std::string, QVariant>?

but changes like that is out of the scope of this PR.

IMO, `StorableValue` should just follow the types used by `SettingsStorage`, it's just a wrapper (whatever you call it) around it.
 you can open another PR to change `QString` to `std::string` everywhere.

## 

@glassez 
I'm inclined to revert back to this, what do you think?

``` c++
const QString m_keyName;
const QVariant m_defaultValue;
```
"
215750910,5196,zeule,2016-04-29T15:17:11Z,"I've lost the battle, I'll go and drink a poison...
"
215757507,5196,glassez,2016-04-29T15:28:52Z,"> Yes, but those objects are temporary ones.

@evsh So, you're trying to save a few bytes at the cost of constant data conversion/copying and temporary objects creating/deleting.

> IMO, StorableValue should just follow the types used by SettingsStorage, it's just a wrapper (whatever you call it) around it.

Exactly!

> I'm inclined to revert back to this, what do you think?

Agree.

> you can open another PR to change QString to std::string everywhere.

I do not think that the widespread use of `std::string` in Qt-based poroject will be useful.

> I've lost the battle, I'll go and drink a poison

@evsh You once again wanted to go through the back door... If you don't like how something is implemented, report it, open Issue or PR. But don't try to change it by proxy. It doesn't lead to anything good in most cases.
"
215793130,5196,Chocobo1,2016-04-29T16:25:21Z,"PR updated.
"
215955025,5196,Chocobo1,2016-04-30T10:58:30Z,"PR updated:
- Switch to modeless dialog
- Don't close dialog after creating torrent, lessens the pain of creating a large number of torrents.
- Show progress bar all the time
"
215968357,5196,zeule,2016-04-30T14:15:53Z,"> @evsh You once again wanted to go through the back door... If you don't like how something is implemented, report it, open Issue or PR. But don't try to change it by proxy. It doesn't lead to anything good in most cases.

A reviewing process is such an ""editing by a proxy"" (as you called it) to a great extent. I don't want to raise the discussion again, but  isn't it natural that design flaws get uncovered by a future usage? The same is probably right in this case: miswording in the `SessionStorage` class was uncovered by the class, created by @Chocobo1. The miswording is that the setting key is not a text string but a string literal, with the single operation only (comparison). 
"
215987985,5196,glassez,2016-04-30T19:11:12Z,"@evsh I just wanted to say that you should not try to solve such uncovered problems along the way. After all, neither you, nor current PR author, has a holistic view about how to do it.
"
217626258,5196,ngosang,2016-05-07T10:08:18Z,"![](https://i.imgur.com/8u3p4uE.png)
"
217641042,5196,Chocobo1,2016-05-07T14:28:50Z,"@ngosang 
Thanks for testing! I have pushed a commit trying to fix it, can you test again?
"
217642611,5196,ngosang,2016-05-07T14:57:33Z,">  I have pushed a commit trying to fix it, can you test again?

Not fixed.
"
217646216,5196,Chocobo1,2016-05-07T15:48:04Z,"> Not fixed.

Can you drop the ""Enlarge combobox to fix its contents"" commit and then try the increasing the vaule of `minimumContentsLength` property of QCombobox. Try find out what is the lowest value that will work.
"
217662131,5196,ngosang,2016-05-07T19:03:50Z,"> Try find out what is the lowest value that will work.

```
          <property name=""minimumContentsLength"">
           <number>7</number>
          </property>
```
"
217711336,5196,Chocobo1,2016-05-08T11:51:14Z,"@ngosang 
Thanks! I've changed the value as your suggestion.
"
217747511,5196,sledgehammer999,2016-05-08T21:33:42Z,"I made a random and quick look. The changes are substantial in terms of quantity. Maybe tomorrow I'll review.
Out of curiosity what is the purpose of `StorableValue`? I'll understand when Iread the source carefully, but I now I am very curious on its purpose.
"
217772759,5196,Chocobo1,2016-05-09T04:16:16Z,"> Out of curiosity what is the purpose of StorableValue? I'll understand when Iread the source carefully, but I now I am very curious on its purpose.

In short, `StorableValue` is a small helper class wrapped around `SettingsStorage`, it save us from typing the same boilerplate code again and again. 
In most cases, when we want to save/load a setting, we shouldn't need to access `SettingsStorage` directly (it's too powerful for most cases and also too cumbersome to use), so there is a weaker `StorableValue` which simplifies the operations.
"
221784461,5196,glassez,2016-05-26T05:57:19Z,"@Chocobo1 My most recent efforts to optimize access to the settings led me to the idea that we need a class like your StorableValue, but in a somewhat different form:

``` c++
template <typename T>
class SettingValue
{
public:
    explicit SettingValue(const QString &keyName, const T &defaultValue = T())
        : m_keyName(keyName)
        , m_value(SettingsStorage::instance()->loadValue(m_keyName, defaultValue).template value<T>())
    {
    }

    SettingValue<T> &operator=(const T &newValue)
    {
        m_value = newValue;
        SettingsStorage::instance()->storeValue(m_keyName, newValue);
        return *this;
    }

    operator T() const
    {
        return m_value;
    }

private:
    const QString m_keyName;
    T m_value;
};
```

This allows to avoid real access to SettingsStorage when reading.

UPD: template is fixed to have correct `operator=`.
"
221794871,5196,Chocobo1,2016-05-26T07:12:34Z,"> This allows to avoid real access to SettingsStorage when reading.

Looking from your code, that is a write-through cache.
And seems your code is not compatible with `StorableValue`, but I'm sure you can add another template (maybe called `StorableCache`?) for your need.
"
221806962,5196,glassez,2016-05-26T08:17:43Z,"> And seems your code is not compatible with StorableValue,

Well, why not? It can be used for the same purposes but it is more effective. It hasn't only one method (which is still logically incorrect, as I said earlier).

> but I'm sure you can add another template (maybe called StorableCache?) for your need.

I offer it not as addition but as a replacement.
Why are you opposed to it?
"
221833797,5196,Chocobo1,2016-05-26T10:21:13Z,"> Why are you opposed to it?

I because I need a way to specify (bind) default value at runtime: https://github.com/Chocobo1/qBittorrent/blob/a53560d3c628bb548cfe4920548dd03990a23744/src/gui/torrentcreatordlg.cpp#L265

If this obstacle is cleared, I no more oppose to the replacement.
"
221837555,5196,glassez,2016-05-26T10:41:35Z,"> because I need a way to specify (bind) default value at runtime

Describe, why don't you do it in constructor?
"
221850535,5196,Chocobo1,2016-05-26T11:53:46Z,"> Describe, why don't you do it in constructor?

I will if it's possible. IIRC `QWidget::size()` returns an unrealistic value ~~when the widget is not showing on screen.~~ before `ui->setupUi(this);` statement.
"
221851465,5196,glassez,2016-05-26T11:58:52Z,"> IIRC  QWidget::size()  returns an invalid value when the widget is not showing on screen.

But you call size() before show() now.
"
221858484,5196,Chocobo1,2016-05-26T12:35:40Z,"> But you call size() before show() now.

Oops, I mean `QWidget::size()` returns an unrealistic value before `ui->setupUi(this);` statement.
I got `QSize(100, 30)` before the statement and `QSize(592, 658)` after it.
"
221867140,5196,glassez,2016-05-26T13:15:30Z,"> Oops, I mean `QWidget::size()` returns an unrealistic value before `ui->setupUi(this);` statement.

Then we really cannot assign default size in constructor.
But this case can be called an exception. We can do this with checking (assuming we use my template form):

``` c++
if (static_cast<QSize>(m_storeDialogSize).isValid())
    resize(m_storeDialogSize);
```
"
221915502,5196,Chocobo1,2016-05-26T16:01:28Z,"@glassez 

> But this case can be called an exception. We can do this with checking (assuming we use my template form):

That defeats all the convenient it originally had.

I've push a new commit, it utilizes template specialization.
IMO the code looks great and it handles your need, although it's a bit overkill !?
"
221917870,5196,zeule,2016-05-26T16:09:46Z,"My 2 cents: why did you implement that as template specialisation? As to me, here we have a regular class hierarchy: base storable value, storable value with the default, storable value with function.
"
221920337,5196,Chocobo1,2016-05-26T16:18:32Z,"@evsh 
I dunno. But isn't doing that will end up having 2 classes?
2 class (names/types) just because parameter types are different is.. maybe a bit too much?
Or it's just I don't know how to properly construct it :p
"
221921034,5196,zeule,2016-05-26T16:20:59Z,">  ...here we have a regular class hierarchy...

A bonus: we might add another `StorableValue` which calls `SettingsStorage::storeValue()` in its destructor, something like `shared_ptr` provides a clean function.
"
221923591,5196,glassez,2016-05-26T16:29:39Z,"> A bonus: we might add another StorableValue which calls SettingsStorage::storeValue() in its destructor, something like shared_ptr provides a clean function.

Why we need it?
We need store settings regularly.
"
221925008,5196,glassez,2016-05-26T16:35:10Z,"> That defeats all the convenient it originally had.

???
So you've created this monster (I mean your template specializations), not to write occasionally two lines of code instead of one?

> although it's a bit overkill !?

a bit???
We have different ideas about convenience.
"
221927658,5196,Chocobo1,2016-05-26T16:45:22Z,"> not to write occasionally two lines of code instead of one?
> We have different ideas about convenience.

That code in https://github.com/qbittorrent/qBittorrent/pull/5196#issuecomment-221867140 will appear everywhere if we want to store a widget size. Its 2 lines of code now, but not when `StorableValue` is deployed in UI widget classes.

I can't think it's wrong to bind a function at instantiation and only call it when you really need it.
The only difference of the 2 specializations is that one binds to a value, the other one a function (but eval it later), simple!
"
221929047,5196,glassez,2016-05-26T16:50:47Z,"> The only difference of the 2 specializations is that one binds to a value, the other one a function (but eval it later), simple!

Really?
One is used to avoid repeated read via mutex locking. The second is used to avoid typing some characters.
"
221931486,5196,zeule,2016-05-26T17:00:20Z,"I just want to remind that the original ~~problem~~ task was to avoid some typing.
"
221932562,5196,glassez,2016-05-26T17:04:23Z,"> I just want to remind that the original problem was to avoid some typing.

Ok. Let's compare the following:
Old way:

``` c++
const QString KEY_DIMENSION = SETTINGS_KEY(""Dimension"");
SettingsStorage::instance()->storeValue(KEY_DIMENSION, size());
resize(SettingsStorage::instance()->loadValue(KEY_DIMENSION, size()).toQSize());
```

@Chocobo1 new way:

``` c++
StorableValue<QSize, QSize()> m_storeDialogSize;
m_storeDialogSize(SETTINGS_KEY(""Dimension""), [this]{ return this->size(); })
m_storeDialogSize = size();
resize(m_storeDialogSize);
```

My new way:

``` c++
StorableValue<QSize> m_storeDialogSize;
m_storeDialogSize(SETTINGS_KEY(""Dimension""))
m_storeDialogSize = size();
if (static_cast<QSize>(m_storeDialogSize).isValid())
    resize(m_storeDialogSize);
```

The difference is small. Want to count the characters?
"
221934036,5196,Chocobo1,2016-05-26T17:10:16Z,"I really don't know why you think it's not appropriate... the current version we both get what we wanted.
Could you please list out the downsides?
"
221935725,5196,zeule,2016-05-26T17:16:59Z,"> Let's compare the following:

Number 2 is the most readable, number 3 is the ugliest. Number 1 is OK. The only problem of the number 2 is the repetition of the type in the template parameters list.
"
221937326,5196,glassez,2016-05-26T17:22:52Z,"> number 3 is the ugliest

Number 3 in common case (if it is not about the size of the widget):

``` c++
StorableValue<int> m_storeTest;
m_storeTest(SETTINGS_KEY(""Test""), 25)
m_storeDialogSize = 33;
var = m_storeTest;
```

> Number 1 is OK.

We may use it instead of 2 in such extra cases.
"
221938257,5196,glassez,2016-05-26T17:26:32Z,"> the repetition of the type in the template parameters list

It's really redundant. We can use:

``` c++
StorableValue(const QString &keyName, const std::function<T ()> &defaultFunc);
```

I apparently wrote it incorrectly. But the point, I think, is clear.
"
221939768,5196,zeule,2016-05-26T17:32:35Z,"It does not look any better because the type of the second parameter can be easily deduced and thus it is a repetition still.
"
221940450,5196,glassez,2016-05-26T17:35:15Z,"> It does not look any better because the type of the second parameter can be easily deduced and thus it is a repetition still.

What's the second parameter in my example?

``` c++
template <typename T>
class StorableValue
{
    StorableValue(const QString &keyName, const std::function<T ()> &defaultFunc);
    // ... and so on
```
"
221943677,5196,zeule,2016-05-26T17:47:17Z,"Can't understand how do you want to get different class layouts for the cases with default value and default func. I would use true different second parameter and `is_callable` type trait.
"
221944860,5196,glassez,2016-05-26T17:51:41Z,"> Can't understand how do you want to get different class layouts for the cases with default value and default func. I would use true different second parameter and is_callable type trait.

Honestly, I never thought about it. As you can understand, I don't like it at all.
"
221951409,5196,Chocobo1,2016-05-26T18:16:13Z,"> I would use true different second parameter and is_callable type trait.

Just curious, can you provide some example?
"
222003501,5196,zeule,2016-05-26T21:42:42Z,"Here is what I meant:

``` C++
#include <type_traits>

template<class F, class ... Args>
struct is_callable {
    template<class U> static auto test(U* p)->decltype((*p)(std::declval<Args>() ...), void(), std::true_type());
    template<class U> static auto test(...)->decltype(std::false_type());

    static constexpr bool value = decltype(test<F>(0))::value;
};

template <class Value, class Default>
class StorableValue {
public:
    StorableValue(Value v, Default d)
        : value_(v)
        , default_(d) {
    }

    Value operator()() const {
        return defaultValue<Default>();
    }

private:
    template <class T>
    typename std::enable_if<is_callable<T>::value, Value>::type defaultValue() const {
        return default_();
    }

    template <class T>
    typename std::enable_if<!is_callable<T>::value, Value>::type defaultValue() const {
        return default_;
    }

    Value value_;
    Default default_;
};
```

but I forgot that you need to declare not only local variables, which can be auto typed, but class members too. Sorry for the noise. To make that work you need a member with virtual function; The virtual call will be optimised out by the compiler, of course, but the class would become not light-weigh anyway.
"
222053726,5196,glassez,2016-05-27T03:47:31Z,"Anyway it's better to have two templates instead of your specializations to show its different behavior in client code: StorableValue and CachedStorableValue.
"
222056583,5196,glassez,2016-05-27T04:17:33Z,"And based on my comment above you can leave your previous template definition (with `operator()`). You need only to fix `operator=`.
"
222070721,5196,Chocobo1,2016-05-27T06:32:10Z,"> Anyway it's better to have two templates instead of your specializations to show its different behavior in client code: StorableValue and CachedStorableValue.

I'll drop the specialization commit and I'll leave the `CachedStorableValue` for you to add.

> And based on my comment above you can leave your previous template definition (with operator()). You need only to fix operator=.

If you mean the extra space should be removed, fixed now.

PR updated.
"
222074055,5196,glassez,2016-05-27T06:56:38Z,"> I'll leave the CachedStorableValue for you to add.

Ok.
"
222074067,5196,Chocobo1,2016-05-27T06:56:43Z,"@evsh 
Thanks for the full example! It's interesting.
"
222078149,5196,zeule,2016-05-27T07:22:36Z,"You are always welcome.
"
222081278,5196,glassez,2016-05-27T07:41:07Z,"> You are always welcome.

@evsh Using this (and my) template around qBittorrent classes we get many of the identical instances in different compilation units, isn't it?
So, can we optimize it having common preinstantiated classes for some usual types (int, QString, etc.) using `extern template`?
"
222085014,5196,zeule,2016-05-27T08:01:25Z,"Of course one can put common instantiations somewhere, for example in `settingstorage.cpp`. What's the question? However, the template is so small, that the impact on compilation time should not be significant, right?
"
222087768,5196,glassez,2016-05-27T08:16:35Z,"> However, the template is so small, that the impact on compilation time should not be significant, right?

I'm not worried about compilation time. I thought about their size. But really, it's too small.
"
222088754,5196,Chocobo1,2016-05-27T08:21:26Z,"> I'm not worried about compilation time. I thought about their size. But really, it's too small.

I guess small enough for compiler to consider inline it.
"
222089093,5196,zeule,2016-05-27T08:23:17Z,"Duplicates are removed by linker.
"
222089663,5196,glassez,2016-05-27T08:25:58Z,"> Duplicates are removed by linker.

Then what's the point of `extern template`? Why it was added in c++11? (it's always confused me)
"
222131425,5196,zeule,2016-05-27T12:15:08Z,"> Then what's the point of extern template? Why it was added in c++11? (it's always confused me).

This is all about compilation time. A compiler can generate function names for a template in the same way as it does for any declaration, and expect them to be found by a linker. That's the idea. You may read some details [here](https://gcc.gnu.org/onlinedocs/gcc/Template-Instantiation.html) and google for inlining functions across compile units and other link time optimisations (including code generation).
"
287140641,5196,Chocobo1,2017-03-16T17:56:41Z,"@sledgehammer999 
do you mind review this PR, I think it's settled down after a longgg discussion."
301295237,5196,Chocobo1,2017-05-14T07:07:09Z,All comments are addressed.
303611391,5196,Chocobo1,2017-05-24T03:59:49Z,"@glassez @evsh 
Conflict resolved, please re-approve this, I'm ready to merge it."
303672415,5196,Chocobo1,2017-05-24T09:40:25Z,Thanks everyone!
222359122,5287,masca90020,2016-05-29T12:54:21Z,"It can also have ( if it has already, then disregard this message ) the function to check the name for proper/repack and only re-download the same episode number in that situation ? If proper or repack aren't present, then ignore any releases with the same episode number. Thx very much for this hard work.  
"
223003304,5287,ngosang,2016-06-01T14:07:30Z,"@elFarto this PR will be reviewed but it can take time. Please be patient.
"
223237323,5287,elFarto,2016-06-02T09:10:33Z,"I've added in support for repack/proper. The implementation isn't ideal as the rule only gets to see one article at a time, so if both the original and a repack/proper article both exist, both will be downloaded. This isn't too bad, as there will be cases where this happens anyway.
"
223350047,5287,masca90020,2016-06-02T16:42:49Z,"Thanks very much for this, your work is highly appreciated. 
"
225073028,5287,mgziminsky,2016-06-10T01:33:57Z,"When this gets merged, I will also need to update PR #5195 to import this setting from uTorrent
"
226734819,5287,DrKittens,2016-06-17T10:22:29Z,">  It checks the filter name against the article name in the RSS feed, then attempts to pull the episode number out of the name and checks that against a list of previously downloaded files.
> 
> There's currently no way to clear the downloaded episode number other than deleting the filter and re-adding it.

Couldnt you actually store the matched episodes to a physical file for persistancy, this would allow the user to just remove/modify matched entries there as needed.
"
226736113,5287,elFarto,2016-06-17T10:29:31Z,"> Couldnt you actually store the matched episodes to a physical file for persistancy, this would allow the user to just remove/modify matched entries there as needed.

The matched episodes are stored with the filter, so they're persisted in the settings file, where ever that is.

There does need to be a UI for removing episodes, I'm not just sure where that should live or should look like at the moment.
"
255299124,5287,briankendall,2016-10-21T05:47:38Z,"I'm going to give this feature a try. Can you explain what the ""Episode Filter"" field is for? Quickly glancing through your commits it doesn't seem to do anything when ""Use Smart Episode Filter"" is checked, but I just wanted to double check.

Also, when I turn on ""Use Smart Episode Filter"" for an RSS downloader rule, any items listed in the ""Matching RSS Articles"" list disappear. Is this expected? It makes me thing that my rule is no longer going to match anything.
"
255307647,5287,elFarto,2016-10-21T06:51:38Z,"The episode filter is existing functionality within qBittorrent not something I added, but it is used to filter which seasons and/or episode you wish to download. It should work with the Smart Filter, but it's been a while since I looked at the code.

If there is nothing in the matching articles list, then it won't download anything. The Smart Filter uses the _filter_ name as the show name to match, so ensure that's correct. If it still doesn't show up, try removing everything from the Must Contain field (that should really only contain the format/resolution you want to download).
"
255411855,5287,briankendall,2016-10-21T15:41:48Z,"@elFarto Okay, I see why this isn't working for me. The regex you're using to match the show name and episode number is too specific, and doesn't allow any customization to better match whichever RSS feed it's being applied to.

For example, my RSS feed contains listings like this:

```
Show Title (2016) - S01E01 [ 2016 ] [ MKV | H.264 | HDTV | 720p | Scene ] [ Uploader: Some person ] [ Show.Title.2016.S01E01.7200p.HDTV.h264-XYZ ]
```

Since the regex is looking for a something like ""Show.Title.S01E01"" complete with the periods, in that specific order, the first capture group ends up matching ""Show Title (2016) - S01E01 [ 2016 ] [ MKV | H.264 | HDTV | 720p | Scene ] [ Uploader: Some person ] [ Show.Title.2016."" so that string is essentially what it thinks the show title should be. Obviously that doesn't work for me!

I think for this to work properly, I suggest:
1. This shouldn't use the filter / rule name as the search parameter. In keeping with general UI conventions, the filter name is supposed to be used for the user's own organization of different shows and should not have any effect on the filter itself.
2. It should make use the ""Must contain"", ""Must not contain"", and ""Episode Filter"" fields in the same way that a regular filter would. I don't really see any reason not to, and I foresee it being confusing to users if it doesn't. It was already confusing for me!
3. For the ""Smart Episode Filter"" feature, it should just try to extract the episode number from where it can in the article's title. No need to try and discover the show name. Just leave that up to the user as they define it in the ""Must Contain"" field, just like they do for regular filters. Each filter keeps track of its own downloaded episodes so that should work fine.
4. Expand the regex to include shows that don't use the S##E## format. For example, some shows use the airdate as the episode identifier, commonly in the form YYYY.MM.DD.
5. You've already mentioned the need for this, but add in a button to clear the list of downloaded episodes. Not as essential, but would certainly be convenient. I recommend it becoming enabled only when the ""Smart Episode Filter"" checkbox is checked, and when clicked it presents an ""Are you sure? Yes / No"" dialog box to make sure the user doesn't clear their downloaded episodes by accident.

Given this is a feature I'd really like to have in qBittorrent (as my RSS downloader rules constantly download duplicate episodes) I'd be happy to contribute and make these changes. However I'm not sure if there's a good way to contribute to someone else's pull request, assuming you'd even be open to that.
"
268508363,5287,elFarto,2016-12-21T12:11:35Z,"@briankendall Thanks for your comment, and I apologise for taking so long to reply. You're absolutely correct, I built the smart filter based on my own requirements, and didn't consider what other people would need.

I've done some work to the patch, and I think this version is much more flexible. It also has the ability to clear the downloaded episode list (right click on the rule).

The only thing left really, is to upgrade the old episode filter to support other episode number formats (1x01 and YYYY.MM.DD), but that's separate from the the smart filter. I think I need to implement this in the web UI aswell, but I haven't looked into that yet."
275662118,5287,Bert02,2017-01-27T13:12:21Z,"is this in the stable release or do i require a different release?
if its in the stable how do i go about using it? i couldn't find much information about it"
275681522,5287,thalieht,2017-01-27T14:46:35Z,"It's suggested code, not merged yet, you can't find it anywhere for now."
277433315,5287,elFarto,2017-02-04T10:10:26Z,I've updated the patch so that it applies cleaning again.
277711063,5287,sledgehammer999,2017-02-06T15:10:31Z,"@elFarto do you know what `git rebase -i` does and what `fixup` means in that context? If yes, then please fixup any commits that fix previous commits of yours. (and rename commit message if required). It will make it cleaner for me to review.
I want to start reviewing this too, since I do a lot of RSS reviewing of @magao's commits already.
@magao do you have any comments for this PR?"
277798784,5287,magao,2017-02-06T20:11:12Z,"@sledgehammer999 I've never really understood what is desired from a ""smart"" RSS filter. I personally manage all my torrents manually - I use the filters to add them paused, then I go through, select the ones I want and manually change my episode filter.

I figure it's most likely used by people who want torrents to auto-download without any user intervention. Has never been an option for me since I've always had limited data caps ...

I'd offer to review from a coding PoV, but as you've seen in my PRs I'm still a bit rusty with C++ (and still working out this whole Qt thing ;)"
277805605,5287,sledgehammer999,2017-02-06T20:37:18Z,">I'd offer to review from a coding PoV, but as you've seen in my PRs I'm still a bit rusty with C++ (and still working out this whole Qt thing ;)

I understand. Don't worry. Do what you can. It isn't necessary to review this ""again"". A lot of core devs have already done it. So I'll go through it just to make sure it is mergable/working/etc."
277812146,5287,elFarto,2017-02-06T21:02:02Z,"@sledgehammer999 I've tidied up the commits (I've been avoiding it as I'm not that familiar with Git). The last commit is a bit unrelated, but I ended up needing it while testing, so seems silly to just throw it away."
277812960,5287,XhmikosR,2017-02-06T21:04:59Z,"I've been following this PR for a long time since this is the only feature
I'm missing to switch to qBitorrent. Will this PR work properly with proper
repack and so on releases?

Also I'd like to thank you for this patch. This is what open source is
about :)

On Feb 6, 2017 23:02, ""Stephen Dawkins"" <notifications@github.com> wrote:

> @sledgehammer999 <https://github.com/sledgehammer999> I've tidied up the
> commits (I've been avoiding it as I'm not that familiar with Git). The last
> commit is a bit unrelated, but I ended up needing it while testing, so
> seems silly to just throw it away.
>
> —
> You are receiving this because you are subscribed to this thread.
> Reply to this email directly, view it on GitHub
> <https://github.com/qbittorrent/qBittorrent/pull/5287#issuecomment-277812146>,
> or mute the thread
> <https://github.com/notifications/unsubscribe-auth/AAVVtUfdgl6Q_gN04ArFAkE9yRwTxMpWks5rZ4pOgaJpZM4Ij_vg>
> .
>
"
277816731,5287,elFarto,2017-02-06T21:19:23Z,"@XhmikosR Currently, REPACK and PROPER releases are always downloaded, regardless if the episode has been downloaded before. I'm not sure if we want that, or if we want to limit it some how, but it's something that can be tweaked later on."
277817434,5287,XhmikosR,2017-02-06T21:21:57Z,"I believe that's the right solution so it covers my needs at least.

Thanks !

On Feb 6, 2017 23:19, ""Stephen Dawkins"" <notifications@github.com> wrote:

> @XhmikosR <https://github.com/XhmikosR> Currently, REPACK and PROPER
> releases are always downloaded, regardless if the episode has been
> downloaded before. I'm not sure if we want that, or if we want to limit it
> some how, but it's something that can be tweaked later on.
>
> —
> You are receiving this because you were mentioned.
> Reply to this email directly, view it on GitHub
> <https://github.com/qbittorrent/qBittorrent/pull/5287#issuecomment-277816731>,
> or mute the thread
> <https://github.com/notifications/unsubscribe-auth/AAVVtRYLQ1Ix--w68IHXhEG0nRuGplurks5rZ45fgaJpZM4Ij_vg>
> .
>
"
277902961,5287,briankendall,2017-02-07T05:06:59Z,">  I've never really understood what is desired from a ""smart"" RSS filter... I figure it's most likely used by people who want torrents to auto-download without any user intervention.

@magao This is correct. The specific problem this tries to solve is for RSS feeds that may list multiple versions of the same episode of a show. qBittorrent already has some options to try and work around that (for example, the option for waiting a certain number of days before downloading the next match) but it's quite prone to error, as sometimes feeds don't list episodes at predictable times, and occasionally a listing will be for a bad torrent that will later be replaced by a good one labeled as ""REPACK"" or ""PROPER""."
277904000,5287,briankendall,2017-02-07T05:15:54Z,"@elFarto This update to the feature looks good. I'm going to test it out again and report back!

Just from looking at the code, there's two very minor things I think would be good chances to make:

1. Change the `QRegExp` instance that's used to find the episode number to be case insensitive. i.e. change line 157 of `rssdownloadrule.cpp` to: `QRegExp f(episodeRegex, Qt::CaseInsensitive);`

    edit: Making it case insensitive would also require changing `computeEpisodeName()` to be case insensitive as well. I recommend adding something like `matchedEpisode = matchedEpisode.toLower();` to the top of the function and then changing all of the conditionals to use lowercase letters, so the first if statement becomes `if (matchedEpisode.startsWith('s'))` and `QRegExp r(""S(\\d+)E(\\d+)"");` becomes `QRegExp r(""s(\\d+)e(\\d+)"");`.

2. Consider changing the regex itself to allow the episode number group to be at either the beginning or end of the string. Right now it has to be bordered by a non-alphanumeric character and there's always that small chance that someone will have an RSS feed that begins or ends with the episode number. So specifically I'm recommending replacing line 43 of `rssdownloadrule.cpp` to:

       const QString episodeRegex = ""(?:^|[^A-Za-z0-9])((?:S\\d{1,}(?:E\\d{1,})+)|(?:\\d{1,}x\\d{1,})|(?:\\d{4}\\.\\d{2}\\.\\d{2}))(?:[^A-Za-z0-9]|$)"";

    ...which I think accomplishes what I'm suggesting.

Like I said, these are quite minor, and I think the feature will work fine without them. I just always am trying to look out for those few edge cases that'll snag a small minority of users. 😉"
278013773,5287,sledgehammer999,2017-02-07T14:22:55Z,I haven't concluded my review. You can go ahead and implement other people's suggestions in the meantime.
278459174,5287,sledgehammer999,2017-02-08T20:57:11Z,"@elFarto a bit offtopic: When other reviews stop coming in, feel free to squash/fixup commits into their respective ones. And when I find time I'll do the final review+merge. (I keep this open in a tab)"
284041933,5287,elFarto,2017-03-03T19:05:55Z,"Rebased to master, and it appears to have passed all the checks this time, not sure why it failed last time."
292577298,5287,masca90020,2017-04-07T16:00:58Z,"Hi guys, 

Being the one that started this request, I feel I should ask if this is ever gonna see the light of day. Almost a year now. :) Ty again for all your hard work."
292583962,5287,briankendall,2017-04-07T16:26:51Z,"There's a big backlog of pull requests now. I've got one from last summer that's still unmerged, and it's waiting on another pull request so I can rebase it before it's ready to be merged."
297812327,5287,elFarto,2017-04-27T19:16:21Z,"Rebased to master, hopefully nothing broke due to the large RSS refactoring that's gone on."
302857730,5287,elFarto,2017-05-20T07:48:01Z,New version of the patch. I've removed the Mark all unread feature as I'm not sure I fully understand how that should work.
303942134,5287,elFarto,2017-05-25T07:19:54Z,"New version of the patch. Not sure about that suggested change to remove the duplicate call to computeEpisodeName, I've left a comment on it, but for some reason it's not showing up on this page, only the View changes page."
305967355,5287,elFarto,2017-06-03T10:47:44Z,New version with the reworked last match code. Also rebased to master.
316559281,5287,YEGrolo,2017-07-20T00:15:58Z,"Did this make the new 3.3.14 build, I don't see any differences"
318839044,5287,glassez,2017-07-29T15:41:19Z,"@evsh, @Chocobo1, what do we do with this?"
318843758,5287,Chocobo1,2017-07-29T16:56:18Z,">@evsh, @Chocobo1, what do we do with this?

I have no tendency for it.
But seems many users are expecting it. If you guys approve it, I've no problem with it."
318844623,5287,glassez,2017-07-29T17:09:00Z,">I have no tendency for it.

+1
I still don't like how this is implemented in some places, but I don't have time now to deal with it (and I do not want do it since I too spent a lot of time on this not interesting to me personally feature - I mean the RSS as a whole).
So we lack only @evsh review..."
318909286,5287,zeule,2017-07-30T15:29:17Z,"My concerns are explained somewhere above: the hard-coded set of regular expressions is suitable for a local patch, but,IMO, is not a good choice for all when this set of rules is non-extensible and opaque."
318948990,5287,LordNyriox,2017-07-31T01:59:32Z,"@evsh, @glassez:  

> the hard-coded set of regular expressions is suitable for a local patch, but,IMO, is not a good choice for all 

That design bothers me as well.  

The way I see it, those Regex codes could be the ""default"" for the smart filter feature, but there should be a `Smart Filter Options` menu to allow users to change the Regex used.  

I do not know how this feature currently looks in the GUI (no one has posted any screenshots)—but the way I imagine it, would be a checkbox in RSS reading ""Use smart episode filters"", and beside that an `Edit filters` button.  

Clicking the button would open a window showing a list of the filters, with the columns: ""Enabled"" (clickable checkbox), ""Name"" (display name for the filter), ""Regex"" (the Regex used for the filter), and ""Finds"" (what the given Regex will output).  Every column (except ""Finds"") would be user-editable for each entry.  

Ideally, there should also be dialog buttons for ""Adding"" an entry and ""Reverting"" to default filters somewhere in this window.  

Well, that is my two pennies on the subject.  ;/  



"
319025523,5287,elFarto,2017-07-31T10:08:05Z,"I can understand some hesitance about the hard coded rules, however it does seem like you're letting perfection stand in the way of progress. Yes hard coded rules are bad, but they should cover the common cases. If they don't cover the user's case, then they're no worse off that they are now. The formats that it does accept are documented in the tooltip, so I wouldn't call them opaque.

Also the demand for configurable regex's for episode matching is unknown, and cannot be known until this feature is available to users. Making the regex's configurable is no easy task, given that the actual numbers much be extracted an logic performed on them.

I always considered this a first version and to improve it would require feedback from regular users given the sheer variety of RSS feeds."
319088077,5287,briankendall,2017-07-31T14:42:49Z,"As someone who is using this feature, I can say that I don't need an option for specifying custom regex filters. This feature serves a very specific purpose -- making sure you don't download TV episodes that have been downloaded already -- so there's only a couple of patterns that I and most other people would ever need matched. We had a discussion about what they are earlier in this PR's comments.

Having the ability to specify custom ones would be nice in some regards, but it's also very much a power user feature and easily prone to error. Personally I'd rather have the right set of episode filters built in and not have to worry about writing my own, because without having some complicated UI that lets me test my new regex filter based off of many existing episode titles in order to make sure it worked exactly as intended, I'd be very concerned that I somehow messed up the regex and that the smart episode filter isn't going to work. I've had issues like that specifying regexs in other software.

Basically, I like the feature the way it is now. It's simple and works as intended."
319845746,5287,YEGrolo,2017-08-03T01:52:16Z,"I've been using this feature in uTorrent for like 10 years, and never once have I though ""hmm, it would be great if I could edit the regex"" ... One note that I don't know if it has already been dealt with, but uTorrent allows a single ""REPACK"" or ""PROPER"" keyword to bypass the filter, this way it can still auto-download fixed episodes as needed.
For example, Show.S03E04.720p.HDTV.x264-TVGRP downloads, a few hours later Show.S03E04.720p.HDTV.x264.PROPER-GRP2 is released, even though S03E04 has been downloaded, this bypasses the filter and allows the ""proper"" to be auto downloaded as well."
319871244,5287,briankendall,2017-08-03T05:25:32Z,@YEGrolo I believe this PR already has the feature where it downloads any torrent that has REPACK or PROPER in the title.
337039577,5287,cosalich,2017-10-16T20:55:29Z,A little confused as to why this is still merge blocked when it seems to be functioning just as intended?
340284401,5287,elFarto,2017-10-29T18:43:20Z,"The one issue with adding a UI, is that the regex for the match also contain the matching for the season/episode number/date, which is used to mark that the episode has been downloaded. This complexity would need to be reflected in the interface.

Also, would you want this to be a per-filter setting or a global setting?"
346688352,5287,uncleungie,2017-11-23T19:41:38Z,I've been using this feature for months and it has worked flawlessly. Customizing regex filters is not of interest to me. I hope this pull request gets merged soon!
352966692,5287,YEGrolo,2017-12-20T05:12:52Z,Any hope of this ever happening? I really dont want to keep using uT just for this ...
360987801,5287,elFarto,2018-01-27T14:20:17Z,Finally got around to adding configurable filters.
361009242,5287,elFarto,2018-01-27T19:34:12Z,"1. It was implemented globally for a few reasons, the first being it was the easiest, the second being that it is likely that if a person needs a special format for one rule, they'll probably want it for multiple rules so this allows it to be reused. I did ask a few comments ago whether or not this should be global or per-rule (since I don't have a use case for this feature), but I didn't receive an answer.

2. Are we talking about a description on *this* page, or a description in the commit, or a description on the new regex editing feature?"
361055220,5287,glassez,2018-01-28T11:18:34Z,">Are we talking about a description on this page

Yes.
What is ""Smart Filter"" feature, what is it for, example use cases etc."
361088644,5287,elFarto,2018-01-28T19:27:53Z,"> What is ""Smart Filter"" feature, what is it for, example use cases etc.

The Smart Episode Filter keeps track of which episodes a rule matches, and prevents matching the same episode twice. This allows the user to reduce their bandwidth use by preventing duplicate downloads. This feature does allow for duplicates if a REPACK or PROPER version of the episode is matched, which prevents the user from missing fixed versions of episodes.

The user would want to use such a feature as many times an RSS feed will contain multiple releases of an episode (at broadcast time, DVD/Bluray release, etc...), and managing those is a hassle."
361180471,5287,glassez,2018-01-29T09:01:59Z,"@elFarto, I'm more interested not in WHAT it does but HOW it does it. I'll try ask a few probing questions (see comments in code)."
361501782,5287,glassez,2018-01-30T07:36:28Z,">It was implemented globally for a few reasons, the first being it was the easiest, the second being that it is likely that if a person needs a special format for one rule, they'll probably want it for multiple rules so this allows it to be reused.

Can't the same episode use different naming scheme? In this case it can be downloaded multiple times."
361512663,5287,elFarto,2018-01-30T08:29:41Z,"> Can't the same episode use different naming scheme? In this case it can be downloaded multiple times.

Yes, but in practice it rarely happens. There's really only two major formats used for season/episode information s01e01 and 1x1. I've never seen them in the reverse order.

In addition, RSS feeds tend to be constant in formats they use."
361697233,5287,glassez,2018-01-30T18:57:04Z,"@elFarto, don't forget consider [CODING GUIDELINES](https://github.com/qbittorrent/qBittorrent/blob/master/CODING_GUIDELINES.md) and fix your coding style accordingly."
362921642,5287,glassez,2018-02-04T16:56:13Z,"Okay, I approve this PR as it is now, then I will correct myself its remaining deficiencies of the coding style etc. (so it will be easier for everyone). @Chocobo1, please do a brief review of this PR. If you have no blocking comments, I intend to merge it soon."
366201944,5287,glassez,2018-02-16T10:43:58Z,Thanks to the author and all reviewers.
736183697,13885,ghost,2020-12-01T02:54:37Z,"""Add options to disable DHT, PeX, LSD per torrent""

In private torrents, these are not allowed. So shouldn't these options be conditionally displayed?"
736337498,13885,thalieht,2020-12-01T09:21:07Z,">In private torrents, these are not allowed. So shouldn't these options be conditionally displayed?

Right, i totally forgot about them. I'll do it as soon as i hear if a million loops in initDialog() is an acceptable way to do things.
Should i hide or just disable the checkboxes? "
736776646,13885,thalieht,2020-12-01T19:44:56Z,"Not everything from the reviews is in the fixup commit, mostly the trivial things are already merged in previous commits.

>>In private torrents, these are not allowed. So shouldn't these options be conditionally displayed?
>
>Should i hide or just disable the checkboxes?

Done, I chose to disable them for now.

"
736796969,13885,FranciscoPombal,2020-12-01T20:23:04Z,"@thalieht 

Apart from the other points raised in the review, it's looking good. Tested for a bit with a few torrents and seems to work as expected.

Two minor nitpicks:

- Button spacing/frame problem found on Windows (with both Qt 5.15.1 and 5.15.2, only occurs in this particular dialog):

    ![screenshot](https://user-images.githubusercontent.com/17580742/100791466-33053600-3411-11eb-8ed3-03a0ebdb278f.png)

- The file health issues, which made git unhappy when applying the patch set with `git am` :)

---

Thinking out loud, not in the scope of this PR:

I wonder if it would be beneficial to put more controls behind such a dialog. `Download in sequential order` and `Download first and last pieces first` seem like good candidates for this, but why stop there? Doing the same for tag/category selection would enable possibly fleshing out a proper tag/category editor in the future.

The main advantage I see with this is a more clear separation of concerns and a better torrent context menu UX: the top level buttons can be dedicated to _Actions_ (force recheck, resume, preview, ...), while options that change torrent attributes can be be hidden away behind this richer ""Torrent options"" dialog. The context menu would also look less cluttered and functional.

The potential downside is ""too much nesting"", and hiding too many frequently used options behind too many clicks. All in moderation :)"
736818244,13885,ArcticGems,2020-12-01T21:02:30Z,"> 
> 
> > > In private torrents, these are not allowed. So shouldn't these options be conditionally displayed?
> > 
> > 
> > Should i hide or just disable the checkboxes?
> 
> Done, I chose to disable them for now.

Maybe my suggestion is to much, but could you display a text similar this above/below (or on hoover):

Private torrent: These options are disabled.

"
736827275,13885,thalieht,2020-12-01T21:19:45Z,">Button spacing/frame problem found on Windows (with both Qt 5.15.1 and 5.15.2, only occurs in this particular dialog):

Strange, this happens only when opened from the status bar (not from tray). So is this because i'm passing `StatusBar` to the dialog as parent? I have no idea how to fix this...

>Thinking out loud, not in the scope of this PR:
>
>I wonder if it would be beneficial to put more controls behind such a dialog. Download in sequential order and Download first and last pieces first seem like good candidates for this, but why stop there? Doing the same for tag/category selection would enable possibly fleshing out a proper tag/category editor in the future.
>
>The main advantage I see with this is a more clear separation of concerns and a better torrent context menu UX: the top level buttons can be dedicated to Actions (force recheck, resume, preview, ...), while options that change torrent attributes can be be hidden away behind this richer ""Torrent options"" dialog. The context menu would also look less cluttered and functional.

I am neutral to all these

>Maybe my suggestion is to much, but could you display a text similar this above/below (or on hoover):

I added tooltip to the checkboxes when they are disabled ""Selected torrents are private""."
736847072,13885,thalieht,2020-12-01T21:59:55Z,">>Button spacing/frame problem found on Windows (with both Qt 5.15.1 and 5.15.2, only occurs in this particular dialog):
>
>Strange, this happens only when opened from the status bar (not from tray). So is this because i'm passing StatusBar to the dialog as parent? I have no idea how to fix this...

Never mind... previously `parentWidget()` was passed but i blindly passed `this`. Fixed now."
737099035,13885,glassez,2020-12-02T09:14:37Z,"> The main advantage I see with this is a more clear separation of concerns and a better torrent context menu UX: the top level buttons can be dedicated to _Actions_ (force recheck, resume, preview, ...), while options that change torrent attributes can be be hidden away behind this richer ""Torrent options"" dialog. The context menu would also look less cluttered and functional.

👍 


> The potential downside is ""too much nesting"", and hiding too many frequently used options behind too many clicks.

This is why we need to distribute actions between the menu and the dialog based on the frequency of use. As for all those people who complain about ""too many clicks"" for rarely used actions, I don't really respect them."
737925608,13885,glassez,2020-12-03T12:35:20Z,"> I'll do it as soon as i hear if a million loops in initDialog() is an acceptable way to do things.

In fact, you can do only one loop. And I think the code will become even more readable."
738210515,13885,thalieht,2020-12-03T18:41:00Z,">In fact, you can do only one loop. And I think the code will become even more readable.

I hope so."
738214645,13885,glassez,2020-12-03T18:48:56Z,"@thalieht, would it be difficult for you to extract (global) speed limit dialog in a separate PR? I think there shouldn't be any problems, so we can merge it quickly."
738283687,13885,thalieht,2020-12-03T20:18:48Z,">@thalieht, would it be difficult for you to extract (global) speed limit dialog in a separate PR? I think there shouldn't be any problems, so we can merge it quickly.

I would rather not."
739126893,13885,glassez,2020-12-05T05:01:49Z,"Okay, let's skip the details and discuss it in general.
There's something I don't like about it. This applies to processing multiple torrents at once. When torrents have different values for the same property, only those properties represented by checkboxes explicitly reflect this fact. But the worst part is that other properties are bound to be overwritten, even if the user had no intention of touching any of them. In my opinion, this is unacceptable behavior that can cause a lot of Issues here.
So my proposals are:
1. Each control should represent that torrents have different values of appropriate property
2. Untouched property should leave unchanged

Maybe my position is too strict? Let's discuss this."
739150616,13885,thalieht,2020-12-05T09:13:49Z,">But the worst part is that other properties are bound to be overwritten, even if the user had no intention of touching any of them. In my opinion, this is unacceptable behavior that can cause a lot of Issues here.

Damn. I completely agree.

>1. Each control should represent that torrents have different values of appropriate property

How should that be? Another radio button for share limits and... i can't think of anything for the speed limits.

Another things that's been bugging me is that, if i'm not mistaken, resume data will be saved X times the settings on accept? I was thinking about emitting a signal on `accept()`, then save resume data in session and remove `saveResumeData()` from the corresponding setters in session? Would that last part be acceptable? In master, changing `Super seeding mode` on paused torrents isn't saved, so would it be weird some setters save resumes and some don't?"
739153138,13885,glassez,2020-12-05T09:41:18Z,"> > 1. Each control should represent that torrents have different values of appropriate property
> 
> How should that be? Another radio button for share limits and... i can't think of anything for the speed limits.

I didn't think about it in detail. Moreover, UI is not my strong point. Maybe just some sort of label or icon?
>2.  Untouched property should leave unchanged

As for this, it is not too difficult to track whether a property (actually appropriate control) has been affected or not.
>Another things that's been bugging me is that, if i'm not mistaken, resume data will be saved X times the settings on accept? 

Good catch 👍 


> I was thinking about emitting a signal on `accept()`, then save resume data in session and remove `saveResumeData()` from the corresponding setters in session? Would that last part be acceptable?

No. Lower layer should know nothing about higher one.
I think we should implement deferred saving of resume data like `Session::configureDeferred()`."
739250297,13885,glassez,2020-12-05T13:20:20Z,">Another radio button for share limits

Maybe all radio buttons unchecked?"
739250507,13885,glassez,2020-12-05T13:22:19Z,"> i can't think of anything for the speed limits.

It would be nice if you could create the corresponding controls empty. But this is hardly possible."
739252517,13885,glassez,2020-12-05T13:40:24Z,"> > i can't think of anything for the speed limits.
> 
> It would be nice if you could create the corresponding controls empty. But this is hardly possible.

Seems we can play with `specialValueText` for QSpinBox to show some placeholder (or even space character to emulate emptyness). And maybe set position of appropriate slider to middle of bounds."
739326279,13885,FranciscoPombal,2020-12-05T17:44:27Z,"@glassez @thalieht 

> Okay, let's skip the details and discuss it in general.

> So my proposals are:
> 
> 1. Each control should represent that torrents have different values of appropriate property
> 
> 2. Untouched property should leave unchanged
> 
> 
> Maybe my position is too strict? Let's discuss this.

1. I don't think there is an easy way to accomplish this for anything other than checkboxes (where there are 3 states, ""yes"", ""no"", and ""mixed"", the latter one easily seen in the content tab when selecting only a few files under a folder). I think it would be more sensible to simply display a warning to the tune of ""Warning: selected options will apply to all selected torrents"". I don't think a user expects anything else if they select a bunch torrents at the same time in the first place though.

2. I don't think this would be expected behavior. I think the user expects the selected values to apply after they click ""OK"", even if they haven't changed them, because they might think ""oh, this option is already the value that I want"". Again, this is under the same assumption as above, that users select a bunch of torrents to edit with this dialog with the expectation that all of the options will be uniformly applied to all. Plus it sounds like a nightmare to keep track of such state, and it would be very confusing to the user - from their perspective there would be ""inconsistent/magical behavior"": a radio button that is already selected only takes effect if you first change it to something else and then change it back.

So, IMO the best approach is to have the options apply to all of the selected torrents, except perhaps in the case of checkboxes, which, if left in the ""mixed"" state, will carry over the option for each torrent as-is. Obviously, if the checkbox is changed to another state, it is impossible to get back to the ""mixed"" selection (the user would need to close and re-open the dialog with the same selection).

Because of this, the usefulness of the ""mixed"" selection for checkboxes is limited, so we could simply assume that user also wants always wants to have the checkboxes' options apply to all selected torrents, and prevent them from clicking ""OK"" until no checkbox selections are ""mixed"".

Thoughts?"
739330639,13885,glassez,2020-12-05T18:21:23Z,"> Thoughts?

Disagree. When I select a lot of torrents to change a particular property, I don't want all the others to be affected. Otherwise, it turns into a real pain in the ass, taking care to select only the subset whose properties all match, making multiple editing almost completely unusable."
739330729,13885,glassez,2020-12-05T18:22:12Z,We need to get other opinions...
739332961,13885,xavier2k6,2020-12-05T18:41:46Z,"May be off-topic.........If I set values currently (official 4.3.1) in the `Global Rate Limits`, shouldn't each torrent reflect that change in the transfer list under `Down Limit` & `Up Limit` or at least if I add a `New torrent` shouldn't the `Down Limit` & `Up Limit` show the respective new values instead of the `∞`??

If I `right click` the torrents - I can change the limits via the `respective rate slider`

Is this an issue? or me just misunderstanding how the global rate limits work?

EDIT: Same happens with this PR."
739333322,13885,FranciscoPombal,2020-12-05T18:44:46Z,"@glassez 

> Disagree. When I select a lot of torrents to change a particular property, I don't want all the others to be affected. Otherwise, it turns into a real pain in the ass, taking care to select only the subset whose properties all match, making multiple editing almost completely unusable.

I agree that in my version, the flexibility of the dialog is significantly diminished. Here is an important addition:

What if each of the options that can be changed was guarded by a ""Change this option for all torrents"" checkbox? It would look a little clunky, but it would be something like this:

```
[x] Change this in all torrents
    Upload: ---------o-------
[ ] Change this in all torrents
    Download: ----o-------------

[x] Change this in all torrents
    0 Use global share limit
.
.
.
[x] Change this in all torrents
    [x] Disable DHT for this (these) torrent(s)
.
.
.
```"
739333807,13885,glassez,2020-12-05T18:49:02Z,"> What if each of the options that can be changed was guarded by a ""Change this option for all torrents"" checkbox?

I was also thinking of something like this as an option. I would just put each setting in checkable groupbox."
739333921,13885,ArcticGems,2020-12-05T18:49:57Z,"A silly idea (which I personally don't mind, but others might) =

What if when you select a **mix** of public **and** private torrents and open the ""Torrent Options"",
you get **2** dialogs side by side, one with the title ""Torrent Options **(Public)**"" and the other with the title ""Torrent Options **(Private)**"".

When you only select torrents of one type (for example public), only **1** dialog opens."
739363852,13885,FranciscoPombal,2020-12-05T19:42:50Z,"@ArcticGems 

> What if when you select a **mix** of public **and** private torrents and open the ""Torrent Options"",
> you get **2** dialogs side by side, one with the title ""Torrent Options **(Public)**"" and the other with the title ""Torrent Options **(Private)**"".
>
> When you only select torrents of one type (for example public), only **1** dialog opens.

Thanks for the suggestion, but I don't think this is a good idea. This isn't simply about public vs private torrents, we need more granularity regardless of that."
739387024,13885,thalieht,2020-12-05T20:05:46Z,"@glassez 
>>2. Untouched property should leave unchanged
>
>As for this, it is not too difficult to track whether a property (actually appropriate control) has been affected or not.

What do you have in mind? I'm asking because what i have in mind involves a lot of connects and member booleans...

>I think we should implement deferred saving of resume data like `Session::configureDeferred()`.

Sadly i don't think i'll be able to do that. It uses `QMetaObject::invokeMethod` which mentions threads that i understand nothing about.

>Maybe all radio buttons unchecked?

Perfect. Didn't think that's possible because as a user, well, it's not.

>Seems we can play with specialValueText for QSpinBox to show some placeholder (or even space character to emulate emptyness). And maybe set position of appropriate slider to middle of bounds.

I like the empty spinbox idea. The slider in the middle sounds a little random but sure, why not.

@FranciscoPombal 
>Again, this is under the same assumption as above, that users select a bunch of torrents to edit with this dialog with the expectation that all of the options will be uniformly applied to all.

What if users want to e.g. only limit download speed? Currently if all selected torrents don't have the same, say, ratio limit, it defaults and applies ""Use global share limits"" to all of them which the user never touched.

>>What if each of the options that can be changed was guarded by a ""Change this option for all torrents"" checkbox?
>
>I was also thinking of something like this as an option. I would just put each setting in checkable groupbox.

I don't like it, sounds like redundant effort (for the user).

@ArcticGems 
>What if when you select a mix of public and private torrents and open the ""Torrent Options"",
you get 2 dialogs side by side,

If you are worried about the ""Disable XXX"" options, don't. They are never applied to private torrents. If this is a convenience thing to apply different stuff to public/private torrents, then IMO this should be a problem for the transfer list (to be able to filter and select only private/public torrents)"
739462713,13885,glassez,2020-12-06T06:29:56Z,"> Sadly i don't think i'll be able to do that. It uses `QMetaObject::invokeMethod` which mentions threads that i understand nothing about.

Well, then just use `saveResumeData()` in setters. I will improve it to be deferred in separate PR."
739463869,13885,glassez,2020-12-06T06:46:22Z,"> What do you have in mind? I'm asking because what i have in mind involves a lot of connects and member booleans...

Apparently, you can't do without connections and booleans (or something other that can indicate the fact of property is changed, e.g. special value of spin box)..."
739528295,13885,thalieht,2020-12-06T16:40:19Z,"Using the special value for both infinite and ""empty"" is problematic... Neither `QSpinBox::valueChanged` nor `QSpinBox::textChanged` detect inputing 0 the the spinbox as change."
739544922,13885,glassez,2020-12-06T18:43:31Z,"> Using the special value for both infinite and ""empty"" is problematic...

Well, since ""special value"" is already being used for other purposes, it seems to be unavailable for indicating ""mixed values""."
740101717,13885,FranciscoPombal,2020-12-07T18:36:47Z,"@thalieht 

> What if users want to e.g. only limit download speed? Currently if all selected torrents don't have the same, say, ratio limit, it defaults and applies ""Use global share limits"" to all of them which the user never touched.

Hence my proposition of having each option guarded by a checkbox.

> I don't like it, sounds like redundant effort (for the user).

How else do you intend to have sane behavior in the dialog, and prevent the situation above?"
740230838,13885,thalieht,2020-12-07T22:55:48Z,">Hence my proposition of having each option guarded by a checkbox.

Yes but that came later... never mind.

>>I don't like it, sounds like redundant effort (for the user).
>
>How else do you intend to have sane behavior in the dialog, and prevent the situation above?

I managed to implement https://github.com/qbittorrent/qBittorrent/pull/13885#issuecomment-739252517. Not sure about the ""sane"" part though :) empty space in the spinbox doesn't seem like an obvious indication that selected torrents have a different speed limit.

>Using the special value for both infinite and ""empty"" is problematic... Neither QSpinBox::valueChanged nor QSpinBox::textChanged detect inputing 0 the the spinbox as change.

I managed to overcome this by setting the spinbox's min value to a negative number and then restoring it to 0 when valueChanged.
"
740356163,13885,glassez,2020-12-08T03:47:16Z,"> I managed to overcome this by setting the spinbox's min value to a negative number and then restoring it to 0 when valueChanged.

Does it allow you to have both ""infinite"" and ""mixed"" values?


> Hence my proposition of having each option guarded by a checkbox.
> 
> > I don't like it, sounds like redundant effort (for the user).

This should not be a problem if it requires additional action only in the case of initially mixed values."
740585344,13885,thalieht,2020-12-08T12:16:46Z,">Does it allow you to have both ""infinite"" and ""mixed"" values?

Yep."
742442215,13885,thalieht,2020-12-10T10:48:06Z,"~~Currently, if a setting is touched (changed) it will be saved no matter what even if the original value is restored (wherever that's possible). Should i cache the original value and compare it to the current one in `accept()` or the current way is enough?~~

I'm also hoping on some feedback on how the torrent speed limits work: https://github.com/qbittorrent/qBittorrent/pull/13885#issuecomment-739252517
Personally i like it but if you think it's weird i can implement the checkboxes for them.
"
742452555,13885,glassez,2020-12-10T11:08:13Z,"> I'm also hoping on some feedback on how the torrent speed limits work: [#13885 (comment)](https://github.com/qbittorrent/qBittorrent/pull/13885#issuecomment-739252517)
> Personally i like it but if you think it's weird i can implement the checkboxes for them.

Have you implemented it yet? Then please attach a screenshot of what it looks like for mixed values."
742454166,13885,thalieht,2020-12-10T11:11:34Z,">Have you implemented it yet? Then please attach a screenshot of what it looks like for mixed values.


![Captur4e](https://user-images.githubusercontent.com/6451685/101764802-2bb4eb00-3ae9-11eb-85f5-dd8a9a4504ba.JPG)

"
742457182,13885,thalieht,2020-12-10T11:17:46Z,">Currently, if a setting is touched (changed) it will be saved no matter what even if the original value is restored (wherever that's possible). Should i cache the original value and compare it to the current one in accept() or the current way is enough?

Now that i think about it, if i'm not mistaken, all the stuff that are saved in .fastresume are saved anyway on `saveResumeData()`.
At least the speed limits are and i know this for a fact because even in 4.3.1, when adding a torrent these values are -1 in the fastresume and when i change only one of the limits, the other becomes 0.
Not to mention that setters in TorrentHandle check for this thing."
742465620,13885,xavier2k6,2020-12-10T11:34:41Z,">when adding a torrent these values are -1 in the fastresume and when i change only one of the limits, the other becomes 0.
Not to mention that setters in TorrentHandle check for this thing.

(shouldn't adding new torrents respect the new limits?)

Also: (In-case it was overlooked)
https://github.com/qbittorrent/qBittorrent/pull/13885#issuecomment-739332961"
742495398,13885,thalieht,2020-12-10T12:37:56Z,"@xavier2k6 
> shouldn't each torrent reflect that change in the transfer list under Down Limit & Up Limit

Those columns are for when the torrent has limits applied to it explicitly from ""Limit upload/download rate"" dialogs (capped by currently active global limits). Otherwise the global limits are applied.

"
742504652,13885,xavier2k6,2020-12-10T12:57:13Z,"ok, have reviewed the info here again & have completely grasped the scope of it now.

Good job!"
743311540,13885,thalieht,2020-12-11T17:01:53Z,I'm waiting judgement on how i detect if a setting changed in the options dialog so that i can implement it in the global limits dialog as well.
743711776,13885,Chocobo1,2020-12-12T06:22:50Z,">I'm waiting for judgement on how i detect if a setting changed in the options dialog so that i can implement it in the global limits dialog as well.

Maybe I misunderstood your question, but you cannot open these two dialogs at the same time."
743738564,13885,thalieht,2020-12-12T10:54:30Z,">>I'm waiting judgement on how i detect if a setting changed in the options dialog
>
>Maybe I misunderstood your question, but you cannot open these two dialogs at the same time.

Sorry i meant how i implemented it i.e. connects() tracking if an option changed, flipping a bool and check it in `accept()`
or if it would be better to maybe cache the initial values and compare to the final ones in `accept()`."
743770216,13885,glassez,2020-12-12T15:15:07Z,"> if it would be better to maybe cache the initial values and compare to the final ones in `accept()`.

Seems easier to me."
743910298,13885,thalieht,2020-12-12T21:50:51Z,">Seems easier to me.

Done. Now i await the review(s) for it, then i will do the same for global limits dialog and the PR will be ready."
748985959,13885,zywo,2020-12-21T13:55:58Z,"Just my point of view, I think the sizes of dialogs should be fixed, at least vertically. 
"
749084331,13885,thalieht,2020-12-21T17:02:06Z,">Just my point of view, I think the sizes of dialogs should be fixed, at least vertically.

I suppose you mean ""fixed"" in stone. I too don't see a point in resizing it vertically but i also don't see any reason to disallow it. 

I was thinking of saving the dialog geometry considering the nature of sliders (someone may want to make and keep the dialog wider) but i don't know under what section to save it because ""Torrent Options"" doesn't seem to be unanimously accepted. Maybe in the future in another PR."
751562607,13885,Chocobo1,2020-12-28T03:34:46Z,"@thalieht 
Thank you!"
751675442,13885,thalieht,2020-12-28T11:05:26Z,Thanks everyone!
751676678,13885,glassez,2020-12-28T11:10:14Z,"@thalieht
IIRC, there are some superceded PRs, aren't they?"
751681353,13885,thalieht,2020-12-28T11:28:34Z,"Just one IIRC, i'll look for others as well."
751697407,13885,glassez,2020-12-28T12:31:29Z,"> Just one IIRC, i'll look for others as well.

Can you also check #12611?
"
751720417,13885,thalieht,2020-12-28T13:56:02Z,">Can you also check #12611?

It's still valid. I didn't touch the default (10000 KiB/s) here."
1092144088,16840,glassez,2022-04-07T19:55:15Z,"It has not been completed yet, but the foundation is already there. @qbittorrent/bug-handlers, could you test it with a large number of torrents (several hundred or thousands) and share your impressions, so that I can understand more clearly where to go next."
1092187141,16840,thalieht,2022-04-07T20:48:14Z,"Tested with 10k bogus torrents i kept from a previous improve startup PR.
The only difference i see is that the GUI appears very fast, as opposed to master's blank GUI until everything is loaded, but after that it ""freezes"" until everything is loaded."
1092414023,16840,glassez,2022-04-08T03:49:56Z,"> Tested with 10k bogus torrents i kept from a previous improve startup PR.

Please share them with me (I lost them)."
1092623394,16840,xavier2k6,2022-04-08T09:00:32Z,"> > Tested with 10k bogus torrents i kept from a previous improve startup PR.
> 
> Please share them with me (I lost them).

Here you go:
[test-torrents.zip](https://github.com/qbittorrent/qBittorrent/files/8450267/test-torrents.zip)

I haven't tested this PR yet but would also remind anyone testing to test after a long period of time of inactivity (cold starts etc) or even reboot machine in-between tests & also we should test `sqlite` option.

@glassez I don't know if you want to bring in users who have actual real-world torrents of 10,000 -> 150,000 for testing purposes at this stage or at all but there are users who would fit such scenarios...

"
1092681904,16840,glassez,2022-04-08T09:48:37Z,"> Here you go:
> [test-torrents.zip](https://github.com/qbittorrent/qBittorrent/files/8450267/test-torrents.zip)

Thank you!


> @glassez I don't know if you want to bring in users who have actual real-world torrents of 10,000 -> 150,000 for testing purposes at this stage or at all

Maybe later."
1092686832,16840,xavier2k6,2022-04-08T09:54:37Z,Does duplication of items in the `filter list` have any effect on performance?
1092689180,16840,glassez,2022-04-08T09:57:28Z,"> Does duplication of items in the `filter list` have any effect on performance?

I'm sorry, could you not speak in riddles? Unfortunately, I didn't understand what you were talking about."
1092699077,16840,xavier2k6,2022-04-08T10:09:03Z,"> > Does duplication of items in the `filter list` have any effect on performance?
> 
> I'm sorry, could you not speak in riddles? Unfortunately, I didn't understand what you were talking about.

Ok. (for example)
In the filters list....go to `completed` & select a torrent, now force-recheck it.
That `checking state` will now show in `seeding/completed/checking & inactive` filters.
Does this have an impact on performance due to drawing `progress bar` etc. because that torrent state is being duplicated in multiple filters?"
1092727614,16840,glassez,2022-04-08T10:42:54Z,"> Does this have an impact on performance due to drawing `progress bar` etc. because that torrent state is being duplicated in multiple filters?

Any torrent is either shown in transfer list or not (filtered out). It makes no difference to it how many filters it is accounted for."
1093709690,16840,oorzkws,2022-04-09T05:42:34Z,"Feel free to poke me when you need a test case, I'm nearing 200k torrents with around an 7 hour load time currently.

I've noticed especially that the restoring process slows down over time. It may start out doing a few thousand torrents a second, but it'll finish doing maybe one every 3 seconds as it nears completion. Files are approx the same size on both ends, so it's not that. May be worth keeping in mind as you poke through the code, anyway."
1093732641,16840,jagannatharjun,2022-04-09T06:17:50Z,"> I've noticed especially that the restoring process slows down over time. It may start out doing a few thousand torrents a second, but it'll finish doing maybe one every 3 seconds as it nears completion.

That's because the tracker announces handling, (readAlerts), it grows with the number of torrents, it's one of the biggest bottlenecks during startup, @glassez can we just disable the tracker announce handling during startup? Make tracker handling demand-based?"
1093809388,16840,jagannatharjun,2022-04-09T08:33:16Z,"compounding torrentLoaded function won't add much performance, things will take same time like this -

![image](https://user-images.githubusercontent.com/34717789/162563365-ac58a184-c4bb-4737-86e8-bbf52cad5a7a.png)

I suspect the same thing happened with your effort in the accumulation of tracker status handling

Also, why not use the concurrency module like one used in another PR doing the same thing? IMO code is much simpler in other PR.
"
1093961659,16840,glassez,2022-04-09T12:02:57Z,"> compounding `torrentLoaded` function won't add much performance, things will take same time like this -

Why these unsubstantiated statements? Such ""compound"" functions allow you to perform some operations once per bunch."
1093963261,16840,glassez,2022-04-09T12:05:13Z,"> 7 hour load time currently.
> 
> I've noticed especially that the restoring process slows down over time. It may start out doing a few thousand torrents a second, but it'll finish doing maybe one every 3 seconds as it nears completion.

Are you talking about one of the qBittorrent releases, or about the build from this commit?"
1093974676,16840,oorzkws,2022-04-09T12:22:15Z,"> Are you talking about one of the qBittorrent releases, or about the build from this commit?

4.4.2, released."
1093998339,16840,jagannatharjun,2022-04-09T12:55:32Z,"> Why these unsubstantiated statements?

well if you have looked at the screenshot of the profiler I attached you can't say it was ""unsubstantiated"" but my bad actually I opened the profiler after many days and didn't realize I was testing a branch with changes from https://github.com/qbittorrent/qBittorrent/pull/16632 which does the same thing."
1094032087,16840,glassez,2022-04-09T13:41:59Z,"> well if you have looked at the screenshot of the profiler I attached you can't say it was ""unsubstantiated""

And what can I say, seeing that you are trying to prove the ""drawback"" of these changes by presenting a screenshot of how it works without them.

No offense, but you could help more by posting up-to-date performance measurements."
1094036223,16840,jagannatharjun,2022-04-09T13:52:00Z,"> seeing that you are trying to prove the ""drawback"" of these changes

I was not trying to prove the ""drawback"" but just saying it doesn't help much (I admit I was mistaken)

>  these changes by presenting a screenshot of how it works without them.

the branch I was testing had the changes from my own asynchronous implementation. I thought they both should be comparable but didn't release I merge the changes from the other branch at some point."
1094077209,16840,jagannatharjun,2022-04-09T16:15:01Z,"I tried this PR as is, the window appears instantly but remains unusable for 10min (after that I terminated the process), on the master window becomes usable after 2:20 min. I used dummy 5000 torrents created from the following script, trackers_all.txt contains some valid trackers (ngosang's trackerlist).

```python
from torrentool.torrent import Torrent
import fnmatch
import random
import string
import os
import multiprocessing

trackers = [t.strip() for t in open(""trackers_all.txt"", 'r').readlines() if t.strip()]


def write_random_file(filename):
    size = random.randint(1, 64 * 1024)
    data = ''.join(random.choice(string.ascii_uppercase + string.digits) for _ in range(size))
    open(filename, ""w"").write(data)

def create_random_torrent(i):
    file_count = random.randint(1, 50)
    dir = f""bulk-torrent-dirs\\dir{i}\\""
    if not os.path.exists(dir):
        os.makedirs(dir)

    for _ in range(file_count):
        name = dir + ''.join(random.choice(string.ascii_uppercase) for _ in range(random.randint(1, 64)))
        write_random_file(name)

    t = Torrent.create_from(dir, lambda file: fnmatch.fnmatch(file, ""*""))
    t.announce_urls = [random.choice(trackers) for i in range(20)]
    t.to_file(f""bulk/torrent{i}.torrent"")


if __name__ == '__main__':
    with multiprocessing.Pool() as pool:
        pool.map(create_random_torrent, range(5000))
```"
1094077789,16840,glassez,2022-04-09T16:18:38Z,"> trackers_all.txt contains some valid trackers (ngosang's trackerlist)

Could you attach it as well?"
1094079198,16840,xavier2k6,2022-04-09T16:27:02Z,"> > trackers_all.txt contains some valid trackers (ngosang's trackerlist)
> 
> Could you attach it as well?

https://github.com/ngosang/trackerslist/blob/master/trackers_all.txt"
1094146013,16840,oorzkws,2022-04-10T00:13:00Z,"> > I've noticed especially that the restoring process slows down over time. It may start out doing a few thousand torrents a second, but it'll finish doing maybe one every 3 seconds as it nears completion.
> 
> That's because the tracker announces handling, (readAlerts), it grows with the number of torrents, it's one of the biggest bottlenecks during startup, @glassez can we just disable the tracker announce handling during startup? Make tracker handling demand-based?

Please tell me if I'm derailing this and should discuss elsewhere. With that being said, I did a quick trace on 4.4.2 with Windows Performance Recorder, and most of the time is actually in `StatusFilterWidget::updateTorrentNumbers`  and `libtorrent::aux::session_impl::recalculate_auto_managed_torrents` in my case. It seems if it's recalculating the numbers every time a torrent is restored, this explains the seemingly linear increase in time between torrents.

![updateTorrentNumbers](https://user-images.githubusercontent.com/65210810/162595733-ea2c38f3-3998-4f87-af77-40990cfdbb3a.png)
![recalculate_auto_managed_torrents](https://user-images.githubusercontent.com/65210810/162595746-a801beff-e588-4f83-810e-0fe8ce9c579b.png)

Edit: Here is a graph of ""number of entries per log timestamp"". It's sorted chronologically.
![Picture2](https://user-images.githubusercontent.com/65210810/162596724-cb6437d6-ef35-4eea-996d-4967bb9723bc.png)

Edit 2: Thank you, @jagannatharjun - I've switched to the nightly. Unfortunately now the performance limitations are within libtorrent-rasterbar.dll which I don't have the symbols to profile.
"
1094194470,16840,jagannatharjun,2022-04-10T06:33:38Z,"> most of the time is actually in StatusFilterWidget::updateTorrentNumbers

yes, that function was quadratic, which should be fixed via https://github.com/qbittorrent/qBittorrent/pull/16587, you can try that from nightly builds if you wish to.

> `libtorrent::aux::session_impl::recalculate_auto_managed_torrents`

it must be running on a different thread then GUI, so should not be a problem (I can't confirm at the moment)"
1094253691,16840,jagannatharjun,2022-04-10T11:48:03Z,">  I've switched to the nightly. 

Did you get any noticeable performance improvement?

> libtorrent-rasterbar.dll which I don't have the symbols to profile.

All the libtorrent work is done in a separate thread, It shouldn't affect qbittorrent working."
1094261711,16840,oorzkws,2022-04-10T12:24:51Z,"> > I've switched to the nightly.
> 
> Did you get any noticeable performance improvement?
> 
> > libtorrent-rasterbar.dll which I don't have the symbols to profile.
> 
> All the libtorrent work is done in a separate thread, It shouldn't affect qbittorrent working.

It loads much faster until around 200k torrents, and that's where I'm sitting now. It processed ~195k torrents in the first hour and now at T+6h I'm at ~215k so it seems it's hit something of a wall, I don't remember my total torrent count but the UI hasn't become responsive yet.

Edit: Profiling says the majority of time spent is in BitTorrent::DBResumeDataStorage::Worker::store but I'm again unsure if that's on the main thread.

Also, my tracker rejects ""-qB450-"" so I can't check actual announce performance or if they're happening once this lockup happens."
1094273298,16840,jagannatharjun,2022-04-10T13:16:07Z,"> Profiling says the majority of time spent is in BitTorrent::DBResumeDataStorage::Worker::store 

Yes, that's on the main thread, this PR deals with it.

> my tracker rejects ""-qB450-"" so I can't check actual announce performance or if they're happening once this lockup happens

there will still be a fail message from a tracker, so the story would be the same. PS: you can try to compile qbittorrent yourself and change the version https://github.com/qbittorrent/qBittorrent/blob/master/src/base/version.h.in"
1094274037,16840,glassez,2022-04-10T13:20:28Z,"


> > the majority of time spent is in BitTorrent::DBResumeDataStorage::Worker::store
> 
> Yes, that's on the main thread

False. Storing resume data is done in separate thread."
1094305184,16840,glassez,2022-04-10T16:12:53Z,"> I tried this PR as is, the window appears instantly but remains unusable for 10min (after that I terminated the process), on the master window becomes usable after 2:20 min. I used dummy 5000 torrents created from the following script

Main window becomes usable in less than 1min for me (using this PR). But I'm still not satisfied with having a non-usable window."
1094339711,16840,ghost,2022-04-10T18:13:02Z,I think after running for 1 hour qbt tried to save resume data and that’s what caused it to hit the wall. @oorzkws 
1094541290,16840,oorzkws,2022-04-11T04:38:33Z,"> I think after running for 1 hour qbt tried to save resume data and that’s what caused it to hit the wall. @oorzkws

Thanks, I changed the interval to see if that improves the behavior. I've built the branch this PR is on, it's very strange to have the UI immediately available and updating during the initial load. It's alternating between loading ~30k torrents and a 5 minute hang. Current at around 70k loaded, I'll update if it finishes or crashes.

Update: After hitting ~213,000 torrents the UI is frozen and it hasn't loaded any more for the last 45 minutes. I don't recall what my total count is 😓 

Update 2.1: 213k was in fact the total count, the rest of the time was recheck. Initial load is around an hour followed by a two hour recheck, this is a massive improvement.
![image](https://user-images.githubusercontent.com/65210810/162721096-cc290bd9-b187-4cb2-b449-e5462f5bc041.png)
❤️ 

**TL;DR; Huge improvements! It's not only faster to load but the UI updates as it goes. If #16581 gets implemented it'll be even faster.**
"
1094901498,16840,glassez,2022-04-11T10:51:27Z,">If #16581 gets implemented it'll be even faster.

#16581 is about checking of file existence and not about hash checking (aka ""recheck"" you mentioned above). But in any case, it should slightly improve startup performance, especially in the case of an extremely large number of torrents, like yours. But there is a problem with it, because it provides opportunities for creating fake seeding, etc. I'm afraid that it will not be approved if I don't add some protective mechanisms there. But it's offtopic here, so if you have something to say about it, then let's continue in #16581."
1094907507,16840,glassez,2022-04-11T10:59:17Z,">It's not only faster to load but the UI updates as it goes. 

Yes, but the UI is still not usable due to large delays (I don't think you're seeing a better picture). I'm working on further optimization."
1094997216,16840,oorzkws,2022-04-11T12:36:40Z,"> > It's not only faster to load but the UI updates as it goes.
> 
> Yes, but the UI is still not usable due to large delays (I don't think you're seeing a better picture). I'm working on further optimization.

Sort-of. Having the numbers visible and updating is an improvement for me as-is - I'm not stuck estimating progress by log lines and hoping the file didn't roll over."
1095052478,16840,glassez,2022-04-11T13:27:50Z,"@oorzkws
I wonder how qBittorrent behaves with so many torrents (after they are all restored/loaded)?"
1095083278,16840,oorzkws,2022-04-11T13:54:29Z,"> @oorzkws I wonder how qBittorrent behaves with so many torrents (after they are all restored/loaded)?

Quite well, actually. There's crashes sometimes per #16837 but otherwise it's fairly stable, keeps the watch folder empty, and keeps announcing fine. There's sometimes issues if I do something like say.. change the tracker on 20k torrents at once - the UI will freeze and it will stop announcing, but it keeps emptying the watch folder.

It's easily the best experience I've had using a single client for a large amount of torrents."
1095338531,16840,ghost,2022-04-11T17:35:10Z,@oorzkws I think 200k+ torrents is extremely rare case and that isn’t the main aim of this PR. It aims at maybe 5-10k torrents which can be loaded without causing GUI lockups. So not checking if the files exists on startup would be a bad choice even though you could delete the files lateron but in order to do that you have to have the files in the first place which kinda works well against fake seeders. 
1100061017,16840,ghost,2022-04-15T11:52:12Z,I think you could improve startup and overall performance by not saving peers to resume data. That way you save space & reduce disk I/O. 
1100067001,16840,glassez,2022-04-15T12:07:39Z,"> I think you could improve startup and overall performance by not saving peers to resume data. That way you save space & reduce disk I/O.

I don't think it will help much.
In any case, it's not a good idea to unconditionally stop saving them, IMO. Although we could add this as an option."
1100997054,16840,oorzkws,2022-04-18T01:09:09Z,"I built 9ea113e, something seems to have regressed - the client doesn't seem to finish loading and the UI doesn't become responsive. The torrent count in the UI is wrong (roughly half what it should be), and the client has been open several hours now with no new log entries within the last two hours. Disk activity is minimal consisting of only my page file and torrents.db/torrents.db-journal, CPU load is around half a core.

According to the tracker it is still announcing the full 200k torrents, despite the UI showing All(96696). New torrents are being removed from the watch folder, but they aren't announcing or downloading.

WinDbg shot of the main thread: https://pasteimg.com/images/2022/04/18/image.png

I think my previous build was 7b011e5"
1101118717,16840,glassez,2022-04-18T05:55:03Z,"> I built [9ea113e](https://github.com/qbittorrent/qBittorrent/commit/9ea113e0be98aa97700e3d38526aa1d0c396dd3d), something seems to have regressed

Could you also test a4ac356?"
1101196083,16840,oorzkws,2022-04-18T08:04:22Z,"> > I built [9ea113e](https://github.com/qbittorrent/qBittorrent/commit/9ea113e0be98aa97700e3d38526aa1d0c396dd3d), something seems to have regressed
> 
> Could you also test [a4ac356](https://github.com/qbittorrent/qBittorrent/commit/a4ac3561bec16ac2af6ef638ba28efdb6990feec)?

So far so good, loading up - UI is now updating more regularly (every few minutes) during the initial load."
1101261309,16840,glassez,2022-04-18T09:33:05Z,"> > Could you also test [a4ac356](https://github.com/qbittorrent/qBittorrent/commit/a4ac3561bec16ac2af6ef638ba28efdb6990feec)?
> 
> So far so good, loading up - UI is now updating more regularly (every few minutes) during the initial load.

The main difference is in what state the BitTorrent session is in before the end of loading (restoring) existing torrents. Initially, in this PR, session was ""paused"" all this time so as not to create additional load while loading torrents. In 9ea113e I tried to keep session active."
1101333381,16840,oorzkws,2022-04-18T11:35:53Z,"a4ac356: Looks like it's not quite loading. It'll get all of the torrents loaded and start verifying and then the client seems to freeze whenever that finishes (no UI updates during). It's still announcing but not adding new torrents, and has 0 disk activity.

I'll let it run overnight and update here after."
1101931056,16840,oorzkws,2022-04-19T02:29:39Z,"a4ac356: Yeah it looks like it's still locked up. It's announcing existing torrents but anything added to the watch folder in the last 12 hours isn't active. UI doesn't open either.

Edit: Log started mentioning finished torrents when I tried to open it from tray, but stopped fairly quickly and the program remained unresponsive."
1102082638,16840,glassez,2022-04-19T05:27:06Z,"@oorzkws 
I update something here from time to time, so it would be very helpful if you explicitly indicated which commit your report belongs to."
1102139812,16840,oorzkws,2022-04-19T06:25:43Z,"> @oorzkws I update something here from time to time, so it would be very helpful if you explicitly indicated which commit your report belongs to.

Done, my apologies. I'm putting together a test case of the smallest 100,000 torrents from archive.org - each file (not .torrent) is around .5KB. Once it's done fetching, it's currently around 50% done, I'll upload here. I'm happy to keep testing but it also seems I'm missing some of the skills necessary to provide useful information."
1102348352,16840,oorzkws,2022-04-19T09:06:19Z,"[archive_org.tar.gz](https://github.com/qbittorrent/qBittorrent/files/8511542/archive_org.tar.gz)

100k torrents from archive.org. I included the metadata and fetch script so you can verify the sourcing if you so desire.

To be clear, I'm not saying I expect you to do this - my case is such a tiny tiny niche I can keep using the 7b011e5 without issue as it already solves some of the more major issues I experience."
1138816615,16840,glassez,2022-05-26T17:16:32Z,"@oorzkws 
Could you test the latest push?

@qbittorrent/bug-handlers
I have completed all the major changes and am now proceeding to the final stage. Could anyone test it at this stage? It is not necessary to have too many torrents. It would be useful for me to see feedback regarding the number of different orders (a couple of tens, a couple of hundreds, a couple of thousands of torrents)."
1139443102,16840,oorzkws,2022-05-27T09:25:14Z,"> @oorzkws Could you test the latest push?

Sure, I've built and installed over one of my instances (I've moved to 10 instances of approx 20k torrents). The recheck on load only took around ten minutes and kept a consistent pace, the UI stayed responsive, and I could minimize to tray and restore to check progress without issue. I'll be moving the rest of the instances to this build shortly :)

Edit: For the rest of my instances something seems to have lost the torrents in migration. I'm re-loading them in to see how they handle it now. For the original test instance, it stopped announcing a bit after it loaded - the tracker says I'm only seeding 6k torrents when that instance alone has ~19k.

Edit 2: Original instance seems to have randomly paused 13k torrents, that was what was preventing the announce. Resuming now, hope they stay resumed, will update with time.

Edit 3: Left it overnight, rest of the clients seem to have found their torrents. Not sure why they showed 0 for so long but it worked out.

Edit 4: Speed tracking appears broken somehow
![image](https://user-images.githubusercontent.com/65210810/170804475-5d19ddf8-324a-4594-ba84-3df6598dcfd4.png)

Peer counts as well
![image](https://user-images.githubusercontent.com/65210810/170804491-3d34c7bc-038d-4fc5-824d-26cb1a5bfb0f.png)

Edit 5: All above notes apply only to 26ec3aea87b02d39c59c0deccdec036e857be9b3
"
1140303885,16840,thalieht,2022-05-28T17:44:34Z,"qmake only:
```
moc_categoryfiltermodel.cpp:114: error: invalid application of ‘sizeof’ to incomplete type ‘BitTorrent::Torrent’
/usr/include/qt6/QtCore/qmetatype.h:2368:42:   required from ‘constexpr const QtPrivate::QMetaTypeInterface QtPrivate::QMetaTypeInterfaceWrapper<QList<BitTorrent::Torrent*> >::metaType’
/usr/include/qt6/QtCore/qmetatype.h:2494:16:   required from ‘constexpr const QtPrivate::QMetaTypeInterface* QtPrivate::qTryMetaTypeInterfaceForType() [with Unique = qt_meta_stringdata_CategoryFilterModel_t; TypeCompletePair = QtPrivate::TypeAndForceComplete<const QList<BitTorrent::Torrent*>&, std::integral_constant<bool, false> >]’
/usr/include/qt6/QtCore/qmetatype.h:2538:55:   required from ‘constexpr const QtPrivate::QMetaTypeInterface* const qt_incomplete_metaTypeArray [13]<qt_meta_stringdata_CategoryFilterModel_t, QtPrivate::TypeAndForceComplete<CategoryFilterModel, std::integral_constant<bool, true> >, QtPrivate::TypeAndForceComplete<void, std::integral_constant<bool, false> >, QtPrivate::TypeAndForceComplete<const QString&, std::integral_constant<bool, false> >, QtPrivate::TypeAndForceComplete<void, std::integral_constant<bool, false> >, QtPrivate::TypeAndForceComplete<const QString&, std::integral_constant<bool, false> >, QtPrivate::TypeAndForceComplete<void, std::integral_constant<bool, false> >, QtPrivate::TypeAndForceComplete<const QList<BitTorrent::Torrent*>&, std::integral_constant<bool, false> >, QtPrivate::TypeAndForceComplete<void, std::integral_constant<bool, false> >, QtPrivate::TypeAndForceComplete<BitTorrent::Torrent* const, std::integral_constant<bool, false> >, QtPrivate::TypeAndForceComplete<void, std::integral_constant<bool, false> >, QtPrivate::TypeAndForceComplete<BitTorrent::Torrent* const, std::integral_constant<bool, false> >, QtPrivate::TypeAndForceComplete<const QString&, std::integral_constant<bool, false> >, QtPrivate::TypeAndForceComplete<void, std::integral_constant<bool, false> > >’
moc_categoryfiltermodel.cpp:114:1:   required from here
/usr/include/qt6/QtCore/qmetatype.h:858:23: error: invalid application of ‘sizeof’ to incomplete type ‘BitTorrent::Torrent’
  858 |         static_assert(sizeof(T), ""Type argument of Q_PROPERTY or Q_DECLARE_METATYPE(T*) must be fully defined"");
      |                       ^~~~~~~~~
```

Can't find any problems but i may have missed something."
1140436039,16840,glassez,2022-05-29T12:09:45Z,"> qmake only:

Can you try the latest push?


> Can't find any problems but i may have missed something.

So I want v4.5 beta is released including this PR merged and at least one month to pass since then until v4.5 final is released."
1140439910,16840,thalieht,2022-05-29T12:32:14Z,">Can you try the latest push?

~~Still happening.~~ Same error but now for tagfiltermodel
Edit: Compiles after doing the same for tagfiltermodel."
1140457652,16840,glassez,2022-05-29T14:11:57Z,"> Compiles after doing the same for tagfiltermodel.

Done!"
1140658270,16840,ghost,2022-05-30T03:41:21Z,DHT nodes stay at zero with this build (2.0.6 win).
1140722889,16840,oorzkws,2022-05-30T05:43:25Z,"> DHT nodes stay at zero with this build (2.0.6 win).

Not an issue for me on aa27ef5 2.0.6 win64"
1140737221,16840,glassez,2022-05-30T06:09:06Z,"> > DHT nodes stay at zero with this build (2.0.6 win).
> 
> Not an issue for me on [aa27ef5](https://github.com/qbittorrent/qBittorrent/commit/aa27ef52c387f1dc93ad48b39169cb30b1b3d3ac) 2.0.6 win64

Since [aa27ef5](https://github.com/qbittorrent/qBittorrent/commit/aa27ef52c387f1dc93ad48b39169cb30b1b3d3ac) nothing has been changed that could affect DHT."
1140763898,16840,ghost,2022-05-30T06:45:49Z,"> > DHT nodes stay at zero with this build (2.0.6 win).
> 
> Not an issue for me on [aa27ef5](https://github.com/qbittorrent/qBittorrent/commit/aa27ef52c387f1dc93ad48b39169cb30b1b3d3ac) 2.0.6 win64

Have you tested with a portable instance with zero torrents?"
1140765713,16840,ghost,2022-05-30T06:48:46Z,"> > > DHT nodes stay at zero with this build (2.0.6 win).
> > 
> > 
> > Not an issue for me on [aa27ef5](https://github.com/qbittorrent/qBittorrent/commit/aa27ef52c387f1dc93ad48b39169cb30b1b3d3ac) 2.0.6 win64
> 
> Since [aa27ef5](https://github.com/qbittorrent/qBittorrent/commit/aa27ef52c387f1dc93ad48b39169cb30b1b3d3ac) nothing has been changed that could affect DHT.

DHT works fine on master. Your PR must've broken something!"
1140771345,16840,ghost,2022-05-30T06:56:46Z,"Other things that broke:
Trackers do not work at all. All stay as not contacted
Torrent states do not change in transfer list
As if all network activity and GUI updates are paused!"
1140795213,16840,oorzkws,2022-05-30T07:23:03Z,"> > > DHT nodes stay at zero with this build (2.0.6 win).
> > 
> > 
> > Not an issue for me on [aa27ef5](https://github.com/qbittorrent/qBittorrent/commit/aa27ef52c387f1dc93ad48b39169cb30b1b3d3ac) 2.0.6 win64
> 
> Have you tested with a portable instance with zero torrents?

Rebuilding on fc2f3a7, I will test with those parameters and edit the results in here. Please also make sure your new qBittorrent location isn't blocked by your firewall.

Edit 1: autobuild is broken for the time being, no new builds for me."
1140804436,16840,ghost,2022-05-30T07:32:46Z,"It’s not the firewall because I don’t use one. 
2ndly, master works fine. The latest release also works fine. "
1140805145,16840,ghost,2022-05-30T07:33:33Z,Also I’ve tested the build from github actions which may be using different library versions. 
1141189324,16840,glassez,2022-05-30T13:55:55Z,"> Other things that broke: Trackers do not work at all. All stay as not contacted Torrent states do not change in transfer list As if all network activity and GUI updates are paused!

👍 
Some corner cases were unhandled. Should be fixed now."
1143236390,16840,glassez,2022-06-01T07:49:36Z,"> Also I think commit message should contain more info, e.g. what change/optimization is included or the effects of it.

OP is updated.
I'll include it in final commit message while merging PR."
1143564772,16840,glassez,2022-06-01T12:46:05Z,"Note that the RSS subsystem can still have a negative impact on the startup speed, so it is better to disable it in order to test this PR."
1144628021,16840,oorzkws,2022-06-02T09:05:59Z,"![image](https://user-images.githubusercontent.com/65210810/171595968-c91f0c12-62ce-450d-91d8-d18592c93f45.png)
My speed tracking is still wildly incorrect on 50ed0fc"
1144642083,16840,glassez,2022-06-02T09:21:24Z,"> My speed tracking is still wildly incorrect on [50ed0fc](https://github.com/qbittorrent/qBittorrent/commit/50ed0fc6491406c6346207fd364ca7955175c877)

Does this screenshot represent the period while startup is in progress?
How about master? Does it behave differently?"
1145150191,16840,ghost,2022-06-02T17:54:40Z,"> ![image](https://user-images.githubusercontent.com/65210810/171595968-c91f0c12-62ce-450d-91d8-d18592c93f45.png) My speed tracking is still wildly incorrect on [50ed0fc](https://github.com/qbittorrent/qBittorrent/commit/50ed0fc6491406c6346207fd364ca7955175c877)

The total download/upload amount is showing unknown in status bar.
Couldn't reproduce it. Maybe it requires the session still being restored?"
1145188690,16840,glassez,2022-06-02T18:35:54Z,"> Couldn't reproduce it. Maybe it requires the session still being restored?

I can reproduce it. With 5000 dummy torrents that I use to test this PR  I saw a similar picture. It seems that this is still a bug in the code of the ""speed graph"", since the picture is the same, even if all torrents are stopped. It seems to depend on the number of torrents, since having only a few torrents in a session, I didn't notice anything like this (although I didn't have time to do a lot of tests)."
1145346600,16840,oorzkws,2022-06-02T21:13:10Z,"> > My speed tracking is still wildly incorrect on [50ed0fc](https://github.com/qbittorrent/qBittorrent/commit/50ed0fc6491406c6346207fd364ca7955175c877)
> 
> Does this screenshot represent the period while startup is in progress? How about master? Does it behave differently?

I haven't seen this on master, but I haven't had much time to give the master build testing (if this answer is still relevant). Screenshot taken while startup is in progress, however even after recheck is complete it persists.
![image](https://user-images.githubusercontent.com/65210810/171739445-7598cb84-6e92-4c3f-b118-d1ede5001df4.png)

__Edit__: On https://github.com/qbittorrent/qBittorrent/commit/50ed0fc6491406c6346207fd364ca7955175c877 no torrents are announcing and all trackers show as ""not contacted yet""
![image](https://user-images.githubusercontent.com/65210810/171739936-a65434c3-2ec6-456d-9151-2eab49e847c3.png)
Even for cases of recently active torrents, where this must be incorrect (however, the tracker is showing that I'm not seeding anything).
![image](https://user-images.githubusercontent.com/65210810/171740132-c9d4c51c-6d2d-41c5-8753-8eb1ee1deff2.png)

Router's traffic graph of announce data, you can see where I upgraded to the current build around the 2 mark.
![image](https://user-images.githubusercontent.com/65210810/171740963-656fbbb0-614d-4b75-acb0-8d355f8f1146.png)

Also, every restart some torrents lose their trackers. This happens even with a clean shutdown (file->exit).
![image](https://user-images.githubusercontent.com/65210810/171742884-064a7513-870a-4b11-94e2-00b719c1ca50.png)


__Edit 2__: After a restart, trackers are showing properly as ""working"". Time will tell if it will keep reannouncing or not.

"
1145421861,16840,xavier2k6,2022-06-02T23:01:33Z,"Testing under portable mode with defaults & switching from `fastreume` -> `sql` & back again etc. between tests.

I haven't tested `master` to see if crashes happen there too.

Seem to experience a straight CTD & `eventvwr` displays `0xC000409`

[c0000409_CrashDumps.zip](https://github.com/qbittorrent/qBittorrent/files/8828265/c0000409_CrashDumps.zip)

>In qbittorrent.exe.8196.dmp the assembly instruction at ucrtbase!abort+4e in C:\Windows\System32\ucrtbase.dll from Microsoft Corporation has caused an unknown exception (0xc0000409) on thread [0](https://github.com/qbittorrent/qBittorrent/pull/16840#B1C1Thread10428)

```
[0x7ff87594286e] | ucrtbase!abort+4e |  
[0x7ff870336e4a] | VCRUNTIME140!_purecall+1a [D:\a\_work\1\s\src\vctools\crt\vcruntime\src\misc\purevirt.cpp @ 29 + 6] | D:\a\_work\1\s\src\vctools\crt\vcruntime\src\misc\purevirt.cpp @ 29 + 6
[0x7ff81788f9bd] | Qt6Core!QObject::~QObject+61d |  
[0x7ff817890343] | Qt6Core!operator<<+5f3 |  
[0x7ff69d3e3348] | qbittorrent+d3348 |  
[0x7ff69d3ea466] | qbittorrent+da466 |  
[0x7ff81789846b] | Qt6Core!QMetaCallEvent::placeMetaCall+3b |  
[0x7ff81789691e] | Qt6Core!QObject::event+18e |  
[0x7ff818a92f6e] | Qt6Widgets!QApplicationPrivate::notify_helper+10e |  
[0x7ff818a91f9f] | Qt6Widgets!QApplication::notify+187f |  
[0x7ff8178534e5] | Qt6Core!QCoreApplication::notifyInternal2+c5 |  
[0x7ff817855d3f] | Qt6Core!QCoreApplicationPrivate::sendPostedEvents+21f |  
[0x7ff8181d0f6f] | Qt6Gui!QWindowsGuiEventDispatcher::sendPostedEvents+f |  
[0x7ff8179aeda0] | Qt6Core!QEventDispatcherWin32::processEvents+90 |  
[0x7ff8181d0f49] | Qt6Gui!QWindowsGuiEventDispatcher::processEvents+19 |  
[0x7ff817858bef] | Qt6Core!QEventLoop::exec+19f |  
[0x7ff8178512fd] | Qt6Core!QCoreApplication::exec+15d |  
[0x7ff69d3a8a13] | qbittorrent+98a13 |  
[0x7ff69d3b4d6e] | qbittorrent+a4d6e |  
[0x7ff69daa0cc7] | qbittorrent+790cc7 |  
[0x7ff69da6d4b2] | qbittorrent+75d4b2 |  
[0x7ff8773c7034] | kernel32!BaseThreadInitThunk+14 |  
[0x7ff877d02651] | ntdll!RtlUserThreadStart+21

```
____

#### Also crashing with:

qBittorrent has crashed
Please file a bug report at http://bugs.qbittorrent.org and provide the following information:





qBittorrent version: v4.5.0alpha1 (64-bit)
Libtorrent version: 2.0.6.0
Qt version: 6.3.0
Boost version: 1.79.0
OpenSSL version: 3.0.3
zlib version: 1.2.12
OS version: Windows 10 Version 2009 10.0.19044 x86_64

Caught signal: SIGSEGV
```
 0# boost::stacktrace::basic_stacktrace >::init at D:\a\qBittorrent\boost\boost\stacktrace\stacktrace.hpp:77
 1# getStacktrace at D:\a\qBittorrent\qBittorrent\src\app\stacktrace.cpp:35
 2# `anonymous namespace'::abnormalExitHandler at D:\a\qBittorrent\qBittorrent\src\app\signalhandler.cpp:103
 3# _seh_filter_exe at minkernel\crts\ucrt\src\appcrt\misc\exception_filter.cpp:219
 4# `__scrt_common_main_seh'::`1'::filt$0 at D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:304
 5# __C_specific_handler at D:\a\_work\1\s\src\vctools\crt\vcruntime\src\eh\riscchandler.cpp:389
 6# _chkstk in ntdll
 7# RtlRaiseException in ntdll
 8# KiUserExceptionDispatcher in ntdll
 9# QBasicMutex::lock in Qt6Core

```

**Debugger was attached at time too**

```
  Exception 0XC0000005 on thread 1892.
  Stack Trace
RetAddr           : Args to Child                                                           : Call Site
00007ff6`9d460681 : 00000260`40c90000 00007ff8`4455a153 00000000`ffffffff 00000260`4e41a7f0 : Qt6Core!QBasicMutex::lock+0x7
(Inline Function) : --------`-------- --------`-------- --------`-------- --------`-------- : qbittorrent!QMutexLocker<QMutex>::{ctor}+0x14 [D:\a\qBittorrent\Qt\6.3.0\msvc2019_64\include\QtCore\qmutex.h @ 245]
00007ff6`9d3ea3a8 : 0000008a`dccfbba8 0000008a`dccfbbc0 00000260`4e41ab00 00007ff8`52b47890 : qbittorrent!BitTorrent::ResumeDataStorage::fetchLoadedResumeData+0x31 [D:\a\qBittorrent\qBittorrent\src\base\bittorrent\resumedatastorage.cpp @ 63]
00007ff8`528c846b : 00000263`31406f80 00000000`00000000 0000008a`dccfbd40 00000263`31406f80 : qbittorrent!BitTorrent::Session::handleLoadedResumeData+0x48 [D:\a\qBittorrent\qBittorrent\src\base\bittorrent\session.cpp @ 1141]
00007ff8`528c691e : 00000260`4c971f90 00007ff8`444c362f 00000000`00000000 00000261`1c4c0ff0 : Qt6Core!QMetaCallEvent::placeMetaCall+0x3b
*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\Users\PC\Desktop\qBittorrent Releases\test\Qt6Widgets.dll - 
00007ff8`44472f6e : 00000260`47674ff0 00000260`47670e00 00000263`31406f80 00000263`31406f80 : Qt6Core!QObject::event+0x18e
00007ff8`44471f9f : 00000260`47670e00 0000008a`dccfbf90 00000000`00000000 00000261`1ce9bc38 : Qt6Widgets!QApplicationPrivate::notify_helper+0x10e
00007ff8`528834e5 : 00000260`4766ee00 00000260`4c971f90 00000263`31406f80 00000000`00000000 : Qt6Widgets!QApplication::notify+0x187f
00007ff8`52885d3f : 0000008a`dccfc449 00000000`00000000 00000260`47672f50 00000000`00000000 : Qt6Core!QCoreApplication::notifyInternal2+0xc5
*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\Users\PC\Desktop\qBittorrent Releases\test\Qt6Gui.dll - 
00007ff8`403f0f6f : 00000260`483fbfe0 0000008a`00000000 00000260`483fbfe0 00000263`31406f80 : Qt6Core!QCoreApplicationPrivate::sendPostedEvents+0x21f
00007ff8`529deda0 : 00000000`000000a4 0000008a`dccfc5e0 00000260`5aaf0f70 00000000`00000068 : Qt6Gui!QWindowsGuiEventDispatcher::sendPostedEvents+0xf
00007ff8`403f0f49 : 00000000`00000000 00000000`00000000 00000260`5aaf0f70 00000260`483fbfe0 : Qt6Core!QEventDispatcherWin32::processEvents+0x90
00007ff8`52888bef : 00000000`00000080 00000000`00000080 00000260`5aaf0f70 00000260`47674ff0 : Qt6Gui!QWindowsGuiEventDispatcher::processEvents+0x19
00007ff8`528812fd : 0000008a`dccff730 00000260`47672f50 00000260`47672f50 00000000`00000000 : Qt6Core!QEventLoop::exec+0x19f
00007ff6`9d3a8a13 : 00000260`526d2ff0 00000260`519bee10 00000000`00000000 00000260`5326aff0 : Qt6Core!QCoreApplication::exec+0x15d
00007ff6`9d3b4d6e : 00000260`4766ee00 00000260`4766cf00 00007ff6`9d40acd0 00000260`52ac6fa0 : qbittorrent!Application::exec+0x373 [D:\a\qBittorrent\qBittorrent\src\app\application.cpp @ 679]
00007ff6`9daa0cc7 : 00000000`00000001 00000260`4766aff0 00000260`4766cfc0 ffffffff`ffffffff : qbittorrent!main+0x4fe [D:\a\qBittorrent\qBittorrent\src\app\main.cpp @ 267]
00007ff6`9da6d4b2 : 00000000`00000000 00000000`00000000 00000000`00000000 00000000`00000000 : qbittorrent!WinMain+0x157 [C:\Users\qt\work\qt\qtbase\src\entrypoint\qtentrypoint_win.cpp @ 97]
(Inline Function) : --------`-------- --------`-------- --------`-------- --------`-------- : qbittorrent!invoke_main+0x21 [D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl @ 102]
00007ff8`773c7034 : 00000000`00000000 00000000`00000000 00000000`00000000 00000000`00000000 : qbittorrent!__scrt_common_main_seh+0x106 [D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl @ 288]
00007ff8`77d02651 : 00000000`00000000 00000000`00000000 00000000`00000000 00000000`00000000 : KERNEL32!BaseThreadInitThunk+0x14
00000000`00000000 : 00000000`00000000 00000000`00000000 00000000`00000000 00000000`00000000 : ntdll!RtlUserThreadStart+0x21
  Action limit of 1 reached for Exception 'C0000005::'.
```"
1145929455,16840,glassez,2022-06-03T12:47:55Z,"> ![image](https://user-images.githubusercontent.com/65210810/171595968-c91f0c12-62ce-450d-91d8-d18592c93f45.png) My speed tracking is still wildly incorrect on [50ed0fc](https://github.com/qbittorrent/qBittorrent/commit/50ed0fc6491406c6346207fd364ca7955175c877)

I confirm that this is definitely not a problem of this PR. Fix is on the way."
1145932083,16840,glassez,2022-06-03T12:51:04Z,"> Testing under portable mode with defaults & switching from `fastreume` -> `sql` & back again etc. between tests.

Confirmed a bug. Working on it..."
1146081797,16840,glassez,2022-06-03T15:33:06Z,"> > Testing under portable mode with defaults & switching from `fastreume` -> `sql` & back again etc. between tests.
> 
> Confirmed a bug. Working on it...

Should be fixed now."
1146101387,16840,glassez,2022-06-03T15:57:08Z,">every restart some torrents lose their trackers

This can be related with https://github.com/arvidn/libtorrent/issues/6896."
1146612389,16840,xavier2k6,2022-06-04T13:31:40Z,">Should be fixed now.

Confirm, no crashes anymore."
1146613410,16840,xavier2k6,2022-06-04T13:36:11Z,"> > every restart some torrents lose their trackers
> 
> This can be related with [arvidn/libtorrent#6896](https://github.com/arvidn/libtorrent/issues/6896).

I don't know if that `libtorrent` ticket (haven't tested with it) has any relevance with this observation but...........

When switching from `fastresume` ->  `SQL` & back again repeatedly between tests, it sometimes doesn't count all `10,000` torrents it shows as `ALL` -> `5,300` or `6,700` or `7,100`.

From screenshot below, you can see that I have the torrents sorted by name & there are torrents missing/not loaded.

eg. `file0001.bin`, `file0005.bin` -> `file0008.bin`,  `file00014.bin` -> `file00016.bin` etc. missing.

![7100](https://user-images.githubusercontent.com/42386382/172002812-acfd986b-9a23-481b-a0f4-fd45ef014f25.png)
"
1146639626,16840,glassez,2022-06-04T15:55:15Z,"> From screenshot below, you can see that I have the torrents sorted by name & there are torrents missing/not loaded.
> 
> eg. `file0001.bin`, `file0005.bin` -> `file0008.bin`, `file00014.bin` -> `file00016.bin` etc. missing.

Is there anything suspicious in the log?
Does qBittorrent behave normally after it is fully started?
What happens if you restart qBittorrent after that corrupted start without changing the storage type?"
1146641492,16840,xavier2k6,2022-06-04T16:05:12Z,">Is there anything suspicious in the log?

Majority of torrents starting with filename `file00xx.bin` not showing as restored.
No errors/warnings.

>Does qBittorrent behave normally after it is fully started?

seems to from what I've observed.

>What happens if you restart qBittorrent after that corrupted start without changing the storage type?

It will stay showing the `7,100` etc.

Just changed the storage type again & received a crash, however - the copy/paste didn't seem to have taken effect.

Will try to get it to happen again.......qbytearray was part of it....."
1146643044,16840,xavier2k6,2022-06-04T16:13:44Z,"qBittorrent has crashed
Please file a bug report at http://bugs.qbittorrent.org and provide the following information:





qBittorrent version: v4.5.0alpha1 (64-bit)
Libtorrent version: 2.0.6.0
Qt version: 6.3.0
Boost version: 1.79.0
OpenSSL version: 3.0.3
zlib version: 1.2.12
OS version: Windows 10 Version 2009 10.0.19044 x86_64

Caught signal: SIGSEGV
```
 0# boost::stacktrace::basic_stacktrace >::init at D:\a\qBittorrent\boost\boost\stacktrace\stacktrace.hpp:77
 1# getStacktrace at D:\a\qBittorrent\qBittorrent\src\app\stacktrace.cpp:35
 2# `anonymous namespace'::abnormalExitHandler at D:\a\qBittorrent\qBittorrent\src\app\signalhandler.cpp:103
 3# _seh_filter_exe at minkernel\crts\ucrt\src\appcrt\misc\exception_filter.cpp:219
 4# `__scrt_common_main_seh'::`1'::filt$0 at D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:304
 5# __C_specific_handler at D:\a\_work\1\s\src\vctools\crt\vcruntime\src\eh\riscchandler.cpp:389
 6# _chkstk in ntdll
 7# RtlRaiseException in ntdll
 8# KiUserExceptionDispatcher in ntdll
 9# QtPrivate::QPropertyBindingData::~QPropertyBindingData in Qt6Core
10# QBindingStorage::clear in Qt6Core
11# QObject::~QObject in Qt6Core
12# operator





"
1146645248,16840,glassez,2022-06-04T16:28:40Z,"> It will stay showing the `7,100` etc.

Are the missing torrents the same? (although it's hard to test with so many, but at least on some small subset)
Could you also check the current amount of data in the storage itself?
Does this problem happen with any type of storage, or just one of them?"
1146658761,16840,xavier2k6,2022-06-04T17:50:54Z,">qBittorrent has crashed
Please file a bug report at http://bugs.qbittorrent.org and provide the following information:





qBittorrent version: v4.5.0alpha1 (64-bit)
Libtorrent version: 2.0.6.0
Qt version: 6.3.0
Boost version: 1.79.0
OpenSSL version: 3.0.3
zlib version: 1.2.12
OS version: Windows 10 Version 2009 10.0.19044 x86_64

Caught signal: SIGSEGV
```
 0# boost::stacktrace::basic_stacktrace >::init at D:\a\qBittorrent\boost\boost\stacktrace\stacktrace.hpp:77
 1# getStacktrace at D:\a\qBittorrent\qBittorrent\src\app\stacktrace.cpp:35
 2# `anonymous namespace'::abnormalExitHandler at D:\a\qBittorrent\qBittorrent\src\app\signalhandler.cpp:103
 3# _seh_filter_exe at minkernel\crts\ucrt\src\appcrt\misc\exception_filter.cpp:219
 4# `__scrt_common_main_seh'::`1'::filt$0 at D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:304
 5# __C_specific_handler at D:\a\_work\1\s\src\vctools\crt\vcruntime\src\eh\riscchandler.cpp:389
 6# _chkstk in ntdll
 7# RtlRaiseException in ntdll
 8# KiUserExceptionDispatcher in ntdll
 9# QBitArray::QBitArray in Qt6Core

```"
1146660427,16840,xavier2k6,2022-06-04T18:02:41Z,"> Are the missing torrents the same? (although it's hard to test with so many, but at least on some small subset)

Will check....

>Could you also check the current amount of data in the storage itself?

Do you mean the `torrents` database file contents or file size as the size seems to vary alright on the amount of test torrents being loaded/displayed. (when they don't display correctly/fully)

>Does this problem happen with any type of storage, or just one of them?

It seems to be just going from one storage to the other & then back again.

eg.
Start off with default of `fastresume` & after test torrents are loaded/displaying `10,000`, change storage type to `sql` & exit qBittorrent, now re-open it."
1146661943,16840,glassez,2022-06-04T18:11:07Z,"> Start off with default of `fastresume` & after test torrents are loaded/displaying `10,000`, change storage type to `sql` & exit qBittorrent, now re-open it.

I wanted to find out if it happens in both directions? I.e. when switching `sql -> fastresume` too."
1146662968,16840,xavier2k6,2022-06-04T18:17:22Z,">I wanted to find out if it happens in both directions? I.e. when switching `sql -> fastresume` too

Seems to be `sql -> fastresume ->sql` & `fastresume ->sql -> fastresume` for both recent crashes....

The wrongly displayed torrents seemed to have disappeared when I changed backup log size to `1024` from default of `66` but I can get it to reproduce quickly by changing the `save fastresume interval` to `1min`"
1146890175,16840,oorzkws,2022-06-05T21:57:36Z,"I'm still getting all trackers stuck at ""not contacted yet"" after some uptime. Not sure what's going on here.
![image](https://user-images.githubusercontent.com/65210810/172072268-016ff511-1bf6-43c0-919a-51ca5eb5b2a3.png)

Last activity was some 19h ago despite the watch folder having around 30 files added in that time."
1148441959,16840,glassez,2022-06-07T09:43:31Z,"> I'm still getting all trackers stuck at ""not contacted yet"" after some uptime. Not sure what's going on here

Do you mean at some point in time before all torrents are restored, or after that? Note that current implementation delays starting any BitTorrent communication until all the torrents are restored to decrease startup time. Is this behavior undesirable?"
1149255515,16840,oorzkws,2022-06-07T23:05:10Z,"> > I'm still getting all trackers stuck at ""not contacted yet"" after some uptime. Not sure what's going on here
> 
> Do you mean at some point in time before all torrents are restored, or after that? Note that current implementation delays starting any BitTorrent communication until all the torrents are restored to decrease startup time. Is this behavior undesirable?

Some time after. qBittorrent functions normally for at least several hours of uptime, but it seems to sometimes then get stuck and put all trackers into ""not contacted yet"""
1149517837,16840,ghost,2022-06-08T06:31:59Z,"> > > I'm still getting all trackers stuck at ""not contacted yet"" after some uptime. Not sure what's going on here
> > 
> > 
> > Do you mean at some point in time before all torrents are restored, or after that? Note that current implementation delays starting any BitTorrent communication until all the torrents are restored to decrease startup time. Is this behavior undesirable?
> 
> Some time after. qBittorrent functions normally for at least several hours of uptime, but it seems to sometimes then get stuck and put all trackers into ""not contacted yet""

Does the network go offline during these several hours? qBit may not be accouting for new endpoints created after network is back up! You could check the logs to see if there's anything relevant."
1149534551,16840,glassez,2022-06-08T06:54:53Z,"@oorzkws 
If qBittorrent starts to function normally after all torrents are restored then everything else is more likely not a problem of this PR."
1149632971,16840,oorzkws,2022-06-08T08:42:43Z,"> Does the network go offline during these several hours? qBit may not be accouting for new endpoints created after network is back up! You could check the logs to see if there's anything relevant.

Not that I can see, neither network wise or in the log. I'll check specifically for this next time it happens.

> @oorzkws If qBittorrent starts to function normally after all torrents are restored then everything else is more likely not a problem of this PR.

No problems then, startup is much faster and without issues. It seems any remaining issues are outside of this PR and just cropped up moving from 4.4.2 to the git versions this is based on."
1156216180,16840,glassez,2022-06-15T09:16:00Z,"PR updated:
1. Prevent regular resume data generation until session is restored
2. Prevent adding new torrents until session is restored (I can't imagine an easy enough way to allow it; anyway it wasn't possible before as well)

Please test it again. I currently don't have access to a powerful enough machine to test a large number of torrents. With a small amount, it seems to be working normally."
1157551404,16840,oorzkws,2022-06-16T11:29:02Z,">     2. Prevent adding new torrents until session is restored (I can't imagine an easy enough way to allow it; anyway it wasn't possible before as well)
Quick question on this one, this also applies to watch folders - it won't remove the files until it can add them properly?"
1157567769,16840,glassez,2022-06-16T11:48:25Z,"> this also applies to watch folders - it won't remove the files until it can add them properly?

Yes. At least that's what it's meant to be."
1158716232,16840,oorzkws,2022-06-17T10:04:05Z,"
![image](https://user-images.githubusercontent.com/65210810/174279522-eb32c20f-c699-44c9-92ff-5e9354dd4475.png)

Does this build change logging at all or is it possibly a different master commit that has my log without newlines? Sorry for bothering you with these end-user questions, I have difficulty tracking the individual changes with the forced pushes."
1158922096,16840,glassez,2022-06-17T14:22:15Z,"> Does this build change logging at all or is it possibly a different master commit that has my log without newlines?

Probably [this](https://github.com/qbittorrent/qBittorrent/commit/fed969ed64f7812a5e0cc65e554c974e914b9074).
@Chocobo1, ping!"
1158924073,16840,glassez,2022-06-17T14:24:19Z,PR is updated. Fixed a bug.
1159364545,16840,Chocobo1,2022-06-18T05:13:03Z,"> > Does this build change logging at all or is it possibly a different master commit that has my log without newlines?
> 
> Probably [this](https://github.com/qbittorrent/qBittorrent/commit/fed969ed64f7812a5e0cc65e554c974e914b9074). @Chocobo1, ping!

Fixed in PR #17233."
1159459175,16840,glassez,2022-06-18T12:49:28Z,"I ran it several times with 10,000 test torrents, changing the storage type each time. No problems noticed."
1159459764,16840,oorzkws,2022-06-18T12:53:57Z,"So far, so good on my end. Running your latest revision as of this comment."
1159489704,16840,kasper93,2022-06-18T16:07:46Z,"One test case to keep in mind is to test data consistency when qbittorrent is closed before everything is loaded. Currently (on master) when it is closed before fastresume data is loaded, next run will require full recheck on torrents. Adding more async loading requires proper synchronization between loading/saving. "
1159490822,16840,xavier2k6,2022-06-18T16:14:08Z,"> I ran it several times with 10,000 test torrents, changing the storage type each time. No problems noticed.

Will test later.

If you rebase on current master again, I would then be able to provide windows build with latest libtorrent RC_2_0 commit if necessary?!"
1159513761,16840,glassez,2022-06-18T16:47:40Z,"> Currently (on master) when it is closed before fastresume data is loaded, next run will require full recheck on torrents.

I didn't notice anything like that.
I added some real torrents to the 10,000 test torrents, and I tried closing qBittorrent before all torrents were restored. I also tested the case of deleting a torrent during startup - it works correctly even if I closed the application before startup is done.
BTW, in case you missed it:
> 1. Prevent regular resume data generation until session is restored"
1159519884,16840,xavier2k6,2022-06-18T17:27:58Z,"@oorzkws & anyone else, you can try below windows build based on this PR with latest `libtorrent RC_2_0 commit`

NOTE: `Qt 6.3.1` was used for this build & seems do display all columns in `transferlist` at initial startup.

https://github.com/xavier2k6/qBittorrent/suites/6990610218/artifacts/273778662"
1159577656,16840,xavier2k6,2022-06-18T22:49:01Z,"@glassez I know what the SQL displaying inconsistent torrents issue is. (unrelated to this PR as I can reproduce in `master` too)

Change `resume data storage type` to SQLite & a `torrents` database file is created in `data folder` (as expected)

This ~`13.5MB` database file takes ~`3mins` for the amount of test torrents `10,000` to be completely created because it's updating between ~`40KB-64KB p/s`

Exit qBittorrent before the database is completely created, so for example after 1 minute.

The database file will not be ~`13.5MB` & it's size will vary depending on when you close qBittorrent, hence various torrents being displayed.

You can delete the inconsistent database file & a new one will be created but because it's updating so slowly - you will have to wait the full 3 mins or so for it to be completely created before you can close qBittorrent again to avoid the inconsistency."
1159583368,16840,oorzkws,2022-06-18T23:47:01Z,"> @oorzkws & anyone else, you can try below windows build based on this PR with latest `libtorrent RC_2_0 commit`


I've been testing builds on the RC alongside for a few weeks 🙂 since I was losing tracker info every restart otherwise "
1159613298,16840,glassez,2022-06-19T04:14:34Z,"> @glassez I know what the SQL displaying inconsistent torrents issue is. (unrelated to this PR as I can reproduce in `master` too)

Well, it looks like you've exposed the problem of unfinished/incomplete conversion of data from one type of storage to another. Currently, it happens ""on the fly"" during session startup. After merging this PR, I should think about changing it so that the conversion becomes a separate task with some integrity control."
1159681688,16840,xavier2k6,2022-06-19T10:23:52Z,"Haven't observed any operational issues, but what I have observed is that if you click on the `general` tab & maximize it - the counting of torrents under `All` & `checking` in `filters list` speeds up quite quickly.....(All `10,000` test torrents are in `paused` state) & the same observations can be seen if say I select `error` (which will be `0` as expected) under the `filters list`

![maximize general tab](https://user-images.githubusercontent.com/42386382/174476401-0ef6aac0-e4b7-48d6-a321-d710017c56bf.png)"
1159698198,16840,glassez,2022-06-19T11:36:01Z,"@xavier2k6 
This is quite expected. The population of GUI elements is still quite expensive. I've been talking about this since the dawn of my research in the field of startup improvement. If we want to reduce the launch time as much as possible, then we must completely abandon the GUI population until BitTorrent session is restored. So I'm thinking of implementing this method as an option later.
Or do you think that the (current) method with continuous updating of GUI is completely useless to abandon it from the very beginning? (@Chocobo1, it echoes your suggestion above.) I think there is not much difference in the case of a small number of torrents. This will mainly affect those who have thousands of torrents in a session.
@oorzkws, what do you say?"
1159708957,16840,xavier2k6,2022-06-19T12:16:05Z,">This is quite expected.

I know, was only providing feedback so let's say if a general/less informed user wondered of a way they could speed things up.....they may come across the comment & be happy enough with that suggestion.

It wasn't a critique

>do you think that the (current) method with continuous updating of GUI is completely useless to abandon it from the very beginning?

Not at all & I think (I'm open to correction on this) in a previous PR we toyed with that kind of scenario.

It's most preferable that the GUI is at least usable even if it takes time to fully display the amount of torrents loaded & at least the user can see what's going on.

I'd be more than happy to have this approved/merged as to me this is an improvement & any issues regarding phrasing/wording is very trivial IMO."
1159718596,16840,oorzkws,2022-06-19T12:53:20Z,"> The population of GUI elements is still quite expensive. I've been talking about this since the dawn of my research in the field of startup improvement. If we want to reduce the launch time as much as possible, then we must completely abandon the GUI population until BitTorrent session is restored. So I'm thinking of implementing this method as an option later. Or do you think that the (current) method with continuous updating of GUI is completely useless to abandon it from the very beginning? (@Chocobo1, it echoes your suggestion above.) I think there is not much difference in the case of a small number of torrents. This will mainly affect those who have thousands of torrents in a session. @oorzkws, what do you say?

My thoughts boil down to two points:
1. I use the total count to gauge how far startup has progressed, so having the numbers updated sometimes is useful
2. Why not obey ""transfer list refresh interval""? It doesn't seem to now, and that would give a pretty easy gain with the user able to tweak the timing. I currently have my list refresh every 30s, so I would likely see some gain from it.
"
1159722483,16840,ghost,2022-06-19T13:09:35Z,"While hundreds of torrents are loading in the transfer list, I don't think it's possible to select a torrent and perform some activity sanely. It would be better to hide the transfer list till session gets restored."
1159783718,16840,glassez,2022-06-19T17:50:53Z,"> 1. I use the total count to gauge how far startup has progressed, so having the numbers updated sometimes is useful

If it was just a text like ""Torrents are resuming. Done 255 out of 10000. Please wait..."", would that suit you?


> While hundreds of torrents are loading in the transfer list, I don't think it's possible to select a torrent and perform some activity sanely. It would be better to hide the transfer list till session gets restored.

Do you really have many torrents in regular use?"
1159784111,16840,glassez,2022-06-19T17:54:04Z,"In fact, a UI that is unavailable during startup, displaying only the progress of execution, could get rid of most possible conflicts, and would speed up the startup itself."
1160021145,16840,ghost,2022-06-20T06:19:36Z,">Do you really have many torrents in regular use?
>

If you have many torrents, that means you're a long term seeder. And when you're a long term seeder, you don't start the client just to do some minor task on one torrent out of thousands. So if they have to wait some time for the GUI to be functional, I think that shouldn't hurt."
1161773084,16840,glassez,2022-06-21T13:47:14Z,"@Chocobo1
As for the WebUI/WebAPI, the best/reliable/easily implemented way is to make it available only after the session is restored, IMO (even in the current version of this PR)."
1162656903,16840,Chocobo1,2022-06-22T05:24:49Z,">@Chocobo1
As for the WebUI/WebAPI, the best/reliable/easily implemented way is to make it available only after the session is restored, IMO (even in the current version of this PR).

I suppose that make sense."
1168983648,16840,ghost,2022-06-28T16:54:32Z,I would say we should merge this commit with current improvements and make the other GUI related changes later in separate PR since this has been lingering for a long time.
1169003830,16840,glassez,2022-06-28T17:13:28Z,"> > @Chocobo1
> > As for the WebUI/WebAPI, the best/reliable/easily implemented way is to make it available only after the session is restored, IMO (even in the current version of this PR).
> 
> I suppose that make sense.

Done."
1171110440,16840,glassez,2022-06-30T11:37:09Z,"> I would say we should merge this commit with current improvements and make the other GUI related changes later in separate PR since this has been lingering for a long time.

I would prefer it to be done this way.
This PR has achieved its original goal, so it would be convenient to add further improvements if it is merged, rather than wasting time on permanent conflict resolution or suspending conflicting PRs indefinitely.
Trying to make the seemingly simple changes mentioned above, I once again stumbled upon the confusing legacy code of GUI classes, so it will take more time than I expected. I would like to make some preliminary changes in a separate PR.
@Chocobo1, what do you say?"
1171198608,16840,Chocobo1,2022-06-30T13:08:37Z,">I would like to make some preliminary changes in a separate PR.

Then IMO unnecessary GUI changes in this PR should be dropped (such as the torrent creator changes and other isRestored checks in GUI). Those are, as mentioned before, doesn't scale well.

>I would say we should merge this commit with current improvements and make the other GUI related changes later in separate PR since this has been lingering for a long time.

Sure, I don't mind.
But someone still has to skim through the code to prevent some trivial mistakes. Currently that burden relies on only me and it is getting hard for me to allocate time for reviewing complex changes. It would be easier if others can join/help on this task."
1171271532,16840,glassez,2022-06-30T14:11:15Z,"> Then IMO unnecessary GUI changes in this PR should be dropped (such as the torrent creator changes and other isRestored checks in GUI). Those are, as mentioned before, doesn't scale well.

Do you mean to remove it from this PR before merging it?"
1171951213,16840,Chocobo1,2022-07-01T05:28:41Z,">Do you mean to remove it from this PR before merging it?

Yes."
1173010599,16840,glassez,2022-07-03T04:41:35Z,"> > Do you mean to remove it from this PR before merging it?
> 
> Yes.

Done."
1173607869,16840,glassez,2022-07-04T09:53:26Z,Many thanks to everyone who participated in this venture!
1174612141,16840,oorzkws,2022-07-05T04:57:11Z,"Cheers, thanks for the hard work"
1187695123,16840,a-raccoon,2022-07-18T16:14:32Z,"> > Do you really have many torrents in regular use?
> 
@summerqB wrote:
> If you have many torrents, that means you're a long term seeder. And when you're a long term seeder, you don't start the client just to do some minor task on one torrent out of thousands. So if they have to wait some time for the GUI to be functional, I think that shouldn't hurt.

Incorrect.  I am a long time leecher who downloads tens of thousands of torrents, completes them, seeds only the unhealthy/at-risk ones, but then tags the completed torrents as ""(archived)"" and assigns them to the ""(archived)"" category.  Move the files off to platter and then force-recheck so they revert back to ""0% complete"".

I keep them loaded in qbt, instead of deleting them, so that I don't download the same torrent twice.  I will add 100 or 1000 magnet links at a time, and qbt will automatically skip adding torrents that I already have loaded (as archived).  I just look at my untagged/uncategorized torrents to find those that have been newly added, and organize them accordingly.  No duplicates.

By keeping these old archived torrents loaded in qbt, I can always look back at their history to recall if/when I downloaded them and to quickly copy-paste their magnet links to another client or seedbox.  This would be impossible had I deleted them.

I only have 600 to 2000 active incomplete torrents, and >25,000 completed archived ones."
1187722018,16840,ghost,2022-07-18T16:39:31Z,"> I am a long time leecher
>
I thought my comment was about long term seeders who do not archieve torrents once they reach certain goal.

Anyways, the implementation where torrents are actively populated on GUI as they're being loaded, does not guarantee that the torrent you're looking to perform an action on is loaded immediately. It may be loaded as the last torrent as well. It was also determined that it delays the startup to some extent as well due to having to draw the changes actively in the UI.
So making the GUI available only after all torrents have restored was decided to be the best course of action."
1187812241,16840,glassez,2022-07-18T17:16:01Z,"> It was also determined that it delays the startup to some extent as well due to having to draw the changes actively in the UI.
> So making the GUI available only after all torrents have restored was decided to be the best course of action.

:+1:
"
174351560,4681,sledgehammer999,2016-01-24T23:18:43Z,"@qbittorrent/qbittorrent-frequent-contributors 
"
175006441,4681,Chocobo1,2016-01-26T13:14:50Z,"![pic](https://cloud.githubusercontent.com/assets/9395168/12581374/230db638-c471-11e5-9b6e-456b932101f2.jpg)
I wonder if the items in the red box can be put on the same line, i.e. don't use groupbox here
"
175582399,4681,glassez,2016-01-27T11:56:51Z,"> I wonder if the items in the red box can be put on the same line

I think Yes. Like on the line above.
"
175894101,4681,sledgehammer999,2016-01-27T22:30:17Z,"> I wonder if the items in the red box can be put on the same line

How to signify enable/disable? My thought is to convert the ""After"" QLabel to a QCheckBox.
"
177413494,4681,Chocobo1,2016-01-31T06:43:31Z,"> How to signify enable/disable? My thought is to convert the ""After"" QLabel to a QCheckBox.

I just think putting them on the same line is enough.
![test](https://cloud.githubusercontent.com/assets/9395168/12700746/d7507566-c829-11e5-9a82-78d23e4a9fe1.png)
"
178271231,4681,sledgehammer999,2016-02-02T00:24:13Z,"Rebased and applied your observations. Start reviewing from the 6th commit onwards. I did separate commits to ease your review. Those commits will be squashed into their respective first 5 commits.
"
178271785,4681,sledgehammer999,2016-02-02T00:26:55Z,"**Rant:** I wish Github ordered the commits by commit date and not author date. I first randomly commited stuff and then rearranged the commits, but it doesn't show in this history. Luckily git's history sorts by commit date
"
178725323,4681,sledgehammer999,2016-02-02T18:04:46Z,"(fixed travis)
"
178740770,4681,sledgehammer999,2016-02-02T18:28:20Z,"@glassez tell me if it is ok to merge when you're ready.
"
178775657,4681,glassez,2016-02-02T19:29:31Z,"@sledgehammer999 I finished the review.
"
192535236,4681,sledgehammer999,2016-03-05T00:27:19Z,"> @sledgehammer999: If you're still planning on merging this in, you should probably rebase. 

I know you're trying to help but this comment was unnecessary. I am both the PR author and the one that will merge. So I'll know I need rebasing.
"
195124149,4681,zeule,2016-03-11T01:05:22Z,"@sledgehammer999: I just wonder why file log here is custom implemented instead of, say, boost::logging (since libtorrent anyway gives us boost as a dependency). Is is a project policy or there is another reason behind this decision?
"
196036438,4681,sledgehammer999,2016-03-13T19:51:13Z,"I pushed an updated version. I implemented most of the stuff you talked about. Start reviewing from commit `Remove redundant variable.` onwards.
Pretty much all commits will be squashed before final merge.

Here is how the new options look:
![untitled](https://cloud.githubusercontent.com/assets/273315/13730908/a2755eee-e965-11e5-9aec-135c2930dca0.jpg)
"
196037154,4681,sledgehammer999,2016-03-13T19:54:34Z,"> @sledgehammer999: I just wonder why file log here is custom implemented instead of, say, boost::logging (since libtorrent anyway gives us boost as a dependency). Is is a project policy or there is another reason behind this decision?

Actually I didn't investigate on other logging libraries. I wanted something custom and ""lightweight"". I assume other libs implement a ton of stuff that we don't need.
There isn't a project policy that discourages using other libs. But not for trivial stuff. eg we use QJson for qt4 builds.
"
196132519,4681,glassez,2016-03-14T04:22:59Z,"> @sledgehammer999: I believe @glassez would point out that your backup/delete feature uses the  preferences  class which he apparently deprecated in commit [ d05d5a8 ] during development of the ASM feature.

Sure. There is my comment on it here.
As I said, I don't insist anyone to fix existing code, but we should not use this in new code (I mean, we don't have to add anything to Preferences).
"
196296058,4681,sledgehammer999,2016-03-14T12:48:27Z,"@glassez I pushed a new commit using Settings Storage.
I am not sure I have done it correctly. Also I need your help. I am lost. I don't know how to migrate the `FileLogger::configure()` and `Application::configure()` which reacted to changed Preferences to the new system. I have migrated some of it, but currently it **will not react**:
1. If user disables file logging
2. If user changes log path
3. If user enables/disables ""delete old backup"" files or changes the age to delete them.
"
196310903,4681,sledgehammer999,2016-03-14T13:32:21Z,"> @glassez: Please rescue @sledgehammer999 from this mess. 

Please stop doing that. He is already notified by my earlier comment.
Also don't delete your comments when someone quotes them or responds to you. You make him like a crazy person talking at the wind.
"
196387713,4681,glassez,2016-03-14T16:09:56Z,"> I am not sure I have done it correctly.

You're right. You done it incorrectly.
Apparently, I need to describe the principles of the new code:
1. Components owns its properties and stores/loads needed data from SettingsStorage itself. The main thing is to understand which property relates to a component (this is not always evident at first sight).
2. No `configure()` slot in new classes. All things we need to do when properties changed we should do in appropriate property setters.
3. Properties should be implemented as setter/getter pair (or only as getter if property is read only). Setter/Getter are usually non-static methods (AddNewTorrentDialog is bad example so it's exception from this rules).
4. If some component needs to store some private data in SettingsStorage (e.g. its state) there are no getter/setter for this data (or some private helper methods if needed).
5. All non-toplevel components should be accessible as properties of toplevel components (e.g. Application::fileLogger()) so we can get/set its properties. If some component is non full time existed (as FileLogger) we need check its existence before access its properties.

I've implemented AddNewTorrentDialog::isEnabled() (and other property) as static method because we really do nothing when we change these properties. But this way is incorrect for FileLogger. Really we haven't FileLogger::isEnabled property but we have Application::isFileLoggerEnabled. Example:

``` c++
void Application::setFileLoggerEnabled(bool enabled)
{
    if (enabled) {
        if (!m_fileLogger) {
            m_fileLogger = new FileLogger;
            // store in settings here
        }
    }
    else {
        if (m_fileLogger) {
            delete m_fileLogger;
            // store in settings here
        }
    }
}
```

@sledgehammer999 I hope I have covered it fully. But you are free to ask more questions.
"
196392835,4681,sledgehammer999,2016-03-14T16:20:18Z,"Yes, I think I am ok with your explanation. As you guessed it I took AddNewTorrentDialog as an example.
I apparently need to implement this one level up.
FileLogger goes to Application and ExecutionLog to MainWindow.
I'll give it another try in a few moments.
"
196564483,4681,sledgehammer999,2016-03-14T23:27:46Z,"Hmm, I was going to start but I already hit a wall. `FileLogger` properties need to be loaded/stored from options_imp.cpp too. How do I do that? Do I need to pass an `Application` pointer to options_imp ?
"
196630950,4681,glassez,2016-03-15T03:11:03Z,"Application is Singleton. You can access it via `static_cast<Application*>(QCoreApplication::instance())`.
"
198138278,4681,sledgehammer999,2016-03-18T00:01:14Z,"> Application is Singleton. You can access it via static_cast<Application*>(QCoreApplication::instance()).

OK.
And that means that options_imp will also have to have access to the mainwindow pointer(for the other unported settings) , right?
"
198206411,4681,glassez,2016-03-18T04:50:03Z,"> And that means that options_imp will also have to have access to the mainwindow pointer(for the other unported settings) , right?

Right.
It is accessible via Application.
"
198975960,4681,sledgehammer999,2016-03-20T18:08:52Z,"I squashed commits. I implemented the suggestions and rebased. The convertion to SettingsStorage will remain in a separate commit, because I want all the previous ones to include them in v3.3.4.
SettingsStorage along with ASM will be released in v3.3.5.

@glassez can you review my new attempt at SettingsStorage?
I have realized a possible ""bug zone"" for bigger components. As you can see in options_imp I reordered how the settings are saved for FileLogger, otherwise the setters wouldn't work properly. eg If I first set the enable property and then the backup property filelogger will use the old backup value for a brief moment.
I assume that converting the Session class will need extra care for these subtle bugs.

I also decided to have each component live under its own namespace(?) in the text file without mentioning the parent that they belong in. For example filelogger saves settings under `FileLogger/` path and not `Application/FileLogger/`. Is that ok?
"
199137198,4681,glassez,2016-03-21T05:52:52Z,"> I have realized a possible ""bug zone"" for bigger components. As you can see in options_imp I reordered how the settings are saved for FileLogger, otherwise the setters wouldn't work properly. eg If I first set the enable property and then the backup property filelogger will use the old backup value for a brief moment.

Everything is logical and it always has been, just in a different place. Just it looked not so clearly. I don't think it will give us problems.

> I also decided to have each component live under its own namespace(?) in the text file without mentioning the parent that they belong in. For example filelogger saves settings under FileLogger/ path and not Application/FileLogger/. Is that ok?

In this case, we do not have the FileLogger settings, only the Application settings. So consider using names like ""Application/FileLoggerEnabled"" and so on. It turns out that we do not have a standalone FileLogger component.
"
199169655,4681,glassez,2016-03-21T08:25:59Z,"@sledgehammer999 I finished with this PR.
"
199389476,4681,sledgehammer999,2016-03-21T17:28:48Z,"> In this case, we do not have the FileLogger settings, only the Application settings. So consider using names like ""Application/FileLoggerEnabled"" and so on. It turns out that we do not have a standalone FileLogger component

But won't this become cumbersome? I mean, eg MainWindow might turn up with very long options names. Or depending on the option it may look too big(?) eg ""Application/FileLoggerAgeType"" or ""Application/FileLoggerDeleteOld""
"
199397999,4681,glassez,2016-03-21T17:44:40Z,"> But won't this become cumbersome? I mean, eg MainWindow might turn up with very long options names. Or depending on the option it may look too big(?) eg ""Application/FileLoggerAgeType"" or ""Application/FileLoggerDeleteOld""

Ok. Let it be as you suggested.
But why are you against nested names?
"
199401591,4681,sledgehammer999,2016-03-21T17:54:10Z,"> But why are you against nested names?

I don't have a solid reason. I just feel that it is more manageable without it. However, I like much more `Application/FileLogger/Enabled` instead of `Application/FileLoggerEnabled`.

I'll reconsider nested names, because I realized once the SettingsStorage convertion is complete we might end up with a shitload of small modules in the ini files. Not manageable at all.
"
199442172,4681,glassez,2016-03-21T19:35:17Z,"> I'll reconsider nested names, because I realized once the SettingsStorage convertion is complete we might end up with a shitload of small modules in the ini files. Not manageable at all.

+1
"
199564008,4681,sledgehammer999,2016-03-22T00:47:52Z,"I think I'll switch to nested names. Would the following be considered ok or does it constitute preprocessor abuse?

``` c++
namespace
{
#define SETTINGS_KEY(name) ""Application/"" name

    // FileLogger properties keys
#define FILELOGGER_SETTINGS_KEY(name) SETTINGS_KEY(""FileLogger/"") name
    const QString KEY_FILELOGGER_ENABLED = FILELOGGER_SETTINGS_KEY(""Enabled"");
    const QString KEY_FILELOGGER_PATH = FILELOGGER_SETTINGS_KEY(""Path"");
    const QString KEY_FILELOGGER_BACKUP = FILELOGGER_SETTINGS_KEY(""Backup"");
    const QString KEY_FILELOGGER_DELETEOLD = FILELOGGER_SETTINGS_KEY(""DeleteOld"");
    const QString KEY_FILELOGGER_MAXSIZE = FILELOGGER_SETTINGS_KEY(""MaxSize"");
    const QString KEY_FILELOGGER_AGE = FILELOGGER_SETTINGS_KEY(""Age"");
    const QString KEY_FILELOGGER_AGETYPE = FILELOGGER_SETTINGS_KEY(""AgeType"");

    // Other class properties keys (just an example for this snippet)
#define OTHER_CLASS_SETTINGS_KEY(name) SETTINGS_KEY(""OtherClass/"") name
    const QString KEY_OTHER_CLASS_ENABLED = OTHER_CLASS_SETTINGS_KEY(""Enabled"");

    //just a shortcut
    inline SettingsStorage *settings() { return  SettingsStorage::instance(); }

    const QString LOG_FOLDER(""logs"");
    const char PARAMS_SEPARATOR[] = ""|"";
}
```
"
199629570,4681,glassez,2016-03-22T04:07:06Z,"> Would the following be considered ok or does it constitute preprocessor abuse?

I don't think it will tire the preprocessor
"
201596649,4681,sledgehammer999,2016-03-25T23:53:49Z,"Thanks for reviewing. Final suggestions implemented. Pushed to master.
"
222038289,5310,sledgehammer999,2016-05-27T01:26:00Z,"@tekko @thalieht @qbittorrent/qbittorrent-frequent-contributors 
"
222039700,5310,sledgehammer999,2016-05-27T01:38:02Z,"Can someone can tell me why travis fails at the linking stage? I don't understand the error message.
"
222057767,5310,Chocobo1,2016-05-27T04:30:03Z,"I didn't review fully:
1. I would vote to use 3rd attempt code, it's much clearer.
2. Maybe it would be better to return an array of ints instead of QString, converting back and forth is a waste of CPU.
"
222088738,5310,glassez,2016-05-27T08:21:21Z,"> Can someone can tell me why travis fails at the linking stage? I don't understand the error message.

Try to include ""libtorrent/address.hpp"" instead of your forward declaration.
"
222099752,5310,glassez,2016-05-27T09:16:47Z,"It is compiled for me with libtorrent-1.1 (I mean this PR unchanged).
"
222171726,5310,sledgehammer999,2016-05-27T15:08:29Z,"PR updated.
However, the linking error remains. I am able to reproduce locally with mingw too. MSVC doesn't have this problem. It is a problem with headers because the error happens at the linking stage.

> ./release\filterparserthread.o:filterparserthread.cpp:(.text$_ZN18FilterParserThread14parseIPAddressE7QStringRN5boost4asio2ip7addressE+0x236): undefined reference to `boost::asio::ip::address::operator=(boost::asio::ip::address&&)'

Look at the signature. Isn't that something about move semantics in C++11? I don't know why gcc/clang fails on this.
"
222174423,5310,tekko,2016-05-27T15:18:24Z,"Is it possible to add a fail counter and show in the log how many failed?
or count the non-empty lines read and compare it with the total number of rules parsed?
Just in case something got updated and it stops working again...
"
222188109,5310,glassez,2016-05-27T16:11:14Z,"> It is compiled for me with libtorrent-1.1 (I mean this PR unchanged).

I forgot to mention that I built it with mingw g++.
"
222189830,5310,glassez,2016-05-27T16:18:32Z,"@sledgehammer999 The fact we used `boost::asio::ip::address::operator=()` in old code too. You just add the following:

``` c++
namespace boost
{
    namespace asio
    {
        namespace ip
        {
            class address;
        }
    }
}

namespace libtorrent
{
    typedef boost::asio::ip::address address;
}
```

so I think that is the problem.

The second thing we don't need this. Since `parseIPAddress()` don't depend on `FilterParserThread` class you don't need declare it as class member. Just move it into anonymous namespace in `filterparserthread.cpp` and remove the forward declaration of `libtorrent::address`.
"
222191648,5310,sledgehammer999,2016-05-27T16:26:35Z,"I am performing a libtorrent 1.1 compilation now. Just so you know, I have tried ommiting the forward declaration and including the appropriate libtorrent header directly but I get the same error with libtorrent 1.0.

I am waiting libtorrent 1.1 to finish now.
"
222193089,5310,glassez,2016-05-27T16:32:52Z,"@sledgehammer999 Do the following:

> Since `parseIPAddress()` don't depend on `FilterParserThread` class you don't need declare it as class member. Just move it into anonymous namespace in filterparserthread.cpp and remove the forward declaration of `libtorrent::address`.

Anyway it's code improvement.
"
222199826,5310,sledgehammer999,2016-05-27T17:01:57Z,"I couldn't get 1.1 to link with mingw 5.3.0(a whole lot of weird errors). I pushed a new commit to see if it passes travis.
And now I am going to convert some qDebug messages into Logger messages in the parse functions.
"
222213885,5310,sledgehammer999,2016-05-27T18:01:25Z,"g++ still fails with the same error. I am thinking of changing the function to take a pointer instead of a reference.
"
222213925,5310,zeule,2016-05-27T18:01:34Z,"> I tested various implementations from that issue and benchmarked how long it took FilterParserThread::parseDATFilterFile() to finish.

Don't understand how can we talk about speed and do string to string conversions (instead of string to `libt::address`).
"
222215338,5310,sledgehammer999,2016-05-27T18:07:36Z,"> Don't understand how can we talk about speed and do string to string conversions (instead of string to libt::address).

Have you looked at my 2nd commit? That's what I do there. And from there I get the linking error with g++. Since you're developing on linux please take a look and see if you discover why this is happening.
"
222221830,5310,zeule,2016-05-27T18:35:30Z,"> Have you looked at my 2nd commit? That's what I do there. 

It is better, of course, but, ideally, it should not contain `split()` calls.

> And from there I get the linking error with g++. Since you're developing on linux please take a look and see if you discover why this is happening.

Can I see `/usr/lib/pkgconfig/libtorrent-rasterbar.pc` from that machine? Or can you change the build to output all the defines in the build log? It has to have something to do with BOOST_ASIO_HEADER_ONLY, I guess. My local builds can not reproduce this link error.
"
222223137,5310,sledgehammer999,2016-05-27T18:41:08Z,"`libtorrent-rasterbar.pc` comes from our [ppa](https://launchpad.net/~qbittorrent-team/+archive/ubuntu/qbittorrent-stable) and here are its contents:

```
prefix=/usr
exec_prefix=${prefix}
bindir=${exec_prefix}/bin
libdir=${exec_prefix}/lib
datarootdir=${prefix}/share
datadir=${datarootdir}
sysconfdir=/etc
includedir=${prefix}/include
package=libtorrent-rasterbar

Name: libtorrent-rasterbar
Description: Bittorrent library.
Version: 1.0.7
Libs: -L${libdir} -ltorrent-rasterbar -lboost_system 
Libs.private:  -lGeoIP  -lpthread   -lpthread  -lssl -lcrypto 
Cflags: -I${includedir} -I${includedir}/libtorrent  -DTORRENT_USE_OPENSSL  -DBOOST_ASIO_HASH_MAP_BUCKETS=1021  -DBOOST_EXCEPTION_DISABLE  -DBOOST_ASIO_ENABLE_CANCELIO  -DBOOST_ASIO_DYN_LINK -DTORRENT_LINKING_SHARED 

```
"
222224518,5310,zeule,2016-05-27T18:46:53Z,"So, it contains `-DBOOST_ASIO_DYN_LINK`. Could it be that boost was built without C++11 then? Where does it come from?
"
222225026,5310,zeule,2016-05-27T18:48:59Z,"And if that is the case, you should add `#undef BOOST_ASIO_HAS_MOVE` after the asio includes.
"
222226401,5310,sledgehammer999,2016-05-27T18:54:34Z,"> So, it contains -DBOOST_ASIO_DYN_LINK. *_Can boost be built without C++11 then? *_

Why not?
Hmm, maybe the linker fails then because the asio shared lib isn't passed to it?
"
222227189,5310,zeule,2016-05-27T18:58:15Z,"> Hmm, maybe the linker fails then because the asio shared lib isn't passed to it?

Indeed, libtorrent-rasterbar.pc does not contain that dependence. If libtorrent does not use that operator by itself, there will be no link to it in its .so. 
"
222227197,5310,sledgehammer999,2016-05-27T18:58:17Z,"Also in `winconf.pri` we have `DEFINES += BOOST_ASIO_SEPARATE_COMPILATION` and mingw still fails for me...
"
222227564,5310,glassez,2016-05-27T18:59:56Z,"Boost.Asio built in libtorrent-1.0, but if it built without c++11 support it hasn't moving `operator=()`.
"
222228144,5310,sledgehammer999,2016-05-27T19:02:21Z,"> Boost.Asio built in libtorrent-1.0, but if it built without c++11 support it hasn't moving operator=().

I am using this b2 cmd:

```
b2 -q --without-python --toolset=gcc variant=release link=static runtime-link=static encryption=openssl logging=none geoip=off resolve-countries=off dht=on boost=source character-set=unicode boost-link=static -sBOOST_ROOT=""G:\qBittorrent\boost_1_61_0"" cflags=""-Os -s -ffunction-sections -fdata-sections -fno-omit-frame-pointer -fpredictive-commoning"" cxxflags=""-Os -s -ffunction-sections -fdata-sections -fno-omit-frame-pointer -fpredictive-commoning"" linkflags=""-Wl,--gc-sections -Wl,--relax -Wl,--sort-common -Wl,-s -Wl,--as-needed -static-libgcc -static-libstdc++"" include=""/g/QBITTORRENT/install_mingw530/base/include"" library-path=""/g/QBITTORRENT/install_mingw530/base/lib"" --prefix=""/g/QBITTORRENT/install_mingw530/base"" define=BOOST_ASIO_DISABLE_CONNECTEX define=BOOST_USE_WINAPI_VERSION=0x0501 --hash -j 12
```

Is there a b2 switch to enable c++11 or should I do it myself in the cxxflags?
"
222228744,5310,glassez,2016-05-27T19:04:56Z,"I do it via cxxflags: `cxxflags=""-std=c++11""`
"
222228975,5310,zeule,2016-05-27T19:06:00Z,"AFAIK, libtorrent 1.1.0 switched to header-only boost.asio, and my .pc file contains the following:

```
 prefix=/usr
exec_prefix=${prefix}
bindir=${exec_prefix}/bin
libdir=/usr/lib64
datarootdir=${prefix}/share
datadir=/usr/share
sysconfdir=/etc
includedir=${prefix}/include
package=libtorrent-rasterbar

Name: libtorrent-rasterbar
Description: Bittorrent library.
Version: 1.1.0
Libs: -L${libdir} -ltorrent-rasterbar -lboost_system-mt 
Libs.private:  -lboost_system-mt -lpthread   -lpthread  -lssl -lcrypto
Cflags: -I${includedir} -I${includedir}/libtorrent  -DTORRENT_DEBUG  -DTORRENT_USE_OPENSSL  -DBOOST_ASIO_HASH_MAP_BUCKETS=1021  -DBOOST_ASIO_HAS_STD_CHRONO=1  -DBOOST_EXCEPTION_DISABLE  -DBOOST_ASIO_ENABLE_CANCELIO  -DTORRENT_LINKING_SHARED 
```

I would add 

``` C++
#if LIBTORRENT_VERSION_NUM < 10100
#undef BOOST_ASIO_HAS_MOVE
#endif
```

just to be on the safe side. We can't know how boost was built.
"
222229166,5310,sledgehammer999,2016-05-27T19:06:47Z,"Hmm, then it is entirely possible that on linux libtorrent is being compiled as non-c++11 and qbittorrent as c++11 since we are explicit about that. And we see different things from the headers. I am going to try rebuilding libtorrent with mingw and c++11.
"
222229326,5310,glassez,2016-05-27T19:07:32Z,"I'm more worried about Travis. We used `operator=()` in the old code! Why isn't it working now?
"
222230165,5310,sledgehammer999,2016-05-27T19:11:28Z,"> I'm more worried about Travis. We used operator=() in the old code! Why isn't it working now?

I see that we use it only in `TorrentHandle::connectPeer()`:

``` c++
libt::address addr = libt::address::from_string(Utils::String::toStdString(peerAddress.ip.toString()), ec);
```

Maybe the compiler does its magic and optimizes out the assignment?
"
222230237,5310,zeule,2016-05-27T19:11:48Z,"> Hmm, then it is entirely possible that on linux libtorrent is being compiled as non-c++11 and qbittorrent as c++11 since we are explicit about that. 

This is the case on Gentoo currently. Users of qBt master branch have to specify C++11 mode for libtorrent explicitly if they compile it using autottols (see #5265, for instance).
"
222231229,5310,glassez,2016-05-27T19:16:21Z,"> I see that we use it only in TorrentHandle::connectPeer():

FilterParserThread has some number of it too.
"
222233138,5310,glassez,2016-05-27T19:25:15Z,"@evsh Tricky question.
Why in this code:

``` c++
libt::address addr = libt::address::from_string(ip.toLocal8Bit().constData(), ec);
```

the compiler uses `boost::asio::ip::address::operator=(const boost::asio::ip::address& other)`, and in this code:

``` c++
bool parseIPAddress(QString _ip, libt::address &address)
{
    // ...
    address = libt::address::from_string(_ip.toLatin1().constData(), ec);
```

the compiler uses `boost::asio::ip::address::operator=(boost::asio::ip::address&& other)`?
"
222234176,5310,zeule,2016-05-27T19:30:15Z,"@glassez, your first example line uses the copy constructor.
"
222234817,5310,zeule,2016-05-27T19:33:18Z,"And in a release build it uses the return value optimization, of course.
"
222235164,5310,zeule,2016-05-27T19:35:15Z,"BTW, 

``` C++
 libt::address parseIPAddress(QString _ip, bool &ok)
```

would do the trick for us.
"
222235464,5310,glassez,2016-05-27T19:36:52Z,"> @glassez, your first example line uses the copy constructor.
> And in a release build it uses return value optimization, of course.

Oh shit, right!!!
Therefore, we have not had problems with this before.

> BTW, `libt::address parseIPAddress(QString _ip, bool &ok)` would do the trick for us.

It's worth a try!
"
222236207,5310,sledgehammer999,2016-05-27T19:40:28Z,"> BTW, libt::address parseIPAddress(QString _ip, bool &ok) would do the trick for us.

Why not my first proposal? aka:

``` c++
bool parseIPAddress(QString _ip, libt::address *address)
```
"
222236573,5310,sledgehammer999,2016-05-27T19:42:23Z,"> Why not my first proposal? aka:

Yeah because it is stupid. Scratch that.
"
222237328,5310,sledgehammer999,2016-05-27T19:46:05Z,"Assuming that we're right about non-c++11 libtorrent and c++11 qbittorrent:
Will it create problems if we force either arvidn or the packagers to compile libtorrent-1.0 with c++11 when the compiler supports it? What will happen to programs that will use the c++11 libtorrent but themselves aren't compiled using c++11?
"
222237802,5310,sledgehammer999,2016-05-27T19:48:24Z,"And yes now mingw works when I compile libtorrent-1.0 with c++11 too.
"
222237806,5310,tekko,2016-05-27T19:48:27Z,"this works?

```
_ip = _ip.trimmed();
QString newIP;
for (int i = 0; i < _ip.count(); i++) {
    // ""not zero"" or ""last char"" or ""followed by '.' "" or (at least the 2nd char, not preceded by zero or '.' )
    if(_ip[i] != QChar('0') || i==(_ip.count()-1) || _ip[i+1] == QChar('.') || (i>0 && _ip[i-1] != QChar('0') && _ip[i-1] != QChar('.') ))
        newIP.push_back(_ip[i]);
}
_ip=newIP;
```

If it's too confusing, just forget about it...
edit: code modified with added comments, qchar casts and corrected typos
"
222243008,5310,zeule,2016-05-27T20:14:50Z,"> Will it create problems if we force either arvidn or the packagers to compile libtorrent-1.0 with c++11 when the compiler supports it? What will happen to programs that will use the c++11 libtorrent but themselves aren't compiled using c++11?

I can speak about GCC only. This is not a good idea. May work or may not. Take a look [here](http://stackoverflow.com/questions/12637699/c03-library-with-c11-source-code) and [here](https://gcc.gnu.org/wiki/Cxx11AbiCompatibility), please. As to me, libtorrent-1.1 with its header-only asio is a good decision. 

Speaking of Linux distributions, the situation is not that bad, because many projects force C++11 mode already, and maintainers know what to do with reverse dependencies.
"
222244122,5310,sledgehammer999,2016-05-27T20:20:37Z,"@evsh so what do you suggest? Leave my PR as-is and let the maintainers rebuild libtorrent with c++11 (and probably dependent programs too) or rewrite the function signature as you proposed?
"
222245801,5310,zeule,2016-05-27T20:29:06Z,"@sledgehammer999 we need libtorrent[c++11] regardless of your decision with this particular problem. I suppose your question is more about boost. And I think we have no choice here: we use c++11 already, and it would be stupid to port the code back to C++03. Perhaps we can leave a note to maintainers in the changelog or readme that  with libtorrent < 1.1.0 we need boost[c++11] and that will be enough.

Update: I accidentally used Gentoo syntax for package flags. Just to clarify: [c++11] means ""with C++11 mode enabled""
"
222247004,5310,zeule,2016-05-27T20:35:26Z,"> with libtorrent < 1.1.0 we need boost[c++11] 

I can write a cmake check for that, if you like.
"
222247584,5310,sledgehammer999,2016-05-27T20:38:11Z,"> Perhaps we can leave a note to maintainers in the changelog or readme that with libtorrent < 1.1.0 we need boost[c++11] and that will be enough.

Are you sure that libtorrent-1.1 autobuilds into c++11 with gcc?

> I can write a cmake check for that, if you like.

How are you going to detect that? Does libtorrent have a DEFINE to indicate if it was build in c++11?

> And I think we have no choice here: we use c++11 already, and it would be stupid to port the code back to C++03.

So I should leave this PR as-is and try to provide a better package for the ppa... (and I hope it doesn't break other packages in the system. great!)
"
222248951,5310,zeule,2016-05-27T20:44:44Z,"> Are you sure that libtorrent-1.1 autobuilds into c++11 with gcc? 

No, it does not, but it does not use `BOOST_ASIO_DYN_LINK` and that is important for us, and we may check for `BOOST_ASIO_HAS_STD_CHRONO=1` that is clear indication that libtorrent was built with C++11.

> How are you going to detect that? Does libtorrent have a DEFINE to indicate if it was build in c++11?

I will try to compile and link a program which uses `boost::asio::address::operator=(boost::asio::address::operato&&)`, for example, if `BOOST_ASIO_DYN_LINK` define was found in libtorrent pkg-config. And if that program fails, I may print clear explanation what the problem is. 
"
222256475,5310,zeule,2016-05-27T21:24:43Z,"@sledgehammer999, let's move the discussion into its own issue, and ask ardvin is there any feature in libtorrent API which is specific to C++11 (so we can use it for test)?
"
222257140,5310,sledgehammer999,2016-05-27T21:28:25Z,"OK. If no one has something to say about my code here I'll merge it tomorrow night.
ATM, I am trying to make a buildable deb package on 1.0.9 with c++11 enabled.
"
222258116,5310,tekko,2016-05-27T21:33:55Z,"I guess u don't have time to try my code.
"
222258809,5310,zeule,2016-05-27T21:37:24Z,"> If no one has something to say about my code here I'll merge it tomorrow night.

I have :) Why don't you replace the `split()` calls with scanning the byte array and a buffer for the results string, which is allocated only once?  
"
222259993,5310,sledgehammer999,2016-05-27T21:44:08Z,"@tekko I'll benchmark your example later. Although those conditions hurt my head and cannot verify that they are doing the right thing.

@evsh if you have code ready, please share :)
"
222261107,5310,zeule,2016-05-27T21:50:44Z,"> if you have code ready, please share :)

Not at hands, but can write. May those files contain IPv6 addresses?
"
222262698,5310,sledgehammer999,2016-05-27T22:00:31Z,"> May those files contain IPv6 addresses?

I think when the specs were written IPv6 was still a distant fantasy. But in my parsing I specifically test if the string splits into 4. If it doesn't I assume it is parsable IPv6 address.
"
222286938,5310,zeule,2016-05-28T03:09:42Z,"Perhaps we should just write an regexp which extracts (but not use it o replace leading zeroes!) the correct IPV4 address, but I've tried to write a mini-parser which does not perform memory allocations and wrote the following ugly code (I expected it to be cleaner):

``` C++
class DATIPv4Parser {
public:
    bool tryParse(const char* str) {
        int groupDelimiters = 0;
        std::size_t digit = 0;
        bool groupNonZeroDigitFound = false;
        char groupDigits = 0;
        for (; *str != 0; ++str) {
            if (std::isspace(*str))
                continue;

            if (!groupNonZeroDigitFound && (*str == '0')) {
                continue;
            }

            if (*str == '.') {
                if (!groupNonZeroDigitFound) {
                    m_buf[digit++] = '0';
                    if (digit == MAX_IPV4_LEN - 1) {
                        return false;
                    }
                }
                m_buf[digit++] = '.';
                groupNonZeroDigitFound = false;
                groupDigits = 0;
                ++groupDelimiters;
                if (digit == MAX_IPV4_LEN - 1) {
                    break;
                }
                continue;
            }

            if (*str >= '0' && *str <= '9') {
                m_buf[digit++] = *str;
                if (++groupDigits  > 3) {
                    return false;
                }
                groupNonZeroDigitFound |= true;
               continue;
            }
            return false; // unexpected charachter
        }

        if (groupDelimiters == 3 && *(str-1) == '0') {
            m_buf[digit++] = '0';
        }
        m_buf[digit] = 0;
        return groupDelimiters == 3 && m_buf[digit-1] != '.';
    }

    const char* parsed() const {
        return m_buf;
    }

private:
    static const std::size_t MAX_IPV4_LEN = 4 * 3 + 3;
    static const std::size_t BUF_SIZE = MAX_IPV4_LEN + 2;
    char m_buf [BUF_SIZE];
};
```

With the following test code

``` C++
DATIPv4Parser parser;

void testParser(const char* addr) {
    std::cout << addr << "" -> "";
    if (parser.tryParse(addr)) {
        std::cout << parser.parsed();
    } else {
        std::cout << ""Not parsed"";
    }
    std::cout << std::endl << std::flush;
}

testParser(""192.168.1.23"");
testParser(""192.168.001.24"");
testParser(""002.168.001.24"");
testParser(""002.08.001.24"");
testParser(""000.000.000.000"");

testParser(""000.000.000."");
testParser(""000.000.000.0001."");
testParser(""255.255.255.255.255"");
testParser(""192.168.1a.23"");
```

I got the following output:

```
192.168.1.23 -> 192.168.1.23
192.168.001.24 -> 192.168.1.24
002.168.001.24 -> 2.168.1.24
002.08.001.24 -> 2.8.1.24
000.000.000.000 -> 0.0.0.0
000.000.000. -> Not parsed
000.000.000.0001. -> Not parsed
255.255.255.255.255 -> Not parsed
192.168.1a.23 -> Not parsed
```

And now, I'm afraid, nobody would suggest to use such an unreadable little monster. Sorry for taking your time.
"
222315419,5310,sledgehammer999,2016-05-28T15:56:00Z,"So here are the new benchmark results.
As always I timed the parsing of the whole filter. I timed how long it took `FilterParserThread::parseP2BFilterFile()` to finish. All algos are applied on top of my latest commits:

baseline results:

```
Duration(ms): 2825
Duration(ms): 2772
Duration(ms): 2727
```

@Chocobo1 

``` c++
namespace
{
    bool parseIPAddress(QString _ip, libt::address &address)
    {
        _ip = _ip.trimmed();

        // Emule .DAT files contain leading zeroes in IPv4 addresses
        // eg 001.009.106.186
        // We need to remove them because both QHostAddress and Boost.Asio fail to parse them.
        QStringList octets = _ip.split('.', QString::SkipEmptyParts);
        if (octets.size() == 4) {
            for (int i = 0; i < 4; ++i) {
                QString &octet = octets[i];
                if ((octet[0] == QChar('0')) && (octet.count() > 1)) {
                    if ((octet[1] == QChar('0')) && (octet.count() > 2))
                        octet.remove(0, 2);
                    else
                        octet.remove(0, 1);

                    octets[i] = octet;
                }
            }

            _ip = octets.join(""."");
        }

        boost::system::error_code ec;
        address = libt::address::from_string(_ip.toLatin1().constData(), ec);

        return !ec;
    }
}
```

Results:

```
Duration(ms): 2625
Duration(ms): 2709
Duration(ms): 2671
```

@evsh Horribly slow and it doesn't parse all the IPs. I also get some weird output in the console. The first result is parsing when launching qbt and the 2nd one is from pressing the reload button in the settings.

``` c++
namespace
{
    class DATIPv4Parser {
    public:
        bool tryParse(const char* str) {
            int groupDelimiters = 0;
            std::size_t digit = 0;
            bool groupNonZeroDigitFound = false;
            char groupDigits = 0;
            for (; *str != 0; ++str) {
                if (std::isspace(*str))
                    continue;

                if (!groupNonZeroDigitFound && (*str == '0')) {
                    continue;
                }

                if (*str == '.') {
                    if (!groupNonZeroDigitFound) {
                        m_buf[digit++] = '0';
                        if (digit == MAX_IPV4_LEN - 1) {
                            return false;
                        }
                    }
                    m_buf[digit++] = '.';
                    groupNonZeroDigitFound = false;
                    groupDigits = 0;
                    ++groupDelimiters;
                    if (digit == MAX_IPV4_LEN - 1) {
                        break;
                    }
                    continue;
                }

                if (*str >= '0' && *str <= '9') {
                    m_buf[digit++] = *str;
                    if (++groupDigits  > 3) {
                        return false;
                    }
                    groupNonZeroDigitFound |= true;
                   continue;
                }
                return false; // unexpected charachter
            }

            if (groupDelimiters == 3 && *(str-1) == '0') {
                m_buf[digit++] = '0';
            }
            m_buf[digit] = 0;
            return groupDelimiters == 3 && m_buf[digit-1] != '.';
        }

        const char* parsed() const {
            return m_buf;
        }

    private:
        static const std::size_t MAX_IPV4_LEN = 4 * 3 + 3;
        static const std::size_t BUF_SIZE = MAX_IPV4_LEN + 2;
        char m_buf [BUF_SIZE];
    };


    bool parseIPAddress(const QByteArray &_ip, libt::address &address)
    {
        DATIPv4Parser parser;
        boost::system::error_code ec;

        if (parser.tryParse(_ip.constData()))
            address = libt::address::from_string(parser.parsed(), ec);
        else
            address = libt::address::from_string(_ip.constData(), ec);

        return !ec;
    }
}
```

Output:

```
Duration(ms): 18231
Duration(ms): 34108

Parsed IPs: 158591

QObject::connect: Cannot queue arguments of type 'Log::Msg'
(Make sure 'Log::Msg' is registered using qRegisterMetaType().)
```

@tekko 

``` c++
namespace
{
    bool parseIPAddress(QString _ip, libt::address &address)
    {
        _ip = _ip.trimmed();
        if (_ip.contains('.')) {
            QString newIP;
            newIP.reserve(4 * 3 + 3 + 1);
            for (int i = 0; i < _ip.count(); ++i) {
                // ""not zero"" or ""last char"" or ""followed by '.' "" or (at least the 2nd char, not preceded by zero or '.' )
                if(_ip[i] != QChar('0') || i==(_ip.count()-1) || _ip[i+1] == QChar('.') || (i>0 && _ip[i-1] != QChar('0') && _ip[i-1] != QChar('.') ))
                    newIP.push_back(_ip[i]);
            }
            _ip=newIP;
        }

        boost::system::error_code ec;
        address = libt::address::from_string(_ip.toLatin1().constData(), ec);

        return !ec;
    }
}
```

Results:

```
Duration(ms): 2279
Duration(ms): 2326
Duration(ms): 2289
```
"
222316590,5310,zeule,2016-05-28T16:20:47Z,"@sledgehammer999 just for fun, could you share your benchmark code, please?
"
222317079,5310,sledgehammer999,2016-05-28T16:30:38Z,"> @sledgehammer999 just for fun, could you share your benchmark code, please?

Very simple.

``` c++
else if (m_filePath.endsWith("".dat"", Qt::CaseInsensitive)) {
        // eMule DAT format
        qint64 start = QDateTime::currentMSecsSinceEpoch();
        ruleCount = parseDATFilterFile(m_filePath, filter);
        qint64 end = QDateTime::currentMSecsSinceEpoch();
        qCritical() << ""Duration(ms):"" << end - start;
    }
```
"
222317650,5310,zeule,2016-05-28T16:41:52Z,"@sledgehammer999: I've made a mistake putting `std::isspace()` inside of the main loop, so my test is with that  corrected. Downloaded guarding.p2p (14.2 MB, 215968 lines).

Rules count =  215968
Duration(ms): 34
"
222318644,5310,sledgehammer999,2016-05-28T17:02:19Z,"Could you at least share your code? I removed the if checking for space altogether, but I get a deadlock.
PS: Look at my posted code above to see how I intergrate the rest the code.
"
222318981,5310,zeule,2016-05-28T17:08:15Z,"Yes, sure. Just give me some time to simplify it a bit.
"
222320325,5310,sledgehammer999,2016-05-28T17:38:04Z,"Btw, I fixed the warning about `Log::Msg` and qRegisterMetaType().
"
222321141,5310,zeule,2016-05-28T17:56:22Z,"The previous number was for parsing only, without creating `asio::ip::address` objects. Now it with that.
GCC 5.3, ""-O2 -march=native"", Core i7-4810MQ

eugene's code
Rules count =  215968
Duration(ms): 65

tekko's code
Rules count =  215968
Duration(ms): 389

[main.zip](https://github.com/qbittorrent/qBittorrent/files/287818/main.zip)
"
222322568,5310,sledgehammer999,2016-05-28T18:24:38Z,"To put things into perspective I performed the same benchmark as the other times.
Results:

```
Duration(ms): 1787
Duration(ms): 1865
Duration(ms): 1881
```

@evsh Your code is by far the best till now. Btw, why did you change the return value of tryParse()? I am thinking of converting it back to a bool.

**Another matter**
I am going to keep this open until I am able to at least build a valid deb for the ppa which is also used for Travis. This is the issue that stops me: https://github.com/arvidn/libtorrent/issues/766

I am going to file a bug to the brew(osx tool) people to rebuild libtorrent with c++11. But I don't think it they will do it any time soon. So I suppose in the meantime I should disable travis-osx builds, right?
"
222323165,5310,zeule,2016-05-28T18:37:38Z,"> Btw, why did you change the return value of tryParse()?

To resemble signature of `strtok()`, which might provide a simpler way to do the parsing.
"
222323714,5310,tekko,2016-05-28T18:47:19Z,"@sledgehammer999 
If this PR doesn't make it into the next release of qbt, u should just temp. disable the .dat support. 
"
222326259,5310,zeule,2016-05-28T19:43:20Z,"A variant which calls  `strtol()` and is a bit more readable:

``` C++
class DATIPv4Parser2 {
public:
    const char* tryParse(const char* str, bool& ok) {
        unsigned char number = 0;

        while (*str != 0 && (*str == ' ' || *str == '-'))
            ++str;

        const char* numberStart = str;
        char* endptr;
        for (; *str; ++str) {
            if (*str == '.' || *str == ' ') {
                m_buf[number++] = static_cast<unsigned char>(strtol(numberStart, &endptr, 10));
                if (endptr != str) {
                    break;
                }
                if (number == 4) { // an IP might end with '.': 192.168.1.2.
                    ok = true;
                    return str + 1;
                }
                numberStart = str + 1;
            }
        }
#if 1
        // The following is needed for parsing of a string with IP, but in the eMule files there is always a space after an IP,
        // and this case is handled above
        if (str != numberStart) {
            m_buf[number] = static_cast<unsigned char>(strtol(numberStart, &endptr, 10));
            if (endptr == str && number == 3) {
                ok = true;
                return str + 1;
            }
        }
#endif

        ok = false;
        return str + 1;
    }

    libt::address_v4::bytes_type parsed() const {
        return m_buf;
    }

private:
    libt::address_v4::bytes_type m_buf;
};
```

Results:

```
eugene's code
Rules count =  215968
Duration(ms): 62
tekko's code
Rules count =  215968
Duration(ms): 399
eugene's code #2
Rules count =  215968
Duration(ms): 54
```
"
222330520,5310,tekko,2016-05-28T21:28:50Z,"Would this way of parsing benefit .p2p and .p2b also? 

There is a typo in the comment ""p2b"" not ""p2p""
`// Parser for PeerGuardian ip filter in p2p format
int FilterParserThread::parseP2BFilterFile(QString m_filePath, libt::ip_filter &filter)`
"
222331754,5310,zeule,2016-05-28T22:04:36Z,"If this question is addressed to me, then I have never seen those files and thus don't know. Where can I find examples, please?
"
222331859,5310,sledgehammer999,2016-05-28T22:06:59Z,"> Would this way of parsing benefit .p2p and .p2b also? 

My commits here use the same parsing algo for dat and p2p since both are text files. p2b is binary file and uses different code path.
"
222331917,5310,sledgehammer999,2016-05-28T22:08:30Z,"Results with @evsh's code https://github.com/qbittorrent/qBittorrent/pull/5310#issuecomment-222326259:

```
Duration(ms): 799
Duration(ms): 808
Duration(ms): 809
```

@evsh you're on fire.
"
222332396,5310,zeule,2016-05-28T22:21:46Z,"@sledgehammer999 I wonder why does your machine shows so much of difference between the first and second versions of DATIPv4Parser?

>  Btw, why did you change the return value of tryParse()

I believe you are right, `bool tryParse(const char*, const char**)` will be cleaner inside and from outside too,
"
222332644,5310,sledgehammer999,2016-05-28T22:29:11Z,"> @sledgehammer999 I wonder why does your machine shows so much of difference between the first and second versions of DATIPv4Parser?

Keep in mind that I plug it into the current qbt code and not use your example benchmark.

> I believe you are right, bool tryParse(const char_, const char_*) will be cleaner inside and from outside too,

Now I call it like this:

``` c++
bool parseIPAddress(const QByteArray &_ip, libt::address &address)
    {
        DATIPv4Parser parser;
        boost::system::error_code ec;
        bool ok = false;

        parser.tryParse(_ip.constData(), ok);
        if (ok)
            address = libt::address_v4(parser.parsed());
        else
            address = libt::address::from_string(_ip.constData(), ec);

        return !ec;
    }
```

I would like to call it like this instead:

``` c++
bool parseIPAddress(const QByteArray &_ip, libt::address &address)
    {
        DATIPv4Parser parser;
        boost::system::error_code ec;
        bool ok = false;

        if (parser.tryParse(_ip.constData())
            address = libt::address_v4(parser.parsed());
        else
            address = libt::address::from_string(_ip.constData(), ec);

        return !ec;
    }
```

I'll need to still convert to QByteArray to QString to perform `QString::trimmed()` in case it is an IPv6 address. So it is probably wasteful for you to test for whitespace.
"
222332707,5310,sledgehammer999,2016-05-28T22:31:49Z,"> @sledgehammer999 I wonder why does your machine shows so much of difference between the first and second versions of DATIPv4Parser?

Another thing. In your v1 instead of `address = libt::address_v4(parser.parsed());` I do `address = libt::address::from_string(parser.parsed(), ec);` and from_string might be slower.
"
222333093,5310,tekko,2016-05-28T22:45:02Z,"@evsh 
conversion btwn .dat, .p2p and .p2bv1-3 can be done with listdrop 
https://sourceforge.net/projects/peerguardian/files/ListDrop/

https://sourceforge.net/p/peerguardian/wiki/dev-blocklist-format-p2b/

@sledgehammer999 
Well... your machine, same list
v1

```
Duration(ms): 1787
Duration(ms): 1865
Duration(ms): 1881
```

v2

```
Duration(ms): 799
Duration(ms): 808
Duration(ms): 809
```
"
222338124,5310,zeule,2016-05-29T01:49:37Z,"@sledgehammer999 here is the same thing which returns a `bool` and checks for IPv6 if IPv4 parsing fails. Please, do not re-create the parser for each IP.
[main.zip](https://github.com/qbittorrent/qBittorrent/files/288092/main.zip)
"
222354633,5310,zeule,2016-05-29T10:57:56Z,"Forgot to mention:

>  ...which returns a bool and checks for IPv6 if IPv4 parsing fails.

So that the following 

> I'll need to still convert to QByteArray to QString to perform QString::trimmed() in case it is an IPv6 address

may be avoided.
"
222355151,5310,zeule,2016-05-29T11:11:52Z,"@tekko 

> conversion btwn .dat, .p2p and .p2bv1-3 can be done with listdrop 

Had not found a listdrop executable there. I would appreciate if you do the conversion and share the p2p file.
"
222365529,5310,tekko,2016-05-29T15:08:37Z,"@evsh 
click ""1.0"" and there are zip files which includes source of listdrop and win exe's.

https://sourceforge.net/projects/peerguardian/files/ListDrop/1.0/listdrop-1.0-x64.zip/download
https://sourceforge.net/projects/peerguardian/files/ListDrop/1.0/listdrop-1.0-src.zip/download
https://sourceforge.net/projects/peerguardian/files/ListDrop/1.0/listdrop-1.0-nt.zip/download
https://sourceforge.net/projects/peerguardian/files/ListDrop/1.0/listdrop-1.0-9x.zip/download

but anyways... tried dragging blocklist.zip here. it says attachment is not supported, even though .zip is in the list... maybe too big.
I'll send it to the email in your profile.

UPDATE: sent by email
"
222366446,5310,zeule,2016-05-29T15:28:29Z,"@tekko thanks!
"
222377473,5310,zeule,2016-05-29T19:14:40Z,"@sledgehammer999 it seems like for p2p files we simply need to find index of the first semicolon in each string and start parsing from the next charachter. The same parser class will work. In this way you can avoid using `QByteArray` → `QString` conversions.
"
222387259,5310,zeule,2016-05-29T22:44:11Z,"Just realised that the loading is performed during start up. In this case I would use memory mapped file for loading them, thus removing string buffer completely. For example, `boost::iostreams` library provides memory mapped file for POSIX and Windows.  
"
222404604,5310,glassez,2016-05-30T03:23:20Z,"> For example,  boost::iostreams  library provides memory mapped file for POSIX and Windows.

Qt provides it too.
"
222432426,5310,glassez,2016-05-30T07:44:55Z,"@evsh wouldn't it be overkill the use memory mapped file in case of one-time file reading?
"
222459939,5310,zeule,2016-05-30T10:09:35Z,"Perhaps you are right. Handling SIGBUS (and I forgot what is the exception for Windows for that) is too complicated for the task.
"
222571165,5310,sledgehammer999,2016-05-31T00:56:04Z,"@evsh I didn't try your last version of the parser yet.
On the file reading thing: Both p2p and .dat filters are text files and usually ""small"" eg 12MB. Why not read them all at once with `QIODevice::readAll()` or `QTextStream::readAll()`? Would it help?
"
222571556,5310,sledgehammer999,2016-05-31T01:00:56Z,"Hmm, going back to one of my comments, we don't need QString at all. QByteArray also has a trim function. So @evsh you don't need to handle IPv6 parsing at all. Of course benchmarks are in order.
"
222574643,5310,zeule,2016-05-31T01:38:22Z,"I don't know what level of optimisation is enough for you. What is definitely true: without a special allocator or heap, string operations which need memory allocation (and trimming most likely does) are slow. To parse this kind of file one needs sequential scanning only.  If we are sure that the filter size can not be large, then reading it all into memory (into a single continuous piece) is better than doing so line by line.
"
222575950,5310,sledgehammer999,2016-05-31T01:52:59Z,"> I don't know what level of optimisation is enough for you.

Good point. I didn't specify. Truthfully, for me your parser is already fast enough. I am just wondering if there are cheap and easy ways to squeeze more performance without going overboard.

I am going to use your parser anyway. Now I am waiting for the libtorrent + c++11 part. I have found why the deb package doesn't build on linux. I can use manual patches for package. I am waiting for arvid to respond in case he has some other solution. But tomorrow I'll probably go ahead with patching the deb source.
Also tomorrow, I'll open an issue in the brew bug tracker for OSX.
"
222654236,5310,zeule,2016-05-31T10:46:26Z,"`QByteArray::trimed()` performs memory allocation too, I guess. What is the problem here: we do these trimming many times and in their own thread while the app continues loading, if I understood that correctly (didn't look into the code, sorry). Thus we do access the memory heap simultaneously from the filter parsing thread and from other threads. The parser thread does many allocations and frees. Since they interfere with heap allocations from the other threads, this leads to the heap fragmentation and performance degradation not only here, but for those other objects too. Should you you `std::string` I tell you ""use a pool allocator here and there will be no problems"", but Qt does use the common heap, right?
"
222663662,5310,sledgehammer999,2016-05-31T11:37:43Z,"> but Qt does use the common heap, right?

No idea. But even if we readAll() we still would need some extra allocation, since for ease-of-use we will need line-by-line data and each line split by their respective delimiter. Unless we write a specific parser for this that it searches in the buffer to find the newline and then find the delimiters each time returning positions into the buffer.
"
222667462,5310,zeule,2016-05-31T11:57:38Z,"I do a lot of parsing of huge ASCII tables for my daily work and thus I'm used to code which scans a buffer for newline symbols and other delimiters, so my vision is inclined to that side. thus I'm not the one who can decide whether a code without trimming an line splitting is maintainable (because yes, of course :) ). 
"
222818526,5310,zeule,2016-05-31T20:58:45Z,"If there is a desire to get operations like trimming in a class-like way and work with a large continuous buffer, it might make sense to use a class like

``` C++
class string_range {
public:
    string_range(char* begin, char* end) { /* trivial*/}
    void trim_front() {
         while(m_begin != m_end && std::isspace(*m_begin)) {
               ++m_begin;
    }

    // operator[]
    std::size_t find_any_of(const char* chars);
private:
    char* m_begin;
    char* m_end;
};
```

and `class buffer` with `string_range buffer::get_next_line()`. This way we may retain readability and avoid heap operations. Don't know, does it worth to do that just just to load a filter file.
"
222827879,5310,sledgehammer999,2016-05-31T21:32:55Z,"I finished and pushed a quick hack for minimizing memory allocations during parsing. The results are very encouraging.

Results:

```
Duration(ms): 489
Duration(ms): 485
Duration(ms): 487
```

Of course it needs some cleaning up. Don't be afraid to comment. There is at least one thing I want to do. Instead of doing readAll() I want to read in chunks of 20MiB into a preallocated buffer. Then parse the first chunk and proceed to load the next chunk into the buffer. I doubt we would need to do this more than 2 times.

Btw, is there a function that takes a string with start AND pos and coverts to int? Now I have to make small allocations out of the buffer for the access code and IPs.
"
222830591,5310,sledgehammer999,2016-05-31T21:43:29Z,"> Don't know, does it worth to do that just just to load a filter file.

IMO, no it doesn't. Neither my quick attempt is actually worth it. But you know what, I kinda get a good feeling when I code (or test other code) to make something faster and more optimized. It is a nice feeling even when it isn't for a time-critical part of the program.
"
222838254,5310,zeule,2016-05-31T22:17:23Z,"> Btw, is there a function that takes a string with start AND pos and coverts to int?

`strtol()` converts until it encounters a character which is not a valid digit. As far as I understood, you convert a part between commas. If you want to separate sub-strings, `strep()` inserts 0 instead of a delimiters. 
"
222841193,5310,sledgehammer999,2016-05-31T22:31:21Z,"> Btw, is there a function that takes a string with start AND pos and coverts to int?

Sorry I meant start AND end positions.

> strtol() converts until it encounters a character which is not a valid digit. As far as I understood, you convert a part between commas. If you want to separate sub-strings, strep() inserts 0 instead of a delimiters.

strep() doesn't comeup on google. I don't want to insert delimiters. I search for the delimiters. Which is comma in the DAT file. I just want to tell some function ""take this string starting from X and ending in Y from this buffer and try to convert it to an int.
"
222843409,5310,zeule,2016-05-31T22:42:44Z,"> strep() doesn't comeup on google. 

Sorry, `strsep()`
"
224712112,5310,sledgehammer999,2016-06-08T20:09:18Z,"Minor update. strsep() looks promising. I also might use your `IndexInterval`/`IndexRange` classes to keep better track of things and be cleaner.
I expect to finish this PR this weekend and also wrap-up things with the libtorrent package for PPA/travis. I really want this weekend to prepare v3.3.5 for release and then just wait for qt 5.6.1 which is rumored for release next week.
"
224712933,5310,zeule,2016-06-08T20:12:23Z,"> wait for qt 5.6.1 which is rumored for release next week.

https://blog.qt.io/blog/2016/06/08/qt-5-6-1-released/
"
224713493,5310,sledgehammer999,2016-06-08T20:14:22Z,"> > wait for qt 5.6.1 which is rumored for release next week.
> 
> https://blog.qt.io/blog/2016/06/08/qt-5-6-1-released/

Lol. I didn't check today! Anyway, then I should release this weekend.
"
225459268,5310,JonasNo,2016-06-12T20:44:54Z,"Skimmed through this thread, love performance talk and didn't see any mention of it so I apologize if you have already tried it:
Reading a file line by line is usually slow. In my experience reading a bigger chunk eg 4k at a time will speed things up. How big the chunk needs to be varies but 4k is a good number to start with. Too big or too small, it can hinder performance.
"
227027368,5310,sledgehammer999,2016-06-19T23:38:30Z,"I pushed my first commit into master as a temporary fix. I just want to release v3.3.5 already. Optimized fix can be merged later.
"
227913749,5310,zeule,2016-06-23T00:07:52Z,"FYI: libtorrent master now requires C++11 too
"
230365472,5310,sledgehammer999,2016-07-05T00:10:31Z,"FYI: I have contacted the debian maintainer for libtorrent asking for hints and/or help packaging the new versions but he hasn't responded. The email was sent 24 days ago. He hasn't even updated the package on debian. From my limited knowledge I think debian has borked their python packages slightly and libtorrent exposes that.

My last attempt is: Figure out if libtorrent's autotools allow naming the lib a bit differently in a way that will allow side-by-side existence with the official package. Then rename the package for the PPA and disable building the python bindings. The package should build correctly and it will not cause problems for other software in a user's machine (eg deluge).

PS: Sorry for the long and unannounced delay. I had to take unscheduled ""vacation"" time from online life.
"
232460923,5310,sledgehammer999,2016-07-13T19:27:39Z,"I opted using the qbittorrent unstable ppa to create a new libtorrent package without python. (python bindings is what breaks the package builds). And I put ""Conflicts"" fields in the package for the python-bindings so a user cannot install it by accident while having eg deluge too.

I'll wait to see if travis is ok and then I'll push final changes. I aim for a quick v3.3.6 release this weekend to fix the serious bugs of v3.3.5.
"
267832464,5310,zeule,2016-12-18T16:58:13Z,"In the meantime, libtorrent (1.2.0) started to use `string_view` class (either from C++ standard library (C++14 and up) or from Boost). The class would make the parser to be much more readable."
296336161,5310,sledgehammer999,2017-04-22T01:03:21Z,"I finally pushed the new and hopefully final version.

My non-scientific benchmark results for parsing a .dat file:
```
Base (msvc64): 3584 ms
PR   (msvc64): 0516 ms
PR     (msvc): 0676 ms
PR    (mingw): 0869 ms
```

@qbittorrent/demigods please see the whole diff, not individual commits. 
Also I am unsure how I should handle a malformed line. Now, I log an error and skip it. But I wonder if it is better if I log the error but abort parsing the file. I worry, that if I encounter a bad line, the failures might cascade down to the other lines and create thousands of loglines and freeze of the app.

Furthermore, I intend to use the same method for parsing the .p2p filter format. It is very similar to the .dat filter format."
296340877,5310,tekko,2017-04-22T02:22:57Z,"IMO breaking the parse is not a good idea since qbt would continue to upload and download without blocking many ip's.  If you're worring about the freeze, may I suggest you to use a counter? At the end of the parse, log ONE error and say how many bad lines have been encountered?"
296348346,5310,Chocobo1,2017-04-22T05:10:25Z,">Now, I log an error and skip it.

+1

>But I wonder if it is better if I log the error but abort parsing the file. I worry, that if I encounter a bad line, the failures might cascade down to the other lines and create thousands of loglines and freeze of the app.

Parser should be robust to malformed input (no crash nor unexpected outputs), because if it's not, it's a security issue...
"
296350001,5310,glassez,2017-04-22T05:46:44Z,">may I suggest you to use a counter? At the end of the parse, log ONE error and say how many bad lines have been encountered?

I don't know the format of Emule DAT file. So if it line-based (e.g. one rule per line) the single malformed line shouldn't lead to malforming next lines and we can produce log messages for all bad lines."
296502169,5310,sledgehammer999,2017-04-24T00:58:09Z,Pushed modifications. I think I have addressed all your comments.
296868322,5310,sledgehammer999,2017-04-25T01:47:09Z,"Pushed new commits based on your suggestions.
Interesting findings:
1. Deleting memset() call shaves off ~100ms
2. Not allocating memory to hold delimiter positions shaves off ~140ms
3. `std::vector<char>` is about 20-30ms faster than QVector<char>. And both are faster than the raw pointer!!!
Now msvc64 parses the file in ~400ms.
PS: After adding the other if-checks some ms time was lost."
296868461,5310,sledgehammer999,2017-04-25T01:48:16Z,I forgot to mention that the new mods are in separate commits to ease review.
297201513,5310,sledgehammer999,2017-04-26T00:15:47Z,"Made some minor additions. Optimized P2P filter too. Pushed to master.
@evsh I wasn't really interested in squeezing more speed out of this(if any). It is already at subsecond parsing of a 12MB file."
297281166,5310,zeule,2017-04-26T08:06:08Z,A parser is fast enough when it is marginally faster than disk I/O :)
571238791,11833,sledgehammer999,2020-01-06T17:49:48Z,On another note: The tar header includes a `checksum` field. Should I validate the checksum too?
571277516,11833,sledgehammer999,2020-01-06T19:28:07Z,">Have I missed something? I didn't read full format specs.

I got the basic idea. I'll see if I can push something later today."
571859518,11833,sledgehammer999,2020-01-08T02:10:24Z,I have pushed a new version. I almost rewrote the whole `tar.cpp`.
571931231,11833,glassez,2020-01-08T07:50:03Z,"General review comment.
I would implement it in form of ""stream reader"". This is a fairly effective pattern in terms of efficiency. In addition, it is better suited to our needs - we can easily apply the necessary restrictions without breaking the abstract unpacking mechanism itself. E.g. (pseudo code):
```c++
TarReader reader {data};
while (reader.readNext()) {
    const TarEntry entry = reader.entry();
    // here TarEntry struct contains parsed file data and metadata (i.e. name)
    // so we can do something with it
}

// here we have reached either end of file or error
if (reader.error()) {
    // do something...
}
```"
572736051,11833,sledgehammer999,2020-01-09T20:15:40Z,"Pushed new version. Take a another look. It is supposed to work as a stream reader. Not sure if I got the interface right.
Please focus reviews on `tar.cpp`. Once the code is finalized, we can focus on the other files."
576055229,11833,sledgehammer999,2020-01-19T22:36:31Z,"I think I addressed the pending comments.

**About returning a view:** @glassez is right. I was intending to introduce an additional function named `untarView()`, hoping that the naming will help future reviewers to catch improper use. While I was going to wire it up in `geoipmanager` class I realized that the DB buffer is further passed down to other classes (eg the db parser/decoder).
IMO, it is incredibly easy in the future to change something in these ""downstream"" classes that will assume that we own the buffer or forget to copy it when assigning. A proper type(eg string_view/span) is IMO obligatory for safe usage.
So I opted to always return a copy of the data for the time being."
581170722,11833,sledgehammer999,2020-02-02T19:55:33Z,"@glassez I addressed your comments. The only thing I am not sure is about class `Header`. I made its implementation private. But if you meant to take it out of the header file entirely, then I would have to implement `StreamReader::m_entry` as a pointer and constantly new/delete it in the .cpp. Is that what you meant? Or any other way?"
581391679,11833,glassez,2020-02-03T12:29:11Z,">The only thing I am not sure is about class Header. I made its implementation private. But if you meant to take it out of the header file entirely, then I would have to implement StreamReader::m_entry as a pointer and constantly new/delete it in the .cpp. Is that what you meant? Or any other way?

I would have some pure struct here to store current entry fields (or even just appropriate fields in StreamReader itself) and keep all the logic in StreamReader class. Otherwise you can have some private parser in .cpp (if you really need to separate parsing logic) that parses the entry header data and fills the appropriate fields of StreamReader (e.g. returns the struct with parsed fields).
You don't really need to store parser instance in StreamReader class. It can be created just before parsing and destroyed after you store its result. Otherwise you pollute the header with too many implementation details."
581639261,11833,sledgehammer999,2020-02-03T21:59:47Z,">I would have some pure struct here to store current entry fields (or even just appropriate fields in StreamReader itself) and keep all the logic in StreamReader class. Otherwise you can have some private parser in .cpp (if you really need to separate parsing logic) that parses the entry header data and fills the appropriate fields of StreamReader (e.g. returns the struct with parsed fields).
You don't really need to store parser instance in StreamReader class. It can be created just before parsing and destroyed after you store its result. Otherwise you pollute the header with too many implementation details.

Yeah, after so many iterations it doesn't make to sense to keep the helper class for the current implementation. I removed the class and implemented it via anonymous namespace helper functions and StreamReader member variables."
582358309,11833,ghost,2020-02-05T11:10:30Z,"So what happens after this gets merged?
Will latest qBit installer ship with the latest GeoLite db as fallback?
Or are you going to make everyone register at maxmind for a license key (lol)
I don't see how this will be useful for majority of the users who would probably never figure out how to do it.
I think qBit should include the database in the installer. Downloading using individual license will probably even flood Maxmind with new registrations which are completely unnecessary."
582408665,11833,sledgehammer999,2020-02-05T13:32:39Z,"@an0n666 

>With this change a db is loaded either by using a user provided license key or by parsing a user provided file (eg user kept a copy from their previous installation or some 3rd party has decided to distribute a copy of the db).
>
>**Why don't we provide a copy of the db?** Well, if the contents of the db really fall under the GDPR/CCPA then I don't want to handle conforming to those 2 laws. Let each user have the legal responsibility."
583237824,11833,glassez,2020-02-07T05:14:11Z,">The logic is to first load any existing db and then perform db update if possible and necessary.

IIRC, it's existing logic, although it seems weird to me currently..."
583724201,11833,ghost,2020-02-08T10:32:08Z,"Have you looked into alternatives like db-ip? 
https://db-ip.com/db/lite.php
@sledgehammer999 "
584424548,11833,sledgehammer999,2020-02-11T00:24:26Z,">Have you looked into alternatives like db-ip?

Yes, but I don't think I came across that one. It seems to serve the db in the same format as MaxMind.

@glassez @Chocobo1 it seems that all we have to do is change the URL. Should this PR be dropped?
Do we have any reason on not using that service instead?"
584454733,11833,Chocobo1,2020-02-11T02:29:39Z,">Do we have any reason on not using that service instead?

If it works, then why not?

Also this https://db-ip.com/db/download/ip-to-country-lite
>The free IP to Country Lite database by DB-IP is licensed under a Creative Commons Attribution 4.0 International License.
>
>You are free to use this IP to Country Lite database in your application, provided you give attribution to DB-IP.com for the data."
584524829,11833,glassez,2020-02-11T08:32:09Z,">>Do we have any reason on not using that service instead?

>If it works, then why not?

:+1:

"
585564171,11833,ghost,2020-02-13T05:54:17Z,"> > Have you looked into alternatives like db-ip?
> 
> Yes, but I don't think I came across that one. It seems to serve the db in the same format as MaxMind.
> 
> @glassez @Chocobo1 it seems that all we have to do is change the URL. Should this PR be dropped?
> Do we have any reason on not using that service instead?

The URL, DB_TYPE[], METADATA_BEGIN_MARK[] and maybe some other things as well.
Apparently they don't use a static URL like maxmind. It changes according to month.
I got the db to load only by changing the DB_TYPE to DBIP-Country-Lite. So it does work with qBit. Now you just have to change the others stuffs to make it auto download."
585732629,11833,sledgehammer999,2020-02-13T12:30:07Z,">Apparently they don't use a static URL like maxmind. It changes according to month.

Damn. Actually I have implemented all necessary changes locally. I was waiting to polish the docs a bit. I did it in a hurry and didn't realize that the URL has the date encoded in it. Damn it.
If I find time, I may send them an e-mail about this.
Alternatively, we could try our luck by ""guessing"" the next month's URL."
585734857,11833,ghost,2020-02-13T12:36:26Z,"Guessing might work. 
dbip-country-lite-2020-month.mmdb.gz
Take value according to current month number. "
585736722,11833,ghost,2020-02-13T12:41:48Z,You could also just use one subdomain from qbitorrent.org to redirect to latest version every month. 
586455534,11833,sledgehammer999,2020-02-14T20:14:45Z,Alternative PR implemented: #12014
586740636,11833,FranciscoPombal,2020-02-16T19:01:02Z,"> Alternative PR implemented: #12014

So is this superseded or are there any alternative plans for this?"
586742747,11833,sledgehammer999,2020-02-16T19:23:21Z,">So is this superseded or are there any alternative plans for this?

Superseded and will be closed once the other one is merged."
587505727,11833,sledgehammer999,2020-02-18T15:07:19Z,Closing as superseded by #12014
491590453,10527,liuhe36,2019-05-12T12:14:56Z,"hi~,tag support for webui is very useful.  so what's the release time of 4.2.0 version ?

thanks."
495212588,10527,fusioneer-GitHub,2019-05-23T13:13:10Z,Is there any other changes I should do to get PR approved?
497289464,10527,glassez,2019-05-30T10:49:20Z,"@fusioneer-GitHub, are you kidding? Why do you have these unrelated and incorrect changes here (https://github.com/qbittorrent/qBittorrent/commit/e2ebdc1a247bf704f58e89a09cfa276df2ae4c63)? Do you want this PR  to never be merged?"
500211121,10527,fusioneer-GitHub,2019-06-09T13:12:32Z,Looks like we begin to go in circles here. Is there any more constructive suggestions before we can resolve PR somehow?
500271861,10527,Chocobo1,2019-06-10T02:29:14Z,"@glassez 
Should we bump the web api version in this PR?
"
500289587,10527,glassez,2019-06-10T04:40:54Z,">Should we bump the web api version in this PR?

Yes. Unless such a bump has been since the previous release.
"
500301861,10527,Piccirello,2019-06-10T06:01:28Z,Will try reviewing within the next couple hours.
500340900,10527,Chocobo1,2019-06-10T08:47:40Z,">> Should we bump the web api version in this PR?
>
> Yes. Unless such a bump has been since the previous release.

Ah, our wiki says it is still pending: https://github.com/qbittorrent/qBittorrent/wiki/Web-API-Documentation#api-v230 . Guess we'll bump it later.

@fusioneer-GitHub 
Just a reminder. After this PR is accepted & merged, please document the new API in the wiki: https://github.com/qbittorrent/qBittorrent/wiki/Web-API-Documentation
"
500504555,10527,fusioneer-GitHub,2019-06-10T17:26:27Z,"> * `Untagged` always has a count of 0, despite having untagged torrents

Fixed.

> * After running `Remove unused tags`, tags that have torrents display a count of `(0)`

Hasn't been able to reproduce. Maybe it was related to previous bug, that has been fixed at this point.

I would rather wait for some kind of consensus before acting on API error handling."
500514838,10527,Piccirello,2019-06-10T17:53:09Z,"> Maybe it was related to previous bug, that has been fixed at this point.

I’ll retest later today with your new changes and see if I can reproduce.

> I would rather wait for some kind of consensus before acting on API error handling.

👍🏼 "
500694908,10527,Piccirello,2019-06-11T05:41:55Z,"@fusioneer-GitHub I'm still able to reproduce the bug. I believe it's only the last tag in the sorted list that exhibits the behavior of returning to a count of 0. You can see below I had a tag of `one` with 1 torrent. I added the tag `new`, at which point `one` now displayed a count of 0.

<img width=""198"" alt=""Screen Shot 2019-06-10 at 10 40 29 PM"" src=""https://user-images.githubusercontent.com/8296030/59246337-ed2b3100-8bd0-11e9-9b51-f60f974901ec.png"">
<img width=""198"" alt=""Screen Shot 2019-06-10 at 10 40 38 PM"" src=""https://user-images.githubusercontent.com/8296030/59246338-ed2b3100-8bd0-11e9-90a8-d0d695426e40.png"">
"
501740207,10527,fusioneer-GitHub,2019-06-13T14:58:41Z,"@Piccirello, sorry, I'm still unable to reproduce. Tried different browsers, clearing caches, reloading client and/or server. Can you give step-by-step instructions starting from blank setup or give more details about environment?"
502064704,10527,Piccirello,2019-06-14T10:54:32Z,"Sure thing. From a clean state:

Example 1:
1. Create new tag `b`. Sidebar displays `b (0)`
1. Assign a torrent to `b`. Sidebar displays `b (1)`
1. Create new tag `a`. Sidebar displays `a (0)` and `b (0)`

Example 2:
1. Create new tags `a`, `b`, and `c`
1. Assign a torrent to `b`. Sidebar displays `b (1)`
1. Delete tags `a` and `c`. Sidebar displays `b (0)`"
502271407,10527,fusioneer-GitHub,2019-06-14T21:29:36Z,"That one was tough. Key detail was that torrent should have been updated via sync between setting it's tag and adding another one.
@Piccirello, @glassez
Guys, what about error handling? Should I do it or not?"
502300946,10527,Piccirello,2019-06-14T22:35:41Z,"@glassez let’s continue the API error handling discussion. I feel pretty strongly that the API should make every reasonable effort to bubble up errors and not swallow them. The client doesn’t have to act on them, but it should be made aware and have the opportunity to do so. It also affords third party clients more robust programmatic access. What do you think of this?"
502326793,10527,Piccirello,2019-06-15T02:18:30Z,Tested and confirmed the bug is fixed 👍 
502333863,10527,glassez,2019-06-15T04:36:14Z,">@glassez let’s continue the API error handling discussion.

Sure. Just a hell of a lot of free time...
>I feel pretty strongly that the API should make every reasonable effort to bubble up errors and not swallow them.

Agreed.
But we need to have a clear distinction between what causes the exception and stops further processing, and what just reports some ""problems"" during processing, but finishes the work to the end.
Unlike interacting with some interface within the same ""flat"" program, where some ""illogical inputs"" must be treated as a logical error, interacting in an asynchronous environment requires a different thinking.
For example, the user selected some torrents in the WebUI to add some tags. But while its request reached the server, there could already be something to change, e.g. some of the torrents has been deleted. The server should not interrupt processing on such a torrent and return 404 error. It should finish the job and the error can be reported in the body of the server response (let the client decide what to do with it, depending on its implementation).
Second example. The client wants to create some tags. What does it really want? To make the act of creating each tag happen? No. It just wants these tags to exist after its request is executed. So if some tag already exists during the processing of the request, it is not an error. But if the sercer cannot create a tag (for example, an unsuitable name), then an error occurred. Again, if we are talking about a batch request, the server must process the entire batch without interruption (errors can be reported in the body of the server response).

Actually (to be honest), our (existing) Web API has incorrect error reporting/handling in many cases. We put it all together. But we should clearly distinguish between HTTP errors and application errors. All application errors should be reported in application defined format in the response body (either with HTTP Conflict response code when some method cannot be finished at all or with HTTP Ok response when the method is finished with some non-fatal errors/warnings). E.g. if the client call nonexistent API method then it is ""Not Found"" HTTP error, but if it pass nonexistent torrent as param to some method - it isn't.
But I guess you don't want to change that..."
502427759,10527,Piccirello,2019-06-16T07:17:00Z,"> Sure. Just a hell of a lot of free time...
 
Respond at your leisure. We're all working on this project in our spare time.

> But we need to have a clear distinction between what causes the exception and stops further processing, and what just reports some ""problems"" during processing, but finishes the work to the end.

If a problem occurs while iterating, the problem should be noted and iteration should continue.

> But we should clearly distinguish between HTTP errors and application errors

Agreed. I can think of two approaches:

1. Page not found throws a 404, everything else gets reported in the body.
2. Errors attributable to an api parameter will only throw if the parameter is static (i.e. same value applied to each iterator). An error with an iterated field should be reported in the body. For example, `deleteTags(tags)` never throws, `addTags(hashes, tags)` never throws, `setCategory(hashes, category)` would throw if `category` doesn't exist, and `editCategory(category, savePath)` would throw for any error resulting from either parameter.

I personally think HTTP error codes are a great device until you need to represent multiple statuses. We can use them but will have to be very cognizant of what errors we should be throwing for. I think this approach could be more error prone, but could also have other benefits. Curious to hear others' thoughts.

> All application errors should be reported in application defined format in the response body

I think we should have a standard response object. Something like this (just a proposal):

```javascript
{
  allSucceed: bool,
  allFail: bool,
  responses: [
    {
      error: {  // this object is empty/undefined when successful
        status: ENUM.VALUE, // serialized as an integer
        message: """" // optional additional info
      }
      response: {
        // ...
      },
    },
    { ... }
  ]
}
```"
503449699,10527,glassez,2019-06-19T07:52:45Z,">Page not found throws a 404, everything else gets reported in the body.

I would formulate a more generalized requirement:
1. Errors in the HTTP layer are reported via HTTP status codes, e.g., page not found (including non existing api method), bad request (from HTTP perspective) etc.
2. All errors from API are reported in response body. Only two HTTP statuses are possible here: OK when no errors occurred (but there may be some warnings) and Conflict when job is fully or partially fails (or even use OK status for all similar responses).

>Something like this (just a proposal):

I think its format will become more or less clear when (if) we start to standardize the existing  API methods. One thing I don't like in principle is the 'split' status (`allSucceed: bool, all Fail: bool`), which can have inconsistent values. So it is better to have one field of enumerable type (`status: int`), besides it can be expanded to indicate a large number of statuses.

As for the current PR, you can leave comments with your suggestions for handling specific errors directly in the affected API methods code, and we will discuss them there."
503948317,10527,Piccirello,2019-06-20T09:16:36Z,"> I would formulate a more generalized requirement

I agree with this approach.

> Conflict when job is fully or partially fails 

If we do return a 409, I think it should only be for full failure. To me, it seems more odd to return an error code on partial success than to return a success code on partial failure.

> One thing I don't like in principle is the 'split' status ... which can have inconsistent values.

Can you clarify what you mean by inconsistent values?

> As for the current PR, you can leave comments with your suggestions for handling specific errors directly in the affected API methods code, and we will discuss them there.

On my initial review I left a couple comments in specific places where we should be catching errors. We should be able to pick up from there."
503954014,10527,glassez,2019-06-20T09:32:45Z,">Can you clarify what you mean by inconsistent values?

Both allSucceed and allFail are set to true."
503955741,10527,Piccirello,2019-06-20T09:37:44Z,"> Both allSucceed and allFail are set to true.

Any implementation of any specification can be incorrect. That's not a reason not to use it."
503978841,10527,glassez,2019-06-20T10:50:47Z,">Any implementation of any specification can be incorrect. That's not a reason not to use it.

There is no complete specification currently. We just start to define it. And this is the best time to get rid of the obvious shortcomings in it. Using two variables to indicate mutually exclusive states is ""obvious shortcoming""."
503999353,10527,glassez,2019-06-20T12:05:08Z,">On my initial review I left a couple comments in specific places where we should be catching errors. We should be able to pick up from there.

All the comments I was able to find contain suggestions of ""radical"" error handling methods that we rejected.
I ask you to re-comment there taking into account the agreements reached."
505376973,10527,Chocobo1,2019-06-25T10:03:20Z,"@Piccirello 
What is the current status? Is there anything undone?"
505505750,10527,Piccirello,2019-06-25T15:49:58Z,I've documented 4 cases where I think we should be handling errors.
508836046,10527,fusioneer-GitHub,2019-07-05T18:37:11Z,"@Piccirello @glassez 
I've added commit with minimalistic error reporting in JSON. What do you think of such error structure?
For now there is no handling of missing hashes/torrents, but I'm not sure this should go in this PR."
508909909,10527,glassez,2019-07-06T09:03:28Z,">What do you think of such error structure?

I would return this structure not as response but as a field of response. Response should always be JSON object, so you can return error array as ""errors"" field of response object."
513744932,10527,fusioneer-GitHub,2019-07-22T11:00:18Z,Error handling rolled back. Rebased to latest master.
513853736,10527,Piccirello,2019-07-22T16:22:33Z,I will test this tonight.
514034954,10527,Chocobo1,2019-07-23T03:04:11Z,">I will test this tonight.

hope you didn't found anything broken... I'm waiting for this PR as merging others will cause conflicts to it."
514052312,10527,Piccirello,2019-07-23T04:47:12Z,"Just got home, will be testing within the hour."
514154482,10527,fusioneer-GitHub,2019-07-23T10:35:16Z,Fixed and conflicts resolved.
514647384,10527,Chocobo1,2019-07-24T14:07:46Z,"@fusioneer-GitHub 
Thank you!"
143653063,3810,glassez,2015-09-28T06:40:09Z,"1. We no longer use *.pri based structure in new code (and gradually get rid of it in existing code). Now *.pri-driven folders are accepted for top level application parts only (app, core, gui, webui) and for 3rd-party components (like QtSingleApplication). So fix it in your PR (see Core structure for example). Also your multilevel folder structure is overkill. Please use some structure as following:
   <pre>
   src/gui/notifications
   --- notifier.h
   --- notifier.cpp
   --- dbusnotifier.h
   --- dbusnotifier.cpp
   --- systemtraynotifier.h
   --- systemtraynotifier.cpp
   --- qtnotify
   ------- (qtnotify files with .pri since it's 3rd party)
   </pre>
2. Fix coding style (see CODING_GUIDELINES.md).
3. To be continued...
"
147703620,3810,zeule,2015-10-13T12:40:15Z,"I've changed the file structure as requested. Was not able to find out the coding style violations. Could you point out exact locations, please?
"
147761998,3810,Chocobo1,2015-10-13T16:08:47Z,"> Was not able to find out the coding style violations. Could you point out exact locations, please?

In case you haven't read our coding guidelines: https://github.com/qbittorrent/qBittorrent/blob/master/CODING_GUIDELINES.md
"
147780890,3810,zeule,2015-10-13T17:12:00Z,"Thank you, @glassez, for your time! I've followed your remarks and tried to fix mistakes in the rest part of the diff.  
"
148009029,3810,zeule,2015-10-14T10:39:47Z,"Thank you again, @glassez! I'm so inattentive... 
As for the newlines at the end of files, I do not understand you: the LFs at the end of files are present. 
"
148017889,3810,glassez,2015-10-14T11:04:49Z,"> I'm so inattentive...

It is what it is... :)
At least, you still not fixed all comments on top of files (I mean copyright and Qt instead of Qt4/Qt5).

> the LFs at the end of files are present.

Oops, sorry! I got used to the fact that the editors show it more intuitively (as a blank line at the end of the file). Unfortunately, GitHub does not.
"
150897883,3810,glassez,2015-10-25T07:02:59Z,"Damn, your PR did not let me sleep tonight. I was wondering what's wrong. And I've finally figured it out. I used to get hung up on details, and I didn't like its implementation. But now I looked at it as a whole.
You put some event handling in notifier code, and this, I think, quite wrong. It's like to create, for example, the button widget and to place ""button press"" handling in button code itself for all the possible uses of this button in the program. But the proper way is to emit ""press"" signal.
This case is, of course, more difficult...
"
150924723,3810,zeule,2015-10-25T13:50:35Z,"Do you mean DBusNotifier::actionInvoked(uint id, const QString &action_key)? AFAIK OS X desktop notifications do not support custom actions, Windows tooltips too. Do you think somebody might implement a custom tooltip (with actions) for Windows? Otherwise actions handling code is specific for DBus notifications only. Do I understand you correctly that you think that emitting signal here (DBusNotifier::actionInvoked()) would be more difficult? If so, why?
"
150934631,3810,glassez,2015-10-25T15:24:54Z,"> Do I understand you correctly that you think that emitting signal here (DBusNotifier::actionInvoked()) would be more difficult?

No. I only meant that the Notifier is more complex than the Button in my example.

> Otherwise actions handling code is specific for DBus notifications only.

This is the main problem here. It turns out that these classes (SystemTrayNotifier and DBusNotifier) have not fully compatible interface, but you're trying to stretch it on both of them, with the result that it has a lot of excesses (not only in Notifier interface but in its implementation too).
But I have no answer to the question of how to do it nicely. I merely ask you to think about it. The first solution is not always correct. Often, except for the ideas itself it doesn't contain anything correct. It's like a diamond: we found it, but the real value only after it gets cut. (I was drawn to the lyrics...)
"
150937645,3810,zeule,2015-10-25T16:04:58Z,"> But I have no answer to the question of how to do it nicely. I merely ask you to think about it. 

Well, I can think about a common sink for qBt, where all the messages are  dumped (execution log?) and notifiers subscribe to it and select the messages which are needed to be shown on desktop.
"
150939037,3810,glassez,2015-10-25T16:27:33Z,"> Well, I can think about a common sink for qBt, where all the messages are dumped (execution log?) and notifiers subscribe to it and select the messages which are needed to be shown on desktop.

Cool! So we still something have ever.
The next step of reasoning: Notifier can connect to the desired signals of the desired objects directly (without any logs). This solves some problems.
"
150939226,3810,zeule,2015-10-25T16:31:30Z,"Direct connection? This would create spaghetti-like code. Plus, objects
need to expose their internals instead of sending information to the common
sink.
"
150949290,3810,glassez,2015-10-25T18:07:17Z,"> Direct connection? This would create spaghetti-like code. Plus, objects need to expose its internals instead of sending information to the common sink.

You see everything in a bad light! There will be no spaghetti! There will be the usual implementation of the Observer pattern in Qt style. It already exists. We only remove redundant intermediary on behalf of the MainWindow.
Now we have:

``` c++
// mainwindow.h
// ...
private slots:
    void finishedTorrent(BitTorrent::TorrentHandle *const torrent) const;

// mainwindow.cpp
// ...
    connect(BitTorrent::Session::instance(), SIGNAL(torrentFinished(BitTorrent::TorrentHandle *const)), this, SLOT(finishedTorrent(BitTorrent::TorrentHandle *const)));
// ...
 void MainWindow::finishedTorrent(BitTorrent::TorrentHandle *const torrent) const
 {
    notifier->notifyTorrentFinished(torrent);
 }

// notifier.h
// ...
public:
    virtual void notifyTorrentFinished(const BitTorrent::TorrentHandle* h, QWidget* widget = nullptr);

// notifier.cpp
// ...
void Notifier::notifyTorrentFinished(const BitTorrent::TorrentHandle *h, QWidget *widget)
{
    // ...
}
```

I suggest to change this to the following:

``` c++
// notifier.h
// ...
private slots:
    void torrentFinished(BitTorrent::TorrentHandle *const torrent);

// notifier.cpp
// ...
    connect(BitTorrent::Session::instance(), SIGNAL(torrentFinished(BitTorrent::TorrentHandle *const)), this, SLOT(torrentFinished(BitTorrent::TorrentHandle *const)));
// ...
void Notifier::torrentFinished(BitTorrent::TorrentHandle *const torrent)
{
    // ...
}
```

Mind you, we are not changing anything in the application core - it works as before.
"
150954448,3810,zeule,2015-10-25T18:48:08Z,"This is a good idea, indeed. Then I start to work on implementation for GUI and GUI-less modes using this approach?
"
150960150,3810,glassez,2015-10-25T19:18:45Z,"> This is a good idea, indeed. Then I start to work on implementation for GUI and GUI-less modes using this approach?

I think this is a good starting point for your work. Let's go!
"
153553810,3810,zeule,2015-11-04T02:43:18Z,"The next iteration. Implemented as it was discussed here:
- NotificationsManager is an observer of Session
- DBus notifications  (and NotificationManager as well) work with `noguiI`. As such all code except systray moved from gui into core

The following things can be improved:
1. More events may be handled.
2. Default action for notification (mouse click) might be used to select a torrent in the list (GUI or WebUI). I believe this is useful if we start to show notifications when torrent metadata got loaded and the torrent contents become available.  User may select files priorities, set files to skip.
3. A settings page for turning specific notifications on/off may be added.
"
159016245,3810,zeule,2015-11-23T18:13:27Z,"OK, let's move this mess into the application object.
"
193964830,3810,zeule,2016-03-08T21:00:04Z,"Ups, sorry, forgot to push changes. Give me a bit of time to update CMake files and then I'll push the changes.
"
194074285,3810,zeule,2016-03-09T02:21:25Z,"@LordNyriox : rebased
"
212108158,3810,zeule,2016-04-19T20:15:55Z,"@glassez: could you look at this one more time and try to recall what did you want to change, please?
"
212341388,3810,glassez,2016-04-20T09:13:08Z,"I'm not going to watch it entirely now.
The main drawback here is you have mixed the GUI and the underlying (base) code. At least it affects your **NotificationsManager** class, which adds GUI dependency to Base.
It should be implemented something like this:
1. We have some basic (independent from GUI) NotificationsManager implemented and used in Base code.
2. We have NotificationsManager subclass in GUI.
3. We instantiate either Base or GUI NotificationsManager in Application.

You can also implement this way other classes if they are subject to the same problem.

P.S. Now I don't pay attention to the details. I don't like the overall design. I'll see it more when you fix it.
"
212425021,3810,zeule,2016-04-20T13:32:01Z,"Thank you for the detailed explanation! To go this way we have to:
1. Create a hierarchy not only for the manager class but for the notification too.
2. As such, Notification objects must reside in the heap and be crated via a factory.
3.  GUI code needs either use type cast with these notification objects or needs to know the exact type of the factory to use covariant return types.
Is that what you want?
"
212440957,3810,glassez,2016-04-20T14:09:49Z,"> Is that what you want?

In General, Yes. But I do not understand what you exactly mean in paragraph 3. Some example hierarchies and use cases would be very handy.
"
212499148,3810,zeule,2016-04-20T16:20:55Z,">  But I do not understand what you exactly mean in paragraph 3. 

Now the code flow is the following:

``` C++
Notification n;
n.setXXX().setYYY().setWidget();
notificationManager()->showNotification(n);
```

With the changes noted earlier, the code will look like:

``` C++
Notification* n = notificationManager()->createNotification();
n->setXXX()->setYYY();
notificationManager()->showNotification(n);
```

Or in GUI code:

``` C++
inline GUINotificationManager* guiNotificationManager()
{
    ///
}

GuiNotification* n = guiNotificationManager()->createNotification();
n->setXXX()->setYYY()->setWidget();
notificationManager()->showNotification(n);
```
"
212529629,3810,glassez,2016-04-20T17:38:26Z,"Well, something like that. 
But now I am confused more... Shouldn't NotificationManager follow the Observer pattern? I thought that it would observe events of other components...
"
224118060,3810,zeule,2016-06-06T23:20:38Z,"PR Updated. Notifications manager follows the Observer pattern. Added possibility and GUI to enable/disable individual notifications. The GUI is weird now, because I plan to add some more widgets to that page (optional logging notifications to a file and probably to other destinations via an external command).
"
321687133,3810,sledgehammer999,2017-08-10T22:10:05Z,"@evsh FYI, I approve this feature as long as it doesn't hard-depend on KDE."
321688746,3810,zeule,2017-08-10T22:18:23Z,"> @evsh: Might I ask why you are no longer maintaining this PR?

My local copy of this contains half-finished work that allows user to configure notifications (disable, play sound, run a program, restore app window) for given event type. Finishing that requires investing a time, which I don't have currently. Not earlier than October. Also code design requires significant improvements. 
 
> @evsh FYI, I approve this feature as long as it doesn't hard-depend on KDE.

Thanks, it does not, AFAIR."
592073070,3810,FranciscoPombal,2020-02-27T17:12:11Z,@zeule is this abandoned?
592080200,3810,zeule,2020-02-27T17:27:44Z,"I'm not interested in pursuing my PRs anymore. There might be a useful bit here: FDO desktop notifications daemons can't access  qBt resources and thus can't show icons in the tooltip. They have to be replaced with real file paths. Icon themes for Plasma provide ""cloud-download"" and ""cloud-upload"" icons."
611433007,12458,jagannatharjun,2020-04-09T09:36:42Z,"`QPainter::drawText` seems to work but just to be sure I'm now using `QStyle::drawItemText` in `LogItemDelegate::paint`

Following font size is changed using stylesheet, before it wasn't possible.
![image](https://user-images.githubusercontent.com/34717789/78880911-b2ee2280-7a73-11ea-98c7-aba69cbe3fe5.png)


"
612372652,12458,glassez,2020-04-11T09:06:21Z,">AFAIK this automatic detection will only work when we use `QThread`

What's the problem? What exactly is bothering you?"
612387302,12458,jagannatharjun,2020-04-11T10:25:17Z,"> What's the problem? What exactly is bothering you?

the newLogMessage is emitted from addMessage which can be called from different threads"
612388042,12458,glassez,2020-04-11T10:29:20Z,">the newLogMessage is emitted from addMessage which can be called from different threads

Yes. There should be no problem. According to the docs (I posted in my comment above):
>If the receiver lives in the thread that emits the signal, `Qt::DirectConnection` is used. Otherwise, `Qt::QueuedConnection` is used. **The connection type is determined when the signal is emitted**."
612744165,12458,Chocobo1,2020-04-13T04:27:06Z,"@jagannatharjun 
Please fix all `extra ‘;’` warnings: https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/673732414"
612744748,12458,Chocobo1,2020-04-13T04:30:14Z,"And those:
```
../../src/gui/log/loglistview.cpp: In member function ‘virtual void {anonymous}::LogItemDelegate::paint(QPainter*, const QStyleOptionViewItem&, const QModelIndex&) const’:
../../src/gui/log/loglistview.cpp:79:57: warning: ‘int QFontMetrics::width(const QString&, int) const’ is deprecated: Use QFontMetrics::horizontalAdvance [-Wdeprecated-declarations]
   79 |             const int timeWidth = fontMetrics.width(time);
      |                                                         ^
In file included from /usr/include/qt/QtWidgets/qwidget.h:50,
                 from /usr/include/qt/QtWidgets/qframe.h:44,
                 from /usr/include/qt/QtWidgets/qabstractscrollarea.h:44,
                 from /usr/include/qt/QtWidgets/qabstractitemview.h:44,
                 from /usr/include/qt/QtWidgets/qlistview.h:44,
                 from /usr/include/qt/QtWidgets/QListView:1,
                 from ../../src/gui/log/loglistview.h:32,
                 from ../../src/gui/log/loglistview.cpp:30:
/usr/include/qt/QtGui/qfontmetrics.h:106:9: note: declared here
  106 |     int width(const QString &, int len = -1) const;
      |         ^~~~~
../../src/gui/log/loglistview.cpp:84:100: warning: ‘int QFontMetrics::width(const QString&, int) const’ is deprecated: Use QFontMetrics::horizontalAdvance [-Wdeprecated-declarations]
   84 |             style->drawItemText(painter, textRect.adjusted((timeWidth + fontMetrics.width(SEPARATOR)), 0, 0, 0), 0
      |                                                                                                    ^
In file included from /usr/include/qt/QtWidgets/qwidget.h:50,
                 from /usr/include/qt/QtWidgets/qframe.h:44,
                 from /usr/include/qt/QtWidgets/qabstractscrollarea.h:44,
                 from /usr/include/qt/QtWidgets/qabstractitemview.h:44,
                 from /usr/include/qt/QtWidgets/qlistview.h:44,
                 from /usr/include/qt/QtWidgets/QListView:1,
                 from ../../src/gui/log/loglistview.h:32,
                 from ../../src/gui/log/loglistview.cpp:30:
/usr/include/qt/QtGui/qfontmetrics.h:106:9: note: declared here
  106 |     int width(const QString &, int len = -1) const;
      |         ^~~~~
../../src/gui/log/loglistview.cpp: In member function ‘virtual QSize {anonymous}::LogItemDelegate::sizeHint(const QStyleOptionViewItem&, const QModelIndex&) const’:
../../src/gui/log/loglistview.cpp:91:65: warning: ‘int QFontMetrics::width(const QString&, int) const’ is deprecated: Use QFontMetrics::horizontalAdvance [-Wdeprecated-declarations]
   91 |             return QSize(option.fontMetrics.width(logText(index)), QStyledItemDelegate::sizeHint(option, index).height());
      |                                                                 ^
In file included from /usr/include/qt/QtWidgets/qwidget.h:50,
                 from /usr/include/qt/QtWidgets/qframe.h:44,
                 from /usr/include/qt/QtWidgets/qabstractscrollarea.h:44,
                 from /usr/include/qt/QtWidgets/qabstractitemview.h:44,
                 from /usr/include/qt/QtWidgets/qlistview.h:44,
                 from /usr/include/qt/QtWidgets/QListView:1,
                 from ../../src/gui/log/loglistview.h:32,
                 from ../../src/gui/log/loglistview.cpp:30:
/usr/include/qt/QtGui/qfontmetrics.h:106:9: note: declared here
  106 |     int width(const QString &, int len = -1) const;
      |         ^~~~~
```
Use `#if` conditional to differentiate Qt versions.


```
../../src/gui/log/logmodel.cpp: In member function ‘virtual QVariant BaseLogModel::data(const QModelIndex&, int) const’:
../../src/gui/log/logmodel.cpp:94:45: warning: comparison of integer expressions of different signedness: ‘const int’ and ‘boost::circular_buffer<BaseLogModel::Message, std::allocator<BaseLogModel::Message> >::size_type’ {aka ‘long unsigned int’} [-Wsign-compare]
   94 |     if ((messageIndex < 0) || (messageIndex >= m_messages.size()))
      |                                ~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~
```
I would use a `static_cast<int>` on m_messages.size()."
612745210,12458,Chocobo1,2020-04-13T04:32:26Z,"The ""g"" character bottom is cut off: ![screenshot](https://user-images.githubusercontent.com/9395168/79092215-c0145580-7d82-11ea-9fc6-201a4b602f8e.png)

ps. All my tests do not use custom theme."
612747677,12458,Chocobo1,2020-04-13T04:44:28Z,"Current master:
![before](https://user-images.githubusercontent.com/9395168/79092677-35345a80-7d84-11ea-9a93-1436fc04ccfe.png)
This PR:
![after](https://user-images.githubusercontent.com/9395168/79092680-36658780-7d84-11ea-8b10-11af65cb75a1.png)
Notice in this PR, the selection bar has different height margins for top and bottom.
"
612749546,12458,jagannatharjun,2020-04-13T04:53:38Z,">    79 |             const int timeWidth = fontMetrics.width(time);

`QFontMetrics::horizontalAdvance` is not available till 5.11 had to use ifdef.
"
612754948,12458,Chocobo1,2020-04-13T05:19:50Z,">are you sure you're using current version, I thought I fixed this

I check out just before testing it, should be the latest.

>I can't replicate with or without custom theme (windows), can you try with textVMargin as zero?

Tested, now there is no cut off on character bottom. But both top/bottom margin still seems to be zero now.

>EDIT: can you try with const QStyleOptionViewItem *option as nullptr in pixelMetric calls.

I don't understand. You'll need to be more specific."
612756872,12458,jagannatharjun,2020-04-13T05:27:53Z,"replicated on ubuntu, will try to fix it."
612760966,12458,jagannatharjun,2020-04-13T05:44:46Z,"
![image](https://user-images.githubusercontent.com/34717789/79095435-02846500-7d78-11ea-941b-0dc9eece24a2.png)


@Chocobo1Please have a look, it should be fixed now."
612763070,12458,Chocobo1,2020-04-13T05:54:01Z,">Please have a look, it should be fixed now.

I confirm, it is alright now.
"
612777122,12458,jagannatharjun,2020-04-13T06:50:23Z,"on Windows.
current master
![image](https://user-images.githubusercontent.com/34717789/79099128-14b6d100-7d81-11ea-94aa-50ece28494a4.png)

this PR
![qbit-log](https://user-images.githubusercontent.com/34717789/79099117-0e285980-7d81-11ea-8ca1-b5e8640e9823.JPG)

there is extra space at the bottom. 
acceptable?

"
612800279,12458,jagannatharjun,2020-04-13T08:10:32Z,"> there is extra space at the bottom

~~seems like adjusted call on textRect was unnecessary~~

EDIT: it is, please ignore it"
612835006,12458,jagannatharjun,2020-04-13T09:55:16Z,"![image](https://user-images.githubusercontent.com/34717789/79111672-99621900-7d9a-11ea-9075-988011a4267f.png)
stylesheets with margins
![image](https://user-images.githubusercontent.com/34717789/79111727-b696e780-7d9a-11ea-913b-c42b01715717.png)
![image](https://user-images.githubusercontent.com/34717789/79111829-e7771c80-7d9a-11ea-9748-5d577d4d9efb.png)

"
612905520,12458,jagannatharjun,2020-04-13T13:47:25Z,"fonts are not scaling with windows scale setting 

![image](https://user-images.githubusercontent.com/34717789/79125209-65e3b680-7dbb-11ea-834d-51e7a1d7819a.png)

hmm"
612913741,12458,glassez,2020-04-13T14:08:43Z,">fonts are not scaling with windows scale setting

Has QStyledItemDelegate the same problem?"
612917995,12458,jagannatharjun,2020-04-13T14:19:20Z,"> Has QStyledItemDelegate the same problem?

that's the weird part, following code will just work, even don't require setting text margin that I do in `LogItemDelegate::paint`, everything will just work in all platforms
even if I put the whole `LogItemDelegate::paint` in the following code, it will just work, that's what giving me a headache.

```c++
#include <QAbstractListModel>
#include <QApplication>
#include <QDebug>
#include <QListView>
#include <QPainter>
#include <QStyle>
#include <QStyledItemDelegate>

class Delegate : public QStyledItemDelegate {
 public:
  using QStyledItemDelegate::QStyledItemDelegate;

  void paint(QPainter *painter, const QStyleOptionViewItem &option, const QModelIndex &index) const override {
    painter->save();
    QStyledItemDelegate::paint(painter, option, index);
    const QStyle *style = option.widget ? option.widget->style() : QApplication::style();
    const QRect textRect = style->subElementRect(QStyle::SE_ItemViewItemText, &option, option.widget);

    style->drawItemText(painter, textRect, 0, option.palette, (option.state & QStyle::State_Enabled),
                        index.data(Qt::UserRole + 1).toString());
    painter->restore();
  }
};

class Model : public QAbstractListModel {
  QVector<QString> strs;

 public:
  int rowCount(const QModelIndex &parent = {}) const override { return strs.size(); }
  int columnCount(const QModelIndex &parent = {}) const override { return 1; }
  QVariant data(const QModelIndex &index, int role = Qt::DisplayRole) const override {
    if (index.isValid() && role == Qt::UserRole + 1) return strs[index.row()];
    return {};
  }
  void add(QString s) {
    beginInsertRows(QModelIndex(), 0, 0);
    strs.append(s);
    endInsertRows();
  }
};

int main(int argc, char *argv[]) {
  QApplication a(argc, argv);

  QListView view;
  Model model;
  view.setItemDelegate(new Delegate(&view));
  view.setModel(&model);
  model.add(""Text 1"");
  model.add(""Text 1"");
  model.add(""Text 1"");
  model.add(""Text 1"");

  view.show();
  return a.exec();
}

```"
613214945,12458,Chocobo1,2020-04-14T04:08:16Z,">fonts are not scaling with windows scale setting

Which Qt version were you using?"
613326567,12458,jagannatharjun,2020-04-14T09:20:03Z,"> Which Qt version were you using?

using 5.14.1

with 5.12.5 ->
make text bigger -> 225%
![image](https://user-images.githubusercontent.com/34717789/79207784-c677ff80-7e5e-11ea-83d6-7dea43ef0bfb.png)

scaling 175%
![image](https://user-images.githubusercontent.com/34717789/79207950-050dba00-7e5f-11ea-973a-520e530a55e9.png)

TransferListWidget scale well in both scenarios and both qt versions

"
613523552,12458,jagannatharjun,2020-04-14T15:51:29Z,"Finally fixed it

scalling 175%
![headache](https://user-images.githubusercontent.com/34717789/79245450-bcbdbe80-7e95-11ea-85fe-b70adc1e5195.JPG)
![sol](https://user-images.githubusercontent.com/34717789/79245463-c2b39f80-7e95-11ea-8263-784b2c931c05.JPG)

""make text size bigger"" 225%
![textscaling](https://user-images.githubusercontent.com/34717789/79245516-d2cb7f00-7e95-11ea-93cb-c5b2c5a8cb44.JPG)

@Chocobo1 @glassez please have a look


"
615017915,12458,Chocobo1,2020-04-17T03:28:53Z,"@jagannatharjun 
Thank you! This PR is quite important in terms of perforamce, good work!"
200391651,4994,ngosang,2016-03-23T15:22:29Z,"I see the ""n/a"" string in the Availability column in the main folder for a few seconds, after that it's working well.
"
200418095,4994,zeule,2016-03-23T16:14:15Z,"My target was to show what part of a file (dir) is available. Therefore I compute the availability ratio as follows.
- For a single file iterate through pieces, count those which are available from at least one peer and divide this count on the number of pieces for file. If there are no pieces available at all, return -1 which is show as ""n/a"" in UI.
- For directory iterate over contents. If a content item availability is not equal to -1, accumulate the availability number and item size. Return accumulated availability divided by accumulated size (see [TorrentContentModelFolder::recalculateAvailability()](https://github.com/qbittorrent/qBittorrent/pull/4994/files#diff-0bbd6040bdcf1a2a54a7ecf5ca08a5faR157)), or -1 (""n/a"") if there were no available pieces found.

Of course, this method is not able to show how many seeders offer the file. Perhaps, both values (which parts are available and how many seeders have them) can be shown together via colourful progress bar where hue is actively used. Though this will look cryptic, I'm afraid.
"
200422022,4994,zeule,2016-03-23T16:25:04Z,"@ngosang because the computation for a large torrent might be expensive, I decided not to recompute upon selection, but do it only in the usual progress update queue. 
"
200428818,4994,ngosang,2016-03-23T16:37:58Z,"Align the text on the left:
![](http://i.imgur.com/UtuVPk0.png)
"
200468204,4994,zeule,2016-03-23T18:01:33Z,"@ngosang what text?
"
200564763,4994,zeule,2016-03-23T22:13:40Z,"Yes, this is clear. But the text piece which he wants to be aligned is not marked in his screenshot.
"
200897134,4994,ngosang,2016-03-24T15:50:29Z,"I mean all strings are centered, I think will look better if all strings are aligned to the left.
"
203869920,4994,glassez,2016-03-31T10:25:37Z,"@evsh, although I'm already tired doing this, but I will say it again - please fix the coding style. And please, try to do it before you publishr every your PR.

""Follow project coding style"" does not mean ""correct indentation"" only.
"
203953797,4994,zeule,2016-03-31T14:02:14Z,"@glassez, I'm sorry for that. Fixed all violations which I was able to find and opened PR #5043. If there are any other rule breaks, then I can't find them. In that case, point me, please, on them.
"
203968721,4994,glassez,2016-03-31T14:39:26Z,"> If there are any other rule breaks, then I can't find them. In that case, point me, please, on them.

OK. I'll check it out later. I hope you're not going to add something here.
"
204708521,4994,zeule,2016-04-02T12:48:27Z,"@glassez my general response: I want commits to be ""atomic"" i.e. contain only one change per commit. I will try to avoid mixing code style change with functional changes. If you like, we can tune together the uncrustify config, for example, to make it produce a code that will suit the project guidelines.
"
204714990,4994,glassez,2016-04-02T13:15:30Z,"@evsh I am finished with the coding style. I hope you will not forget to fix something. But if I missed anything, I will show it later when I will consider implementation.
"
209108200,4994,zeule,2016-04-12T21:22:13Z,"After using this feature for three weeks I can conclude that my expectations from it have been justified and I can now select a torrent for downloading a needed file(s). I do not download large ones frequently, but even that was enough to understand that for them this functionality does not help much. As it was pointed out by @LordNyriox above, for those files it is better to see how many peers can give you a file. And, thinking of it, here is the idea. The ""Availability"" column can provide a tooltip which shows a progress bar (that might look like the one in ""General"" tab) just for the hovered file or directory. The tooltip may also show a legend to read its colour coding. What do you think about it?
"
209546539,4994,zeule,2016-04-13T17:01:38Z,"@LordNyriox: thank you for your input! Do you want [this quantity](http://www.libtorrent.org/reference-Core.html#distributed_copies) to be shown? I might be wrong but the challenge with it is that this parameter does not describe the state ""completely"" (sorry, forgot the mathematical term), i.e. one can not compute its value for a set of objects provided the values for the set members are given.  The torrent content model has to perform lazy computation or cache some other additional values then. One the other side, a tooltip is shown after a dealy and only after user hovered the column, and hence computation will not be triggered on every model update. I will think about an optimal implementation of the original availability value, maybe something will come up. 

Now, as the PR #5083 was merged, I can correct the style.
"
209546974,4994,zeule,2016-04-13T17:03:02Z,"Moreover, can correct the style with pleasure :)
"
209669046,4994,zeule,2016-04-13T22:09:17Z,"@LordNyriox: I was talking about the availability value for a directory and for the whole torrent. There is no problem, of course, to use the regular availability value for the individual files. But we have to recompute those values for each directory from the very beginning because the normal qBt availability values for the files on their own can not be used for that, they do not bear enough information.
"
261792274,4994,zeule,2016-11-20T17:34:45Z,"My new job does not leave me much time for such projects now. Should there be an interest in merging one of my PRs, I will work on it to make it happen. Otherwise, I'm afraid, until the New Year I can not devote enough time for qBt. 
"
299933367,4994,zeule,2017-05-08T17:27:12Z,"@qbittorrent/frequent-contributors: 
The problem with this PR is that numbers in the availability column are not the same as in torrent availability in the ""general"" tab: here it shows just fraction of available pieces, i.e. the number is always between 0 and 1 (0% and 100% in UI). I did not find a quick and memory-efficient way to compute proper availability values. If the current is OK with the project members, let's finish this PR, because I'm sure not only me will find this feature useful. "
299964149,4994,zeule,2017-05-08T19:19:41Z,@LordNyriox: corrected! I'm grateful to you for the observational reading!
300124708,4994,zeule,2017-05-09T10:29:22Z,">  Now, about that Uncrustify run...

@LordNyriox: you see, they force me to do this. Have no other choice :) "
300170473,4994,zeule,2017-05-09T13:50:32Z,PR was updated addressing comments.
300221491,4994,zeule,2017-05-09T16:27:38Z,"Regarding the proper availability values: I renamed the function in `TorrentHandle` into `availableFileFractions()`. When/if anybody comes up with a proper and fast implementation, it can be replaced. If implementation is not fast, it can be added alongside with this one. Maybe this is a way to go and we can merge this PR?"
300311941,4994,zeule,2017-05-09T21:49:01Z,"> @evsh: Might I ask what you mean by ""fast implementation""?

On my laptop qBt with visible GUI uses 8-9% of one CPU core. The implementation I was able to make raised that by 1-2%, and I consider that unacceptable.

> @evsh: Also, you have over a half-dozen fixup commits. Do you think you could go ahead and squash all but the last 1 fixup for each commit?

This is intentional except the last two. I made a fixup commit for each of the previous commits to clearly show changes for reviewers. When they ~approve~ review the changes, I'll squash everything down to original 3 commits."
300316611,4994,zeule,2017-05-09T22:11:09Z,"@LordNyriox, pardon, I must have mislead you: the method did not change.

>  I was simply requesting you squash the redundant ones.

Makes sense..."
300862170,4994,zeule,2017-05-11T17:35:18Z,Waiting for @Chocobo1 review...
301103564,4994,zeule,2017-05-12T15:11:01Z,"Thank you all of the reviewers! I squashed review commits and now this is ready for mergeging.  Since week in review has passed, once anybody formally approves this, I merge right away.
@Chocobo1, @glassez, please, approve it one more time."
301105091,4994,zeule,2017-05-12T15:16:31Z,"@Chocobo1: thank you and sorry. Found a rebasement issue (formatting), had to push one more time."
301105908,4994,zeule,2017-05-12T15:19:36Z,"Checked, everything seems to be in order."
301107188,4994,zeule,2017-05-12T15:24:16Z,@Chocobo1: thanks!
917429834,15453,Mazino-Urek,2021-09-11T15:58:24Z,"Under Dark Theme:
![image](https://user-images.githubusercontent.com/22009014/133639771-46df77ec-b4b1-4792-96df-b2dfa5bac280.png)
![image](https://user-images.githubusercontent.com/22009014/133639918-4a528f79-837f-4b4b-ab3a-1c3dbf97743c.png)
![image](https://user-images.githubusercontent.com/22009014/133639992-5afc8518-0fa1-4b80-bb7c-e2db0d308887.png)

Under Light Theme:
![image](https://user-images.githubusercontent.com/22009014/133640197-8f854f24-a05a-4549-b41e-d05544248013.png)
![image](https://user-images.githubusercontent.com/22009014/133640250-ec46d485-60c9-431f-b266-49dc6aeca64d.png)
![image](https://user-images.githubusercontent.com/22009014/133640305-ff6abfc1-900a-4449-93ac-fbf38d23af71.png)
"
917430064,15453,Mazino-Urek,2021-09-11T15:59:47Z,Reference #12965 #12169 #8406.
917438164,15453,xavier2k6,2021-09-11T16:55:09Z,"@nowshed-imran Can you address the File health issues please, (README.md)

#### Trailing whitespace in lines: found 1 regression(s)
>`la-capitaine` project is owned by Keefer Rourke and due permission was received before modifying them. Get an icon from there if needed.

Extra space at the end of that line.

#### Too many trailing newlines: found 1 regression(s)
>It is recommended to use ""Svgcleaner"" as optimization tool, as it almost never breaks any icon.

Too many extra empty lines after that line.

#### Typo:
Here is the following folowing color RGBA used for icon uniformity."
917441869,15453,Mazino-Urek,2021-09-11T17:20:04Z,@xavier2k6 Hope it is fixed.
917442127,15453,Mazino-Urek,2021-09-11T17:21:42Z,"@glassez @Chocobo1 @FranciscoPombal  Can I get a yes?
I will tackle Icon related user complain and maintain them until they are completely ready."
917443055,15453,xavier2k6,2021-09-11T17:27:12Z,">Hope it is fixed.

yep, thank you."
917443574,15453,xavier2k6,2021-09-11T17:30:38Z,"Unsure of the use of `qbt-theme` in readme, maybe it should be just qBittorrent theme but I will let others decide.

Don't forget to address the text/icon matching colors (RGB) in transfer list as previously mentioned in previous PR's if you haven't done so already...haven't checked myself."
917449467,15453,Mazino-Urek,2021-09-11T18:12:40Z,"> Unsure of the use of `qbt-theme` in readme, maybe it should be just qBittorrent theme but I will let others decide.

There used to be a folder in that name. It has been removed.



> Don't forget to address the text/icon matching colors (RGB) in transfer list as previously mentioned in previous PR's if you haven't done so already...haven't checked myself.

Yes, I have changed them based on the RGBA scheme I have used."
918581841,15453,thalieht,2021-09-13T21:13:31Z,"All icons look good to me except for one and that is for a practical reason: the speedometer, it's not as easy to distinguish when it's off-on at a glance unlike the current one. Not sure why that is."
918635795,15453,xavier2k6,2021-09-13T22:39:03Z,"> All icons look good to me except for one and that is for a practical reason: the speedometer, it's not as easy to distinguish when it's off-on at a glance unlike the current one. Not sure why that is.

That bugged me too from Original PR.....

I'd use the 3 top left (free) speed icons from https://www.flaticon.com/packs/speedometer-and-time-14 as they can be colored easily.

**(You must attribute the author)**

![speed_default](https://user-images.githubusercontent.com/42386382/133163850-a5506903-03e2-4a70-a137-3bd6de196b89.png)


[slow](https://www.flaticon.com/free-icon/speedometer_3564794)
[speedometer](https://www.flaticon.com/free-icon/speedometer_3564795)
[slow_off](https://www.flaticon.com/free-icon/speedometer_3564796)

Example:
![speed](https://user-images.githubusercontent.com/42386382/133163536-8f81a636-76f1-41be-acf7-5bdd1e49f3b6.png)

Example of how `slow_off` could look in GUI:
![speed_default_light](https://user-images.githubusercontent.com/42386382/133164216-2d13683f-aeb0-4d2a-9146-d5eb1511f5ed.png)
![speeed_gui](https://user-images.githubusercontent.com/42386382/133164220-e106b400-4d75-4b84-9c0b-2f6a1aaaf5e8.png)

Example of how `slow` could look in GUI:
![slow](https://user-images.githubusercontent.com/42386382/133165017-7421e6a1-8bb9-4ed1-a18e-32e0cbd11fbd.png)

(That bloody box around it (when clicked) is on the official/master builds too......I must open an issue for it)

Example of options:
![speedometer](https://user-images.githubusercontent.com/42386382/133164665-dd2fc98b-bc87-4f1a-bee0-84d463fcd4f7.png)
"
918737224,15453,ArcticGems,2021-09-14T02:15:26Z,"I really like xavier2k6 suggestion for the speedometer 👍 

In most cases single color icons looks great, but the speedometer would benefit by having multiple colors like the ones in xavier2k6 comment."
918770413,15453,Mazino-Urek,2021-09-14T03:37:10Z,@xavier2k6 I want to use icon that are under GPL or MIT license. Let me try.
918843464,15453,ArcticGems,2021-09-14T06:19:27Z,"Is it necessary for `disconnected.svg` to have an exclamation mark?

It's difficult to see as a small icon and isn't it enough that `disconnected.svg` is red??"
918942615,15453,xavier2k6,2021-09-14T08:43:26Z,">if it enriches the UI appearance, then we can allow such breaking changes.

If we are allowing this which I think is a great idea, then now is a good time to change the `categories` & `tags` icons from the folder icon `inode-directory.svg` in the left STATUS window pane to their respective icons i.e. `view-categories.svg` & `tags.svg` (or similar)

We could also give the ""check for updates"" an icon which would close #10110
ref.: https://github.com/qbittorrent/qBittorrent/issues/10110#issuecomment-795437151

>Is it necessary for `disconnected.svg` to have an exclamation mark?
It's difficult to see as a small icon and isn't it enough that `disconnected.svg` is red??

I agree with this or something similar to having the `dialog-cancel.svg` in-place or overlayed on top?!

I still dislike the `edit-delete.svg`/`list-remove.svg` & `preferences-web-browser-cookies.svg` icons (prefer fontawesome ones)

Thoughts on using these:

(sourced from flaticon author freepik)
#### Peers Tab
`edit-find-user.svg`
https://www.flaticon.com/free-icon/connected-user_653241
![peers](https://user-images.githubusercontent.com/42386382/133166853-07f6b890-2431-4286-8d9b-234706f55955.png)

#### Speed Graph
`office-chart-line.svg`
https://www.flaticon.com/free-icon/line-chart_425100
![spped graph](https://user-images.githubusercontent.com/42386382/133166863-8cef6c24-026a-4655-a292-762b99060757.png)

#### Trackers
![trackers](https://user-images.githubusercontent.com/42386382/133224707-5d35a35e-f910-46ae-ab98-159d8822bf3d.png)

#### HTTP Sources
![http sources](https://user-images.githubusercontent.com/42386382/133224911-54f20b2b-be55-4f91-81fb-796aa61b9138.png)

OR

![http sources v2](https://user-images.githubusercontent.com/42386382/133258773-8e7c1949-6d43-4a3d-9ba7-9a6e6128b1ce.png)

#### Categories (left window pane)
![categories](https://user-images.githubusercontent.com/42386382/133244324-ec556594-0719-4ba1-85a1-3d0f2664c7f6.png)

It also indicates ""sub-categories""

This is what it would look like in the GUI:
![main gui](https://user-images.githubusercontent.com/42386382/133260153-7cdfae68-9c8e-4064-bb57-8c94fde2127b.png)
"
918946513,15453,xavier2k6,2021-09-14T08:48:37Z,"Are `kt-set-max-download-speed.svg`, `kt-set-max-upload-speed.svg`, `ratio.svg` still relevant now?

If not, then they should be removed & any other ones no longer in use.

Can the remaining `.png` icons be converted to `.svg` I wonder?"
918967072,15453,xavier2k6,2021-09-14T09:13:47Z,"Also for ""documentation"", I think we should use something like:
![book reader](https://user-images.githubusercontent.com/42386382/133230245-a222b47f-319e-4300-bae5-4ac5786103a2.png) or 
![book open](https://user-images.githubusercontent.com/42386382/133230255-c570f3d9-c283-4b28-acdb-6e82d875483b.png)

And for ""About""
![address card](https://user-images.githubusercontent.com/42386382/133230400-6dc6dfc1-a313-4587-a49d-2bab1d7e295f.png)

(all of which are available from fontawesome)"
918988128,15453,ArcticGems,2021-09-14T09:40:40Z,"

> 
> 
> > Is it necessary for `disconnected.svg` to have an exclamation mark?
> > It's difficult to see as a small icon and isn't it enough that `disconnected.svg` is red??
> 
> I agree with this or something similar to having the `dialog-cancel.svg` in-place or overlayed on top?!

If we add the `dialog-cancel.svg` overlay, `disconnected.svg` would need to be a different color, otherwise it will have the same fault.

> 
> I still dislike the `edit-delete.svg`/`list-remove.svg`

Another quick edit. You want something similar to this?? =

![trash_1](https://user-images.githubusercontent.com/55046301/133234289-7f57d25f-163a-4f9a-99b5-49794a1e7a6f.png)
"
919038553,15453,xavier2k6,2021-09-14T10:52:11Z,">Another quick edit. You want something similar to this?? =

![trash_1](https://user-images.githubusercontent.com/55046301/133234289-7f57d25f-163a-4f9a-99b5-49794a1e7a6f.png)

Anything is better to me anyway than the ""drink with ice cubes"" icon (maybe red X)

The icons should represent visually what the intended function is......."
919067509,15453,xavier2k6,2021-09-14T11:36:55Z,"The actual `webui.svg` should be used under ""options""
![webui](https://user-images.githubusercontent.com/42386382/133250618-81bce15c-d280-46f7-a0ac-7b4f0742a320.png)

not

![network-server](https://user-images.githubusercontent.com/42386382/133250659-bf87c432-36dd-4463-90aa-f8322acfcd34.png)
"
919068842,15453,Mazino-Urek,2021-09-14T11:39:12Z,"Lots of feedback. It will take some time. In the meantime, help me with the code part."
919069749,15453,xavier2k6,2021-09-14T11:40:41Z,"> help me with the code part.

No problem, just let me or others know where you are stuck & we'll help when/where we can."
919077071,15453,Mazino-Urek,2021-09-14T11:51:47Z,"> Is it necessary for `disconnected.svg` to have an exclamation mark?
> 
> It's difficult to see as a small icon and isn't it enough that `disconnected.svg` is red??

Which one of this works?
![image](https://user-images.githubusercontent.com/22009014/133252425-a42f6342-1da3-403f-9ba8-874ada055088.png)
![image](https://user-images.githubusercontent.com/22009014/133252586-f3471e89-2eff-48e5-82bb-c576302c3051.png)
"
919077156,15453,xavier2k6,2021-09-14T11:51:56Z,"@nowshed-imran  The https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-919067509 isn't your fault btw, it's been like that for a while......the original same icon was used in alot of places.

"
919078126,15453,xavier2k6,2021-09-14T11:53:26Z,">Which one of this works?

2nd one, exclamation mark.

Can you show one with just a `/` all the way through?!"
919080615,15453,Mazino-Urek,2021-09-14T11:57:20Z,"I think this is a bit excessive.
![image](https://user-images.githubusercontent.com/22009014/133253395-ae1edc24-8854-4bdc-ac55-4c6e253bbe87.png)
"
919082289,15453,xavier2k6,2021-09-14T12:00:04Z,">I think this is a bit excessive.

I meant a slash, not an X

Perhaps below icon could be used as connected:
![connection](https://user-images.githubusercontent.com/42386382/133253231-8c289271-2fbb-4d1f-b85f-794010f89423.png)

For disconnected put a `red x` overlay on it or a slash `/`? Or make the icon red itself.
It gives a good indicator that the user is connected to the outside world or not?!"
919095476,15453,Mazino-Urek,2021-09-14T12:18:32Z,"> > I think this is a bit excessive.
> 
> I meant a slash, not an X
> 
> Perhaps below icon could be used as connected:
> ![connection](https://user-images.githubusercontent.com/42386382/133253231-8c289271-2fbb-4d1f-b85f-794010f89423.png)
> 
> For disconnected put a `red x` overlay on it or a slash `/`? Or make the icon red itself.
> It gives a good indicator that the user is connected to the outside world or not?!

For connected:
![image](https://user-images.githubusercontent.com/22009014/133255191-df4c54e9-d73f-4f3f-b2f0-f0ef39d5155b.png)
For disconnected:
![image](https://user-images.githubusercontent.com/22009014/133256158-89c828a4-3300-481b-a3a1-024123b0faec.png)
This is subtle. But, it works."
919098514,15453,xavier2k6,2021-09-14T12:22:50Z,">This is subtle. But, it works.

Works for me too, depending on how it looks in GUI. 👍 

Ref.:https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-919095476"
919102698,15453,Mazino-Urek,2021-09-14T12:28:55Z,"> #### Speed Graph
> 
> `office-chart-line.svg`
> https://www.flaticon.com/free-icon/line-chart_425100
> ![spped graph](https://user-images.githubusercontent.com/42386382/133166863-8cef6c24-026a-4655-a292-762b99060757.png)
Will this work?
![image](https://user-images.githubusercontent.com/22009014/133257725-0d3ec2bd-0ff6-4363-a5e1-c2d6295f5dda.png)"
919106178,15453,xavier2k6,2021-09-14T12:33:25Z,">Will this work?

I don't think so, as speed graph shows up & down speeds etc. (Again, only my opinion)

The one I chose is similar to your original though & looks better/gives better representation."
919108441,15453,Mazino-Urek,2021-09-14T12:36:36Z,"> > Will this work?
> 
> I don't think so, as speed graph shows up & down speeds etc. (Again, only my opinion)

This one?
![image](https://user-images.githubusercontent.com/22009014/133258596-ed5d3df8-d06f-40e6-abe3-b891a8f4aa86.png)
"
919111653,15453,xavier2k6,2021-09-14T12:41:00Z,">This one?

Nope, as I can forsee issues being opened by users thinking there's a bug in the icon.
You original & this one don't meet at the corners.....slightly stick out.

![gui icon issue](https://user-images.githubusercontent.com/42386382/133259072-ea2a9ec8-d9c7-4c18-a7db-ca01d8f6a61d.png)
"
919117760,15453,xavier2k6,2021-09-14T12:49:19Z,"This is how my suggested icon for `speed graph` would look in the GUI:
![speed graph gui](https://user-images.githubusercontent.com/42386382/133260441-6aea1e39-05c8-4d85-8e37-c3329fa302c0.png)
"
919120558,15453,Mazino-Urek,2021-09-14T12:52:58Z,"> > This one?
> 
> Nope, as I can forsee issues being opened by users thinking there's a bug in the icon.
> You original & this one don't meet at the corners.....slightly stick out.
> 
> ![gui icon issue](https://user-images.githubusercontent.com/42386382/133259072-ea2a9ec8-d9c7-4c18-a7db-ca01d8f6a61d.png)

![image](https://user-images.githubusercontent.com/22009014/133260999-d2152503-bddb-4395-bd7f-c206cb4d56c4.png)

"
919129575,15453,ArcticGems,2021-09-14T13:04:05Z,I think the green & red earth icons are great (checked by adding them to a qBit screenshot). 👍 
919141269,15453,Mazino-Urek,2021-09-14T13:16:37Z,"> This is how my suggested icon for `speed graph` would look in the GUI:
> ![speed graph gui](https://user-images.githubusercontent.com/42386382/133260441-6aea1e39-05c8-4d85-8e37-c3329fa302c0.png)

Think this is the best one yet.
![image](https://user-images.githubusercontent.com/22009014/133264445-d66aac13-d1ed-433d-806b-d7059c5147d7.png)
"
919145170,15453,Mazino-Urek,2021-09-14T13:20:40Z,"> Also for ""documentation"", I think we should use something like:
> ![book reader](https://user-images.githubusercontent.com/42386382/133230245-a222b47f-319e-4300-bae5-4ac5786103a2.png) or
> ![book open](https://user-images.githubusercontent.com/42386382/133230255-c570f3d9-c283-4b28-acdb-6e82d875483b.png)
> 
> And for ""About""
> ![address card](https://user-images.githubusercontent.com/42386382/133230400-6dc6dfc1-a313-4587-a49d-2bab1d7e295f.png)
> 
> (all of which are available from fontawesome)

Kindly mention the specific icon name. Like, `connected.svg`"
919152605,15453,Mazino-Urek,2021-09-14T13:29:19Z,"For Bug icon, 
This:
![image](https://user-images.githubusercontent.com/22009014/133266175-2f76228f-9372-43f8-8de4-02a4d3cf24d5.png)
or this:
![image](https://user-images.githubusercontent.com/22009014/133266334-8cc3ef68-c217-4bbc-9761-a42294d9d255.png)
or this:
![image](https://user-images.githubusercontent.com/22009014/133266708-30d37ea6-4ca4-43b3-ab9b-36037f3faebb.png)

"
919161432,15453,xavier2k6,2021-09-14T13:40:02Z,">Think this is the best one yet.

(speed graph) - That'll work as long as it's ok in GUI

Regarding bug icon https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-919152605 .......I'm not actually sure where that's actually used...if at all.

>Kindly mention the specific icon name.

To use `book-reader` or `book-open` etc. for ""Documentation"" it's `help-contents.svg`
To use `address-card` etc. for ""About"" it's `help-about.svg`"
919171228,15453,Mazino-Urek,2021-09-14T13:50:57Z,"> To use `book-reader` or `book-open` etc. for ""Documentation"" it's `help-contents.svg`

![image](https://user-images.githubusercontent.com/22009014/133269693-32695dc6-b2be-4a1d-9571-d06a8cf1f52f.png)


> To use `address-card` etc. for ""About"" it's `help-about.svg`

![image](https://user-images.githubusercontent.com/22009014/133269988-4490d1fb-14f3-40e6-9391-6f08bcd33bc3.png)
"
919172816,15453,Mazino-Urek,2021-09-14T13:52:36Z,"> Are `kt-set-max-download-speed.svg`, `kt-set-max-upload-speed.svg`, `ratio.svg` still relevant now?
> 
> If not, then they should be removed & any other ones no longer in use.

Can you check that? I can remove these icons then.

> Can the remaining `.png` icons be converted to `.svg` I wonder?

Let's tackle this after this PR. I will try my best.
"
919175886,15453,Mazino-Urek,2021-09-14T13:55:59Z,"@xavier2k6 @ArcticGems Does this work?
![image](https://user-images.githubusercontent.com/22009014/133270854-2e720c6c-8d5b-4ea9-a017-5b7594c3dca7.png)
"
919178841,15453,xavier2k6,2021-09-14T13:59:13Z,"> > Are `kt-set-max-download-speed.svg`, `kt-set-max-upload-speed.svg`, `ratio.svg` still relevant now?
> > If not, then they should be removed & any other ones no longer in use.

> > Can you check that? I can remove these icons then.

This was for others in the team as I know @thalieht worked on a ""torrent options"" PR which subsequently removed these from the context menu....unsure if they are used in ""webui"" as i don't use that feature myself.

There may be other icons that need to be removed.

Need more team feedback/input.

> > Can the remaining `.png` icons be converted to `.svg` I wonder?

> > Let's tackle this after this PR. I will try my best.

They may even be removed........except of course for the `mascot.png`"
919182675,15453,Mazino-Urek,2021-09-14T14:03:07Z,"@ionic-team I am using and modifying some of your icons in this project.
I was using la-capitaine-icon-theme for the project. However, for some shortcomings, I had to look for another source. As ionicons is under MIT, I think it is ok to use the icons here. Wanted to let you guys know that. Thanks!"
919183857,15453,Mazino-Urek,2021-09-14T14:04:19Z,@thalieht Can you tell which icons are currently in use and which can be removed?
919187803,15453,xavier2k6,2021-09-14T14:08:24Z,"Here's a list of the final 5 remaining *.png icons.

`loading.png`
`mascot.png`
`sphere.png`
`sphere2.png`
`splash.png`"
919190812,15453,Mazino-Urek,2021-09-14T14:11:44Z,"> Here's a list of the final 5 remaining *.png icons.
> 
> `loading.png`
> `mascot.png`
> `sphere.png`
> `sphere2.png`
> `splash.png`

I thought they served some special purpose."
919193747,15453,glassez,2021-09-14T14:14:57Z,I'm unsubscribing for now... Please ping me when it is close to completion.
919193964,15453,xavier2k6,2021-09-14T14:15:10Z,">I thought they served some special purpose.

`mascot.png` is used in the about window

I honestly don't know where the other 4 are used........it could be webui or macos/linux."
919200747,15453,xavier2k6,2021-09-14T14:22:31Z,"@nowshed-imran I would suggest marking this PR as ""Draft"" for now as it's still a WIP"
919221496,15453,Mazino-Urek,2021-09-14T14:45:26Z,"Speedometer:
![image](https://user-images.githubusercontent.com/22009014/133277938-5dd423ef-83a1-4094-bce8-a8e9099fa08e.png)
![image](https://user-images.githubusercontent.com/22009014/133279591-ccd291d3-34a8-4b68-9135-ef6389315788.png)
![image](https://user-images.githubusercontent.com/22009014/133279650-2f3384a3-0ecb-48b8-8348-dd3818d995fb.png)
"
919233638,15453,Mazino-Urek,2021-09-14T14:58:40Z,"New cookie icon:
![image](https://user-images.githubusercontent.com/22009014/133281988-768e71da-c00e-4383-b8e3-20aeef2ce604.png)
"
919243785,15453,ArcticGems,2021-09-14T15:09:36Z,"The new speedometer's indicator needs fixing =

![speed1](https://user-images.githubusercontent.com/55046301/133283656-5d3cb935-65c3-4be9-9306-3fa62bb12b76.png)
"
919263456,15453,xavier2k6,2021-09-14T15:30:39Z,">Speedometer:

>New cookie icon:

Both seem ok, would need to see them in the GUI"
919267591,15453,thalieht,2021-09-14T15:35:11Z,"> 
> 
> > > Are `kt-set-max-download-speed.svg`, `kt-set-max-upload-speed.svg`, `ratio.svg` still relevant now?
> > > If not, then they should be removed & any other ones no longer in use.
> 
> > > Can you check that? I can remove these icons then.
> 
> This was for others in the team as I know @thalieht worked on a ""torrent options"" PR which subsequently removed these from the context menu....unsure if they are used in ""webui"" as i don't use that feature myself.

They are still used in WebUI.

>@thalieht Can you tell which icons are currently in use and which can be removed?

I don't know.


"
919283791,15453,ArcticGems,2021-09-14T15:53:37Z,"@nowshed-imran 
How about your previous speedometer icon in 2 colors (and the other will have a red indicator)?? =

![speed2](https://user-images.githubusercontent.com/55046301/133290904-a7464787-d22c-47f0-9312-cafa9a111575.png)

![speed2_screenshot](https://user-images.githubusercontent.com/55046301/133290981-d9fcb479-cfcc-4568-b4aa-f2a3ea648dcf.png)
"
919342201,15453,Mazino-Urek,2021-09-14T17:02:40Z,"> @nowshed-imran
> How about your previous speedometer icon in 2 colors (and the other will have a red indicator)?? =
> 
> ![speed2](https://user-images.githubusercontent.com/55046301/133290904-a7464787-d22c-47f0-9312-cafa9a111575.png)
> 
> ![speed2_screenshot](https://user-images.githubusercontent.com/55046301/133290981-d9fcb479-cfcc-4568-b4aa-f2a3ea648dcf.png)

Done.
You guys have no idea how much trouble this speedometer icon has given me. I try to create clean and reusable icons. That is very hard.

![image](https://user-images.githubusercontent.com/22009014/133301922-4229589f-aa7b-470f-9d3d-fdb2e8aad00c.png)
"
919345090,15453,Mazino-Urek,2021-09-14T17:06:15Z,"@thalieht not touching anything PNG related then.
@xavier2k6 @ArcticGems What else is left now?
"
919422673,15453,xavier2k6,2021-09-14T18:46:56Z,">What else is left now?

Will have to look when I have more spare time."
919878668,15453,xavier2k6,2021-09-15T10:01:44Z,"@nowshed-imran
bug icon - leave as is (sad face)
cookie icon - make more solid & chocolate chips see through or darker green/brown

See, if you can come up with same/similar icons for `peers tab`, `trackers`, `HTTP Sources` & `Categories` like in https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-918942615

May have some other feedback but need to do some further testing/investigation on my end 1st."
919930834,15453,ArcticGems,2021-09-15T11:20:13Z,"> 
> 
> @nowshed-imran
> bug icon - leave as is (sad face)
> cookie icon - make more solid & chocolate chips see through or darker green/brown
> 
> See, if you can come up with same/similar icons for `peers tab`, `trackers`, `HTTP Sources` & `Categories` like in [#15453 (comment)](https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-918942615)

After this is done, maybe update OP so we can get a overview of whats been done?"
919944462,15453,Mazino-Urek,2021-09-15T11:42:47Z,@xavier2k6 Do I have to create new icons for these or change existing icons?
920121973,15453,xavier2k6,2021-09-15T15:26:15Z,">Do I have to create new icons for these or change existing icons?

A mock-up for now will do fine...."
920170037,15453,Mazino-Urek,2021-09-15T16:24:41Z,"Updated Cookie Icon:
![image](https://user-images.githubusercontent.com/22009014/133468109-9d1402aa-62d3-443e-9525-81dfb9011d8b.png)
I think `edit-find-user` has already a good icon for small surface:
![image](https://user-images.githubusercontent.com/22009014/133468838-e74047c6-16e6-41fb-8143-63da7b55e8e6.png)
For track simply this will work:
![image](https://user-images.githubusercontent.com/22009014/133469035-732a32b8-f093-43ca-a9dd-b5a2eb9e72ef.png)
For categories:
![image](https://user-images.githubusercontent.com/22009014/133469392-43eb9025-2aad-4965-a07a-d845152310b2.png)
or 
![image](https://user-images.githubusercontent.com/22009014/133469468-80a16110-aafa-4ad2-bb26-5993f4f23df4.png)
or
![image](https://user-images.githubusercontent.com/22009014/133469623-e9be582c-a38c-4e21-a179-60cff197ec17.png)

For `view-statistics`
Currently:
![image](https://user-images.githubusercontent.com/22009014/133469997-15928197-1a4b-494b-8ad6-9b10fed52c7d.png)
But, I am really liking this, and it might be more visible:
![image](https://user-images.githubusercontent.com/22009014/133471879-80f3598b-2c54-4b70-a814-4d6409107f03.png)


Of course, change of color will be done. 
"
920337556,15453,xavier2k6,2021-09-15T20:04:13Z,"@nowshed-imran 

>Updated Cookie Icon:

That seems way better.
____

>I think `edit-find-user` has already a good icon for small surface:

Ya, ok will go with that.
____

>For track simply this will work:

Agree! create it & name it `trackers.svg`
Add `trackers.svg` to `icons.qrc` file

Replace `network-server` with `trackers` in these files:
https://github.com/qbittorrent/qBittorrent/blob/1eb246c98b01eae75ee510d70c3647ba02a3751a/src/gui/properties/proptabbar.cpp#L58
https://github.com/qbittorrent/qBittorrent/blob/e5943b64c1cb803c52f69e1e837d73fd3f8b7281/src/gui/transferlistfilterswidget.cpp#L309
https://github.com/qbittorrent/qBittorrent/blob/e5943b64c1cb803c52f69e1e837d73fd3f8b7281/src/gui/transferlistfilterswidget.cpp#L312
____

>For categories:

We'll just stick with the one we have already sure.

Replace `inode-directory` with `view-categories`
https://github.com/qbittorrent/qBittorrent/blob/fda6def384d2ab7ff31595f54d53548a3f0eee8d/src/gui/categoryfiltermodel.cpp#L217
____

>For `view-statistics`

Will need to see it in GUI.
____

Tags:
Replace `inode-directory` with `tags`
https://github.com/qbittorrent/qBittorrent/blob/ccb59fbad3fab23bd0f563769f172904f76c6617/src/gui/tagfiltermodel.cpp#L127
____

Regarding wrong WebUI icon in Options
Replace `network-server` with `webui`
https://github.com/qbittorrent/qBittorrent/blob/ce554e6c7791b512902fd3c2693382518facc154/src/gui/optionsdialog.cpp#L202
____

Connection icon in Options:
`network-wired.svg` can be deleted & can be removed from `icons.qrc` file as it seems it's only used in `/src/gui/optionsdialog.cpp`

Replace `network-wired` with `configure`
https://github.com/qbittorrent/qBittorrent/blob/ce554e6c7791b512902fd3c2693382518facc154/src/gui/optionsdialog.cpp#L197
____

That's as much feedback/help I can give for now."
920461030,15453,ArcticGems,2021-09-15T23:32:52Z,"I agree with xavier2k6 in https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-920337556

When it comes to the `view-statistics` icon, the left one below here looks better as 16x16 and I also think that it will fit better with the other icons =

![stats_compair_1](https://user-images.githubusercontent.com/55046301/133526332-67db55fe-c6ec-4349-b188-927176d4ec30.png)
"
920727103,15453,xavier2k6,2021-09-16T09:10:20Z,">`view-statistics` icon, the left one below here looks better as 16x16 and I also think that it will fit better with the other icons

Ya, would keep it as-is.

There will be other ""WebUI related code"" changes required to reflect change in icons/new icon etc (This can be done later....)"
920784583,15453,Mazino-Urek,2021-09-16T10:35:22Z,"@xavier2k6 Should I change this to `trackers` as well?
https://github.com/qbittorrent/qBittorrent/blob/e5943b64c1cb803c52f69e1e837d73fd3f8b7281/src/gui/transferlistfilterswidget.cpp#L349"
920791060,15453,Mazino-Urek,2021-09-16T10:46:45Z,@xavier2k6 I have changed everything you have pointed out. Thank you so much. I could not have done this without your help.
920791122,15453,xavier2k6,2021-09-16T10:46:52Z,"> @xavier2k6 Should I change this to `trackers` as well?
> https://github.com/qbittorrent/qBittorrent/blob/e5943b64c1cb803c52f69e1e837d73fd3f8b7281/src/gui/transferlistfilterswidget.cpp#L349

I don't see a reason not to, it can always be reverted."
920793117,15453,Mazino-Urek,2021-09-16T10:50:15Z,"> > @xavier2k6 Should I change this to `trackers` as well?
> > https://github.com/qbittorrent/qBittorrent/blob/e5943b64c1cb803c52f69e1e837d73fd3f8b7281/src/gui/transferlistfilterswidget.cpp#L349
> 
> I don't see a reason not to, it can always be reverted.

Done!"
920794121,15453,xavier2k6,2021-09-16T10:51:55Z,"> @xavier2k6 I have changed everything you have pointed out. Thank you so much. I could not have done this without your help.

You are more than welcome, I've been working on changing the `icons` myself previously & was going to create my own PR but..........alas time!

If we get the `Main GUI` look & feel right - we can then concentrate on `WebUI` changes.

I think there's something wrong with current transfer list coding.....need to investigate that more. (nothing to do with your changes)

Again, as usual I will wait for `AppVeyor` to finish successfully before approving/running `GHA CI`"
920910814,15453,xavier2k6,2021-09-16T13:38:30Z,"Please change the `trackers.svg` color to blue to maintain consistency

For some reason the `HTTP Sources` tab has the `trackers.svg` icon applied to it......haven't time to look further in to this.

All other icon changes are looking good!

![New Icons](https://user-images.githubusercontent.com/42386382/133621845-239dadc4-b528-4852-9c17-a154213b01e1.png)

![Options Icons](https://user-images.githubusercontent.com/42386382/133622266-6110a53e-c5d3-4067-a89b-616d23b1fa9d.png)
"
920915257,15453,Mazino-Urek,2021-09-16T13:43:54Z,"> Please change the `trackers.svg` color to blue to maintain consistency

Done."
920918941,15453,Mazino-Urek,2021-09-16T13:48:10Z,"> > @xavier2k6 Should I change this to `trackers` as well?
> > https://github.com/qbittorrent/qBittorrent/blob/e5943b64c1cb803c52f69e1e837d73fd3f8b7281/src/gui/transferlistfilterswidget.cpp#L349
> 
> I don't see a reason not to, it can always be reverted.

I changed it to `trackers`. Can it be the one causing problem?"
920920939,15453,xavier2k6,2021-09-16T13:50:41Z,">I changed it to `trackers`. Can it be the one causing problem?

`HTTP Sources` uses the `inode-directory` icon"
920963007,15453,Mazino-Urek,2021-09-16T14:39:46Z,@xavier2k6 Kindly investigate the problem when you have time then. I am at a loss now.
920968332,15453,xavier2k6,2021-09-16T14:45:59Z,"> @xavier2k6 Kindly investigate the problem when you have time then. I am at a loss now.

Don't worry, I will.

Can you update https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-917429834?"
921003268,15453,Mazino-Urek,2021-09-16T15:26:38Z,@xavier2k6 Done.
921075815,15453,xavier2k6,2021-09-16T17:03:14Z,"Change `inode-directory` to `view-categories`

https://github.com/qbittorrent/qBittorrent/blob/b2e0e25f1c5a604cee23f93a227e1b31a4c07290/src/gui/transferlistwidget.cpp#L1019"
921077633,15453,xavier2k6,2021-09-16T17:05:52Z,"> > > @xavier2k6 Should I change this to `trackers` as well?
> > > https://github.com/qbittorrent/qBittorrent/blob/e5943b64c1cb803c52f69e1e837d73fd3f8b7281/src/gui/transferlistfilterswidget.cpp#L349
> > 
> > 
> > I don't see a reason not to, it can always be reverted.
> 
> I changed it to `trackers`. Can it be the one causing problem?

Please revert"
921080086,15453,Mazino-Urek,2021-09-16T17:09:27Z,"@xavier2k6 done.

"
921084521,15453,Mazino-Urek,2021-09-16T17:15:56Z,"@xavier2k6 Do you want to address the WebUI with a different PR of this one?
"
921086931,15453,xavier2k6,2021-09-16T17:19:24Z,">Do you want to address the WebUI with a different PR of this one?

This one should be fine, it'll only be changing icon names around etc."
921112064,15453,xavier2k6,2021-09-16T17:56:14Z,"@nowshed-imran You missed https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-921075815

Change `inode-directory` to `view-categories`
in your repo it's this:
https://github.com/nowshed-imran/qBittorrent/blob/redesign/src/gui/transferlistwidget.cpp#L1018

Also the `HTTP Sources` icon issue is because it was changed in your repo:
https://github.com/nowshed-imran/qBittorrent/blob/redesign/src/gui/properties/proptabbar.cpp#L76

Change `trackers` back to `network-server` or `application-x-mswinurl` may actually be a better fit??"
921139669,15453,xavier2k6,2021-09-16T18:22:56Z,"> > > > @xavier2k6 Should I change this to `trackers` as well?
> > > > https://github.com/qbittorrent/qBittorrent/blob/e5943b64c1cb803c52f69e1e837d73fd3f8b7281/src/gui/transferlistfilterswidget.cpp#L349
> > > 
> > > 
> > > I don't see a reason not to, it can always be reverted.
> > 
> > 
> > I changed it to `trackers`. Can it be the one causing problem?
> 
> Please revert

Apologies can you change this back to `trackers`, was looking at something else!

Otherwise it causes:
![tracker issue](https://user-images.githubusercontent.com/42386382/133665052-8a7eda27-ef55-4061-8c19-3a795f4e4127.png)

"
921144653,15453,Mazino-Urek,2021-09-16T18:30:46Z,@xavier2k6 Done.
921164647,15453,xavier2k6,2021-09-16T19:02:08Z,"https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-921112064

>Also the `HTTP Sources` icon issue is because it was changed in your repo:
https://github.com/nowshed-imran/qBittorrent/blob/redesign/src/gui/properties/proptabbar.cpp#L76

>Change `trackers` back to `network-server` or `application-x-mswinurl` may actually be a better fit??

You forgot to change this, for now just put it back to `network-server` please."
921178564,15453,Mazino-Urek,2021-09-16T19:17:15Z,"> [#15453 (comment)](https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-921112064)
> 
> > Also the `HTTP Sources` icon issue is because it was changed in your repo:
> > https://github.com/nowshed-imran/qBittorrent/blob/redesign/src/gui/properties/proptabbar.cpp#L76
> 
> > Change `trackers` back to `network-server` or `application-x-mswinurl` may actually be a better fit??
> 
> You forgot to change this, for now just put it back to `network-server` please.

Sorry, missed it. I got confused. Now, it is done."
921200541,15453,xavier2k6,2021-09-16T19:54:10Z,"@nowshed-imran You've changed both instances of `trackers` in `/src/gui/properties/proptabbar.cpp` at lines 58 & 76???
____

Change line 58 in `/src/gui/properties/proptabbar.cpp` back to `trackers`

https://github.com/nowshed-imran/qBittorrent/blob/redesign/src/gui/properties/proptabbar.cpp#L58
____

Leave line 76 in `/src/gui/properties/proptabbar.cpp` as-is as it's right. (I want it to display `network-server`)

https://github.com/nowshed-imran/qBittorrent/blob/redesign/src/gui/properties/proptabbar.cpp#L76
____"
921206738,15453,Mazino-Urek,2021-09-16T20:04:17Z,"@xavier2k6 Done.
![image](https://user-images.githubusercontent.com/22009014/133678434-9b16a4d2-c612-44b5-a426-fb966ec70736.png)
"
921207489,15453,xavier2k6,2021-09-16T20:05:31Z,">Done.

Thank you!,

This is the look I'm going for:
![proptabbar](https://user-images.githubusercontent.com/42386382/133678481-0855d3c0-20db-4c38-b685-110cfbc85709.png)"
921216342,15453,Mazino-Urek,2021-09-16T20:19:15Z," 

> > Done.
> 
> Thank you!,
> 
> This is the look I'm going for:
> ![proptabbar](https://user-images.githubusercontent.com/42386382/133678481-0855d3c0-20db-4c38-b685-110cfbc85709.png)

Looks brilliant."
921230982,15453,xavier2k6,2021-09-16T20:43:02Z,"I think the overall GUI now looks good (Windows OS anyway)

![qBittorrent New Icons GUI](https://user-images.githubusercontent.com/42386382/133682636-30b51295-5b45-42ee-a19f-026644ed6d71.png)
____

Color change requested - `preferences-web-browser-cookies.svg` to blue to maintain consistency......."
921238505,15453,ArcticGems,2021-09-16T20:55:46Z,"> 
> 
> I think the overall GUI now looks good (Windows OS anyway)
> 

👍 
> 
> Color change requested - `preferences-web-browser-cookies.svg` to blue to maintain consistency.......

I agree
"
921273825,15453,Mazino-Urek,2021-09-16T21:39:03Z,"I use Linux. All good here. Will do the requested change tomorrow. 
I want to finish this as soon as I can. I have an important exam coming up."
921511142,15453,Mazino-Urek,2021-09-17T05:30:42Z,"> Color change requested - `preferences-web-browser-cookies.svg` to blue to maintain consistency.......

@xavier2k6 Done."
921535094,15453,Mazino-Urek,2021-09-17T06:30:16Z,Is this PR Ok for review now?
921659597,15453,xavier2k6,2021-09-17T09:42:23Z,">Is this PR Ok for review now?

We may need others to give feedback but it certainly isn't ready to be merged.
(Even if it is completed/merged, it more than likely won't be released officially until the next series or thereafter....4.4.x/4.5.x)

#### TODO:
- WebUI icon name replacements, (we also added a new icon `trackers` etc.).......if we want it to look same/similar to Main GUI.
(WebUI isn't really my thing/don't use it but have a sense of where changes may be needed,)

- Transferlist text color issues (This seems to be code related & may be affecting Windows OS only, unsure as haven't had time to fully check & don't have other OS's to verify/discredit)"
921683616,15453,Mazino-Urek,2021-09-17T10:19:11Z,"@xavier2k6 I am not concerned with which version it gets released with. I just want it to be done properly. 



>     * WebUI icon name replacements, (we also added a new icon `trackers` etc.).......if we want it to look same/similar to Main GUI.
>       (WebUI isn't really my thing/don't use it but have a sense of where changes may be needed,)

Let's do this here.



>     * Transferlist text color issues (This seems to be code related & may be affecting Windows OS only, unsure as haven't had time to fully check & don't have other OS's to verify/discredit)

I think that should be tackled in a seperate PR. As with coding you could work fast, rather than me messing up constantly. I am using Linux. I can provide feedback from that end. "
921694699,15453,xavier2k6,2021-09-17T10:39:04Z,">Let's do this here.

Agree.

>I think that should be tackled in a seperate PR.

More than likely right there.
____

>>Example of how `slow` could look in GUI:
![slow](https://user-images.githubusercontent.com/42386382/133165017-7421e6a1-8bb9-4ed1-a18e-32e0cbd11fbd.png)

>(That bloody box around it (when clicked) is on the official/master builds too......I must open an issue for it)

I seem to have found the issue & fix required for this!!"
921735551,15453,xavier2k6,2021-09-17T11:51:32Z,I have opened #15478 for the `alternative speed` button issue.
921944118,15453,xavier2k6,2021-09-17T16:57:13Z,"Just checked the latest Windows CI build & it seems you changed coloring of two icons.
(didn't check anything else)

The icons in question are:
`stalledDL.svg` was changed to color `#c051db`
`stalledUP.svg` was changed to color `#af5cf9`
____

To coincide with the `filterstalled.svg` color `#686868`

I would actually prefer for you to use these variants:
`stalledDL.svg` color `#686868`
`stalledUP.svg` color `#909090`

**FYI**
Any icons that are in the `filter list` have to be matched (text wise) in `transferlist`

We have the icons the way we want them to look so we don't have to go messing with their colors anymore. (unless others request to do so)"
921955096,15453,Mazino-Urek,2021-09-17T17:15:19Z,"@xavier2k6 I was experimenting with colors in a different folder. Somehow, I made these two changes in the real repo. Sorry about that. Reverting it now."
922424135,15453,jagannatharjun,2021-09-19T06:44:44Z,"most icons have soft edges, maybe change these two also
![image](https://user-images.githubusercontent.com/34717789/133918253-58d56c99-497a-4aa6-8fc3-707931998384.png)
"
922447567,15453,mzso,2021-09-19T10:04:29Z,"Any theme files that a mere user, like I can try?"
922454373,15453,xavier2k6,2021-09-19T10:58:20Z,"@mzso
> Any theme files that a mere user, like I can try?

This isn't a theme per-se, this PR replaces the current/default with these icons.

![mowshed-imran icons](https://user-images.githubusercontent.com/42386382/133925529-cab8ea0e-e509-45ea-b773-11c1658fc7b4.png)

You can test what they look like with one of the latest iterations of @nowshed-imran Redesign Icons with the relevant GHS CI [Ubuntu](https://github.com/qbittorrent/qBittorrent/actions/runs/1246360000) / [macOS](https://github.com/qbittorrent/qBittorrent/actions/runs/1246360013) / [Windows](https://github.com/qbittorrent/qBittorrent/actions/runs/1246360010) builds
____

![my version of icons](https://user-images.githubusercontent.com/42386382/133925532-efb9410e-271e-4396-ae18-9ad36319f84a.png)

You can test a revised/wip version with matching ""transfer list text"" of nowshed-imran's (Redesign Icons) with the relevant GHS CI [Ubuntu](https://github.com/xavier2k6/qBittorrent/actions/runs/1249455330) / [macOS](https://github.com/xavier2k6/qBittorrent/actions/runs/1249455334) / [Windows](https://github.com/xavier2k6/qBittorrent/actions/runs/1249455332) builds"
922455323,15453,xavier2k6,2021-09-19T11:05:53Z,">most icons have soft edges

Do you think this is a bad thing??

>maybe change these two also
![image](https://user-images.githubusercontent.com/34717789/133918253-58d56c99-497a-4aa6-8fc3-707931998384.png)

This has been subjective in the past!

TBH, I like the look (color wise):
![top bar](https://user-images.githubusercontent.com/42386382/133926053-4fe51eda-ebcf-49fc-bfa3-f1f1e105dc92.png)

We also have to take in to consideration below:
(this is where I would change it!)

![qBittorrent Edit Menu](https://user-images.githubusercontent.com/42386382/133925887-21edd636-354b-44c7-982a-546bb973fb1a.png)

I would leave the resume/pause icons in the edit ""menu"" as-is & change the resume all/pause all to be consistent with the overall theme look. i.e. (blue)

It also helps to differentiate the separate actions."
922460964,15453,mzso,2021-09-19T11:49:54Z,"[**@xavier2k6**](https://github.com/xavier2k6) commented on [2021. szept. 19. 13:05 CEST](https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-922455323 ""2021-09-19T11:05:53Z - Replied by Github Reply Comments""):
> > most icons have soft edges
> 
> Do you think this is a bad thing??
> 
> > maybe change these two also  
> > [![image](https://user-images.githubusercontent.com/34717789/133918253-58d56c99-497a-4aa6-8fc3-707931998384.png)](https://user-images.githubusercontent.com/34717789/133918253-58d56c99-497a-4aa6-8fc3-707931998384.png)
> 
> I'd agree with this. (make them the same blue color like the cog wheel)

I think that'd be horrible, already very different icons seem to have the same color.




[**@xavier2k6**](https://github.com/xavier2k6) commented on [2021. szept. 19. 12:58 CEST](https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-922454373 ""2021-09-19T10:58:20Z - Replied by Github Reply Comments""):
> > Any theme files that a mere user, like I can try?
> 
> This isn't a theme per-se, this PR replaces the current/default icons.
> 

Sure, but a 2d grid of icons don't show me much.

> You can test what they look like with one of the latest iterations of [@nowshed-imran](https://github.com/nowshed-imran) Redesign Icons with the relevant GHS CI [Ubuntu](https://github.com/qbittorrent/qBittorrent/actions/runs/1246360000) / [macOS](https://github.com/qbittorrent/qBittorrent/actions/runs/1246360013) / [Windows](https://github.com/qbittorrent/qBittorrent/actions/runs/1246360010) builds
> 
> You can test a revised/wip version with matching ""transfer list text"" of [@nowshed-imran](https://github.com/nowshed-imran) (Redesign Icons) with the relevant GHS CI [Ubuntu](https://github.com/xavier2k6/qBittorrent/actions/runs/1249455330) / [macOS](https://github.com/xavier2k6/qBittorrent/actions/runs/1249455334) / [Windows](https://github.com/xavier2k6/qBittorrent/actions/runs/1249455332) builds

You kind of lost me. What's the difference between the two? And What's GHS CI?

Anyway, I see no way to set it to dark theme, which is my main interest.
So far it's a bit worrying that stalled uploading/downloading category icons, which have rather opposing meanings have the exact same colors."
922462945,15453,xavier2k6,2021-09-19T12:04:52Z,">I think that'd be horrible, already very different icons seem to have the same color.

I had edited my post - you caught the old comment!, in your quote lol

For reference:
>maybe change these two also
![image](https://user-images.githubusercontent.com/34717789/133918253-58d56c99-497a-4aa6-8fc3-707931998384.png)

This has been subjective in the past!

TBH, I like the look (color wise):
![top bar](https://user-images.githubusercontent.com/42386382/133926053-4fe51eda-ebcf-49fc-bfa3-f1f1e105dc92.png)
_____

>Sure, but a 2d grid of icons don't show me much.

Ok, well my post https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-921230982 shows what they look like in the actual GUI.

>You kind of lost me. What's the difference between the two? And What's GHS CI?

The difference is:
The 1st version, the colors of the icons will not match/be the same as the text that's displayed in the transfer list.
The 2nd version - they do.

>And What's GHS CI?

Slight typo on my end....it's actually `GHA CI` this stands for `GitHub Actions CI` - these are usable test builds that are automatically created when a PR is created.

>Anyway, I see no way to set it to dark theme, which is my main interest.

I don't know what OS (Operating System) your are running but if you are running `Windows` then I can help you with this.
(Please note though that the Dark Theme on windows doesn't work 100% with the application for now, but the overall look is a ""best effort"")

Also, note that this PR is just to replace the default icons - not to create an actual default dark theme!

Example:
![qBittorrent Windows Dark Mode](https://user-images.githubusercontent.com/42386382/133927177-e673631e-bca1-495e-9faf-107daf870d1a.png)

Reference:
https://github.com/qbittorrent/qBittorrent/pull/15453#discussion_r707685505

This is another example of how they would look in dark theme (linux, I believe):
![color](https://user-images.githubusercontent.com/6451685/133152790-d09f382c-fd0d-4629-a725-c2094fb24283.JPG)

>So far it's a bit worrying that stalled uploading/downloading category icons, which have rather opposing meanings have the exact same colors.

They are not the same color, stalled downloading has a dark grey, while stalled uploading has a lighter grey.
(See)
![stalled](https://user-images.githubusercontent.com/42386382/133926886-c275d1b8-9fd6-4f59-a2a9-79eed181b05d.png)

The 1st version of GHA CI builds still has them at the same color, I agree but again this is all a WIP (Work In Progress)"
922469065,15453,xavier2k6,2021-09-19T12:51:53Z,"@thalieht Can you test any of the builds below please?
[Ubuntu](https://github.com/xavier2k6/qBittorrent/actions/runs/1249455330) / [macOS](https://github.com/xavier2k6/qBittorrent/actions/runs/1249455334) / [Windows](https://github.com/xavier2k6/qBittorrent/actions/runs/1249455332) builds

I changed filter list icon colors/matched with transfer list.

(I removed the `bool` `if(!dark)` etc in `transferlistmodel` as for windows the `bool` seemed to have no effect or wasn't correct as the 1st color choice would be selected, for example the `stalledDL` & `stalledUP` colors would remain black & same for others, hence why they are currently black on normal application with no theme applied.)

```
    case BitTorrent::TorrentState::StalledDownloading:
    case BitTorrent::TorrentState::StalledUploading:
        if (!dark)
            return {0, 0, 0}; // Black
        else
            return {204, 204, 204}; // Gray 80
```

I also removed:
```
bool isDarkTheme()
{
    const QPalette pal = QApplication::palette();
    // QPalette::Base is used for the background of the Treeview
    const QColor &color = pal.color(QPalette::Active, QPalette::Base);
    return (color.lightness() < 127);
}
```
____

I just want to see if it has a negative impact on other OS's which may have a default `darktheme`"
922475070,15453,Mazino-Urek,2021-09-19T13:36:02Z,"> This is another example of how they would look in dark theme (linux, I believe):

Should I change queue color from purple to orange? It would match the icon color then.
Stall Icon is totally invisible in dark theme, shouldn't we do something about that?

@jagannatharjun Will this do?
![image](https://user-images.githubusercontent.com/22009014/133929613-e2b51735-4613-4e55-aa05-f6299b927b33.png)
"
922476203,15453,mzso,2021-09-19T13:43:12Z,"@xavier2k6

> I don't know what OS (Operating System) your are running but if you are running `Windows` then I can help you with this.
> (Please note though that the Dark Theme on windows doesn't work 100% with the application for now, but the overall look is a ""best effort"")
> 

I am on windows, so ho do I enable dark theme?

> Also, note that this PR is just to replace the default icons - not to create an actual default dark theme!

Okay, but the OP explicitly refrences dark theme, and I'm only interested in that."
922479852,15453,xavier2k6,2021-09-19T14:08:28Z,"@nowshed-imran 

>Should I change queue color from purple to orange? It would match the icon color then.

Currently your version of queue icon is orange.

>Stall Icon is totally invisible in dark theme, shouldn't we do something about that?

That was from an old comment, we did do something about it already......we changed them to dark/light grey."
922480268,15453,Mazino-Urek,2021-09-19T14:11:47Z,"> Currently your version of queue icon is orange.
Not icon color. Text color. Like seed numbers `0(0)`.
"
922481759,15453,xavier2k6,2021-09-19T14:22:50Z,"> > Currently your version of queue icon is orange.
> > Not icon color. Text color. Like seed numbers `0(0)`.

Ah I know what you mean.....for now please leave them alone.

I've changed/matched icons up in below:
Can you have a look/provide feedback please?
[Ubuntu](https://github.com/xavier2k6/qBittorrent/actions/runs/1249455330) / [macOS](https://github.com/xavier2k6/qBittorrent/actions/runs/1249455334) / [Windows](https://github.com/xavier2k6/qBittorrent/actions/runs/1249455332) builds"
922499380,15453,xavier2k6,2021-09-19T16:20:37Z,">@jagannatharjun Will this do?
![image](https://user-images.githubusercontent.com/22009014/133929613-e2b51735-4613-4e55-aa05-f6299b927b33.png)

I like that!, also I think I get that the paused button should probably be changed to something like the `fontawesome` one or maybe we can use `stop`.

![Pause icon](https://user-images.githubusercontent.com/42386382/133934928-396612be-8e29-44ec-a2b4-2639daf08423.png)

"
922505360,15453,Mazino-Urek,2021-09-19T17:04:19Z,"@xavier2k6 for pause.
![image](https://user-images.githubusercontent.com/22009014/133936523-5f7e0d0e-9e54-4f9f-8281-24db21fba948.png)

For donation, I have found a unique icon. It can be used.
![image](https://user-images.githubusercontent.com/22009014/133936546-f46c817d-05e2-4540-ac34-4009cce247fd.png)

Settings:
![image](https://user-images.githubusercontent.com/22009014/133936445-5d38bd58-cd57-41ae-9ba8-19f86343f650.png)

"
922507076,15453,xavier2k6,2021-09-19T17:16:42Z,"Pause, donation, settings

Yep, from me."
922546304,15453,thalieht,2021-09-19T22:22:37Z,"@xavier2k6 
>(I removed the bool if(!dark) etc in transferlistmodel as for windows the bool seemed to have no effect or wasn't correct as the 1st color choice would be selected, for example the stalledDL & stalledUP colors would remain black & same for others, hence why they are currently black on normal application with no theme applied.)

Did you test with those high contrast themes and it didn't work? That's strange because the transfer list's background with those themes is completely black.

>I just want to see if it has a negative impact on other OS's which may have a default darktheme

It does, (in Windows too i believe) because `isDark()` works and removing it forces the same color for light and dark themes e.g. this is from your `translist_color` branch, ""completed"" and ""downloading"" are barely visible:
![6e](https://user-images.githubusercontent.com/6451685/133940217-c9a47edd-6e4f-456b-a0b0-ace9726840ab.JPG)

"
922558175,15453,xavier2k6,2021-09-19T23:51:57Z,">Did you test with those high contrast themes and it didn't work? That's strange because the transfer list's background with those themes is completely black.

I just enable Qt `darkmode` & change windows color to dark (choose your default windows mode/choose your default windows mode)

Currently in `master` / `v4_3_x` branch, Both stalled icons are black & on normal/light the transfer list `text` matches this

If you change/enable `darkmode` the text seems to change to white.

Relevant code:
```
    case BitTorrent::TorrentState::StalledDownloading:
    case BitTorrent::TorrentState::StalledUploading:
        if (!dark)
            return {0, 0, 0}; // Black
        else
            return {204, 204, 204}; // Gray 80
```

>because `isDark()` works 

seems it doesn't & returns the very first color choice as I had pointed out previously which is `black`
____

Check out screenshots of qBittorrent 4.3.8
Light Mode:
![light mode qb4 3 8](https://user-images.githubusercontent.com/42386382/133946550-9fbc5a0e-8f47-4e29-9592-153fb76684e4.png)

Dark Mode:
![dark mode qb4 3 8](https://user-images.githubusercontent.com/42386382/133946562-b018ad73-3789-4cee-8ce1-f1e7930a3b99.png)

>it forces the same color for light and dark themes

This is what I'm trying to achieve!

>from your `translist_color` branch, ""completed"" and ""downloading"" are barely visible:

These are not final colors for them........(experimenting)
"
923061759,15453,thalieht,2021-09-20T16:01:35Z,">Currently in master / v4_3_x branch, Both stalled icons are black & on normal/light the transfer list text matches this

So this is a misunderstanding then. That code only changes color for fonts, not icons.

>If you change/enable darkmode the text seems to change to white.

>else
>            return {204, 204, 204}; // Gray 80

That's the white :) well mostly, 255 x 0.80 (%) = 204

>>it forces the same color for light and dark themes
>
>This is what I'm trying to achieve!

I don't think that's possible because there has to be some contrast with the background, especially for text where readability is vital. Achieving that level of contrast on light/dark has the opposite effect on the other, see monochrome tray icons: both are almost invisible on the opposite lightness. IMO the best you can hope for with one color is a mediocre compromise for both."
923124391,15453,xavier2k6,2021-09-20T17:19:42Z,">So this is a misunderstanding then.

on my end.....(in relation to the code part on how it chooses the text color) obvs. it's not going to pick black for `if!dark` 🙄 🤣 

>I don't think that's possible because there has to be some contrast with the background, especially for text where readability is vital.

Well out of the 8 icons from filter list that are associated with text from transfer list....they seem to look ok on your dark background......except for `completed` / `downloading` which are as I said are still being experimented with.

>see monochrome tray icons: both are almost invisible on the opposite lightness.

These haven't been touched at all........yet.

But could be matched with the overall theme color.

Example:
![monochrome](https://user-images.githubusercontent.com/42386382/134045068-8fe3d1ed-e547-4eaa-899f-0bfcd4ce7d0f.png)
"
925652712,15453,Mazino-Urek,2021-09-23T09:37:27Z,Any update? 
926159709,15453,xavier2k6,2021-09-23T21:06:44Z,">>see monochrome tray icons: both are almost invisible on the opposite lightness.
>
>>These haven't been touched at all........yet.
>
>>But could be matched with the overall theme color.
>
>>Example:
![monochrome](https://user-images.githubusercontent.com/42386382/134045068-8fe3d1ed-e547-4eaa-899f-0bfcd4ce7d0f.png)
____

>On Windows, the system tray icon size is 16x16; on X11, the preferred size is 22x22. The icon will be scaled to the appropriate size as necessary.

According to the Qt docs:
https://doc.qt.io/qt-5/qsystemtrayicon.html#icon-prop
https://doc.qt.io/qt-6/qsystemtrayicon.html#icon-prop

Looking at 3x `normal` system tray icon these are `1024x1024` 👀
`qbittorrent-tray.svg`
`qbittorrent-tray-with-font.svg`
`qbittorrent_mac.svg`

These could probably be resized to `32x32` like the rest of the icons....

Monochrone tray icons:
`qbittorrent-tray-dark.svg`
`qbittorrent-tray-light.svg`

These are already `32x32` from along time ago.....they could probably be re-tweaked from one of the normal tray icons above as a source?!

@nowshed-imran Don't act on this quite yet, would require some more team feedback........"
926613203,15453,Mazino-Urek,2021-09-24T13:11:15Z,@xavier2k6 Got it. I have an exam anyway. I won't be able work on these for a couple of weeks.
926715546,15453,xavier2k6,2021-09-24T15:25:12Z,">I have an exam anyway.

👍 Best of luck!"
943588819,15453,FranciscoPombal,2021-10-14T17:56:27Z,"Apologies for not giving earlier feedback on this 3rd (4th?) iteration (though I'm surprised the maintainers haven't expedited this... I admire your perseverance). I am very satisfied with the results, no further comments other than what others have pointed out."
943664456,15453,xavier2k6,2021-10-14T19:34:25Z,"@nowshed-imran When you are able, you can work your magic on the 5 icons in https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-926159709

Only a few more icon changes/additions (my preference) & we can focus then on matching `transfer list colors` & `WebUI`
_____

`list-add.svg`
![add regular](https://user-images.githubusercontent.com/42386382/137380585-97f75e3f-c0ba-4830-95e4-1117e11b92e9.png)
____

`edit-clear.svg` (Keep color Red)
![minus regular](https://user-images.githubusercontent.com/42386382/137380779-afd395c5-a5a9-4dbf-a70d-12ef26b3e129.png)
____

`folder-remote.svg` (This is used for filters list & below icon better signifies that data moves around)
![shuffle_random](https://user-images.githubusercontent.com/42386382/137380898-cf94423d-5ea3-483d-a68f-5ac401e39a75.png)
____

`view-calendar-journal.svg` (this is used for show logs)
![reader](https://user-images.githubusercontent.com/42386382/137381344-33beeabf-aa89-4f57-8a42-9f43f4298431.png)
____

`queued.svg` (make more solid, like below)
![clock2](https://user-images.githubusercontent.com/42386382/137381458-cf36af3c-26ec-43ef-923f-9ab2663d9458.png)
____

### New icons (Don't forget to add to `icons.qrc`)
`force-recheck.svg`

Replace `view-refresh`
`auto *actionForceRecheck = new QAction(UIThemeManager::instance()->getIcon(""view-refresh""), tr(""Force recheck""), listMenu);` in `/src/gui/transferlistwidget.cpp`

![tasks](https://user-images.githubusercontent.com/42386382/137381861-b5a4cf78-9702-4aef-86db-fd2ec24e6f32.png)
____

`torrent-creator.svg` (this may be a subjective / experimental change & may not look right in GUI)

Replace `document-edit`
`m_ui->actionCreateTorrent->setIcon(UIThemeManager::instance()->getIcon(""document-edit""));` in `/src/gui/mainwindow.cpp`

![code](https://user-images.githubusercontent.com/42386382/137381912-e7d790a3-2233-4dc9-92eb-3ca98b4e6e12.png)
`
"
944003784,15453,Mazino-Urek,2021-10-15T05:00:08Z,"@xavier2k6 I will address all this in mid-November. In the meantime compile tasks needed to be done. If version 4.4 gets out within that time, let's target this PR for version 5. As @glassez pointed out, these icons introduces breaking change, it will be more suitable, if it is done with QT6."
944113599,15453,xavier2k6,2021-10-15T08:42:17Z,"@nowshed-imran I will assign this to the 5.0 milestone for now, this can always be brought forward if needed in the near future."
944565716,15453,FranciscoPombal,2021-10-15T19:05:45Z,@nowshed-imran @xavier2k6 Please see https://github.com/qbittorrent/qBittorrent/pull/15453#discussion_r729206030 and the following comments.
944914299,15453,xavier2k6,2021-10-16T13:20:02Z,"> @nowshed-imran @xavier2k6 Please see [#15453 (comment)](https://github.com/qbittorrent/qBittorrent/pull/15453#discussion_r729206030) and the following comments.

I've read them & TBH I still hold the same opinion as my https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-918942615

We're simply swapping out icons for others that are better suited for what they represent/describe & in some cases creating new icons to achieve this & an overall better look & feel / consistency.

(We are not actually re-naming icons, although we could actually do this too........like dropping for e.g. `view` / `folder` prefix in-front of some icons.)

Personally, I think the GUI is now in a better looking state than what it was previously.

Regarding the backwards compatibility for existing themes etc........I believe the last time the icons were majorly overhauled was back in 2018 & let's say we **ALL** agree to make these icons the default icons shipped with qBittorrent in say a `V5.x` series - it gives us time to announce these ""breaking changes"" in advance on the main website.

If for e.g. the `Filters list` / `Bottom ToolBar` & `Transfer Context Menu` all had designated icons for what they represented 1st day, we wouldn't be having this discussion, so IMO we are now righting a wrong."
944920020,15453,xavier2k6,2021-10-16T14:03:08Z,"@glassez @Chocobo1 @sledgehammer999 @thalieht @jagannatharjun @FranciscoPombal

Edited: (Taking note that it would ~break~ make previously existing themes incompatible)

Please ( 👍 / 👎 ) this post if you are for / against changes below:

- Making the icons from this PR as **Default**
- Swapping out / creating new icons that suitably reflect what the intended function entails.
- Rewording of icons / respective prefixes.
for e.g. `view-refresh` / `document-edit` to just `refresh` / `edit` or `refresh-update` / `edit-rename` etc.
(where icons have a double purpose/meaning)

If you 👎 the post, please reply / engage on what part you disagree with & why so that it can be discussed further before any other time / effort is spent on this PR by interested parties etc."
944921676,15453,FranciscoPombal,2021-10-16T14:14:40Z,"@xavier2k6 

> it gives us time to announce these ""breaking changes"" in advance on the main website.

Again I think we generally agree, but you might have missed or forgot to address my most important point - it's not a ""breaking change"" if there wasn't any **official promise of stability** concerning icon names in the first place.

> so IMO we are now righting a wrong.

Indeed, and because there never was any any **official promise of stability** of icon names, we have carte blanche to make changes as we see fit, whenever we want and without any sort of warning - no need to wait for 5.x or whatever. Of course, we should still announce it on the website as a courtesy.

Additionally, like I've suggested, _after_ this PR is merged, we could also finally establish an official, stable ""interface"" for themes. Among possibly other things, this would come with the promise that icon names won't suddenly change disappear. When changes are necessary, we would introuduce ""v2"" themes alongside ""v1"" themes, and issue a deprecation notice and timeline for ""v1"" themes to give time for theme authors to update before finally removing them.

EDIT: I wrote this before you posted https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-944920020, I have now voted."
944922970,15453,xavier2k6,2021-10-16T14:23:39Z,"@FranciscoPombal I did get what you were saying / meant (although some might not see it as ""breaking changes"", some may) - I just want to give other team members a chance to have their say, hear their thoughts & to gauge if they're on-board with all / certain changes & either drop / address the appropriate changes.

(See you voted/edited while typing this....)

Just want us all singing of the same hymn sheet!


Edited https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-944920020

>(Taking note that it would ~break~ make previously existing themes incompatible)"
944923757,15453,Chocobo1,2021-10-16T14:29:13Z,"@xavier2k6  @nowshed-imran 
>Rewording of icons / respective prefixes.
for e.g. view-refresh / document-edit to just refresh / edit or refresh-update / edit-rename etc.
(where icons have a double purpose/meaning)

Just making sure, are you aware that, in linux desktop, these names are for using the desktop environment theme icons? In other words, if you changed the name, the icon displayed won't be the native icon from the user's desktop theme but the qbt bundled ones. And that will be pretty bad for users who want to have native look n feel on qbt.
As for other points, I'm neutral, not much interest for me to discuss. "
944925069,15453,xavier2k6,2021-10-16T14:39:11Z,">Just making sure, are you aware that, in linux desktop, these names are for using the desktop environment theme icons? In other words, if you changed the name, the icon displayed won't be the native icon from the user's desktop theme but the qbt bundled ones.

I wasn't aware of that NO as I don't really use linux......surprised this didn't come up before as we've introduced newly created icons that weren't in qBittorrent before now.... e.g. `trackers.svg` / `tags.svg`"
944926948,15453,Chocobo1,2021-10-16T14:52:33Z,">I wasn't aware of that NO as I don't really use linux......surprised this didn't come up before as we've introduced newly created icons that weren't in qBittorrent before now.... e.g. trackers.svg / tags.svg

Surely I've mentioned it before: https://github.com/qbittorrent/qBittorrent/pull/12169#discussion_r399816475

Also another thing: AFAIK gnome & KDE desktop have provided more icons than the official list so maybe it is worth to still find a matching icon from the native theme (even if it isn't in the official list) and only create new icon name if everything fail to match.
official list: https://specifications.freedesktop.org/icon-naming-spec/latest/ar01s04.html
KDE: https://develop.kde.org/docs/plasma-integration/icons/"
944927423,15453,Mazino-Urek,2021-10-16T14:55:38Z,"@Chocobo1 
I use Linux(KDE) myself. There are not enough icons based on the standard set by freedesktop.org that would suffice the need of qBittorrent. KDE and Gnome both has exclusive icon names and icons. Big projects like Vscode, Rstudio, DBeaver all uses own icons. I think QBT is big enough to provide that experience. Besides, in Linux, everyone uses personalized icon themes anyway. But, I agree to the part that we can try to find relevant icon name whenever possible."
944927820,15453,FranciscoPombal,2021-10-16T14:58:51Z,"> @FranciscoPombal I did get what you were saying / meant (although some might not see it as ""breaking changes"", some may) - I just want to give other team members a chance to have their say, hear their thoughts & to gauge if they're on-board with all / certain changes & either drop / address the appropriate changes.
> 
> (See you voted/edited while typing this....)
> 
> Just want us all singing of the same hymn sheet!

Of course, me too! The purpose of my comments was simply to remind everyone that we have more flexibility here than it might seem."
944928573,15453,xavier2k6,2021-10-16T15:03:37Z,">Surely I've mentioned it before: https://github.com/qbittorrent/qBittorrent/pull/12169#discussion_r399816475

Ok, it seems you did - but I wasn't really very active in that thread & over-looked it.

However, now that You've brought it to the forefront here again - we can keep track of it.

Thank you @Chocobo1 "
944933107,15453,xavier2k6,2021-10-16T15:25:29Z,"@nowshed-imran You removed 3 `Flag` entries from the `icons.qrc` file but left the corresponding flags in the `/src/icons/flags` folder, what was the reasoning for this or was it an oversight? 

`flags/xk.svg`
`flags/un.svg`
`flags/eu.svg`"
944933465,15453,Mazino-Urek,2021-10-16T15:27:01Z,"> @nowshed-imran You removed 3 `Flag` entries from the `icons.qrc` file but left the corresponding flags in the `/src/icons/flags` folder, what was the reasoning for this or was it an oversight?
> 
> `flags/xk.svg` `flags/un.svg` `flags/eu.svg`

I have no idea how it happened. Fixing it right now. 
Done."
944934386,15453,xavier2k6,2021-10-16T15:31:31Z,"~@glassez @Chocobo1 Should the 3x flags be removed altogether, or perhaps just the `UN` / `EU`?~

~https://github.com/qbittorrent/qBittorrent/pull/15453#issuecomment-944933107~

Not really a concern see: PR https://github.com/qbittorrent/qBittorrent/pull/15657."
973058813,15453,Mazino-Urek,2021-11-18T17:00:01Z,"I am back. I see some breaking changes again that will prevent merge. Let's complete this, and then I will create a new PR."
973139318,15453,Mazino-Urek,2021-11-18T18:23:52Z,"`list-add.svg`
![image](https://user-images.githubusercontent.com/22009014/142464327-5191ed46-b33f-4ac3-8235-b42a76ea31e5.png)

`edit-clear.svg`
![image](https://user-images.githubusercontent.com/22009014/142464749-30912a13-193f-443d-8b65-02c15616f791.png)

`folder-remote.svg`
![image](https://user-images.githubusercontent.com/22009014/142475289-1e1a4d29-9955-46ce-b544-8b0e43d35c5f.png)

`view-calendar-journal.svg`
![image](https://user-images.githubusercontent.com/22009014/142477630-c2376e9e-1faf-4348-a863-958c10bc553b.png)

`queued.svg`
![image](https://user-images.githubusercontent.com/22009014/142479378-7d71baa2-a304-4fab-a9cf-6fefb753851c.png)

"
973178944,15453,xavier2k6,2021-11-18T19:17:23Z,"@nowshed-imran Those icons above look good to me, just the (torrent creator/force recheck ones) left.........you may also need to rebase your repo from master.

Also the windows GHA CI is out-of-action currently, so I may be slow to give more feedback/help."
973769705,15453,Mazino-Urek,2021-11-19T05:38:07Z,"Just review the icons for now. To me, git-rebase is really hard and confusing. I will create a new PR after finalizing the icons."
973782016,15453,Mazino-Urek,2021-11-19T06:08:51Z,"force-recheck.svg
![image](https://user-images.githubusercontent.com/22009014/142573578-ad6425b4-01ef-494b-8c5a-561fe4f85103.png)

torrent-creator.svg
![image](https://user-images.githubusercontent.com/22009014/142574063-39ea1a8d-045a-459c-99a9-ba7024b80212.png)

I really think this is not a good icon for this purpose. Let me think a bit.

"
973788282,15453,Mazino-Urek,2021-11-19T06:23:23Z,"torrent-creator.svg
![image](https://user-images.githubusercontent.com/22009014/142574846-45e53d78-5ebd-4b23-bc0a-fd6c199600f7.png)
This is my first choice.

![image](https://user-images.githubusercontent.com/22009014/142575201-8ddf8623-8d0f-4f91-b804-d49d92cdedc1.png)
This works too."
269850900,6156,okeatime,2016-12-31T05:40:52Z,Sample screen shot please?
269869938,6156,zeule,2016-12-31T15:32:42Z,"Please:
![qbt-file-types](https://cloud.githubusercontent.com/assets/394621/21578166/b0398a80-cf76-11e6-96d8-0cdd58c261fc.png)

![qbt-file-types-add](https://cloud.githubusercontent.com/assets/394621/21578203/9d2ab454-cf77-11e6-84f9-d2ef6da6fa63.png)
"
270216671,6156,zeule,2017-01-03T20:32:36Z,PR Updated: replace `QMimeDatabase` with `QFileIconProvider` that results in Qt 4 and all OSes support.
270302233,6156,okeatime,2017-01-04T06:18:04Z,"👍 good job
"
273598008,6156,sledgehammer999,2017-01-18T20:51:47Z,"I was so pumped but unfortunately this doesn't work on Windows with Qt 5.7.1(didn't test qt4).
It seems to return an empty image."
273599755,6156,sledgehammer999,2017-01-18T20:58:40Z,Possible explanation [here](https://stackoverflow.com/questions/11946601/qt-4-8-qfileiconprovider-getting-icon-for-non-existent-file-based-on-extensi). It seems QFileIconProvider works if the file actually exists on disk.
273600527,6156,sledgehammer999,2017-01-18T21:01:31Z,And a stale Qt bug report: https://bugreports.qt.io/browse/QTBUG-25319
273634832,6156,zeule,2017-01-18T23:25:50Z,"This is pity, of course. The feature is really nice and useful.... Except of patched Qt for the Windows builds or custom implementation of the same function I have no other ideas so far."
273636824,6156,sledgehammer999,2017-01-18T23:36:35Z,"The only choice here it to do this only for the platforms that support it and fallback to our current code for Windows. I'm in no mood to implement it in WINAPI.

Supposedly macOS should work too."
273642066,6156,zeule,2017-01-19T00:06:37Z,"@okeatime, can you tell us, please, does it work in OSX?"
295802022,6156,zeule,2017-04-20T16:28:22Z,"PR Updated: add a naïve WIN32 API based implementation for Windows. 
![qbt-file-icons-windows](https://cloud.githubusercontent.com/assets/394621/25241784/8c016340-25f7-11e7-9b7b-bd5dbd35b785.png)
"
295806840,6156,zeule,2017-04-20T16:40:54Z,"@Chocobo1, @glassez: could you help me to fix qmake build on Windows, please?"
295821320,6156,zeule,2017-04-20T17:15:08Z,"> Will this feature work for 64-bit qBittorrent on Windows?

Yes, it does."
295822385,6156,zeule,2017-04-20T17:17:55Z,"> @Chocobo1, @glassez: could you help me to fix qmake build on Windows, please?

Apparently, Qt build from cache in AppVeyor does not contain qwinextras module (why qmake is silent on this during its run?). If I use pre-installed Qt (see the last commit) it compiles, but fails during linking because QtSingleApplication was linked with static runtime (BTW, why?) while the pre-installled Qt is linked with dynamic one. I give up."
295823934,6156,zeule,2017-04-20T17:23:51Z,"I can do kind of a hack: declare 
```C++
Q_GUI_EXPORT QPixmap qt_pixmapFromWinHICON(HICON icon);
```
(which is exported from QtGui library) and use it without QWinExtras module. What do you think?"
295869934,6156,zeule,2017-04-20T19:27:00Z,The hack is in its own commit now. 
295873906,6156,zeule,2017-04-20T19:37:03Z,"@sledgehammer999, I think we need your, as Windows packages, opinion here regarding this hack: would you prefer to use the additional Qt module WinExtras (albeit very small one) and update AppVeyor cached Qt package to include it, or use this hack? Actually, the hack is identical to the internals of WinExtras module."
295900436,6156,zywo,2017-04-20T20:37:13Z,"Just tested on Ubuntu 17.04 and I don't know why it's not working.


![1](https://cloud.githubusercontent.com/assets/4026304/25251439/4643e3c2-2611-11e7-8856-4c0e5f678015.png)

![2](https://cloud.githubusercontent.com/assets/4026304/25251419/37001c50-2611-11e7-8f3a-b4c2f2fcb4bc.png)
"
295902676,6156,zeule,2017-04-20T20:42:10Z,"Thanks, will check one more time a bit later."
296058568,6156,Chocobo1,2017-04-21T04:33:40Z,">would you prefer to use the additional Qt module WinExtras (albeit very small one) and update AppVeyor cached Qt package to include it

I prefer this option. "
296119426,6156,zeule,2017-04-21T08:08:36Z,"> Just tested on Ubuntu 17.04 and I don't know why it's not working.

Because I forgot that for a long time I'm applying [this patch](https://git.reviewboard.kde.org/r/130094/) locally. Obviously, current implementation will not work outside of Plasma even if that patch get accepted. Probably, I better return to `QMimeDatabase`-based implementation for Linux.
"
296166219,6156,zeule,2017-04-21T11:25:08Z,"@zywo, tell, please, in what environment did you test?"
296208966,6156,zywo,2017-04-21T14:39:04Z,"@evsh 
Tested under Unity7 and Gnome DEs."
298235057,6156,sledgehammer999,2017-04-30T14:21:25Z,">@sledgehammer999 approveFeature

Of course I approve this. I have already said so in my previous comments.

>@sledgehammer999, I think we need your, as Windows packages, opinion here regarding this hack: would you prefer to use the additional Qt module WinExtras (albeit very small one) and update AppVeyor cached Qt package to include it, or use this hack? Actually, the hack is identical to the internals of WinExtras module.

I can't remember why I didn't compile WinExtras. Probably to minimize binary filesize (thats why the custom flags and static linking).

I can't find a reason not to use WinExtras. IMO, it is better than using a hack from their sources. (Unless we code it ourselves).

>Actually, the hack is identical to the internals of WinExtras module.

I know you didn't copy sources but: I want to remind everyone that if you copy sources you need to leave comment about where you got them. Of course, copied code must be from compatible license.

@evsh you said you're going to rework this so I am just waiting..."
298579925,6156,zeule,2017-05-02T09:41:05Z,"PR Updated: add back implementation based on `QMimeDatabase` and when `QFileIconProvider` does not seem to work properly, use it.
@zywo, could you test, please? "
298618951,6156,zeule,2017-05-02T12:17:46Z,@glassez: all your comments except one were addressed.
298619700,6156,zeule,2017-05-02T12:21:10Z,"> @evsh you said you're going to rework this so I am just waiting...

@sledgehammer999: I've done with the changes. Hope this works everywhere now. Let me suggest to pack QtSingleApplication into a NuGet package and switch over to the pre-installed Qt in AppVeyor."
298625506,6156,zeule,2017-05-02T12:47:59Z,Updated: fixed wrong condition in `MimeFileIconProvider` implementation.
298748816,6156,zywo,2017-05-02T20:18:34Z,"@evsh it's not working, I get the same behavior as in master branch.

![screenshot from 2017-05-02 21-17-22](https://cloud.githubusercontent.com/assets/4026304/25637412/c91983e6-2f7c-11e7-99db-2da2b91ffa8e.png)
"
298757018,6156,zeule,2017-05-02T20:50:19Z,"> @evsh it's not working, I get the same behavior as in master branch.

@zywo, thanks for the test! However, I'm puzzled, because this time I've tested in GNOME myself and it is working. Can you debug? I'm interested in `TorrentContentModel::TorrentContentModel()` code, where `static bool doesBuiltInProviderWork` is evaluated. So, if you can, please hard-set it to `false` and test. Also, just to be sure, did you enable file icons in the Advanced option page?"
298956773,6156,zywo,2017-05-03T16:03:26Z,"This is how it looks like under both Unity7 and Gnome Shell, after enabling `Use system file icons`

![screenshot from 2017-05-03 17-01-10](https://cloud.githubusercontent.com/assets/4026304/25669707/37f1b0b8-3022-11e7-9c02-f1391e9af1ec.png)
"
298958112,6156,zeule,2017-05-03T16:08:08Z,"So seems to be working, right?"
298960996,6156,zywo,2017-05-03T16:18:31Z,"Yes, thank you."
298961672,6156,zeule,2017-05-03T16:21:07Z,"Thank you for testing, @zywo! 

@qbittorrent/frequent-contributors: how shall we proceed now? What to do with Windows builds?"
298996725,6156,ngosang,2017-05-03T18:31:10Z,"More info for Windows icons => http://www.pixelstech.net/article/1332770120-Get-associated-file-icon-with-only-extension-name-using-C%2B%2B-on-Windows

I can test in Windows 10 but I can't build... @sledgehammer999 can test it"
298999502,6156,zeule,2017-05-03T18:41:49Z,"@ngosang, thank you for the resource! I think we can live for a while with my simple implementation, because patch that fixes `QFileIconProvider` on Windows is in review already. Maybe it will make it into Qt 5.9."
299713175,6156,zeule,2017-05-07T15:20:22Z,"FYI, Plasma changes [were merged](https://cgit.kde.org/plasma-integration.git/commit/?id=7a7dfffba98d383821c39ac68de6e8aabe45b7ed)."
300023093,6156,zeule,2017-05-08T23:56:43Z,@sledgehammer999: shall I expect inclusion of winextras module in https://builds.shiki.hu/appveyor/qbt_libraries.7z or should I produce my own set and upload it somewhere?
301263147,6156,zeule,2017-05-13T17:41:56Z,"@LordNyrox, I added already a similar code. And qwinextras module is needed exactly because of that."
302314562,6156,zeule,2017-05-18T06:37:28Z,"@LordNyriox: not only a review is needed, but what is more important, a decision on Windows/AppVeyor packaging has to be done."
302491321,6156,zeule,2017-05-18T17:59:21Z,"@LordNyriox: I don't know how to do that with qmake. And we agreed here already that we use qwinextras, but not the workaround."
302813438,6156,zeule,2017-05-19T21:18:01Z,"@LordNyriox: OK, just for fun here is the version with configure-time selector which takes qwinextras function when module is available and uses direct import when not. The hack, however, is not that bad because in the worst case it fails to link and that's all."
304446964,6156,Symbai,2017-05-27T11:43:19Z,Please add this to next release. This will be extremely useful!
304455105,6156,zeule,2017-05-27T14:27:22Z,@glassez: done.
304458290,6156,glassez,2017-05-27T15:16:13Z,">QChar is 8-bit wide?

I'm confused, of course... But still QChar array to wchar_t array cast is not valid, isn't it?"
304458894,6156,zeule,2017-05-27T15:27:46Z,"I don't know, QChar array is array of ushort. What is wchar_t in Windows? Anyway, it is without any casts now.
P.S. The code worked on Windows 10 x86 ."
304652963,6156,zeule,2017-05-29T12:45:33Z,"@Chocobo1, is there anything you want to say? @sledgehammer999, what do you think about the very last commit (e53ad94)?"
304944514,6156,zeule,2017-05-30T17:06:26Z,"@qbittorrent/frequent-contributors,

with the last commit (4963c50) this PR can be merged right away and when @sledgehammer999 finds a time to update cached libraries for AppVeyour, that last commit can be reverted to clean-up the code and switch over to QtWinExtras.  Should we take this way?"
305102557,6156,Chocobo1,2017-05-31T06:59:56Z,">>Should we take this way?
>
>This is exactly what I was going for when I requested that commit. ;}

I think so too.

It's a bit late to say this, maybe should prepend `QBT_` to `NO_QWINEXTRAS`.
"
305122886,6156,zeule,2017-05-31T08:32:34Z,"You guys are right, that macro name is wrong. I was stupid: as any other Qt module, QtWinExtras module defines its own when used: `QT_WINEXTRAS_LIB`. There is no need to define a custom one."
305137480,6156,zeule,2017-05-31T09:31:43Z,PR Updated: use `QT_WINEXTRAS_LIB` define instead of `NO_QWINEXTRAS`.
305271215,6156,zeule,2017-05-31T18:11:21Z,@sledgehammer999: let's merge it right away and we can revert the last commit when updated AppVeyour libraries are ready?
305322119,6156,zeule,2017-05-31T21:24:49Z,@LordNyriox: I've made an agreement with @sledgehammer999 earlier. We agreed to avoid that hack. I can't just ignore that fact.
305341105,6156,thalieht,2017-05-31T22:53:31Z,"/Offtopic

>This is one of several PRs ([#6698] is another) that seem to have stopped sending me notifications, despite my being explicitly subscribed to both the threads and the repository.

So it's not just me..."
305545005,6156,sledgehammer999,2017-06-01T16:19:19Z,"This is open in my browser tabs. This PR is amongst the 3 I have open.
I am currently uploading v3.3.13.
Then work will start for finalizing v3.4.0 beta. And I'll start keeping up with PRs threads again.
"
312511987,6156,sledgehammer999,2017-07-02T19:29:45Z,"@evsh I get the generic icons on Windows, even though I build it using WinExtras. Do you want me to debug some specific line?"
312516464,6156,zeule,2017-07-02T20:56:06Z,"> I get the generic icons on Windows, even though I build it using WinExtras. Do you want me to debug some specific line?

Yes, please. I'll add comment to the PR."
312517094,6156,zeule,2017-07-02T21:09:17Z,"@sledgehammer999: most likely you did not enable an option in the advanced settings. If you say that the option is unneeded, I tend to agree."
312517147,6156,sledgehammer999,2017-07-02T21:10:17Z,"I am sorry. I hadn't realized there is a setting that controls this. It works.

However you need to restart qbt to make it work. Is this an intentional limitation or a bug?"
312517188,6156,sledgehammer999,2017-07-02T21:11:04Z,">@sledgehammer999: most likely you did not enable an option in the advanced settings. If you say that the options is unneeded, I tend to agree.

Yup. I don't think it is necessary to have an option for this."
312517379,6156,zeule,2017-07-02T21:14:50Z,"> However you need to restart qbt to make it work. Is this an intentional limitation or a bug?

It's a bug. However,…

> Yup. I don't think it is necessary to have an option for this.

…if we remove the option, the bug will be gone too."
312519686,6156,sledgehammer999,2017-07-02T22:01:08Z,">…if we remove the option, the bug will be gone too.

+1

Just wait a bit, I'm in the process of building+uploading new package for appveyor with WinExtras. Then you can also remove the winextras check too."
312519765,6156,zeule,2017-07-02T22:02:37Z,"Super! Could you ping me, please, when the new image is ready?"
312523683,6156,sledgehammer999,2017-07-02T23:33:37Z,"@evsh new files are uploaded. I also updated the appveyor config you use msvc2017, so be sure to rebase on top of master."
312603043,6156,zeule,2017-07-03T09:57:12Z,"@sledgehammer999: thanks! 

PR updated: QWinExtras module is used unconditionally, icons are shown unconditionally."
312645602,6156,zeule,2017-07-03T13:28:36Z,@sledgehammer999: done. Sorry for the carelessness.
312670357,6156,sledgehammer999,2017-07-03T15:06:17Z,Thx
312686960,6156,zeule,2017-07-03T16:20:31Z,Thanks everyone!
314043275,6156,zeule,2017-07-10T08:43:18Z,Fix for [QTBUG-25319](https://bugreports.qt.io/browse/QTBUG-25319) will be in Qt 5.9.2. I'll submit a corresponding PR.
314081103,6156,sledgehammer999,2017-07-10T11:38:56Z,">Fix for QTBUG-25319 will be in Qt 5.9.2. I'll submit a corresponding PR.

Finally. Although that Qt shortcoming was mentioned/known a long while ago. At least the fixed it."
315556895,6156,vit9696,2017-07-15T19:34:54Z,@evsh I have just realised that this always returns blank icons on macOS for anything but folders.
315621189,6156,zeule,2017-07-16T16:44:51Z,"@vit9696 thanks for pointing this out. 

Unfortunately, I can't build qBt in MacOS so can not look into it right now. Maybe next week... "
315622552,6156,vit9696,2017-07-16T17:04:31Z,"@evsh yes, it just gives iconForFile: empty path [here](https://github.com/qt/qtbase/blob/a23568be6c6859b3a149cfadb1104da4f32318f5/src/plugins/platforms/cocoa/qcocoatheme.mm#L317). And that's even when the files are definitely available on disk. Cannot promise to look any soon on this either though."
316302615,6156,vit9696,2017-07-19T07:53:07Z,"@evsh, ok, I tracked the issue down, and the merged code simply makes no sense to me from now on.

[This line](https://github.com/qbittorrent/qBittorrent/pull/6156/files#diff-ef70c826e766877aefc50860e05bc7edR292) building `QFileInfo` from the item does nothing but appends the current working directory to a relative name. To elaborate, imagine `name()` return `debian-9.0.0-amd64-netinst.iso`, in this case given working dir set to `/Users/MyUser/` the newly created `QFileInfo` will be built with `/Users/MyUser/debian-9.0.0-amd64-netinst.iso` path. And the actual file location could be `/Users/MyUser/Downloads/debian-9.0.0-amd64-netinst.iso`.

Obviously icon lookup will always fail when the downloaded file resides in a folder different from the working directory. That's because `iconForFile:` needs an actual file, and you give it a completely invalid path. How does it even work on the other platforms? I do not understand why QFileInfo is even used here, especially since the detection could only happen by an extension, and since QFileInfo is believed to be slow. 

What needs to be done here (especially given that one should be able to see the icons before downloading anything) is just a plain extension-based lookup. So I enforced `MimeFileIconProvider`, simplified it a little to avoid QFileInfo, and added some prints of the icon names and mimes:
```
""debian-9.0.0-amd64-netinst.iso""  has  ""application/x-cd-image"" mime
""application/x-cd-image""  has  ""application-x-cd-image""  icon
""application/x-cd-image""  has  ""application-x-generic""  genicon
```
So far so good, but `QIcon::fromTheme` from both of those returns a null icon. The docs say that this function appears to be a Linux hack compatible with some kind of Linux-only spec with an ability of gluing to a local icon database @_@. Sounds mad and of course does not work, on macOS you have [iconForFileType:](https://developer.apple.com/documentation/appkit/nsworkspace/1527879-iconforfiletype?language=objc), which should be used in a similar way to [iconForFile:](https://github.com/qt/qtbase/blob/a23568be6c6859b3a149cfadb1104da4f32318f5/src/plugins/platforms/cocoa/qcocoatheme.mm#L313) :/.

Given the overall code craziness, could you please rework this? If you want to use file-based icon matching, please provide a valid file path. Otherwise this should be eliminated for good, along with the ugly test attempting to achieve nothing.

Here is a [basic patch](https://ghostbin.com/paste/2fzdk) required to get things work on macOS. I could submit a pull-request with just this to make it in time for 3.4.0. Or it could be used as a reference for the refactoring of this code by somebody else.

CC @Chocobo1, @glassez, @LordNyriox, @sledgehammer999, @thalieht."
316305396,6156,zeule,2017-07-19T08:05:17Z,"@vit9696, thanks for the investigation! 

> This line building `QFileInfo` from the item does nothing but appends the current working directory to a relative name. 

This makes no sense to me. Are you saying that the `QFileInfo` objects contain actual full path (with the current directory for he moment of its creation)? 

> Obviously icon lookup will always fail when the downloaded file resides in a folder different from the working directory.

Lookup by file extension has to work with non-existing files. 

> That's because `iconForFile`: needs an actual file, and you give it a completely invalid path. 

This means QTBUG-25319 affects MacOS too.

> I do not understand why `QFileInfo` is even used here, especially since the detection could only happen by an extension, and since `QFileInfo` is believed to be slow.

Because it's a part of `QFileIconProvider` interface."
316307996,6156,vit9696,2017-07-19T08:15:54Z,"> This makes no sense for me. Are you saying that the QFileInfo objects contain actual full path (with the current directory for he moment of its creation)?

I am only talking about `absoluteFilePath()` used by Qt internally and by the Windows icon lookup here. From what I can tell QFileInfo changes nothing itself and just does what you ask it. Want absolute path → working dir gets appended unless the original path has already been absolute. In this case all the files are just filenames without even a torrent subdir prefix (see the prints above).

> Lookup by file extension has to work with non-existing files.

Yes, but what is the point of doing this when you already have mime-based search? This is not going to do any better unless you actually have the file at least partially downloaded, pass the valid path, have the data-based detection enabled. Otherwise it is just unnecessary code duplication.

> Because it's a part of QFileIconProvider interface.

QFileIconProvider is just a spike that helps nothing when you provide invalid paths that will never become valid to it."
316338699,6156,zeule,2017-07-19T10:11:06Z,"> I am only talking about `absoluteFilePath()` used by Qt internally and by the Windows icon lookup here…

Thanks, understood.

> Yes, but what is the point of doing this when you already have mime-based search? 

Mime database does not exist on Windows, while `QFileIconProvider` give a uniform interface on all platforms.

> QFileIconProvider is just a spike that helps nothing when you provide invalid paths that will never become valid to it.

Uniform interface.

So, `QFileIconProvider::icon()` does not work on MacOS for non-existing files. You probably should submit a bug report to Qt and submit a PR here basing on your investigation. Also, I would recommend you to subclass `QFileIconProvider` instead of hooking up with `#ifdef` into the `MimeFileIconProvider`. That would keep code cleaner and allow our descendants to easily remove the workaround when Qt fixes the problem."
316344085,6156,vit9696,2017-07-19T10:34:28Z,"> Uniform interface.

That does not work on anything but a couple of Linux distros :D 
Anyway, no reason for any further discussion. Created #7118.
As for bugreports there are way too many terrible and obvious Qt bugs on macOS for me to bother reporting them."
316382295,6156,zeule,2017-07-19T13:14:58Z,"> That does not work on anything but a couple of Linux distros 

It works on Windows too (Qt 5.9.2 and later)."
429928348,9704,zeule,2018-10-15T16:46:21Z,"I don't remember what change in the libtorrent API made me replace raw integers with `std::chrono` types, but it's probably for the good."
430011866,9704,zeule,2018-10-15T21:01:48Z,"@glassez, I will address all your comments, but I want to make it compile first and set the CI up."
430092028,9704,glassez,2018-10-16T03:55:19Z,">@glassez, I will address all your comments, but I want to make it compile first and set the CI up.

Ok. Just ping me when I should start reviewing."
430174114,9704,zeule,2018-10-16T09:47:52Z,@qbittorrent/frequent-contributors: do i need to achieve compatibility with the libtorrent 1.0 branch or will we drop it with this PR?
430190415,9704,glassez,2018-10-16T10:44:27Z,">do i need to achieve compatibility with the libtorrent 1.0 branch or will we drop it with this PR?

As I said before I would drop it.
@sledgehammer999 has the deciding vote on these issues, so we'll have to wait for him."
430275884,9704,glassez,2018-10-16T15:09:57Z,"@zeule, @arvidn, is using chrono types strongly required to support libtorrent-1.2?"
430276741,9704,zeule,2018-10-16T15:12:13Z,"@glassez, libtorrent API uses chrono::duration, maybe other types too. I see no reason to convert them into raw integers for qBt internal use."
430286222,9704,glassez,2018-10-16T15:37:07Z,">libtorrent API uses chrono::duration, maybe other types too. I see no reason to convert them into raw integers for qBt internal use.

Ok.
I was just confused by your previous comment about the fact you don't remember why you became use chrono types."
430809837,9704,zeule,2018-10-17T22:20:29Z,"> Ok. Just ping me when I should start reviewing.

Restored C++11 compatibility. Please review. I will work on QMake and Travis problems."
430981660,9704,glassez,2018-10-18T12:00:49Z,">Restored C++11 compatibility. Please review. I will work on QMake and Travis problems.

I'm reviewing it now. Please don't rebase until I finish."
431012942,9704,zeule,2018-10-18T13:41:44Z,"> Please don't rebase until I finish.

Take your time."
431338611,9704,zeule,2018-10-19T11:55:52Z,"As the next step I want to sort out all the typedefs and to do that I can either mirror libtorrent types in qBt and make those typedefs depend on libtorrent version, and do that with indicies, download priorities, maybe with some of the flag types. This way we consolidate most of the `#if LIBTORRENT_VERSION_NUM` commands. From the other hand, we duplicate quite many types. From the other hand, the typedefs can be bypassed via auto-typed variable and lambdas. 

For how long qBt plans to support libtorrent 1.1? When C++14 will be a hard requirement for qBt? Your thoughts? Thanks!"
431375259,9704,glassez,2018-10-19T14:07:29Z,">For how long qBt plans to support libtorrent 1.1?

This question should sound like ""For how long @sledgehammer999 plans to support libtorrent 1.1?"". Unfortunately, the community has little influence on strategic decisions in this project.

Based on previous experience...
For how long qBt plans to support libtorrent 1.1? Long. Perhaps until next after v1.2 libtorrent release. We're still not sure if we'll drop support of libtorrent-1.0.
When C++14 will be a hard requirement for qBt? Hard to say... What is its support by the most used compilers (their most used versons)?"
431379492,9704,zeule,2018-10-19T14:20:20Z,"> What is its support by the most used compilers (their most used versons)?

GCC supports that from version 5, released in April 2015 ([C++ support status](https://gcc.gnu.org/projects/cxx-status.html), [GCC Releases](https://www.gnu.org/software/gcc/releases.html))

CLang supports C++14 as of version 3.4, released in January 2014 ([C++ support status](https://clang.llvm.org/cxx_status.html), [LLVM releases](http://releases.llvm.org/)) 

MSVC? Visual Studio 2015 seems to be enough for our needs. Released in July 2015.

Concluding, I don't understand why do we stuck on C++11. For old Ubuntu and Fedora versions? But there are toolchain backports for them.

P.S. Even QMake supports C++14 as of Qt 5.4 (we require > 5.5)."
431390107,9704,glassez,2018-10-19T14:52:01Z,">For old Ubuntu and Fedora versions?

I always think about Linux 
distros when it comes to the brakes of supporting new features.
>Even QMake supports C++14 as of Qt 5.4 

AFAIK, QMake has nothing to do with C++ standards except having some predefined settings (which can be defined manually in previous QMake versions).

As for me, I am always for a reasonable movement forward. If C++14 has sufficient support, why not adopt it?..
But, as I mentioned above, @sledgehammer999 did not delegate to the community the right to address such issues. We can only express our opinion."
431394406,9704,zeule,2018-10-19T15:04:54Z,"C++14 is advertised as a little improvement to C++11, but with this PR and after porting over changes from 14 to 11  I realised that those little changes result in significantly different routes when writing code (auto typying in C++ 11 is defective). Realising also that C++14 is imminent ether as 14 or 17 for the project, I don't want to waste time and efforts in rewriting code. 

@sledgehammer999, I want your decision on these matters, please. "
431560441,9704,glassez,2018-10-20T08:25:56Z,"Well, now I have a general overview of all the changes. I still didn't go into some of the details (intentionally). In addition, I tried not to comment on the coding style, because its time has not yet come. Here is my main conclusion.
A significant part of the changes is related to the propagation of using the chrono types throughout overall the qBittorrent code. At the same time, it is not required strictly for adding support of libtorrent-1.2. Although libtorrent-1.2 uses chrono types, we can easily localize their use only in places of interaction with libtorrent, and leave the main code untouched at this stage. We can switch to using them in a separate PR. Leaving it here, you condemn the PR to be unmerged within indefinite time. There are already a lot of changes that need to be discussed and improved. So I would strongly recommend that you get rid of all additional (not strongly required) changes."
437681343,9704,zeule,2018-11-11T15:51:17Z,I convert it back C++14 then. 
447558568,9704,glassez,2018-12-15T10:40:06Z,"@zeule, what is the status of this PR?"
447562655,9704,zeule,2018-12-15T11:48:39Z,"I hardly have any time for qBt until January, and the PR is stalled."
457717717,9704,hvonw,2019-01-25T20:33:35Z,"Hi friends,
Thank you for excellent work you guys put in to this projekt. 
A lot of bugfixes, improvements on libtorrent 1.2+ changelog. It would be really good to synchronize with this master branch.
We'd appreciate it if you'd let us know."
467870848,9704,WolfganP,2019-02-27T13:57:24Z,"Just a quick question. Shouldn't qBittorrent be compiled against https://github.com/arvidn/libtorrent/commits/RC_1_2 instead of https://github.com/arvidn/libtorrent/commits/master as the former is more stable and curated by the author?
(somewhere in the wiki -that I can't find now- it was suggested to link qBt master with libtorrent RC_1_1 when developing)"
467913505,9704,arvidn,2019-02-27T15:45:22Z,"@WolfganP at the time this PR was opened, `RC_1_2` had not been cut yet. so ""master"" in this title, refers to something very close the the 1.2 release of libtorrent"
536649237,9704,glassez,2019-09-30T16:48:43Z,We don't support libtorrent master in general case. libtorrent-1.2 is supported now. Shouldn't this PR be closed now? @Chocobo1?
536863188,9704,Chocobo1,2019-10-01T04:52:33Z,">libtorrent-1.2 is supported now. Shouldn't this PR be closed now? @Chocobo1?

Agree."
162272487,4266,naikel,2015-12-06T05:32:34Z,"Reverted the unnecessary alignment changes of options.ui.
"
162330109,4266,sledgehammer999,2015-12-06T17:18:29Z,"Rebase.
"
162337790,4266,naikel,2015-12-06T19:14:22Z,"Rebased and fixed camelCase.
"
162345874,4266,sledgehammer999,2015-12-06T20:41:25Z,"@glassez I think we should relax the camelCase rule. It is a pain in the ass when you are moving old code around without actually touching it but you have to read it and fix it to be camelCased.
"
163122243,4266,glassez,2015-12-09T06:19:24Z,"> It is a pain in the ass when you are moving old code around without actually touching it but you have to read it and fix it to be camelCased.

Otherwise it will be a pain in the ass for reviewers to distinguish new code from displaced. I have no trouble in correcting such names. QtCreator does it perfectly. Just have to find the wrong names, but it is also not difficult: they just cut look. Besides, if someone misses something, the other reviewers remind him.
"
163658649,4266,Nemo-qB,2015-12-10T15:28:11Z,"Looks great naikel! Very useful when seeding.
"
163667096,4266,naikel,2015-12-10T15:51:40Z,"@Nemo-qB Thanks!

I rebased and made a little cosmetic change since the word ""minutes"" was missing in the WebUI:

![WebUI Preferences](http://i.imgur.com/n8h1ODW.png)
"
167680470,4266,naikel,2015-12-28T23:48:23Z,"Fixed this line to have a default value:

``` C++
out.seedingTimeLimit = fast.dict_find_int_value(""qBt-seedingTimeLimit"", -2);
```

Because without it, people who upgraded to this version and had seeding torrents would see them all stopped because they would have reached the max share time ratio of 0 minutes!

But now upgrades work great as well.
"
168555552,4266,naikel,2016-01-03T23:44:49Z,"Rebased.

No love for this PR? :cry:
"
170418389,4266,naikel,2016-01-11T02:27:03Z,"@sledgehammer999 I wonder if this can make it to 3.3.2 or 3.4.0?
"
171073301,4266,naikel,2016-01-12T22:00:21Z,"Rebased.

@LordNyriox you can clone this branch in my repository and use the feature until @sledgehammer999 merges it.  I've been using it since October, can't live without it!
"
175703154,4266,naikel,2016-01-27T15:55:26Z,"Rebased and retested.

@sledgehammer999 you should merge this when you have the time.
"
180099367,4266,naikel,2016-02-04T23:23:01Z,"Sure, but will this ever be merged? It's ready since Oct 27th...
"
180136452,4266,naikel,2016-02-05T01:14:45Z,"I can't rebase because ""master"" right now crashes when I click ""Options"", so it's totally unstable :cry:
"
180823241,4266,naikel,2016-02-06T18:01:54Z,"@LordNyriox what I meant is that the master branch here on github without any of my patches crashes when I click ""Options"".

```
ASSERT: ""ok"" in file gui/advancedsettings.cpp, line 324


*************************************************************
Catching signal: SIGABRT
Please file a bug report at http://bug.qbittorrent.org and provide the following information:

qBittorrent version: v3.4.0alpha
stack trace:
  /lib/x86_64-linux-gnu/libc.so.6 : gsignal()+0x37  [0x7fcd53b89107]
  /lib/x86_64-linux-gnu/libc.so.6 : abort()+0x148  [0x7fcd53b8a4e8]
  /usr/lib/x86_64-linux-gnu/libQt5Core.so.5 : ()+0x931e1  [0x7fcd54cd71e1]
  /usr/lib/x86_64-linux-gnu/libQt5Core.so.5 : ()+0x8e33e  [0x7fcd54cd233e]
  src/qbittorrent : void AdvancedSettings::addRow<QLabel>(int, QString const&, QLabel*)+0x69  [0x6540a9]
  src/qbittorrent : AdvancedSettings::loadAdvancedSettings()+0x82  [0x651e72]
  src/qbittorrent : AdvancedSettings::AdvancedSettings(QWidget*)+0x3a7  [0x653dd7]
  src/qbittorrent : options_imp::options_imp(QWidget*)+0x2dc7  [0x661787]
  src/qbittorrent : MainWindow::on_actionOptions_triggered()+0x5b  [0x6069bb]
```

So I guess @sledgehammer999 should fix this first until the master branch is stable again.
"
180875617,4266,naikel,2016-02-06T22:36:49Z,"I actually see what the problem is.  

The new addRow() method in AdvancedSettings is assigning a boolean as a return vale of connect, but connect doesn't return a boolean, but a QMetaObject::Connection instead.  So the assert at the end will always hit:

``` C++
    bool ok;
    if (std::is_same<T, QCheckBox>::value)
        ok = connect(widget, SIGNAL(stateChanged(int)), SIGNAL(settingsChanged()));
    else if (std::is_same<T, QSpinBox>::value)
        ok = connect(widget, SIGNAL(valueChanged(int)), SIGNAL(settingsChanged()));
    else if (std::is_same<T, QComboBox>::value)
        ok = connect(widget, SIGNAL(currentIndexChanged(int)), SIGNAL(settingsChanged()));
    else if (std::is_same<T, QLineEdit>::value)
        ok = connect(widget, SIGNAL(textChanged(QString)), SIGNAL(settingsChanged()));
    Q_ASSERT(ok);
```

This only happens on debug builds.  I will continue my rebase, but this has to be fixed...
"
180921845,4266,Chocobo1,2016-02-07T02:36:27Z,"> This only happens on debug builds. I will continue my rebase, but this has to be fixed...

Sorry about that, please do fix it.
"
181497254,4266,naikel,2016-02-08T17:54:34Z,"Cool!! :+1: 
"
192540418,4266,naikel,2016-03-05T00:56:31Z,"I'll work on it
"
210895759,4266,ngosang,2016-04-16T20:38:54Z,"Tested and I can't find anything wrong. @sledgehammer999 could you tag for 3.3.5?
"
211406857,4266,naikel,2016-04-18T14:37:01Z,"Coding style fixed where noted.
"
211408250,4266,glassez,2016-04-18T14:41:09Z,"> Coding style fixed where noted.

Still not fixed in `void UpDownRatioDlg::accept()` method body.
"
211438222,4266,naikel,2016-04-18T15:42:20Z,"> Still not fixed in void UpDownRatioDlg::accept() method body.

I put the { in the next line like you told me.  Is there anything else left to fix there?

EDIT: I think I got it: the if.
"
211451881,4266,glassez,2016-04-18T16:16:35Z,"> EDIT: I think I got it: the if.

Yes. But it still not fixed.
Please check out CODING_GUIDELINES.md to begin with, otherwise you'd have a lot of time to ""fix"" it.
"
211455094,4266,naikel,2016-04-18T16:23:53Z,"I see it. Maybe this is the only project you work on, but when you work in dozens of projects, each one with a coding style totally different than the next one, it's pretty hard to remember.
"
211460642,4266,glassez,2016-04-18T16:34:53Z,"> I see it. Maybe this is the only project you work on, but when you work in dozens of projects, each one with a coding style totally different than the next one, it's pretty hard to remember.

And what do you suggest?

Still unfixed. Either drop braces in `if` clause or add them to `else`.
"
211465629,4266,naikel,2016-04-18T16:42:23Z,"Thanks.  I chose to drop them then.
"
213935602,4266,ngosang,2016-04-24T10:50:53Z,"@naikel After this is merged I will love to have a similar feature to stop sharing when one torrent have more than XX seeds. What do you think?
"
214713669,4266,DrKittens,2016-04-26T11:41:03Z,"Personally i'd think that would be a seperate PR as its unrelated to this time-based PR.
I'd love to see this functional 5month old PR merged into master branch sometime soon please.
"
269691440,4266,elesto,2016-12-29T20:50:19Z,@naikel what happened to development on this? 
269910323,4266,naikel,2017-01-01T16:55:25Z,"@friendlytherapist since this PR has more than a year and never was merged, I just thought the main developers weren't interested and gave up."
269920157,4266,naikel,2017-01-01T21:20:50Z,"I rebased this PR again.

I have to admit I'm a little sad this PR has never been considered for a merge.  It is an important feature.  Not everybody can seed forever.  Some of us have a high rotation of short-lived torrents and this feature works extremely great (with another PR I haven't published where a completed torrent means a torrent that has finished the download AND the seeding).  Some others have limited storage space and have to get rid of their downloads quickly.  Others have an extremely expensive upload rate and can't bear to keep torrents seeding forever.  There's always a request for this feature in the issues section, always, since the beginning of this project.  I'm literally amazed this hasn't been merged.

I have a setting of 15 days (in minutes) and works perfectly.  

Looks like the main developing team is not interested in this PR.  I try to keep it rebased from time to time for the people that is compiling qBittorrent by themselves and merging this PR individually, and I know several people that do this."
269924955,4266,elesto,2017-01-01T23:41:59Z,@sledgehammer999 please 👍 
269934328,4266,naikel,2017-01-02T04:52:50Z,"@LordNyriox The second PR I mentioned changes the definition of the completed status of a torrent and the main developers do not agree with this vision. I'll elaborate:

What I think is natural is this:

- Downloading: A torrent that is currently downloading
- Seeding: A torrent that finished downloading and it is currently seeding
- Completed: A torrent that finished downloading and seeding, so it's paused because its job is done (blue paused icon)
- Resumed: A torrent that is either downloading or seeding, not necessarily active.
- Paused: A torrent that is paused because user paused it or because it's completed.
- Active: A torrent that is currently transferring something.
- Inactive: A torrent that is not transferring anything.

But the qBittorrent team defines the completed status like this:

- Completed: A torrent that finished downloading (but might be seeding)

And this is redundant with seeding torrents because a torrent has to have finished the download to be seeding. So that's a mistake in my humble opinion.  A completed torrent must have finished all their jobs, downloading AND seeding.

So I have this nice PR where the Completed torrents section include only torrents that are really finished (download and upload), mostly because they reached their share ratio or the seeding time limit."
269934873,4266,naikel,2017-01-02T05:06:34Z,"@LordNyriox not really.  If you look at the code it says:

```
bool TorrentHandle::isCompleted() const
{
    return m_state == TorrentState::Uploading
            || m_state == TorrentState::StalledUploading
            || m_state == TorrentState::CheckingUploading
            || m_state == TorrentState::PausedUploading
            || m_state == TorrentState::QueuedUploading
            || m_state == TorrentState::ForcedUploading;
}
```

But it should be:
```
bool TorrentHandle::isCompleted() const
{
    return m_state == TorrentState::PausedUploading;
}
```
And that's exactly what my PR does (that and in the WebUI code as well)"
269934963,4266,naikel,2017-01-02T05:10:04Z,"@LordNyriox Oh...

Good idea! I have to admit I never thought of that... 

I get it now.  It can go in the Advanced Options section, like you suggested. 

"
269953468,4266,thalieht,2017-01-02T10:14:18Z,Only in minutes? We'd need a calculator to determine the days.
269971767,4266,naikel,2017-01-02T13:21:27Z,@thalieht don't be lazy.
269982286,4266,zywo,2017-01-02T14:54:01Z,"Unfortunately, the merging of many useful PRs is very very slow for a project like qBittorrent."
270777968,4266,naikel,2017-01-05T22:35:59Z,Fixed coding style.
272294893,4266,naikel,2017-01-12T21:50:36Z,Removed the unnecessary this-> references.
274341715,4266,naikel,2017-01-22T16:37:47Z,It seems Travis builds were fixed so this PR is ready to be merged (again).
275849608,4266,naikel,2017-01-28T13:57:59Z,Still no love for this PR?
279131319,4266,WaterSibilantFalling,2017-02-11T09:04:42Z,Just a user comment here: I'd really like to use this functionality too.
279259131,4266,sledgehammer999,2017-02-12T23:10:28Z,@naikel sorry for the delays. I am currently in the process of reviewing+merging a lot of **old** PRs. Eventually I'll get to this one too. I hope you can wait.
285083609,4266,naikel,2017-03-08T16:05:35Z,@sledgehammer999 I hope this can make it for 3.3.12!
288279617,4266,Nivius,2017-03-22T02:27:33Z,"I have been waiting for this function for ages now. and so have loads of friends and colleagues. 

This is the last feature that qbittorrent need to turn from a great client to THE client imo. 

Hope this makes it into 3.3.12!

༼ つ ◕_◕ ༽つ @sledgehammer999  TAKE MY ENERGY ༼ つ ◕_◕ ༽つ"
288322886,4266,thalieht,2017-03-22T07:51:07Z,"Tagged issues to add in a future commit or PR name to close them.
#1646 ~~#4519 #4897 #5815 #6153~~"
288332049,4266,zeule,2017-03-22T08:38:27Z,"@thalieht thank you, will close all those issues as duplictes."
295768362,4266,Nivius,2017-04-20T15:00:07Z,Is t here anyway that we can use this feature before its officially included??
301350936,4266,naikel,2017-05-15T00:30:54Z,I made the suggested changes and rebased.  Retested everything with several torrents.  Everything look good.
301483353,4266,zeule,2017-05-15T13:59:09Z,"@naikel, sorry, but it has a conflict again. Could you rebase again, please?"
301497617,4266,naikel,2017-05-15T14:46:01Z,Rebased again @evsh @LordNyriox 
301524108,4266,naikel,2017-05-15T16:12:30Z,"Jesus Christ I think I'm gonna give up.  You guys are never happy.  This request is from December 5th, 2015.  You had a lot of time to review it.  Now it looks everything is bad again and I have done nothing, just apply your changes every time you guys request them.

I think it's better for all if I just close this.  This will never be merged.  Not even if I fix everything, you guys just don't want this feature. 
"
301526373,4266,naikel,2017-05-15T16:20:40Z,"@glassez 

> I also have not tested this, but I don't understand why the following code won't work?

Because it won't reenable the Apply button if you modify the seeding limit, just the comboRatioLimitAct, and then you wouldn't be able to apply your changes."
301526732,4266,glassez,2017-05-15T16:22:03Z,"@naikel, calm down, please! 
In fact, this PR is close to being merged like never (this is due to the recent changes in the organization of the project). 
I really had not considered this PR previously due to the fact that I do not could affect the possibility of its merging, and the feature itself is not interesting to me. Now I'm one of those members who can merge PRs collectively without the participation of the project maintainer (who is very busy and has little time for this)."
301528553,4266,naikel,2017-05-15T16:28:51Z,"I'll make the changes.  

But I will also fix the same functions that have the same problem just to be consistent.

What I mean is, if you want me to fix this:
```
    int globalMaxSeedingMinutes = session->globalMaxSeedingMinutes();
    if (globalMaxSeedingMinutes >= 0) {
        // Enable
        m_ui->checkMaxSeedingMinutes->setChecked(true);
        m_ui->spinMaxSeedingMinutes->setEnabled(true);
        m_ui->spinMaxSeedingMinutes->setValue(globalMaxSeedingMinutes);
    }
```
The variable is totally useless, I know.  But why I did it? because just a couple of lines before there's this code:
```
    float globalMaxRatio = session->globalMaxRatio();
    if (globalMaxRatio >= 0.) {
        // Enable
        m_ui->checkMaxRatio->setChecked(true);
        m_ui->spinMaxRatio->setEnabled(true);
        m_ui->comboRatioLimitAct->setEnabled(true);
        m_ui->spinMaxRatio->setValue(globalMaxRatio);
    }
```
Then I have to fix that as well, and that's not my code, but it would look totally weird that both code sections look different.

The same for the ""else"", I follow the code guidelines in new methods that I introduce, but when I'm modifying an existing one, I could be a little flexible just to follow the code guideline of that method specifically, because I think some other developer is working in fixing all the code in parallel.

So I'll take the liberty to fix the original functions that I copied to be consistent
"
301530051,4266,naikel,2017-05-15T16:34:08Z,"@LordNyriox I understand, and they should be strict since I'm strict with the code at my job as well, but even so,  something like 75% of the code doesn't follow the guidelines...  I wonder what happened.
"
301536262,4266,Nivius,2017-05-15T16:57:03Z,"@naikel you can do it! this is a highly requested feature for a lot of people, it's just that most people don't go this deep to ask for it

This addition whould make my my process 100% automate from 90% right now. I really hope that you cna find strength to work it thru!

@LordNyriox Is it @naikel responsibility to fix code that is not relevant to his part and have that block the merging for his part?"
301541372,4266,glassez,2017-05-15T17:16:06Z,"@LordNyriox, thank you!
@naikel, really the tightening of coding style has been done recently and there is still a lot of old code that doesn't follow it. This is not a reason to break it in new code. Other errors in the code (previously undetected) is also not a reason to emulate them. And Yes, we do try to correct the noticed deficiencies in the code affected in some PR, even if they are unrelated (although requests to do so are not popular with many, including ourselves)."
301542652,4266,glassez,2017-05-15T17:21:13Z,">I'll make the changes.

@naikel, please create fixup commit first time. You squash it after checking."
301630479,4266,naikel,2017-05-15T23:11:12Z,I pushed a new commit with the fixes @evsh @glassez @LordNyriox 
301752883,4266,zeule,2017-05-16T11:25:28Z,"I have no more critical comments. Taking into account the long history of this PR and high user demand, IMO all polishing can be done after merging."
301754511,4266,glassez,2017-05-16T11:33:38Z,"> have no more critical comments. Taking into account the long history of this PR and high user demand, IMO all polishing can be done after merging.

+1
@naikel, please fix last issue (curly brace position) and squash fixup commits."
302075835,4266,zeule,2017-05-17T12:33:49Z,"Oops, I've made a conflict. @naikel, could you rebase it one more (the last one) time, please?"
302080422,4266,glassez,2017-05-17T12:52:21Z,"@evsh, I think we should no longer delay it, and merge it immediately after the conflicts will be resolved."
302082280,4266,zeule,2017-05-17T12:59:29Z,Sure. I thought we agreed on this already. Came here to merge it and discovered the conflict.
302233626,4266,naikel,2017-05-17T21:14:43Z,"I fixed the last conflict @evsh @glassez @LordNyriox 

Now I'm curious why one of those last commits in master removed all classic Qt SIGNAL() and SLOT() and replaced them with that weird stuff..."
302292539,4266,glassez,2017-05-18T03:44:09Z,">replaced them with that weird stuff

That weird stuff is pure c++.
This new Qt5 connection syntax has some advantages (e.g. compile time checking)."
302295736,4266,glassez,2017-05-18T04:13:13Z,"@naikel, thank you."
302332983,4266,thalieht,2017-05-18T08:10:52Z,"Finally! Although i have no interest in this feature, thanks guys and @naikel for your patience and for not abandoning it. It was frustrating watching you doing rebase after rebase for so long and not being able to help."
302527899,4266,Nivius,2017-05-18T20:12:15Z,"finnaly!

when does it go live then? next update? :D"
310491210,4266,jeff15110168,2017-06-22T20:19:33Z,omg been waiting for this feature forever. Please please please hoping that this rolls out soon :)
317166469,4266,pret0rian,2017-07-22T08:23:47Z,Why this is still not in 3.4.0 alpha version? How many years you need to add so simple feature?
317166788,4266,glassez,2017-07-22T08:28:33Z,">Why this is still not in 3.4.0 alpha version? How many years you need to add so simple feature?

This PR was merged onto master 2 months ago!"
317167595,4266,pret0rian,2017-07-22T08:42:42Z,"> This PR was merged onto master 2 months ago!

So what? Im currently using 3.3.14 and still don't have that option..."
317168717,4266,glassez,2017-07-22T09:01:26Z,">>>Why this is still not in 3.4.0 alpha version? How many years you need to add so simple feature?
>>
>>This PR was merged onto master 2 months ago!
>
>So what? Im currently using 3.3.14 and still don't have that option...

Please decide which version you are asking: 3.4.0 alpha or 3.3.14!"
317168990,4266,pret0rian,2017-07-22T09:05:39Z,"> Please decide which version you are asking: 3.4.0 alpha or 3.3.14!

Doesn't matter what version I use, you said it's merged 2 months ago and I just say that newest version still doesn't have that, just check this out (no need to download 3.4.0 alpha):
https://github.com/qbittorrent/qBittorrent/compare/v3_3_x...35c51ad3b1765744d0c724331db60514123aabd5"
317169348,4266,jeff15110168,2017-07-22T09:11:39Z,"Would be great to have this in the 3.3.14 or 3.3.15 build :)

--
@evsh cleaned up e-mail quotes. "
317189919,4266,zywo,2017-07-22T15:11:37Z,"It was merged to master branch (currently 3.4.0alpha), it's not included in v3_3_x branch."
317203264,4266,maca134,2017-07-22T18:56:18Z,So how long until the general users can expect this feature?
327296868,4266,Nivius,2017-09-05T20:40:44Z,"so, any estimates when 3.4 might drop?"
338545500,4266,corydorning,2017-10-23T04:34:11Z,not soon enough :(
346151449,4266,jeff15110168,2017-11-21T20:30:16Z,is this coming to 4.0?
376715696,4266,corydorning,2018-03-28T00:08:48Z,"Checking in again... This is the only thing keeping me from switching over from deluge which I'm not a fan of. But it has this feature.

Is it live yet?"
376719606,4266,corydorning,2018-03-28T00:31:08Z,So it looks like this is live but is it possible to do it based on category or tracker? Different trackers have different rules.
688762856,13348,glassez,2020-09-08T10:02:02Z,"This PR is an attempt to improve performance when loading torrents into session (especially when restoring a session, so many torrents are loaded in a row).
Can someone test it with a large number of torrents (on the order of several hundred or thousands) and tell us how it behaves?
 It is unlikely to be able to accelerate the restoring of session, but it should make UI more responsive at this time.
PR is in the draft stage (it is also based on other not merged changes), so do not pay attention to the ""dirty"" git history, etc.
A side effect is that there is a certain time interval between the UI is displayed and the torrent list starts to fill up. If it turns out that it does its main job well, then I'm waiting for your suggestions for improving its interface (for example, displaying progress in some way, or just displaying the ""busy"" status).

@jagannatharjun, @an0n666, ping."
688813753,13348,ghost,2020-09-08T11:44:38Z,"I can test on windows if someone can provide me with a test build.
Ping @FranciscoPombal "
688990600,13348,c0re100,2020-09-08T16:23:46Z,"> I can test on windows if someone can provide me with a test build.
> Ping @FranciscoPombal

```
qb: master+improve-startup
libtorrent: 1.2.10(70eb2b4)
```
https://drive.google.com/file/d/1sZNbT5tvoPP2d_wVTFQ3mohJ1-Y-ZPr5/view?usp=sharing"
688993648,13348,FranciscoPombal,2020-09-08T16:28:43Z,"@c0re100 

> ```
> qb: master+improve-startup
> libtorrent: 1.2.10(70eb2b4)
> ```
> 
> https://drive.google.com/file/d/1sZNbT5tvoPP2d_wVTFQ3mohJ1-Y-ZPr5/view?usp=sharing

Thanks, beat me to it. Is this before or after the force push from 37aa89d to db3bd7a?"
689022217,13348,c0re100,2020-09-08T17:19:46Z,"> @c0re100
> 
> > ```
> > qb: master+improve-startup
> > libtorrent: 1.2.10(70eb2b4)
> > ```
> > 
> > 
> > https://drive.google.com/file/d/1sZNbT5tvoPP2d_wVTFQ3mohJ1-Y-ZPr5/view?usp=sharing
> 
> Thanks, beat me to it. Is this before or after the force push from [37aa89d](https://github.com/qbittorrent/qBittorrent/commit/37aa89d67fec1a4fe6bc245f854d1d526291d530) to [db3bd7a](https://github.com/qbittorrent/qBittorrent/commit/db3bd7ae78c7b72840a1e049959f86c657da8c36)?

After the force push(db3bd7a)"
689203841,13348,ghost,2020-09-09T00:15:12Z,"Ok so I ran multiple types of tests with 5000 torrents on a SSD storage.

First I tried with the last build that ned-martin used. https://github.com/qbittorrent/qBittorrent/issues/12825#issuecomment-670215379

It took 13 seconds for the UI to become responsive(white blank UI to transfer list) with only 1 non-working tracker.

It took 2 mins and 29 seconds with 10 non-working trackers.

Then I tried with the build provided here https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-688990600

It took around ~10 seconds for UI to load and display no torrents. But then it went back to Not responding for another 2 mins and 40 seconds. So ultimately the UI remains unusable. I'm not seeing any improvement here. Except now the UI loads earlier with no torrents at all and it remains non responsive for almost the same amount of time.

"
689354804,13348,glassez,2020-09-09T07:08:03Z,"Well, I will continue further research."
689600658,13348,ghost,2020-09-09T14:29:33Z,"The load time is faster with less trackers. 
5000 torrents 10 trackers each = 50000 announces per endpoint. I have a total of 5 endpoints out of which only 1 has internet. Others are just 127.0.0.1, link local v6 and 2 VM adapters."
689880634,13348,xavier2k6,2020-09-09T23:40:15Z,"@an0n666 

Windows test build of 4.3.0(Alpha1) with listed libraries:
```
qBittorrent master   | 4.3.0 +git 2e6236e PR #13348 (Sep 09, 2020)
libtorrent-rasterbar | 1.2.10.0 +git 6ed8872 (Sep 09, 2020)
Qt                   | 5.15.1
OpenSSL              | 1.1.1g
zlib                 | 1.2.11
Boost                | 1.74
```

[Download Link](https://www.dropbox.com/s/qkje8r7p92yrse3/qbittorrent%202e6236e%20pr%20%2313348%20libtorrent%206ed8872%20qt5.15.1%20boost%201.74.zip?dl=1)"
689904812,13348,ghost,2020-09-10T00:56:27Z,"> @an0n666
> 
> Windows test build of 4.3.0(Alpha1) with listed libraries:
> 
> ```
> qBittorrent master   | 4.3.0 +git 2e6236e PR #13348 (Sep 09, 2020)
> libtorrent-rasterbar | 1.2.10.0 +git 6ed8872 (Sep 09, 2020)
> Qt                   | 5.15.1
> OpenSSL              | 1.1.1g
> zlib                 | 1.2.11
> Boost                | 1.74
> ```
> 
> [Download Link](https://www.dropbox.com/s/qkje8r7p92yrse3/qbittorrent%202e6236e%20pr%20%2313348%20libtorrent%206ed8872%20qt5.15.1%20boost%201.74.zip?dl=1)

With zero trackers, session restores completely within 8 seconds. That is 5k torrents get loaded within 8 seconds.
No not responding issue. But the UI remains non responsive for that 5-6 seconds after loading till all torrents restore.
Memory usage is fairly low at 80 MiB.

With 10 non working trackers in each torrent, it takes around 2 min 40 seconds for the UI to go from Not responding to a choppy one that lags like hell. The memory usages gradually climbs up to 800 MiB + and 50% of all 4 CPU cores were being utilised constantly during the Not responding period. The memory seem to get freed pretty slowly."
689918418,13348,ghost,2020-09-10T01:36:11Z,"Ok so I think I got something:

The trackers that I was using were like this:
http://example1.com
http://example2.com
http://example3.com
and so on...

I changed them to 
http://example1.com/announce
http://example2.com/announce
http://example3.com/announce
etc..
And now the locking issue is gone! qBt loads fine and then the TRACKERS section is gradually being populated with errored torrents!
No lag or choppiness as well.

So I think something is breaking due to not having /announce in the tracker URL?
@arvidn ping!

Edit: The issue could be at qBt end as well. Like how the TRACKERS section parses the announce URLS. @glassez "
689933175,13348,FranciscoPombal,2020-09-10T02:21:18Z,"@an0n666 

> And now the locking issue is gone! qBt loads fine and then the TRACKERS section is gradually being populated with errored torrents!
No lag or choppiness as well.

Did you double-check that the locking occurs without this patch even when using `http://examplexxx.com/announce` URLs? Just to check if this patch actually improves things and this wasn't just the URL issue all along."
689936882,13348,ghost,2020-09-10T02:32:32Z,"> @an0n666
> 
> > And now the locking issue is gone! qBt loads fine and then the TRACKERS section is gradually being populated with errored torrents!
> > No lag or choppiness as well.
> 
> Did you double-check that the locking occurs without this patch even when using `http://examplexxx.com/announce` URLs? Just to check if this patch actually improves things and this wasn't just the URL issue all along.

Checked 3 times. The patch actually doesn't improve anything.
Locking issue is gone when /announce is appended to URLs."
689938436,13348,ghost,2020-09-10T02:37:21Z,"There's the white loading UI for 10-15 seconds in this build with /announce appended.
https://github.com/qbittorrent/qBittorrent/issues/12825#issuecomment-670215379
Without /announce the lock extends to 2 mins 30 seconds.

On this build https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-689880634
The UI loads within 2-3 seconds and remains non responsive for another 5-10 seconds till session gets restored with /announce appended.
Without /announce the locking issue appears and the lock extends for 2 mins 40 seconds."
690040810,13348,xavier2k6,2020-09-10T07:15:57Z,"@an0n666 are you testing with ""qBittorrent defaults""?

For testing purposes:
Have you tried changing async i/o from 4 -> 8
process memory priority below normal -> normal"
690091147,13348,arvidn,2020-09-10T08:50:56Z,"has anyone profiled the process during the time of lag/stall/choppiness?
I would think the most important thing to understand is what the various threads are doing and/or waiting for.
libtorrent itself doesn't treat tracker URLs that end with `/announce` any differently than any other URL (except that trackers whose URL does *not* end with `/announce` cannot be scraped). Perhaps the trackers send different responses that are quicker to handle when you change the URLs. The best way to know is to profile the problematic case I'd say.

Perhaps a full alert log might help too, but it would still be trying to deduce the cause from bits and pieces, rather than actually looking at the cause of the lag in a profiler."
690188548,13348,FranciscoPombal,2020-09-10T11:28:53Z,"@an0n666 to get the full alert log, you probably want to attempt to reproduce this with `client_test`. It would be interesting to see how this problem manifests itself with `client_test` I suppose what we are looking for here is `scrape_reply_alert` and `scrape_failed_alert`.

@arvidn 

> libtorrent itself doesn't treat tracker URLs that end with `/announce` any differently than any other URL (except that trackers whose URL does not end with `/announce` cannot be scraped)

qBittorrent will end up trying to scrape those URLs due to the auto scrape interval configuration, configured here:

https://github.com/qbittorrent/qBittorrent/blob/defdd5121c940dfc3b807401338e15f66adfd671/src/base/bittorrent/session.cpp#L1033

The results are processed here:

https://github.com/qbittorrent/qBittorrent/blob/defdd5121c940dfc3b807401338e15f66adfd671/src/base/bittorrent/trackerentry.cpp#L89

Would that be the problem? These URLs (`http://examplexxx.com`) cannot be scraped."
690199798,13348,arvidn,2020-09-10T11:36:49Z,"scrape attempts for HTTP trackers whose URL does not end with `/announce` will just fail immediately, here: https://github.com/arvidn/libtorrent/blob/RC_1_2/src/http_tracker_connection.cpp#L78"
690231511,13348,ghost,2020-09-10T12:08:50Z,"One difference that I forgot to mention between /announce and w/o /announce case. 
When the lock ends with the latter, the errored tracker torrent count shows 5000, meaning all had finished announcing and the lock was released. 
While with the former, there’s no UI lock and the errored tracker count gradually increases. 
I’ll try to reproduce this on ubuntu with a build having debug symbols then get a stack trace if I get time. "
690284584,13348,glassez,2020-09-10T13:21:30Z,"@an0n666, are all 5000+ mentioned torrents that you use in tests really running (i.e. started in non-paused state)?
>It took 2 mins and 29 seconds with 10 non-working trackers.

IIRC, all your torrents have the same 10 trackers. Am I right?"
690286359,13348,ghost,2020-09-10T13:24:14Z,"> @an0n666, are all 5000+ mentioned torrents that you use in tests really running (i.e. started in non-paused state)?

Yes. Running in downloading state(stalled). "
690287836,13348,ghost,2020-09-10T13:26:42Z,"> > It took 2 mins and 29 seconds with 10 non-working trackers.
> 
> IIRC, all your torrents have the same 10 trackers. Am I right?

Yes same 10 http trackers without the /announce part in their URL. "
690291061,13348,glassez,2020-09-10T13:31:48Z,"@an0n666
Can you measure it under the following conditions:
1. All 5000 torrents are paused
2. One from 5000 is running (all others are paused)
3. 10 from 5000 are running"
690296947,13348,xavier2k6,2020-09-10T13:41:36Z,"> @an0n666
> Can you measure it under the following conditions:
> 
> 1. All 5000 torrents are paused
> 2. One from 5000 is running (all others are paused)
> 3. 10 from 5000 are running

@glassez do you want me to provide a build with latest commit `ecf8c37` for this or previous build with `2e6236e` is ok?"
690321158,13348,ghost,2020-09-10T14:19:45Z,"> @an0n666
> Can you measure it under the following conditions:
> 
> 1. All 5000 torrents are paused
> 2. One from 5000 is running (all others are paused)
> 3. 10 from 5000 are running

1. 10 seconds white UI followed by empty transfer list followed by session restored on 17th second. No lag/choppiness afterwards.
2. Same as number 1.
3. Same as number 1.
4. I ran another test with 500 torrents running. This time 10 seconds white UI followed by empty transfer list followed by session restored on 22nd second. No lag/choppiness afterwards.

Ran the same test with torrents with /announce appended to tracker.
1. 10 seconds white UI followed by empty transfer list followed by session restored on 17th second. No lag/choppiness afterwards.
2. Same as number 1.
3. Same as number 1.
4. Same as number 1.

I have found more interesting thing:
With /announce appended, libtorrent announces to each tracker in a loop, that is it moves to the next tracker once the upper one fails.
Capture with /announce appended URL : https://gyazo.com/b1aa352b233fd07ed36067b4ed21f59b

But without /announce appended, it announces to all trackers at once...skipping the looping. I think this generates 5000*10 = 50000 alerts at once per endpoint. And this is causing the locking issue.
Capture without /announce : https://gyazo.com/d5c1c6ed78b906e4644056bb7b4e840c

"
690324157,13348,ghost,2020-09-10T14:24:27Z,I don’t know why the looping is getting skipped for trackers without /announce. Is qbt asking libtorrent to scrape those trackers and hence it’s failing immediately and generating a ton of alerts at once?
690325357,13348,glassez,2020-09-10T14:26:19Z,">@glassez do you want me to provide a build with latest commit ecf8c37 for this or previous build with 2e6236e is ok?

Previous build is OK for this job to compare with previously obtained results.

But you can provide build with the latest changes too. It contains new improvements, but in a slightly different area. Although my results do not significantly affect the original problem, I still decided not to lose them, but to continue improving the session initialization (I mean application level Session) and interactions GUI with it."
690327655,13348,FranciscoPombal,2020-09-10T14:29:41Z,"@an0n666 

I wonder how/if the tracker tiers affect this. Would you mind testing with different combinations of those settings (e.g. always announce to all tiers/always announce to all trackers in a tier)? If possible, with torrents that are generated with trackers in different tiers (so far, all your tests have been with torrents that all have every tracer in the same tier).

Meanwhile I'm trying to profile with callgrind, but it's taking a while."
690331322,13348,ghost,2020-09-10T14:35:19Z,I need a build which can log tracker announces and if it was a announce or scrape request. Anyone?
690342556,13348,xavier2k6,2020-09-10T14:52:01Z,">But you can provide build with the latest changes too. It contains new improvements, but in a slightly different area. Although my results do not significantly affect the original problem, I still decided not to lose them, but to continue improving the session initialization (I mean application level Session) and interactions GUI with it.

Ok, will provide a build with latest commit `ecf8c37` 

>I need a build which can log tracker announces and if it was a announce or scrape request.

If I could be pointed in the right direction of what needs to be done/edited etc will give it a lash.

I may also provide (time depending) a build with latest master/libtorrent commits for reference also....."
690344635,13348,ghost,2020-09-10T14:54:48Z,"<s>Ok the build with announce logging might not be required.</s> (logging can confirm this)

I checked with wireshark.
No announce requests are being made when trackers don't have /announce in their URL.
They just outright fail. Which is either contradictory to this statement(https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-690199798) or qBt is actually asking for scrape request instead of announcing? "
690360124,13348,ghost,2020-09-10T15:18:10Z,"@arvidn 
I tested with client_test program.
Here's the log. I'm including only the endpoint which has internet.

[Sep 10 21:10:37] file3493.bin (http://example.com/announce)[192.168.2.100:6881] sending announce (started)
[Sep 10 21:10:37] file3493.bin (http://example.com/announce)[192.168.2.100:6881] 404 Not Found ""Not Found"" (2)

[Sep 10 21:13:28] file3493.bin (http://example.com)[192.168.2.100:6881] sending announce (started)
[Sep 10 21:13:28] file3493.bin (http://example.com)[192.168.2.100:6881] No such host is known """" (1)
"
690535862,13348,FranciscoPombal,2020-09-10T17:25:31Z,"I just tested a bit (without this PR) on Linux with 5000 torrents (10 trackers each, on tier 0, of the form `http://example{0,9}.com`). It takes about 30~40 seconds to add them all before the UI becomes responsive. After closing qBittorrent and starting it again without pausing the torrents, startup takes once again the same amount of time.

I'll post the callgrind profiles later."
690663574,13348,arvidn,2020-09-10T19:28:58Z,"here's a theory: When a tracker fails to scrape for this reason, it fails immediately without delay and post the response back to the main network thread, which then will immediately (without delay) issue a scrape request for the next tracker in the list. If all trackers fail like this, all these messages back and forth will probably saturate the network thread for some time, not letting much else happen. Until all 50000 trackers have failed.

If qBittorrent has issued a blocking call into libtorrent, it may take a while for it to come back.

I can think of to things I can do to mitigate this:

1. insert a delay after a scrape request fails for this reason, before reporting the error. 1 second should be enough.
2. move the check earlier, to avoid issuing the scrape request to begin with, when it cannot be made. This would be a bit of a layer violation, since this is specific to HTTP trackers."
690676964,13348,xavier2k6,2020-09-10T19:43:40Z,"@arvidn would `max_concurrent_http_announces` play any part in this?

That option was recently added/merged to master but is not a part of this ticket/commit so is not exposed in qBittorrent's advanced settings?!

@glassez should you rebase etc to include https://github.com/qbittorrent/qBittorrent/pull/13319?"
690794298,13348,FranciscoPombal,2020-09-11T00:03:07Z,"Here are the results of the profiling runs with callgrind. The first one is actually a pure tar.zstd archive, despite its extension (GitHub made me do it) - decompress it with `tar --zstd -xvf <file>`, if you have a modern `tar` version, or decompress it first with `zstd` and then with `tar`.

[capture1_adding.tar.zstd.zip](https://github.com/qbittorrent/qBittorrent/files/5205181/capture1_adding.tar.zstd.zip)
[capture2_loading.zip](https://github.com/qbittorrent/qBittorrent/files/5205151/capture2_loading.zip)

capture1 - profile when adding the 5000 torrents. I stopped it midway through, so the last captures are of the program exiting.
capture2 - profile when starting qBittorrent with 5000 torrents previously added. I stopped it midway through because I realized it was becoming basically the same as capture1."
690795347,13348,ghost,2020-09-11T00:06:23Z,"@arvidn 
Why does the announce fail with ‘No such host is known """" (1)‘ when /announce is missing?
Was that a scrape request or announce? The log says announce though.

Also I think similar situation can happen with announce as well when a user has a lot of bad trackers in their list which do not resolve to any hostnames. I think all alerts should post with some sane delays in between. Or the looping should have some delay before jumping to the next tracker. "
690975105,13348,arvidn,2020-09-11T09:13:32Z,"> Why does the announce fail with ‘No such host is known """" (1)‘ when /announce is missing?

Good question. I take it the host *is* known, right? Perhaps there's a bug in the parsing of the URL, where the hostname becomes truncated or something. What are the URLs that work and don't work?"
690976779,13348,ghost,2020-09-11T09:17:01Z,"This works: http://example.com/announce
This doesn’t: http://example.com

Accessible through browser. Nslookup returns valid host. "
691013215,13348,glassez,2020-09-11T10:22:47Z,">@glassez should you rebase etc to include #13319?

This PR is on top of current master."
691018076,13348,glassez,2020-09-11T10:35:08Z,"@arvidn
How libtorrent behaves in the case that a lot of torrents have the same tracker? It just executes requests for each torrent independently? It doesn't have any intelligent mechanism for detecting unavailable trackers so that you don't need to access them anymore? Well, for example, do not execute requests to the same tracker if there are already several running ones (e.g. 3 or 5). If previous requests consistently return the same network error code, then do not make any more requests to this tracker (for some time), and immediately return an error to all other torrents (the same one returned by completed requests)."
691070956,13348,FranciscoPombal,2020-09-11T12:40:50Z,"Interestingly, I found that almost all/all of the `example{0,9}.com` domains are actually valid as well, not just `example.com`."
691188375,13348,xavier2k6,2020-09-11T16:17:47Z,"> > @glassez should you rebase etc to include #13319?
> 
> This PR is on top of current master.

![qBittorrent comparison](https://user-images.githubusercontent.com/42386382/92948409-3bbd2000-f451-11ea-92b4-0b8c11fb62ce.png)

Left side is `latest master commit: defdd51`  which has both https://github.com/qbittorrent/qBittorrent/pull/13319 & https://github.com/qbittorrent/qBittorrent/pull/13257 exposed in advanced settings

right side is `improve-startup commit: 8bfe4a5`

@glassez Am I doing something wrong??

I build from master by downloading zip from `https://codeload.github.com/qbittorrent/qBittorrent/zip/master`

I build from yours by downloading zip from `https://codeload.github.com/glassez/qBittorrent/zip/improve-startup`"
691198703,13348,FranciscoPombal,2020-09-11T16:39:32Z,"@xavier2k6 It seems this PR is not yet rebased on a recent enough master commit that includes #13319 and #13257.

You can rebase it yourself locally...

```
git clone https://github.com/qbittorrent/qBittorrent.git
cd qbittorrent
git remote add glassez_fork https://github.com/glassez/qbittorrent.git
git checkout glassez_fork/improve_startup -b improve_startup
git rebase origin/master
```

... and compile that."
691203531,13348,glassez,2020-09-11T16:50:02Z,">@glassez Am I doing something wrong??

Sorry, maybe I forgot to push it... I'll recheck it tomorrow."
691476746,13348,ghost,2020-09-12T11:54:34Z,"> @arvidn
> How libtorrent behaves in the case that a lot of torrents have the same tracker? It just executes requests for each torrent independently? It doesn't have any intelligent mechanism for detecting unavailable trackers so that you don't need to access them anymore? Well, for example, do not execute requests to the same tracker if there are already several running ones (e.g. 3 or 5). If previous requests consistently return the same network error code, then do not make any more requests to this tracker (for some time), and immediately return an error to all other torrents (the same one returned by completed requests).

And instead of posting thousands of alerts, the status could just be polled on a regular interval for a set amount of torrents. When I was testing with client test i saw alerts being posted from 6 endpoints and only one had internet. All the other alerts are just wastage of CPU resources. "
691478797,13348,arvidn,2020-09-12T12:14:02Z,"> And instead of posting thousands of alerts, the status could just be polled on a regular interval for a set amount of torrents. When I was testing with client test i saw alerts being posted from 6 endpoints and only one had internet. All the other alerts are just wastage of CPU resources.

They're only wasted if you're not interested in them. And alerts are really cheap too, so I'm not too worried about it. Or do you experience an alert using significant CPU?

It's been a while since I looked at it, but libtorrent handles them [quite efficiently](https://blog.libtorrent.org/2015/04/libtorrent-alert-queue/)."
691479070,13348,arvidn,2020-09-12T12:16:06Z,"> How libtorrent behaves in the case that a lot of torrents have the same tracker? It just executes requests for each torrent independently?

Yes.

> It doesn't have any intelligent mechanism for detecting unavailable trackers so that you don't need to access them anymore? Well, for example, do not execute requests to the same tracker if there are already several running ones (e.g. 3 or 5).

Right, there's no logic like that. What I would like to do, at some point, is to coalesce announces to the same tracker by pipelining the requests over the same connection."
691481886,13348,ghost,2020-09-12T12:40:11Z,"Alerts are cheap but client seems to use a lot of CPU when processing lot of them at once. Maybe the client side has room for improvements. 

> Right, there's no logic like that. What I would like to do, at some point, is to coalesce announces to the same tracker by pipelining the requests over the same connection.
>

HTTP/3 sounds promising. "
691645685,13348,xavier2k6,2020-09-13T09:38:47Z,@glassez I'm going to provide a build later for @an0n666 using your latest commit `e3040a5` & libtorrent latest commit `bc38d29` if you don't have any other commits to push before hand?
691646500,13348,glassez,2020-09-13T09:43:30Z,">if you don't have any other commits to push before hand

There will be no changes here in the near future (at least until tomorrow)."
691659316,13348,ghost,2020-09-13T11:28:37Z,"@xavier2k6 
Please provide the build after this gets closed https://github.com/arvidn/libtorrent/issues/5135"
691660600,13348,glassez,2020-09-13T11:41:42Z,">Alerts are cheap but client seems to use a lot of CPU when processing lot of them at once. Maybe the client side has room for improvements.

Indeed, we don't have any optimizations there. If  qBittorrent receives a lot of alerts at a time, their processing may permanently interrupt the processing of other events, including window system events, etc., which leads to GUI freezes. I'll try to improve it."
691750235,13348,FranciscoPombal,2020-09-14T00:32:09Z,@an0n666 How did https://github.com/arvidn/libtorrent/pull/5142 impact the startup time/difference in announce behavior with/without `/announce` for you?
691751611,13348,ghost,2020-09-14T00:40:02Z,"> @an0n666 How did [arvidn/libtorrent#5142](https://github.com/arvidn/libtorrent/pull/5142) impact the startup time/difference in announce behavior with/without `/announce` for you?

<s>https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-689938436</s>

<s>Anyways</s> That issue has been resolved. Anyone interested in providing a Windows build can go ahead now.

@FranciscoPombal 
Edit: If you asked how the patch impacted the startup behaviour, then I haven't tested that yet. I need a Windows build.
As for the announce behaviour they're same now in case of /announce or without."
691755501,13348,FranciscoPombal,2020-09-14T01:00:07Z,"> Edit: If you asked how the patch impacted the startup behaviour, then I haven't tested that yet. I need a Windows build.

@xavier2k6 ping, if you don't mind."
692066246,13348,ghost,2020-09-14T13:51:00Z,"Tested on ubuntu with 5000 torrents with qBt master and latest RC_1_2 libtorrent
It took 13 seconds to load torrents. No extended UI locks or choppiness afterwards.
I think that posting of too many alerts at once due to that libtorrent bug was indeed the issue."
692082988,13348,xavier2k6,2020-09-14T14:17:48Z,"Will have a windows build in a few hours, not in front of my pc atm."
692140432,13348,FranciscoPombal,2020-09-14T15:39:05Z,"@an0n666 

> Tested on ubuntu with 5000 torrents with qBt master and latest RC_1_2 libtorrent
> It took 13 seconds to load torrents. No extended UI locks or choppiness afterwards.
> I think that posting of too many alerts at once due to that libtorrent bug was indeed the issue.

With both trackers ending in `/announce` and ones that don't?"
692307957,13348,xavier2k6,2020-09-14T20:53:01Z,"@an0n666 

Windows test build of 4.3.0(Alpha1) with listed libraries:
```
qBittorrent (PR #13348) | 4.3.0 e3040a5 (Sep 11, 2020)
libtorrent-rasterbar | 1.2.10.0 +git a9ae3c8 (Sep 13, 2020)
Qt                   | 5.15.1
OpenSSL              | 1.1.1g
zlib                 | 1.2.11
Boost                | 1.74
```

[Download Link](https://www.dropbox.com/s/96jcwosyybq763z/qbittorrent%20e3040a5%20pr%20%2313348%20libtorrent%20a9ae3c8%20qt5.15.1%20boost%201.74.zip?dl=1)"
692384245,13348,ghost,2020-09-15T00:13:50Z,"> @an0n666
> 
> Windows test build of 4.3.0(Alpha1) with listed libraries:
> 
> ```
> qBittorrent (PR #13348) | 4.3.0 e3040a5 (Sep 11, 2020)
> libtorrent-rasterbar | 1.2.10.0 +git a9ae3c8 (Sep 13, 2020)
> Qt                   | 5.15.1
> OpenSSL              | 1.1.1g
> zlib                 | 1.2.11
> Boost                | 1.74
> ```
> 
> [Download Link](https://www.dropbox.com/s/96jcwosyybq763z/qbittorrent%20e3040a5%20pr%20%2313348%20libtorrent%20a9ae3c8%20qt5.15.1%20boost%201.74.zip?dl=1)

GUI becomes responsive within 8 seconds with or without /announce in URL.

So that locking issue is gone completely. 

However, the GUI is still locked for 8 seconds which I believe is due to processing of add_torrent_alert and patches like these don't help much in such cases."
692385622,13348,FranciscoPombal,2020-09-15T00:18:24Z,"@an0n666 Thanks for confirming, that's still a massive improvement just from that libtorrent fix."
692388662,13348,FranciscoPombal,2020-09-15T00:28:40Z,"ping @ned-martin, you might be interested in trying this build: https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-692384245."
692685808,13348,ghost,2020-09-15T12:36:18Z,"The main issue is probably elsewhere. Most likely a blocking call to the network thread. 
Because, when there’s a lot of transfer going on, and you try to open qBt from tray, it produces that white UI. Has anyone looked into the captures provided by @FranciscoPombal ?"
692905765,13348,FranciscoPombal,2020-09-15T18:49:28Z,"@an0n666 Those captures are probably not that useful now, because they were made with a version that did not include that fix from libtorrent and thus the effects from the variable that we care about now are not as isolated as they could be. I'll try to make some new ones soon."
696631988,13348,xavier2k6,2020-09-22T10:16:48Z,"@glassez did you touch any of the code related to **CATEGORIES**?

The reason I ask is that I'm seeing the ~**8**sec delay before all my (384) torrents show up in ""GUI""

In **CATEGORIES** under 4.2.5 portable version with **0** torrents added (Everything is OK):

![4 2 5 categories](https://user-images.githubusercontent.com/42386382/93869417-ad079900-fcc3-11ea-9f44-c7be7651e33b.png)

In **CATEGORIES** under 4.3.0 portable version using commit `e3040a5` with **0** torrents added (ALL & Uncategorized is missing):

![4 3 0 categories](https://user-images.githubusercontent.com/42386382/93869560-daecdd80-fcc3-11ea-945a-c8ebc9eb043a.png)


Also if I add a new category (**Now you see me added here**)with 4.3.0 `e3040a5` under portable mode it will show being added under **CATEGORIES** but upon closing qBittorrent & re-opening the newly created category is no longer visible.
If I try to add the same named category - there's a popup dialog box saying the category name already exists....

![visible](https://user-images.githubusercontent.com/42386382/93870678-7b8fcd00-fcc5-11ea-946d-c45d966299c0.png)

![not visible](https://user-images.githubusercontent.com/42386382/93870689-7df22700-fcc5-11ea-8f45-3ff8bf7472d1.png)
"
696640385,13348,xavier2k6,2020-09-22T10:36:08Z,"### Can also confirm #13394 (when adding a torrent causes a crash)

qBittorrent has crashed
Please file a bug report at http://bugs.qbittorrent.org and provide the following information:





qBittorrent version: v4.3.0alpha1 (64-bit)
Libtorrent version: 1.2.10.0
Qt version: 5.15.1
Boost version: 1.74.0
OpenSSL version: 1.1.1g
zlib version: 1.2.11
OS version: Windows 10 Version 2004 10.0.19041 x86_64

Caught signal: SIGSEGV
```
#  0 qbittorrent.exe      0x00007ff7c11c3c6b straceWin::getBacktrace()[ app\stacktrace_win.h : 213 ]
#  1 qbittorrent.exe      0x00007ff7c11c59c5 sigAbnormalHandler(signum)[ app\main.cpp : 344 ]
#  2 qbittorrent.exe      0x00007ff7c21c3d0e _seh_filter_exe(xcptnum, pxcptinfoptrs)[ minkernel\crts\ucrt\src\appcrt\misc\exception_filter.cpp : 215 ]
#  3 qbittorrent.exe      0x00007ff7c2254492 `__scrt_common_main_seh'::`1'::filt$0()[ D:\agent\_work\9\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl : 304 ]
#  4 qbittorrent.exe      0x00007ff7c21a5ec8 __C_specific_handler(ExceptionRecord, EstablisherFrame, ContextRecord, DispatcherContext)[ D:\agent\_work\9\s\src\vctools\crt\vcruntime\src\eh\riscchandler.cpp : 277 ]
#  5 ntdll.dll            0x00007ffa31cf111f _chkstk()
#  6 ntdll.dll            0x00007ffa31c9b474 RtlRaiseException()
#  7 ntdll.dll            0x00007ffa31cefc4e KiUserExceptionDispatcher()
#  8 qbittorrent.exe      0x00007ff7c12c3e3a CategoryFilterModel::torrentAdded(torrent)[ gui\categoryfiltermodel.cpp : 334 ]
#  9 qbittorrent.exe      0x00007ff7c1ef5fdf doActivate(sender, signal_index, argv)[ C:\QBITTORRENT\qt-everywhere-src-5.15.1\qtbase\src\corelib\kernel\qobject.cpp : 3886 ]
# 10 qbittorrent.exe      0x00007ff7c1422e24 BitTorrent::Session::torrentAdded(_t1)[ release\moc_session.cpp : 770 ]
# 11 qbittorrent.exe      0x00007ff7c11fb618 BitTorrent::Session::createTorrentHandle(status, params, params, params, params)[ base\bittorrent\session.cpp : 4351 ]
# 12 qbittorrent.exe      0x00007ff7c11ff8f0 BitTorrent::Session::handleStateUpdateAlert(p)[ base\bittorrent\session.cpp : 4721 ]
# 13 qbittorrent.exe      0x00007ff7c11fa85c BitTorrent::Session::handleAlert(a, a)[ base\bittorrent\session.cpp : 4221 ]
# 14 qbittorrent.exe      0x00007ff7c11fa76b BitTorrent::Session::readAlerts()[ base\bittorrent\session.cpp : 4198 ]
# 15 qbittorrent.exe      0x00007ff7c1eed53c QMetaCallEvent::placeMetaCall(object)[ C:\QBITTORRENT\qt-everywhere-src-5.15.1\qtbase\src\corelib\kernel\qobject.cpp : 615 ]
# 16 qbittorrent.exe      0x00007ff7c1eee140 QObject::event(e)[ C:\QBITTORRENT\qt-everywhere-src-5.15.1\qtbase\src\corelib\kernel\qobject.cpp : 1314 ]
# 17 qbittorrent.exe      0x00007ff7c189540d QApplicationPrivate::notify_helper(receiver, e)[ C:\QBITTORRENT\qt-everywhere-src-5.15.1\qtbase\src\widgets\kernel\qapplication.cpp : 3630 ]
# 18 qbittorrent.exe      0x00007ff7c189499e QApplication::notify(receiver, e, e)[ C:\QBITTORRENT\qt-everywhere-src-5.15.1\qtbase\src\widgets\kernel\qapplication.cpp : 3584 ]
# 19 qbittorrent.exe      0x00007ff7c1efd8e0 QCoreApplication::notifyInternal2(receiver, event)[ C:\QBITTORRENT\qt-everywhere-src-5.15.1\qtbase\src\corelib\kernel\qcoreapplication.cpp : 1063 ]
# 20 qbittorrent.exe      0x00007ff7c1efe52a QCoreApplicationPrivate::sendPostedEvents(receiver, event_type, data)[ C:\QBITTORRENT\qt-everywhere-src-5.15.1\qtbase\src\corelib\kernel\qcoreapplication.cpp : 1817 ]
# 21 qbittorrent.exe      0x00007ff7c178e756 QWindowsGuiEventDispatcher::sendPostedEvents()[ C:\QBITTORRENT\qt-everywhere-src-5.15.1\qtbase\src\platformsupport\eventdispatchers\qwindowsguieventdispatcher.cpp : 80 ]
# 22 qbittorrent.exe      0x00007ff7c202f845 QEventDispatcherWin32::processEvents(flags)[ C:\QBITTORRENT\qt-everywhere-src-5.15.1\qtbase\src\corelib\kernel\qeventdispatcher_win.cpp : 528 ]
# 23 qbittorrent.exe      0x00007ff7c178e701 QWindowsGuiEventDispatcher::processEvents(flags)[ C:\QBITTORRENT\qt-everywhere-src-5.15.1\qtbase\src\platformsupport\eventdispatchers\qwindowsguieventdispatcher.cpp : 73 ]
# 24 qbittorrent.exe      0x00007ff7c20332f7 QEventLoop::exec(flags)[ C:\QBITTORRENT\qt-everywhere-src-5.15.1\qtbase\src\corelib\kernel\qeventloop.cpp : 232 ]
# 25 qbittorrent.exe      0x00007ff7c1efddcb QCoreApplication::exec()[ C:\QBITTORRENT\qt-everywhere-src-5.15.1\qtbase\src\corelib\kernel\qcoreapplication.cpp : 1371 ]
# 26 qbittorrent.exe      0x00007ff7c11b6347 Application::exec(params, params)[ app\application.cpp : 630 ]
# 27 qbittorrent.exe      0x00007ff7c11c570c main(argc, argv)[ app\main.cpp : 290 ]
# 28 qbittorrent.exe      0x00007ff7c2180a67 WinMain(__formal, __formal, __formal, __formal)[ C:\QBITTORRENT\qt-everywhere-src-5.15.1\qtbase\src\winmain\qtmain_win.cpp : 97 ]
# 29 qbittorrent.exe      0x00007ff7c2187a22 __scrt_common_main_seh()[ D:\agent\_work\9\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl : 288 ]
# 30 KERNEL32.DLL         0x00007ffa30986fd4 BaseThreadInitThunk()
# 31 ntdll.dll            0x00007ffa31c9cec1 RtlUserThreadStart()
```

However when you re-open qBittorrent after this crash the torrent shows added & all the categories that weren't visible when testing are now visible again.

![visible again after crash](https://user-images.githubusercontent.com/42386382/93872196-b5fa6980-fcc7-11ea-9286-807441423baf.png)
"
696644719,13348,glassez,2020-09-22T10:47:24Z,"@xavier2k6
Sorry, I just wanted to try out some ideas for speeding up the application launch. I didn't intend to worry about side effects until some idea was successful, so I could continue to implement it to the end.
Please do not use this PR for anything other than measuring startup time until it is no longer a Draft."
696645437,13348,glassez,2020-09-22T10:49:06Z,I'm working on another idea now. I intend to update this PR soon to test it.
696647948,13348,xavier2k6,2020-09-22T10:55:20Z,"> @xavier2k6
> Sorry, I just wanted to try out some ideas for speeding up the application launch. I didn't intend to worry about side effects until some idea was successful, so I could continue to implement it to the end.
> Please do not use this PR for anything other than measuring startup time until it is no longer a Draft.

no worries, I'm not using it for everyday use - just for testing purposes, reporting my findings here (since I had a bit of time to fiddle around with it etc.)"
696742768,13348,c0re100,2020-09-22T14:03:00Z,"> > @xavier2k6
> > Sorry, I just wanted to try out some ideas for speeding up the application launch. I didn't intend to worry about side effects until some idea was successful, so I could continue to implement it to the end.
> > Please do not use this PR for anything other than measuring startup time until it is no longer a Draft.
> 
> no worries, I'm not using it for everyday use - just for testing purposes, reporting my findings here (since I had a bit of time to fiddle around with it etc.)

[offtopic]
Can you test adding a torrent with current master branch?
Cause I don't have crash issue with boost 1.73"
696801438,13348,xavier2k6,2020-09-22T15:37:13Z,">[offtopic]
Can you test adding a torrent with current master branch?
Cause I don't have crash issue with boost 1.73

Are you using commit `e3040a5`?

Will do when I get a chance, have used `Boost 1.74` for building though of a few builds & haven't encountered any crashes.. except for this PR/using it's latest commit...

`qBittorrent 2e6236e PR #13348 libtorrent 6ed8872 Qt5.15.1 Boost 1.74` ""No crash!""

`qBittorrent 90b66ec PR #13348 libtorrent 6ed8872 Qt5.15.1 Boost 1.74` ""No crash!""

`qBittorrent e3040a5 PR #13348 libtorrent a9ae3c8 Qt5.15.1 Boost 1.74` ""crash!""

But i don't think it really matters much as it's still a `WIP` as glassez said so not really meant for mainstream/daily usage....

There will be other side-effects etc.."
696815844,13348,c0re100,2020-09-22T16:01:24Z,"> > [offtopic]
> > Can you test adding a torrent with current master branch?
> > Cause I don't have crash issue with boost 1.73
> 
> Are you using commit `e3040a5`?
> 
> Will do when I get a chance, have used `Boost 1.74` for building though of a few builds & haven't encountered any crashes.. except for this PR/using it's latest commit...
> 
> `qBittorrent 2e6236e PR #13348 libtorrent 6ed8872 Qt5.15.1 Boost 1.74` ""No crash!""
> 
> `qBittorrent 90b66ec PR #13348 libtorrent 6ed8872 Qt5.15.1 Boost 1.74` ""No crash!""
> 
> `qBittorrent e3040a5 PR #13348 libtorrent a9ae3c8 Qt5.15.1 Boost 1.74` ""crash!""
> 
> But i don't think it really matters much as it's still a `WIP` as glassez said so not really meant for mainstream/daily usage....
> 
> There will be other side-effects etc..

Yes, I'm using `e3040a5` and libtorrent `a9ae3c8`.
No crash with boost 1.73, but crash with boost 1.74."
696975849,13348,FranciscoPombal,2020-09-22T20:56:26Z,"@arvidn @an0n666 @glassez 

Alright, so I have tested qBittorrent 1a3091a980132627bedd6b2f88d427bae0947122 + libtorrent RC_1_2 `0fb476b0640e18ab24f8f64ffe9c1df424b7d355` (the latest commits at the time of writing, which include some important libtorrent patches that made it in to RC_1_2 since I last made the callgrind captures). The setup was the same as before: 5000 torrents with 10 example trackers each. Clean qBittorrent profile profile (all default settings), Ubuntu 18.04, boost 1.74, gcc 8.4.0, same machine.

First, I started the client with no torrents, and added them all. Within about 5 seconds, all torrents were added and started announcing. The announcing was pretty slow; we need either a bigger announce queue, more request batching, or both. However, the GUI was 100% responsive immediately following the addition of all torrents, so it's not so bad.

See this short video I recorded showing the slow announces; the video shows me scrolling through the transfer list and selecting a few different torrents a few minutes after having added them all. The announces seem to be made at a rate of about 10-15 per second (edit - at the beginning it's much faster), with a few pauses, presumably due to the queue getting saturated with ongoing responses from the slower sites (recall that some of the `example{0,9}.com` domains are actually real):

[output.mkv.zip](https://github.com/qbittorrent/qBittorrent/files/5263959/output.mkv.zip)

Then, after waiting for all announces to fail, I completely closed the client (which was pretty much instantaneous for the GUI, the qBittorrent process itself terminated after probably 1 or 2 seconds).

Finally, I opened the client again. At first, only the window frame was showing, but within less than 10 seconds, the whole UI showed and was immediately responsive. The announces started occurring at about the same speed as before. This leads me to believe that the announces are not blocking anything important anymore; those < 10 seconds were simply due to the GUI loading in the massive amount of torrents.

I guess this is good news. I didn't bother making a new callgrind capture, because it no longer seems relevant given the good results, but let me know if you still think it would be useful, and I'll get on it.

Maybe this patch isn't that needed after all, at least in its current form. But at least it helped uncover an important underlying issue with libtorrent that got resolved. Still, since there was a push recently, I'll try to benchmark it and see if it provides a measurable boost in performance.

@an0n666 
I haven't looked into the unresponsive UI after restoring from tray on Windows. Can you still reproduce? If so, can you describe in detail what you observe? For how long does the UI stay unresponsive?"
696979210,13348,xavier2k6,2020-09-22T21:02:29Z,@FranciscoPombal `867cf863f21747f2df7290df81a8d6a57a4d0992` is libtorrent **RC_2_0**??
696988081,13348,FranciscoPombal,2020-09-22T21:19:25Z,"@xavier2k6 my bad, I meant `0fb476b0640e18ab24f8f64ffe9c1df424b7d355`, fixed."
697014301,13348,FranciscoPombal,2020-09-22T22:24:35Z,"@glassez @arvidn 

Ok, I just tried the patch (latest commit, `687104f1b2eae8af04a1e4c5c463d08cf228b01e`), and the results were pretty interesting.

The GUI starts almost instantly and is immediately responsive, but the overall startup time has regressed massively, because the torrents take a long time to get added. Furthermore, they only start announcing once they've all finished being added. The announcing happens at approximately the same rate (very fast for a few seconds, then regresses to 10-15 per second on average). The display of the number of DHT nodes also seems to be blocked during the time the torrents are being added. See this video illustrating all this (also note the difference in performance when selecting a filter that displays an empty list vs. one with a lot of torrents; the rate of torrent addition is massively slower in the latter case):

[patch.mkv.zip](https://github.com/qbittorrent/qBittorrent/files/5264308/patch.mkv.zip)

Furthermore, I made 2 callgrind captures; one with the latest `master`, as in my post above, and one with the patch. I ran both times for about 7 minutes which, even with instruction dumping, and cache simulation OFF on the callgrind side and DHT (responsible for a lot of the cost!), PEX, and LSD OFF on the qBittorrent side, is still only long enough for about 100 or so torrents to be added, after which I sent SIGINT to the process. callgrind does make execution very slow :). Hopefully its analysis yields some nice insights; I haven't looked at it too closely yet.

[master_callgrind.zip](https://github.com/qbittorrent/qBittorrent/files/5264310/master_callgrind.zip)
[patch_callgrind.zip](https://github.com/qbittorrent/qBittorrent/files/5264311/patch_callgrind.zip)

Overall, I think the patch is still a regression, but perhaps it can become the way forward with more polish. Ideally, torrents would be added faster, and announces would occur asynchronously with torrents being added.

EDIT: also, I'm pleased to report that both with and without the patch, closing the client mid startup doesn't corrupt/delete the .fastresumes."
697134517,13348,glassez,2020-09-23T04:58:53Z,"Well, I recently pushed through new changes to test other ways to speed up qBittorrent launch. They include asynchronous reading of resume data files in a separate thread, as well as processing alerts one at a time.
You can test it in two ways: including and not including the last commit (@xavier2k6, can you provide 2 corresponding builds?) In the latter case, you can evaluate what asynchronous data reading does by itself.
Although the last commit makes the UI more responsive during the session loading process (it does in my tests, but in yours?), this process itself stretches over time. This demonstrates that having a large number of alerts when restoring a session is the root of the problem. But it seems that this is not due to the fact (not only) that we have to process a lot of alerts at a time, which leads to interrupting the main thread, but because it causes a lot of work in the GUI layer, which also leads to poor responsiveness.
My other experiments show that populating the GUI after the session is fully restored is significantly faster.

I still have limited testing capabilities, so I'm waiting for your results. I am particularly interested in your opinion on asynchronous reading of resume data files. Does it deserve to be merged on its own?"
697147357,13348,glassez,2020-09-23T05:46:18Z," >Furthermore, they only start announcing once they've all finished being added. 

Most likely, you just drew the wrong conclusions from your observations. Since the queue processing time for all initial alerts has increased, it may simply be displayed in the UI with a long delay. There are no changes affecting the announcement. It works exactly the same as in master, just provides/displays results in a different way."
697297865,13348,FranciscoPombal,2020-09-23T11:15:56Z,"@glassez 

> You can test it in two ways: including and not including the last commit (@xavier2k6, can you provide 2 corresponding builds?) In the latter case, you can evaluate what asynchronous data reading does by itself.

As noted in https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-697014301, my observations in the latest comments are in reference to the very latest commit (so, including all changes from it and the previous ones).

> Although the last commit makes the UI more responsive during the session loading process (it does in my tests, but in yours?), this process itself stretches over time. 

My observation was that the main improvement was GUI startup time. As stated previously, before the patch, the GUI takes more time to load on startup, but _after_ it actually loads, the responsiveness is comparable/the same as with the patch (at least I don't have the means of measuring a scientifically significant difference). The biggest downside of the patch is that it takes much longer to add all torrents (like you say, ""the process itself stretches over time""). Thus, all things considered, the startup time has regressed with the patch. Perhaps the alerts relating to torrent loading need to be batched instead of handled one at a time?

> This demonstrates that having a large number of alerts when restoring a session is the root of the problem. But it seems that this is not due to the fact (not only) that we have to process a lot of alerts at a time, which leads to interrupting the main thread, but because it causes a lot of work in the GUI layer, which also leads to poor responsiveness.

Yes, if you watch the video in https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-697014301, it clearly shows the impact that more GUI activity has on performance, when I switch between filters with no/all torrents.

> My other experiments show that populating the GUI after the session is fully restored is significantly faster.

Yes, this is what I observe without the patch as well (in current master).

> I still have limited testing capabilities, so I'm waiting for your results. I am particularly interested in your opinion on asynchronous reading of resume data files. Does it deserve to be merged on its own?

I explain my opinion about the behavior in current master and the latest version of this PR in my latest comments (https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-696975849 and https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-697014301, respectively), which include videos/callgrind captures that will probably be useful to you.

I can specifically test just the part about asynchronous load of fastresumes with nothing else (i.e., excluding the latest commit about handling alerts one at a time), but regardless of the effects on GUI startup time, if it amounts to (too much of) a regression in overall startup time, I won't be in favor or merging it.

> Most likely, you just drew the wrong conclusions from your observations. Since the queue processing time for all initial alerts has increased, it may simply be displayed in the UI with a long delay. There are no changes affecting the announcement. It works exactly the same as in master, just provides/displays results in a different way.

If certain parts of the GUI are not updating when they should, while other parts are clearly able to do so, that can be a problem. But my original hypothesis was that the tracker-related alerts simply happened to be placed at the end of the queue, after all alerts related to adding/loading torrents, hence the delay. Again, I encourage you to watch the videos I posted, to get a visual feel for what's happening."
697308829,13348,glassez,2020-09-23T11:41:33Z,">>My other experiments show that populating the GUI after the session is fully restored is significantly faster.
>>
>Yes, this is what I observe without the patch as well (in current master).

The master doesn't do what I mean. It still populates GUI by one torrent. It just doesn't give GUI time to draw all the changes. So it just hangs for a while, and then draws everything at once. However, I tested on a not very fast system. It may look different on modern machines."
697339137,13348,glassez,2020-09-23T12:43:13Z,"> I encourage you to watch the videos I posted, to get a visual feel for what's happening.

Well, I did it. The picture of my latest patch behavior repeats what I see in my tests (except that I use about 100 torrents in total). Can you provide corresponding videos for build without my latest commit and for the master build?"
697635722,13348,FranciscoPombal,2020-09-23T16:22:41Z,"@glassez 

> > I encourage you to watch the videos I posted, to get a visual feel for what's happening.
> 
> Well, I did it. The picture of my latest patch behavior repeats what I see in my tests (except that I use about 100 torrents in total). Can you provide corresponding videos for build without my latest commit and for the master build?

Here is a video of the patch without the latest commit (i.e., only the changes up to, and including `cf309d4b8fb485f675d3d0fb0b8f95de318b415b`, ""Start up torrents on session constructed""):

[patch_only_async_fastresume_load.mkv.zip](https://github.com/qbittorrent/qBittorrent/files/5269525/patch_only_async_fastresume_load.mkv.zip)

As you can see, it's halfway between `master` and the full patch:
- Like `master` it only takes about 10 seconds to load everything and become fully usable
- Like `master`, the GUI is completely unresponsive for those 10 seconds
- Unlike `master`, the window contents show up pretty much immediately.

As you can see from the video, it is quite clear that all the torrent loading is preventing the GUI from being responsive. Overall, I think this is the best of the 3 alternatives.

There is no need to make a video about `master`. As described before, it is exactly the same as this one, except during the 10 seconds it is unresponsive, you can only see the window frame, not its contents."
697707102,13348,glassez,2020-09-23T17:04:53Z,">Overall, I think this is the best of the 3 alternatives.

Well, let's wait to see what others have to say about their results. If it is confirmed, I will delete the last commit and submit the PR to the final review to be merged."
698364131,13348,xavier2k6,2020-09-24T14:00:53Z,"@glassez ~will upload builds later....~ ~4~ 6x Builds uploaded for testing...

1. [based on glassez:improve-startup latest commit](https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-698640672)
2. [based on glassez:improve-startup latest commit but has 10,000 test torrents included](https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-698640707)
3. [based on master latest commit](https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-698640738)
4. [based on master latest commit but has 10,000 test torrents included](https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-698640771)
5. [based on glassez:improve-startup previous commit](https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-698834144)
6. [based on glassez:improve-startup previous commit but has 10,000 test torrents included](https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-698834195)

**Builds:  2/4 & 6**

have these trackers:

```
http://example1.com
http://example2.com
http://example3.com
http://example4.com
http://example5.com
http://example6.com
http://example7.com
http://example8.com
http://example9.com
http://example10.com
http://example1.com/announce
http://example2.com/announce
http://example3.com/announce
http://example4.com/announce
http://example5.com/announce
http://example6.com/announce
http://example7.com/announce
http://example8.com/announce
http://example9.com/announce
http://example10.com/announce
```
 
latest libtorrent RC_1_2 commit used & OpenSSL 1.1.1**h**"
698640672,13348,xavier2k6,2020-09-24T23:36:09Z,"### Build 1 glassez:improve-startup
Windows test build of 4.3.0(Alpha1) with listed libraries:
```
qBittorrent (glassez:improve-startup)   | 4.3.0 687104f PR #13348 (Sep 22, 2020)
libtorrent-rasterbar | 1.2.10.0 +git ec04dcc (Sep 23, 2020)
Qt                   | 5.15.1
OpenSSL              | 1.1.1h
zlib                 | 1.2.11
Boost                | 1.74
```
[Download Link](https://www.dropbox.com/s/014kqd0boml6iry/qbittorrent%20687104f%20pr%20%2313348%20libtorrent%20ec04dcc%20qt5.15.1%20boost%201.74%20openssl%201.1.1h.zip?dl=1)"
698640707,13348,xavier2k6,2020-09-24T23:36:16Z,"### Build 2 glassez:improve-startup portable profile + 10,000 test torrents
Windows test build of 4.3.0(Alpha1) with listed libraries:
```
qBittorrent (glassez:improve-startup)   | 4.3.0 687104f PR #13348 (Sep 22, 2020)
libtorrent-rasterbar | 1.2.10.0 +git ec04dcc (Sep 23, 2020)
Qt                   | 5.15.1
OpenSSL              | 1.1.1h
zlib                 | 1.2.11
Boost                | 1.74
```
[Download Link](https://www.dropbox.com/s/8kv5syuavogm6rz/qbittorrent%20687104f%20pr%20%2313348%20libtorrent%20ec04dcc%20qt5.15.1%20boost%201.74%20openssl%201.1.1h%20%2B%2010%2C000%20test%20torrents.zip?dl=1)
"
698640738,13348,xavier2k6,2020-09-24T23:36:23Z,"### Build 3 qBittorrent master
Windows test build of 4.3.0(Alpha1) with listed libraries:
```
qBittorrent master   | 4.3.0 1a3091a9 (Sep 22, 2020)
libtorrent-rasterbar | 1.2.10.0 +git ec04dcc (Sep 23, 2020)
Qt                   | 5.15.1
OpenSSL              | 1.1.1h
zlib                 | 1.2.11
Boost                | 1.74
```
[Download Link](https://www.dropbox.com/s/3iu2vxmlufhclsp/qbittorrent%20master%201a3091a9%20libtorrent%20ec04dcc%20qt5.15.1%20boost%201.74%20openssl%201.1.1h.zip?dl=1)"
698640771,13348,xavier2k6,2020-09-24T23:36:30Z,"### Build 4 qBittorrent master portable profile + 10,000 test torrents
Windows test build of 4.3.0(Alpha1) with listed libraries:
```
qBittorrent master   | 4.3.0 1a3091a9 (Sep 22, 2020)
libtorrent-rasterbar | 1.2.10.0 +git ec04dcc (Sep 23, 2020)
Qt                   | 5.15.1
OpenSSL              | 1.1.1h
zlib                 | 1.2.11
Boost                | 1.74
```
[Download Link](https://www.dropbox.com/s/vmwyvdbqa5q3hhw/qbittorrent%20master%201a3091a9%20libtorrent%20ec04dcc%20qt5.15.1%20boost%201.74%20openssl%201.1.1h%20%2B%2010%2C000%20test%20torrents.zip?dl=1)"
698642683,13348,FranciscoPombal,2020-09-24T23:44:23Z,"@xavier2k6 very nice, thanks, but can you also please include a build with this PR except the latest commit? That is also relevant for testing: https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-697635722, https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-697707102"
698645212,13348,xavier2k6,2020-09-24T23:53:48Z,"> @xavier2k6 very nice, thanks, but can you also please include a build with this PR except the latest commit? That is also relevant for testing: [#13348 (comment)](https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-697635722), [#13348 (comment)](https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-697707102)

Can't any of the two of my previous builds not be used for reference??

https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-689880634 & https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-692307957"
698646285,13348,FranciscoPombal,2020-09-24T23:57:42Z,"@xavier2k6 

> Can't any of the two of my previous builds not be used for reference??

Don't get me wrong, they are also useful, but we're doing a 3-way comparison here. The last commit in this PR is a massive change in and of itself. As my comment above shows, there are massive differences between `master`, this PR without the last commit, and this PR with the last commit. As a matter of fact, I think the best version is actually that of this PR without the last commit."
698648516,13348,xavier2k6,2020-09-25T00:05:43Z,"ok, so a build based on `Start up torrents on session constructed`  commit`4fbaa8a`??"
698834144,13348,xavier2k6,2020-09-25T09:44:23Z,"### Build 5 glassez:improve-startup
Windows test build of 4.3.0(Alpha1) with listed libraries:
```
qBittorrent (glassez:improve-startup)   | 4.3.0 4fbaa8a PR #13348 (Sep 22, 2020)
libtorrent-rasterbar | 1.2.10.0 +git ec04dcc (Sep 23, 2020)
Qt                   | 5.15.1
OpenSSL              | 1.1.1h
zlib                 | 1.2.11
Boost                | 1.74
```
[Download Link](https://www.dropbox.com/s/2n592a9lk4vlshc/qbittorrent%204fbaa8a%20pr%20%2313348%20libtorrent%20ec04dcc%20qt5.15.1%20boost%201.74%20openssl%201.1.1h.zip?dl=1)"
698834195,13348,xavier2k6,2020-09-25T09:44:31Z,"### Build 6 glassez:improve-startup portable profile + 10,000 test torrents
Windows test build of 4.3.0(Alpha1) with listed libraries:
```
qBittorrent (glassez:improve-startup)   | 4.3.0 4fbaa8a PR #13348 (Sep 22, 2020)
libtorrent-rasterbar | 1.2.10.0 +git ec04dcc (Sep 23, 2020)
Qt                   | 5.15.1
OpenSSL              | 1.1.1h
zlib                 | 1.2.11
Boost                | 1.74
```
[Download Link](https://www.dropbox.com/s/3d94t3ioe5u9ly1/qbittorrent%204fbaa8a%20pr%20%2313348%20libtorrent%20ec04dcc%20qt5.15.1%20boost%201.74%20openssl%201.1.1h%20%2B%2010%2C000%20test%20torrents.zip?dl=1)"
698834451,13348,xavier2k6,2020-09-25T09:45:02Z,"> ok, so a build based on `Start up torrents on session constructed` commit`4fbaa8a`??

DONE, Build 5/6 uploaded."
698875056,13348,FranciscoPombal,2020-09-25T11:22:34Z,"@thalieht @Chocobo1 @an0n666 

Now that there are Windows builds available of the 3 relevant variants, if you are on Windows, please test and provide your feedback concerning https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-697635722 and https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-697707102."
698890824,13348,xavier2k6,2020-09-25T12:04:32Z,"> @thalieht @Chocobo1 @an0n666
> 
> Now that there are Windows builds available of the 3 relevant variants, if you are on Windows, please test and provide your feedback concerning [#13348 (comment)](https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-697635722) and [#13348 (comment)](https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-697707102).

For reference https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-698364131"
699112938,13348,thalieht,2020-09-25T19:27:54Z,"I tested all 3 commits with the 10000 torrents (thx @xavier2k6) i only looked at gui loading:
- master: white UI until everything is loaded, about 30 sec to load all 10000.
- commit before the last: UI loaded but i can't interact with it, occasional GUI update every few thousand torrents loaded (didn't measure time), about 30 sec to load all 10000.
- last commit: immediately responsive BUT overall time to load all 10000 was vastly increased, 57 sec to load the first 1000 while GUI is shown. If qBt is minimized to taskbar or tray the loading time is the same or comparable to the other 2 commits. While GUI was shown it seemed like it would randomly ""choke"" on loading torrents for a few seconds. Another thing to note is that the size of qBt window matters for torrent loading speed (smaller==faster).
The last thing to make me think that the last commit is a bad idea is that if i move another unrelated window back and forth across the screen while qBt GUI is shown, then the loading of torrents is retarded even more."
699154459,13348,xavier2k6,2020-09-25T21:04:14Z,"**Qt** is used for the **GUI** but should we compile/use it with **OpenGL**?? as far as I know that's not the current method, I believe it's **Direct 2D** and/or **DirectWrite**/**DirectWrite 2** (at least on windows - open to correction) - it may be better to use that as most pc's/laptops would be using on-board/integrated graphics??

Maybe it doesn't make a difference, thoughts??"
699167603,13348,FranciscoPombal,2020-09-25T21:36:52Z,"@thalieht 

Cool, pretty much the same results as me on Linux. Which one do you prefer? Like I said in https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-697635722, I prefer the ""intermediate"" patch. The regression in startup time depending on GUI usage is not acceptable for me. The ""full"" patch is not completely out of the question though, we can revisit in the future if we can make the GUI updates more efficient, but there is no guarantee right now that that will be possible - we might be running into Qt limitations here."
699186425,13348,xavier2k6,2020-09-25T22:24:40Z,"For me, I actually like the **latest patch** (but it needs a bit of tweaking/work) & may be dependent on other PR's https://github.com/qbittorrent/qBittorrent/pull/13263 perhaps?? or setting change......have either of you changed from the defaults to settings that you would normally use & also try disabling speedgraph in advanced settings/change transfer refresh interval to 2000ms?

Reason I would vote for the most recent patch (as progress/not regression)
- it loads instantly
- it's interactive
- user can see that the torrents are being loaded & are able to CTP.

**The white screen/not interactive/unresponsive is basically what we have now (user interpretation.....sluggish, it's hanging, it's crashed etc)**"
699202205,13348,thalieht,2020-09-25T23:00:08Z,">I prefer the ""intermediate"" patch. The regression in startup time depending on GUI usage is not acceptable for me. The ""full"" patch is not completely out of the question though, we can revisit in the future if we can make the GUI updates more efficient

👍 "
699217446,13348,FranciscoPombal,2020-09-25T23:35:00Z,"@xavier2k6 

>have either of you changed from the defaults to settings that you would normally use & also try disabling speedgraph in advanced settings/change transfer refresh interval to 2000ms?

Never tested that. Have you found any improvements by doing so?

> **The white screen/not interactive/unresponsive is basically what we have now (user interpretation.....sluggish, it's hanging, it's crashed etc)**

We can of course disagree about which one we like best, but I think this is a misrepresentation of the improvements the intermediate patch has over `master`. What we have _now_ (`master`) is no useful GUI display _at all_ when first loading. The intermediate patch, while not perfect (due to the interactivity issue), is a straight improvement over this. Additionally, if the user has enough torrents that the startup time becomes noticeable, the GUI still updates every several hundred/couple hundred torrents, so there is _some_ feedback about what is happening. Thus, the non-interactivity problem becomes less of an issue - the user will intuitively expect the client to become responsive after all torrents have loaded if there is some sort of progress indicator, no matter how infrequent. They will not think the program has crashed at least."
699432815,13348,ghost,2020-09-26T05:48:38Z,"Master loads fastest. Intermediate one provides no improvement in terms of responsiveness. So it’s kinda useless imo. 
Latest one is best in terms of responsiveness. It can be improved by processing more alerts at a time I guess. "
699439378,13348,arvidn,2020-09-26T06:34:18Z,"it seems to me that the ""last commit"" is the best path forward. I would suggest trying to not update the GUI *eagerly* but take some measures to batch it. I think a good way to think about batching is similar to Nagle's algorithm.

Something like this:

* Whenever there's a new torrent (or whatever event triggers a redraw of the GUI), post a message to the main message loop to trigger a redraw, and record in a `bool` that there is an outstanding redraw. If there is an outstanding redraw, skip posting a new message.
* In the handler of the message that's posted, clear the `bool` and issue the redraw of the GUI

Alternatively, the ""post"" could be timer to wait 100ms or so."
699439425,13348,glassez,2020-09-26T06:34:27Z,">Latest one is best in terms of responsiveness. It can be improved by processing more alerts at a time I guess.

I wonder if it can be made dependent on some timings? For example, process alerts until some time has elapsed (say 20 or 10 ms), and then postpone the remaining ones for the next time.
Anyway previous commits are prerequisites for the last one."
699440109,13348,glassez,2020-09-26T06:38:14Z,">Something like this:
Whenever there's a new torrent (or whatever event triggers a redraw of the GUI), post a message to the main message loop to trigger a redraw, and record in a bool that there is an outstanding redraw. If there is an outstanding redraw, skip posting a new message.
In the handler of the message that's posted, clear the bool and issue the redraw of the GUI

We can't directly depend on GUI here. Alerts are handled on lower level."
699442750,13348,Chocobo1,2020-09-26T06:52:44Z,">For example, process alerts until some time has elapsed (say 20 or 10 ms), and then postpone the remaining ones for the next time.

👍 If we aim to have 60 FPS, then each time slot for processing cannot take longer than 1/60 = 16.67 ms."
699442881,13348,jagannatharjun,2020-09-26T06:53:40Z,"I don't do ""big"" torrenting anymore, made my friend test it, He preferred one with the last commit, GUI loads instantly, 1-2 minute to load all of the torrents isn't big of a deal. unresponsive or lagging GUI is not a good experience for non-technical users. There may be more benefits in processing alerts lazily. Performance can be further tuned in the number of alerts processed at a time. Nice work though :)"
699445840,13348,glassez,2020-09-26T07:10:24Z,"Well, thank you for testing and feedback! I will continue in the same direction."
699457526,13348,xavier2k6,2020-09-26T08:19:43Z,"> > For example, process alerts until some time has elapsed (say 20 or 10 ms), and then postpone the remaining ones for the next time.
> 
> 👍 If we aim to have 60 FPS, then each time slot for processing cannot take longer than 1/60 = 16.67 ms.

@Chocobo1 would my https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-699154459 have any bearing on the redraw time?"
699462573,13348,Chocobo1,2020-09-26T08:50:19Z,">@Chocobo1 would my #13348 (comment) have any bearing on the redraw time?

I think you need some specific code to utilize other graphic libs and I doubt it will make any difference."
699465547,13348,xavier2k6,2020-09-26T09:05:54Z,"> > @Chocobo1 would my #13348 (comment) have any bearing on the redraw time?
> 
> I think you need some specific code to utilize other graphic libs and I doubt it will make any difference.

Ok, thanks for the clarification."
699466969,13348,glassez,2020-09-26T09:15:33Z,PR updated. Please test the latest changes.
699508280,13348,xavier2k6,2020-09-26T15:13:39Z,"@glassez I hope this is ok with you?!

- I have uploaded a build with the latest `Handle more alerts at once` `7701a0f` commit.
(Including numerous builds based on `Handle more alerts at once` `7701a0f` where I edited the line below each time for different values from original of `10`)

https://github.com/qbittorrent/qBittorrent/blob/7701a0fbd07b0ee7378e7eabdf06d5c4e9aab163/src/base/bittorrent/session.cpp#L4199

These are the values I used in the other builds:
```
    while (m_nextAlert != m_alerts.end() && !timer.hasExpired(100)) {
    while (m_nextAlert != m_alerts.end() && !timer.hasExpired(125)) {
    while (m_nextAlert != m_alerts.end() && !timer.hasExpired(150)) {
    while (m_nextAlert != m_alerts.end() && !timer.hasExpired(175)) {
    while (m_nextAlert != m_alerts.end() && !timer.hasExpired(200)) {
    while (m_nextAlert != m_alerts.end() && !timer.hasExpired(225)) {
    while (m_nextAlert != m_alerts.end() && !timer.hasExpired(250)) {
    while (m_nextAlert != m_alerts.end() && !timer.hasExpired(275)) {
    while (m_nextAlert != m_alerts.end() && !timer.hasExpired(300)) {
    while (m_nextAlert != m_alerts.end() && !timer.hasExpired(400)) {
    while (m_nextAlert != m_alerts.end() && !timer.hasExpired(500)) {
    while (m_nextAlert != m_alerts.end() && !timer.hasExpired(1000)) {
```

Windows test builds of 4.3.0(Alpha1) with listed libraries:
```
qBittorrent (glassez:improve-startup)   | 4.3.0 7701a0f PR #13348 (Sep 26, 2020)
libtorrent-rasterbar | 1.2.10.0 +git ec04dcc (Sep 23, 2020)
Qt                   | 5.15.1
OpenSSL              | 1.1.1h
zlib                 | 1.2.11
Boost                | 1.74
```

[Build with time-out set at 10ms - Original](https://www.dropbox.com/s/bqen5eskbpnwof8/10%20alerts%20original%20commit.zip?dl=1)

[Build with time-out set at 100ms](https://www.dropbox.com/s/1gmym14jrbd7xvc/100%20alerts.zip?dl=1)
[Build with time-out set at 125ms](https://www.dropbox.com/s/ijn53m74ini5wwr/125%20alerts.zip?dl=1)
[Build with time-out set at 150ms](https://www.dropbox.com/s/y3igcs4mp22jox1/150%20alerts.zip?dl=1)
[Build with time-out set at 175ms](https://www.dropbox.com/s/1zo40r0zgvudx5m/175%20alerts.zip?dl=1)
[Build with time-out set at 200ms](https://www.dropbox.com/s/n0mivd7uitt43qh/200%20alerts.zip?dl=1)
[Build with time-out set at 225ms](https://www.dropbox.com/s/zlsnrhz689juoqd/225%20alerts.zip?dl=1)
[Build with time-out set at 250ms](https://www.dropbox.com/s/9lyeat2gj5blsnw/250%20alerts.zip?dl=1)
[Build with time-out set at 275ms](https://www.dropbox.com/s/9x8vdgjd0vl0kxb/275%20alerts.zip?dl=1)
[Build with time-out set at 300ms](https://www.dropbox.com/s/oac2rj2frr24pus/300%20alerts.zip?dl=1)
[Build with time-out set at 400ms](https://www.dropbox.com/s/fa5i5odl1vogqr5/400%20alerts.zip?dl=1)
[Build with time-out set at 500ms](https://www.dropbox.com/s/j3qh4k805ltvvax/500%20alerts.zip?dl=1)
[Build with time-out set at 1000ms](https://www.dropbox.com/s/cm0tl01dqoz1p8u/1000%20alerts.zip?dl=1)


My own view:
`10` is a **no go**
`100` -> `300` are **viable** (depending on user hardware/consensus on default value etc)
`400` -> `1000` **not feasible currently**"
699522063,13348,glassez,2020-09-26T17:09:34Z,">10 is a no go
400 -> 1000 not feasible currently

Sorry, I can't clearly understand what did you mean.
>100 alerts, etc.

It's not about alerts count."
699522824,13348,jagannatharjun,2020-09-26T17:15:39Z,"I think he thought that in your latest commit, 
<pre><code>while (m_nextAlert != m_alerts.end() && !timer.hasExpired( <b>10</b> )) 
</code></pre>
10 meant total alerts processed in one batch and made different builds with different values like 100, 200, 300 etc. "
699525757,13348,xavier2k6,2020-09-26T17:40:04Z,"> I think he thought that in your latest commit,
> 
> ```
> while (m_nextAlert != m_alerts.end() && !timer.hasExpired( 10 )) 
> ```
> 
> 10 meant total alerts processed in one batch and made different builds with different values like 100, 200, 300 etc.

That is correct!"
699526000,13348,xavier2k6,2020-09-26T17:42:08Z,"> > 10 is a no go
> > 400 -> 1000 not feasible currently
> 
> Sorry, I can't clearly understand what did you mean.
> 
> > 100 alerts, etc.
> 
> It's not about alerts count.

apologies, ya I thought it was about alerts & how many were processed at a time or a time-out so changed values."
699526398,13348,FranciscoPombal,2020-09-26T17:45:25Z,"@xavier2k6 

> My own view:
> `10` is a **no go**
> `100` -> `300` are **viable** (depending on user hardware/consensus on default value etc)
> `400` -> `1000` **not feasible currently**

I assume you mean that `10` is too short, so not many alerts get processed at once, leading to slow startup time, while `400`-`1000` is too long, so many alerts get processed for too long causing the UI to freeze, right?"
699526499,13348,glassez,2020-09-26T17:46:14Z,"This is the timeout (in milliseconds), before the expiry of which we are continuously processed alerts."
699527680,13348,FranciscoPombal,2020-09-26T17:56:38Z,"@glassez 

> This is the timeout (in milliseconds), before the expiry of which we are continuously processed alerts.

Yes, I know, that's why I ask in https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-699526398 _why_ exactly are too short and too long intervals considered ""not feasible"" - whether because it ends up freezing or because the torrent loading is still too slow.

Furthermore, a more pertinent question arises - will it be possible to settle on a value that works for all/a vast majority of users (a ""one size fits all"" value)? The effects xavier2k6 is observing at 400-1000 milliseconds could be observed by a user at 250 in a less powerful machine, for example. It is very possible that the value we choose won't make anybody (or just a minority) happy. It will cause the loading to be too slow for some, but too unresponsive for others."
699533298,13348,xavier2k6,2020-09-26T18:45:30Z,"ok, I'll try to explain...

all builds start instantly.......show gui, are interactable, no white screen etc. (so it's safe to say we've overcome that issue)

since we clarified the values as ""time-outs""....

`10` is same/similar to the last commit  - it takes about 4mins to completely load/restore the very 1st to the final torrent.

`100` which I believe to be the sweet spot for me, at least takes 1min to load/restore the very 1st to the final torrent.
now if I do what _thaliet_ pointed out before & which I've observed myself previously is minimize on start-up & time it with stopwatch, maximize qBittorrent after 30secs (all torrents, yes I do mean ALL 10,000 are fully restored.)

as you go through the builds with the increased time-outs....there's not much difference in restoring torrents aka going from point a to point b in the time it takes 2mins/2mins 20/2mins 30 etc. but what you will find is that the GUI becomes less interactive/sluggish & the loading of torrents seem as if there stuck but will process...........just seems like there's a delay.....lag.

NOTE:
I will edit the download link builds from here https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-699508280 to show `Build with time-out set at X ms` instead of the current `10 alerts` etc."
699535399,13348,arvidn,2020-09-26T19:02:57Z,"if you're picking a number of milliseconds to delay before updating the GUI, or a number of alerts to process before updating the GUI; whichever number you pick, it will be too few for some and too high for others.

I really think it would be much better to approach this in a way that *adapts* to the load, to get the best of both worlds. Nagle's algorithm is an example of this. If there's just one alert, don't delay at all. While that first alert is ""outstanding"" (i.e. updating the GUI) new alerts should not trigger a GUI update until the first one is done.

That way, if you get single alerts, there's no delay. If you get a large number of them, the batching is based on the time it takes to complete one GUI update.

Now, I'm not very familiar with the details of QT, but perhaps this is tricky. Perhaps updating the GUI is synchronous and there's no way to receive more alerts while it's happening. There's one simple solution to this:

Instead of triggering the GUI update in the message handler, post a message to the queue (at the end of the queue, *after* all the alerts that you have to handle that are currently queued up). In that message handler you posted, that's where you trigger the GUI update.

Alternatively, if you call `pop_alerts()`, don't update the GUI until you've run the handlers for *all* alerts you got back from that call. That would also give you an adaptable batching of GUI updates.

This is basically the same thing I suggested earlier, which was explained to not be as simple as I made it out to be. Clearly I'm not familiar with the details of the internals, but I would encourage trying to come up with ways to have ""natural"" batching of updates."
699587591,13348,glassez,2020-09-27T05:21:39Z,">Alternatively, if you call pop_alerts(), don't update the GUI until you've run the handlers for all alerts you got back from that call. That would also give you an adaptable batching of GUI updates.

But this is how it works currently (in master). Processing a large number of alerts at a time interrupts the main thread for a long time, so GUI becomes freeze/unresponsive. We are trying to overcome it here."
699616592,13348,arvidn,2020-09-27T10:27:38Z,"> But this is how it works currently (in master). Processing a large number of alerts at a time interrupts the main thread for a long time, so GUI becomes freeze/unresponsive. We are trying to overcome it here.

I see. I got the impression it was the re-render of the GUI that took the most time"
699618708,13348,xavier2k6,2020-09-27T10:48:07Z,what is the `alert_queue_size` set to?
699632144,13348,ghost,2020-09-27T12:56:18Z,"> what is the `alert_queue_size` set to?

By default libtorrent sets it to 2000."
699635464,13348,glassez,2020-09-27T13:26:05Z,"> > what is the `alert_queue_size` set to?
> 
> By default libtorrent sets it to 2000.

AFAIK, it is redefined in qBittorrent. But why do you ask about it?"
699638160,13348,ghost,2020-09-27T13:50:02Z,"> > > what is the `alert_queue_size` set to?
> > 
> > 
> > By default libtorrent sets it to 2000.
> 
> AFAIK, it is redefined in qBittorrent. But why do you ask about it?

https://github.com/qbittorrent/qBittorrent/blob/2bfaa8229a8f3ed00eabaf60f7039c7be4d4de25/src/base/bittorrent/session.cpp#L1323"
699638646,13348,xavier2k6,2020-09-27T13:54:28Z,">AFAIK, it is redefined in qBittorrent. But why do you ask about it?

Just for myself to better understand the internals of the code & also if there was anything there that could've been tweaked."
699657237,13348,xavier2k6,2020-09-27T16:33:35Z,"memory priority was changed previously...could the same be done for I/O priority??

I'm using a program called [TaskExplorer v1.2.8](https://github.com/DavidXanatos/TaskExplorer) to change (increase) the `I/O priority` & it is making a positive difference in my testing...

[also for reference](https://stackoverflow.com/questions/301290/how-can-i-o-priority-of-a-process-be-increased)"
699869900,13348,glassez,2020-09-28T08:45:09Z,"Well, I don't see much excitement...
But what do you expect to get in the end? Best of all, it's GUI that doesn't hang, but has some responsiveness.
As you can see, the more responsive GUI you want to get at the start, the longer it takes to restore the session.

Personally, I don't like any of these options.
As I mentioned earlier, the best performance option is to populate GUI elements (transfer list etc.) once the session is fully restored. Up to this point, you can only show some ""lightweight"" progress indicator."
699956613,13348,ghost,2020-09-28T11:46:30Z,"> Well, I don't see much excitement...
> But what do you expect to get in the end? Best of all, it's GUI that doesn't hang, but has some responsiveness.
> As you can see, the more responsive GUI you want to get at the start, the longer it takes to restore the session.
> 
> Personally, I don't like any of these options.
> As I mentioned earlier, the best performance option is to populate GUI elements (transfer list etc.) once the session is fully restored. Up to this point, you can only show some ""lightweight"" progress indicator.

What about the cases where people have 100+ trackers per torrent in different tiers and all announce at once at startup? In such cases the GUI will take couple of minutes to load.
Specially when many trackers fail immediately due to a bad response from hostname lookups."
699976000,13348,glassez,2020-09-28T12:30:05Z,">What about the cases where people have 100+ trackers per torrent in different tiers and all announce at once at startup? In such cases the GUI will take couple of minutes to load.
Specially when many trackers fail immediately due to a bad response from hostname lookups.

If I understand correctly, your comment refers to my last suggestion to restore the session behind the scenes, displaying only the progress indicator, am I right?
But what essentially changes in this case? It just adds more work that you can't get away from. In any case, this work can be done much faster if it doesn't affect the GUI every step of the way.
The only alternative I can think of is to restore all torrents in a ""paused"" state, and then ""resume"" them when all are restored."
699980711,13348,ghost,2020-09-28T12:40:03Z,"> > What about the cases where people have 100+ trackers per torrent in different tiers and all announce at once at startup? In such cases the GUI will take couple of minutes to load.
> > Specially when many trackers fail immediately due to a bad response from hostname lookups.
> 
> If I understand correctly, your comment refers to my last suggestion to restore the session behind the scenes, displaying only the progress indicator, am I right?
> But what essentially changes in this case? It just adds more work that you can't get away from. In any case, this work can be done much faster if it doesn't affect the GUI every step of the way.
> The only alternative I can think of is to restore all torrents in a ""paused"" state, and then ""resume"" them when all are restored.

I mean process the initial tracker alerts behind the scene as well, not just restoring the session."
699982048,13348,arvidn,2020-09-28T12:42:43Z,"here's a crazy thought:

What if the session is paused on startup, all torrents are added, then the session is resumed. Perhaps that will mitigate an ""alert storm"" to some extent. Clearly the torrent_added alerts would still be posted."
699984799,13348,ghost,2020-09-28T12:48:19Z,"When the torrents are being resumed after restoring the session, they could be resumed in batches, to further reduce the rate of alerts. Otherwise the user may experience another lock after the session is <s>restored</s> resumed."
699985942,13348,glassez,2020-09-28T12:50:41Z,">here's a crazy thought:
>
>What if the session is paused on startup, all torrents are added, then the session is resumed. Perhaps that will mitigate an ""alert storm"" to some extent. Clearly the torrent_added alerts would still be posted.

It's not such a crazy idea. At least we're crazy the same way, since it also crossed my mind. But I haven't had time to study it in detail yet.
My initial attempts failed due to an ""assertion fauled"" error related to the tracker response, when trying to resume the session.
I also noticed that there is no way to create a session in a paused state, I have to manually call ""paused"" after it is created."
699987093,13348,glassez,2020-09-28T12:53:03Z,"> When the torrents are being resumed after restoring the session, they could be resumed in batches, to further reduce the rate of alerts. Otherwise the user may experience another lock after the session is restored resumed.

Don't forget that different alerts have different processing time.
Anyway we should investigate it to see how it works."
699989752,13348,glassez,2020-09-28T12:58:12Z,"In addition, I noticed that tracker event processing is too wasteful. It affects the GUI with every related alert handling, although we could only do this with regular updates."
704940618,13348,xavier2k6,2020-10-07T13:36:09Z,"@glassez just as a follow up really....do you want me to provide another test build? I didn't get a ping from you, so was just wondering....."
705012763,13348,glassez,2020-10-07T15:26:29Z,"> @glassez just as a follow up really....do you want me to provide another test build? I didn't get a ping from you, so was just wondering.....

I haven't added anything new here since."
706094028,13348,xavier2k6,2020-10-09T10:09:00Z,"I have identified 4x users through the issue tracker that have `~1800, ~7950, ~12,000 & ~36,000 torrents`, one user was already pinged here to try a build/get feedback but no response from them as of yet........should we ping the other 3?

Would be interested to see feedback from the user with `~36,000 torrents`........if willing/able to test.

@glassez @FranciscoPombal @thalieht What do you guys think? (these users have experienced the white screen/delayed startup  etc)

I can provide a build with `glassez:improve-startup` commit: `dd1e7d0` with latest libtorrent RC_1_2 commit: `d622951`"
706765171,13348,glassez,2020-10-11T20:39:09Z,"Please take a look at another approach!
#13498 (It is still draft too)."
707055888,13348,jagannatharjun,2020-10-12T11:14:28Z,"@glassez  how about transferring alert handling into a separate thread, my main objective is snappy GUI with no performance lost on libtorrent side and I suspect most of the slow GUI issues can be related to alert processing (I need to test it but I am too lazy)."
707142158,13348,arvidn,2020-10-12T14:06:27Z,"calling `pop_alerts()` *is* thread safe in the sense that you can call it from any thread. As long as all of the alerts from the last call have been processed and forgotten by the time `pop_alerts()` is called again, you're safe. Having a thread dedicated to processing alerts would be safe from the libtorrent API point of view, since that would be the only thread calling it. Some care would have to be taken to ensure that thread communicates safely with the GUI though. I imagine that part could get hairy."
707173581,13348,glassez,2020-10-12T15:01:06Z,"> Some care would have to be taken to ensure that thread communicates safely with the GUI though. I imagine that part could get hairy.

👍 
>how about transferring alert handling into a separate thread, my main objective is snappy GUI with no performance lost on libtorrent side and I suspect most of the slow GUI issues can be related to alert processing (I need to test it but I am too lazy).

Core processing of alerts is mostly fairly trivial and cannot cause too much load, so we are unlikely to benefit from transferring it to a separate thread, but on the contrary, we can only lose due to multithread interaction.
Thing that can really cause the GUI to slow down is the processing of core events in the GUI classes themselves. But your suggestion won't help either.
In addition, as I understand it, the main problem is the launch of the application. But there, as I have repeatedly mentioned, the best solution is to create a GUI after restoring the Session and loading the rest of the core components (#13498). Otherwise, we have completely meaningless behavior when it is updated so frequently that it does not have time to draw it. In addition, all these intermediate updates during session restoring do not make sense to the user. Why, for example, do you need to see the current number of torrents in a particular filter, if it does not reflect any current state of the session?"
395818357,9072,sledgehammer999,2018-06-08T16:41:47Z,Are there any links to MS docs?
395962676,9072,glassez,2018-06-09T11:42:12Z,">Are there any links to MS docs?

[Default Programs](https://msdn.microsoft.com/en-us/library/windows/desktop/cc144154(v=vs.85).aspx)"
396482640,9072,glassez,2018-06-12T06:43:04Z,"SUMMARY
There are some ""Default programs"" behavior incompatibilities between Windows versions:
1. Windows XP doesn't support ""Default programs"" at all.
2. Windows Vista and Windows 7 allow to check and set associations using ""Default programs"" API.
3. Windows 8 and 8.1 only allow to show ""Default programs"" dialog.
4. Windows 10 doesn't allow any programmatic interaction with ""Default programs"".
In addition, to access ""Default programs"" API we require `NTDDI_VERSION >= NTDDI_VISTA`. Currently 32-bit binaries are built with `NTDDI_VERSION = NTDDI_WINXP`. Theoretically, we can build it with `NTDDI_VERSION = NTDDI_VISTA` and check for running under Windows XP at runtime, but I'm not sure it will work, I don't have the ability to test it.

So what can we do in the current circumstances?
1. Bury this PR again and wait for the ""old way"" will not stop working completely (in new Windows versions, of course), or until we recognise that Windows XP finally died, or for something else...
2. Use old way under Windows XP and just allow user to use ""Default programs"" manually on other Windows versions.
3. Use different way for each Windows version:
3.1. Windows XP - old way,
3.2. Windows Vista and 7 - allow to check and set associations via ""Default programs"" API,
3.3. Windows 8 and 8.1 - show ""Default programs"" dialog on the first application run,
3.4. Windows 10 - suggest user to use ""Default programs"" dialog manually,
3.5. on 32-bit builds (if  `NTDDI_VERSION = NTDDI_WINXP` is the only available case) we can either use old way for any Windows versions or (as in par. 2) use old way under Windows XP and just allow user to use ""Default programs"" manually on other Windows versions."
396698164,9072,Chocobo1,2018-06-12T19:00:18Z,"I would choose ""Use different way for each Windows version"" , Windows version will be detected at runtime right?

And also
>Windows 8 and 8.1 - show ""Default programs"" dialog on the first application run,

I think you don't need to show it on first run, just a button in options to open ""Default programs"" dialog should suffice."
396954406,9072,glassez,2018-06-13T14:19:09Z,">Windows version will be detected at runtime right?

Yes.
>I would choose ""Use different way for each Windows version""

Ok.
>I think you don't need to show it on first run, just a button in options to open ""Default programs"" dialog should suffice.

Ok.
The last question is what do you suppose for 32 bit builds?"
397349163,9072,Chocobo1,2018-06-14T16:05:26Z,">The last question is what do you suppose for 32 bit builds?

You mean whether or not `NTDDI_VERSION = NTDDI_VISTA` for it?
I guess only conducting test could have a answer for it."
397355384,9072,glassez,2018-06-14T16:23:36Z,">You mean whether or not NTDDI_VERSION = NTDDI_VISTA for it?

No, I mean what behavior do you suppose in case it's impossible to build it with `NTDDI_VERSION = NTDDI_VISTA`? See par. 3.5 above."
397789390,9072,Chocobo1,2018-06-16T05:53:38Z,">what behavior do you suppose in case it's impossible to build it with NTDDI_VERSION = NTDDI_VISTA? 

I think par. 2 is right choice if possible."
397876126,9072,glassez,2018-06-17T12:37:50Z,Ok! PR updated.
397885867,9072,glassez,2018-06-17T15:19:47Z,">Then I need nothing in the Prog2 to reset the association.

Yes.
I don't know why it was implemented long time ago. And I don't want to change that now, because it only affects Windows XP (which is already dead, so sooner or later we're going to stop supporting it)It is not the subject of the current PR.

>Additionally, is it correct that clearing the settings checkbox in qBt will clear the association even if it is set to another program?

My fault. I missed it. Will be fixed."
406781679,9072,sledgehammer999,2018-07-21T08:50:07Z,Please don't merge. I want to review it too. Wait at least 1-2 weeks more.
421079777,9072,glassez,2018-09-13T17:04:24Z,">Please don't merge. I want to review it too. Wait at least 1-2 weeks more.

I have been waiting for 2 months... I'm afraid I've forgotten how it works exactly."
429284617,9072,glassez,2018-10-12T10:44:48Z,"Apparently, this problem will become relevant to you only when Microsoft finally kills the ""old"" way, and it really stops working..."
417728235,9375,Piccirello,2018-08-31T16:59:13Z,"All comments addressed. These new changes need more testing, will update once complete."
417736802,9375,WolfganP,2018-08-31T17:31:43Z,"@Piccirello thx for these continuous improvements to the WebUI. Is it possible to implement the ""remove tracker"" functionality in the WebUI?"
417748388,9375,Piccirello,2018-08-31T18:13:37Z,"@WolfganP It shouldn't be too difficult to implement the entire tracker context menu. Possibly in this PR if I can get it done quickly enough.
<img width=""271"" alt=""screen shot 2018-08-31 at 2 06 09 pm 2"" src=""https://user-images.githubusercontent.com/8296030/44929083-bfeb5180-ad27-11e8-8a1c-5ab9a07648b6.png"">

I also plan to target having trackers in the sidebar, but that may take a bit longer."
417763132,9375,zero77,2018-08-31T19:10:50Z,"@Piccirello 
I don’t want to cause problems as you clearly have put a lot of time and effort in to the current system. But, whilst you are working on trackers I think it would be nice to see whether the connection to the tracker is encrypted or not like the E flag next to pears."
417899382,9375,Piccirello,2018-09-02T01:57:46Z,"@zero77 I'm not sure that libtorrent exposes this information directly. The [announce_entry](https://libtorrent.org/reference-Core.html#announce-entry) doesn't contain any info related to encryption, though tracker traffic is [usually unencrypted](https://stackoverflow.com/questions/31080484/are-libtorrent-transfers-by-default-encrypted) anyway. You can try to infer this yourself by seeing if any of the tracker urls being with `https`."
417958822,9375,Piccirello,2018-09-02T20:49:10Z,"Context menu implemented. I've also finished my testing of these new features.

Please review the new commits."
417960053,9375,zero77,2018-09-02T21:08:43Z,"@Piccirello
Thanks anyway."
420047485,9375,Piccirello,2018-09-10T20:22:35Z,"If no more comments, please approve"
420061815,9375,Piccirello,2018-09-10T21:09:01Z,Added one commit to implement the changes from #9461
420231074,9375,glassez,2018-09-11T10:47:20Z,">If no more comments, please approve

There is at least one old unresolved conversation (about translated strings). It won't go away on its own just because you're ignoring it."
421209169,9375,Piccirello,2018-09-14T02:16:02Z,"> > If no more comments, please approve
> 
> There is at least one old unresolved conversation (about translated strings). It won't go away on its own just because you're ignoring it.

Quoting my reply:

> I’m having trouble following, what is the actual recommendation here? Unless someone feels very strongly, I’m inclined to leave these as is.


And regarding your recommendation:

> JavaScript sources are translatable as well. You can easily create error code to description text mapping there.

How can this be accomplished? I don't know how to do this. Please do not suggest returning an integer because that is an unacceptable compromise. For examples, see other qBittorrent web APIs and many other external APIs from large companies."
421228476,9375,Chocobo1,2018-09-14T04:36:30Z,">How can this be accomplished? I don't know how to do this. 

Using the same expression as used in HTML files, example: `QBT_TR(URL)QBT_TR[CONTEXT=TrackerListWidget]`.
However this won't work correctly since currently all JS files are cached in client and I don't think JS files should contain mutable data.

>Please do not suggest returning an integer because that is an unacceptable compromise. 

All in all `const QString working {QCoreApplication::translate(""TrackerListWidget"", ""Working"")};` should revert back to `const QString working {""Working""};`
And (ideally) the i18n translation replacement should occur in embedded JS in HTML file."
421276412,9375,glassez,2018-09-14T08:43:51Z,">Please do not suggest returning an integer because that is an unacceptable compromise.

My previous comnent:
>Integers aren't required, of course. They can be some string codes (e.g. ""working"", ""paused"" etc.).

>How can this be accomplished? I don't know how to do this.

Pseudo code:
```
function tr(source)
{
    switch(source) {
    case ""working"": return QBT_TR(Working)QBT_TR[CONTEXT=TrackerListWidget];
    // and so on
    }
}
```"
421283016,9375,glassez,2018-09-14T09:02:38Z,">For examples, see other qBittorrent web APIs and many other external APIs from large companies.

I have seen very bad web interfaces from very large and cool companies (any sophomore from some IT Department could do better without straining too much).

I've repeated again my basic idea:
>The point is that the API is a data source and it should provide data in the form of their values, not their specific representation. Client app handles received data and provide it to the user in form of particular representation (e.g. API provide tracker status as [working; disabled] and then client app show it as translated string, or some color, or icon etc.).

How can some Web client represent tracker status by coloring its name, for example, if you don't return the status in processable form but just its particular representation?

It seems that you are constantly developing in reverse order, adjusting the API to your specific interface. This is the wrong workflow!"
421821480,9375,Piccirello,2018-09-16T19:50:22Z,Squashed all fixups
431736657,9375,Piccirello,2018-10-22T04:09:24Z,"Updated to reflect new column names and rebased.

Before:
<img width=""962"" alt=""screen shot 2018-10-21 at 8 04 28 pm"" src=""https://user-images.githubusercontent.com/8296030/47274030-ac60a800-d56c-11e8-9567-ac122a0b7895.png"">

After:
<img width=""959"" alt=""screen shot 2018-10-21 at 7 49 50 pm"" src=""https://user-images.githubusercontent.com/8296030/47274031-b1bdf280-d56c-11e8-8421-fd1706000db9.png"">
"
432085898,9375,glassez,2018-10-23T04:21:35Z,"Can tracker manipulations be applied to set of torrents (not to individual one only)?
Many users have been asking for this feature recently, but there is no one to implement it correctly in GUI. There shouldn't be a big problem to do this here (at least in the API). Maybe not in this PR..."
432442527,9375,Piccirello,2018-10-23T22:19:15Z,Would the goal be to allow adding a list of trackers to multiple torrents at once? I'm not sure what other methods could accept multiple torrents.
432635119,9375,WolfganP,2018-10-24T12:29:05Z,"As always, thx @Piccirello for improving the WebUI. BTW, are the columns ""sortable""? (ie be able to click on the column header and make the list to sort by that column criteria)"
432644786,9375,Piccirello,2018-10-24T12:59:13Z,@WolfganP the columns are not currently sortable or resizable. I don’t think it would be that much effort to add that functionality. I will look into it.
432701977,9375,glassez,2018-10-24T15:16:54Z,">Would the goal be to allow adding a list of trackers to multiple torrents at once?

I think Yes.
>I'm not sure what other methods could accept multiple torrents.

As far as I remember, users asked for the ability to remove the tracker from multiple torrents.
And then why not allow to replace tracker (aka ""edit"" here) for multiple torrents?
The intention is the user selects multiple torrents in some UI and it manipulates a common set of their trackers."
433766143,9375,Piccirello,2018-10-29T01:59:11Z,"@glassez I've created #9780 to track this feature

"
438342952,9375,Piccirello,2018-11-13T16:43:44Z,"I haven't found the time to make the Trackers table sortable/resizable. I'd rather get this PR into 4.1.4 and target a sortable/resizable Trackers table and Content table in a future PR (issue #8663).

@glassez @Chocobo1 please review"
441463883,9375,Piccirello,2018-11-25T19:03:44Z,Really hope we can get this in before 4.1.5 is cut
444814780,9375,Chocobo1,2018-12-06T09:56:00Z,You have conflicts now.
445132784,9375,Piccirello,2018-12-07T06:06:05Z,Fixed conflicts
445376138,9375,Piccirello,2018-12-07T21:48:32Z,My local builds seem to be failing on the same `asConst` error as some of the travis-ci builds. Anyone know why? @glassez @Chocobo1 @thalieht  
445386184,9375,thalieht,2018-12-07T22:32:22Z,"Looks like g++ 4.8.x has a problem with it https://stackoverflow.com/a/36970437
Should i rename one of the asConst templates until whatever needs gcc 4.8 is not supported? If yes rename to moveAsConst?
Travis was broken at the time so we didn't catch it..."
445404657,9375,Piccirello,2018-12-07T23:55:37Z,"> Looks like g++ 4.8.x has a problem with it

Updating to gcc 4.9 fixed it for me 👍 "
445429231,9375,Chocobo1,2018-12-08T04:18:28Z,"LGTM, wait for other's review before you squash the commits.
"
445682908,9375,Chocobo1,2018-12-10T04:54:38Z,Please squash commits.
446074428,9375,Piccirello,2018-12-11T05:09:09Z,Fixup commits were squashed
446079922,9375,Piccirello,2018-12-11T05:44:13Z,Fixed conflict
446454875,9375,Chocobo1,2018-12-12T04:06:36Z,Thank you!
515252546,10948,LordNyriox,2019-07-25T23:33:51Z,"@jagannatharjun:  Thanks for all your work on this feature.  :} 

After this PR is finalized and merged, would you be willing to post a template theme (including icons) for qBittorrent? "
515475114,10948,jagannatharjun,2019-07-26T14:25:32Z,@LordNyriox yes
518703887,10948,jagannatharjun,2019-08-06T14:50:57Z,"Should I fall back to the default icon mapping if the icon path can't be resolved with custom `iconconfig.json` . May be provide an option

I am thinking to replace the current selection method with something like [this](https://github.com/qbittorrent/qBittorrent/pull/10702#issuecomment-496570342).
With the current setup, It seems more natural."
518765655,10948,glassez,2019-08-06T17:25:30Z,"My main suggestions for naming are the following:
ID should contain two main parts.
First part (actually last part of ID) is ""common semantic"" (e.g. ""AddAction"" or ""Logo"").
The second part is ""scope"" of particular ID, possible multilevel (e.g. ""AddTorrentDialog.TorrentContentView"").
""Scope"" can be omitted in icon mapping (partially or fully) by replacing with ""\*"" character. It allows the theme creator to achieve any desired detail. E.g. someone can set different icons for each particular ID but someone else can create very reduced theme (by having only entries like ""*.AddAction"", i.e. set the same icon for all similar places).
We should avoid any ""internals"" in ID parts. I.e. ""ContentTree"" is not so good, IMO (due to ""Tree"" in it). It should just point to some widget (or view) that shows content of torrent (regardless of the particular type of this widget), so ""TorrentContentView"" is better name.
We can avoid too much detail in ID scopes, but only if it is not likely to be needed in the future (because we will not be able to change existing IDs without breaking existing themes)."
519104239,10948,glassez,2019-08-07T13:46:52Z,">Should I fall back to the default icon mapping if the icon path can't be resolved with custom `iconconfig.json`

What do you mean exactly?

If there is no such ID (or appropriate generic ID that matches it) in theme then you should use built-in icon (and cache it for this ID). This situation can occur when some new qBittorrent version introduces new ID so there is no matches in existing themes. You also should indicate this event in some way (maybe show message box about missing icons or some less annoying way). Or maybe don't fallback and just show some predefined icon placeholder?

If the theme contains some ID but mapped path is invalid then it's real bug in theme and you shouldn't fallback to correct icon."
525292274,10948,jagannatharjun,2019-08-27T13:06:42Z,"![image](https://user-images.githubusercontent.com/34717789/63773807-942e8780-c8f9-11e9-9323-3f20e7c1bd51.png)

Here is a theme if anyone wants to try out.
https://github.com/jagannatharjun/qbt-theme/blob/master/material-white/material.qbtheme
@glassez  update?"
525608455,10948,glassez,2019-08-28T06:50:13Z,">@glassez update?

I'm sorry, I just can't get around to it for lack of free time. It's on my to-do list, so I'll be back here as soon as I can."
530889172,10948,jagannatharjun,2019-09-12T15:52:15Z,"Well, finally the system theme finally works, tested on ubuntu 
@Chocobo1 Is it how it supposed to look? 😝 
![image](https://user-images.githubusercontent.com/34717789/64799925-45dce200-d5a3-11e9-8701-bbcb020297ad.png)

also, I introduced a new JSON config key `search-dirs`, basically in addition to `iconDir`, icons are now searched also in subdirectories provided in `search-dirs` I find it necessary to add system icon theme support without changing the current icon structure.
"
530902357,10948,Chocobo1,2019-09-12T16:25:28Z,">@Chocobo1 Is it how it supposed to look? 😝

Seems it is working mostly. And I noticed some icons are still from qbt (i.e. not from system), such as the Options icon in the menu bar and icons for General tab and Peers tab. Not sure that is normal under ubuntu... maybe @thalieht could help with this.
Or perhaps you missed that we used to have fallback names for some icons? (I didn't checked your code yet.)"
530928690,10948,glassez,2019-09-12T17:36:43Z,">Or perhaps you missed that we used to have fallback names for some icons? 

Probably https://github.com/qbittorrent/qBittorrent/pull/10948#discussion_r319191780 was missed too."
532122508,10948,jagannatharjun,2019-09-17T08:40:20Z,"with sudo
![image](https://user-images.githubusercontent.com/34717789/65025720-d7a66f80-d954-11e9-919d-fad4821eda44.png)

without sudo
![image](https://user-images.githubusercontent.com/34717789/65025639-b8a7dd80-d954-11e9-864f-8475b5da898d.png)

🤔 
"
532728858,10948,jagannatharjun,2019-09-18T15:08:41Z,"I think with the addition of `search-dirs`, the qbittorrent's `iconconfig.json` and `systemiconconfig.json` can be merged into a single file.

What do you think @glassez  @Chocobo1  ?"
532745435,10948,glassez,2019-09-18T15:45:44Z,">I think with the addition of `search-dirs`, the qbittorrent's `iconconfig.json` and `systemiconconfig.json` can be merged into a single file.
What do you think @glassez  @Chocobo1?

Sorry, I can't keep up with you...
What's `search-dirs` for?"
532748950,10948,jagannatharjun,2019-09-18T15:54:03Z,"> What's `search-dirs` for?

I introduced this in the previous commit to making system icon theme works because there may be some icons that are not present in the system theme. So I added an extra parameter in JSON `search-dirs` which specifies the directory inside the uitheme to look for the icon.

This can be used to merge the systemiconconfig.json and iconconfig.json as most of the system icons have the same name but they are stored in directory `qbt-theme`. Merging means providing an alias in qrc, this way user can still specify a custom `systemiconconfig.json`"
532750456,10948,jagannatharjun,2019-09-18T15:57:39Z,"actually with current PR state, we can actually use `systemiconconfig.json` on all systems as default icon config and system icon theme will only be used when allowed by preferences."
533501326,10948,glassez,2019-09-20T10:34:07Z,">I introduced this in the previous commit to making system icon theme works because there may be some icons that are not present in the system theme.

It seems that you went beyond the designed model. Besides, it required you to introduce new entities (i.e. ""search dirs"").
When some icon isn't presented in current system theme you should just use default icon for this IconID (that are supposed to always be presented)."
533631801,10948,jagannatharjun,2019-09-20T16:55:07Z,"> When some icon isn't presented in current system theme you should just use default icon for this IconID (that are supposed to always be presented).

So in systemiconconfig.json, all values should be treated as system icons? don't allow paths?

Also, I don't think `m_allowedExt` is actually needed, I will be removing it and replacing the icons with full qualified icon paths in iconconfig.jsons"
533765480,10948,glassez,2019-09-21T04:05:19Z,">Also, I don't think `m_allowedExt` is actually needed, I will be removing it and replacing the icons with full qualified icon paths in iconconfig.json

:+1:
>So in systemiconconfig.json, all values should be treated as system icons?

Yes, of course.

Also I would still move system and default mapping into the code."
533785722,10948,jagannatharjun,2019-09-21T10:07:48Z,"> Yes, of course.

Well, will following be ok? -
1. Load both systemiconconfig.json and iconconfig.json. There should be no check for systemiconconfig.json
2. in geticonpath, if the QIcon::fromTheme returned an empty icon then get the icon from the `iconconfig.json`

basically, have two vaiable `m_systemIconMap` and `m_iconMap`

>   Also I would still move system and default mapping into the code.

separately in `iconconfig.cpp` or inside the `uithememanager.cpp`"
533791929,10948,jagannatharjun,2019-09-21T11:50:49Z,"Oh! 😫  I was implementing this and It doesn't make sense XD.
my final take will be:
1. Load custom systemiconconfig and merge with default systemiconconfig
2. Load custom iconconfig and merge with default iconconfig
3. In getIcon if QIcon::fromTheme and Fallback both fails, get the icon from iconconfig

@glassez  what do you say?

**EDIT:** will it make more sense to not merge systemiconconfig, so that in case of error we get the icon from custom iconconfig"
533848417,10948,jagannatharjun,2019-09-22T04:11:09Z,"![image](https://user-images.githubusercontent.com/34717789/65382179-c4145380-dd1c-11e9-8688-ce9bce612d4c.png)

ubuntu icon theme - [link](https://github.com/jagannatharjun/qbt-theme/blob/master/ubuntu/style.qbtheme?raw=true)"
638187548,10948,glassez,2020-06-03T13:12:26Z,Superseded by #12861.
423575037,9562,LordNyriox,2018-09-21T15:31:51Z,"@dzmat:  It seems that you are reducing the accuracy of the graph, in an effort to improve its visual appearance. 

Unless this also improves application performance (the graph has a history of being a CPU hog), I cannot condone form over function. 

Perhaps an alternative solution can be presented? "
423587125,9562,dzmat,2018-09-21T16:05:11Z,In current version there is no so much accuracy to regret about loss of it.  Speed graphs are spiky for whatever reason for a long time already. The only accuracy you get is knowledge of exact value of one spike on graph. All other spikes has the same 'accuracy' as with new aligned scale.
423624712,9562,LordNyriox,2018-09-21T18:07:40Z,"@dzmat:  I will admit that (judging from the screenshots) the accuracy loss is slight.  

Even so, I would rather not add an additional calculation (which may add CPU overhead), for a marginal improvement in artistic appearance. "
423723822,9562,dzmat,2018-09-22T07:26:57Z,"@LordNyriox well, so if we concerns performance side, I decided to make some test. I measured with `__rdtsc()` builtin how many clock ticks is spend on generating labels text in old code and new code and did not notice much difference. Both variants gives approximately 50000 clock ticks (with very high dispersion). Here comes histogram of captured samples in new code (old code looks the same)
![shot2](https://user-images.githubusercontent.com/14874367/45914723-469cd580-be73-11e8-9968-bb8605a29b09.png)

Readings are constantly jumping (I think because of multitasking) and I can not say which code is faster for sure. 
BTW I am surprised, how many ticks consumes this seemingly simple operation. 
```c++
    quint64 t1=__rdtsc();  // <----- measure starts
    double niceScale = getNiceYScale(mYV);
    // draw Y axis speed labels
    Utils::Misc::SizeUnit unit;
    QVector<QString> speedLabels = {
        ::niceLabel(niceScale, unit,false),
        ::niceLabel(0.75 * niceScale, unit,true),
        ::niceLabel(0.50 * niceScale, unit,true),
        ::niceLabel(0.25 * niceScale, unit,true),
        ::niceLabel(0, unit,true),
    };
    quint64 rt=__rdtsc()-t1; // <----- measure ends
```"
423750926,9562,LordNyriox,2018-09-22T15:14:15Z,"@dzmat: 

>BTW I am surprised, how many ticks consumes this seemingly simple operation. 

Believe it or not, that was even worse when @onto [first introduced](https://github.com/qbittorrent/qBittorrent/pull/2757) the graph feature.  The graph code went through a major refactor in [<https://github.com/qbittorrent/qBittorrent/pull/4261>], in an effort to improve performance. 

Note that there was also some demand for an option to disable the graph feature entirely, but despite @onto's promises, that option was never implemented. 

[Quote from @glassez](https://github.com/qbittorrent/qBittorrent/pull/4261#issuecomment-166961747): 
>You should implement the possibility to disable this feature. This feature is expensive, and we should not waste the computing resources of the user if it is not necessary for him. "
423752108,9562,dzmat,2018-09-22T15:32:37Z,"@LordNyriox If you select any other bottom tab (general,trackers,peers, etc) all this drawing code is not executed at all, and does not consume any CPU time. Tested it right now."
423787609,9562,LordNyriox,2018-09-23T02:43:43Z,"@dzmat:  Correct.  However, it does use up some memory (to store point history). 

[Quote from @onto](https://github.com/qbittorrent/qBittorrent/pull/4261#issuecomment-171016022): 
>Speed graph not draw and relatively not eat cpu if it not showing, only eat some memory for saving points. 

Perhaps there could be an option to **not store** this data when the graph is not open?  (Effectively resetting the graph every time it is closed.) 
"
429296880,9562,glassez,2018-10-12T11:38:04Z,">Make Y axis scale to fix on predetermined nice looking positions, which have nice looking round quarter labels.

@dzmat
I'm sorry, I'm not sure what you want to do here. Could you explain it in more detail, preferably with examples and screenshots compared to the current behavior?"
429384907,9562,dzmat,2018-10-12T16:32:35Z,"This is nice looking labels (with 1-2 non-zero significant digits) targeted by this PR
![shot1](https://user-images.githubusercontent.com/14874367/46881623-4a21ec00-ce76-11e8-87cc-decb7afb0441.png)

These are labels in current version. Very often they contain 3 non-zero significant digits and looks ""non-round"".
![shot3](https://user-images.githubusercontent.com/14874367/46881621-49895580-ce76-11e8-9ca4-8dbd9cb6a0d5.png) ![shot4](https://user-images.githubusercontent.com/14874367/46881622-49895580-ce76-11e8-957c-516ac86c8f21.png) ![shot2](https://user-images.githubusercontent.com/14874367/46881624-4a21ec00-ce76-11e8-8c9b-da74f2d0266e.png)
"
429914414,9562,dzmat,2018-10-15T16:05:14Z,"Well, refactoring can not be finished, but only paused :) . So it is time for the next iteration of a review."
434948314,9562,glassez,2018-11-01T06:47:33Z,Thank you!
548696132,11433,Chocobo1,2019-11-01T07:39:17Z,https://travis-ci.org/qbittorrent/qBittorrent/jobs/605655548#L1161
548697095,11433,jagannatharjun,2019-11-01T07:43:39Z,"> https://travis-ci.org/qbittorrent/qBittorrent/jobs/605655548#L1161

My IDE breaks without terminator but it compiles fine XD. Also, msvc doesn't actually give any warnings

Fixed"
549796558,11433,jagannatharjun,2019-11-05T12:09:38Z,"> Now I've realized general disadvantage of this solution. You make GUI classes (at least one currently) to be dependent from ""theming support"" implementation. This is a step back on our evolutionary path, so I would strongly discourage it.

Well `TransferListTextColors` can be moved `uithememanager.h` and colors can only be quired through `UiThemeMnager` class
"
550390284,11433,glassez,2019-11-06T16:31:08Z,">Well TransferListTextColors can be moved uithememanager.h and colors can only be quired through UiThemeMnager class

But why all this perversion with so-called ""convenient"" classes, ugly names in QSS file, etc.?
We do still need custom configuration file for supporting theme icons. Why not use it for ""dynamic"" colors too?"
550391605,11433,jagannatharjun,2019-11-06T16:33:52Z,">We do still need custom configuration file for supporting theme icons. Why not use it for ""dynamic"" colors too?

I think I presented you the option of using Json in the linked issue but you liked this approach more."
550399149,11433,glassez,2019-11-06T16:50:18Z,"Sorry, but it didn't seem like a workaround way initially. I thought it will work almost behind the scenes like other QSS stuff does."
551103432,11433,jagannatharjun,2019-11-07T14:30:38Z,"> ```c++
> if (role == Qt::ForegroundRole)
>     return UIThemeManager::instance()->getColor(textColorIDByState(torrent->state()));
> ```

What do you mean by `textColorIDByState`?
Should it be something like `UIThemeManager::getColorByTorrentStatus` or `UIThemeManager::getTorrentStatusColor`
and also what should be the format of JSON.
I am thinking something like `config.json` with 
```json
{
  ""TorrentStatusColors"": [
    {
      ""status"": ""downloading"",
      ""color"": ""pink""
    },
    {
      ""status"": ""uploading"",
      ""color"": ""red""
    }
  ]
}
```"
552164929,11433,jagannatharjun,2019-11-10T05:30:53Z,"> > ```c++
> > if (role == Qt::ForegroundRole)
> >     return UIThemeManager::instance()->getColor(textColorIDByState(torrent->state()));
> > ```
> 
> What do you mean by `textColorIDByState`?
> Should it be something like `UIThemeManager::getColorByTorrentStatus` or `UIThemeManager::getTorrentStatusColor`
> and also what should be the format of JSON.
> I am thinking something like `config.json` with
> 
> ```json
> {
>   ""TorrentStatusColors"": [
>     {
>       ""status"": ""downloading"",
>       ""color"": ""pink""
>     },
>     {
>       ""status"": ""uploading"",
>       ""color"": ""red""
>     }
>   ]
> }
> ```

@glassez  opinion?"
552183869,11433,glassez,2019-11-10T10:56:35Z,">What do you mean by `textColorIDByState`?
Should it be something like `UIThemeManager::getColorByTorrentStatus` or `UIThemeManager::getTorrentStatusColor`

No and no.
I mean some function in transferlistmodel.cpp that maps torrent statuses to color IDs (e.g. `TorrentState::Downloading` => ""TransferList.Downloading"").
>what should be the format of JSON.
I am thinking something like `config.json` with

We don't really need several configuration files so it should contain all options, e.g.:
```json
{
  ""Colors"":  {
      ""TransferList.Downloading"": ""pink"",
      ""TransferList.Uploading"": ""red""
    },
   ""Icons"": {
      ""SomeIconID"": ""path/to/icon.svg""
   }
}
```"
552185202,11433,glassez,2019-11-10T11:15:58Z,"@jagannatharjun, Putting some code or data in one place or another makes little sense on its own. Such a structure will not improve anything if things continue to be cross-dependent. I'm trying to get you to do a ""less-depending"" architecture. Sorry, I'm pretty limited right now, otherwise I'd draw a little diagram. In words:
1. Theme clients (i.e. widgets etc.) know nothing about theme implementation. We just declare some ""theme entity IDs"" and know that ""theme manager"" can give ""theme entity"" (i.e. icon, color) by its ID.
2. ""Theme manager"" knows nothing about its clients and how/where ""theme entities"" are used. It just define ""theme file"" format and implement mechanism that allows to obtain ""theme entity"" from ""theme file"" using its ID."
559245342,11433,sledgehammer999,2019-11-27T20:45:44Z,">Please wait a review on this by me too before merging.

I suppose my review isn't needed, since the architecture itself is in question now."
562914841,11433,jagannatharjun,2019-12-08T05:36:03Z,"should it be in `colors.config`, because people are asking for progress bar color as well? Also, there are lots of Icons so it will be better to separate them?"
562915270,11433,jagannatharjun,2019-12-08T05:45:59Z,okay progress bar color is because of `QProxyStyle` used to print draw the progress bar.
562923224,11433,glassez,2019-12-08T08:16:12Z,">Also, there are lots of Icons so it will be better to separate them?

It's not a problem, IMO. It's better than load multiple configuration files."
562925472,11433,jagannatharjun,2019-12-08T08:53:44Z,"I was trying to get the progress bar first so I did something like following in `transferlistdelegate.cpp`

```cpp
            newopt.textAlignment = Qt::AlignVCenter | Qt::AlignHCenter;
           

//#if defined(Q_OS_WIN) || defined(Q_OS_MACOS)
//           // XXX: To avoid having the progress text on the right of the bar
//            QProxyStyle st(""fusion"");
//           st.drawControl(QStyle::CE_ProgressBar, &newopt, painter);
//#else
            qApp->style()->drawControl(QStyle::CE_ProgressBar, &newopt, painter);
//#endif
```
but progress bar is not drawing with the style and I am pretty sure my stylesheet is correct. Can someone give me any idea! It actually drawn correctly without the stylesheet(Default option)
![image](https://user-images.githubusercontent.com/34717789/70387000-c5712600-19c5-11ea-9e62-32f6d5b9b63c.png)
"
562925538,11433,glassez,2019-12-08T08:54:59Z,"As for icon support, we are really stuck here. I've been thinking about it a lot lately. I think we're aiming for excessive perfection. Unfortunately, too few people are involved. Anyway now I have an idea how to make it a little easier (or even a lot easier)."
562925878,11433,jagannatharjun,2019-12-08T09:00:35Z,Hope It doesn't involve rewriting the whole thing again 😛🤞.
562931677,11433,glassez,2019-12-08T10:19:24Z,">Hope It doesn't involve rewriting the whole thing again 

Unfortunately, it is a completely different way. But that's not a problem for you, is it? Seems like you'd rather rewrite the code a few times than discuss the intended changes (no offense, okay?).
It seems to be easier/faster to implement the idea I'm thinking about than to finish current one.
By the way, maybe it's not my idea? Maybe someone has expressed it before, but it was rejected the first time?
In short, here it is:
We just allow theme to contain icons within the same folder structure as default icons. Then the icon search algorithm will be something like this:
1. If ""use system icons"" is enabled (linux only) try to load system icon. If it's failed fallback to the next step.
2. If custom theme is enabled try to load icon from theme. If it's failed fallback to the next step.
3. Load default icon.

That is all. No changes out of UIThemeManager. No configuration files. And I think that will be quite enough."
562937825,11433,jagannatharjun,2019-12-08T11:33:25Z,"That's my original proposal for the theme support but you insisted on JSON based approach. But nevertheless, it's been a good learning experience.

EDIT:  I have exams and other stuff going on so Can you finalize the idea in the meantime and give me the final specification. I will get it done by 20."
562938761,11433,glassez,2019-12-08T11:43:46Z,">That's my original proposal for the theme support

Please remind me why it was rejected last time. Maybe it's really important..."
562939105,11433,jagannatharjun,2019-12-08T11:47:37Z,"here it is https://github.com/qbittorrent/qBittorrent/issues/10903
I agree it's a bit naive."
562951111,11433,glassez,2019-12-08T13:56:22Z,">here it is #10903

Well, maybe your explanation wasn't so obvious to me, or maybe I was just being perfectionist..."
562952107,11433,glassez,2019-12-08T14:06:50Z,">Can you finalize the idea in the meantime and give me the final specification.

Basic idea is in https://github.com/qbittorrent/qBittorrent/pull/11433#issuecomment-562931677. Or is there something missing? Everything else seems to be implementation details...
So you can either clarify something in advance if you have something unclear, or just start writing code, and then we'll see all the flaws.
Please publish it as separate PR."
564649763,11433,glassez,2019-12-11T17:29:09Z,">Can someone give me any idea! It actually drawn correctly without the stylesheet(Default option)

Probably we should inherit delegate from QStyledItemDelegate as suggested in #6434."
564743888,11433,andrewpros,2019-12-11T21:36:48Z,"Well i think the aim should be to integrate everything in a single place, the theme file and not multiple config files, do it once, but for good, with full custom theme support.
I did manage to compile qb the easy way with msys2 on windows and do some quick digging with QStyledItemDelegate
https://i.imgur.com/0zdBy9H.png
The point is, it works, even with padding, but then i dont know yet how we can set dynamic styles for different states in qss so that it would be accessible in code, but im sure there is a way, its a delegate painting so we can't give the item an ID or add/change dynamic custom property reflected in qss right? Well maybe we should just limit ways to do it in advance and just add parent container ID that will allow to do this the simple way, just change the parent container state so that qss can style descendants by it, we don't really need per column different colors and states i guess, its a whole row text style already, so that would be fine."
564895664,11433,glassez,2019-12-12T08:05:43Z,">we can't give the item an ID or add/change dynamic custom property reflected in qss right?

Yes.
>Well maybe we should just limit ways to do it in advance and just add parent container ID that will allow to do this the simple way, just change the parent container state so that qss can style descendants by it, we don't really need per column different colors and states i guess, its a whole row text style already, so that would be fine.

Hell, you're making me dive into this out-of-my-interest problem.
I had to investigate something, so I have some idea (maybe it won't work - need to check).
We can assign custom properties of widget classes from QSS. But currently Transfer list item colors are assigned by model which isn't widget class. Making some workaround with dummy widgets (like previously suggested here) is bad idea. But we can declare appropriate properties of TransferListWidget class. Then we can change current logic to not assign item colors from model but do it in delegate (i.e. delegate check torrent state and assign item color using appropriate property of widget class).
@jagannatharjun, what do you say?

>Well i think the aim should be to integrate everything in a single place, the theme file and not multiple config files

Anyway qBittorrent theme file isn't QSS. It contains QSS file as well as other resources (e.g. icons, still under development)."
564915883,11433,jagannatharjun,2019-12-12T09:07:30Z,"> we can declare appropriate properties of TransferListWidget class. Then we can change current logic to not assign item colors from model but do it in delegate (i.e. delegate check torrent state and assign item color using appropriate property of widget class).

Doesn't it will produce the same ugly names in QSS and also isn't its model's job to provide foreground colors. Anyway, it will be less work so I will be to happy implement this way. XD "
564954409,11433,glassez,2019-12-12T10:47:27Z,">Doesn't it will produce the same ugly names in QSS 

Yes. It will contain names like ""qproperty-pausedItemForeground"". So let affected people (theme creators) decide whether they accept it or not.
>isn't its model's job to provide foreground colors.

Yes. But it's nothing wrong if delegate redefine them for some reason. And since TransferListWidget isn't abstract View there is nothing wrong if it has ""subject domain"" related properties (i.e. item foreground colors for torrent states).

So if you guys decide to go this way, I won't mind (unless some pitfalls come up here)."
564997874,11433,andrewpros,2019-12-12T13:02:48Z,"> Anyway qBittorrent theme file isn't QSS. It contains QSS file as well as other resources (e.g. icons, still under development).

Well i know, i compiled a theme myself, but the qss file is the main part of the style.

If ppl will create themes then all in one file is nice for sharing instead of multiple configs or in app settings just for that, honestly it would be strange to do it like this, if there can't be a simple workaround with QStyledItemDelegate and qss then i guess the colors config could be as good as a file inside the theme file that qb reads.

Its just i don't have the knowledge, but for a qt veteran it should be easy to do i even with full custom style support for transfer list and not only colors.

> Doesn't it will produce the same ugly names in QSS and also isn't its model's job to provide foreground colors.

Define ugly, i think it doesn't matter really, ease of use and full custom theme params for any element is the main goal, making it the way everything can be contained in a single qss is worth the effort even with ugly names, but still they are perfectly supported by the qss engine, i mean ugliness shouldn't stop functionality."
565681225,11433,glassez,2019-12-14T04:22:03Z,"> it's nothing wrong if delegate redefine them for some reason.

Well, here is better solution. Model still assign Foreground colors. And there is no cross dependencies. You need to define `TransferListModel::stateColors` property (not Qt property, just getter/setter) and assign it from `TransferListWidget` class. 
(Otherwise you need to define an appropriate property of `TansferListDelegate`)"
565936035,11433,jagannatharjun,2019-12-16T07:20:28Z,"@glassez  Can you take a fresh look and if possible can we try for 4.2.1 because I'm getting quite a number of requests. 

Basically now ""Convenience class"" is shifted in TransferListWidget and when modified the concerned property request to change the value in the model. Individual values are stored in the model class."
566146455,11433,jagannatharjun,2019-12-16T16:53:52Z,@glassez @Chocobo1 I have updated the PR.
566153808,11433,jagannatharjun,2019-12-16T17:11:46Z,@sledgehammer999 I think you can review now.
566168972,11433,glassez,2019-12-16T17:50:42Z,">@sledgehammer999 I think you can review now.

@sledgehammer999, should we wait for your review?"
566171576,11433,jagannatharjun,2019-12-16T17:57:39Z,"Also, should I have to open a separate PR for 4_2_x branch?"
566173783,11433,glassez,2019-12-16T18:03:45Z,">Also, should I have to open a separate PR for 4_2_x branch?

No. Currently it follows master."
566699692,11433,sledgehammer999,2019-12-17T18:55:35Z,Am I missing something? I see the interconnection between the model and the view. But where is the loading of the colors from the QSS? Is there going to be another PR for that?
566703724,11433,glassez,2019-12-17T19:06:00Z,">But where is the loading of the colors from the QSS?

It's done by Qt itself. Declared Qt properties of QWidget-based classes are accessible from stylesheet."
566710819,11433,sledgehammer999,2019-12-17T19:24:10Z,@glassez I am inclined to do a release in a few hours. Do you reckon that I should merge+include this PR too?
566737308,11433,glassez,2019-12-17T20:33:01Z,">Do you reckon that I should merge+include this PR too?

Unfortunately, I won't be able to run and test it anytime soon, so I would merge it but not include it in the next release. We need to make sure it doesn't break the existing functionality if GUI (i.e. when custom theme isn't enabled). If someone can check it out and confirm it soon, then I don't mind including it in the upcoming release. This seems to be highly anticipated by many users."
566740113,11433,sledgehammer999,2019-12-17T20:41:04Z,">so I would merge it but not include it in the next release

+1 I was thinking the same, that's why I asked.

>make sure it doesn't break the existing functionality if GUI
>This seems to be highly anticipated by many users.

IMO, it's better to provide a test build on top of the next release to those users."
566856989,11433,glassez,2019-12-18T03:59:03Z,"@jagannatharjun, Travis fails to build it due to `std::unordered_map`. Seems you still need to provide hash function for TorrentState. So just switch back to QHash and provide qHash (you should declare it in BitTorrent namespace, e.g. below type declaration)."
566857343,11433,glassez,2019-12-18T04:01:00Z,"@sledgehammer999, well, v4.2.1 is here so we can merge it (after it was fixed), isn't it?"
567329553,11433,glassez,2019-12-19T04:40:42Z,"Here is how I implemented qHash for TorrentState in my another job (still unpublished):
```c++
uint BitTorrent::qHash(TorrentState key, uint seed)
{
    return ::qHash(static_cast<std::underlying_type_t<TorrentState>>(key), seed);
}
```"
567354379,11433,jagannatharjun,2019-12-19T06:29:10Z,"@glassez @Chocobo1  I have updated the PR please take a look.

I had an exam yesterday that's why I was missing. 😁"
567558663,11433,sledgehammer999,2019-12-19T16:20:44Z,@jagannatharjun thanks
568892047,11433,ArcticGems,2019-12-25T12:05:57Z,Why don't this PR has the 4.2.**2** milestone? (is it withheld for later release?)
2168376356,20951,ManiMatter,2024-06-14T16:32:58Z,"@Chocobo1 , @glassez - I would appreciate your review. 

I tested it and it works. Only one small item that is not yet working as expected, maybe you can point me in the right direction? On the GUI, sorting by the ""Private"" column does not work. On the WebGUI, it works as expected. 

My hunch is that I am making some mistake around here, but I have not been able to figure it out.
https://github.com/qbittorrent/qBittorrent/blob/b5120765185b6363008bb36a386ddbb4866d7705/src/gui/transferlistsortmodel.cpp#L170-L171"
2168751826,20951,thalieht,2024-06-14T20:55:46Z,">On the GUI, sorting by the ""Private"" column does not work.

You have to add the column to `TransferlistModel::InternalValue`

Problem in General tab in GUI only:
- Select a private torrent
- Select a torrent without metadata
- Private field in General tab is not updated to ""No"""
2168834142,20951,ManiMatter,2024-06-14T22:20:15Z,"Thanks for the review and pointers, @thalieht 

> > On the GUI, sorting by the ""Private"" column does not work.
> 
> You have to add the column to `TransferlistModel::InternalValue`

Spot on. Now it works.

> Problem in General tab in GUI only:
> 
> * Select a private torrent
> * Select a torrent without metadata
> * Private field in General tab is not updated to ""No""

I am trying to reproduce this. What's the best way to generate a torrent without metadata?
"
2168854059,20951,thalieht,2024-06-14T22:50:33Z,">What's the best way to generate a torrent without metadata?

Add a magnet link to session and pause it before its metadata are retrieved."
2169173571,20951,ManiMatter,2024-06-15T07:12:56Z,"> > What's the best way to generate a torrent without metadata?
> 
> Add a magnet link to session and pause it before its metadata are retrieved.

Thank you, I've been able to reproduce it. I'm a bit lost as to why this happens.
I tried validating the ""m_torrent"" before the isPrivate() like this, but it didn't do the trick:
https://github.com/qbittorrent/qBittorrent/blob/42a56f62e220bcc465092cedada5db6e6b95e249/src/gui/properties/propertieswidget.cpp#L314

Any ideas? "
2169248505,20951,stalkerok,2024-06-15T09:42:28Z,"> > What's the best way to generate a torrent without metadata?
> 
> Add a magnet link to session and pause it before its metadata are retrieved.

This can also be done by adding a non-existent magnet link or you can use an existing one by changing a few characters."
2170618833,20951,ManiMatter,2024-06-15T20:04:57Z,"> Problem in General tab in GUI only:
> 
> Select a private torrent
> Select a torrent without metadata
> Private field in General tab is not updated to ""No""

Does anybody have an idea how to solve it? "
2175661997,20951,ManiMatter,2024-06-18T09:39:46Z,"> > Problem in General tab in GUI only:
> > Select a private torrent
> > Select a torrent without metadata
> > Private field in General tab is not updated to ""No""
> 
> Does anybody have an idea how to solve it?

Anyone? Already a pointer where to look to find a solution would be appreciated. I‘m tapping in the dark as to why this happens.. 

In the WebAPI I see that the private status for torrents without metadata is false. However, switching in the gui (not the Webgui) from a private torrent to a torrent without metadata keeps the flag on ‚true‘, which makes me believe it is not false but null or something similar in the torrent data model, which causes the update to fail. 

I‘m lost as to how & where to tackle this. 

Thoughts anyone? Thanks for any pointers."
2176744575,20951,thalieht,2024-06-18T18:47:25Z,">Anyone? Already a pointer where to look to find a solution would be appreciated. I‘m tapping in the dark as to why this happens..

This will take care of it: https://github.com/qbittorrent/qBittorrent/pull/20951#discussion_r1640832571"
2184071836,20951,ManiMatter,2024-06-22T15:20:13Z,"> > Anyone? Already a pointer where to look to find a solution would be appreciated. I‘m tapping in the dark as to why this happens..
> 
> This will take care of it: [#20951 (comment)](https://github.com/qbittorrent/qBittorrent/pull/20951#discussion_r1640832571)

Hi @thalieht 
This change reverts to the state as I had it originally; the redundant torrent check I had added as an attempt to fix the problem you raised (without success). I reverted it (as @Chocobo1 suggested), but now of course we are back to step 1 where selecting a torrent without metadata will flag ""private: yes"" if selected after a private torrent in the GUI 

Any pointers still appreciated how to solve this; apologies you already have pointed me in the right direction and I have not picked it up 

"
2184085485,20951,thalieht,2024-06-22T16:09:54Z,"Something like this, (not sure if multiple conditional operators in the same line are allowed), also you missed this https://github.com/qbittorrent/qBittorrent/pull/20951#discussion_r1640867755 (added below)
```
--- a/src/gui/properties/propertieswidget.cpp
+++ b/src/gui/properties/propertieswidget.cpp
@@ -324,7 +324,10 @@ void PropertiesWidget::loadTorrentInfos(BitTorrent::Torrent
 *const torrent)
     m_ui->labelInfohash2Val->setText(m_torrent->infoHash().v2().isValid() ? m_t
orrent->infoHash().v2().toString() : tr(""N/A""));
     // URL seeds
     loadUrlSeeds();
-    if (m_torrent->hasMetadata())
+    const bool hasMetadata = m_torrent->hasMetadata();
+    // Private
+    m_ui->labelPrivateVal->setText(m_torrent->isPrivate() ? tr(""Yes"") : !hasMetadata ? tr(""N/A"") : tr(""No""));
+    if (hasMetadata)
     {
         // Creation date
         m_ui->labelCreatedOnVal->setText(QLocale().toString(m_torrent->creation
Date(), QLocale::ShortFormat));
@@ -335,10 +338,6 @@ void PropertiesWidget::loadTorrentInfos(BitTorrent::Torrent
 *const torrent)
         m_ui->labelCommentVal->setText(Utils::Misc::parseHtmlLinks(m_torrent->comment().toHtmlEscaped()));
 
         m_ui->labelCreatedByVal->setText(m_torrent->creator());
-
-        // Private
-        m_ui->labelPrivateVal->setText(m_torrent->isPrivate() ? tr(""Yes"") : tr(""No""));
-
     }
     // Load dynamic data
     loadDynamicData();
```"
2184100600,20951,glassez,2024-06-22T16:50:39Z,"@thalieht
I would rewrite it in slightly different way:
```c++
if (m_torrent->hasMetadata())
{
    // existing code

    m_ui->labelPrivateVal->setText(m_torrent->isPrivate() ? tr(""Yes"") : tr(""No""));
}
else
{
    m_ui->labelPrivateVal->setText(tr(""N/A""));
}
```"
2184155168,20951,glassez,2024-06-22T18:56:04Z,"> Adds private flag to GUI that is available in /info and /properties response
> 
> * WebUI & GUI: +""Private"" column in torrent list (hidden by default)
> * WebUI & GUI: +""Private"" flag in properties of selected torrent (""Information"" section)

It would be nice to see screenshots."
2184155181,20951,ManiMatter,2024-06-22T18:56:08Z,"@glassez @thalieht 

thanks for the inputs. Will have a look how to add this in the GUI/WebUI both for the table and the properties section. 
For the api responses of the /info and the /properties endpoint, the value returned for items that don't have metadata is still ""false"". I feel here we probably should not return the ""private"" flag at all, so that the absence of it is consistent with ""N/A"" behavior on frontend, and ""false"" means it's properly false. 

What do you think?"
2184175736,20951,ManiMatter,2024-06-22T20:11:37Z,"> > Adds private flag to GUI that is available in /info and /properties response
> > 
> > * WebUI & GUI: +""Private"" column in torrent list (hidden by default)
> > * WebUI & GUI: +""Private"" flag in properties of selected torrent (""Information"" section)
> 
> It would be nice to see screenshots.

### GUI:
<img width=""691"" alt=""image"" src=""https://github.com/qbittorrent/qBittorrent/assets/124743318/49a94c10-6df6-47f6-b437-ab0ed06c5e58"">

### WebUI:
<img width=""950"" alt=""image"" src=""https://github.com/qbittorrent/qBittorrent/assets/124743318/273556e8-29b0-4794-af32-fd8bd99dc52f"">
"
2184178185,20951,ManiMatter,2024-06-22T20:21:35Z,"Here's a summary of what I still see as open and where I'd appreciate pointers:
1) The `/properties` and the `/info` **API endpoints** return `private: false` for torrents without metadata. My view: ""private"" flag should not even be included. My hunch: That needs to be changed in the `serialize_torrent.cpp`. Do you agree?
https://github.com/qbittorrent/qBittorrent/blob/746ea00efcc8e6a1a2239f07e0c2dd2915d76551/src/webui/api/serialize/serialize_torrent.cpp#L166

2) Torrents without metadata return ""No"" in the **WebUI** in the table as well as the properties section. My hunch: Once above (1) is changed, the logic that I have already added should work. Let me know if you see it differently.

3) Torrents without metadata return ""No"" in the **GUI** in the table as well as the properties section. Here, I followed your [snippet](https://github.com/qbittorrent/qBittorrent/pull/20951#issuecomment-2184100600) above, but for some reason, it's ignored. Any pointers appreciated.

4) The bug that does not reset the private flag in the properties section of the **GUI** for torrents without metadata is still there. My hunch is that once (3) is resolved, this will be solved, too. Let me know if you see it differently.

> Problem in General tab in GUI only:
> 
> - Select a private torrent
> - Select a torrent without metadata
> - Private field in General tab is not updated to ""No"""
2184938138,20951,glassez,2024-06-23T10:38:14Z,"> 1. My hunch: That needs to be changed in the `serialize_torrent.cpp`. Do you agree?

No.
This serialization is also used by synchronization API support routines, which expects it to produce structures of the same layout (in order to be compared field by field). FYI, WebUI torrents table uses ""sync"" API, not ""torrents/info"".
The solution could be to return a ""null"" value if there is no metadata, e.g.:
```c++
 {KEY_TORRENT_PRIVATE, (torrent.hasMetadata() ? torrent.isPrivate() : QVariant()}),
```
But I think it would be easier to go the same way that is used in the main application code, i.e. provide ""hasMetadata"" field via WebAPI and use it in WebUI."
2184949986,20951,ManiMatter,2024-06-23T11:22:54Z,"> > 1. My hunch: That needs to be changed in the `serialize_torrent.cpp`. Do you agree?
> 
> No. This serialization is also used by synchronization API support routines, which expects it to produce structures of the same layout (in order to be compared field by field). FYI, WebUI torrents table uses ""sync"" API, not ""torrents/info"". The solution could be to return a ""null"" value if there is no metadata, e.g.:
> 
> ```c++
>  {KEY_TORRENT_PRIVATE, (torrent.hasMetadata() ? torrent.isPrivate() : QVariant()}),
> ```
> 
> But I think it would be easier to go the same way that is used in the main application code, i.e. provide ""hasMetadata"" field via WebAPI and use it in WebUI.

I think both make sense. I'd expect ""null"" to be returned for KEY_TORRENT_PRIVATE if it's neither true nor false (since no metadata), and that we return the hasMetadata as well, and then use this info in the WebUI"
2185014471,20951,ManiMatter,2024-06-23T14:35:18Z,"@glassez 
I have implemented [your suggestion](https://github.com/qbittorrent/qBittorrent/pull/20951#issuecomment-2184938138) for the /info API, and am struggling to do the same on the /properties API.

What works for now is that in case there is no metadata, I return ""-1"" for the ""private"" key, but in reality I think we should be returning ""null"" rather than ""-1"". Replacing ""-1"" with ""QVariant()"" seems not to work. Any ideas?


https://github.com/qbittorrent/qBittorrent/blob/5a0cc031f6c5d02d9523f9fc4ec5ac59dcc27463/src/webui/api/torrentscontroller.cpp#L481

Otherwise: N/A is now showing for the private-flag (GUI/WebUI both table as well as properties section) for torrents that don't have metadata "
2185036510,20951,glassez,2024-06-23T15:14:16Z,"> Replacing ""-1"" with ""QVariant()"" seems not to work.

Sure. After all, `QJsonObject` is being constructed here, not `QVariantMap`. So you should use `QJsonValue()` instead of `QVariant()`."
2185102953,20951,ManiMatter,2024-06-23T16:15:40Z,"> > Replacing ""-1"" with ""QVariant()"" seems not to work.
> 
> Sure. After all, `QJsonObject` is being constructed here, not `QVariantMap`. So you should use `QJsonValue()` instead of `QVariant()`.

That has worked beautifully. Now everything seems to work as expected. 

To merge this, do you see other changes needed?"
2185761699,20951,stalkerok,2024-06-24T07:03:50Z,"CI - Windows won't start, crashes."
2185783523,20951,ManiMatter,2024-06-24T07:16:54Z,"> CI - Windows won't start, crashes.

Thanks for spotting this. I unfortunately have no windows experience. Any ideas why it happens?"
2188846302,20951,ManiMatter,2024-06-25T12:47:14Z,"@stalkerok - is the Windows version still crashing after the additional changes from @Chocobo1 ?
If yes, are there any logs or anything that helps us understand why that might be the case?"
2189802627,20951,stalkerok,2024-06-25T19:22:19Z,"<details>
  <summary>Event Log</summary>
Имя сбойного приложения: qbittorrent.exe, версия: 5.0.0.0, метка времени: 0x667abeea

Имя сбойного модуля: MSVCP140.dll, версия: 14.36.32532.0, метка времени: 0x04a30cf0
Код исключения: 0xc0000005
Смещение ошибки: 0x0000000000012f58
Идентификатор сбойного процесса: 0x179c
Время запуска сбойного приложения: 0x01dac732e39f5c7d
Путь сбойного приложения: ...\qbittorrent test\5948 Add ability to display torrent privateness in UI\qBittorrent\qbittorrent.exe
Путь сбойного модуля: C:\Windows\SYSTEM32\MSVCP140.dll
Идентификатор отчета: f2f90df4-6265-45c2-8b09-6b9c79f1d527
Полное имя сбойного пакета: 
Код приложения, связанного со сбойным пакетом: 
</details>

[qbittorrent.exe.6044.dmp](https://github.com/user-attachments/files/15976999/qbittorrent.exe.6044.dmp)
"
2189811836,20951,ManiMatter,2024-06-25T19:27:13Z,"Thanks @stalkerok 
I just opened it on mac visual studio and it looks like something that can‘t be read, ie lots of gibberish characters. 

I think we need some help here from somebody who knows Windows…"
2189822296,20951,stalkerok,2024-06-25T19:33:16Z,Perhaps the language of my system plays a role in this.
2191591799,20951,ManiMatter,2024-06-26T12:39:32Z,"> Perhaps the language of my system plays a role in this.

Based on the logs above I suppose that is Russian/Cyrillic?

Is the crash also happening with the windows CI of the latest merge to the main branch or only in this feature branch? Trying to understand whether it‘s a general problem or specific to the changes here.
"
2191782490,20951,xavier2k6,2024-06-26T13:58:46Z,"```
Exception Information
MSVCP140!MTX_DO_LOCK+9CIn qbittorrent.exe.6044.dmp the assembly instruction at msvcp140!mtx_do_lock+9c in C:\Windows\System32\msvcp140.dll from Microsoft Corporation has caused an access violation exception (0xC0000005) when trying to read from memory location 0x0000[0](https://github.com/qbittorrent/qBittorrent/pull/20951#B1C1Thread3104)000 on thread 0
```

@stalkerok Can you grab/install latest Microsoft Visual C++ Redistributable & see if crash still happens.
[Microsoft Visual C++ Redistributable Latest Supported Downloads](https://docs.microsoft.com/en-US/cpp/windows/latest-supported-vc-redist?view=msvc-170#visual-studio-2015-2017-2019-and-2022)"
2195165402,20951,stalkerok,2024-06-27T16:26:20Z,"> Can you grab/install latest Microsoft Visual C++ Redistributable & see if crash still happens.

Great, there was no crash."
2195477962,20951,thalieht,2024-06-27T19:02:26Z,">Can you grab/install latest Microsoft Visual C++ Redistributable & see if crash still happens.

Turns out i didn't have the latest... all good now, thanks!"
2195494479,20951,stalkerok,2024-06-27T19:13:13Z,"If this will affect running the 5.0 release version, it is worth warning users to install the latest MSVC libraries."
2195512175,20951,xavier2k6,2024-06-27T19:25:24Z,"> If this will affect running the 5.0 release version, it is worth warning users to install the latest MSVC libraries.

~Requiring latest runtime only happens to our CI builds every once in a while, IIRC.~ Nope, see below.
____

Re-read [""Notes""](https://learn.microsoft.com/en-US/cpp/windows/latest-supported-vc-redist?view=msvc-170#notes)

>However, the version of the Microsoft Visual C++ Redistributable installed on the machine must be the same or higher than the version of the Visual C++ toolset used to create your application.

So, you may be right @stalkerok It actually may be recommended to do this or bundle it/run with installer.?!

We had a ticket before for ""runtime error"" #15544, unsure if #17254 & similar are related too in some way."
2198488619,20951,ManiMatter,2024-06-30T09:01:28Z,Shall we tag this to milestone 5.0?
2198500348,20951,glassez,2024-06-30T09:44:57Z,"> Shall we tag this to milestone 5.0?

I don't think this is a good idea for a PR that doesn't have a predictable completion date. It may not make it to v5.0 in time."
2198501694,20951,ManiMatter,2024-06-30T09:50:36Z,@glassez - I was under the impression that this one is pretty much done. Do you see remaining items that need to be addressed?
2198502579,20951,glassez,2024-06-30T09:54:29Z,"> @glassez - I was under the impression that this one is pretty much done. Do you see remaining items that need to be addressed?

Yes. At least https://github.com/qbittorrent/qBittorrent/pull/20951#discussion_r1657005692."
2209356963,20951,ManiMatter,2024-07-04T17:03:43Z,"> > @glassez - I was under the impression that this one is pretty much done. Do you see remaining items that need to be addressed?
> 
> Yes. At least [#20951 (comment)](https://github.com/qbittorrent/qBittorrent/pull/20951#discussion_r1657005692).

Do you see any other items outstanding?"
2212496821,20951,glassez,2024-07-07T16:10:15Z,"@ManiMatter 
Thank you!"
2212546180,20951,stalkerok,2024-07-07T19:29:16Z,"@ManiMatter, thanks!"
2214925480,20951,stalkerok,2024-07-08T18:44:19Z,"> Milestone
No milestone

Can this be added to 5.0?"
2214941453,20951,glassez,2024-07-08T18:53:04Z,"> > Milestone
> > No milestone
> 
> Can this be added to 5.0?

Did you test it carefully? Does it work as expected (display correct ""privateness"" value and ""N/A"" when torrent has no metadata received, sort correctly)?"
2214953737,20951,stalkerok,2024-07-08T19:00:12Z,I tested this before the final changes and it worked fine. I'll test again a little later to say for sure.
2215091110,20951,ManiMatter,2024-07-08T19:57:06Z,"> > Milestone
> > No milestone
> 
> Can this be added to 5.0?

Would it make sense that it goes together with https://github.com/qbittorrent/qBittorrent/pull/20833,  https://github.com/qbittorrent/qBittorrent/pull/20686, and https://github.com/qbittorrent/qBittorrent/pull/21041 since they are somewhat related?"
2215184303,20951,stalkerok,2024-07-08T20:15:57Z,"There seems to be something wrong with the sorting
GUI
![2024-07-08_225829](https://github.com/qbittorrent/qBittorrent/assets/63958081/c898da76-a948-47f2-940f-b9f3d557640b) ![2024-07-08_230033](https://github.com/qbittorrent/qBittorrent/assets/63958081/10b2be0a-1147-4177-846b-06fed8a2135d)

WEB UI
![2024-07-08_230552](https://github.com/qbittorrent/qBittorrent/assets/63958081/fe740d91-880d-490f-b184-e1edd7ba018a) ![2024-07-08_230610](https://github.com/qbittorrent/qBittorrent/assets/63958081/7fe45dc0-fa57-4943-96a0-ee7d4c0613be)"
2216800614,20951,glassez,2024-07-09T07:23:00Z,">There seems to be something wrong with the sorting

As for GUI:
https://github.com/qbittorrent/qBittorrent/pull/20951/files#r1669878145

As for WebUI:
The problem is most likely that it compares by string representation, and not by logical values, which I insisted on and which was eventually implemented (albeit with errors) in the GUI."
2216845700,20951,glassez,2024-07-09T07:45:10Z,"@stalkerok 
<del>Could you test #21039?</del>
Forget it! Seems the problem is more serious (provided `customCompare()` function is still unsuitable for `QVariant`)."
2217747122,20951,glassez,2024-07-09T13:28:14Z,"> Seems the problem is more serious (provided `customCompare()` function is still unsuitable for `QVariant`).

#21041 should take care about it."
219814228,5264,glassez,2016-05-17T18:43:05Z,"@evsh fix coding style!
"
219836432,5264,zeule,2016-05-17T20:03:39Z,"@evsh fix coding style!

WHERE?!
"
219941276,5264,glassez,2016-05-18T06:55:37Z,"``` c++
PluginVersion version (list.last());
```

Either remove space or use `{}` instead of `()`.

``` c++
typedef Version<T,N> this_type;
```

Should be `ThisType` according to our naming scheme.

``` c++
ComponentType majorNumber() const {
```

Move `{` to the start of next line.
And in other similar cases.

``` c++
bool operator == (const this_type &other) const
```

Function name (even if it is operator) shouldn't contain spaces except in parameter list (unless it's impossible, e.g. `operator bool()`).
And in other similar cases.

``` c++
Version (const QtStringsList &versionParts)
```

Function name shouldn't contain spaces except in parameter list.

And some inline commented violations...
And you wonder WHERE???
"
224690454,5264,sledgehammer999,2016-06-08T18:48:46Z,"I've finished my review.
"
224734751,5264,zeule,2016-06-08T21:30:16Z,"PR updated
"
270352584,5264,zeule,2017-01-04T11:40:23Z,@sledgehammer999 ping?
295777823,5264,glassez,2017-04-20T15:25:03Z,"IIRC, @sledgehammer999 isn't interested in Search Engine, so we can do it without his approval (unless it affects base or main gui code)."
295782521,5264,zeule,2017-04-20T15:34:23Z,"> so we can do it without his approval.

Great. I kind of interested in this one with respect to #6661."
295802407,5264,glassez,2017-04-20T16:29:19Z,"@evsh, this PR has conflicts as said by github."
295808073,5264,zeule,2017-04-20T16:44:04Z,Rebased.
295861244,5264,zeule,2017-04-20T19:05:01Z,"> are there any public constructors/methods that can throw exceptions (except the ones I commented on)?

No, there are no such constructors or methods."
296158135,5264,zeule,2017-04-21T10:41:48Z,"All the comments have been addressed, I hope?"
296164208,5264,glassez,2017-04-21T11:13:31Z,"Apparently, @Chocobo1 is not yet accustomed to his new duties ;) I mean to send the approval."
296164378,5264,zeule,2017-04-21T11:14:24Z,You did not approve too ;)
296168465,5264,glassez,2017-04-21T11:38:00Z,"Oops... Apparently, I did it in another PR."
296173474,5264,zeule,2017-04-21T12:06:28Z,Thanks to all who took part in the discussion!
296174321,5264,Chocobo1,2017-04-21T12:11:20Z,">Apparently, @Chocobo1 is not yet accustomed to his new duties ;) I mean to send the approval.

I kinda hesitate because often I only read the code and sometimes not have enough time to fully understand it.
Or I can just approve when the author addressed my comments?
"
296186698,5264,zeule,2017-04-21T13:12:36Z,But a) there are at least three of us who should check a change and b) we merge it into the unstable branch where the code will be tested for a while. 
296192164,5264,glassez,2017-04-21T13:35:24Z,"I don't think we should strive for a thorough understanding someone else's code, just need to understand its overall structure and logic. We must inspect it for any obvious errors, typos and coding style violations. We should also look at the interfaces of the new classes and their points of interaction with existing code. Other checks as possible."
296236333,5264,Chocobo1,2017-04-21T16:19:52Z,Thank you guys for the write-ups.
612454683,12480,glassez,2020-04-11T16:11:01Z,"@zeule, since you're here, I'll ask you as the original author of CMake support.
Why is qBittorrent built in several static libraries, and only then they are linked to the final executable file? What's the point?"
612455114,12480,FranciscoPombal,2020-04-11T16:13:18Z,"> Libtorrent exports required C++ standard version for its targets. It comes as a target compile feature to qBt. You might need to test that value, because liborrent ABI depends on it.

Do you mean finding the `--std=` flag in `LibtorrentRasterbar_DEFINITIONS` that is exported by the find package script?"
612457084,12480,zeule,2020-04-11T16:22:45Z,"> @zeule, since you're here, I'll ask you as the original author of CMake support.
> Why is qBittorrent built in several static libraries, and only then they are linked to the final executable file? What's the point?

Once upon a time I had an idea to make a run-time loaded modules for UIs (web, desktop). Unrelated to that, CMake at that time did not have a built-in command to append sources from subdirectories to targets. Static libraries were a compromise and workaround for these two. 

> Do you mean finding the `--std=` flag in `LibtorrentRasterbar_DEFINITIONS` that is exported by the find package script?

I refered to the `LibtorrentRasterbarTargets.cmake` file, which is installed if libtorrent is built with CMake, and it contains definition for the `LibtorrentRasterbar::torrent-rasterbar` target, which you need to link against. It contains `INTERFACE_COMPILE_FEATURES ""cxx_std_14""`. Therefore the C++14 standard will be forced for qBt, and you may not overwrite it. But yes, If you export libtorrent via pkg-config or another way, you have to figure that value out."
612458453,12480,FranciscoPombal,2020-04-11T16:29:01Z,"> I refered to the `LibtorrentRasterbarTargets.cmake` file, which is installed if libtorrent is built with CMake, and it contains definition for the `LibtorrentRasterbar::torrent-rasterbar` target, which you need to link against. It contains `INTERFACE_COMPILE_FEATURES ""cxx_std_14""`. Therefore the C++14 standard will be forced for qBt, and you may not overwrite it. But yes, If you export libtorrent via pkg-config or another way, you have to figure that value out.

I see, but I don't want to assume the way libtorrent was built/installed. Maybe I could add a case distinction: either libtorrent was built with CMake and we get the value from `LibtorrentRasterbarTargets.cmake`, or it was not, in which case a warning/info is printed to the user to make sure the standards align (what it does now). What do you think?"
612472940,12480,glassez,2020-04-11T17:34:32Z,">Once upon a time I had an idea to make a run-time loaded modules for UIs (web, desktop). 

Well, there seems no reason to keep it that way.
>Unrelated to that, CMake at that time did not have a built-in command to append sources from subdirectories to targets.

Seems [target_sources](https://cmake.org/cmake/help/v3.13/command/target_sources.html) should help."
612473891,12480,zeule,2020-04-11T17:39:01Z,"> I see, but I don't want to assume the way libtorrent was built/installed. Maybe I could add a case distinction: either libtorrent was built with CMake and we get the value from `LibtorrentRasterbarTargets.cmake`, or it was not, in which case a warning/info is printed to the user to make sure the standards align (what it does now). What do you think?

CMake libtorrent exports that to the pkg-config file too; you get it in `INTERFACE_COMPILE_OPTIONS` as far as I can see. Since pkg-config files can contain only GCC-style options, it is easy to check.

> Seems [target_sources](https://cmake.org/cmake/help/v3.13/command/target_sources.html) should help.

Yes, now it learned how to do that.

Update: seems like cmake 3.13 and newer can do that."
612512407,12480,jagannatharjun,2020-04-11T20:59:04Z,"Please test this on windows as well.
"
612514368,12480,FranciscoPombal,2020-04-11T21:11:14Z,"@zeule @glassez 
> > Seems [target_sources](https://cmake.org/cmake/help/v3.13/command/target_sources.html) should help.
> 
> Yes, now it learned how to do that.
> 
> Update: seems like cmake 3.13 and newer can do that.

I know this will probably be an unpopular opinion here, but I think we should not be afraid of requiring (very) recent CMake versions, to be able to take advantage of the ""modern CMake"" features. At first, you would think I'm crazy, because not everyone has the very latest CMake version, and it is often quite inconvenient to get the latest one, especially if, for example, it's not in the official distro's repositories, right? Well the situation is better than you think. Consider the following: 

- For bleeding-edge distros such as Arch, having the latest version was never a problem
- Ubuntu users can just use the official repo maintained by Kitware: https://apt.kitware.com/ (it's just strictly better than using the official repositories)
- Users of other distros not covered by the 2 cases above can use the binary installer at https://cmake.org/download/. This distribution can be unzipped to anywhere and run from there, it will not ""pollute"" the user's system directories
- As a very last resort, users with very weird setups can compile from source, which is not that bad in the case of CMake. I would expect the number of users who would actually need to do this to be very low, and if they have a very exotic setup, they knew what they were getting into anyway
- Windows/macOS users can just get the binary packages as they always do (https://cmake.org/download/); in particular, ""portable builds"" (no installer, just a zip file), are officially provided for WIndows

In light of this, the conclusion is that we could just move to `cmake_minimum_required(VERSION 3.17 FATAL_ERROR)` tomorrow, and there would be no problem, there are no disadvantages. This would enable evolving the CMake buildscripts faster with the new features, thus keeping them more maintainable and preventing them from becoming obsolete as easily. @zeule and other knowledgeable CMake users could just use the latest features and iterate faster without problems.

Let me know what you think, if I'm missing some critical flaw in this thought process."
612514933,12480,FranciscoPombal,2020-04-11T21:14:45Z,"@zeule 
> CMake libtorrent exports that to the pkg-config file too; you get it in `INTERFACE_COMPILE_OPTIONS` as far as I can see. Since pkg-config files can contain only GCC-style options, it is easy to check.

What if libtorrent is not build with CMake, but with `b2`? I still think it is important to not assume things about libtorrent was built, or to at least have an escape hatch for the ""not built with CMake"" case."
612516990,12480,zeule,2020-04-11T21:27:55Z,"> What if libtorrent is not build with CMake, but with `b2`? I still think it is important to not assume things about libtorrent was built, or to at least have an escape hatch for the ""not built with CMake"" case.

Absolutely agree that no assuming for libtorrent distribution mode should be made. My point is simply that forcing a different value for qBt you can break the build. "
612565717,12480,glassez,2020-04-12T05:14:51Z,">I know this will probably be an unpopular opinion here, but I think we should not be afraid of requiring (very) recent CMake versions, to be able to take advantage of the ""modern CMake"" features.

In such cases, I prefer to stick to the ""Golden mean"", i.e. not to look back at outdated or too conservative distros/OSes, but also not to chase the latest version unless absolutely necessary.
Although I, as a Windows user, can easily use the latest version of CMake, I still prefer to use the one that is shipped with the official Qt distro."
612610816,12480,FranciscoPombal,2020-04-12T13:02:28Z,"@zeule right now the patch prevents the user from using unsupported compilers, and from using a C++ standard lower than the minimum required one by qBittorrent itself.

In addition, I'd like it if it were possible to prevent the user from using a different C++ standard than the one libtorrent was built with (in the event CMake can detect that). Currently, that is not possible (the user may specify C++17 which will override a libtorrent definition of C++14). But fixing that is a little over my head right now, and the patch is already a straight improvement over the current situation, and I'd like to focus on other things. Plus the original intent of this patch was only to error out when a compiler that's too old is used.

So if the existing stuff is good, this could be merged, and the remaining wart can be ironed out in another PR."
612653663,12480,zeule,2020-04-12T18:00:11Z,"> I know this will probably be an unpopular opinion here, but I think we should not be afraid of requiring (very) recent CMake versions, to be able to take advantage of the ""modern CMake"" features.

I would suggest 3.16, which added built-in precompiled headers support."
612665644,12480,FranciscoPombal,2020-04-12T19:38:06Z,"> > I know this will probably be an unpopular opinion here, but I think we should not be afraid of requiring (very) recent CMake versions, to be able to take advantage of the ""modern CMake"" features.
> 
> I would suggest 3.16, which added built-in precompiled headers support.

@glassez is this acceptable? I just took a look at the Qt docs, looks like it's pretty easy to change between versions in Qt creator, and they even support the new file-based API in CMake 3.14+ (which looks like some sort of LSP, if I understood it correctly)."
612936191,12480,glassez,2020-04-13T15:01:25Z,">@glassez is this acceptable? 

3.16 is acceptable for me (since it is shipped with the latest Qt)."
612946325,12480,zywo,2020-04-13T15:23:37Z,"Latest Ubuntu 18.04 LTS > cmake 3.10.2
Latest Debian stable > cmake 3.13.4"
612951456,12480,glassez,2020-04-13T15:35:17Z,">Latest Ubuntu 18.04 LTS > cmake 3.10.2

It is too old to follow it. In addition, libtorrent requires 3.12.
>Latest Debian stable > cmake 3.13.4

Personally, I'm not pushing for a raise at all. I just said that any version up to 3.16 would be fine with me, But I don't think we should raise it for no good reason."
612967629,12480,zywo,2020-04-13T16:13:08Z,"For me, it's not a problem, I'm always using these Linux distributions:
Arch Linux, Debian Unstable and Ubuntu development branch."
612994419,12480,FranciscoPombal,2020-04-13T17:12:29Z,"@zywo 

> Latest Ubuntu 18.04 LTS > cmake 3.10.2
> Latest Debian stable > cmake 3.13.4

That doesn't matter. Se my reasoning in this comment:
https://github.com/qbittorrent/qBittorrent/pull/12480#issuecomment-612514368"
613008260,12480,glassez,2020-04-13T17:42:52Z,"In any case, we will not increase minimal CMake version requirements alone. It can be considered only as part of some project changes that require such an increase.

The only thing that comes to my mind is to get rid of these intermediate linkings (discussed above)."
616133592,12480,glassez,2020-04-19T13:22:38Z,">>The only thing that comes to my mind is to get rid of these intermediate linkings (discussed above).
>>
>>Seems `target_sources` should help.
>
>Yes, now it learned how to do that.
>
>Update: seems like cmake 3.13 and newer can do that.

Seems it is possible long time ago. @zeule, CMake 3.1.3 allows it (not 3.13). `target_sources` is even used in some place of qBittorrent CMake configuration as I'v noticed recently."
619403977,12480,Chocobo1,2020-04-25T16:19:47Z,"Pardon me, I'm not so familiar with cmake system, if you guys approve it, then I'm ok with it too, no need to wait for my review/approval.
EDIT: On a closer look, the changes looks nice, well done!"
619580365,12480,glassez,2020-04-26T16:29:08Z,"Unfortunatelly now TravisCI CMake based configurations fail on Linux due to unsupported compiler (gcc-5.4).
@sledgehammer999, can we use newer compiler?"
619586248,12480,FranciscoPombal,2020-04-26T17:04:28Z,"@glassez I'm all for using newer compilers, but this should still work with GCC 5.x: https://gitlab.kitware.com/cmake/cmake/blob/master/Modules/Compiler/GNU-CXX.cmake (Ctrl+F `CMAKE_CXX14_STANDARD__HAS_FULL_SUPPORT`)"
619594806,12480,glassez,2020-04-26T17:54:56Z,">this should still work with GCC 5.x: 

It doesn't! https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/679556514#L716"
619606985,12480,FranciscoPombal,2020-04-26T19:05:23Z,"@glassez 
> > this should still work with GCC 5.x:
> 
> It doesn't! https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/679556514#L716

Yeah, I saw that.

The error message reads:

> CMake Error at cmake/Modules/FunctionQbtCXXCompilerAndModeCheck.cmake:4 (message):

That is:

```
line 3    if(NOT CMAKE_CXX${_min_std}_STANDARD__HAS_FULL_SUPPORT)
line 4        message(FATAL_ERROR ""${PROJECT_NAME} requires a compiler with full C++${_min_std} support"")
line 5    endif()
```

Where in this case, `${_min_std}` is `14`. Which means `CMAKE_CXX14_STANDARD__HAS_FULL_SUPPORT` is `False`, so CMake thinks GCC 5.x does not have full C++14 support. But according to https://gitlab.kitware.com/cmake/cmake/blob/master/Modules/Compiler/GNU-CXX.cmake, it believes the opposite. How can this be?

Anyway, if simply switching to a more recent GCC version fixes the problem, I don't really care about the root cause of this."
619608447,12480,FranciscoPombal,2020-04-26T19:13:03Z,"@glassez I figured it out. Turns out we need CMake >= 3.15.0 to have access to the `*__HAS_FULL_SUPPORT` variables.

You previously stated you and @zeule would be OK with bumping the minimum supported CMake version to 3.16. @sledgehammer999 are you also on board with this?"
619722950,12480,glassez,2020-04-27T05:09:29Z,Can we just copy https://gitlab.kitware.com/cmake/cmake/blob/master/Modules/Compiler/GNU-CXX.cmake into qBittorrent own cmake/Modules directory and use it with older CMake versions?
619946144,12480,FranciscoPombal,2020-04-27T12:12:33Z,"@glassez 
> Can we just copy https://gitlab.kitware.com/cmake/cmake/blob/master/Modules/Compiler/GNU-CXX.cmake into qBittorrent own cmake/Modules directory and use it with older CMake versions?

I strongly disagree with this. Would you rather frankenstein our cmake setup with bits and pieces from different versions instead of just requiring a more recent version? Who exactly are we trying to please and cater to here? Lazy people who don't want to upgrade their CMake version, when there is no excuse not to do so, as I've pointed out before(https://github.com/qbittorrent/qBittorrent/pull/12480#issuecomment-612514368)?

We should not compromise our development experience and introduce technical debt just because someone does not want to update a piece of infrastructure that according to all modern best practices, is _supposed_ to be kept up-to-date (very easily!). There is literally no excuse to be using anything other than the most recent CMake version (I consider the one bundled with Qt to be an acceptable compromise for the sake of convenience though, as it's just one version less than the most recent one, and they seem quick to update it)."
619964045,12480,glassez,2020-04-27T12:48:02Z,">Would you rather frankenstein our cmake setup with bits and pieces from different versions 

Sorry, I don't  suggest you to patch older CMake sources/binaries. It's just ""yet another module"", isn't it?
>Who exactly are we trying to please and cater to here? Lazy people who don't want to upgrade their CMake version, when there is no excuse not to do so, as I've pointed out before?

At least we have to wait for some ""lazy people"" that update our TravisCI environment...
>someone does not want to update a piece of infrastructure that according to all modern best practices, is supposed to be kept up-to-date (very easily!). There is literally no excuse to be using anything other than the most recent CMake version 

I wonder why many Linux distros provide so outdated CMake?"
619978126,12480,eli-schwartz,2020-04-27T13:14:28Z,"Sometimes, projects using cmake have interesting requirements, like ""must compile on Debian Jessie (oldstable)"" without changes. Debian Jessie (oldstable) is, as the name indicates, ""old"", so I don't know why this matters to people as users of such distros will no doubt also want old versions of the project, e.g. qbittorrent...

I once had to deal with this exact case and exact justification here: https://github.com/weechat/weechat/pull/1421

Honestly, I see no reason not to bump the the minimum version. But *if* you absolutely must support people on very old versions of debian who want to use the system cmake and nothing else (while building the latest git master of qbittorrent!), then vendoring in parts of newer cmake will... ""work"".



> I wonder why many Linux distros provide so outdated CMake?

Travis CI *only* provides outdated versions of distros, and only provides one distro (Ubuntu). It's not an accurate yardstick. You can get a better overview from https://repology.org/project/cmake/versions

You can get modern CI on https://man.sr.ht/builds.sr.ht/compatibility.md, BTW.
(It is also a provider for Github commits/PRs, not just its own git repository hosting.)"
620013940,12480,FranciscoPombal,2020-04-27T14:13:25Z,"@glassez @eli-schwartz 

> Honestly, I see no reason not to bump the the minimum version. But if you absolutely must support people on very old versions of debian who want to use the system cmake and nothing else (while building the latest git master of qbittorrent!), then vendoring in parts of newer cmake will... ""work"".

Exactly, I don't think we should cater to users ""who want to use the system cmake and nothing else"". That is irrational laziness at our expense. Not to mention that even if they really want to keep the system cmake binary, a modern version of cmake can even be used alongside it without replacing it.

> I wonder why many Linux distros provide so outdated CMake?

So because a practice is widespread, does it mean it's good? Would you consider ""I wonder how many distros ship outdated qbittorrent"" a good argument? Because recently even @sledgehammer999 complained (and rightfully so) about the newly-released Ubuntu 20.04 only including qbittorrent v4.1.7, a 6-month old version, that will presumably not be updated for the whole duration of the LTS.

The answer to to ""why many Linux distros provide so outdated CMake?"" is: because they are flawed. It's a mistake, plain and simple. If they cannot provide updated CMake on a regular basis, that's a limitation that has to be worked around, not catered to or something that should be ""supported"" by us.

Imagine if it were acceptable for Ubuntu to never update Firefox past the version present in the initial release of an LTS. Fortunately, they opened an exception for that a long time ago to fix that broken behavior, they now opened an exception for NVIDIA drivers, and if they had more resources (or allocated them properly, instead of bullshit like snaps) they would keep CMake and other software also up-to-date by default. For now, that burden falls on the user, but, like I said, it is trivial to stay on an updated version of CMake.

> Sorry, I don't suggest you to patch older CMake sources/binaries. It's just ""yet another module"", isn't it?

It's needless technical debt. I don't think our benchmark for an acceptable addition to the project should be so low as to be ""Well, at least I don't need a patched CMake binary!"".

> At least we have to wait for some ""lazy people"" that update our TravisCI environment...

I don't assume the maintainer is _being_ irrationally lazy. Until proven otherwise, they just haven't had time to do it.
"
620035677,12480,eli-schwartz,2020-04-27T14:50:30Z,"> I don't assume the maintainer is _being_ irrationally lazy. Until proven otherwise, they just haven't had time to do it.

This will probably happen as soon as travis-ci.com updates to provide a Ubuntu 20.04 image, which might take a while... unless they provide their own copy of cmake instead of the one Ubuntu ships.

Ubuntu 20.04 is brand new, so this may take some time... even Ubuntu 19.10 according to repology has cmake 3.13.4, but you're using 16.04 and Travis only natively supports {12,14,16,18}.04.

I suppose you could use docker containers for Ubuntu 20.04, Debian Bullseye, Fedora >= 30, OpenSUSE 15.2 or Tumbleweed, Solus, or my personal favorite, Arch Linux. As mentioned above, some alternative CI providers provide native images for these modern distros."
620036900,12480,zeule,2020-04-27T14:52:33Z,"> Imagine if it were acceptable for Ubuntu to never update `<whatever>`

@FranciscoPombal, there is a big difference between an end-user software like Firefox that has no reverse dependencies and a library or a build tool. Because the next package your are going to complain about in an LTS distribution is a compiler, then system libs and at that stage LTS releases make no sense.

There are plenty of rolling-release distributions, but those like Fedora and Ubuntu have a clear policy: only security updates after release. They have to treat any browser update as security one because of the mess created and beloved by web developers.


"
620041943,12480,glassez,2020-04-27T15:01:08Z,">I wonder why many Linux distros provide so outdated CMake?

It was a rhetorical question. 
Seems Linux way of distribution (aka ""distro at once"") is not so good after all...
>I don't assume the maintainer is being irrationally lazy.

I mean, we can't go any further with it until it's able to build on Travis."
620055564,12480,zeule,2020-04-27T15:24:26Z,"> I mean, we can't go any further with it until it's able to build on Travis.

You just need to decide on CMake version and add a repo with recent CMake packages  to Travis."
620061149,12480,FranciscoPombal,2020-04-27T15:33:33Z,"@zeule 
> @FranciscoPombal, there is a big difference between an end-user software like Firefox that has no reverse dependencies and a library or a build tool. Because the next package your are going to complain about in an LTS distribution is a compiler, then system libs and at that stage LTS releases make no sense.

Slippery-slope fallacy? I agree that on a stable distro, critical infrastruture like the compiler and system libs should be pinned at a certain version/maintained by backports.
But ""leaf-node"" software should receive more updates, and I consider cmake to be such software. If there is stuff with a hard-dependency on a specific old cmake version, they're doing it wrong. It's _that_ package that needs to be patched, not everyone else forced to be stuck with an old version of cmake.

But even if that is not the case, the target audience for cmake is not everyone and their granny. It's developers and some power users interested in building software. They are more than capable of installing the latest version from the official CMake PPA (in the case of Ubuntu). Kitware provided the PPA because they know there is a significant Ubuntu user base, and they wanted to provide a way of _doing things properly_, i.e.using the latest CMake version, on Ubuntu that's as friction-less and integrated as possible.

---

Bonus: here are the packages that depend on CMake in Ubuntu 18.04 LTS:

```
$ apt-cache rdepends --no-recommends --no-suggests --no-enhances cmake | egrep ""[ ]+.*"" | sort | uniq
  abi-monitor
  autobahn-cpp-dev
  catkin
  cmake-curses-gui
  cmake-dbgsym
  cmake-extras
  cmake-fedora
    cmake:i386
  cmake-qt-gui
  debhelper
  hhvm-dev
  kde-sc-dev-latest
  libc6-dev
  libcamitk-dev
  libdolfin-dev
  libotb-dev
  libsundials-dev
  lxqt-build-tools
  python3-instant
  python-instant
```
All these packages either don't specify a dependency version at all, or they specify a minimum one. None of them specify a maximum or fixed version."
620061709,12480,glassez,2020-04-27T15:34:12Z,">You just need to decide on CMake version

As I said I'm OK with any version up to the one that is shipped with Qt distro (aka 3.16).
>add a repo with recent CMake packages to Travis.

@sledgehammer999, can you update CMake on Travis?"
620062898,12480,FranciscoPombal,2020-04-27T15:36:23Z,">It was a rhetorical question.
>Seems Linux way of distribution (aka ""distro at once"") is not so good after all...

There's pros and cons to each distribution model. The official binary packages provided by Kitware make updating CMake a complete non-issue on any distro."
620301702,12480,sledgehammer999,2020-04-28T00:13:09Z,">@sledgehammer999, can we use newer compiler?

The oldest OS version supported by our PPA is 18.04 (bionic). Our current `travis.yml` is locked onto the older version of `xenial`. Luckily travis now supports bionic too. It should be relatively trivial to switch to bionic there.
Bionic comes with gcc 7.4.0 and cmake 3.10.2. I don't know if that is enough for what you're talking here (I haven't read the whole thread)

I don't know if I have time to make the switch. Usually @Chocobo1 did those in the past.

>@sledgehammer999, can you update CMake on Travis?

I don't directly control this. We either use whatever version Ubuntu provides or try to find a 3rd party PPA that has a newer CMake."
620302754,12480,sledgehammer999,2020-04-28T00:16:52Z,">Bionic comes with gcc 7.4.0 and cmake 3.10.2.

Travis however has [cmake 3.12.4](https://docs.travis-ci.com/user/reference/bionic/#compilers-and-build-toolchain) for bionic."
620303479,12480,zeule,2020-04-28T00:19:25Z,"Here are the CMake PPA links: https://apt.kitware.com/

Edit: pardon, not a PPA, of course, but a repository. Anyway, it goes to the `- sourceline:` in the same way."
620306534,12480,eli-schwartz,2020-04-28T00:30:36Z,"> Because the next package your are going to complain about in an LTS distribution is a compiler, then system libs and at that stage LTS releases make no sense.

Arch Linux has 3822 packages which depend on the gcc compiler libs *at runtime*, i.e. libgcc_s.so (1748) and libstdc++.so (2074), and the numbers are probably not hugely smaller on Debian or Fedora.

Runtime dependencies are obviously a problem for stability. Conversely, cmake is only ever needed at build time, and if it fails to work, no packages break (but distro engineering may stutter until things are reverted or otherwise fixed, which affects precisely 0 users). Developers will also care if cmake breaks, yes, but that's a very targeted userbase in comparison to ""every elderly grandparent whose grandchildren installed debian for them"".

Also, cmake is far less complicated than a compiler. Both in the sense that there's less to regress, and in the sense that it's a lot easier to download a prebuilt distro-independent copy of any version from Kitware and simply shove it into $HOME and use it without otherwise interfering with your entire system. It's easily standalone.

There are very obvious reasons why one might expect users to install cmake on their own, but not ""the compiler and the whole base system"".

> There are plenty of rolling-release distributions, but those like Fedora and Ubuntu have a clear policy: only security updates after release. They have to treat any browser update as security one because of the mess created and beloved by web developers.

Then why do users use such a distro, and then try to upgrade qbittorrent for reasons other than a security update? :p"
620306717,12480,sledgehammer999,2020-04-28T00:31:03Z,PR for switching to bionic #12680
620307482,12480,sledgehammer999,2020-04-28T00:33:23Z,">Here are the CMake PPA links: https://apt.kitware.com/

Does that mean that we will depend on latest CMake?
Personally I don't care, because CMake is not the primary build system for qbt (thus I don't care much about it)."
620310980,12480,zeule,2020-04-28T00:46:46Z,"@eli-schwartz, cmake is a part of the build toolchain and deciding to always update it to the latest version once can ask why the other  toolchain packages should not follow the same policy? As a Gentoo user for my laptop and Arch for every other machine/raspberry pi box in my house, I can't understand why people choose Ubuntu or Fedora and then want fresh software. Even Microsoft switched over to the rolling-release scheme.

 >  Does that mean that we will depend on latest CMake?

Yes, their repo should contain the latest version.

> Personally I don't care, because CMake is not the primary build system for qbt.

But it will probably become the primary one with Qt 6?"
620314255,12480,sledgehammer999,2020-04-28T00:59:23Z,">But it will probably become the primary one with Qt 6?

I don't know. But if we're forced to use cmake then we shouldn't depend on the bleeding edge of it."
620318880,12480,zeule,2020-04-28T01:13:48Z,"Qt guys say qmake will be around for a time being after Qt 6 release, and as of now they depend on cmake 3.15.0. It is not possible to force cmake version 3.x to work as 3.y (y < x, of course) or at least check what is incompatible with versions > 3.y. CMake policies do solve a part of this task, but when you access raw variables, like this PR does, nothing can be done automatically. "
620483711,12480,FranciscoPombal,2020-04-28T09:14:51Z,"@sledgehammer999 
>> Does that mean that we will depend on latest CMake?
> I don't know. But if we're forced to use cmake then we shouldn't depend on the bleeding edge of it.

No, it means we'll _use_ the latest version of CMake, but not _depend_ on it. The only constraint is whatever we set as `cmake_minimum_required` in our `CMakeLists.txt`. CMake provides extremely good backwards compatibility with the policy system, if that's needed. The real problem comes when you try to use stuff from more recent versions of CMake and then run the script with an older version, which is the problem this PR is running into right now."
620562338,12480,FranciscoPombal,2020-04-28T12:02:12Z,"@sledgehammer999 to add to my previous response: a newer version of CMake will adapt its behavior depending on the policies set. This enables it to emulate behavior of previous versions, if that is needed. Thus, using a version that's as recent as possible provides maximum flexibility for using new or old functionality. In this case, that could either be the very bleeding edge or the version bundled with Qt, which is not that far behind (3.16 vs 3.17)."
620580080,12480,sledgehammer999,2020-04-28T12:39:21Z,"@FranciscoPombal could you rebase on top of master? I want to add a commit for the cmake PPA. (it is needed for this PR, right?)"
620586862,12480,FranciscoPombal,2020-04-28T12:52:36Z,"> @FranciscoPombal could you rebase on top of master? I want to add a commit for the cmake PPA. (it is needed for this PR, right?)

@sledgehammer999 
Done"
620591908,12480,glassez,2020-04-28T13:01:47Z,"@FranciscoPombal, since this ""feature"" won't work correctly with current minimum CMake version we can't consider it out of minimum version change."
620593296,12480,FranciscoPombal,2020-04-28T13:04:27Z,"@glassez 
> @FranciscoPombal, since this ""feature"" won't work correctly with current minimum CMake version we can't consider it out of minimum version change.

Should I bump the minimum required CMake version in another commit or in another PR altogether?"
620594070,12480,sledgehammer999,2020-04-28T13:05:50Z,I've pushed a commit in this PR that should make travis use cmake from the  https://apt.kitware.com/ repo.
620597042,12480,glassez,2020-04-28T13:10:51Z,">Should I bump the minimum required CMake version in another commit or in another PR altogether?

Here. As I said (in other words) it breaks CMake project without correct minimum CMake version."
620598932,12480,sledgehammer999,2020-04-28T13:14:06Z,"and bionic fails with:
```
qBittorrent requires a compiler with full C++14 support
```

so gcc 7.4.0 is not enough? Maybe ""FULL SUPPORT"" is a bit strict?"
620601018,12480,FranciscoPombal,2020-04-28T13:17:48Z,"@sledgehammer999 looking at the Travis log and config in https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/680544335, it does not look like it's pulling in cmake from the Kitware repo.
Build should work even with GCC 5.x, as I tested it."
620604568,12480,FranciscoPombal,2020-04-28T13:22:47Z,"@sledgehammer999 
Yep, looks like you need to run ~`sudo apt update && sudo apt upgrade`~ (EDIT don't do this, Travis CI docs say you should not do this) (or just `sudo apt install cmake`) after the Kitware repo gets added, otherwise cmake will not be updated at all: https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/680549407#L945"
620606621,12480,glassez,2020-04-28T13:26:03Z,"@FranciscoPombal, your commit s order is incorrect (the first commit depends on the second one) so please either change the order or just squash them."
620610005,12480,sledgehammer999,2020-04-28T13:31:48Z,@FranciscoPombal I think I fixed the cmake install issue. Apparently we depended on the preinstalled cmake from travis. Now I added the package to the install list of the yaml. It should pull the new version from the repo.
620611379,12480,sledgehammer999,2020-04-28T13:34:15Z,"ok you clobbered my commit, but oh well... almost the same change"
620612442,12480,FranciscoPombal,2020-04-28T13:36:03Z,"Oops, sorry about that, I did not see yours in time. Is it ok?"
620614666,12480,sledgehammer999,2020-04-28T13:39:49Z,">Is it ok?

Yeah. Same effect. I just had put `cmake` after `colormake` instead. No big deal."
620616281,12480,FranciscoPombal,2020-04-28T13:42:41Z,"@sledgehammer999 build still fails, but how is the older version of CMake still being used? See https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/680563866#L956. According to https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/680563866#L264, the most recent version is installed."
620619706,12480,sledgehammer999,2020-04-28T13:48:59Z,"The new one is indeed installed if you look inside the `Adding APT Sources` section of the log.
```
Selecting previously unselected package cmake.
Preparing to unpack .../38-cmake_3.17.1-0kitware1_amd64.deb
```

I don't see anything else related. But somehow the old cmake gets still used. I hope that the new cmake doesn't use a different binary name..."
620621385,12480,sledgehammer999,2020-04-28T13:51:51Z,"It seems this is a known ""problem"" with installing newer cmake: https://travis-ci.community/t/install-cmake-using-apt-again/4062

I will try the suggestion mentioned there to see if it works."
620624210,12480,FranciscoPombal,2020-04-28T13:56:48Z,The kitware apt repo installs to the same binary location as the regular package (`/usr/bin/cmake`). The binary installer installs to `/usr/local/bin/cmake`. Travis probably has some weird configuration going on.
620625176,12480,zeule,2020-04-28T13:58:27Z,"I do the following for Travis:
```
# There is an outdated cmake in /usr/local/cmake-<version> which we don't want to use
# but /usr/local/cmake-<version>/bin is in $PATH, therefore
# remove all paths containing 'cmake' to use the executable from /usr/bin
export PATH=`echo ${PATH} | awk -v RS=: -v ORS=: '/cmake/ {next} {print}'`
```"
620632596,12480,FranciscoPombal,2020-04-28T14:11:34Z,"@sledgehammer999 
Build is working :tada:"
620634622,12480,sledgehammer999,2020-04-28T14:14:56Z,"OK, I am off then. The fate of this PR is upon the other people that got involved here."
620657367,12480,FranciscoPombal,2020-04-28T14:53:25Z,Simplified the function name to be more obvious (it is now called `qbt_minimum_cxx_mode_check`) and added documentaion/description at the top.
621614842,12480,Chocobo1,2020-04-30T05:05:51Z,"In case nobody noticed, cmake builds are still failing: 
https://travis-ci.org/github/qbittorrent/qBittorrent/builds/681330610
https://travis-ci.org/github/qbittorrent/qBittorrent/builds/680604186"
621634478,12480,glassez,2020-04-30T06:13:38Z," >Build is working 🎉

Oops... I shouldn't have believed you. 
Travis still uses the old CMake version for some reason."
621718420,12480,FranciscoPombal,2020-04-30T09:22:46Z,"@glassez 
> > Build is working tada
> 
> Oops... I shouldn't have believed you.

You don't have to believe me, look at the logs yourself:

https://travis-ci.org/github/qbittorrent/qBittorrent/builds/680583464
https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/680583475
https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/680583476

Linux builds with CMake were working.

> Travis still uses the old CMake version for some reason.

Looking into it right now."
621723865,12480,FranciscoPombal,2020-04-30T09:34:11Z,@glassez https://github.com/qbittorrent/qBittorrent/pull/12707
601299102,12205,glassez,2020-03-19T17:00:17Z,What's the point of the first commit?
601302912,12205,FranciscoPombal,2020-03-19T17:07:44Z,"Also I sneaked in a fix for a ""static member access through instance"" clang tidy warning. The reason this commit is here as well is because I expect this will not be the only code related change (see the TODOs). Feel free to ignore it, I can remove it later."
601322798,12205,Chocobo1,2020-03-19T17:46:36Z,"You probably already seen these, so this will be just a note for myself (and anyone who hasn't):
https://liw.fi/manpages/
http://man7.org/linux/man-pages/man7/man-pages.7.html

"
601323767,12205,FranciscoPombal,2020-03-19T17:48:35Z,"@Chocobo1

> You probably already seen these, so this will be just a note for myself:
> https://liw.fi/manpages/
> http://man7.org/linux/man-pages/man7/man-pages.7.html

Yeah, and I forgot to mention: I took inspiration from several man pages, but mostly from the GNU `grep(1)` man page."
601736508,12205,FranciscoPombal,2020-03-20T14:43:41Z,"@Chocobo1 @glassez @thalieht @NotTsunami 

Ok, I'd like to start hearing your opinions about the TODOs. Let's start with these:

1. Is the option precedence well documented now, or is it wrong is some way?
2. Why do some boolean flags take an explicit boolean argument while others don't? Should that be changed? Example: `sequential` and `--add-paused`.
3. Did I miss any file for the `FILES` section?"
601863668,12205,thalieht,2020-03-20T19:00:54Z,"3. Since you document everything, i have a `.config/qBittorrent/rss/download_rules.json` 
file.

No idea about 1 and 2."
601901921,12205,FranciscoPombal,2020-03-20T20:42:06Z,"I fixed the majority of the TODOs. Now I only need help with clarification about the behavior of option precedence, and the options that take boolean parameters.

All the rest is pretty much ready. I am quite sure about everything I wrote so far (besides the option precedence), as I tested extensively and looked a bit a the source code while I was writing. Still, I would appreciate proof reading and testing to ensure the man page faithfully describes the program's behavior."
601902446,12205,FranciscoPombal,2020-03-20T20:43:30Z,"@thalieht 

>     1. Since you document everything, i have a `.config/qBittorrent/rss/download_rules.json`
>        file.
> 

What is the origin and purpose of that file? If you can post here a nice description I can include that straight away."
602036368,12205,FranciscoPombal,2020-03-21T12:18:49Z,Reminder to anyone who wants to see what the finished result looks like; you can just do `cd qBittorrent/doc ; man ./qbittorrent.1`
602043121,12205,thalieht,2020-03-21T13:23:54Z,">What is the origin and purpose of that file? If you can post here a nice description I can include that straight away.

I've never used RSS so i don't even know how it works. I was just messing around with the settings trying to reproduce some reported bug. Here's the contents if you can make sense:
```
{
    ""test"": {
        ""addPaused"": false,
        ""affectedFeeds"": [
            ""http://"",
            ""test""
        ],
        ""assignedCategory"": """",
        ""createSubfolder"": null,
        ""enabled"": true,
        ""episodeFilter"": """",
        ""ignoreDays"": 6,
        ""lastMatch"": """",
        ""mustContain"": """",
        ""mustNotContain"": """",
        ""previouslyMatchedEpisodes"": [
        ],
        ""savePath"": """",
        ""smartFilter"": true,
        ""useRegex"": false
    }
}
```"
602044430,12205,glassez,2020-03-21T13:36:51Z,RSS related files have no stable format and aren't supposed to be edited manually so you shouldn't mention them in documentation.
602074517,12205,FranciscoPombal,2020-03-21T17:15:35Z,"@glassez 
> RSS related files have no stable format and aren't supposed to be edited manually so you shouldn't mention them in documentation.

How about I just mention they exist but note their contents are not stable? Or is their existence and naming also not stable?"
602076077,12205,glassez,2020-03-21T17:28:28Z,">How about I just mention they exist but note their contents are not stable? Or is there existence and naming also not stable?

I think you can meantion them without detailed description of their formats. Otherwise you will need to update documentation after each RSS subsystem improvement that affects these files structure.

Although in fact, they do not change often due to the slow development of RSS subsystem."
602077964,12205,FranciscoPombal,2020-03-21T17:43:37Z,"> I think you can meantion them without detailed description of their formats. Otherwise you will need to update documentation after each RSS subsystem improvement that affects these files structure.
> 
> Although in fact, they do not change often due to the slow development of RSS subsystem.

That makes sense. I was not planning to document the file format anyway (I haven't done for the others either). I just want to list what each file is and what they are for at a high level. For example, the description of `~/.config/qBittorrent.conf` is just `Main configuration file.`

What do you think would be a good short description for `~/.config/qBittorrent/rss/download_rules.json`, similar to that of the main configuration file?"
602080838,12205,glassez,2020-03-21T18:05:32Z,">What do you think would be a good short description for `~/.config/qBittorrent/rss/download_rules.json`, similar to that of the main configuration file?

`RSS auto downloading rules` or `RSS auto downloading rules configuration file`."
602143288,12205,FranciscoPombal,2020-03-22T03:42:32Z,"I decided to leave the discussion about changing the `--add-paused` and `--skip-dialog` to be simple switches without parameters for another time.

The whole GUI man page is pretty much finalized. I just need confirmation from @glassez and @Chocobo1 that what I wrote in the `DESCRIPTION` about option source precedence is correct.

After that is solved, I'll remove the corresponding last remaining TODO, copy paste most of the contents to the nox man page and adjust accordingly, and open up the PR for final review and proof-reading."
602148890,12205,glassez,2020-03-22T05:06:51Z,">changing the `--add-paused` and `--skip-dialog` to be simple switches without parameters 

Sorry, why we should do it? As far as I remember they represent tri-state values so omitted parameter means ""use default""."
602191901,12205,FranciscoPombal,2020-03-22T12:25:39Z,"@glassez 
> Sorry, why we should do it? As far as I remember they represent tri-state values so omitted parameter means ""use default"".

Isn't it inconsistent with `--first-and-last`, `--sequential`, etc? These options are off by default, and turn on if the flag is specified. No need for `=true` or `=false`.
Is there is a good reason for this inconsistency?"
602193460,12205,glassez,2020-03-22T12:37:05Z,">Isn't it inconsistent with `--first-and-last`, `--sequential`, etc? These options are off by default, and turn on if the flag is specified. 

If user is allowed to set default values for these changes the appropriate command-line switches should behave the same way as ""add paused"" etc. Otherwise there is no inconsistency."
602228564,12205,FranciscoPombal,2020-03-22T15:43:55Z,"@glassez 
> If user is allowed to set default values for these changes the appropriate command-line switches should behave the same way as ""add paused"" etc. Otherwise there is no inconsistency.

I see. In that case, everything is consistent except `--no-splash`, which does not take parameters, but is on by default and the user can change the default in the preferences UI. So it should take parameters. But that can be handled in a separate PR."
608012160,12205,Chocobo1,2020-04-02T17:56:33Z,"@FranciscoPombal 
Do you plan to finish this in near future (before next release)? IMO you can get a primitive version merged (just leave out the uncertainties) and revise the details later. You already done so much on this and I think it would really benefit the users."
608170727,12205,FranciscoPombal,2020-04-03T00:54:40Z,"@Chocobo1
There is no rush from my side, since 4.2.3 was just released, I expect I will have some time to iron out the remaining warts before the next release. I'm really close at this point anyway, and I think it would be a waste to ship such a detailed manpage that omits some options.

By the way, can you address this comment please? https://github.com/qbittorrent/qBittorrent/pull/12205#discussion_r395381923"
608217054,12205,Chocobo1,2020-04-03T04:04:45Z,">By the way, can you address this comment please? #12205 (comment)

Nobody raised any concern except me, then leave it as is."
608641220,12205,FranciscoPombal,2020-04-03T20:23:27Z,"@glassez @Chocobo1
Looks like the options precedence does indeed work as I had described.

However, I just found out something interesting:
1. Suppose you have `WebUI\Port=1234` in your `qBittorrent.conf`.
2. Launch qBittorrent in your shell like so: `qbittorrent --webui-port=5678`
3. Close qBittorrent

Question: what is the value of `WebUI\Port` in your `qBittorrent.conf` after step 3?
One would expect it to be `1234`, since usually changes passed by command line flags _override_ configuration file options, but don't implicitly/silently _overwrite_ them. However, this is not the case in qBIttorrent. The configuration file value will be overwritten and will read `5678` after step 3. The same happens with environment variables (e.g. `QBT_WEBUI_PORT=5678`).

At least one thing is consistent:
If **both** an environment variable _and_ a command line flag for the same option are specified, the command line flag takes precedence and is the value that overwrites the one in the configuration file.

We might want to change this in the future, but for now I will document it as-is."
630326957,12205,FranciscoPombal,2020-05-18T17:25:52Z,@glassez can you please address https://github.com/qbittorrent/qBittorrent/pull/12205#discussion_r407280560?
1045987152,16485,glassez,2022-02-19T10:34:13Z,"Names, messages, etc. are the objects of improvements. You can offer your options.

The algorithm for ""automatic size"" is also not particularly thought out (it was just necessary to start somewhere)."
1045992550,16485,ghost,2022-02-19T11:07:04Z,"Nice patch! Now qBit isn't using 100% of my RAM when downloading big torrents at 1 Gbps!
I use the following settings:
OS cache disabled.
Working set - Auto.
"
1045994068,16485,xavier2k6,2022-02-19T11:16:50Z,"@glassez Have you also tested this patch with latest `libtorrent commit`?, I only ask because I know the CI builds are only testing with the `release` commits of `1.2.15/2.0.5`.

Will also test this myself later....

Edit:

Should the configurable `Max %` setting be capped lower than `100%`?? -> `75%/85%`?"
1045996395,16485,glassez,2022-02-19T11:31:59Z,"> Should the configurable `Max %` setting be capped lower than `100%`?? -> `75%/85%`?

I don't see the point."
1045997219,16485,glassez,2022-02-19T11:36:58Z,"> @glassez Have you also tested this patch with latest `libtorrent commit`?

I tested it using the current RC_2_0 branch of libtorrent. But I don't have any special results, because I just made sure that it works correctly, i.e. it really limits the amount of physical memory used."
1045998136,16485,ghost,2022-02-19T11:43:08Z,Instead of linking users to that gibberish maybe link them to a github FAQ page?
1045999035,16485,glassez,2022-02-19T11:49:15Z,"> Instead of linking users to that gibberish maybe link them to a github FAQ page?

Is there anything useful about it? I don't mind if it is. Otherwise, someone else can do it later."
1046160116,16485,ghost,2022-02-20T04:21:00Z,"I think the auto settings is using too much RAM compared to how libtorrent's auto settings did.
Almost 4 GB on a 16 GB system. I think most users will still complain about the usage."
1046177305,16485,Chocobo1,2022-02-20T07:11:28Z,">Almost 4 GB on a 16 GB system. I think most users will still complain about the usage.

Maybe this is just me, I think this is a sign that using percentage isn't very appealing. Most users (or at least myself) would prefer setting it to some specific limit and not care about scaling it with total ram size.
And (I suspect) people is already accustomed to the auto value from libtorrent so following it would be a good idea IMO.
"
1046202337,16485,glassez,2022-02-20T09:59:55Z,"> Most users (or at least myself) would prefer setting it to some specific limit and not care about scaling it with total ram size.

In fact, this is not a matter of principle for me. I can switch to using absolute values. Here are the questions I have:
1. What should be the limits of the acceptable range?
2. In what units should the value be stored in the configuration file?
3. In what units should it be represented in the settings UI?
4. Is there any sense in the Auto value if we are talking about absolute values? It seems that we can just have some kind of default value.
5. What should be the default value?



> And (I suspect) people is already accustomed to the auto value from libtorrent so following it would be a good idea IMO.

What ""auto value from libtorrent"" do you mean? And how we can follow it? Is it some predefined one?"
1046214490,16485,ghost,2022-02-20T11:15:35Z,"I suggest that you can just tweak your current auto settings a bit instead of following libtorrent's pattern.
Because I've seen many complaints from users with high RAM usage after setting the disk_cache default to auto.
So you can set the limit to 128 MiB for <=4 GiB system and 256 MiB for >4 GiB systems.
I have tested with setting the limit to 2% (326 MiB) and there was no impact on download performance.
I think this way you won't get complaints about high RAM usage and also won't have degraded performance."
1046422583,16485,ghost,2022-02-21T02:58:22Z,"> Do you have 1000mbit fiber internet at home? Run 1500-2000 torrent with 4-6TB seed size and then check how fast you can download 4-5 big 50GB game or 4K HDR movie.
>
Yes I do. However the amount of torrents and seed size you mentioned will be exceptional cases. And for exceptional cases user can bump his RAM limits easily from settings. We can't aim for exception cases when deciding default values.
"
1046464119,16485,glassez,2022-02-21T04:28:59Z,"> So you can set the limit to 128 MiB for <=4 GiB system and 256 MiB for >4 GiB systems.
> I have tested with setting the limit to 2% (326 MiB) and there was no impact on download performance.

If 256MB is a good default value, then I don't see the point in making it dependent on the amount of installed memory. If someone really has problems with it, they can easily adjust it."
1046498945,16485,yeezylife,2022-02-21T05:54:50Z,"I thought it's best if ""Auto"" can be based on download speed and free memory."
1046510214,16485,glassez,2022-02-21T06:14:57Z,"@Chocobo1 
So how about questions from https://github.com/qbittorrent/qBittorrent/pull/16485#issuecomment-1046202337?"
1046511746,16485,glassez,2022-02-21T06:17:39Z,"> I thought it's best if ""Auto"" can be based on download speed and free memory.

Do you have some kind of algorithm to suggest? How do you think it should depend on the download speed?"
1046523656,16485,yeezylife,2022-02-21T06:42:57Z,"@glassez 
Sorry I don't have any algorithm,it's just a thought.
Basically higher download speed leads to more frequent writing,therefore ""auto"" uses more memory to adapt to high speed download(but also consider free memory,don't use it all).And when download speed is low,don't need to cache that much,your disk is fine.
And also for most disk writing is heavier work than reading."
1046787820,16485,xavier2k6,2022-02-21T11:41:22Z,"I've had time to give this PR a whirl......

#### Test System:
```
i7 4790
Windows 10 Pro x64 (21H2) Build 19044.1566
32GB DDR3 RAM
OS Drive: Samsung SSD PRO 256GB
Storage Drive: Samsung SSD 860 EVO 4TB
__________________________________________________________________________
127 Torrents loaded
22 Downloading
13 Completed, force-rechecking for testing purposes (6.5GB -> 93GB)
Remainder paused

```

#### Settings:
```
Drives page file are automanaged by OS
Process memory priority: NORMAL
Process memory working set limit: AUTO
Asynchronous I/O threads: 256
Hashing threads: 16
file pool size: 8000
Outstanding memory when checking torrents: 1024 MiB
Enable OS cache: checked/enabled
```

![page file_virtual memory](https://user-images.githubusercontent.com/42386382/154945543-109778f3-cbf0-444e-88b5-120419ff7262.png)

### qBittorrent 4.4.1 x64 (Qt5) Test:

#### Task Manager - Performance/Memory:

![mem3](https://user-images.githubusercontent.com/42386382/154946116-bd991461-81ed-4aa4-a009-383e7b281969.png)

Task Manager - qBittorrent process details:

![mem4](https://user-images.githubusercontent.com/42386382/154946123-f705dded-76f2-4f4c-bd5c-151a378da35d.png)

#### Results/Observations:
All memory practically used!
mouse lag
drive slow down
downloading/uploading slowing down or dropped
Basically a bad user experience.
____

### qBittorrent 4.5.0alpha1 commit: 'a446d9d9da9eac95e5d0e7a9a653debe0338c0e7' Test:

#### Task Manager - Performance/Memory:

![mem1](https://user-images.githubusercontent.com/42386382/154947977-659bf8af-c3b2-494e-b55c-a393eedfe348.png)

#### Task Manager - qBittorrent process details:

![mem2](https://user-images.githubusercontent.com/42386382/154948036-c0cc2da8-0c22-47f9-ae32-1660f9dab249.png)

#### Results/Observations:
Not all memory used!
No mouse lag
No drive slow down
No significant downloading/uploading slowing down
Much better user experience."
1046789221,16485,xavier2k6,2022-02-21T11:43:15Z,"@djtj85 Did you try the `2.0.5` build from this PR?

https://github.com/qbittorrent/qBittorrent/actions/runs/1868537944"
1046824977,16485,ghost,2022-02-21T12:26:51Z,@xavier2k6 I think you should try the latest pushes as well to see if 256 MiB default limit causes any performance degradation.
1046976541,16485,xavier2k6,2022-02-21T15:09:51Z,">I think you should try the latest pushes as well to see if 256 MiB default limit causes any performance degradation.

I will when I get the chance.......feel free in the mean time to test the CI build & report back any findings."
1047086093,16485,ghost,2022-02-21T17:11:13Z,"The latest push isn't working for me. 
Getting this error `Failed to set Memory Working Set limit. Reason: The parameter is incorrect. Error code: 87.`"
1047087981,16485,glassez,2022-02-21T17:13:18Z,"> The latest push isn't working for me. Getting this error `Failed to set Memory Working Set limit. Reason: The parameter is incorrect. Error code: 87.`

What is your current setting? Note: it is changed due to changing units from percents to MBs"
1047089174,16485,ghost,2022-02-21T17:14:48Z,"> > The latest push isn't working for me. Getting this error `Failed to set Memory Working Set limit. Reason: The parameter is incorrect. Error code: 87.`
> 
> What is your current setting? Note: it is changed due to changing units from percents to MBs

First it was 2MB because of changing to MB from percentage. Then I changed it to default, it also didn't work. Last I tried 64MB which doesn't work as well.
"
1047128675,16485,xavier2k6,2022-02-21T18:12:26Z,"@an0n666 Thanks for that bit of info!

`32GB System`
Log show this with default `portable` mode with original commit:
`21/02/2022 18:09 - Memory Working Set limit is successfully applied. Used value: Auto (5315 MB).`
`21/02/2022 18:13 - Memory Working Set limit is successfully applied. Used value: 5% (1633 MB).`
`21/02/2022 18:14 - Memory Working Set limit is successfully applied. Used value: 10% (3267 MB).`
`21/02/2022 18:16 - Memory Working Set limit is successfully applied. Used value: 15% (4900 MB).`
`21/02/2022 18:17 - Memory Working Set limit is successfully applied. Used value: 20% (6534 MB).`
`21/02/2022 18:17 - Memory Working Set limit is successfully applied. Used value: 25% (8168 MB).`
`21/02/2022 18:19 - Memory Working Set limit is successfully applied. Used value: 30% (9801 MB).`
`21/02/2022 18:19 - Memory Working Set limit is successfully applied. Used value: 35% (11435 MB).`
`21/02/2022 18:20 - Memory Working Set limit is successfully applied. Used value: 40% (13069 MB).`
`21/02/2022 18:20 - Memory Working Set limit is successfully applied. Used value: 45% (14702 MB).`
`21/02/2022 18:21 - Memory Working Set limit is successfully applied. Used value: 50% (16336 MB).`
`21/02/2022 18:22 - Memory Working Set limit is successfully applied. Used value: 55% (17970 MB).`
`21/02/2022 18:23 - Memory Working Set limit is successfully applied. Used value: 60% (19603 MB).`
`21/02/2022 18:24 - Memory Working Set limit is successfully applied. Used value: 65% (21237 MB).`
`21/02/2022 18:24 - Memory Working Set limit is successfully applied. Used value: 70% (22871 MB).`
`21/02/2022 18:24 - Memory Working Set limit is successfully applied. Used value: 75% (24504 MB).`
`21/02/2022 18:24 - Memory Working Set limit is successfully applied. Used value: 80% (26138 MB).`
`21/02/2022 18:24 - Memory Working Set limit is successfully applied. Used value: 85% (27772 MB).`
`21/02/2022 18:24 - Memory Working Set limit is successfully applied. Used value: 90% (29405 MB).`
`21/02/2022 18:25 - Memory Working Set limit is successfully applied. Used value: 95% (31039 MB).`
`21/02/2022 18:25 - Memory Working Set limit is successfully applied. Used value: 100% (32673 MB).`

Log show this with default `portable` mode with latest commit:
`21/02/2022 18:11 - Failed to set Memory Working Set limit. Reason: The parameter is incorrect. Error code: 87.`

It doesn't matter what setting `Default/64MB/99MB` - these are the values given when you press the up arrow, if you press the down arrow once from `99MB` it goes to `35MB` & then press it again will bring it back to `Default`"
1047137774,16485,glassez,2022-02-21T18:25:46Z,"> @an0n666 Thanks for that bit of info!
> 
> Log show this with default `portable` mode with original commit: `21/02/2022 18:09 - Memory Working Set limit is successfully applied. Used value: Auto (5315 MB).`
> 
> Log show this with default `portable` mode with latest commit: `21/02/2022 18:11 - Failed to set Memory Working Set limit. Reason: The parameter is incorrect. Error code: 87.`

Apparently I messed up something during the last rework. I'll fix it tomorrow."
1047141815,16485,xavier2k6,2022-02-21T18:32:20Z,"@glassez My https://github.com/qbittorrent/qBittorrent/pull/16485#issuecomment-1047128675 has been edited/updated.

IMO, I think the original commit is the way to go but maybe add `1%/2%/3%/4%` & make `5%` the default?!"
1047387296,16485,ghost,2022-02-22T03:19:33Z,"> 4.5.0 alpha1 105MiB download to Samsung 870 EVO 4TB SSD OS cache disabled, ""process memory working set limit"" --> 5% Is this normal? One big spike and then much lower write speed, this is not so smooth ![Capture_3](https://user-images.githubusercontent.com/36327481/155042093-333b6e51-2900-481e-aaec-8116e463c0bc.jpg)

This maybe related to https://github.com/arvidn/libtorrent/issues/6522 which should be fixed by https://github.com/arvidn/libtorrent/pull/6703"
1047468255,16485,Chocobo1,2022-02-22T06:30:07Z,">What should be the limits of the acceptable range?
>In what units should it be represented in the settings UI?

I would use `1~INT_MAX (MiB)`.

>In what units should the value be stored in the configuration file?

I would use MiB.

>Is there any sense in the Auto value if we are talking about absolute values? It seems that we can just have some kind of default value.
>What should be the default value?

I think now there is no need of `auto` value. We can use either 256 MiB or even 1024 MiB as the default value.

>What ""auto value from libtorrent"" do you mean? And how we can follow it? Is it some predefined one?

I was referring to https://github.com/arvidn/libtorrent/blob/019fcc32bf776ff223f6461251ac0284b82d19f4/include/libtorrent/settings_pack.hpp#L1094-L1109 but it doesn't matter now."
1047473428,16485,ghost,2022-02-22T06:41:23Z,">I would use MB.
>
Then the multiplier would be 1000 x 1000."
1047479582,16485,Chocobo1,2022-02-22T06:54:17Z,"> > I would use MB.
> 
> Then the multiplier would be 1000 x 1000.

I meant MiB (1024 x 1024)."
1047712350,16485,ghost,2022-02-22T11:44:05Z,Tested the latest build and it worked fine.
1048429514,16485,ghost,2022-02-23T04:01:47Z,"@glassez There's still some bugs.

If I set it to <= 64 MiB I get this error `Failed to set physical memory (RAM) usage limit. Reason: The parameter is incorrect. Error code: 87.`"
1048816306,16485,glassez,2022-02-23T14:06:31Z,"> @glassez There's still some bugs.
> 
> If I set it to <= 64 MiB I get this error `Failed to set physical memory (RAM) usage limit. Reason: The parameter is incorrect. Error code: 87.`

Something wrong with MS documentation... We'll have to test it experimentally."
1048868916,16485,ghost,2022-02-23T14:55:37Z,"> > @glassez There's still some bugs.
> > If I set it to <= 64 MiB I get this error `Failed to set physical memory (RAM) usage limit. Reason: The parameter is incorrect. Error code: 87.`
> 
> Something wrong with MS documentation... We'll have to test it experimentally.

The documentation says this regarding dwMaximumWorkingSetSize
`This parameter must be greater than or equal to 13 pages (for example, 53,248 on systems with a 4K page size)`
So they have a minimum limit for it."
1049516231,16485,glassez,2022-02-24T05:47:27Z,"> The documentation says this regarding dwMaximumWorkingSetSize
> `This parameter must be greater than or equal to 13 pages (for example, 53,248 on systems with a 4K page size)`
> So they have a minimum limit for it.

Even 1MiB is greater than that minimum limit of 53,248 bytes so the problem is in something other."
1049826022,16485,glassez,2022-02-24T12:48:50Z,"> > The documentation says this regarding dwMaximumWorkingSetSize
> > `This parameter must be greater than or equal to 13 pages (for example, 53,248 on systems with a 4K page size)`
> > So they have a minimum limit for it.
> 
> Even 1MiB is greater than that minimum limit of 53,248 bytes so the problem is in something other.

Well, the problem is in dwMinimumWorkingSetSize. The documentation says that it should be less than or equal to dwMaximumWorkingSetSize but really it fails when they are equal. It requires some ""gap"" between these two parameters."
1049832852,16485,glassez,2022-02-24T12:57:50Z,"> > What should be the limits of the acceptable range?
> > In what units should it be represented in the settings UI?
> 
> I would use `1~INT_MAX (MiB)`.

Wouldn't it be more reasonable to limit this range to some minimum value, e.g. 32MB? It doesn't look like qBittorrent could function correctly with a smaller available memory size. Accidentally (or intentionally) setting too small a value can make the application completely inoperable, which may require manual editing of the configuration file to fix it."
1049846343,16485,ghost,2022-02-24T13:12:56Z,"Latest build is working fine with 256 MiB default.
However, when I set it to 64 MiB qBt UI becomes extremely unresponsive and laggy. I had only 7 torrents seeding with 120 GB seed size. Even going to settings menu was difficult with these low settings. So I advise to set a minimum value which would not cause the application to hang. Also maybe 256 MiB could be low for some users. So I suggest @xavier2k6 and others to test this build to ensure everything works out."
1050544942,16485,Chocobo1,2022-02-25T05:45:31Z,">Accidentally (or intentionally) setting too small a value can make the application completely inoperable, which may require manual editing of the configuration file to fix it.

I agree this is bad and we should prevent it. But what should be the lower limit? Maybe 128 MiB?

>Latest build is working fine with 256 MiB default.

Maybe we should raise the default to 1024 MiB? It is not unreasonable to expect this amount of RAM installed and used by qbt IMO.

UPDATE: On a second thought, this is *advanced* settings, users are responsible for their actions and it isn't qbt job to hold their hands and keep them away from danger. IMO the current no limitation UI is fine for me."
1051564244,16485,ghost,2022-02-26T04:19:19Z,">Maybe we should raise the default to 1024 MiB? It is not unreasonable to expect this amount of RAM installed and used by qbt IMO.
>
I agree to this if the aim is to not accidentally make someone's UI freeze who have a lot of seeding torrents.
I also wonder what would happen in case of a memory leak. If for example a thread is stuck in an infinite loop and starts to eat up memory infinitely, would the program itself crash due out of memory scenario?"
1052069304,16485,glassez,2022-02-26T11:50:55Z,"> I also wonder what would happen in case of a memory leak. If for example a thread is stuck in an infinite loop and starts to eat up memory infinitely, would the program itself crash due out of memory scenario?

Why are you filling your head with problems that we can't solve? If there is a memory leak (no real evidence of which has been provided so far, as far as I know), then in any case it will lead to a crash sooner or later (but this will certainly happen sooner if we limit the working set of the process)."
1053527336,16485,glassez,2022-02-27T11:39:04Z,"> > Latest build is working fine with 256 MiB default.
> 
> Maybe we should raise the default to 1024 MiB? It is not unreasonable to expect this amount of RAM installed and used by qbt IMO.

Changed it to 512 MiB as a compromise. It can be adjusted better before the release, if necessary (or even later, when it gets a larger user audience)."
1056128117,16485,hzdrro,2022-03-02T03:34:23Z,"When setting the limit to 2048 MiB or greater, qBt would use up the memory on my win11 x64. Is this expected behavior?"
1057325821,16485,glassez,2022-03-02T19:59:21Z,"@Chocobo1
I intend to backport it to 4.4.x since I feel it like bugfix. Do you object?"
1057590381,16485,hzdrro,2022-03-03T02:12:53Z,"> > When setting the limit to 2048 MiB or greater, qBt would use up the memory on my win11 x64. Is this expected behavior?
> 
> @hzdrro
> 
> If you specified the max amount of memory usage limit for qBitorrent, then I would expect it to be logical to not exceed the limit.
> 
>     1. How much RAM do you have installed?
> 
>     2. Did you restart qBitorrent v4.5.0alpha1 build after changing the new setting with 512 MiB default RAM limit?
> 
>     3. Did you look at Task Manager total RAM usage of all programs or only qBitorrent use?
> 
>     4. Do you use network drive?
> 
> 
> Because I am unable to see Windows 11 Task Manager showing me high physical memory (RAM) use or any memory leak.
> 
> I tried with various settings, always exited and reopened program, kept 630 torrents in transfer list and I even rechecked 15GB torrent file on my local SSD with NTFS filesystem, but no large memory usage spikes or long term increase with my 16GB RAM.

@PriitUring thanks for replying

1. 16GB installed
2. it works well after a restart, but qBt would use up my memory before a restart if I set the limit to 2048 MiB or greater.
3. 
![图片](https://user-images.githubusercontent.com/6322097/156482890-0e4ce6b6-aca2-4c59-8967-c01dfc47e99c.png)
4. No."
1057633525,16485,ghost,2022-03-03T03:37:52Z,"> @Chocobo1 I intend to backport it to 4.4.x since I feel it like bugfix. Do you object?

This high RAM issue was introduced in 4.4.x so this can very well be considered a bugfix!"
1057641631,16485,Chocobo1,2022-03-03T03:59:57Z,"> I intend to backport it to 4.4.x since I feel it like bugfix. Do you object?

I'm ok with it."
1057644354,16485,Chocobo1,2022-03-03T04:06:13Z,">Guys would you release the upcoming new builds with both libtorrent 2.x (with this new patch) and with libtorrent 1.2.x too ?

@djtj85 
Sure the next release will contain this patch with libtorrent 2.x.

As for releasing with libtorrent 1.2.x, sorry I have no control over its decision. You should ping @sledgehammer999 about it."
1058869972,16485,The5kull,2022-03-04T06:18:44Z,"> Latest build is working fine with 256 MiB default. However, when I set it to 64 MiB qBt UI becomes extremely unresponsive and laggy. I had only 7 torrents seeding with 120 GB seed size. Even going to settings menu was difficult with these low settings. So I advise to set a minimum value which would not cause the application to hang. Also maybe 256 MiB could be low for some users. So I suggest @xavier2k6 and others to test this build to ensure everything works out.

I am still experiencing lags with these fixes. Not only qB UI lag but mouse lag aswell no matter how much MiB I assigned.
Went back to the CL build with libtorrent v1 for the time being."
1062873109,16485,adrian5,2022-03-09T12:30:30Z,"I second :peach:'s request. I'm stuck at <2MiB/s (I even throttle myself to 900KiB/s to prevent constant cache exhaustion).

How long should I live with that? 3 months? 6 months? 2 years? Who knows when [libtorrent #6561](https://github.com/arvidn/libtorrent/issues/6561) will be fixed, there seems to be no rush. And since you didn't release an AppImage prior to 4.4.0 (libtorrent 2.x), there's no way for me to downgrade to a working release.

Just having a libtorrent 1.2 build we could stay on for another year while the issues are ironed out would really help."
1073353823,16485,whxuezhe,2022-03-20T21:38:12Z,"> 我有时间给这个公关一个旋风......
> 
> #### 测试系统：
> ```
> i7 4790
> Windows 10 Pro x64 (21H2) Build 19044.1566
> 32GB DDR3 RAM
> OS Drive: Samsung SSD PRO 256GB
> Storage Drive: Samsung SSD 860 EVO 4TB
> __________________________________________________________________________
> 127 Torrents loaded
> 22 Downloading
> 13 Completed, force-rechecking for testing purposes (6.5GB -> 93GB)
> Remainder paused
> ```
> 
> #### 设置：
> ```
> Drives page file are automanaged by OS
> Process memory priority: NORMAL
> Process memory working set limit: AUTO
> Asynchronous I/O threads: 256
> Hashing threads: 16
> file pool size: 8000
> Outstanding memory when checking torrents: 1024 MiB
> Enable OS cache: checked/enabled
> ```
> 
> ![页面file_virtual内存](https://user-images.githubusercontent.com/42386382/154945543-109778f3-cbf0-444e-88b5-120419ff7262.png)
> 
> ### qBittorrent 4.4.1 x64 （Qt5） 测试：
> #### 任务管理器 - 性能/内存：
> ![内存3](https://user-images.githubusercontent.com/42386382/154946116-bd991461-81ed-4aa4-a009-383e7b281969.png)
> 
> 任务管理器 - qBittorrent 进程详细信息：
> 
> ![内存4](https://user-images.githubusercontent.com/42386382/154946123-f705dded-76f2-4f4c-bd5c-151a378da35d.png)
> 
> #### 结果/观察结果：
> 所有内存几乎都用完了！鼠标滞后驱动器下载/上传速度变慢或掉落基本上是糟糕的用户体验。
> 
> ### qBittorrent 4.5.0alpha1 commit： 'a446d9d9da9eac95e5d0e7a9a653debe0338c0e7' Test：
> #### 任务管理器 - 性能/内存：
> ![内存1](https://user-images.githubusercontent.com/42386382/154947977-659bf8af-c3b2-494e-b55c-a393eedfe348.png)
> 
> #### 任务管理器 - qBittorrent 进程详细信息：
> ![内存2](https://user-images.githubusercontent.com/42386382/154948036-c0cc2da8-0c22-47f9-ae32-1660f9dab249.png)
> 
> #### 结果/观察结果：
> 并非所有内存都已用完！没有鼠标滞后 没有驱动器速度减慢 没有明显的下载/上传速度减慢 更好的用户体验。

How to get the 4.5.0 alpha 1 test? I'm 11 windows system; This problem has plagued two versions; I am also a test software enthusiast in China. Do you have any channels to obtain the installation package? thank you!"
1073355938,16485,whxuezhe,2022-03-20T21:53:21Z,"> > @glassez您是否还使用最新补丁测试了此修补程序？`libtorrent commit`
> 
> 我使用 libtorrent 的当前RC_2_0分支对其进行了测试。但我没有任何特殊的结果，因为我只是确保它正常工作，即它确实限制了使用的物理内存量。

 @glassez I am a Chinese user and an entry-level enthusiast of software testing; I don't think it's difficult to set 512mib page cache for qbittorrent UI QT6 interface engine to call; The low-end computer in the office starts with 4gib ram. In addition, my personal use is core i5 9300h DDR4 2666 32 * 2; However, this problem has been plagued since 4.4.0rc. Please ask qbittorrent project team to greatly improve it; Provide 4.5.0 alpha 1 to alleviate the problem. I'm a foreign movie download enthusiast; Especially when the seed is restored, and sometimes even when the mouse stops seeding, it does not respond and has stopped"
1079607444,16485,N0rdmann,2022-03-26T05:11:48Z,"Any chance a similar ""feature"" will make it to Linux build soon?
_Mem usage grows almost unlimited with libtorrent 2 while massive downloads running._
![image](https://user-images.githubusercontent.com/46085849/160225687-951f6c06-ed5d-49ef-b299-045f948bce1b.png)

Until 4.x i was able to limit it's mem usage pretty fine with **Disk cache** & **Disk cache expiry interval** which are obsolete with libtorrent 2.x now

![image](https://user-images.githubusercontent.com/46085849/160225723-44c8a444-c100-404d-aec4-24c44c3a644a.png)

qBittorrent v4.4.2
Debian 10.11 x64"
1081218065,16485,whxuezhe,2022-03-28T22:31:59Z,@PriitUring  hope to consider 4.5.0 later and support IPv6 trackerlist only; Or both IPv4 and IPv6 trackerlist are supported.
450967221,10099,sledgehammer999,2019-01-02T19:55:26Z,Special shoutout to [DB Browser for SQLite](https://sqlitebrowser.org/). It is a great lightweight that lets you inspect/modify/administer and SQLite db. Very useful for debugging.
451055141,10099,glassez,2019-01-03T04:45:22Z,"@sledgehammer999, that's fine! 
I'm glad my old idea finally sprung. This will undoubtedly be a step forward. Although there is still work to be done, starting from what and how we should store in the tables, and ending with the details of the implementation. I'll start commenting on specific things later."
451218142,10099,glassez,2019-01-03T17:34:35Z,">I plugged in the new functionality by keeping the current design as much as possible.

Too much.
Since we stored some additional data along with the ""fastresume"" data, we had to request the creation of ""fastresume"" data each time we had anything changed (e.g. save path, torrent name, etc.), then we injecte these additional fields in ""fastresume"" data, encode it and write to file.
We don't have to do it that way anymore. We can store them in separate columns and update them independently.
Even more. If we look at the libtorrent ""fastresume"" data, we can see that most of its fields has the behavior described above. E.g. when torrent is paused or resumed we receive an appropriate alert so we can just update ""paused"" and ""auto_managed"" columns and so on.
By and large, we need to request ""fastresume"" data generation just to store the current progress.
This may seem somewhat inconvenient due to libtorrent drawback (it requires ""fastresume"" data to be bencoded when we pass it to add_torrent_params). But this is slightly improved in the libtorrent-1.2 (now we just have to fill in the appropriate add_torrent_params fields)."
451304836,10099,sledgehammer999,2019-01-03T22:58:21Z,"I am all for decoupling our data from libtorrent's fastresume.
But this will need investigation on when to save our data and what triggers it. Aka reacting more closely to the triggering event.
This is work for the weekend though."
451372408,10099,glassez,2019-01-04T07:46:01Z,">But this will need investigation on when to save our data and what triggers it.

At least all current ""fastresume"" saving events that are not fired by timer."
451772821,10099,sledgehammer999,2019-01-06T20:39:12Z,"Pushed new version of commits with these changes:
1. db.h moved under base/bittorrent
2. Namespace from `Utils::DB` to `DB`
3. Fixed issue where deleted torrents weren't removed from the DB due to missing variable escape

As for the other issues I'll comment inline."
451810735,10099,sledgehammer999,2019-01-07T03:21:56Z,"@glassez 
From a look at the code here is one way I thought to decouple things. (well, it isn't groundbreaking).
Our custom `qBt-` fields are all inserted in [TorrentHandle::handleSaveResumeDataAlert()](https://github.com/qbittorrent/qBittorrent/blob/d7c561df6b1908e3259eac01f4e41825d99c6ebd/src/base/bittorrent/torrenthandle.cpp#L1630)
Most of these values should be written in the database as soon as the **new** torrent is created+added to the DB. This currently happens in 1st commit [here](https://github.com/qbittorrent/qBittorrent/pull/10099/commits/fa50af70a30f2e4af0b3d29e48f988d0db5a0c1b#diff-5961e6811ef7cd17f473ca94c53d5559R4214). In that `INSERT INTO` statement I intend to use the proper values from the `params` variable (of type `CreateTorrentParams`) which is used to initialize the TorrentHandle and ultimately the `qBt-` fields.
Each `qBt-` field becomes a DB column.
Then inside the TorrentHandle class, each time a field is updated we also update the DB record.
For example, inside `TorrentHandle::setSeedingTimeLimit()` we update the DB record for `m_seedingTimeLimit` (`qBt-seedingTimeLimit`)

Finally, [loadTorrentResumeData()](https://github.com/qbittorrent/qBittorrent/blob/d7c561df6b1908e3259eac01f4e41825d99c6ebd/src/base/bittorrent/session.cpp#L4623) will be changed to load stuff from the DB instead.

Do you think another way is more appropriate?"
452143823,10099,sledgehammer999,2019-01-08T01:36:57Z,"@glassez I pushed a few new commits. I didn't merge them back into the others in hope it is easier to review the changes.

I need your opinion. The last commit is unfinished and still WIP. I didn't have more time to tidy it up.
Can you take a look at it and consider the following:
I assume you agree to save each old fastresume  field as a table column, right? As you can see in the last commit, I save each setting as soon as it is changed. Here's where I want your input. Should the saving be done by the TorrentHandle class (like its done in my commit), or done by the Session class?
For example, when the torrent changes name, should the saving be done inside `TorrentHandle::setName()` or inside `Session::handleTorrentNameChanged()`?

I assume your answer will be that the Session should do that. It's more logical.
However, there are some settings which aren't publicly exposed by the TorrentHandle class. Like the `m_name` variable(`TorrentHandle::name()` doesn't return it verbatim). Is it ok if I extend the various Session::handleTorrent* methods to receive that argument directly from the caller?

In any case, as this last commit is very WIP, I have nothing solid. I merely was exploring the possibilities. So if you want to propose a better approach let me hear it (with a pseudo-example if possible)."
452263782,10099,WolfganP,2019-01-08T11:18:43Z,"As I commented in https://github.com/qbittorrent/qBittorrent/issues/10115, I'm optimizing my RasPi setup to avoid using the SDcard or other slow storage units.

I tried to follow up this PR changes to check where the new database file will be stored, it's need for persistence across boots and the interaction with the portable settings; but I was unable to.

@sledgehammer999  do you mind to comment on it?"
452275823,10099,glassez,2019-01-08T12:06:34Z,">I assume you agree to save each old fastresume field as a table column, right?

Right.
But I propose to store ALL fastresume data in separate columns.

>Should the saving be done by the TorrentHandle class (like its done in my commit), or done by the Session class?

Although some logic is currently delegated to TorrentHandle class, I would prefer to have it centrally in the Session class and leave TorrentHandle only as a convenient interface.
>Is it ok if I extend the various Session::handleTorrent* methods to receive that argument directly from the caller?

I don't mind doing it that way to begin with. There may be a better way later.
>So if you want to propose a better approach let me hear it (with a pseudo-example if possible).

Ok."
452300658,10099,sledgehammer999,2019-01-08T13:37:14Z,">But I propose to store ALL fastresume data in separate columns.

You mean each field(even libtorrent native) of the fastresume in a separate column?
But what do we want to accomplish with that?
Libtorrent will still generate them as a whole anyway. We will need to manually parse them into separate columns. Then manually combine them into a fastresume to feed into libtorrent. Also we would need to always keep our parsers/tables updated with each revision of the fastresume spec."
453119384,10099,WolfganP,2019-01-10T14:43:50Z,"Just for the sake of documentation and other approaches to manage tmpfs needed folders (ie /var/log/*), interesting discussion at https://community.openenergymonitor.org/t/better-handling-of-files-in-tmpfs-var-log/9315"
453133428,10099,glassez,2019-01-10T15:22:06Z,">You mean each field(even libtorrent native) of the fastresume in a separate column?

Yes.
I do not insist on it yet, but just want to evaluate all the pros and cons. We need to do this now as accurately as possible to avoid multiple database schema changes in the future.
>But what do we want to accomplish with that?

The same things as for custom resume data members.
>Libtorrent will still generate them as a whole anyway. 

Yes. But in many cases we can avoid all data generation when we need to update only one field. I.e. when some even occurs we receive an appropriate alert so we can update just one (or several) field instead of asking full data from libtorrent.
>We will need to manually parse them into separate columns.

You're wrong. On the contrary, we avoid encoding the data in bencoded forms.
We get ""fastresume"" data either as dictionary in libtorrent 1.1 or as add_torrent_params in libtorrent 1.2 so it can be easily stored as separate columns.
>Then manually combine them into a fastresume to feed into libtorrent.

Yes. But it's not so big problem. Besides, it only applies to libtorrent 1.1. libtorrent 1.2 accepts all resume data as separate fields of add_torrent_params struct.

Additionally storing data in separate columns should make it easier to manage database and debug the application."
455797501,10099,CyrusNajmabadi,2019-01-19T17:10:46Z,"I haven't looked through this entire PR, but as someone recommending this change I thought i would throw in a little bit of info that I learned from making the same change in https://github.com/dotnet/roslyn.

Specifically, if your app is write-heavy (which Roslyn is), then you'll very likely benefit hugely from setting `journal_mode=wal` and `synchronous=normal`.  You can see where we set that ourselves here: https://github.com/dotnet/roslyn/blob/b03098e236c958602783a929f55e355328e49518/src/Workspaces/Core/Portable/Storage/SQLite/SQLitePersistentStorage.cs#L224-L235

Documentation on these values are here:
https://sqlite.org/pragma.html#pragma_synchronous
https://www.sqlite.org/wal.html#performance_considerations

Importantly, moving to WAL helps heavy-write performance a **Ton**.  'normal' mode also helps quite a bit, while not introducing concerns about database corruption.  i.e. your database will always be corruption-free, and will always only contain the results of some previously completed transaction.  However, you risk an exceptionally tiny change that *some committed transaction* **might** be lost if you lose power at some precise moment.  Again, your data will not be corrupt. Simply, you might lose a transaction that in 'full' mode would reapply if power is lost at a specific moment.

For the Roslyn use case, this was perfect.  A lost transaction simply meant we'd recompute the data later on.  For QB, it's unclear what it would mean.  I get the sense that you ahve to validate data anyways on a non-clean shutdown.  So i imagine things will be fine for you.

Just something to consider in order to ensure that your DB is not a bottleneck if you are writing data to it non-stop.

--

Note: as someone who has a huge amount of torrents, I have a personal vested interest here.  I dont' know what the write patterns are for QB.  But, for example, if it routinely making thousands of transactions because there are all these torrents, then WAL will go a long way to making that crawl, to making it something you'd never notice.

Thanks!"
455798513,10099,CyrusNajmabadi,2019-01-19T17:23:19Z,"Another important consideration was that we pooled DB connections.  Each connection is safe to use across different threads *as long as* you are not using it across threads simultaneously.  So, we would only make a new connection if we had no existing ones available.  Then, once done, it would go back in the pool ready to be used by any other thread.  You can see that code here:

https://github.com/dotnet/roslyn/blob/b03098e236c958602783a929f55e355328e49518/src/Workspaces/Core/Portable/Storage/SQLite/SQLitePersistentStorage.cs#L132-L161

This is helpful for performance as each connection incurs a fixed creation cost, especially where it needs to grovel the db to hydrate the metadata for it and whanot.

Similarly, parameterized query statements were cached.  This is useful so you can keep issuing the same statements (with different parameter values) without incurring the fixed overhead of parsing/analyzing the statement.  Sqlite can do that computation once and then benefit from it every other time.

--

Note: i have not used QT's api for sqlite.  It's possible they take care of this for you.  Def something to look into if they do not.

--

Now, if you're only rarely reading/writing from your DB.  Or you don't need to scale reads/writes with number-of-torrents, then this likely isn't going to be an issue.  However, if you're reading/writing many times a second, and you need to *increase* reads/writes based on something related to user-data (i.e. how many torrents they have) then these sorts of approaches really streamline things and make sqlite operate in much of a bare-metal fashion.  

Cheers!"
455915665,10099,sledgehammer999,2019-01-21T00:10:16Z,"Rebased PR on top of current master, and addressed the namespace comment.
I'll continue work tomorrow."
457967526,10099,sledgehammer999,2019-01-28T00:15:41Z,"@glassez I finished reworking the code in order to save our custom fields as separate columns in the DB.
I worked this code in fragments in the course of many days. So I might have missed something.
Look at the general picture. If the direction is ok then I can proceed to add error handling, squash commits, update the 2 other commits so you can do a proper review."
457989903,10099,CyrusNajmabadi,2019-01-28T03:38:27Z,Has any testing been done to validate no performance issues when there are thousands of torrents?  Sqlite can def have perf issues depending on certain usage patterns.  
457991948,10099,sledgehammer999,2019-01-28T03:55:05Z,">Has any testing been done to validate no performance issues when there are thousands of torrents? Sqlite can def have perf issues depending on certain usage patterns.

Not yet. We need to solidify the table/db format first.
Then I'll look into ways on how to wrap the bulk fastresume writes in sql transactions. This should minimize performance degradation."
457995643,10099,glassez,2019-01-28T04:27:56Z,">Look at the general picture. 

I'm sorry, but it's really hard to review such a ""feature"" request without having a full idea of how it should end up. That is why I started the discussion with general questions. But you never fully answered them. Could you sum up some intermediate results and describe the target architecture of this feature?
1. What data and in what format are you going to store?
2. How are you going to ensure compatibility and control it?
3. How did you decide to migrate from the old saving system?
4. So on...

I have already started to discuss many of these, but we have not come to any specific conclusion. It all affects the format of the database. It will be very painful for us to change it further.

In addition, I must have an idea of what is temporary at the moment, and what is not."
458038563,10099,glassez,2019-01-28T08:34:19Z,"@sledgehammer999, having an concept of the target design of the feature, I could even help with some code snippets. Otherwise, I can only offer some more or less trivial helpers."
458039826,10099,glassez,2019-01-28T08:39:07Z,"@sledgehammer999, at this stage, I found one fundamental error.
The only reliable way to have a consistent torrent queue is to write it all at once. I fixed it recently, but here you degrade again, writing torrent positions separately."
458366204,10099,sledgehammer999,2019-01-29T01:07:28Z,"@glassez I have tidied up the commits. Error handling is missing though. IMO, you can have a better idea now.

>What data and in what format are you going to store?

A table that stores the hash, metadata, fastresume(bendoced), queue and the rest of the custom `qBt-` fields per row.
The table definition looks like this
```c++
query.exec(QString(""CREATE TABLE %1 ""
                           ""(""
                           ""%2 TEXT PRIMARY KEY NOT NULL, "" // hash
                           ""%3 BLOB NOT NULL, "" // metadata
                           ""%4 BLOB, "" // fastresume
                           ""%5 INT DEFAULT -1, "" // queue
                           ""%6 TEXT,"" // save path
                           ""%7 INT, "" // ratio limit
                           ""%8 INT, "" // seeding time limi
                           ""%9 TEXT, "" // category
                           ""%10 TEXT, "" // tags
                           ""%11 TEXT, "" // name
                           ""%12 BOOL, "" // has seed status
                           ""%13 BOOL, "" // temp path disabled
                           ""%14 BOOL, "" // has root folder
                           ""%15 BOOL, "" // paused
                           ""%16 BOOL, "" // forced
                           ""%17 BOOL, "" // has first-last piece prio
                           ""%18 BOOL "" // sequential
                           "")""
                           ).arg(TABLE_NAME, COL_HASH, COL_METADATA, COL_FASTRESUME, COL_QUEUE,
                                 COL_SAVE_PATH, COL_RATIO_LIMIT, COL_SEEDING_TIME_LIMIT, COL_CATEGORY)
                            .arg(COL_TAGS, COL_NAME, COL_SEED_STATUS, COL_TMP_PATH_DISABLED, COL_HAS_ROOT_FOLDER,
                                 COL_PAUSED, COL_FORCED, COL_HAS_FIRST_LAST_PIECE_PRIO, COL_SEQUENTIAL));
```

>How are you going to ensure compatibility and control it?

**I am open to ideas.** Currently I use the `user_version` PRAGMA to check that the DB version can be handled by the program.
You have seen my inline comment and responded about backwards compatibility. We can ensure that by refusing to remove columns in newer versions.
If for some serious reason we need to change the format entirely in the DB/table then we do what we have done so far. On 1st run inform the user that there will an incompatibility if he continues with the new version. In this case we update the `user_version` so older clients can have a very easy way to figure out the incompatibility and stop working. And we should go one step further: Require that breaking changes also introduce a ""revert"" switch, that will rebuild the old format so the user can go back to earlier versions. Like my `Add option to export torrent data to old saving system` commit in this PR.

Your stored procedures idea sounds interesting. I have zero experience with that kind of thing. I don't know the capabilities those can have. And since we don't know what kind of changes we might introduce in the future I don't know if we should rely on that solution. At least in C++ (from new clients) we have the freedom to reconstruct the dbs any way we want and manipulate the data as we see fit.

>How did you decide to migrate from the old saving system?

Do you mean how the code behaves or how I came to the decision to introduce SQLite saving?
Code: Asks the user, parses the fastresumes and populates the relevant table columns. Then deletes the old files.
Decision: Probably explained in opening post. Are you against SQLite?"
458366787,10099,sledgehammer999,2019-01-29T01:10:24Z,">The only reliable way to have a consistent torrent queue is to write it all at once. I fixed it recently, but here you degrade again, writing torrent positions separately.

Hmm, I see what you mean. I didn't realize the out-of-sync possibility.  I'll look into it tomorrow to see how to rectify this."
458370761,10099,sledgehammer999,2019-01-29T01:28:33Z,">Hmm, I see what you mean. I didn't realize the out-of-sync possibility. I'll look into it tomorrow to see how to rectify this.

Hmm, I looked again at the code. The only problem I see is with how I pass the queue number to ResumeDataSavingManager. This doesn't seem necessary and I should remove it.
Then the other place where the queue is saved is
```c++
void Session::saveTorrentsQueue()
{
    using namespace BitTorrent::DB;
    QSqlDatabase db = QSqlDatabase::database(MAIN_CONNECTION_NAME);
    db.transaction();
    QSqlQuery query(db);
    query.prepare(QString(""UPDATE %1 ""
                          ""SET %2 =  :queue ""
                          ""WHERE %3 = :hash"")
                  .arg(TABLE_NAME, COL_QUEUE, COL_HASH));

    for (const TorrentHandle *torrent : asConst(torrents())) {
        // We require actual (non-cached) queue position here!
        const int queuePos = torrent->nativeHandle().queue_position();
        if (queuePos >= 0) {
            query.bindValue("":queue"", queuePos);
            query.bindValue("":hash"", QString(torrent->hash()));
            query.exec();
        }
    }

    db.commit();
}
```

Notice that it is wrapped in an sql transaction, so everything is written out together.
NOTE: I'll add a call back into `Session::saveResumeData()`. I can't remember why I removed it. It seems wrong now.

Did you have something else in mind?
"
458409482,10099,glassez,2019-01-29T05:07:45Z,">he only problem I see is with how I pass the queue number to ResumeDataSavingManager. This doesn't seem necessary and I should remove it.

Yes.
All you need is replacing `Session::saveTorrentsQueue()` content with new code that updates all queue at once.

UPDATE:
```c++
    for (const TorrentHandle *torrent : asConst(torrents())) {
        // We require actual (non-cached) queue position here!
        const int queuePos = torrent->nativeHandle().queue_position();
        if (queuePos >= 0) {
            query.bindValue("":queue"", queuePos);
            query.bindValue("":hash"", QString(torrent->hash()));
            query.exec();
        }
    }
```
This fragment is incorrect.
We could not save the entire queue when it came to the file (because we assumed that all missing torrents had zero priority).
But right now we have to update all torrents without exception (unless you want to break your brain trying to figure out which torrents changed their position):
```c++
    for (const TorrentHandle *torrent : asConst(torrents())) {
        // We require actual (non-cached) queue position here!
        const int queuePos = torrent->nativeHandle().queue_position();
        query.bindValue("":queue"", queuePos);
        query.bindValue("":hash"", QString(torrent->hash()));
        query.exec();
    }
```"
458488129,10099,glassez,2019-01-29T10:26:52Z,"@sledgehammer999, your [big comment](https://github.com/qbittorrent/qBittorrent/pull/10099#issuecomment-458366204) is not what I wanted from you.
I have made some serious comments regarding both the overall feature design and some parts of it. And then I argued my claims in detail. But you ignored my comments and didn't answer them. Now I asked you to summarize our discussion, read my previous comments and give **reasoned answers**.
https://github.com/qbittorrent/qBittorrent/pull/10099#discussion_r245693567
https://github.com/qbittorrent/qBittorrent/pull/10099#issuecomment-453133428

>Are you against SQLite?

That's an inappropriate question. You have something with your memory...
I was one of those (or even the first) who first declared the need to use SQLite. And I've been promoting this idea for years. But I want it to be used wisely, not as a workaround on legacy logic and data formats."
458497405,10099,glassez,2019-01-29T10:56:49Z,"About backward compatibility.
>We can ensure that by refusing to remove columns in newer versions.

We must certainly avoid frequent changes in the format of the database. But this should not be an obstacle in the development of the project.
There really isn't much of a problem with that. Because the newer version knows exactly what format the database had in any previous version, it can easily convert the database to the latest format. As your following comment:
>If for some serious reason we need to change the format entirely in the DB/table then we do what we have done so far. On 1st run inform the user that there will an incompatibility if he continues with the new version. In this case we update the user_version so older clients can have a very easy way to figure out the incompatibility and stop working.

>And we should go one step further: Require that breaking changes also introduce a ""revert"" switch, that will rebuild the old format so the user can go back to earlier versions. 

Do you want to export it to the directly previous format? E.g. if format was changed in v2, v3, and v4, then v4 allow export to v3, v3 to v2, v2 to v1?
>Your stored procedures idea sounds interesting. I have zero experience with that kind of thing. I don't know the capabilities those can have.

I meant the usual CREATE/DROP/ALTER TABLE requests, not the stored procedures. I don't remember exactly, but I don't think SQLite has stored procedures.
>And since we don't know what kind of changes we might introduce in the future I don't know if we should rely on that solution.

You don't understand the idea itself. We should not look to the future, but rather to the past.
When some new version updates the database format, it knows exactly what has been changed and how to get it back. And it just stores this sequence of actions as a set of SQL queries. E.g. if it creates new table in new format then it stores ""DROP TABLE"" query etc.
Although in fact, things can be much more complicated, and we can't do without more advanced logic (which unfortunately is not supported). Therefore, the priority is to plan the structure as carefully as possible to avoid its frequent modification.
"
458691736,10099,sledgehammer999,2019-01-29T20:19:05Z,"I'll ignore your tone and I'll answer for your linked comments.

If I sum up correctly the 1st comment: DB should be initialized/created by Session. Also you allude that the importing should be done by Session. I disagree with that. Importing torrents is an upgrade step. Did you forget that the previous upgrade code handled the import itself without involving the Session?
However, I suppose I could move into Session the initialization/creation of the DB (via a static class method).
If I understood wrongly your comment, please correct me.

About the 2nd comment: Personally I don't see a pro in **us** saving the native libtorrent fastresume fields as separate columns. I don't see what we can gain from it. **If you have a pro I am happy to hear it.** For libtorrent 1.2: When we tell it to generate a fastresume it still populates/calculates all the fields. It also provides convenience functions to convert to/from add_torrent_params->bencoded fastresume. If we want to go with separate columns, we would still need to write a function to extract the add_torrent_params fields and then populate them (for startup). It sounds to me superfluous. It would make sense if we make direct use of any of the native fields. But we don't IIRC.

For clarity: I started this PR because I thought that the multitude of small files created (current way) hurts performance and possibly results in corruption with big queues. I didn't consider the format/architecture of what we saved. I didn't see it as a problem.

>then v4 allow export to v3, v3 to v2, v2 to v1?

Yes. I think that makes more sense and possibly makes it easier on ourselves to not carry obsolete code for too long.

>I meant the usual CREATE/DROP/ALTER TABLE requests, not the stored procedures. I don't remember exactly, but I don't think SQLite has stored procedures.

OK. But this is probably moot if we have the option to downgrade ourselves in new versions.

>You don't understand the idea itself. 

I only meant that SQL might be limited on what it can do to manipulate the DB and allow us to construct a list of downgrade commands.

>This fragment is incorrect.

You're right. The `if` check must be removed. A previously non-seed torrent that became seed will keep its old queue number with that check and the queue will be out of sync.

PS: If I forgot to answer to something, don't hesitate to directly quote it or link to it. This discussion is big and spans several days with breaks. I can't keep everything in my mind cache.
"
458825182,10099,glassez,2019-01-30T06:13:41Z,">I'll ignore your tone

I'm sorry, I'm only human. Just ignore my emotions, focus on the information.

>This discussion is big and spans several days with breaks. I can't keep everything in my mind cache.

Try my way. Don't remove an appropriate email notification until you answer the comment.
>You're right. The if check must be removed. 

Another way is to store previous queue and compare with the current one and then update only changed torrents. Maybe it will be faster in case of a large number (1000, 10000) of torrents.

>I only meant that SQL might be limited on what it can do to manipulate the DB and allow us to construct a list of downgrade commands.

I suggest we not continue this part of the discussion. It's just a distraction for the brain. I think it is unreachable in general (for example, database format changes can be accompanied by other changes that cannot be undone in this way).

>If I understood wrongly your comment, please correct me.

Yes, probably.
The main idea is not where exactly this ""upgrade"" code will be located, but it is not to break the basic logic of the application. You can do it wherever you want (within reason), even using a separate program. Your next example demonstrates this well (though you made it for opposite purposes):
>Importing torrents is an upgrade step. Did you forget that the previous upgrade code handled the import itself without involving the Session?

Now remember how we got rid of that code. We just threw it away.
And now try to throw away your current code - you will get an inoperable program. This is your mistake.
Maybe https://github.com/qbittorrent/qBittorrent/pull/10099#discussion_r245693567 is too insistent to put all the basic logic in Session class (this is the most logical place for me). Again, this can be done differently, but in any case it should not depend on ""upgrade"" code in any way. ""Upgrade"" code should just be injected into the main logic without breaking it.
Just implement it like there was never any old saving system. And then add the ""upgrade"" code without breaking anything."
458851661,10099,glassez,2019-01-30T08:15:21Z,">>then v4 allow export to v3, v3 to v2, v2 to v1?
>
>Yes. I think that makes more sense and possibly makes it easier on ourselves to not carry obsolete code for too long.

It looks a little redundant to me. As I understand it, you should still support exporting to the old saving system for quite some time (at least until v4.2 becomes stable enough and is used by default on all supported platforms/OSes/Distros). So why not just have it only? Each version should be able to upgrade from any previous version of 4.2 and from old saving system but it can allow downgrade to old saving system only."
458862463,10099,glassez,2019-01-30T08:52:41Z,"As for the ""data format"" issue, I will no longer insist on my opinion if this comment does not convince you. I leave it to you to make your ""suzerain's right"" to make the final decision. But do not forget that all those mistakes that could have been avoided, will then have to be corrected. They're on your conscience.

>It also provides convenience functions to convert to/from add_torrent_params->bencoded fastresume. If we want to go with separate columns, we would still need to write a function to extract the add_torrent_params fields and then populate them (for startup).

If you're only afraid of the need to create alternative helpers, then I can help you with that. It doesn't look so complicated to me.
As for the convenience of ""fastresume data saving"" feature of libtorrent, I have never considered it convenient in terms of qBittorrent design. This can only be convenient for a less integrated app that treats libtorrent as some sort of ""black box"". We are constantly monitoring the status of each torrent, and this ""feature"" creates only inconvenience for us.
I'm not sure yet we'll be able to avoid it completely. I'm examining it in detail now.

>Personally I don't see a pro in us saving the native libtorrent fastresume fields as separate columns. I don't see what we can gain from it. If you have a pro I am happy to hear it.

They were in my previous comment. Repeat them:
1. Storing data in separate columns should make it easier to manage database and debug the application. *Even now we require special editor to review bencoded files. If we'll want to see this data from DB we need additionally to save it in some file before open in editor.*
2.  In many cases we can avoid all data generation when we need to update only one field. I.e. when some even occurs we receive an appropriate alert so we can update just one (or several) field instead of asking full data from libtorrent. *This reduces the asynchrony and exposure to data loss in the event of a failure.*
3. Some fields can be reused (e.g. we can get rid from qBt-paused, qBt-forced, qBt-sequential).
4. We can avoid redundant bdecoding (at least with libtorrent-1.2). The fact that it has a ""convenient"" helper for this does not mean that the decoding process isn't excessive itself. Much simpler (from the performance perspective) to fill add_torrent_params from database table (field-to-field) than to parse the bencoded data. Even in case of libtorrent-1.1, we only need to generate the bencoded data from database table fields when we start up torrents. The speed of data generation (as a rule) is much higher than the parsing speed, the speed difference is measured in orders of magnitude.

No matter what decision you make when you consider this comment, be sure to notify me so we can proceed further based on it."
458863273,10099,glassez,2019-01-30T08:55:28Z,"@sledgehammer999, I have some ideas for ""helper"" code. Don't you mind if I add commits here from time to time? Then you can squash them. Or should I paste it in comments instead?"
460168758,10099,sledgehammer999,2019-02-04T08:43:07Z,@glassez sorry for the lack of comments. I'll be busy for a couple of days. About the fastresume: I see your point and I am thinking of agreeing with you. Give me a few days to see things.
464497947,10099,sledgehammer999,2019-02-17T19:25:22Z,"I have rebased and addressed these:
1. Now the Session is responsible for initialize the DB. The upgrade code doesn't manage it directly.
2. Moved 2 alert handlers with the rest of the alert handlers
3. maybe some other minor modifications that I don't remember.

@glassez I also decided to follow your suggestion and save the fastresume into separate columns. That's because I observed we unnecessarily request new fastresume data to be generated when the trackers/webseeds list modified. Now we wiil be a ble to save it directly ourselves.
This change isn't part of the current PR yet.

Minor question: Should we save all fields of the fastresume into the DB uncoditionally? For example the fastresume has these fields that don't seem important to save, and we could generate them in runtime. What do you say?
List:
```c++
// <field name> = <value>
file-format = libtorrent resume file
file-version = 1
libtorrent-version = 1.1.9.0
```"
464524089,10099,sledgehammer999,2019-02-17T23:10:56Z,">@glassez I also decided to follow your suggestion and save the fastresume into separate columns.

uhm well, I've done some preliminary research about differences between 1.1 and 1.2. I observed that there are fields which are deprecated/removed from 1.2. Also I observed that during the 1.1 lifetime new fields were added.
So I am bit worried that a possible future change in the fastresume spec might leave us in a difficult situation. We might end up using deprecated columns in our DB or not being able to save new columns (important if new columns fix issues like not remembering the last_scrape). We would need to closely monitor libtorrent development and release new version which will create a different table schema.

If we save/load the fastresume itself verbatim, we don't need to worry since libtorrent will handle everything correctly.

Am I worried too much about this?
Maybe some middleground, like directly editing the **stored** fastresume to edit the tracker list instead of requesting libtorrent to generate one?"
466385817,10099,glassez,2019-02-22T12:49:40Z,">the fastresume has these fields that don't seem important to save, and we could generate them in runtime. What do you say?

We don't need to store them."
466468902,10099,glassez,2019-02-22T17:01:55Z,"Note: all my current and further comments about this PR assume that we use libtorrent-1.2 as the main (and libtorrent-1.1 as compatible).

>I also decided to follow your suggestion and save the fastresume into separate columns. That's because I observed we unnecessarily request new fastresume data to be generated when the trackers/webseeds list modified.

My suggestions are based on the fact that we keep track of most of the torrent data all the time the qBittorrent is running (except for a few not so important ""fastresume"" fields) so it is redundant to generate the same data again.
>So I am bit worried that a possible future change in the fastresume spec might leave us in a difficult situation...
If we save/load the fastresume itself verbatim, we don't need to worry since libtorrent will handle everything correctly.
Am I worried too much about this?

I don't think that should make us uncomfortable. Unlike previous versions libtorrent-1.2 handle fastresume data not as raw data but as add_torrent_params struct that is a part of libtorrent ABI. Knowing @arvidn's tendency to maintain a compatible ABI throughout the libtorrent branch, we can be sure that it will not change during libtorrent-1.2 life cycle (at least, it will not change often/much).
>Maybe some middleground, like directly editing the **stored** fastresume to edit the tracker list instead of requesting libtorrent to generate one?

In that case, I would suggest another way. Take a closer look. In fact, we have diverse data. Some of them represent ""important"" properties of the torrent, such as its settings and the current download/upload status (eg., save_path, ""file mapping"", different kind of priorities, paused, auto_managed etc.; usually this is all that is affected by the user). They are likely to be ""stable"" for a long time (will not be deleted/changed) so these fields should be stored in separate columns. All remaining data (not so ""important"";  usually this is all that is generated/obtained by libtorrent itself) can be serialized and stored in a single column (but in this case I would highly recommend using a more readable format than ""bencode"", e.g. JSON)."
466683194,10099,arvidn,2019-02-23T19:31:06Z,"+1 on this patch. My experience is that iterating a sqlite table is *a lot* faster than listing a directory and loading small files. In my mind, the performance gain alone is sufficient motivation for this."
493865407,10099,victorhooi,2019-05-20T07:13:45Z,"As a fan of qBittorrent =) - curious if this is still being worked on?

Is it still slated for qBittorrent 4.2.x?

Any idea of when a test version of qBittorrent with Sqlite support might land, for us to kick the tyres with?"
574025412,10099,Ryrynz,2020-01-14T06:33:04Z,Would recommend pushing this to a 4.5 or even a 5.0 Milestone.
648445873,10099,Pentaphon,2020-06-23T21:48:20Z,"> Would recommend pushing this to a 4.5 or even a 5.0 Milestone.

I agree, I'm not sure why this is in the 4.2.6 milestone. "
679107824,10099,xavier2k6,2020-08-24T12:52:37Z,for ref (previous discussion/thoughts) that I came acrosss -> https://github.com/qbittorrent/qBittorrent/issues/7565#issuecomment-355127637 onwards..
755248227,10099,txtsd,2021-01-06T11:33:20Z,Why is this continuously being pushed forward? What's the holdup?
755288340,10099,glassez,2021-01-06T13:05:49Z,"In fact, now there are even more prerequisites to use SQLite (for example, we now often save resume data when changing a particular field, but we still have to generate all the data and overwrite the file).
I would like to implement it in the near future if @sledgehammer999 does not intend to do it himself."
803213817,10099,Ryrynz,2021-03-20T01:08:56Z,"Any chance the current open issues in 4.3.4 can be moved to their respective 4.4 or 5.0 milestones?
They really shouldn't be pushed out to every minor version milestone release after release."
803243565,10099,glassez,2021-03-20T04:16:15Z,I am currently working on optimizing the resume data storage subsystem. The implementation of SQLite database storage support is part of my plans. So I still close this PR for the sake of future implementation.
598892681,12169,thalieht,2020-03-13T20:10:25Z,"`edit-clear-history` and the other 4 like it, look unchanged in qBt, just like in the after image, although i can see the change on github... Also the 2 `media-...` icons on the bottom right have very little contrast, white on gray.
I hadn't realized until now that i was ignoring all these icons because the ones currently used in qBt are barely visible on a dark theme. What a treat! They also look better in light themes too (IMO).

There is one minor thing that i'm not sure it's your problem... This color is dangerously close to the one used in Breeze theme for checked checkboxes, note Automatic Torrent Management:
![Annotation 2020-03-13 220559](https://user-images.githubusercontent.com/6451685/76655826-e4f48d80-6576-11ea-8081-e6d68787f38e.png)
"
599032648,12169,Mazino-Urek,2020-03-14T09:27:31Z,"@thalieht I have fixed those icons. I can't design the checked boxes they are done by the system theme. I have used `la-capitaine-icon-theme` for the whole project. Only cookies and bug icon has been taken from `papirus-icon-theme`. 
I have also added a guideline so that in the future it is easy to design and maintain the icons by others. I hope this gets merged."
599043812,12169,thalieht,2020-03-14T11:30:12Z,">I can't design the checked boxes they are done by the system theme.

I know, just mentioned it in case it was annoying for someone."
599047882,12169,thalieht,2020-03-14T11:59:38Z,"The ratio icon is the old one because the new is in the other PR.

![light1](https://user-images.githubusercontent.com/6451685/76681428-48c09a00-65fb-11ea-9058-af039a1c483e.png) 
![dark1](https://user-images.githubusercontent.com/6451685/76681445-71e12a80-65fb-11ea-9630-99c3abcfc578.png)
<img src=""https://user-images.githubusercontent.com/6451685/76681439-5aa23d00-65fb-11ea-9ca4-c6a11cdb1b31.png"" width=""80""><img src=""https://user-images.githubusercontent.com/6451685/76681449-760d4800-65fb-11ea-8f0f-6c405dd3333f.png"" width=""80"">"
599057519,12169,FranciscoPombal,2020-03-14T13:06:35Z,"My thoughts:

- Shouldn't the force resume button be the same color as the normal resume button, but with 2 arrows?
- I think the force recheck should be different from the force reannounce button. The force reannounce button should be something like a ""syncing"" button (something like this, 3rd row, 2nd column, but more round: https://image.freepik.com/free-vector/gui-buttons-icons-set-game-interfaces-color-blue_38100-187.jpg)"
599064815,12169,Mazino-Urek,2020-03-14T13:58:43Z,"@FranciscoPombal I will make the necessary changes but I will not be able to do anything before 26 March. In the meantime find any other problem you can find. The icon is same because in configuration file it is same. It will take some time to find the icon name and create a new one. If you can provide the list of repeated name it will make thw job easier for me.

@thalieht I can never thank you enough for building the application again and again so that I may have a look. I had no idea it would improve the look and feel of qbittorrent this much. Thank you again. "
603980177,12169,Mazino-Urek,2020-03-25T17:33:12Z,"@FranciscoPombal There may not be a separate icon for the force renounce. That is why it is adopting another icon. Give me a name which I can make an SVG of I will do it. I also want to make Tag icon. It would be nice.

I have made all folder icon square to make them homogenous."
604457401,12169,Mazino-Urek,2020-03-26T14:19:10Z,"@thalieht Anymore improvement suggestions? 

@Chocobo1 @sledgehammer999 @glassez 
I have worked hard on this project despite having a full-time job. It is really disappointing that I don't get any feedback from maintainer and developers. I still don't know if the changes are going to be merged or not. Kindly give me some form of an update."
604558486,12169,thalieht,2020-03-26T17:16:55Z,"Resume icon seems to be transparent unlike Pause and Force Resume (no opinion on which one is correct). Also maybe it's just me but it's hard for me to distinguish what's inside the Force Resume icon.
The following is my opinion and i don't have any suggestions so feel free to ignore it: I don't like how these 3 icons are in a circle because it makes them even smaller. "
604658805,12169,Mazino-Urek,2020-03-26T20:09:22Z,"@thalieht You were right from design perspective and usability those did not make any sense. I removed the circles and changed colors. I have made some other changes and all my commits are here now. Can you kindly compile one last time and give me a final look?
I am closing two other pull requests (#8406 and #12276) as I have added all my changes here. I don't think I need to make any more improvements."
604734707,12169,thalieht,2020-03-26T23:16:26Z,"![light](https://user-images.githubusercontent.com/6451685/77705318-023e4880-6fc8-11ea-9a48-eb8dc50905bd.png)
![dark](https://user-images.githubusercontent.com/6451685/77705314-ff435800-6fc7-11ea-9fc9-416b6b2a993a.png)

👍 "
604747250,12169,FranciscoPombal,2020-03-27T00:02:44Z,"@now-im This looks really good right now. I have no complaints. @thalieht can you please post more screenshots, from settings, etc?

EDIT: except 2 minor details:
- Why do ""categories"" and ""tags"" icons in the right click menu turn black in the dark theme, but ""rename"" and ""edit trackers"" don't
- the firewalled icon is still a shield, which still conveys the meaning of protection. How about a flame with an exclamation mark instead?"
604761922,12169,thalieht,2020-03-27T01:02:44Z,">@thalieht can you please post more screenshots, from settings, etc?

They're in https://github.com/qbittorrent/qBittorrent/pull/12169#issuecomment-599047882  except the BitTorrent gear is orange now.

Also
<img src=""https://user-images.githubusercontent.com/6451685/77710013-8ea33800-6fd5-11ea-8330-29b2aa92876b.gif"" width=""300"">
"
604772015,12169,FranciscoPombal,2020-03-27T01:43:58Z,"@now-im 

IMO I'd either leave the connections icon in the settings as the ethernet port or I'd change to a wifi symbol as well.

Can't say I am a fan of the Bittorrent icon in the settings, either. I am thinking something like drawing 2 or 3 from here (https://www.rs-online.com/designspark/rel-assets/dsauto/temp/uploaded/network_types.png?w=815), but less symmetric and with less nodes and less lines also in the case of 3 so that the point comes across without looking too small/cluttered.

But it's up to you, since you've already done so much."
604829832,12169,Mazino-Urek,2020-03-27T05:59:28Z,"@FranciscoPombal I got two icons. See which feels right.
![image](https://user-images.githubusercontent.com/22009014/77726489-3181a380-7022-11ea-9f85-6141771b5f2c.png)
![image](https://user-images.githubusercontent.com/22009014/77726557-65f55f80-7022-11ea-89cd-7aee507d10aa.png)

On the other note, I think changing the donate Icon from wallet to love will be a good idea. 
![image](https://user-images.githubusercontent.com/22009014/77734071-33ebf980-7032-11ea-8ff1-1b8fb26efea0.png)
![image](https://user-images.githubusercontent.com/22009014/77734196-73b2e100-7032-11ea-98a5-585ee31e7fd7.png)

I have also changed the magnet icon from orange to green. Will this work?
![image](https://user-images.githubusercontent.com/22009014/77734485-f9cf2780-7032-11ea-9aed-f293dcb59d62.png)



"
604997750,12169,FranciscoPombal,2020-03-27T13:22:47Z,"@now-im 

> @FranciscoPombal I got two icons. See which feels right.

I vote for the first one, but I'd wait for more opinions @thalieht.

> On the other note, I think changing the donate Icon from wallet to love will be a good idea.

Yes, good idea.

> I have also changed the magnet icon from orange to green. Will this work?

Now that you mention it, I don't think any icons other than those associated with ""activity""/""downloading""/""resuming"" should be green. The only icons that need changing are the ""documentation"" and ""about"", from green to blue. also shouldn't the ""about"" icon be different? something like this: http://icon-library.com/images/about-icon/about-icon-25.jpg

About the magnet icon specifically, I think it works as it was (orange), but blue like the other ones also would be good. I'll leave the final choice of the magnet icon color up to you."
605007262,12169,Mazino-Urek,2020-03-27T13:41:53Z,"> The only icons that need changing are the ""documentation"" and ""about"", from green to blue. also shouldn't the ""about"" icon be different?

Here is the problem I am facing. Right now there are four icons that have a question mark in them. `dialog-information.svg, help-about.svg and help-contents.svg`. I got no idea which is the one represents about. I have no problem changing it to an ""i"". 



> About the magnet icon specifically, I think it works as it was (orange), but blue like the other ones also would be good. I'll leave the final choice of the magnet icon color up to you.

Then I am keeping it as orange. It just pops out among other icons. 

P.S. Only 3 icon was using yellow color. I have replaced them with orange. Less color clutter this way."
605035480,12169,FranciscoPombal,2020-03-27T14:37:28Z,"@now-im
> Here is the problem I am facing. Right now there are four icons that have a question mark in them. `dialog-information.svg, help-about.svg and help-contents.svg`. I got no idea which is the one represents about. I have no problem changing it to an ""i"".

it's `help-about.svg`. `dialog-information.svg` should also be an `i` (can be a different one, up to you) if it isn't already.

> Then I am keeping it as orange. It just pops out among other icons.

:+1: 
 
> P.S. Only 3 icon was using yellow color. I have replaced them with orange. Less color clutter this way.

:+1: "
605039888,12169,Mazino-Urek,2020-03-27T14:46:10Z,"@FranciscoPombal Then I think my work here is done. I have pushed all changes. If qbittorent project ever needs a new app icon, knock me. I will do whatever I can."
605043670,12169,FranciscoPombal,2020-03-27T14:53:16Z,"@now-im 
> @FranciscoPombal Then I think my work here is done. I have pushed all changes. If qbittorent project ever needs a new app icon, knock me. I will do whatever I can.

Don't forget to change the ""about""/""information"" icons to `i`'s

PS - your comment shows up as edited because I accidentally clicked that instead of ""quote reply"", but I reverted the changes I made"
605046270,12169,Mazino-Urek,2020-03-27T14:57:52Z,"> @now-im
> 
> > @FranciscoPombal Then I think my work here is done. I have pushed all changes. If qbittorent project ever needs a new app icon, knock me. I will do whatever I can.
> 
> Don't forget to change the ""about""/""information"" icons to `i`'s
> 
I have made the changes in `Improving Donation, Magnet, Help icons` commit. I had a hunch. You confirmed it in a later comment. So, it is already done.
![image](https://user-images.githubusercontent.com/22009014/77769050-88609a80-706d-11ea-876b-f372529cdf5a.png)
This is `dialog-information.svg` now.
"
605067432,12169,FranciscoPombal,2020-03-27T15:38:28Z,"> I have made the changes in `Improving Donation, Magnet, Help icons` commit. I had a hunch. You confirmed it in a later comment. So, it is already done.

My bad, didn't notice.

Outstanding job. I have no further comments.

@glassez @Chocobo1 @sledgehammer999 review for merging please."
605116853,12169,glassez,2020-03-27T17:06:43Z,"Personally, I don't mind updating the app's appearance from time to time.
As for the icons themselves, this is subjective... I prefer not to engage in arguments about subjective topics. So if you approve some icon set by a majority vote and, most importantly, if the maintainer also approves it, I don't mind.
The only objection is that we should not apply such changes between minor releases."
605456971,12169,glassez,2020-03-28T14:46:44Z,Also you need to squash all your commits into one and fix commit message (and PR title) before we can merge it.
605464911,12169,Chocobo1,2020-03-28T15:46:40Z,"A few thoughts:
* @now-im:
  * I noticed there are some files such as src/icons/skin/downloading.svg.orig, src/icons/skin/downloading_BACKUP_7148.svg, are those really in use? I suppose you commit them accidentally?
  * There is a .svgo.yml in the icons folder, you should use it to slim down the svg files when everything is settled.
  ps. don't use other tools, IIRC it will destroy the viewbox or some other important property in the svg file.
  * There are a few newly added icons, which I believe are not currently in use... 

* Anyone interested in reviewing src/icons/skin/Design Guidelines.md?

* @thalieht What about WebUI? Does it look nice too?"
605509221,12169,Mazino-Urek,2020-03-28T19:41:12Z,"> Also you need to squash all your commits into one and fix commit message (and PR title) before we can merge it.

Done.

>     * I noticed there are some files such as src/icons/skin/downloading.svg.orig, src/icons/skin/downloading_BACKUP_7148.svg, are those really in use? I suppose you commit them accidentally?

They were in the main repository so I changed them too. I have no idea what .orig extension does.



>     * There is a .svgo.yml in the icons folder, you should use it to slim down the svg files when everything is settled.
>       ps. don't use other tools, IIRC it will destroy the viewbox or some other important property in the svg file.

Icons from both theme and skin folders have an accumulated size under 600kb. I think leaving the icon as is will help people who want to modify them in the future. However, I will do it if you insist.



>     * There are a few newly added icons, which I believe are not currently in use...

I just modified available icons. Added nothing, deleted nothing. I would like to add ""Tags"" icon if anyone can provide me the SVG file name.



>     * Anyone interested in reviewing src/icons/skin/Design Guidelines.md?

I have removed it. I don't think future designers would like me to control their design choice."
605530893,12169,FranciscoPombal,2020-03-28T22:59:43Z,"@now-im 
> They were in the main repository so I changed them too. I have no idea what .orig extension does.

Something in your setup must have created them accidentally, they are not present in the current repo. The `.orig` extension typically means a ""backup""."
605546710,12169,thalieht,2020-03-29T02:08:12Z,">@thalieht What about WebUI? Does it look nice too?

The same

![webui](https://user-images.githubusercontent.com/6451685/77838170-fdb99180-7179-11ea-9608-c48e6c194e3d.png)

@now-im are these the correct icons for `Documentation` and `About`?

![em](https://user-images.githubusercontent.com/6451685/77838189-3bb6b580-717a-11ea-8159-bfa9cb7e30fa.png)

>I would like to add ""Tags"" icon if anyone can provide me the SVG file name.

Whatever you see fit? or i didn't understand the question.

"
605561072,12169,Mazino-Urek,2020-03-29T05:22:12Z,"> @now-im are these the correct icons for `Documentation` and `About`?

I have changed them into this now. 
![image](https://user-images.githubusercontent.com/22009014/77841003-18f2c400-71af-11ea-873e-636d105a57d2.png)

> Whatever you see fit? or i didn't understand the question.
I want to change these two pairs of same icons into a different one. Somehow they are linked as same. Can you give me some directions?

![77838170-fdb99180-7179-11ea-9608-c48e6c194e3d](https://user-images.githubusercontent.com/22009014/77841011-2c059400-71af-11ea-8748-714651a3cbb5.png)



> Something in your setup must have created them accidentally, they are not present in the current repo. The `.orig` extension typically means a ""backup"".

Okay, I have removed them. I had no idea how I created them,"
605622490,12169,FranciscoPombal,2020-03-29T11:35:37Z,"@now-im 
Ok, I think the tag and category icons can be the same, but now I see a few issues with the WebUI screenshots I hadn't noticed before:
- The ""force reannounce"" icon should be different than the force recheck icon; it should be something like a ""sync"" icon (example: https://cdn3.iconfinder.com/data/icons/faticons/32/sync-01-512.png)
- There are no icons for ""queue"", ""download first and last pieces first"", and ""download in sequential order"" in that context menu. Is this intentional?

Sorry for insisting for more changes when I had already indicated that I had nothing more to say."
605625810,12169,ArcticGems,2020-03-29T12:04:40Z,">     * The ""force reannounce"" icon should be different than the force recheck icon; it should be something like a ""sync"" icon (example: https://cdn3.iconfinder.com/data/icons/faticons/32/sync-01-512.png)
> 

Or something like this? =
https://www.iconfinder.com/icons/115884/delay_reload_time_icon"
605626815,12169,FranciscoPombal,2020-03-29T12:13:08Z,"> Or something like this? =
> https://www.iconfinder.com/icons/115884/delay_reload_time_icon

Disagree, it has nothing to do with time or time intervals."
605628174,12169,ArcticGems,2020-03-29T12:25:08Z,"What about a simple bell with refresh arrows in/on it, it's a popular choice for announcement (icon below doesn't have refresh arrows)? =
https://www.iconfinder.com/icons/452625/announce_bell_ring_sound_icon"
605631816,12169,xavier2k6,2020-03-29T12:57:26Z,"The ""delete icon"" looks like a glass with two ice cubes in it.........to me anyway.

the ""edit delete"" icon may be more appropriate in ""red"" or something..."
605632200,12169,thalieht,2020-03-29T13:00:17Z,">I want to change these two pairs of same icons into a different one. Somehow they are linked as same. Can you give me some directions?

It's easy you just need to change ""view-categories"" in 1 line in 2 files to the new file name, also to add an entry with the new file in `src/icons/icons.qrc`, note the alphabetical order.
https://github.com/qbittorrent/qBittorrent/blob/8a8607bf93bb0bdc0ffa533847a96c762b0ed9f9/src/gui/transferlistwidget.cpp#L1223
https://github.com/qbittorrent/qBittorrent/blob/8a8607bf93bb0bdc0ffa533847a96c762b0ed9f9/src/webui/www/private/index.html#L140

On another note i saw that ""edit-delete"" icon is the recycle one but in qBt all deletes are final.

"
605632323,12169,Mazino-Urek,2020-03-29T13:01:26Z,"> > Or something like this? =
> > https://www.iconfinder.com/icons/115884/delay_reload_time_icon
> 
> Disagree, it has nothing to do with time or time intervals.

It looks like this now. Previous icon was complicated for a small icon.
![image](https://user-images.githubusercontent.com/22009014/77849725-94746580-71ef-11ea-982b-24e63a29be41.png)
"
605633056,12169,xavier2k6,2020-03-29T13:07:31Z,">On another note i saw that ""edit-delete"" icon is the recycle one but in qBt all deletes are final.

Maybe it needs to be changed to just a red ""X"" or a red ""bin"""
605635081,12169,Mazino-Urek,2020-03-29T13:23:48Z,"> It's easy you just need to change ""view-categories"" in 1 line in 2 files to the new file name, also to add an entry with the new file in `src/icons/icons.qrc`, note the alphabetical order.
> 
> https://github.com/qbittorrent/qBittorrent/blob/8a8607bf93bb0bdc0ffa533847a96c762b0ed9f9/src/gui/transferlistwidget.cpp#L1223





> > I want to change these two pairs of same icons into a different one. Somehow they are linked as same. Can you give me some directions?
> 
> It's easy you just need to change ""view-categories"" in 1 line in 2 files to the new file name, also to add an entry with the new file in `src/icons/icons.qrc`, note the alphabetical order.
> 
> https://github.com/qbittorrent/qBittorrent/blob/8a8607bf93bb0bdc0ffa533847a96c762b0ed9f9/src/gui/transferlistwidget.cpp#L1223
> 
> https://github.com/qbittorrent/qBittorrent/blob/8a8607bf93bb0bdc0ffa533847a96c762b0ed9f9/src/webui/www/private/index.html#L140
> 
> On another note i saw that ""edit-delete"" icon is the recycle one but in qBt all deletes are final.

I have made a commit dc9386c for the Tags icon. Kindly review it. I am working on the delete icon."
605635646,12169,Chocobo1,2020-03-29T13:28:19Z,"> > Something in your setup must have created them accidentally, they are not present in the current repo. The `.orig` extension typically means a ""backup"".
> 
> Okay, I have removed them. I had no idea how I created them,

But there are more of them.
You can find them under this link: https://github.com/qbittorrent/qBittorrent/pull/12169/files and click on the ""Jump to ..."" label. It will display a list of files, notice the first icon will be green if that file is newly added. Please make sure there are no newly added files.
"
605635801,12169,thalieht,2020-03-29T13:29:34Z,">I have made a commit dc9386c for the Tags icon. Kindly review it.

Looks good 👍 

![tags](https://user-images.githubusercontent.com/6451685/77850325-5fa9e380-71da-11ea-8d8c-26ab965bdcef.png)
"
605637150,12169,Mazino-Urek,2020-03-29T13:39:23Z,"> > > Something in your setup must have created them accidentally, they are not present in the current repo. The `.orig` extension typically means a ""backup"".
> > 
> > 
> > Okay, I have removed them. I had no idea how I created them,
> 
> But there are more of them.
> You can find them under this link: https://github.com/qbittorrent/qBittorrent/pull/12169/files and click on the ""Jump to ..."" label. It will display a list of files, notice the first icon will be green if that file is newly added. Please make sure there are no newly added files.

I removed only the .orig icons previously. Thanks for the direction. Made necessary changes in 35af412. `tags.svg` is a new icon. I will add another for force recheck.



> On another note i saw that ""edit-delete"" icon is the recycle one but in qBt all deletes are final.

It is now the same as the delete icon.

![image](https://user-images.githubusercontent.com/22009014/77850683-f768fb00-71f5-11ea-88f4-d7411a01b0fe.png)
"
605641174,12169,Mazino-Urek,2020-03-29T14:04:14Z,"> > I have made a commit [dc9386c](https://github.com/qbittorrent/qBittorrent/commit/dc9386c0aee9c5f548bb4248c38e4a6a4b5db8e0) for the Tags icon. Kindly review it.
> 
> Looks good +1
> 
> ![tags](https://user-images.githubusercontent.com/6451685/77850325-5fa9e380-71da-11ea-8d8c-26ab965bdcef.png)

I have split the reannounce and recheck icon. Strangely, they used an icon named ""document-edit-verify"" which made no sense. I have changed them to ""recheck.svg"" and ""reannounce.svg"".

If there is no more changes necessary, I would like to squash the commits."
605652247,12169,Mazino-Urek,2020-03-29T15:15:11Z,"I thank everyone who has provided their take on this work. I had no idea it would improve the initial design this much. 
I wholeheartedly thank @keeferrourke, as without his [icon set](https://github.com/keeferrourke/la-capitaine-icon-theme) I could never do this, as I am not a professional graphics designer. 

You guys are awesome!"
605654302,12169,thalieht,2020-03-29T15:28:56Z,"![menu](https://user-images.githubusercontent.com/6451685/77853031-7c4e1780-71ea-11ea-9e9b-02365fa82607.png)

👍 but reannounce is inconsistent with the actions in the tracker tab

![trac](https://user-images.githubusercontent.com/6451685/77853070-be775900-71ea-11ea-8cdf-1a5c26ce4d9f.png)
https://github.com/qbittorrent/qBittorrent/blob/8a8607bf93bb0bdc0ffa533847a96c762b0ed9f9/src/gui/properties/trackerlistwidget.cpp#L571
https://github.com/qbittorrent/qBittorrent/blob/8a8607bf93bb0bdc0ffa533847a96c762b0ed9f9/src/gui/properties/trackerlistwidget.cpp#L576

"
605655654,12169,Mazino-Urek,2020-03-29T15:37:39Z,"> ![menu](https://user-images.githubusercontent.com/6451685/77853031-7c4e1780-71ea-11ea-9e9b-02365fa82607.png)
> 
> +1 but reannounce is inconsistent with the actions in the tracker tab
> 
> ![trac](https://user-images.githubusercontent.com/6451685/77853070-be775900-71ea-11ea-8cdf-1a5c26ce4d9f.png)
> 
> https://github.com/qbittorrent/qBittorrent/blob/8a8607bf93bb0bdc0ffa533847a96c762b0ed9f9/src/gui/properties/trackerlistwidget.cpp#L571
> 
> https://github.com/qbittorrent/qBittorrent/blob/8a8607bf93bb0bdc0ffa533847a96c762b0ed9f9/src/gui/properties/trackerlistwidget.cpp#L576

Thanks a lot. Pushed the changes."
605656467,12169,glassez,2020-03-29T15:43:30Z,">>Also you need to squash all your commits into one and fix commit message (and PR title) before we can merge it.
>
>Done.

Sorry. I mean you need to fix commit message according to project Coding Guidelines."
605659939,12169,thalieht,2020-03-29T16:09:37Z,"Anyone knows why we use style standard icons for Warning and Error in trackers filter list? I hadn't noticed it until now because it doesn't look too bad in Windows (IMO) but in Linux plasma it's completely out of place:

![trackers](https://user-images.githubusercontent.com/6451685/77853880-4bbcac80-71ef-11ea-8105-fd60f5b8ac48.png)

In case you want to do something about it:
https://github.com/qbittorrent/qBittorrent/blob/8a8607bf93bb0bdc0ffa533847a96c762b0ed9f9/src/gui/transferlistfilterswidget.cpp#L290
https://github.com/qbittorrent/qBittorrent/blob/8a8607bf93bb0bdc0ffa533847a96c762b0ed9f9/src/gui/transferlistfilterswidget.cpp#L293

"
605662417,12169,FranciscoPombal,2020-03-29T16:26:33Z,"@now-im ~I believe there are still the following missing icons in the right-click context menu:~
- ~Queue~
- ~Automatic Torrent Management~
- ~Super seeding mode~
- ~Download in sequential order~
- ~Download first and last pieces first~

Plus on XFCE (Xubuntu 18.04) I still see a lot of the old icons. I would appreciate if someone could reproduce this."
605663140,12169,thalieht,2020-03-29T16:31:52Z,">Automatic Torrent Management
>Super seeding mode
>Download in sequential order
>Download first and last pieces first

But these are checkboxes."
605663171,12169,FranciscoPombal,2020-03-29T16:32:02Z,">>There is a .svgo.yml in the icons folder, you should use it to slim down the svg files when everything is settled.
>>
>> ps. don't use other tools, IIRC it will destroy the viewbox or some other important property in the svg file.

> Icons from both theme and skin folders have an accumulated size under 600kb. I think leaving the icon as is will help people who want to modify them in the future. However, I will do it if you insist.

Are designers actually expected to edit stuff in the svg files by hand (I really don't know)? If not, I think you should minify them like @Chocobo1 says. It's not about disk space used IMO, but the extra size adds up and is undesirable in the context of the size of requests to the WebUI, especially the initial one. This won't be visible in fast and reliable connections, but I think the requests to the WebUI should be as lean as possible."
605663666,12169,FranciscoPombal,2020-03-29T16:35:44Z,"@thalieht @now-im 
> But these are checkboxes.

Oh yeah. Turns out on my system, unchecked checkboxes are just blank space, which makes it seem like there is something missing. Disregard my previous remark about this then. Still, is this expected behavior (that on some systems unchecked checkboxes are completely blank)?"
605664945,12169,FranciscoPombal,2020-03-29T16:44:53Z,"Minor nitpick: I think the flame icon should be simpler, more like the shape of this one (but still with the exclamation mark of course): https://d1nhio0ox7pgb.cloudfront.net/_img/g_collection_png/standard/256x256/flame.png"
605665825,12169,Mazino-Urek,2020-03-29T16:51:45Z,"> In case you want to do something about it:
> 
> https://github.com/qbittorrent/qBittorrent/blob/8a8607bf93bb0bdc0ffa533847a96c762b0ed9f9/src/gui/transferlistfilterswidget.cpp#L290
> 
> https://github.com/qbittorrent/qBittorrent/blob/8a8607bf93bb0bdc0ffa533847a96c762b0ed9f9/src/gui/transferlistfilterswidget.cpp#L293
I have pushed some changes, see if that works.

> Are designers actually expected to edit stuff in the svg files by hand (I really don't know)? If not, I think you should minify them like @Chocobo1 says. It's not about disk space used IMO, but the extra size adds up and is undesirable in the context of the size of requests to the WebUI, especially the initial one. This won't be visible in fast and reliable connections, but I think the requests to the WebUI should be as lean as possible.

Trust me on this one. With today's internet speed it won't be a problem. By saving let's say 400kb we are forgoing metadata that can't be recovered. Shapes inside the icon become fixed and can't be improved upon.




> Oh yeah. Turns out on my system, unchecked checkboxes are just blank space, which makes it seem like there is something missing. Disregard my previous remark about this then. Still, is this expected behavior (that on some systems unchecked checkboxes are completely blank)?

That is because of the theme you are using. Changing it may help.



> Minor nitpick: I think the flame icon should be simpler, more like the shape of this one (but still with the exclamation mark of course): https://d1nhio0ox7pgb.cloudfront.net/_img/g_collection_png/standard/256x256/flame.png

Let's see what I can do."
605670143,12169,Mazino-Urek,2020-03-29T17:23:15Z,@glassez Will d508327 work?
605675188,12169,FranciscoPombal,2020-03-29T17:58:03Z,"> Trust me on this one. With today's internet speed it won't be a problem. By saving let's say 400kb we are forgoing metadata that can't be recovered. Shapes inside the icon become fixed and can't be improved upon.

Maybe icons with metadata can be kept in a separate folder that's not used for building, and minified icons can be used like before. But don't make this change now, wait for the opinions of @sledgehammer999 @Chocobo1 @glassez on this one.

> > Oh yeah. Turns out on my system, unchecked checkboxes are just blank space, which makes it seem like there is something missing. Disregard my previous remark about this then. Still, is this expected behavior (that on some systems unchecked checkboxes are completely blank)?
> 
> That is because of the theme you are using. Changing it may help.

I see. Are you sure it does not have to do with non-standard icon names or something? The theme I'm using is Greybird, the default for Xubuntu.

> > Minor nitpick: I think the flame icon should be simpler, more like the shape of this one (but still with the exclamation mark of course): https://d1nhio0ox7pgb.cloudfront.net/_img/g_collection_png/standard/256x256/flame.png
> 
> Let's see what I can do.

Don't take this personally, but it looks a bit like a poop. Maybe it needs to be a little less ""fat around the base""? If that makes sense"
605679210,12169,Mazino-Urek,2020-03-29T18:28:43Z,"> I see. Are you sure it does not have to do with non-standard icon names or something? The theme I'm using is Greybird, the default for Xubuntu.

I have only removed one icon. The others are left as is. I think the problem is either with the theme or the icon pack you are using. La-Capitane-icon-theme or Papirus-icon-theme is what I use.

> Don't take this personally, but it looks a bit like a poop. Maybe it needs to be a little less ""fat around the base""? If that makes sense

I am not good at making complicated icons. I just can modify them. I have taken one icon from [Simple Icon](https://simpleicons.org/) to make this one.

![image](https://user-images.githubusercontent.com/22009014/77857093-5ee67100-721d-11ea-8df4-3cce49d21eb2.png)
"
605682611,12169,ArcticGems,2020-03-29T18:53:59Z,"
> 
> I am not good at making complicated icons. I just can modify them. I have taken one icon from [Simple Icon](https://simpleicons.org/) to make this one.
> 
> ![image](https://user-images.githubusercontent.com/22009014/77857093-5ee67100-721d-11ea-8df4-3cce49d21eb2.png)

Much better! :smiley: 
"
605688121,12169,FranciscoPombal,2020-03-29T19:36:42Z,"> I am not good at making complicated icons. I just can modify them. I have taken one icon from [Simple Icon](https://simpleicons.org/) to make this one.
> 
> ![image](https://user-images.githubusercontent.com/22009014/77857093-5ee67100-721d-11ea-8df4-3cce49d21eb2.png)

This one is great!"
605823952,12169,NotTsunami,2020-03-30T07:12:05Z,"I recommend running the SVG files through a lossless optimizer as well, such as [this](https://vecta.io/nano) one."
605835043,12169,Mazino-Urek,2020-03-30T07:39:14Z,"Ok, Based on the popular opinion I have created a backup and made optimization based on the .svgo.yml config file available. The file size became 230kb from 486kb. This is the end result:
![image](https://user-images.githubusercontent.com/22009014/77886827-5d539200-728b-11ea-992d-450d640cb3cf.png)
The interesting thing is when I open the icon it is ok. But the preview is totally busted. Like this:
Preview:
![image](https://user-images.githubusercontent.com/22009014/77887016-aa376880-728b-11ea-9052-c1b49d5aaac3.png)
In Inkscape:
![image](https://user-images.githubusercontent.com/22009014/77887050-b7ecee00-728b-11ea-90eb-04683bbde395.png)
Now, the decision is up to you. I have made my opinion clear on previous comment."
605841119,12169,NotTsunami,2020-03-30T07:53:04Z,Does the same happen if you run them through [this](https://vecta.io/nano) site?
605842801,12169,NotTsunami,2020-03-30T07:56:48Z,I'm gonna play around with the included svgo config and see if it can be improved or if that thumbnail issue can be fixed.
605849646,12169,Mazino-Urek,2020-03-30T08:11:49Z,"> Does the same happen if you run them through [this](https://vecta.io/nano) site?

I have had previous experience with [svgcleaner](https://github.com/RazrFalcon/SVGCleaner). Using it yielded a better result. 180kb without icon breakage. 
![image](https://user-images.githubusercontent.com/22009014/77889821-4bc0b900-7290-11ea-9f98-64a692114f60.png)

@Chocobo1 @FranciscoPombal I have pushed c4808aa so that you can review the difference. What do you think? I am still against it but at least this program doesn't cause icon breakage.
"
605880044,12169,FranciscoPombal,2020-03-30T09:13:04Z,"@now-im Like I said, if it were up to me we could do one of the following:

1. keep both sets of icons (optimized and non-optimized) in the repository.
    - The increase in size in the repository is irrevelevant
    - Users benefits still benefit from using the optimized icons during program execution (all builds including release builds would use the optimized versions)
    - Developers/designers benefit from the existence of the non-optimized versions for future improvements, like you said

2. keep only the non-optimized version and make the svg optimizer pass part of the build process, but this would mean:
    - another build step, possibly optional (e.g. controlled by a flag such as `--enable-svg-optmization`/`-DSVG-OPTIMIZATION`) and for this build step either:
        - An extra build dependency
        - Requirement to be online and use an online service (I would really dislike this, even considering that for development purposes it would be ok to just use the non-optimized versions)

If option 2 is chosen, this PR would be merged with only the non-optimized icons and the build system changes stuff handled in another one. It is overall the better option IMO, since it is natural to think about non-optimized svg files as ""sources"" and optimized svg files as ""build products"". However, it is a little more complex, as it involves changes to the build system as a follow-up to this PR.

Either way this kind of decision is up to @Chocobo1 @glassez @sledgehammer999 "
605898737,12169,Chocobo1,2020-03-30T09:48:36Z,">The interesting thing is when I open the icon it is ok. But the preview is totally busted. Like this:

Now I recall such moments...

> I have had previous experience with svgcleaner. Using it yielded a better result. 180kb without icon breakage.

👍  According to their website they should have better correctness (and written in Rust should be a plus too IMO). We probably should ditch svgo.

@now-im 
I won't insist you do the svg optimization in this PR. If you don't, I would still optimize it later in another PR. And if you want to do it, then please make it another commit. At least that way we still have the original files in history.
And how does using svgcleaner gets in the way of editing? (not a designer here) Are you using layers or something else and it will be modified?
"
605905643,12169,Mazino-Urek,2020-03-30T10:01:55Z,"> I won't insist you do the svg optimization in this PR. If you don't, I would still optimize it later in another PR. And if you want to do it, then please make it another commit. At least that way we still have the original files in history.
> And how does using svgcleaner gets in the way of editing? (not a designer here) Are you using layers or something else and it will be modified?

Previously, they would combine different shapes into one and thus making the icon hard for modification. Now, after tinkering with the icon I can see that they have solved the problem. In my repository, I have [kept ](https://github.com/now-im/qBittorrent/tree/backup) the original commit untouched. I think this is ready for the merge.
"
605920892,12169,jagannatharjun,2020-03-30T10:34:29Z,"just sharing my opinion .....
imho the icons are too bright, can't we use the same shade of blue that is used in qbittorrent's icon?

nice work though..."
605921742,12169,jagannatharjun,2020-03-30T10:36:24Z,">  I have kept the original commit untouched. I think this is ready for the merge.


I think maintainers would prefer to keep the history in the official repository, since chocobo1 agrees you don't need to optimize anyway and 300 kb is nothing if you see the target audience of qbittorrent."
605929502,12169,jagannatharjun,2020-03-30T10:53:39Z,"how about making them the same size as original ones, also see the tab icons needs to be bit small
![image](https://user-images.githubusercontent.com/34717789/77904521-4bc9b480-72a2-11ea-9028-f31c71860af0.png)
![image](https://user-images.githubusercontent.com/34717789/77904927-0063d600-72a3-11ea-940c-c55eccd595a4.png)


I think this status bar icon needs some work, maybe decrease their heights a bit, also see the alternate icon button
![image](https://user-images.githubusercontent.com/34717789/77904744-ae22b500-72a2-11ea-924c-afc7e00473aa.png)


also don't you guys think the GUI looks too much colorful now (at least on windows), I personally don't like it that much, anyone window user here? please share your opinions.
![image](https://user-images.githubusercontent.com/34717789/77904605-73b91800-72a2-11ea-942a-62c6c584ca38.png)




"
605937025,12169,jagannatharjun,2020-03-30T11:11:07Z,"It does look better on the dark theme though, I think you need to find a balance
![image](https://user-images.githubusercontent.com/34717789/77906231-3a35dc00-72a5-11ea-8547-b114a8502795.png)





"
606011815,12169,Mazino-Urek,2020-03-30T13:51:01Z,"That was the main reason for the redesign. Most of this icon is barely visible in the dark themes. Besides, the most modern application is embracing the dark themes and bright colors. I will leave it up to the majority. This is my take.
 "
606015865,12169,jagannatharjun,2020-03-30T13:58:04Z,"everything else is good and acceptable but just that the top bar items really look out of order if you can decrease their heights, maybe match with the original icons that it will be really good."
606016922,12169,Mazino-Urek,2020-03-30T13:59:54Z,"Here is my proposal, I can use the color used by google. It should work in both light and dark situations. 
![image](https://user-images.githubusercontent.com/22009014/77920712-a245eb80-72c0-11ea-9fca-374d7c3a750a.png)
Or the one used by Microsoft,
![image](https://user-images.githubusercontent.com/22009014/77920804-c1447d80-72c0-11ea-9dd6-68d7fef20651.png)



> everything else is good and acceptable but just that the top bar items really look out of order if you can decrease their heights, maybe match with the original icons that it will be really good.

let's see what I can do."
606019625,12169,Mazino-Urek,2020-03-30T14:04:40Z,"let's take some opinion before that. I have had to redesign this too many times. 
@thalieht @FranciscoPombal @Chocobo1 So you agree with @jagannatharjun?"
606022106,12169,FranciscoPombal,2020-03-30T14:09:00Z,"@jagannatharjun 
> how about making them the same size as original ones, also see the tab icons needs to be bit small

> I think this status bar icon needs some work, maybe decrease their heights a bit, also see the alternate icon button

Hmm, agreed.

> also don't you guys think the GUI looks too much colorful now (at least on windows), I personally don't like it that much, anyone window user here? please share your opinions.

I don't think the number of different colors used needs to be decreased, but maybe the colors do need to be a less bright and/or saturated.

"
606026621,12169,jagannatharjun,2020-03-30T14:16:41Z,"> I don't think the number of different colors used needs to be decreased, but maybe the colors do need to be a less bright and/or saturated.

windows Native widgets are somewhat old, and too many colors on it look distracting, I personally like the original icons and icon choices and the only problem seems with them is too dim coloring. 
The icons of this PR are also very good and definitely an improvement but I don't like some choices especially sizes of icons, I would really like it if the sizes of original icons can be preserved. but this is only my personal opinion "
606027626,12169,jagannatharjun,2020-03-30T14:18:14Z,"> Here is my proposal, I can use the color used by google. It should work in both light and dark situations.

I also think you should go with google, google design guidelines seem better, Microsoft is always confused. 

EDIT: you should wait for a maintainer's opinion, their opinion is what matters."
606029943,12169,Chocobo1,2020-03-30T14:22:00Z,">@thalieht @FranciscoPombal @Chocobo1 So you agree with @jagannatharjun?

I prefer not state my personal opinion. However, good looking or not is purely subjective to each one, and refacing an app always attracts positive and negative comments, for example I can already see dissatisfied users want the original icons back or having an option to change as they wish (there is a related PR in the work IIRC) no matter how good the icons are. Just keep this in mind when facing users filing this kind of issues (hopefully there won't be many)."
606038536,12169,Mazino-Urek,2020-03-30T14:36:26Z,"@Chocobo1 @FranciscoPombal @jagannatharjun 
I am changing the color based on google guideline. Google doesn't have orange in so I can either use the yellow they use or change it to the orange used by Microsoft. This is consuming a lot of my time. Let's do this right once and for all.

> > how about making them the same size as original ones, also see the tab icons needs to be bit small
> 
> > I think this status bar icon needs some work, maybe decrease their heights a bit, also see the alternate icon button
> 
> Hmm, agreed.

Previous icons didn't have a fixed canvas or icon size. That is why my icons are very close to the size of others. I am resizing the icon but I will still try to keep them in same size. This is good practice.

@Chocobo1 Should I optimize or not? The existing npm based `svgo ` is not a good piece of software. It breaks icons. I have used `svgcleaner` instead and it is reliable. It also preserves some metadata.

Before optimization: 486 kb
After optimization: 180kb
"
606039226,12169,FranciscoPombal,2020-03-30T14:37:33Z,"@now-im I agree with @jagannatharjun that the icons should retain their sizes, but other than that, I can leave the discussion about colors to others, as it doesn't bother me either way."
606041096,12169,FranciscoPombal,2020-03-30T14:40:33Z,"@now-im keep it simple, just leave this PR without optimization, then submit another with optimization. Once both versions are in our git history, in the future a 3rd PR can be made to add the SVG optimization as a (optional) build step."
606063398,12169,Mazino-Urek,2020-03-30T15:18:16Z,"@FranciscoPombal I have resized most of them. There are two settings icon. One is `gear.svg` another is `gear32.svg`. Can you tell me which one is being used here?
https://user-images.githubusercontent.com/34717789/77904521-4bc9b480-72a2-11ea-9028-f31c71860af0.png"
606076943,12169,FranciscoPombal,2020-03-30T15:40:37Z,"> @FranciscoPombal I have resized most of them. There are two settings icon. One is `gear.svg` another is `gear32.svg`. Can you tell me which one is being used here?
> https://user-images.githubusercontent.com/34717789/77904521-4bc9b480-72a2-11ea-9028-f31c71860af0.png

No idea right now. If no one knows, just replace each one at a time with a placeholder, such as a black circle/star/whatever and see where it ends up in each case. "
606096503,12169,Mazino-Urek,2020-03-30T16:15:03Z,"@FranciscoPombal I have changed icon size and color. This PR is unoptimized. 
I have created a new one where it is optimized(#12337)."
606139440,12169,thalieht,2020-03-30T17:36:28Z,">There are two settings icon. One is gear.svg another is gear32.svg. Can you tell me which one is being used here?

Neither, `configure.svg` is used. gear and gear32 don't seem to be used anywhere."
606144997,12169,jagannatharjun,2020-03-30T17:47:12Z,"much better may bit smaller  pixel square or two

![image](https://user-images.githubusercontent.com/34717789/77944354-746ea000-72dc-11ea-8ca2-466248b35ff4.png)
"
606146677,12169,Mazino-Urek,2020-03-30T17:50:24Z,"> Neither, `configure.svg` is used. gear and gear32 don't seem to be used anywhere.

Exactly, I have searched every .cpp file in the gui folder. There is not a single mention of these two icons. Why are they in the folder then?"
606146886,12169,jagannatharjun,2020-03-30T17:50:50Z,"also if you can remove dots from search icons, they're not clearly visible due to small size thus don't look good. "
606149444,12169,Mazino-Urek,2020-03-30T17:56:04Z,"> also if you can remove dots from search icons, they're not clearly visible due to small size thus don't look good.

Done."
606385414,12169,Chocobo1,2020-03-31T04:00:51Z,">Neither, configure.svg is used. gear and gear32 don't seem to be used anywhere.

Then they should be removed to slim down the qbt binary."
606423717,12169,Mazino-Urek,2020-03-31T06:17:56Z,"> > Neither, configure.svg is used. gear and gear32 don't seem to be used anywhere.
> 
> Then they should be removed to slim down the qbt binary.

Done."
633527213,12169,glassez,2020-05-25T11:32:13Z,"Since #12861 is merged now you can provide your icons as ""UI Theme"" file (don't forget to update icons layout to follow the current one). Even if you want your icons to become built-in icon set it can help to review."
633661816,12169,Mazino-Urek,2020-05-25T17:30:10Z,"@FranciscoPombal @glassez 
I am not a programmer. Can you give me some pointers? I will do the rest. Thanks."
634568342,12169,FranciscoPombal,2020-05-27T10:19:55Z,"I think this is what @glassez means: https://github.com/qbittorrent/qBittorrent/wiki/Create-custom-themes-for-qBittorrent

Though that page hasn't been updated to mention icons (at least Ctrl+F yields no results).
@jagannatharjun could you lend a hand here and also update the wiki page please?"
634631701,12169,Mazino-Urek,2020-05-27T12:38:15Z,"@glassez @FranciscoPombal 
Sorry Guys. I am not a programmer. I have never worked in UI or with any framework. I did this for fun. 
I had no idea you have combined the icons. As you can see I have messed the Pull as I had to pull from upstream and push my changes. I am not adept at this. After trying hours, I created a new pull with changes. 
Kindly merge my pull #12926, if possible. I will also make another with optimized icons. I just can't keep doing this. From next week lockdown of my country ends and I won't be able to spend any more time on this. It was a good learning experience for me. Thank you."
899728752,15330,glassez,2021-08-16T18:32:32Z,"@xavier2k6 
Please provide screenshots/examples of how forms and produced Issues will look."
899794150,15330,thalieht,2021-08-16T20:21:36Z,"I would:
- Re-merge OS and qBt version and now that we can have a description, i would also merge the ""Qt & libtorrent-rasterbar versions."" section into it as part of the description. Main motivator for these: Less scrolling!
- Remove the ""Browser name and version."" section. The issues where these are a factor are too few to deserve a whole section. 
- Make the checkbox and section about log/settings optional unless you want to see it blindly ticked and the section filled with ""asdfasdfasdf"" to bypass the requirement. As i said in the previous PR, i would make it opt-out as ""Include them unless you know they are irrelevant to the issue"" which is what happens anyway in practice.

>Please provide screenshots/examples of how forms and produced Issues will look.

https://github.com/xavier2k6/qBittorrent/issues/new?assignees=&labels=&template=bug_report.yml
https://github.com/xavier2k6/qBittorrent/issues/new?assignees=&labels=Feature+Request&template=feature_request.yml
I can't see ""Preview"" though. I guess someone will have to make a test issue for that."
899807216,15330,xavier2k6,2021-08-16T20:46:27Z,">Please provide screenshots/examples of how forms and produced Issues will look.

example of both forms can be utilized/created from my repo:
https://github.com/xavier2k6/qBittorrent/issues/new/choose

(test away creating issues/feature requests)

>I can't see ""Preview"" though. I guess someone will have to make a test issue for that.

There's no actual ""Preview"" like we know/use to.

The ""Preview"" appears in the (text boxes) ->""What issue are you experiencing?"" etc.

@thalieht No bother, will address your comments."
899809291,15330,sakkamade,2021-08-16T20:50:23Z,"> example of both forms can be utilized/created from my repo:
https://github.com/xavier2k6/qBittorrent/issues/new/choose

Even so, the screenshots would not be redundant, I think."
899977912,15330,sakkamade,2021-08-17T04:08:27Z,"Perhaps the `<details>` element can be added to  `Log & Settings file(s).` section?

```html
<details><summary>Log & Settings file(s)</summary>

(type here)

</details>
```
<details><summary>Log & Settings file(s)</summary>

(type here)

</details>

As `value` https://github.com/qbittorrent/qBittorrent/pull/15330#discussion_r689852036, too.










"
900171167,15330,xavier2k6,2021-08-17T10:15:24Z,"I will address all issues & add screenshots etc.

Will convert to draft for now."
900416879,15330,glassez,2021-08-17T15:51:41Z,"My general opinion is as follows:
The biggest and undoubted advantage of these changes is that it will no longer produce this extra annoying text in the preamble of the Issues. So I suggest not to hung up on some little (subjective) things now, but simply eliminate obvious shortcomings (such as extra dots at the end of input field labels) and merge it. Fine-tuning can be done later in one of the following PRs."
900448106,15330,xavier2k6,2021-08-17T16:31:16Z,"OP updated with screenshot & issue example ref https://github.com/qbittorrent/qBittorrent/pull/15330#issue-713627701

~""feature request"" changes are a WIP..........time needed.~

done, added screens & example etc. to OP. (set the text area to false)"
901835278,15330,xavier2k6,2021-08-19T11:26:21Z,"will address issues/comments etc in a few days, haven't time right now."
906298852,15330,xavier2k6,2021-08-26T10:51:00Z,"> will address issues/comments etc in a few days, haven't time right now.

Working on - must update OP/screenshots etc."
908274270,15330,ArcticGems,2021-08-30T11:46:43Z,"The new  screenshots looks great, so hopefully it gets merged soon. 👍 "
908292956,15330,xavier2k6,2021-08-30T12:15:31Z,"> The new screenshots looks great, so hopefully it gets merged soon. 👍

Thanks, I've re-arranged things/re-worded etc. - So hopefully this will suffice for now.

OP Updated with New Screenshots/Example links etc."
916828780,15330,glassez,2021-09-10T11:19:58Z,"Are there any problems with completing this PR? Why is it still a Draft?

I would still merge it ASAP, and leave fine tuning for subsequent PRs."
916842776,15330,xavier2k6,2021-09-10T11:47:53Z,">Are there any problems with completing this PR? Why is it still a Draft?

I've only a few final comments to address, which will be taken care of tonight/tomorrow."
917656143,15330,xavier2k6,2021-09-12T15:20:19Z,"@Chocobo1 @thalieht Hopefully I've addressed all of your comments/concerns now.

@glassez Apologies but your approval got kicked when I pushed changes.

[OP updated](https://github.com/qbittorrent/qBittorrent/pull/15330#issue-713627701) with new screenshots & links to example issue/feature request

EDIT:
Regarding screenshot & example link for feature_request!

Both have:
>**to avoid posting a duplicate.**

This was fixed ie not bolded text. (just didn't update screenshot or example.)"
919984354,15330,glassez,2021-09-15T12:42:42Z,"@xavier2k6 
Oops... Only now I realized the fact that it is a little not what I expected from it 😒
When I initially proposed using some forms to create Issues, I mostly wanted that the data that makes sense only at the time of creating the Issue does not fall into its contents (I mean all these Prerequisites checkboxes). Now I see (in the screenshots above) that all this ""garbage"" is still here. Question - does ""GitHub Forms"" really not allow you to do as I would like? Or did you just miss this aspect?"
919996162,15330,xavier2k6,2021-09-15T12:59:36Z,">(I mean all these Prerequisites checkboxes). Now I see (in the screenshots above) that all this ""garbage"" is still here. Question - does ""GitHub Forms"" really not allow you to do as I would like?

All Prerequisites checkboxes can be removed (It's not a requirement in order to implement the github forms.)

>Or did you just miss this aspect?

It wasn't clear to me that you didn't fully want them. (crossed wires lol)

I'm not 100% sure they can be hidden like the advisory notes etc.... (I can test)

How about these?

What the user would see:
![new issue template](https://user-images.githubusercontent.com/42386382/133437582-054f96a3-ef30-444c-98a5-42f9b55e934f.png)

What we would see:
![issue what we see](https://user-images.githubusercontent.com/42386382/133437662-e8bf5331-a8e7-4d38-b9af-f71901165569.png)

Reference issue:
https://github.com/xavier2k6/qBittorrent/issues/29"
920008073,15330,glassez,2021-09-15T13:15:01Z,"@xavier2k6 
I would want the following (if it's allowed):
1. The user sees all these Prerequisites and is required to accept them in order to create an Issue (otherwise it should be impossible).
2. When the Issue is created, it should not contain Prerequisites (the fact that the Issue is created implies that Prerequisites are accepted). "
920101141,15330,xavier2k6,2021-09-15T15:02:37Z,">The user sees all these Prerequisites and is required to accept them in order to create an Issue.

That's basically what we have now.

>When the Issue is created, it should not contain Prerequisites

Unfortunately for now, (github forms is still in beta)  `markdown` is not rendered in created issue -> that's why we don't see the **ADVISORY etc.

We can:
1. Remove them completely, user will still have to fill in ""required"" text area fields etc. before being able to submit an issue.
2. Leave as-is (until `markdown` in issue body becomes available & we could use `collapsible markdown`??)
3. Instead of having them as checkboxes.......just display e.g. Please Read: xyz under `markdown` which then wouldn't be displayed in created issue.

**Option 3:**

(ignore typo's - quick draft)
![new issue 2](https://user-images.githubusercontent.com/42386382/133461070-20fe7ef4-5371-4923-b876-6866bc41335d.png)

What we would see:
![issue what we see](https://user-images.githubusercontent.com/42386382/133437662-e8bf5331-a8e7-4d38-b9af-f71901165569.png)

Reference issue:
https://github.com/xavier2k6/qBittorrent/issues/31"
920199395,15330,glassez,2021-09-15T16:56:36Z,"@xavier2k6 
**Option 3** looks like an acceptable compromise (if the Prerequisites are formatted as a list for better readability). 

@Chocobo1, @thalieht
What do you think about this?"
920217297,15330,xavier2k6,2021-09-15T17:22:25Z,"Example listing:
![prerequisites list](https://user-images.githubusercontent.com/42386382/133480123-401816c2-9586-49aa-b898-6a46e8c4c470.png)"
920320816,15330,thalieht,2021-09-15T19:37:05Z,">Option 3 looks like an acceptable compromise (if the Prerequisites are formatted as a list for better readability).
>
>@Chocobo1, @thalieht
>What do you think about this?

I'm fine with all of those options."
920555551,15330,Chocobo1,2021-09-16T03:56:02Z,">I'm fine with all of those options.

me too."
920832892,15330,xavier2k6,2021-09-16T11:49:39Z,">>I'm fine with all of those options.

>me too

Option 3, it is then - I'll remove the `checkboxes` from both `bug_report` / `feature_request` & reword/list(s) like https://github.com/qbittorrent/qBittorrent/pull/15330#issuecomment-920217297

(We can add back the `checkboxes` at a later stage in another PR, if we deem them necessary etc. etc.)"
920852570,15330,xavier2k6,2021-09-16T12:20:10Z,"Is everyone ok with the wording??

~Regarding this part ->[Check the **[frequent/common issues list](https://github.com/qbittorrent/qBittorrent/projects/2).**] in the ""feature request"", is this appropriate here or should it be omitted?? (It's basically a remnance/copy&paste from the original `feature_request.md` file.~

Removed it.

**Issue:** (User will see this beforehand - won't show in submitted body)
___
![issue list](https://user-images.githubusercontent.com/42386382/133632317-408b355f-ae66-44e1-8508-8d3329047cb4.png)

**Feature request:** (User will see this beforehand - won't show in submitted body)
___
![feature request list](https://user-images.githubusercontent.com/42386382/133632381-3642c14e-1272-42d5-a287-98d3e7d6e251.png)"
920972012,15330,xavier2k6,2021-09-16T14:50:19Z,"@glassez Hopefully, this is ok for you now?"
921469671,15330,Chocobo1,2021-09-17T04:51:55Z,"@xavier2k6 
Thank you very much for getting it done!"
921670799,15330,xavier2k6,2021-09-17T10:00:17Z,">Thank you very much for getting it done!

No problem, Looks like it's doing the job - we have a good detailed/constructive ""first issue!"" ref. #15476"
922017451,15330,dark-swordsman,2021-09-17T19:05:05Z,"Glad to be the first one! Lol. I wasn't sure if I provided enough info honestly.

Loved the format and it was easy to follow."
269936781,6186,Chocobo1,2017-01-02T06:04:38Z,"@magao 
Could you post a screenshot?
"
270038366,6186,magao,2017-01-03T01:04:44Z,"![qbittorrent_colours](https://cloud.githubusercontent.com/assets/1728015/21598206/69b7e498-d1ac-11e6-8fda-5262591ad027.png)

I'm not sure how to make it use the dark theme colours  - changing my theme in Mint Mate to a dark one didn't appear to do it."
270227906,6186,magao,2017-01-03T21:20:28Z,"Urgh! That requires getting qBittorrent compiling on Windows ... definitely not the trivial task it is on Linux and something I was hoping to avoid.

On the plus side, my Windows machine should be much faster at compiling than my qBittorrent Linux VM.

Any chance someone who already has a Windows compile setup or dark theme could fork and pull this changeset and post a screenshot? If not, I'll see if I can set it up on the weekend."
270650305,6186,thalieht,2017-01-05T14:01:17Z,"Breeze dark theme
<img width=""300"" alt=""colors"" src=""https://cloud.githubusercontent.com/assets/6451685/21682110/62ce8136-d35b-11e6-9376-fe3d0c4e9faf.PNG"">
"
270736705,6186,magao,2017-01-05T19:37:18Z,"Thanks!

Would you be able to change it to use maroon for the dark theme as well so we can compare? I suspect maroon will be too dark."
270753115,6186,thalieht,2017-01-05T20:48:00Z,"Indeed
<img width=""300"" alt=""capture2"" src=""https://cloud.githubusercontent.com/assets/6451685/21696954/decc795e-d398-11e6-8f3c-b8b017e8a84e.PNG"">
"
270784950,6186,thalieht,2017-01-05T23:10:14Z,You could use something like http://contrastchecker.com/ to test colors if you want.
270805047,6186,magao,2017-01-06T01:13:12Z,"OK - so I think the colours in the pull request work as they are, so it's just a question of whether the change is desirable or not."
271126573,6186,magao,2017-01-08T03:16:33Z,Rebased on top of #6212 and uncrustified.
272947295,6186,magao,2017-01-16T19:44:26Z,The new icon scheme #4253 is based on the existing colours - stalled and paused look a little weird in my build. If this PR gets merged then might want to adjust the icon colours to match.
274293977,6186,Balls0fSteel,2017-01-21T22:59:25Z,"I am pretty sure it's impossible to find a scheme that will fit every distribution's default colors. Maybe allow color customization via the config file, so the distribution packagers can set it up correctly? Then again, that's just another added load of bloat."
274313143,6186,magao,2017-01-22T06:53:09Z,"Rebased on top of master.

I'll see if I can work out how to change the colours of the icons to match to include in this PR, but I'm not a graphical person ..."
274318160,6186,Balls0fSteel,2017-01-22T08:54:58Z,"@magao The easiest method is using Hue/Saturation in Paint.net/GIMP. (But yeah, see my previous comment, if you match one theme/platform, it will look weird on the other one. Maybe just a new ini for the colors?)"
275237621,6186,magao,2017-01-25T21:25:37Z,"I've gone with a different approach - when loading the icons, set the icon colour to match the state colour. This will handle both light and dark themes. Doesn't require any changes to the icon files - just creates a new solid-colour pixmap masked by the transparent pixels.

![icons](https://cloud.githubusercontent.com/assets/1728015/22309269/ab332f14-e39e-11e6-9f26-541f7f4b50fb.png)

I've also got an alternative that I prefer that I've included in the PR for discussion (72399d3) - inverting the icons. This also doesn't require any changes to the icon files (just inverts the mask).

![icons_inverted](https://cloud.githubusercontent.com/assets/1728015/22309479/8b258860-e39f-11e6-80a7-e6a5378730b1.png)

If you like 1ea2539 and aren't sure about the others yet (or don't want them) I can split 1ea2539 out into its own PR.

@Balls0fSteel Whilst I think allowing customisation of the colours might be a nice feature, I think it's outside the scope of this PR (but 1ea2539 would be a step towards it as then the icons will follow the customised colours)."
275277678,6186,magao,2017-01-26T00:39:14Z,"Interesting - I just realised that my change doesn't invert the status icons in the sidebar (I don't normally display them). I'll work out how to fix that and re-push.

Although if this is desirable then the icon files themselves should be changed IMO - this would only be a stopgap."
275296895,6186,magao,2017-01-26T02:56:00Z,"I've got a new series of commits (not pushed to github yet) which I could either leave as a single PR, or split them up. **This PR should not be merged in its current state.** In the options below, if the final one is where we want to end up then I think it would be best to just have everything in this single PR.

For the transfer filter list, I've special-cased `All` to use the same colour as in the icon file (since there's no corresponding torrent state). All other filters use the colour from one of the torrent states. `Resumed` and `Active` use the same colour as `Downloading`, `Inactive` uses the same colour as `Stalled Downloading`.

The following are all on a light theme - the screenshots in earlier comments show what would happen for a dark theme (in particular, `Paused` will be Gray 80 and `Inactive` will be Salmon).

Original state colours, current icons

![issue6174_pre_filtericons](https://cloud.githubusercontent.com/assets/1728015/22318357/eb82eb48-e3cd-11e6-91c0-c2174e594ddf.png)

Modified state colours, current icons

![issue6174_post_filtericons](https://cloud.githubusercontent.com/assets/1728015/22318358/f3e05956-e3cd-11e6-8800-a3c8f11cce70.png)

Original state colours, inverted icons

![issue6174_pre_filterinverticons](https://cloud.githubusercontent.com/assets/1728015/22318366/031e66c4-e3ce-11e6-89f0-cee3eae6cffa.png)

Modified state colours, inverted icons (this is what I'll be using no matter the decision)

![issue6174_post_filterinverticons](https://cloud.githubusercontent.com/assets/1728015/22318368/0c806744-e3ce-11e6-8ac2-4afd31087443.png)
"
275336537,6186,Balls0fSteel,2017-01-26T08:51:53Z,@magao Very nice job. 👍 
275376702,6186,magao,2017-01-26T12:26:19Z,Note that this doesn't change anything for the web UI - the icon files will need to be changed for that (or an equivalent to what I've done be implemented in javascript).
275396214,6186,zeule,2017-01-26T14:08:31Z,"While joining the others who like the icons look, I would like to raise a couple of concerns regarding the code in this PR.
1. You, in fact, use a singleton to manage all the icons, but you do it implicitly, and this is not good. One can benefit from a proper implementation. For example, it can be used in the web UI as well. A singleton 
```C++
class Skin {
public:
    QIcon icon(SkinIconEnum icon); // or maybe QString &iconName
    QIcon stateIcon(TorrentState state);
    QColor stateColor(TorrentState state)
};
```
might be a much cleaner solution. Perhaps you wanted to change the current code as little as possible, but your changes make the code even uglier. Plus, your code can not react to colour theme changes in principle. While now icons are readable when switching from light to dark colour theme (and vise-versa), with these changes reading them would become problematic.   

2. Replacing colours in pixmaps will lead to problems if an icon is rendered with anti-aliasing (you kill it). At least I do see the icons in this PR aliased on 128 DPI screen. It would be much better to replace colours in SVG and render an icon afterwards.

My suggestion, therefore, is to implement the aforementioned `Skin` singleton, edit SVG skin icons to make them monochrome with simple colours (e.g. black on transparent) and then do simple text replacement (without fiddling around with Qt's SVG modules)."
275510983,6186,magao,2017-01-26T20:56:21Z,"I've worked out how to change the original SVG files (externally) to invert them (using masks - thank you text-based graphics format). So I'll do that (and modify the colours to match my new light theme) and then use the instructions to regenerate the PNG files.

@evsh Could you post a screenshot of both the icons on a dark theme, and with anti-aliasing artifacts? I may be able to find a method of doing the fill without the artifacts.

I think making more drastic changes such as how the caching works (i.e. allowing swapping between light and dark themes dynamically) needs to be a separate issue. For example, the transfer filter list is only built once - we would need to detect the theme change and then rebuild the transfer filter list.

If the code is to be refactored, it should probably be done by someone who has a better grasp of the whole picture. For example, I have no idea how the web UI fits in other than the image files being used. That's the main reason I want to have as light a touch as possible."
275533917,6186,magao,2017-01-26T22:27:20Z,"WebUI with modified icons - inverted and matching new state colours.

![qbt-webui-newicons](https://cloud.githubusercontent.com/assets/1728015/22352950/53e4a4b6-e472-11e6-9ec1-6f5e7b12ecc4.png)

Does the WebUI support dark themes? I did a text search for ""dark"" and the only thing I could find was in progressbar.js which seems unrelated."
275558949,6186,zeule,2017-01-27T00:41:17Z,"> @evsh Could you post a screenshot of both the icons on a dark theme, and with anti-aliasing artifacts?

Here is the screenshot, please:
![qbt-new-state-icons](https://cloud.githubusercontent.com/assets/394621/22356236/02cfee7e-e430-11e6-82db-8899c9327b35.png)
I have to admit that I was wrong regarding the antialiasing: the original icons are 256 by 256 pixels and that is enough when downscaling. What I do see is the absence of the sub-pixel rendering (compare with the letters at the right). But that is a completely different story.

P.S. Most of my torrents are in stalled state. Therefore, I would prefer a neutral colour for them, but now it is too reddish. "
275563356,6186,magao,2017-01-27T01:09:46Z,"@evsh I do feel that the Salmon is too light. It used to be used for paused as you can see in my earlier comments, and changing that was the whole point of this PR. I think we need some red in it, and I like the Maroon for the light theme, but we'd need something better for the dark theme then (as can also be seen in earlier comments, Maroon is too dark).

You're probably best placed to come up with a colour you like on a dark theme. The good thing is that with the PR in its current state you can experiment just by modifying `TorrentModel::getColorByState()`. Post a screenshot with your preference (+ the RGB values).

I'm glad the antialiasing isn't a problem - I was afraid that `QPixmap` was doing something weird when I made the masked solid colour. I'm not surprised there's no sub-pixel antialiasing as that's usually only a feature of the font system (but maybe there's a flag for Qt to do it for icons ... I'll have a look).

This looks relevant (though still talking about text):
https://bugreports.qt.io/browse/QTBUG-22334

I see that your stalled torrents are uploading. That's not really an undesirable condition (unlike stalled downloading) - just means no one is leeching. So maybe we should give stalled uploading the same colour as uploading?"
275563910,6186,magao,2017-01-27T01:13:34Z,"@LordNyriox I'll compare your SVG files with mine, and take the simplest (e.g. if yours aren't done with masking, that's probably simpler for someone else to modify in the future).

Just took a look ... Inkscape added a **lot** of gunk to the files ... maybe I can combine the 2 sets by just taking the paths from yours ..."
275571723,6186,zeule,2017-01-27T02:04:07Z,"My point is: the most common status (stalled) should be mapped to a neutral colour (a shade of grey). I use my own modification (#3936)  for the colour theme cause I don't think a single set of colours can satisfy  everyone. That is why my only suggestion is to be conservative: as little different colours as possible and prefer low saturated ones, especially for elements that fill a significant part of a window. 

Update: and please bear in mind that on a dark background colours look more saturated than on a light one. "
275575739,6186,magao,2017-01-27T02:36:40Z,"@evsh Your most common status (stalled) is different to my most common status (paused). In my case, I have a lot of RSS filtering, and I have all torrents paused by default so I can pick and choose (there's often several options available). As you said, no theme is going to satisfy everyone.

Stalled uploading is generally an inconsequential status, and so IMO should be either a neutral colour or the same as active uploading (royal blue on light theme, steel blue on dark theme). I'm going to implement having both uploading states be the same in my next version of the PR.

_Edit: tried this, disconnected my VPN, started seeding but for some reason it stayed in Seeding instead of Stalled Uploading - with zero traffic._

Stalled downloading is almost always undesirable e.g. if all my torrents are stalled downloading for a while it might indicate that my VPN connection has gone down. I think it definitely deserves a warning colour (i.e. reddish).

Note that there are cases that stalled uploading could indicate a problem (e.g. a networking issue)."
275576804,6186,zeule,2017-01-27T02:45:45Z,"@sledgehammer999, would you accept a PR which implements skin colours selection by a user adding a new options page ""Appearance"" (possibly merging with  #6196)?"
275577102,6186,zeule,2017-01-27T02:48:22Z,"@magao indeed, the most common status may differ from user to user. This complicates selecting a universal theme even more."
275604503,6186,magao,2017-01-27T07:23:26Z,@LordNyriox Yes - I did but I'd already gone about it another way which I could do with just an SVG viewer and text editor ;) The result is sub-optimal for later graphical editing because it's using masking which is why I want to take yours and minimise the differences.
275763808,6186,magao,2017-01-27T20:17:40Z,"@LordNyriox I used [https://github.com/SVG-Edit/svgedit](SVG-edit), but I didn't use any of the graphical features other than viewing the changes. Once I'd worked out the masking I needed for each file I then just modified each SVG in a text editor.

The colours are as per my version of `TorrentModel::getColorByState()` for the light theme (+ the comments above):

checking.svg: #008080
completed.svg: #00008B
downloading.svg: #228B22
error.svg: #FF0000
filteractive.svg: #228B22
filterall.svg: #D1954E
filterinactive.svg: #800000
paused.svg: #000000
queued.svg: #008080
resumed.svg: #228B22
stalledDL.svg: #800000
stalledUL.svg: #4169E1
uploading.svg: #4169E1"
275779933,6186,magao,2017-01-27T21:30:34Z,"@LordNyriox There are definitely some differences between your SVG paths and the originals e.g. checking.svg has less-rounded corners.

Unfortunately, I can't find anything which can take a path and invert it except by masking :( Or alternatively by producing a bitmap and then tracing it.

I think I may just leave the SVGs masked. Anyone wanting to change them in the future will presumably have the know-how to deal with it. But I'll add a note in the readme.md."
275820856,6186,magao,2017-01-28T02:26:15Z,@LordNyriox No need to post PNGs - I'll just generate them using grunt.
275878237,6186,magao,2017-01-28T22:09:35Z,"@LordNyriox They look fine to me, except that the downloading and uploading icons are quite a bit bigger now. So obviously there was a reason to have different files. Could you redo `downloading.svg` and `uploading.svg` from the originals?

We'll also need @evsh to check on his hi-DPI monitor once I update the PR (after I get the new `downloading.svg` and `uploading.svg`).

Before:

![issue6174_post_filterinverticons](https://cloud.githubusercontent.com/assets/1728015/22400179/17a126e6-e602-11e6-8c4c-c1561fcebfb0.png)

After:

![issue6174_post_filterinverticons2](https://cloud.githubusercontent.com/assets/1728015/22400181/1bab29ee-e602-11e6-8844-abe8773e1f70.png)"
275957307,6186,magao,2017-01-30T00:02:12Z,"@LordNyriox I think it would be best to keep the smaller icons in this PR and then maybe you could create a separate PR for larger icons. This PR has already become much much larger than I originally envisaged (but OTOH I think the result is also much better).

I still need to reorder the PR (need to rebase your commit into it, etc) and I'm working my paid job right now so I might not get to it until the end of the day. So maybe best to wait until I have final versions for all the (small) icons to reduce churn?

FWIW I prefer the look of the smaller icons, but I don't have a hi-DPI screen and it might be that when all the icons are larger I won't mind so much (the main thing is that they're out of balance with all the other icons).

BTW, to change the amount of whitespace you could do what I did in PR #6321 - change the viewport, but in the opposite direction i.e. whereas I made the viewport larger to increase the amount of whitespace there, you would decrease the viewport."
276192429,6186,magao,2017-01-30T21:13:53Z,"@LordNyriox Thanks - I'll hopefully push a new set of commits later today.

And yes - it is `viewbox` you need to change. The parameters are `x`; `y`; `width`; `height` - you need to reduce `width` and `height` by twice what you increase `x` and `y` to keep the icon centred.

`viewbox=""0 0 32 32""` -> `viewbox=""2 2 28 28""` -> `viewbox=""4 4 24 24""` (screenshot from BoxySVG)

![checking_viewbox](https://cloud.githubusercontent.com/assets/1728015/22441688/8cbeb336-e78c-11e6-8161-fa5472d50e3b.png)

The image remains the same size, but when you then convert to PNG it's the viewbox dimensions that are used, so the icon ends up larger."
276238766,6186,ghost,2017-01-31T00:41:39Z,This and the new theme have me excited for 3.4
276294712,6186,magao,2017-01-31T07:37:32Z,"Integrated inverted icons from @LordNyriox. I rebased your commit into my series so you may want to delete the branch from your own repository to prevent duplication of changesets (maybe after this PR is merged).

Also changed the Stalled Uploading colour to be the same as Uploading.

@sledgehammer999 I think this PR is now ready for review. The only thing is the refactoring suggested by @evsh, but as I said I think I'd prefer that to be a separate PR once this is merged (and preferably done by someone who understands the effects on the WebUI as well)."
277359560,6186,magao,2017-02-03T20:53:49Z,"Something happened with https://github.com/LordNyriox/qBittorrent/commit/547bd816514a173a79b3b1f7f87f8e0f983d4986 - they changed from `viewBox=""0 0 32 32""` to `width=""32"" height=""32""`. When running `grunt` this resulted in a tiny 32x32 image in the top-right corner of a 256x256 png ...

Fortunately, changing back to using `viewBox=""0 0 32 32""` results in restoring the original size, so I'll make that modification in-flight. Also turns out that `viewBox` is case-sensitive.

And looks like something also happened with paused - it's all blank (even though it's got a path). I've taken the version from the previous commit.

Turns out `paused.svg` originally had a `viewBox=""0 0 256 256""` and `resumed.svg` had `viewBox=""0 0 16 16""`. I've normalised them both to `viewBox=""0 0 32 32""` so all the status icons have the same `viewBox`, which will make playing with the amount of whitespace by `viewBox` manipulation much easier."
277371139,6186,magao,2017-02-03T21:47:07Z,"Rebased on top of master, integrated new icons from @LordNyriox + my fixes.

@LordNyriox would you like me to squash my fixes from 1b8f521 into your commit?

BTW, I tried reducing the whitespace in the icons, and while they looked OK in the status list, I found them to be over-large in the torrent list. Maybe as part of a separate PR there should be an new ""Behaviour"" option to select larger icons. We wouldn't need to change the icon files as we could modify the pixmaps on the fly. I might play around with this and see what I can come up with."
277415554,6186,magao,2017-02-04T03:34:55Z,"Does it really matter? `grunt` will produce the same 256x256 PNG regardless of whether the source is 32x32 or 256x256 (since SVG is a vector format). Having them with the same `viewBox` dimensions is more for consistency and ease of experimentation.

I rescaled by resizing the document and object in Inkscape, then manually positioning the object, then modifying the SVG XML to remove all the cruft - a somewhat error-prone process that I'd prefer not to do for all the icons."
277566991,6186,magao,2017-02-06T01:27:32Z,"Looks like I'm going to include an option for large status icons in this PR after all. They use the original same PNG files, but trim off most of the space around them before converting to an icon (so they rely on the icons having that space).

I've also got the status icons dynamically responding to change of dark/light theme. As far as I can see there's no event that tells us the theme has changed, but I'm reasonably certain we'll always get a repaint event and I'm relying on that.

Need to clean up the changesets before I push - probably this evening.

Mint-X

![small_status_light](https://cloud.githubusercontent.com/assets/1728015/22631713/557b5f4e-ec66-11e6-9488-78ce93a16489.png)

![large_status_light](https://cloud.githubusercontent.com/assets/1728015/22631763/f6c91814-ec66-11e6-9baf-e02235b149c7.png)

Mint-Y-Dark

![small_status_dark](https://cloud.githubusercontent.com/assets/1728015/22631550/6d664c2a-ec63-11e6-90f1-51c3cdc92fa3.png)

![large_status_dark](https://cloud.githubusercontent.com/assets/1728015/22631767/ff424e02-ec66-11e6-81c7-9c82630171a8.png)"
277607775,6186,magao,2017-02-06T07:53:43Z,"@sledgehammer999 @evsh @LordNyriox 

The commits have been refactored and the actual order doesn't match what is showing above in the PR. Look at the [commits page](https://github.com/qbittorrent/qBittorrent/pull/6186/commits) instead (although that still has some weirdness with the _Follow project coding style_ commits - there should only be one at the start).

1. Refactored the icon caching. Most of the status icon handling code has been moved to `GuiIconProvider`. Other components now only need to specify an icon ID e.g. `filterall`, torrent state, or both in a few cases.

2. Torrent and filter lists follow the status colour.

3. Dynamically detects light/dark theme changes and switches to the appropriate icon colours.

4. New preference ""Use large status icons"". Switches between the small and large icons as above (updates when clicking ""Apply"").

5. Status colour changes as discussed above.

Bah - just spent an hour trying to work out why I was building successfully, but some of the AppVeyor and Travis builds were failing. Turns out I'd put some code inside an `#ifdef` that it shouldn't have been, and missed putting some inside an `#ifdef` that should have been ..."
278139144,6186,magao,2017-02-07T21:03:34Z,@LordNyriox My current prototype removes the direct manipulation of mainwindow and replaces it with capturing the palette change and forwarding a signal. The widgets then connect to that signal and update their icons.
278145227,6186,zeule,2017-02-07T21:26:12Z,"> My current prototype...

Eager to see it :)"
278238657,6186,magao,2017-02-08T06:12:19Z,"@sledgehammer999 @evsh @LordNyriox @Chocobo1 Rebased on top of master and hopefully addressed all comments (either in discussion or code).

I've included commit 417ec61 which moves the status icons out to their own directory - let me know if you don't want it @sledgehammer999 and I'll remove it from the PR.

I've simplified the API somewhat, and in particular `IconProvider::getIconPath()` no longer takes an optional parameter. Instead, the icon path is hard-coded to `:icons/skin/` (or `:/icons/status/` with 417ec61).

Theme detection now takes place in `GuiIconProvider::configure()`, which emits `GuiIconProvider::themeChanged()` if there actually was a change. This will either be called from `MainWindow::event()` (via `GuiIconProvider::updateTheme()`) in response to a palette change, or due to a `Preferences::changed()` signal (for small/large status icons). Anything which needs to be notified of a theme change simply connects to `GuiIconProvider::themeChanged()`.

BTW I've kept the ""large"" status icon terminology as the current votes are currently 2 in favour (@magao, @LordNyriox) to 1 against (@evsh).

I've also used `static const` `QLatin1String` and `QColor` inside `TorrentModel::getIconId()` and `TorrentModel::getColorByState()`. I think it makes the code more self-documenting (and potentially slightly more efficient, though unlikely to be significant).

At one point this was a simple 6-line PR ..."
278343310,6186,zeule,2017-02-08T14:29:36Z,"> At one point this was a simple 6-line PR ...

BTW, there is an unanswered question from that times: this PR floods the main window with a lot of bright colours, effectively colourising all the strings in the torrent list, not only making them hard to read, but also making the main window look tasteless. 

I again suggest to colourise only the torrents that are in an active state which implies quick changes, i.e. those under checksum computations and maybe actively downloaded and the ones with errors. For the rest of them leave a neutral text and colourise icons only."
278456263,6186,magao,2017-02-08T20:46:06Z,"> BTW, there is an unanswered question from that times: this PR floods the main window with a lot of bright colours, effectively colourising all the strings in the torrent list, not only making them hard to read, but also making the main window look tasteless.

In my main window, it massively reduces the amount of colour as all the paused torrents go from salmon -> black.

I changed StalledUploading to be the same colour as Uploading - did that not fix your problem? If not, what state are the torrents in that you're complaining about?

I would suggest that once this is eventually merged you create a PR with your suggested changes. It would need a separate `TorrentModel::getIconColorByState()` I would think.

Or thinking about this further - maybe have **all** the text neutral, and just rely on the icon colour?

![status1_light](https://cloud.githubusercontent.com/assets/1728015/22759167/85eee092-eea5-11e6-8cd0-288f2e014c46.png)
![status1_dark](https://cloud.githubusercontent.com/assets/1728015/22759175/888da086-eea5-11e6-8c30-f4e941ff927d.png)

I've currently got both versions side-by-side (light theme), and I think I like the text being coloured."
278460840,6186,sledgehammer999,2017-02-08T21:03:45Z,"Let me say, that I didn't read any of this while it happened. So the discussion is pretty huge for me. I skimmed through it and I realize that it involves changes to font colors, icons(shape and color) and skins?

So @magao can you give me a summary on what is happening here?"
278469992,6186,magao,2017-02-08T21:39:15Z,"@sledgehammer999 As the PR currently stands:

1. Torrent state colour changes (the original PR with some modifications):

    Paused -> black/gray 80
    Stalled Downloading -> maroon/salmon
    Stalled Uploading -> royal blue/steel blue 1 (same as uploading)

    The idea is that stalled downloading indicates an undesirable state (e.g. you're not receiving data, so may wish to switch to a different torrent), whereas paused is a normal state and stalled uploading probably just indicates no one leeching (not sure if that's the case though).

But see [earlier comment](https://github.com/qbittorrent/qBittorrent/pull/6186#issuecomment-278456263).

2. Torrent status icons have been inverted - [screenshots](https://github.com/qbittorrent/qBittorrent/pull/6186#issuecomment-275296895)  (thought the actual method of doing it has changed since).

3. Recoloured the icon files to match the new light theme states so they display correctly in the web UI - [screenshot](https://github.com/qbittorrent/qBittorrent/pull/6186#issuecomment-275533917).

4. Torrent status icons are modified in-memory to be the same colour as the text - [screenshot](https://github.com/qbittorrent/qBittorrent/pull/6186#issuecomment-275237621) (though doesn't actually show the text).

5. Dark/light theme is detected and the icons switched to the corresponding colours automatically (the text was already changing) - [screenshot](https://github.com/qbittorrent/qBittorrent/pull/6186#issuecomment-277566991).

6. Option in the preferences to display larger version of the status icons (mainly for people with hi-DPI screens). The icons are modified in-memory by trimming off excess transparent space. Same screenshot as (5).

Note: I've though about reversing this - make the icons files be the larger size, then add transparent space in memory. That way we wouldn't be relying on the amount of excess space in the icon files. Thoughts? One issue is that the icons would then always be larger in the web UI.

7. Moved the status icon files into their own directory `src/icons/status` (waiting on your decision)."
278480887,6186,magao,2017-02-08T22:20:38Z,"@sledgehammer999 @evsh @LordNyriox @Chocobo1 Rebased on top of master. Addressed review comments. Top two commits are for discussion:

beb94e9: status icons in own directory
4a571de: all text in torrent list black (light theme) or gray 80 (dark theme)."
278488183,6186,sledgehammer999,2017-02-08T22:49:29Z,"Quick review from your https://github.com/qbittorrent/qBittorrent/pull/6186#issuecomment-278469992:
I think I like the icon changes. The font color changes, I am not so sure.
In any case, I want to focus on some other PRs this week and the next one. So don't wonder why I won't comment on this PR."
278490473,6186,magao,2017-02-08T22:59:03Z,If I create the _Appearance_ options tab as discussed in PR [#6196](https://github.com/qbittorrent/qBittorrent/pull/6196#issuecomment-278484599) then the issue could become moot by having options to override the colours.
278490921,6186,sledgehammer999,2017-02-08T23:01:01Z,">If I create the Appearance options tab as discussed in PR #6196 then the issue could become moot by having options to override the colours.

True. So we can keep the current defaults and user can change them."
278492499,6186,magao,2017-02-08T23:07:56Z,"> True. So we can keep the current defaults and user can change them.

In that case do you want me to resubmit this PR without the colour change, and if so do you want the status icons in their own directory? I think at that point it should be ready for merging."
278493897,6186,sledgehammer999,2017-02-08T23:14:05Z,">In that case do you want me to resubmit this PR without the colour change, and if so do you want the status icons in their own directory? I think at that point it should be ready for merging.

For the moment keep it as it is. Let's see how the Appearance tab implementation will go."
278511734,6186,zeule,2017-02-09T00:49:29Z," > 4a571de: all text in torrent list black (light theme) or gray 80 (dark theme).

To me, the new look is superb (with smaller icons)!"
301301169,6186,ghost,2017-05-14T09:36:35Z,Will this be ready for 3.4?
520175885,6186,glassez,2019-08-10T20:01:44Z,What is the status of this PR? Is it still relevant?
362281705,8347,Chocobo1,2018-02-01T14:27:49Z,">Overall, the new guidelines are more strict and demanding, but give clearer directions
>...
>I believe this will lead to better issue submissions and less clutter.

I don't oppose strict rules and regulations, but the guide is too long / too detailed IMO and that might do the exact opposite as you wanted.
If I (as a user) were going to submit a bug and stumbled upon that, either I just skim through it (and read nothing) or I will ignore it and submit it as I like (like a rebel, yeah).

I would prefer keep it short and concise, 3~5 bullet points at most for each section and give refer links to those who really want to submit a perfect bug report.

And since the number of sections are increasing, it might be best to add an TOC (table of contents) at top.
"
362363305,8347,FranciscoPombal,2018-02-01T18:46:33Z,"@Chocobo1 

> I don't oppose strict rules and regulations, but the guide is too long / too detailed IMO and that might do the exact opposite as you wanted.
> If I (as a user) were going to submit a bug and stumbled upon that, either I just skim through it (and read nothing) or I will ignore it and submit it as I like (like a rebel, yeah).

Then those users will get their issue closed with a comment such as ""Closed for insufficient information or not respecting the contributing guidelines <link fir contrib.md>"".
In my opinion, part of filtering/reducing the number of bad reports is realize that the majority of them will come precisely from the ""rebel"" users.

> I would prefer keep it short and concise, 3~5 bullet points at most for each section and give refer links to those who really want to submit a perfect bug report.
> 
> And since the number of sections are increasing, it might be best to add an TOC (table of contents) at top.

Atom and Ublock have similar or more lengthy contributing guidelines and they are doing just fine with them. That being said, I can certainly look into compressing a bit, and a TOC is indeed a very good suggestion, will add."
362380621,8347,FranciscoPombal,2018-02-01T19:47:05Z,@Chocobo1 @glassez Updated PR.
364498625,8347,Chocobo1,2018-02-09T17:18:48Z,You can squash the commits now.
364530233,8347,FranciscoPombal,2018-02-09T19:10:28Z,@Chocobo1 Perhaps we should wait for @sledgehammer999's input about linking `.torrent` files/magnet links before I proceed?
368344841,8347,sledgehammer999,2018-02-25T21:09:26Z,"I haven't read the whole nor the specific about torrent linking but:

>@Chocobo1 Perhaps we should wait for @sledgehammer999's input about linking .torrent files/magnet links before I proceed?

IMO, in order to be safe we can't encourage obvious copyright infringement. So linking and/or uploading such torrents shouldn't be encouraged.
Linking/uploading safe torrents is ok.
**If** the problem is found to be centered around a particular torrent then whoever from the team is debugging the report could tell the user to email him the torrent."
368347386,8347,sledgehammer999,2018-02-25T21:40:55Z,"**I only read the new text. I haven't it compared it to the old one**

>The issue tracker is for provable issues only: You will have to make the case that the issue is really with qBittorrent and not something else on your side.

IMO, we should allow for reporting bugs that aren't easily reproducible OR that the user can't figure out what triggers it although he tried.
And this is especially true for crashes with stack traces. This kind of crashes aren't obvious to the user, while the trace itself **sometimes** can point to the exact reason. But the trace is usually understood by the devs not the users. So this:

>Any issue opened without effort to provide the required details for developers, contributors or anybody else to reproduce the problem will be closed as invalid. For example:
>
>* Crash reports with just a stack trace.
>* Speculated performance issues that do not come with actual profiling data + analysis supporting the claim.

is a bit harsh punishment for closing an issue. IMO, if a dev comes along, sees the trace and can't figure it out then it can be closed.

>Do NOT post comments like ""+1"" or ""me too!"" without providing new relevant info on the issue. Using the built-in reactions is OK though.

Clarify that they can use the ""subscribe"" button to receive notifications of that report without having to comment first.

About the torrent link here is my suggestion:

>If there seems to be an issue with specific torrent files/magnet links:
>
>* Don't post a copyrighted or private torrent/magnet. If you're willing, offer to email a link or the torrent itself to whoever developer is debugging it and requests it.
>* Make sure you can't reproduce the problem with another client, to rule out the possibility that the issue is with the torrent file/magnet link itself.

Also
>Check in the forum page or on the forum

wtf? Typo?

About the PR commit messages: You should wait until #8374 gets finalized/merged and reference that instead.


**General comments**
1. Everything appears ok, although it is a bit much text.
2. `Do some basic troubleshooting:` should indicate that it is just examples. Rarely anything got fixed by reinstalling qbittorrent
3. `Steps to ensure a good bug report` -> It should be clarified that it is expected to at least follow most of those steps. And only if they are applicable. (We don't want to close issues because 2 steps out of 20 were missed)."
368385897,8347,glassez,2018-02-26T04:17:48Z,"@sledgehammer999, as for stack trace reports.  Since the users blindly publish stack traces here we have lots of similar issues related to same bug. Now this is one of those types of issues that I ignore when briefly reviewing the list of new issues."
368501592,8347,glassez,2018-02-26T13:19:57Z,"IMO, one of the main ideas that this document should provide is ""bugtracker is not customer support"". A bug-reporter is a full-fledged participant in the problem solving process, which has its own role. Bug-reporter helps us to solve some problem, but not Vice versa!"
368580721,8347,glassez,2018-02-26T17:27:13Z,"I had one idea about Issue management:
1. We introduce some label for bad issues, e.g. ""Bad Issue"".
2. When one of project members treats some Issue as malformed it assigns the ""Bad Issue"" label to this Issue.
3. The ""bad"" issue should be closed after some time (e.g. 1-2 weeks) unless some of the project members unassign ""Bad Issue"".

Of course, there must be assignment/unassignment reason in the Issue comments.

P.S. the same algorithm can be performed to Duplicate Issues."
368842806,8347,FranciscoPombal,2018-02-27T11:24:12Z,"@sledgehammer999 

> IMO, we should allow for reporting bugs that aren't easily reproducible OR that the user can't figure out what triggers it although he tried.
> And this is especially true for crashes with stack traces. This kind of crashes aren't obvious to the user, while the trace itself sometimes can point to the exact reason. But the trace is usually understood by the devs not the users. So this:
> 
>> Any issue opened without effort to provide the required details for developers, contributors or anybody else to reproduce the problem will be closed as invalid. For example:
>> 
>> Crash reports with just a stack trace.
>> Speculated performance issues that do not come with actual profiling data + analysis supporting the claim.
>
> is a bit harsh punishment for closing an issue. IMO, if a dev comes along, sees the trace and can't figure it out then it can be closed.

I clarified the relevant points. However, I still think these guidelines deal with stack trace reports correctly. It is made very clear that stack traces are useful, but reports with *only* a stack trace are discouraged.

> Clarify that they can use the ""subscribe"" button to receive notifications of that report without having to comment first.

Done.

> About the torrent link here is my suggestion:

Done.

> wtf? Typo?

Done.

> About the PR commit messages: You should wait until https://github.com/qbittorrent/qBittorrent/pull/8374 gets finalized/merged and reference that instead.

Should I remove the section entirely and just reference the file (once it is merged)?


> Everything appears ok, although it is a bit much text.

Yes, but I think it is necessary. As mentioned before, I think it is better to have fewer, but high-quality and relevant bug reports than a lot of spam.

If you think there are redundant sections/phrases, let me know and I will adjust the PR. I can't really compress the text further, but I could be biased since I've been looking at it for a long time

> Do some basic troubleshooting: should indicate that it is just examples. Rarely anything got fixed by reinstalling qbittorrent

Done

> Steps to ensure a good bug report -> It should be clarified that it is expected to at least follow most of those steps. And only if they are applicable. (We don't want to close issues because 2 steps out of 20 were missed).

Done"
368844901,8347,FranciscoPombal,2018-02-27T11:32:51Z,"@glassez 

> as for stack trace reports. Since the users blindly publish stack traces here we have lots of similar issues related to same bug. Now this is one of those types of issues that I ignore when briefly reviewing the list of new issues.

Yes. And it is difficult and annoying to figure out if two issues are the same without descriptive titles. Issue titles should never be ""qBittorrent has crashed"" with *just* a stack trace. They should be at least something like ""qBittorrent crashed when/while doing XYZ"", relevant info, etc and *also* a stack trace (if applicable).

> IMO, one of the main ideas that this document should provide is ""bugtracker is not customer support"". A bug-reporter is a full-fledged participant in the problem solving process, which has its own role. Bug-reporter helps us to solve some problem, but not Vice versa!

Yes, this is one of the main objectives of the PR.

> I had one idea about Issue management:

I also have several ideas pertaining to issue management. Mainly, more and better tagging is needed. I have volunteered in the past to help with this, and the offer still stands. However, I think the specifics of this subject should be discussed in some other thread, separate from the discussion about this PR, so that we don't go off-topic too much."
368845561,8347,FranciscoPombal,2018-02-27T11:35:41Z,"@glassez 

> One ""or"" is redundant.

Fixed."
368935664,8347,sledgehammer999,2018-02-27T16:22:09Z,"@glassez @FranciscoPombal After your comments, I understand that you have a valid point. Actually, in the past when I tried to troubleshoot stack traces, the reporters never answered back or answered ""uhm random crash no reason"". So yeah, I take back what I said about stack traces.

> had one idea about Issue management:
>
>  We introduce some label for bad issues, e.g. ""Bad Issue"".
> blah blah blah

@glassez agreed. But I think a better label would be ""Bad report""

"
369192085,8347,FranciscoPombal,2018-02-28T10:13:50Z,"@sledgehammer999 @glassez 
Just noticed that official Windows/macOS builds are available at https://sourceforge.net/projects/qbittorrent/files/
So I think this:

> * Asking for specific builds of qBittorrent not currently officially available.
>   * If you really need one such older unavailable build, compile it yourself from source (see wiki) or get someone to do it for you on the forum, for example.

Could be changed to something like this:

*  Asking for specific builds of qBittorrent other than the [current](https://www.qbittorrent.org/download.php) one. You can install older releases at your own risk or for regression testing purposes. Previous Windows and macOS builds are available [here].(https://sourceforge.net/projects/qbittorrent/files/)

What do you think?"
370145937,8347,glassez,2018-03-03T13:01:15Z,">@glassez agreed. But I think a better label would be ""Bad report""

Or maybe `Malformed`? Without ""Report"", since it can be applied not only to Bug reports, but to Feature requests as well."
370159350,8347,FranciscoPombal,2018-03-03T16:16:02Z,"@glassez ""Invalid"" applies nicely to both"
378216582,8347,glassez,2018-04-03T11:24:06Z,The one more related problem I have encountered often recently is issues already solved in master (and closed by appropriate commits) but still unavailable for the users due to very long release cycle so the users open similar issues again and again.
378342815,8347,FranciscoPombal,2018-04-03T18:04:34Z,"@glassez
This commit cannot really solve that problem. At best it mitigates the problem, since the guidelines specifically instruct users to search before posting.

However, we will still have to close the repeated issues that slip through."
378346816,8347,FranciscoPombal,2018-04-03T18:17:30Z,"@glassez @sledgehammer999 @Chocobo1 @thalieht 

This PR has been pending for some time now, is everybody satisfied with its current state? If no one has anything else to add I can squash the commits for this to be merged."
378411123,8347,FranciscoPombal,2018-04-03T21:51:27Z,"@glassez @sledgehammer999 @Chocobo1 @thalieht
Squashed commits, this PR is ready to be merged"
378468131,8347,glassez,2018-04-04T03:21:50Z,"We've already had too many changes since latest release, but @sledgehammer999 is gone missing somewhere..."
383647445,8347,Chocobo1,2018-04-23T16:59:03Z,PR updated
385593286,8347,Chocobo1,2018-05-01T03:54:03Z,"@FranciscoPombal 
I noticed a merge commit is introduced (which is not-preferable here).
Since this PR is approved, I'll attempt to clean it up (i.e. force push to this PR / your git repo) and merge it immediately afterward."
385594027,8347,Chocobo1,2018-05-01T04:00:44Z,Thank you!
385632948,8347,FranciscoPombal,2018-05-01T09:24:32Z,Thanks for the cleanup and merge! Thanks everyone!
532125736,11241,thalieht,2019-09-17T08:49:12Z,">Please don't forget to enclose option names in PR/commit title. Otherwise, it's just a jumble of words.

Ok but when the option names are finalized."
532127193,11241,glassez,2019-09-17T08:52:56Z,"I don't insist but I would split it into two PRs. First is for adding existing feature (delete torrent + files) to Share ratio limiting. Second is for implementation of new feature (delete torrent and its root folder).
Since the second is quite ambiguous, it can slow it down. Besides, ""delete torrent + files"" is all most users need, I think."
532326086,11241,thalieht,2019-09-17T17:42:25Z,">I don't insist but I would split it into two PRs.

No can do because of this mess with the indexes. Also i don't want to."
532436310,11241,Lagicrus,2019-09-17T23:10:30Z,"Thanks @thalieht for working on this 😄 So happy to see this finally get worked on after the seeming abandonment of https://github.com/qbittorrent/qBittorrent/pull/8671 back in April 2018.
Can't wait to use this myself"
532655850,11241,Zekcode,2019-09-18T12:11:27Z,this is going to be so awesome! 👍 !! Thanks
532763494,11241,thalieht,2019-09-18T16:31:07Z,"Removed the ""+ folder"" option and addressed all other comments so far i think, except for the options' names, waiting for a consensus."
532796496,11241,Piccirello,2019-09-18T17:57:44Z,Is there now no way to clean up remnants from extracted files?
532829636,11241,thalieht,2019-09-18T19:23:06Z,">Is there now no way to clean up remnants from extracted files?

No.."
532916242,11241,Zekcode,2019-09-19T00:27:40Z,"one more request, just installed this and works perfect. is it posiable to calculate time, from GB (Size of torrent) if i delete after 5 mins its fine for uploading to external server, if its a 10gb og smaller ish. bit if its a 100gb thats at problem :) does it make sense? 🥇 like seed 60 seconds for each GB of size a torrent is :)"
533984758,11241,thalieht,2019-09-23T07:16:37Z,"IMO it's more appropriate for the option name to be in singular if it contains ""torrent"" but @Piccirello is right that it doesn't fit the rest of the sentence. Maybe keep it as ""Remove them and their files""?"
534048904,11241,glassez,2019-09-23T10:50:36Z,">but @Piccirello is right that it doesn't fit the rest of the sentence.

Sorry, don't understand what you mean exactly.
Entire sentence should be in singular form."
534085634,11241,thalieht,2019-09-23T12:54:18Z,"""Seed torrent until its ratio reaches"" seems weird to me because the option applies to all torrents."
534097755,11241,glassez,2019-09-23T13:26:14Z,">""Seed torrent until its ratio reaches"" seems weird to me because the option applies to all torrents.

Not sure if this is the case in English... We are talking about any torrent, but not all torrents at once, so it is more correct to use the singular.
@thalieht, are you native English speaker? @LordNyriox, can you comment?"
534134760,11241,LordNyriox,2019-09-23T14:52:04Z,"@glassez: 

> We are talking about any torrent, but not all torrents at once, so it is more correct to use the singular. 

The plural version of the quoted phrase seems more appropriate, IMO.  Both versions seem more or less grammatically correct (given the context), but the plural seems like it would better indicate that this is a *global* setting, rather than some form of one-off trigger. "
534141069,11241,glassez,2019-09-23T15:05:42Z,"> Both versions seem more or less grammatically correct (given the context)

Well. Then I will remain neutral. Let's see which option wins.
>the plural seems like it would better indicate that this is a global setting, rather than some form of one-off trigger.

Not for me."
534167348,11241,thalieht,2019-09-23T16:04:03Z,"Maybe we can change the sentence as well: ""Seed until the torrent's ratio reaches""

>@thalieht, are you native English speaker?

Nope."
534171585,11241,Chocobo1,2019-09-23T16:13:58Z,"Personally I find singular form describes it better (because the option applies to each torrent individually), however that would also require changing the sentence: ""Seed torrents until their ratio reaches"" to something like ""Keep seeding until the ratio reaches"" and ""Seed torrents until their seeding time reaches"" to ""Keep seeding until the seeding time reaches""."
534205370,11241,thalieht,2019-09-23T17:38:52Z,"Now that i look at it, the groupbox ""Share Ratio Limiting"" is long overdue for a rename (since seeding time was introduced). We could change it to something like
""Seeding Limits"" and change the sentences to simple ""When the ratio reaches""."
534280872,11241,thalieht,2019-09-23T20:55:44Z,"<img src=""https://user-images.githubusercontent.com/6451685/65461846-4015b500-de5d-11e9-8249-b619bd540a48.JPG"" width=""450"">
"
534462727,11241,thalieht,2019-09-24T08:56:34Z,"Now i'm not so sure about Seeding ""Limits"" because it may imply things such as amount of torrents seeding, seeding speed and i don't know what else. But what to replace it with..."
534537885,11241,thalieht,2019-09-24T12:36:15Z,"Once again i'll copy utorrent, can't find a more appropriate term than ""Seeding Goal""."
534631199,11241,LordNyriox,2019-09-24T16:11:28Z,"@thalieht: 

> But what to replace it with... 

IMO, ""`Seeding Threshold`"" would do nicely. "
534639700,11241,thalieht,2019-09-24T16:32:06Z,">IMO, ""Seeding Threshold"" would do nicely.

To me, that sounds like it will _start_ seeding after some prerequisite."
534842997,11241,LordNyriox,2019-09-25T04:11:26Z,"@thalieht: 

> To me, that sounds like it will *start* seeding after some prerequisite. 

How about ""`Post-Seeding Actions`"", then? "
534850107,11241,glassez,2019-09-25T04:49:02Z,">Now i'm not so sure about Seeding ""Limits"" because it may imply things 

No. They are clearly described by the options inside group box.

Let's not fall into subjective speculation and keep ""Seeding Limits""."
534903769,11241,thalieht,2019-09-25T08:04:14Z,">How about ""Post-Seeding Actions"", then?

Accurate but not so easy to grasp IMO. Anyway, i guess we're keeping ""Seeding Limits"". Thanks for the suggestions though @LordNyriox.

p.s. i hate this (searching for appropriate words and phrases)"
536239605,11241,Chocobo1,2019-09-29T01:51:52Z,"@thalieht 
Thank you!"
536268559,11241,thalieht,2019-09-29T08:24:13Z,Thank you all for the reviews and your patience!
537309456,11241,Lagicrus,2019-10-02T02:32:13Z,Thanks for this @thalieht 
567475259,11708,jagannatharjun,2019-12-19T12:45:20Z,Can we use the existing progress bar(Fusion style) on windows at least? I think the current progress bar style has become a signature of QBittorrent and it does look better as compared to the windows progress bar
567480349,11708,glassez,2019-12-19T13:02:05Z,">Can we use the existing progress bar(Fusion style) on windows at least?

IIRC, it was used because of incorrect text alignment.
Custom theme creators want to customize it too, unless I'm wrong.
We can discuss it anyway.
We can use ""fusion"" progress bar with default theme and native one with custom theme."
567480760,11708,jagannatharjun,2019-12-19T13:03:17Z,"> We can use ""fusion"" progress bar with default theme and native one with custom theme.

Yes, that would be great."
567561310,11708,sledgehammer999,2019-12-19T16:27:15Z,">Text alignment is set by Model (using TextAlignmentRole).

+1. I wanted to do that a long time now but I kept forgetting about it.

>Use QStyledItemDelegate instead of QItemDelegate.

Why? What do we gain from this?

>Use native progress bar on all platforms.

uhm, I am not so sure about this. IIRC on Windows it looks very weird. (at least when talking Windows XP. The chunked green progressbar looked bad).
It is also the matter of macOS. I think it doesn't draw the text (percentage) at all in the native format."
567572243,11708,glassez,2019-12-19T16:54:30Z,">Why? What do we gain from this?

1. It's recommended by Qt
2. It affected by QSS"
567574682,11708,glassez,2019-12-19T17:00:22Z,">uhm, I am not so sure about this. IIRC on Windows it looks very weird. (at least when talking Windows XP. The chunked green progressbar looked bad).

Fortunately we don't support XP anymore.
>It is also the matter of macOS. I think it doesn't draw the text (percentage) at all in the native format.

It should be controlled by textVisible property. But I can't test it on MacOS to confirm.

We can merge it and waiting for feedbacks from users that use builds from master."
567582385,11708,sledgehammer999,2019-12-19T17:20:40Z,">But I can't test it on MacOS to confirm.

I can. Please wait a few days from my review too. (generally speaking not only for the macos thing)"
567612009,11708,glassez,2019-12-19T18:42:15Z,">Please wait a few days from my review too. 

Hopefully it will really be a few days, not weeks. Otherwise I can extract this commit into separate PR."
567612705,11708,thalieht,2019-12-19T18:44:14Z,"Changing to `QStyledItemDelegate` increased the height of every line, i know because i reverted only that and it's back to ""normal"". I'm not saying to go back to `QItemDelegate`, just giving a hint. It's no big deal to me but i prefer more info on screen.

old / new
![old](https://user-images.githubusercontent.com/6451685/71199638-0c50fc80-229f-11ea-8b80-1b174085bac9.png)![new](https://user-images.githubusercontent.com/6451685/71199646-1115b080-229f-11ea-9570-b505ed3f5a09.png)
"
567795803,11708,glassez,2019-12-20T05:37:40Z,">Changing to QStyledItemDelegate increased the height of every line,

What OS/DE are these screenshots from?
Can you also provide full width screenshots? I'm interested in Name column too."
567872881,11708,thalieht,2019-12-20T10:18:38Z,">What OS/DE are these screenshots from?

linux plasma.

![oldd](https://user-images.githubusercontent.com/6451685/71246970-71990200-2320-11ea-8502-eddd6254d5b2.png)
![neww](https://user-images.githubusercontent.com/6451685/71246978-78c01000-2320-11ea-841e-7bde51c606e5.png)
"
567911778,11708,sledgehammer999,2019-12-20T12:40:46Z,"@thalieht just a hunge for your sizing problem: What happens if you hide the ""progress"" column by unselecting it via the right-click menu (on the transfer list headers)?"
567924122,11708,thalieht,2019-12-20T13:28:17Z,">What happens if you hide the ""progress"" column

Nothing, already tried that."
568012998,11708,glassez,2019-12-20T17:38:27Z,"@thalieht, can you try the following?
1. disable custom delegate at all (comment out its creation in TransferДшыеWidget constructor|)
2. don't return any DecorationRole from TransferListModel"
568021692,11708,thalieht,2019-12-20T18:00:58Z,@glassez neither have any effect on the lines height.
568157313,11708,glassez,2019-12-21T06:34:36Z,">@glassez neither have any effect on the lines height.

Seems it's default height in current Qt."
568180978,11708,glassez,2019-12-21T13:24:00Z,">Seems it's default height in current Qt.

So we have to either accept that ""our worldview is outdated"" and get used to the current Qt default ""look and feel"", or continue to use the outdated way until Qt removes it permanently.
In 2nd case I would still use QStyledItemDelegate in the case where the custom theme is enabled to allow customize transfer list."
568187712,11708,thalieht,2019-12-21T15:06:50Z,"Another unrelated issue, is that the following happens if any column in the first line contains symbols from the language that is 3 lines below Italiano, whatever that is. Probably Qt issue since it only happens with that language (only tested symbol languages). `QStyledItemDelegate` or `QItemDelegate` are irrelevant on this one because it happens with both but it doesn't happen in `master` which is why i thought i should mention it.
![height](https://user-images.githubusercontent.com/6451685/71309712-f0bb3280-2413-11ea-8e68-cde33bf8218e.gif)"
568472366,11708,sledgehammer999,2019-12-23T13:16:20Z,"I'll try to review this later today OR tomorrow. After that passes, you can merge if you don't hear from me."
568475569,11708,glassez,2019-12-23T13:28:35Z,">I'll try to review this later today OR tomorrow. After that passes, you can merge if you don't hear from me.

The main thing I want your opinion about is using native progress bar on Windows and MacOSX. If you have no time for review please comment on it.
I can extract it into separate PR if you (and others) need more time for it. I don't want to slow down model improvements."
568663685,11708,glassez,2019-12-24T06:02:53Z,">QStyledItemDelegate or QItemDelegate are irrelevant on this one because it happens with both but it doesn't happen in master which is why i thought i should mention it.

Weird... what changes have affected it? Maybe the fact that most of columns doesn't use custom rendering. Seems Qt bug.
Anyway I don't think we should handle it by custom rendering all the fields."
568803183,11708,sledgehammer999,2019-12-24T21:18:32Z,"About native progress bars: This should be left for another PR. Current situation: On macOS the native progressbar doesn't even draw. (maybe @Kolcha wants to test too?)
On Windows 7 the native progressbar looks like below. IMO, a bit unpleasant.
Windows 7:
![Untitled](https://user-images.githubusercontent.com/273315/71425302-8d473400-26a3-11ea-863d-cc20adffd207.jpg)


About the rest: I'll conduct a review in a few hours. (if tomorrow(+10 hours from now) I have not done so, feel to merge the rest of the PR)"
568809430,11708,Kolcha,2019-12-24T23:04:27Z,"even Qt 5.14 still has [bug](https://bugreports.qt.io/browse/QTBUG-72558) with progress bar on macOS:
<img width=""1280"" alt=""Screenshot 2019-12-25 01 57 13"" src=""https://user-images.githubusercontent.com/947647/71426425-3ef15f80-26ba-11ea-84cf-f7a52e166ba1.png"">
I found workaround for that, Qt can be patched, this is not a problem if Qt is build from sources.
required patch can be found as attachment for the mentioned [Qt issue](https://bugreports.qt.io/browse/QTBUG-72558), it was posted by me long time ago. I didn't test it now, just because forgot about it, and built ""vanilla"" Qt 5.14

so, my opinion is using Fusion style for progress bar is better solution"
568830800,11708,sledgehammer999,2019-12-25T03:34:15Z,">Qt can be patched, this is not a problem if Qt is build from sources.

I would rather not distribute patched Qt.
Plus, it doesn't seem to draw a textual representation of the progress, only visual."
568847457,11708,jagannatharjun,2019-12-25T06:20:13Z,"Windows 10:
Also no '/s' in down speed and up speed.
![image](https://user-images.githubusercontent.com/34717789/71434925-aa641d00-270c-11ea-9f6b-04366df844a8.png)
"
568853392,11708,glassez,2019-12-25T07:05:23Z,">About native progress bars: This should be left for another PR.

Ok!
>Final note: our overriden delegate sizeHint() should be removed. From my test the bug I mention in the code comments doesn't seem to manifest anymore without it.

I can reproduce it so I'll leave it as is."
568888773,11708,sledgehammer999,2019-12-25T11:26:49Z,">I can reproduce it so I'll leave it as is.

Hmm, that's weird.

About the extra width difference and for historical reasons:
1. Here is how `QItemDelegate::sizeHint()` calculates it: https://code.qt.io/cgit/qt/qtbase.git/tree/src/widgets/itemviews/qitemdelegate.cpp?h=5.14.0#n475
2. Here is how `QItemDelegate::sizeHint()` calculates it: https://code.qt.io/cgit/qt/qtbase.git/tree/src/widgets/itemviews/qstyleditemdelegate.cpp?h=5.14.0#n402

They operate on different rectangles. In any case, for me, the extra width is not something bad. It seems to look and it **may** provide better readability. Old style had minimal margins, the new one feels ""more right"". I could be wrong. This is mostly subjective.
If we get user backlash, then we'll implement our own calculations."
568995046,11708,glassez,2019-12-26T07:07:23Z,PR updated. Comments are addressed.
572533790,11708,ghost,2020-01-09T12:09:22Z,"Sorting in columns isn't working properly after this PR.
![Annotation 2020-01-09 180813](https://user-images.githubusercontent.com/47396879/72066568-249ac100-330b-11ea-9114-c11b845e2ea6.png)
"
573130353,11708,glassez,2020-01-10T17:30:41Z,">Sorting in columns isn't working properly after this PR.

Can't test it now... will do it later.
Your screenshot shows the Size column isn't sorted properly. Are there any other columns that are affected by this issue?"
573144224,11708,thalieht,2020-01-10T18:07:43Z,">Are there any other columns that are affected by this issue?

https://github.com/qbittorrent/qBittorrent/issues/11844#issuecomment-572295041"
573275194,11708,ghost,2020-01-11T03:16:49Z,"Size, Done, Completed, Time active, Session download & upload, Downloaded, Uploaded 
@glassez "
577052435,11708,Chocobo1,2020-01-22T07:52:54Z,"I found another regression: In Options -> Behavior tab we have ""Hide zero in infinity values"" with selectable options ""Always"" and ""Paused torrent only"". The ""Always"" is not working and the ""Paused torrent only"" seems to work well.
"
577121495,11708,glassez,2020-01-22T10:43:30Z,">I found another regression: In Options -> Behavior tab we have ""Hide zero in infinity values"" with selectable options ""Always"" and ""Paused torrent only"". The ""Always"" is not working and the ""Paused torrent only"" seems to work well.

I'll try to handle it ASAP."
599937037,11708,ghost,2020-03-17T08:17:57Z,qBt GUI hangs a lot of times with the new transfer list architecture. Maybe someone can reproduce it and create an issue ticket. 
599941565,11708,jagannatharjun,2020-03-17T08:28:16Z,"By principle this should be faster, are you sure you are using release build or something similar"
599943208,11708,ghost,2020-03-17T08:32:23Z,"qBt compiled from current master. 
The GUI hangs after sometime when there’s a lot of download upload going on. Usually after 15-20 mins. Sometimes it won’t even display anything just stuck at a white screen when opened from tray. You’d have to close it and restart to make it work again. "
599947473,11708,glassez,2020-03-17T08:42:10Z,"Are you sure it is related to this PR?
Anyway it should be confirmed by someone else."
599955992,11708,ghost,2020-03-17T09:01:33Z,No I’m not sure. But this one is the only major GUI change since 4.2.1 which doesn’t have this issue. 
600137891,11708,FranciscoPombal,2020-03-17T15:35:24Z,"@an0n666 try applying this patch directly on top of 4.2.1 and see if you can reproduce. If the patch does not apply cleanly and it is too difficult to make it apply, or if the changes to do so make it too different, you can always try git bisect."
757466580,14054,thalieht,2021-01-10T12:15:04Z,"Other than the inevitable ""bug: i watched for like a whole minute the 12/24h graph and it didn't update"" i see no problems."
757650795,14054,glassez,2021-01-11T06:26:18Z,"> Other than the inevitable ""bug: i watched for like a whole minute the 12/24h graph and it didn't update"" i see no problems.

@jagannatharjun 
So maybe push some dummy sample once Averager is created? It can have all zero values and duration equal to resolution, isn't it?"
757654159,14054,jagannatharjun,2021-01-11T06:35:36Z,">  So maybe push some dummy sample once Averager is created? It can have all zero values and duration equal to resolution, isn't it?

Wouldn't that create contradictions between different graphs? Also, this is existing behavior and I am not interested in changing this in this PR.

Also what happened to the 4.3.3 release?"
757683237,14054,glassez,2021-01-11T07:51:27Z,"> Also, this is existing behavior and I am not interested in changing this in this PR.

Really? I don't use it so I don't know.

> Wouldn't that create contradictions between different graphs?

So maybe store first push values in buffer unconditionally (independently of resolution)?

> Also what happened to the 4.3.3 release?

What do you mean?"
757879987,14054,thalieht,2021-01-11T11:07:56Z,">Also, this is existing behavior 

Sorry about that. I didn't check it and i assumed it's new."
757923793,14054,xavier2k6,2021-01-11T12:34:27Z,"> > Also what happened to the 4.3.3 release?
> 
> What do you mean?

I presume it's the fact that you added this to the 4.3.4 milestone & not the 4.3.3 milestone

"
757926916,14054,glassez,2021-01-11T12:41:11Z,"> you added this to the 4.3.4 milestone & not the 4.3.3 milestone

v4.3.3 is decided to be released ASAP. So I don't want it to wait for this PR. Of course if this PR is fully approved earlier we can change its milestone to 4.3.3."
759242979,14054,jagannatharjun,2021-01-13T06:44:55Z,"@Chocobo1 I agree with some of last of your comments but more or less they are nitpicking with little to no effect on either the working of the code or the readability. I am out for a month, and it will take me some time to resolve those."
759253513,14054,Chocobo1,2021-01-13T07:10:00Z,">@Chocobo1 I agree with some of last of your comments but more or less they are nitpicking with little to no effect on either the working of the code or the readability.

Then why this project have a review process? you can't be selective on the review comments. And please remember people *will* have opinion on your written code, either on readability or functionality (the same goes for anyone who makes a PR).
I sometimes do find my opinion a bit nitpicking, but why should I hide it when there is opportunity for a little discussion/opinion exchange, maybe others might feel the same too.

>I am out for a month, and it will take me some time to resolve those.

Then there should be no problem to make it into v4.3.4.
"
759272167,14054,jagannatharjun,2021-01-13T07:52:52Z,"> Then why this project have a review process? you can't be selective on the review comments. And please remember people will have opinion on your written code, either on readability or functionality (the same goes for anyone who makes a PR).
I sometimes do find my opinion a bit nitpicking, but why should I hide it when there is opportunity for a little discussion/opinion exchange, maybe others might feel the same too.

I agree with you but IMO the review process of this project too much nitpicky. I welcome the comments about the architecture and effects of the code, and changes violating the coding guidelines but find this much nitpickiness on the reviewer's part unprofessional and time-wasteful. Consider this small PR, it has already taken around 20 days."
759391641,14054,glassez,2021-01-13T11:36:02Z,"> Consider this small PR, it has already taken around 20 days, while at the same time I've committed more than 50 commits in the vlc.

During this time, several logical flaws were identified here. Even considering that I was the only reviewer, and that I have very little free time, and I still want to program myself, it could be completed faster if I saw the code in a familiar/consistent form (then I would immediately focus on its logic).
As for other projects, they may have their own reasons for not caring about the ""cleanness"" of the code, and they may also have the resources to maintain ""unclean"" code."
759401650,14054,glassez,2021-01-13T11:56:38Z,">I welcome the comments about the architecture and effects of the code, and changes violating the coding guidelines but find this much nitpickiness on the reviewer's part unprofessional and time-wasteful.

Usually, this ""nitpickiness"" (which are not part of the Coding Style) is expressed in an undemanding form. They may not be satisfied. Moreover, it may not be liked by someone else, so it should not be satisfied at all, and may only be a reason for discussion (to fix some option in the Coding Style rules in order to avoid further ambiguities)."
761087375,14054,jagannatharjun,2021-01-15T17:50:21Z,"> Usually, this ""nitpickiness"" (which are not part of the Coding Style) is expressed in an undemanding form. They may not be satisfied. Moreover, it may not be liked by someone else, so it should not be satisfied at all, and may only be a reason for discussion (to fix some option in the Coding Style rules in order to avoid further ambiguities).

 I doubt they are mostly marked as required changes. also at times I rather think to just apply those changes than waste more time discussing such small ""nitpicks"" which are really unnecessary efforts to cast someone else's code into their own mold (no offense) (PS: maybe I choose an incorrect analogy (PSPS: English is not my first language)).
"
761109263,14054,glassez,2021-01-15T18:29:50Z,"> cast someone else's code into their own mold

Exactly. The Coding Style is used to make the project code look uniform. This really makes it easier to maintain it."
777952756,14054,glassez,2021-02-12T03:58:57Z,Thank you!
783715975,14054,zywo,2021-02-22T22:18:44Z,"I just received this:
```
ASSERT: ""m_sink.size() < m_sink.capacity()"" in file /home/zywo/qbittorrent/src/gui/properties/speedplotview.cpp, line 148
--Type <RET> for more, q to quit, c to continue without paging--

Thread 1 ""qbittorrent"" received signal SIGABRT, Aborted.
__GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:50
50	../sysdeps/unix/sysv/linux/raise.c: No such file or directory.
(gdb) bt
#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:50
#1  0x00007ffff59fd537 in __GI_abort () at abort.c:79
#2  0x00007ffff5f5bbf1 in  () at /lib/x86_64-linux-gnu/libQt5Core.so.5
#3  0x00007ffff5f5b040 in qt_assert_x(char const*, char const*, char const*, int) () at /lib/x86_64-linux-gnu/libQt5Core.so.5
#4  0x0000555555863939 in SpeedPlotView::Averager::push(std::array<unsigned long long, 10ul> const&) (this=0x5555562a7ae8, sampleData=...)
    at /home/zywo/qbittorrent/src/gui/properties/speedplotview.cpp:148
#5  0x000055555586481c in SpeedPlotView::pushPoint(std::array<unsigned long long, 10ul> const&) (this=0x5555562a7a10, point=...)
    at /home/zywo/qbittorrent/src/gui/properties/speedplotview.cpp:209
#6  0x000055555579a7ed in SpeedWidget::update() (this=0x555556393ad0) at /home/zywo/qbittorrent/src/gui/properties/speedwidget.cpp:146
#7  0x000055555579b7bc in QtPrivate::FunctorCall<QtPrivate::IndexesList<>, QtPrivate::List<>, void, void (SpeedWidget::*)()>::call(void (SpeedWidget::*)(), SpeedWidget*, void**)
    (f=(void (SpeedWidget::*)(class SpeedWidget * const)) 0x55555579a6a0 <SpeedWidget::update()>, o=0x555556393ad0, arg=0x7fffffffd7a0)
    at /usr/include/x86_64-linux-gnu/qt5/QtCore/qobjectdefs_impl.h:152
#8  0x000055555579b6bb in QtPrivate::FunctionPointer<void (SpeedWidget::*)()>::call<QtPrivate::List<>, void>(void (SpeedWidget::*)(), SpeedWidget*, void**)
    (f=(void (SpeedWidget::*)(class SpeedWidget * const)) 0x55555579a6a0 <SpeedWidget::update()>, o=0x555556393ad0, arg=0x7fffffffd7a0)
    at /usr/include/x86_64-linux-gnu/qt5/QtCore/qobjectdefs_impl.h:185
#9  0x000055555579b56b in QtPrivate::QSlotObject<void (SpeedWidget::*)(), QtPrivate::List<>, void>::impl(int, QtPrivate::QSlotObjectBase*, QObject*, void**, bool*)
    (which=1, this_=0x5555563af8d0, r=0x555556393ad0, a=0x7fffffffd7a0, ret=0x0) at /usr/include/x86_64-linux-gnu/qt5/QtCore/qobjectdefs_impl.h:418
#10 0x00007ffff61ae546 in  () at /lib/x86_64-linux-gnu/libQt5Core.so.5
#11 0x00005555555f3a6d in BitTorrent::Session::statsUpdated() (this=0x55555617fa00) at /home/zywo/build/qbit/src/base/qbt_base_autogen/VKOXE6AELE/moc_session.cpp:706
#12 0x000055555562aa34 in BitTorrent::Session::handleSessionStatsAlert(libtorrent::v1_2::session_stats_alert const*) (this=0x55555617fa00, p=0x7fffd8065638)
    at /home/zywo/qbittorrent/src/base/bittorrent/session.cpp:4902
#13 0x000055555562746a in BitTorrent::Session::handleAlert(libtorrent::alert const*) (this=0x55555617fa00, a=0x7fffd8065638) at /home/zywo/qbittorrent/src/base/bittorrent/session.cpp:4490
#14 0x0000555555627373 in BitTorrent::Session::readAlerts() (this=0x55555617fa00) at /home/zywo/qbittorrent/src/base/bittorrent/session.cpp:4462
#15 0x000055555564ed80 in QtPrivate::FunctorCall<QtPrivate::IndexesList<>, QtPrivate::List<>, void, void (BitTorrent::Session::*)()>::call(void (BitTorrent::Session::*)(), BitTorrent::Session*, void**) (f=(void (BitTorrent::Session::*)(class BitTorrent::Session * const)) 0x5555556272e6 <BitTorrent::Session::readAlerts()>, o=0x55555617fa00, arg=0x7fffd8020048)
    at /usr/include/x86_64-linux-gnu/qt5/QtCore/qobjectdefs_impl.h:152
#16 0x000055555564bb0a in QtPrivate::FunctionPointer<void (BitTorrent::Session::*)()>::call<QtPrivate::List<>, void>(void (BitTorrent::Session::*)(), BitTorrent::Session*, void**)
    (f=(void (BitTorrent::Session::*)(class BitTorrent::Session * const)) 0x5555556272e6 <BitTorrent::Session::readAlerts()>, o=0x55555617fa00, arg=0x7fffd8020048)
    at /usr/include/x86_64-linux-gnu/qt5/QtCore/qobjectdefs_impl.h:185
#17 0x0000555555645781 in QtPrivate::QSlotObject<void (BitTorrent::Session::*)(), QtPrivate::List<>, void>::impl(int, QtPrivate::QSlotObjectBase*, QObject*, void**, bool*)
    (which=1, this_=0x7fff712b37b0, r=0x55555617fa00, a=0x7fffd8020048, ret=0x0) at /usr/include/x86_64-linux-gnu/qt5/QtCore/qobjectdefs_impl.h:418
#18 0x00007ffff61a3f91 in QObject::event(QEvent*) () at /lib/x86_64-linux-gnu/libQt5Core.so.5
#19 0x00007ffff7a8615f in QApplicationPrivate::notify_helper(QObject*, QEvent*) () at /lib/x86_64-linux-gnu/libQt5Widgets.so.5
#20 0x00007ffff6177f6a in QCoreApplication::notifyInternal2(QObject*, QEvent*) () at /lib/x86_64-linux-gnu/libQt5Core.so.5
#21 0x00007ffff617a9a1 in QCoreApplicationPrivate::sendPostedEvents(QObject*, int, QThreadData*) () at /lib/x86_64-linux-gnu/libQt5Core.so.5
#22 0x00007ffff61cfe33 in  () at /lib/x86_64-linux-gnu/libQt5Core.so.5
#23 0x00007ffff4f90e6b in g_main_context_dispatch () at /lib/x86_64-linux-gnu/libglib-2.0.so.0
#24 0x00007ffff4f91118 in  () at /lib/x86_64-linux-gnu/libglib-2.0.so.0
#25 0x00007ffff4f911cf in g_main_context_iteration () at /lib/x86_64-linux-gnu/libglib-2.0.so.0
#26 0x00007ffff61cf4bf in QEventDispatcherGlib::processEvents(QFlags<QEventLoop::ProcessEventsFlag>) () at /lib/x86_64-linux-gnu/libQt5Core.so.5
#27 0x00007ffff617692b in QEventLoop::exec(QFlags<QEventLoop::ProcessEventsFlag>) () at /lib/x86_64-linux-gnu/libQt5Core.so.5
#28 0x00007ffff617eba0 in QCoreApplication::exec() () at /lib/x86_64-linux-gnu/libQt5Core.so.5
#29 0x00005555555d676e in Application::exec(QStringList const&) (this=0x555555f1c8c0, params=...) at /home/zywo/qbittorrent/src/app/application.cpp:650
#30 0x00005555555eb033 in main(int, char**) (argc=1, argv=0x7fffffffe1f8) at /home/zywo/qbittorrent/src/app/main.cpp:312
(gdb)"
794334618,14054,glassez,2021-03-09T19:19:55Z,"> I just received this:

#14518 should probably fix it."
163731176,4253,ngosang,2015-12-10T19:49:13Z,"Definitely we need to change the icon theme. 
"
166765578,4253,ngosang,2015-12-23T00:04:24Z,"@sledgehammer999 we should think in the icons... The default icon theme in Windows is really ugly, awfull in Windows 10... Some icons are too small for HDPI displays (Mac OS)...
"
167845960,4253,Nemo-qB,2015-12-29T18:09:59Z,"Looks very nice. Fits qBittorrent perfectly.
"
167932262,4253,Chocobo1,2015-12-30T03:50:45Z,"> @sledgehammer999 we should think in the icons... The default icon theme in Windows is really ugly, awfull in Windows 10... Some icons are too small for HDPI displays (Mac OS)...

Agree with this.

---

@bertyhell 
Thanks for this, we definitely need a new set of icons for platforms other than linux.
Looking forward to a fully replaced screenshot. The details can be dealt later.
Don't forget to submit the script used to generate the images (& colors), I guess it is a HTML/CSS file right?
"
170993137,4253,bertyhell,2016-01-12T17:54:53Z,"I'll see if i can finish it this weekend. I first wanted to see if you guys were interested.
"
173316962,4253,bertyhell,2016-01-20T18:32:01Z,"Hey,  we're about 40% done
We'll keep working on it

They are done by hand. 
But we'll also keep svgs so you have a high quality version if you ever need it. 
"
174049037,4253,bertyhell,2016-01-22T21:07:55Z,"ok guys
were at 60% of the oxigen icons

Have a sneek peek here:
![image](https://cloud.githubusercontent.com/assets/1710840/12523048/93f4809a-c154-11e5-9c99-0a6811a37032.png)
"
174082444,4253,Nemo-qB,2016-01-22T23:07:33Z,"@bertyhell Looks great indeed, well done.
"
174162013,4253,bertyhell,2016-01-23T08:48:06Z,"Sure,  shouldn't be a problem
"
174944502,4253,ngosang,2016-01-26T10:23:02Z,"@sledgehammer999 @Chocobo1 I said that before but with little success. We should pack icons in folders src/icons/theme1, src/icons/theme2... Each folder is a theme and should include all icons used in qBittorrent. By now we can ship the Oxygen theme subset but in the future we can include more themes for Windows and MacOS. The user will be able to change the theme folder in Options and graphic designers can propose new themes or new icons.
"
174945570,4253,bertyhell,2016-01-26T10:26:50Z,"Good idea. Whoever implements that can copy all the icons into the correct folders. If we do this in this PR it will break all icon references, right?
"
174946335,4253,ngosang,2016-01-26T10:30:21Z,"@bertyhell don't change your PR because of my comment. Wait for sledgehammer999.
"
174947014,4253,bertyhell,2016-01-26T10:32:26Z,":+1: 
"
174953674,4253,sledgehammer999,2016-01-26T10:48:56Z,"@bertyhell Thanks for the effort. Actually I was too looking to replace everything with flat icons from icon fonts. But never got around to it.

Can you post a screenshot on how your current progress looks in the app? Unless you aren't able to compile qbt.

I don't know if you have covered the ""completed"" icon. If not, I suggest having ""tick"" sign(in a frame) with the current color scheme. And I might have similar suggestions for other icons. It all depends on how far you have come.

> @sledgehammer999 @Chocobo1 I said that before but with little success. We should pack icons in folders src/icons/theme1, src/icons/theme2... Each folder is a theme and should include all icons used in qBittorrent. By now we can ship the Oxygen theme subset but in the future we can include more themes for Windows and MacOS. The user will be able to change the theme folder in Options and graphic designers can propose new themes or new icons.

PS: Let's first tackle what the icons will look like, and then worry about sources/scripts/license compliance etc.

No. I don't want theming support (or something like that). Plus it will bloat the binary.
"
174954428,4253,bertyhell,2016-01-26T10:52:51Z,"I can try to build it on Friday. How easy is that on windows? Is there a step-by-step i can follow?

The screenshot i posted is our current progress. We hope to finish all the icons in the oxigen folder on Friday. The other icons will take some more time.

As for the license we're using font awesome as a base for these with some self made icons were needed. So we should be good on that front.
https://fortawesome.github.io/Font-Awesome/license/
"
174957591,4253,ngosang,2016-01-26T11:01:48Z,"I can test & review this PR at night.
"
174957821,4253,bertyhell,2016-01-26T11:02:55Z,"I'll have to generate and commit the pngs first. I can do that on friday.
"
174957985,4253,sledgehammer999,2016-01-26T11:03:53Z,"Ok. I can also probably do a test build in a few hours. I'll post screenshot.
"
174958163,4253,sledgehammer999,2016-01-26T11:05:01Z,"> I'll have to generate and commit the pngs first. I can do that on friday.

Oops. Now I saw that. Then I'll wait.
"
176324339,4253,birdie-github,2016-01-28T18:28:50Z,"I do NOT want this grayish Windows-10-like shit in qBitTorrent. If you're gonna add it, PLEASE make it optional.
"
176641062,4253,birdie-github,2016-01-29T08:35:33Z,"@LordNyriox 

I almost never look at my torrent client, because it's basically a background application. I wonder why you need to constantly gaze at what's inside of it.

OK, speaking of this 2D design.

The first two icons contain too much antialiasing and they basically look dirty. If we're going this path I want them to be 100% monotone.

![icons](https://cloud.githubusercontent.com/assets/4958603/12670805/25653d02-c68d-11e5-8a95-0b85ac96fe1d.png)

@sledgehammer999 

If possible please do not delete old icons from the source distribution and make an icon pack selectable via a ./configure option.
"
176683735,4253,birdie-github,2016-01-29T10:29:25Z,"@LordNyriox 

Thank you for your comment.

I just hope that there won't be a situation when new additional actions are introduced in QBitTorrent and the old icons set becomes incomplete thus people won't be able to use it successfully.
"
176960887,4253,bertyhell,2016-01-29T20:43:15Z,"@sledgehammer999 

Ok, i finshed them. Can you try and build it and share a screenshot? I can't wait to see the result :D

![sprite](https://cloud.githubusercontent.com/assets/1710840/12687607/4b9da5f6-c6d1-11e5-82ed-ae6aea6a53a5.png)
"
176971644,4253,sledgehammer999,2016-01-29T21:13:31Z,"> If possible please do not delete old icons from the source distribution and make an icon pack selectable via a ./configure option.

Pretty much what @LordNyriox said but also if you use the configure script then that probably means you're on Linux. And on Linux qbt uses the theme's icons anyway. If you're on OSX then Apple pretty much has this kind of icons all over the place already.

@bertyhell I'll begin building shortly.
"
177006712,4253,sledgehammer999,2016-01-29T22:48:57Z,"I think the various icons look smaller than the previous ones. Especially those used in the menus and in the filelist+transferlist. Screenshots follow for your comments:

Mainwindow:
![main](https://cloud.githubusercontent.com/assets/273315/12690264/eaadc6b2-c6ea-11e5-911e-e15b8bb2f670.jpg)

Preferences:
![preferences](https://cloud.githubusercontent.com/assets/273315/12690273/f6ebdd2e-c6ea-11e5-9288-5ed48c70c4ea.jpg)

File menu:
![file](https://cloud.githubusercontent.com/assets/273315/12690280/ff369668-c6ea-11e5-8425-5bd39eedc464.jpg)

Edit menu:
![edit](https://cloud.githubusercontent.com/assets/273315/12690286/05951e08-c6eb-11e5-9878-784f5583960b.jpg)

View menu:
![view](https://cloud.githubusercontent.com/assets/273315/12690289/11480f94-c6eb-11e5-9456-f1fdc8289e5d.jpg)

Tools menu:
![tools](https://cloud.githubusercontent.com/assets/273315/12690294/1795d66a-c6eb-11e5-8e3e-5bf0bec994e8.jpg)

Help menu:
![help](https://cloud.githubusercontent.com/assets/273315/12690297/1df590b8-c6eb-11e5-9023-3b62a1615e8f.jpg)

Context menu:
![context](https://cloud.githubusercontent.com/assets/273315/12690302/245f1c08-c6eb-11e5-955f-135e14c9faf2.jpg)
"
177033718,4253,ngosang,2016-01-30T00:47:15Z,"@bertyhell 
1) Some icons width/height ratio changed. For example:
src/icons/oxygen/application-exit.png
From => W: 32px | H: 32px
To => W: 400px | H: 300px
I think we need to maintain the ratio. I don't know what is the best resolution for HDPI displays but maybe 256x256 is enough, we don't want very heavy icons.

2) Could you take a look at the icons in the src/icons/skin?? These icons are even uglier than the oxygen theme.

@sledgehammer999 will be possible to use this theme in Linux? I know you rejected #2989 but this will be more simple. Just add a checkbox in Linux to select qBittorrent theme (by default is disabled).
"
177240115,4253,Nemo-qB,2016-01-30T16:47:17Z,"Looks nice, clean and simple. I agree with the scaling. Im always hiding the top bar but I won't with these :D.

Thanks bertyhell for the icons & sledge for showing it.
"
177464943,4253,sledgehammer999,2016-01-31T10:54:15Z,"> I personally think the scaling on the main actions bar should be kept as it is now, to help with visual white-space.

The small green crosses don't even register as green in my eye when the icons appears in the toolbar.
"
178240413,4253,bertyhell,2016-02-01T22:52:43Z,"Sure, that will beon Friday though
"
178979713,4253,guilhermedsx,2016-02-03T03:21:31Z,"I really love these new icons! Hope they will be implemented soon, qB needs some UI love :D
"
180547245,4253,bertyhell,2016-02-05T20:39:52Z,"We're working on converting the remaining icons.

Progress so far for the ""skin"" folder
![image](https://cloud.githubusercontent.com/assets/1710840/12858539/faff1442-cc50-11e5-9181-05094a4d259c.png)
"
183712105,4253,sledgehammer999,2016-02-13T17:44:26Z,"As for the ""skins"" folder. I would like for the icons that appear in the sidepanel for the status of torrents(which also appear in the transferlist) to lose their rectangle. Their should have only the symbol which should be colored accordingly(not white).
What do you guys think?
"
186588674,4253,bertyhell,2016-02-20T12:54:23Z,"I added the last of the icons under the skins folder

still todo:
- change format of icons
- reduce padding, so icons appear larger
- Switch square icons to rounded negative
"
188749251,4253,bertyhell,2016-02-25T11:46:51Z,"Maybe it's useful to reference this issue here as well:
https://github.com/qbittorrent/qBittorrent/issues/4569

It contains some proposals for replacing the program icon. Definitely check out the poll at the bottom to let your voice be hear.
"
192526308,4253,sledgehammer999,2016-03-04T23:45:13Z,"@bertyhell the PR needs rebasing. And I hope you have time to finish your remaining items. I'll gladly provide new screens then.
"
200303622,4253,ngosang,2016-03-23T11:25:39Z,"@bertyhell ping.
"
202386987,4253,bertyhell,2016-03-28T13:12:49Z,"Ok, I synced the PR.

> As for the ""skins"" folder. I would like for the icons that appear in the sidepanel for the status of torrents(which also appear in the transferlist) to lose their rectangle. Their should have only the symbol which should be colored accordingly(not white).
> What do you guys think?

Could we have a look at the square ones, before i change all of them?I think it might look nice.
"
204771233,4253,ghost,2016-04-02T18:41:41Z,"this should totally be merged. While i do agree that people don't use the ui itself too much, a little eyecandy does no harm.

One thing: the icons look too small in the dropdown menus imo
"
205037938,4253,sledgehammer999,2016-04-03T19:17:00Z,"@Chocobo1 you are the recent wizard about UI sizes in qt. Take a look at this PR. The icons used for the torrent statuses here are way bigger than the displayed size. In the delegate we have reimplemented the size hint. It checks which is bigger, the icon height or the string height and returns the bigger one. However, in this case it returns the icon height which is very big. It results in very big rows **BUT** the drawn icon is still small. I suppose there is a hardcoded max size for the `Qt::DecorationRole` and I wonder if you know a way of retrieving it? (in order to correct the sizehint implementation)
(below screens show correct because I hacked it)

@bertyhell here are 2 screenshots with current icons. I'll comment on some things and please others say your opinion too.
First image:
![untitled](https://cloud.githubusercontent.com/assets/273315/14234290/4046e5a6-f9e8-11e5-9634-f76dce1be84e.jpg)
1. The status icons have colors in a shade that isn't very distinguishable between them at those sizes. I am talking about the transferlist
2. The paused icon IMO doesn't look good at that size. Same for queued icon
3. The icons used for ""All"", ""Active"", ""Inactive"" are basically the same. Only the color scheme changes. I admit that the current ""Active"" and ""Inactive"" isn't good either. I am hoping you can think something else.
4. The folder and file icon (sidepanel + content view) look tiny
5. The icons in the tabs also look tiny except the RSS one.

2nd image:
![untitled1](https://cloud.githubusercontent.com/assets/273315/14234335/bd4f396c-f9e9-11e5-9daa-00ab5767d4d9.jpg)

The menu icons look tiny here too IMO. Only the X looks ok. Same goes for most of the other menus too.

@bertyhell kinda offtopic: When you want to rebase do ""git rebase master"" not ""git merge master"". Anyway, I'll give you instructions on how to delete the merge commit later, when this is ready for merging into master.
"
205054056,4253,ngosang,2016-04-03T21:04:53Z,"I agree with sledgehammer. What about icons for error and warning trackers in sidebar?
"
205054156,4253,sledgehammer999,2016-04-03T21:06:20Z,"> What about icons for error and warning trackers in sidebar?

These use the system's icons. No need to change that.
"
205054880,4253,ngosang,2016-04-03T21:10:29Z,"> These use the system's icons. No need to change that.

They break the design of the application... request 2 more icons and we can think later.
"
205055415,4253,bertyhell,2016-04-03T21:11:59Z,"Yeah, we'll have to look at the sizes
Currently the svg to png grunt task just generates large pngs of 400px size. I'll have a look if i can make them use less padding and generate a smaller size.

> These use the system's icons. No need to change that.

They do look a bit out of place now, with all the other ones being stylized

Have you had a look at the main icon thread?
https://github.com/qbittorrent/qBittorrent/issues/4569#issuecomment-202396781
"
205060288,4253,thalieht,2016-04-03T21:39:48Z,"I agree with everything sledge said, especially the file icon almost looks like a blur. 
The seeding icon, white on orange has little contrast and its hard to distinguish the arrow from the background (always hated that).
The  Tools -> Options icon looks small there.
Is that a new icon in connection status? Too small surface area to be able to easily tell color changes. Unless it doesn't use color to denote status.

All in all they look better than the current ones. Nicely done.
"
205203263,4253,Chocobo1,2016-04-04T09:04:34Z,"@sledgehammer999 

> I suppose there is a hardcoded max size for the Qt::DecorationRole and I wonder if you know a way of retrieving it? 

I'll take a look.
UPDATE: see PR #5070.

## 

> Currently the svg to png grunt task just generates large pngs of 400px size.

Could it be the pngs size is 400x300, `width /= height`?
I wonder what happens if you make `width == height`.

> They do look a bit out of place now, with all the other ones being stylized

Agree.
"
205211934,4253,bertyhell,2016-04-04T09:30:01Z,"> Could it be the pngs size is 400x300, width /= height?
> I wonder what happens if you make width == height.

No, it seems the svgs just don't have any size set.
https://github.com/filamentgroup/grunticon/issues/127#issuecomment-34452242

I'll resave the svgs and then  it should be fixed
"
205225857,4253,zywo,2016-04-04T10:04:12Z,"This is how it looks like on Ubuntu 15.10 under Unity DE and Qt 4.8.6

![style](https://cloud.githubusercontent.com/assets/4026304/14244772/d6ff8946-fa54-11e5-9111-c5072a89e5df.png)
"
205228779,4253,Chocobo1,2016-04-04T10:12:17Z,"> This is how it looks like on Ubuntu 15.10 under Unity DE and Qt 4.8.6

Fixed in PR #5070.
"
205260268,4253,zywo,2016-04-04T11:42:48Z,"> Fixed in PR #5070.

Confirmed my issue is fixed.
"
207564135,4253,bertyhell,2016-04-08T19:12:27Z,"We ( @cosmanovich and I ) extended the grunttask to allow for a width to be set for all the svgs.
So now they are all 32px x 32px. I hope this fixes the issue of the icons that looked to small. 

Next time we'll look at the color difference between blue and red.
"
207700410,4253,Chocobo1,2016-04-09T04:25:19Z,"> So now they are all 32px x 32px.

I think it will be better if the pngs are resized to 64px (or even 128px because of 4k panels).

> I hope this fixes the issue of the icons that looked to small.

Looks better here.
"
208015488,4253,sledgehammer999,2016-04-10T16:59:49Z,"The icon size problem has improve greatly with the last commit.
2 screenshots follow.
My comments:
1. The paused icon looks better now, but shouldn't the red space between the two white bars be wider/bigger?
2. The icon used for trackers/peers. It doesn't bother me but I suppose you would want more detail in that size. It looks blurry IMO.
3. Toolbar. The color of the cross (green) and the color of the minus (red) doesn't come out much. And I think the edges of the cross show aliasing(?)/blurry.

![untitled](https://cloud.githubusercontent.com/assets/273315/14411636/aed61ee2-ff56-11e5-85b5-9f482a3d4d8a.jpg)
![untitled1](https://cloud.githubusercontent.com/assets/273315/14411637/b711a2e8-ff56-11e5-8394-b9fae05ff36e.jpg)
"
208509730,4253,dogancelik,2016-04-11T19:18:27Z,"I'm not sure why icons are stored in the binary when you could store the icons in Program folder under `…/qBittorrent/icons` like translations:
- the qB community can make or share their own icon packs in the forums
- **end-users can use custom icons without learning how to compile**
"
208617021,4253,sledgehammer999,2016-04-11T23:31:35Z,"> I'm not sure why icons are stored in the binary when you could store the icons in Program folder under …/qBittorrent/icons like translations:

Let's not talk about this. Also only the qt translations are there. qbt translations are embedded into the binary.
"
213880960,4253,ghost,2016-04-24T04:07:57Z,"@sledgehammer999 we're not getting these new icons in the stable release until every icon has been replaced, right? It would be ideal if qBittorrent got a complete icon overhaul rather than just replacing most of them.
"
218088053,4253,Soukyuu,2016-05-10T08:11:50Z,"I might be missing something, but why are you rasterizing the svgs? Qt can display them directly, and that way the size will always be perfect, because the rasterizing happens in the UI to fit the required size. 
"
218354888,4253,Chocobo1,2016-05-11T03:49:50Z,"simply put, our code is not ready to handle svgs directly.
"
220707945,4253,guilhermedsx,2016-05-20T20:16:20Z,"SVG or PNG rendering, I just hope this gets merged soon. With PicoTorrent around the corner it's getting really hard to look at the current state of the UI on Windows 10.
"
233520508,4253,guilhermedsx,2016-07-19T03:26:02Z,"So... is this dead?
"
233677917,4253,bertyhell,2016-07-19T15:52:43Z,"What issues? You mean: generate 64px sizes? 
"
234135914,4253,guilhermedsx,2016-07-21T01:56:19Z,"Would be a nice addition to the UX, I guess. The sooner the better.
"
236561019,4253,sledgehammer999,2016-08-01T11:56:49Z,"@bertyhell from quick re-reading the last ""issues"" are described here: https://github.com/qbittorrent/qBittorrent/pull/4253#issuecomment-208015488
"
237419325,4253,guilhermedsx,2016-08-04T00:50:44Z,"Someone should build a latest trunk with this pulled, call it a preview and check the reception. I guess pretty much everybody will like it. And yeah, 256x256 in PNG is better. Size difference will be negligible and scales to high DPI.
"
237459423,4253,bertyhell,2016-08-04T05:54:39Z,"Updated all icons to be 256px in size. 
Total size increase seems to be 0.4MB which is acceptable i presume

> 1. The paused icon looks better now, but shouldn't the red space between the two white bars be wider/bigger?

Increased distance between pause bars

> 1. The icon used for trackers/peers. It doesn't bother me but I suppose you would want more detail in that size. It looks blurry IMO.

Looks blurry => not sure how i can fix that except for creating a pixel perfect icon that is exactly the same size as how it shows up in the application. Or maybe it will look better if the app uses the svg files directly?

> 1. Toolbar. The color of the cross (green) and the color of the minus (red) doesn't come out much. And I think the edges of the cross show aliasing(?)/blurry.

I could make the red and blue more saturated, but that will require me to touch a lot of the icons. Maybe we can come up with the exact color values first so i don't have to redo them multiple times.
"
249362869,4253,koloved,2016-09-24T12:41:29Z,"Do you need some help for drawing icons?
"
249369811,4253,bertyhell,2016-09-24T15:15:21Z,"I think all icons are included already. I'm not sure why this still isn't merged. I switched the icon size to 256px one month ago. 

@sledgehammer999 shouldn't we merge this already? 
"
252140535,4253,ghost,2016-10-07T02:42:07Z,"Is this going to make it to 3.4?
"
252790849,4253,ghost,2016-10-11T01:52:36Z,"It's a shame this hasn't been merged yet. Even if one or two of the icons are slightly problematic, who really cares? It looks far better than the current design.
"
255244882,4253,guilhermedsx,2016-10-20T22:22:56Z,"If you don't want to have it as default, keep the awful theme from now and add this new one as a selectable option buried in the settings. Just merge it already, it's been almost a year!
"
255506769,4253,ghost,2016-10-22T04:27:53Z,"Yes, please merge this as soon as possible. We have been waiting far too long for qBittorrent to actually look good on all platforms.
"
255589643,4253,Nemo-qB,2016-10-23T13:48:03Z,"Hell yeah! Its about time it gets changed. qBittorrent will look great with these. Thanks bertyhell for your work also.

+1.
"
260086155,4253,guilhermedsx,2016-11-12T00:22:23Z,"Thank you SO MUCH for approving this!
"
260100840,4253,ghost,2016-11-12T04:22:03Z,"![screen shot 2016-11-12 at 12 30 00](https://cloud.githubusercontent.com/assets/7249199/20235627/56af79ba-a8da-11e6-9eae-e61cae73e3c6.png)

Looks good in macOS.
But what are these small black triangles? Kinda confusing to me.
Anyway kudos to @bertyhell.
"
260111733,4253,thalieht,2016-11-12T09:28:40Z,"Maybe it's some kind of indication to keep pushing the button for pause/resume all.
"
260115840,4253,thalieht,2016-11-12T11:09:46Z,"<img width=""837"" alt=""newiconsdark"" src=""https://cloud.githubusercontent.com/assets/6451685/20456858/a99d1ea4-ae87-11e6-9c0a-6018f7b1f6f7.PNG"">
Because the background of the icons is transparent some of them won't be too visible on some themes.

~~Could the height of the torrents entries in the list be some external factor? Current master doesn't have this problem.~~
EDIT: updated picture without the problem (i had to do a rebase)
"
265907860,4253,peburgos,2016-12-09T01:30:29Z,"Anyone know how to use those icons on Windows, even through they weren't merged yet? They look awesome and qbittorrent would be perfect with them, but I have no idea how to build the fork."
267498888,4253,okeatime,2016-12-16T02:04:59Z,"@pebmp17 
Assuming you have a local clone of qBittorrent and `cd qBittorrent`.

How to merge is for example:
```
git remote add bertyhell https://github.com/bertyhell/qBittorrent.git
git fetch bertyhell
git checkout -b bertyhell
git merge bertyhell/stylized-icons-main-bar
```

And build https://github.com/qbittorrent/qBittorrent/wiki/Windows-compilation .
"
267504618,4253,peburgos,2016-12-16T02:49:46Z,"@okeatime Thanks, haven't seen that page in the wiki, gonna try it now."
269417046,4253,elesto,2016-12-28T02:52:11Z,"One year in development of new icons, we are so close!"
269417539,4253,guilhermedsx,2016-12-28T02:57:40Z,"Actually it's been ""ready"" (at the current state) since... I don't know. April. 
I've given up on ever seeing it on an official build, people seem to like 1995 Linux visuals. It seems to be the case with most open software, sadly - QuiteRSS, LibreOffice and Deluge also look far from ""in place"" on Windows."
269576899,4253,peburgos,2016-12-29T03:29:04Z,"Yeah, such a shame to see it's so common. Many Linux programs have excellent features, but they lack a lot in the design part. Wish more developers notice how important it's to improve what users experience when they use their program.

@sledgehammer999 Sorry to bother, but there is a reason why it's not merged? I mean, correct me if I'm wrong, looks like all the reported problems have been solved and there are many users are looking forward to any update about this."
270987264,4253,bertyhell,2017-01-06T19:40:57Z,"I rebased it again.
For the love of god, please merge this already. 
![image](https://cloud.githubusercontent.com/assets/1710840/21730534/687051b4-d450-11e6-9192-c85d8a5a5d04.png)
"
271107108,4253,elesto,2017-01-07T20:12:59Z,"Please merge this!! @bertyhell  worked so hard for us, and the icons are such a refreshing improvement! I'm on my hands and knees for you @sledgehammer999 "
271189233,4253,sledgehammer999,2017-01-08T23:43:17Z,"@bertyhell (and others). Sorry for the very long delay. My time is spread thin and I don't even know where to direct my attention from the deluge of github-email-notifications I get. And which PRs to prioritize.
Anyway, this stays in my open tabs so I can review and hopefully merge tomorrow.
Thx for the tremendous job and patience."
271190621,4253,sledgehammer999,2017-01-09T00:02:51Z,"@qbittorrent/qbittorrent-frequent-contributors doesn't anyone have instructions for @bertyhell on how to remove the 2 `Merge branch 'master' into` commits from the history?

PS: Here is how stuff looks on Windows 7.
![untitled](https://cloud.githubusercontent.com/assets/273315/21754768/b5b8dfca-d60f-11e6-90a4-f88e0fbd027d.jpg)
"
271567857,4253,okeatime,2017-01-10T12:53:01Z,"> doesn't anyone have instructions for @bertyhell on how to remove the 2 Merge branch 'master' into commits from the history?

That causes me a headache.
I want to know easy way to do that.

How about squash all diffs into one commit?

Assuming:
```
$ git remote -v
origin	https://github.com/bertyhell/qBittorrent.git (fetch)
origin	https://github.com/bertyhell/qBittorrent.git (push)
upstream	 https://github.com/qbittorrent/qBittorrent.git (fetch)
upstream	 https://github.com/qbittorrent/qBittorrent.git (push)
```

Something like:
```
git checkout -b temp upstream/master
git diff --binary upstream/master stylized-icons-main-bar | git apply -
git commit -a -m ""Switching to stylized icons""
git push origin temp:stylized-icons-main-bar --force
```
"
271618576,4253,sledgehammer999,2017-01-10T16:12:20Z,"@bertyhell I think you have included files in this PR that you didn't actually want. For example there are .js and .json files. Also you have set (wrongly) some paths to be ignored in `.gitignore` but then you included the various .svgs + scripts in those paths. 
Since this is a bit tricky to get working as it is for non-experienced git user, I suggest you create another local branch copying our **master** branch. Then copy the .pngs as you see fit from your old branch and make a new commit+PR. If you would like to share with us the *svgs(which I would appreciate very much) make another commit in that branch with the svgs and git push.
**I don't have a problem with current icons as you propose them.** So a new PR will probably get merged ASAP (assuming it is clean of artifacts).
What do you say?

PS: Come to this PR and click the `Files changed` tab at the top to see list of affected files by this PR."
271672286,4253,bertyhell,2017-01-10T19:25:56Z,"@sledgehammer999 

Actually that is intended.
See this readme file:
https://github.com/bertyhell/qBittorrent/blob/7fb3962192f62c9588ad1b5bd7fdfa496f42fab3/src/icons/skin/build-icons/readme.md

It's essentially a grunt task that converts all svg images to pngs.
So if someone created more svg's they can be converted uniformly using one grunt command.

Eg: changing the size of the png's is really easy this way:
https://github.com/bertyhell/qBittorrent/blob/7fb3962192f62c9588ad1b5bd7fdfa496f42fab3/src/icons/skin/build-icons/Gruntfile.js#L7

I also commited the png files, so you're not required to run this grunt task to get started."
271698726,4253,sledgehammer999,2017-01-10T21:09:33Z,"So I can merge it as-is. Even though I generally don't like commits that can be squashed into previous ones, this PR has taken too long. Also you don't know enough git to rework this. So I'll merge as-is.

Also can you explain to me why you put those lines in `.gitignore`? Are they still relevant now that you included files from those dirs?"
271701090,4253,zeule,2017-01-10T21:19:13Z,"My two cents:
1. Is there any need to produce png files? Qt can load svg icons starting from version 4.2.
2. ""Oxygen"" is the name of old KDE icon theme, please rename the folder."
271703006,4253,sledgehammer999,2017-01-10T21:27:00Z,">1. Is there any need to produce png files? Qt can load svg icons starting from version 4.2.

This is phase 1. Drop-in replacement of current icons.

>2. ""Oxygen"" is the name of old KDE icon theme, please rename the folder.

I don't think the author has the expertise to make other changes in the code, in order to make this a drop-in replacement. But this is a good comment. I'll do it right after I merge it.
@bertyhell do you use to give a name to your theme or should I choose a generic/random one?
"
271703902,4253,zeule,2017-01-10T21:30:27Z,"If we are going to drop png files, there is no need to merge that javascript png generator and its configuration."
271704599,4253,sledgehammer999,2017-01-10T21:33:21Z,">If we are going to drop png files, there is no need to merge that javascript png generator and its configuration.

True, but since it isn't certain when this will happen exactly it doesn't hurt having it there for now."
271731379,4253,bertyhell,2017-01-10T23:28:43Z,"> If we are going to drop png files, there is no need to merge that javascript png generator and its configuration.

Having the original svg's in the repo + a way to easaly generate the png's is quite useful in my opinion. That way other people can tweak the icons without having the manually recreate them every time.

> Also can you explain to me why you put those lines in .gitignore?

Yes, those are still required. To run that grunt task you need node.js. The node package manager will install a bunch of files in node_modules to get all the required files for doing the svg to png conversion. You don't want to see those node_module files in your git status.

Having the png ignored as well is required, since someone generating the png files doesn't want to check them in there (src/icons/skin/build-icons/icons/), but rather move them to the ""drop in replace"" location (src/icons/oxygen/).

"
271732393,4253,zeule,2017-01-10T23:34:03Z,"> Having the original svg's in the repo + a way to easaly generate the png's is quite useful in my opinion. That way other people can tweak the icons without having the manually recreate them every time.

Could you explain this, please? Why would one need a png file to edit its source, the svg one?"
271732666,4253,bertyhell,2017-01-10T23:35:32Z,"> Could you explain this, please? Why would one need a png file to edit its source, the svg one?

Oh, sorry, i had misread your comment. Yeah, you're right, we can drop all those once we switch to svg assets. 👍 "
271733043,4253,zeule,2017-01-10T23:37:21Z,"Thanks, @bertyhell. "
271733721,4253,sledgehammer999,2017-01-10T23:40:56Z,"@bertyhell the pngs currently need to be inside `src/icons/oxygen/` and oxygen is an icon theme name. Immediately after I merge this PR, I plan to move the pngs to `src/icons/<name>/` and make the necessary code changes. Do you want me to use a specific name for the ""theme"" or should I just put something generic like ""qbt-theme""?"
271735387,4253,bertyhell,2017-01-10T23:50:31Z,"You can choose what ever. 
Flat or font awesome are good descriptions since a lot of icons are based on those. 
But it is completely up to you. "
271738162,4253,sledgehammer999,2017-01-11T00:07:15Z,OK. I'll do the merge tomorrow when I have a non-sleepy head.
271776718,4253,Chocobo1,2017-01-11T04:43:54Z,">Qt can load svg icons starting from version 4.2

Yeah, tried that, it's awfully slow if you need to resize/load them on-the-fly, so there might need some mechanisms caching them."
271908433,4253,sledgehammer999,2017-01-11T16:01:25Z,Thx for the great effort. Be around if users start complaining :p
271910732,4253,zeule,2017-01-11T16:09:14Z,"> Yeah, tried that, it's awfully slow if you need to resize/load them on-the-fly....

@Chocobo1, could you give any numbers, please? Plasma uses svg icons for many years and I can't see any signs of a slowness. "
271913194,4253,Chocobo1,2017-01-11T16:17:22Z,">@Chocobo1, could you give any numbers, please? Plasma uses svg icons for many years and I can't see any signs of a slowness.

No benchmark for that, I just tried to load svgs in place of pngs; when opening a dialog/window, it took about 1~2 secs to pop up (normally would be instant)."
271921219,4253,bertyhell,2017-01-11T16:43:27Z,"> Pull request successfully merged and closed

he did it, he really did it
![image](https://cloud.githubusercontent.com/assets/1710840/21857362/72654c14-d825-11e6-9dd8-8a45f2adeb54.png)
"
272286574,4253,eli-schwartz,2017-01-12T21:19:00Z,"> So I can merge it as-is. Even though I generally don't like commits that can be squashed into previous ones, this PR has taken too long. Also you don't know enough git to rework this. So I'll merge as-is.

github.com now has a feature for this: https://github.com/blog/2141-squash-your-commits"
318642398,4253,ghost,2017-07-28T12:45:41Z,"Am I getting something wrong here? What do I have to do to get these icons? They look amazing but I still have the ugly ones. I'm using qBittorrent v3.3.14 64-bit for Windows, which I got from [here](https://www.qbittorrent.org/download.php)

Are they coming with 3.4?"
318665084,4253,zeule,2017-07-28T14:21:55Z,"These icons will be released with version 3.4.0,"
318668675,4253,ghost,2017-07-28T14:35:52Z,"I see. Waiting for that then!
![image](https://user-images.githubusercontent.com/29687487/28723138-81a510bc-73be-11e7-8f29-98e88f094840.png)
😄 "
318739303,4253,ghost,2017-07-28T19:14:14Z,"Nice, I'll wait for the beta, just to help with bug reports, and if it takes too long I'll go with these. Thanks! :D

EDIT: Beta stalled as expected, I'll try these builds :)"
320824934,4253,regs01,2017-08-08T01:33:11Z,Those icons doesn't look good on Windows 10. Quite dark and colorless. Would be nicer to be lightened. Squarish icons also overloading table of tasks.
320889894,4253,ghost,2017-08-08T08:35:52Z,I love them.
320897190,4253,ghost,2017-08-08T09:06:20Z,"@regs01 I agree. The icons could be a little bit brighter. They seem somewhat dull. It's definitely an improvement over the old icons but they just need to ""pop"" a bit more. 

Especially the red delete button. The ""red"" color is so dull that you almost can't tell it's red. 

Everything needs to be a few shades brighter, especially the red, yellow and orange icons. 

It doesn't have to be Material Design bright. Just bright enough to not be dull. "
320916017,4253,thalieht,2017-08-08T10:26:04Z,"Blue icons on high contrast theme win 10 🙊
But i've seen a few PR's that i don't closely follow that touch icons.. I'm hopeful.

<img width=""960"" alt=""capture"" src=""https://user-images.githubusercontent.com/6451685/29067799-a9ad1be6-7c3c-11e7-90c3-e20ae3f6cfcb.PNG"">
"
74369970,2550,DoumanAsh,2015-02-14T10:32:01Z,"Btw, seems like there is some problem with build in Travis
It fails on:

> sudo apt-get -qq update
"
74372418,2550,ngosang,2015-02-14T11:59:54Z,"Tested in Linux. Works well and the speedup is noticeable if there are many engines. :+1: 
"
74374265,2550,DoumanAsh,2015-02-14T13:05:46Z,"Added a bit of re-factoring in separate commit.
The same i want to do in py2 version
"
74410609,2550,DoumanAsh,2015-02-15T09:38:21Z,"@ngosang Please test a bit more this code on Linux, with different number of engines and etc
Seems like it fails to load extratorrent, legittorrents, torrentreactor on Windows

Suspect that's due to sgmllib3 usage in these engines. 
There seems to be some problems with classes outside of python std library
"
74414150,2550,ngosang,2015-02-15T11:40:44Z,"all engines = torrentreactor,mininova,piratebay,extratorrent,legittorrents,kickasstorrents.
NOTE: I have 1 dualcore working at 4.1 GHz (overclocked) so certainly I not a representative sample.
NOTE2: I know the Python2 code is not changed but for comparison.
NOTE3: All engines are working for me.

Python3 Multiprocess (new code)

```
[ngosang@kdesk nova3]$ time python nova2.py extratorrent all american | wc -l
500 <= results

real    0m5.239s <= execution time
user    0m0.763s
sys 0m0.023s
[ngosang@kdesk nova3]$ time python nova2.py all all american | wc -l
1563

real    0m15.917s
user    0m2.450s
sys 0m0.070s
```

Python3 (old code)

```
[ngosang@kdesk nova3]$ time python nova2.py extratorrent all american | wc -l
500

real    0m4.857s
user    0m0.770s
sys 0m0.020s
[ngosang@kdesk nova3]$ time python nova2.py all all american | wc -l
1563

real    0m22.115s
user    0m2.397s
sys 0m0.047s
```

Python2 (new code)

```
[ngosang@kdesk nova]$ time python2 nova2.py extratorrent all american | wc -l
500

real    0m4.452s
user    0m0.587s
sys 0m0.030s

[ngosang@kdesk nova]$ time python2 nova2.py all all american | wc -l
1563

real    0m14.583s
user    0m2.197s
sys 0m0.097s
```

Python2 (old code)

```
[ngosang@kdesk nova]$ time python2 nova2.py extratorrent all american | wc -l
500

real    0m4.840s
user    0m0.600s
sys 0m0.020s
[ngosang@kdesk nova]$ time python2 nova2.py all all american | wc -l
1563

real    0m13.686s
user    0m2.210s
sys 0m0.097s
```
"
74415042,2550,DoumanAsh,2015-02-15T12:12:53Z,"Thanks for verifications.
It seems there is windows specific problems for torrentreactor,mininova, extratorrent,legittorrents

> Traceback (most recent call last):
>   File ""<string>"", line 1, in <module>
>   File ""E:\Soft\Misc\chocolatey\bin\python\lib\multiprocessing\spawn.py"", line 100, in spawn_main
>     new_handle = steal_handle(parent_pid, pipe_handle)
>   File ""E:\Soft\Misc\chocolatey\bin\python\lib\multiprocessing\reduction.py"", line 81, in steal_handle
>     _winapi.PROCESS_DUP_HANDLE, False, source_pid)
> OSError: [WinError 87] The parameter is incorrect

Guess i'm better to re-write them first, before submitting this change
"
74423333,2550,DoumanAsh,2015-02-15T16:07:36Z,"Updated extratorrent engine

I will remove all remnants of deprecated sgmllib3 as i have no idea why multiprocessing breaks due to that on Win

UPD:
Seems like the actual problem is with urlib which is used to get content of web pages...
"
74431837,2550,DoumanAsh,2015-02-15T19:16:41Z,"Found actual reason of fails:

> def **init**(self):
>       self.results = []
>       self.parser = self.SimpleSGMLParser(self.results, self.url)
"
74432038,2550,ngosang,2015-02-15T19:20:58Z,"Offtopic. What do you think about removing vertor and btdigg? With vertor I see it clear.
"
74432295,2550,DoumanAsh,2015-02-15T19:26:35Z,"Vertor is already removed?

BTDigg moved to i2p, but dunno whatever they'll be back or not.
"
74432673,2550,ngosang,2015-02-15T19:34:36Z,"> Vertor is already removed?

Yep, It's already removed. I didn't see that.
We can wait for BTDigg.
"
74572173,2550,Pireo,2015-02-16T21:04:15Z,"BTDigg is back!
"
75609834,2550,sledgehammer999,2015-02-23T19:10:15Z,"heads up: rebase this.
"
75704950,2550,DoumanAsh,2015-02-24T06:08:34Z,"Done
Someone likes to play with moving repository's files around? :D
"
75711819,2550,DoumanAsh,2015-02-24T07:37:15Z,"additional commit
It will set retrive_url() timeout to 2 seconds instead of system-default.
And instead of raising exception, it will return empty string.

Let me know if anyone disagree with 2 second timeout
"
75717074,2550,DoumanAsh,2015-02-24T08:30:37Z,"Replaced previous implementation with Pool.
It should simplify my code

@sledgehammer999
Btw, what's your opinion?
"
75840924,2550,sledgehammer999,2015-02-24T20:39:55Z,"atm I don't have time for review. But anything that makes it go faster is welcome.
I am marking for v3.2.0 so I don't forget it.
"
76136716,2550,DoumanAsh,2015-02-26T08:00:56Z,"A bit of re-factoring to search execution.
Now both threaded and not threaded are similar. And both uses the same function.

Now i think this is perfect :)
Let me know if the same should be made to py2 code :)
"
76158162,2550,pmzqla,2015-02-26T10:51:27Z,"If you are using something older than python 2.6, I doubt you are running any recent version of qBittorrent. So if you feel like doing the same with the py2 code, IMO there shouldn't be problems.
"
76162676,2550,DoumanAsh,2015-02-26T11:26:50Z,"Ported it to py2
And also corrected versions of files.

I would appreciate if someone could test it in qBt for me as it is a bit of bother to switch to py2.
Manually(from console) it works fine
"
76163551,2550,pmzqla,2015-02-26T11:34:14Z,"Tested and working fine.
"
76217151,2550,sledgehammer999,2015-02-26T16:58:13Z,"@DoumanAsh rebase plz.
"
76219839,2550,DoumanAsh,2015-02-26T17:09:50Z,"np. Done
"
76220917,2550,sledgehammer999,2015-02-26T17:14:56Z,"It seems that the new code has mixed results if I read the `time` stats correctly.
However, it doesn't seem to be slower by a big margin. In fact in python3 it is 7secs faster with all engines enabled, while on python2 it is 1sec slower.
"
76224106,2550,DoumanAsh,2015-02-26T17:31:34Z,"Hm... that's interesting... Seems like py2 implementation may be a bit worse than py3.
In my case multiprocessing is slightly better(1 sec) than original threading

In my case py3 results ain't significantly better(2-3 seconds improvement) right now.
Well, that's a bit confusing... Maybe it would be better to get some stats on both versions...(average from 100 executions)

p.s. Possible problem: On windows thread spawn is cheaper than process spawn...
"
76230324,2550,pmzqla,2015-02-26T18:01:50Z,"I haven't noticed major differences, sometimes the search is faster, sometimes slower. At least now I can stop the search with Ctrl+C (I had to use Ctrl+Z before).

@sledgehammer999 consider that without this kickass and other https engines are broken.
"
76236569,2550,DoumanAsh,2015-02-26T18:31:44Z,"btw, we can easily switch to threads by using multiprocessing.dummy which is wrapper around threading in python

Anyway i tried to measue time-stamps, but it differs from time to time... and i'm not sure how reliable it can be.
"
76242229,2550,DoumanAsh,2015-02-26T18:51:26Z,"@ngosang
Can you please re-measure results too?
For threading, just use

> from multiprocessing.dummy import Pool
"
76243109,2550,sledgehammer999,2015-02-26T18:55:31Z,"For clarification, I was refering to the stats posted here: https://github.com/qbittorrent/qBittorrent/pull/2550#issuecomment-74414150
"
76243621,2550,ngosang,2015-02-26T18:58:19Z,"Wait, do not merge yet. I found something strange.
"
76246982,2550,ngosang,2015-02-26T19:16:24Z,"Linux Python 3.4.2 Works fine.
Linux Python 2.7.9 I get 50 results less and check the screenshot:
![](http://i.imgur.com/MywMqBq.png)
I can repeat speed tests when this is fixed.
"
76248830,2550,DoumanAsh,2015-02-26T19:25:52Z,"It seems like stdout overflow...?
Is it 100%?
"
76249450,2550,ngosang,2015-02-26T19:28:01Z,"@DoumanAsh In python if 2 threads write in the std output at the same time this kind of things happen.
Thread 1: print ""aaaaaa""
Thread 2: print ""bbbbbb""
Console: aaabbbaabbbbaab
I have not looked at your code, but maybe this is happening.
"
76250458,2550,DoumanAsh,2015-02-26T19:31:51Z,"I doubt that both threads can write to stdout at the same time due to GIL lock. Note, i'm using multi-processing.
In case of separated processes it can be quite possible, but print() should buffer as far as i know. 
So there should not be problem... Though it may be possible that there is race condition when stdout's buffer is not enoough and that's lead to problem...

In that case may be it is safer to leave threading

Tested a bit py3 version(with a bit of outdated code)
It happens for me in 1 of 8 attempts

UPD: it does not want to happen again anymore with my latest code
"
76257351,2550,ngosang,2015-02-26T19:59:33Z,"I always get at least one bad result.
You have made many changes in this PR, it might be better to separate in another PR the commits that are not related to multithreading, so we can verify that the changes work separately.
"
76258057,2550,DoumanAsh,2015-02-26T20:02:58Z,"@ngosang 
For now can you please re-try with ?

> multiprocessing.dummy

instead of just multiprocessing. It should use threading instead of actual multi-processing
Just change import for Pool
"
76260610,2550,ngosang,2015-02-26T20:12:53Z,"Python 2, I get wrong results in both :sob: 
from multiprocessing.dummy import Pool

```
[k@kdesk nova]$ time python nova2.py all all american | wc -l
1984

real    0m21.838s
user    0m3.007s
sys 0m0.077s
```

from multiprocessing import Pool

```
[k@kdesk nova]$ time python nova2.py all all american | wc -l
1972

real    0m16.994s
user    0m2.797s
sys 0m0.050s
```
"
76261810,2550,ngosang,2015-02-26T20:19:50Z,"> I doubt that both threads can write to stdout at the same time due to GIL lock. Note, i'm using multi-processing.

The results of print I put above are real.
Look at the engines column:
![](http://i.imgur.com/Q5NqTH3.png)
extratorrent.c**_1080**_
"
76262937,2550,DoumanAsh,2015-02-26T20:26:39Z,"Switched to py2
1)Multiprocessing100% reproduction
2)Multiprocessing.dummy 0% (0 of 10 attempts)

I dunno why do you have a problem with multiprocessing.dummy, but only actual multi-processing has this problem problem
"
76263660,2550,ngosang,2015-02-26T20:28:44Z,"@DoumanAsh http://stackoverflow.com/questions/3029816/how-do-i-get-a-thread-safe-print-in-python-2-6
"
76264428,2550,DoumanAsh,2015-02-26T20:31:37Z,"> In CPython, the global interpreter lock, or GIL, is a mutex that prevents multiple native threads from executing Python bytecodes at once. This lock is necessary mainly because CPython's memory management is not thread-safe. (However, since the GIL exists, other features have grown to depend on the guarantees that it enforces.) 

Python itself is not thread safe, that's why you cannot make multiple threads to execute code at once...

Will look into your link a bit later
But i think that the old code would have the same problem.

Note that i still haven't encountered this problem with multiprocessing.dummy :)
"
76280806,2550,ngosang,2015-02-26T21:45:23Z,"@DoumanAsh I know well how python works. I leave a little test for you to believe me.

``` python
import time
from threading import Thread

def funct():
    for j in range(1000):
        print (""Lorem ipsum dolor sit amet, consectetur adipiscing elit ..."")

for i in range(50): Thread(target=funct).start()
```

Python 3 (note, I'm showing only lines with more than 60 characters)
![](http://i.imgur.com/Fj1HFq4.png)
Python 2
![](http://i.imgur.com/2QzaEnB.png)
The problem exists in both versions but it's worst in Python 2.
"
76283078,2550,DoumanAsh,2015-02-26T21:57:52Z,"Well then since print() is bugged i guess i need to have some sorta Lock.
It may be possible for threaded version, but i'm not sure if it is possible for multi-processing version
"
76283313,2550,sledgehammer999,2015-02-26T21:59:02Z,"Let's better move this to v3.3.0 for now.
"
76352576,2550,DoumanAsh,2015-02-27T07:57:54Z,"@ngosang 
Please try py2 thread safe version(not multi-process safe)

I remade multi-process version. Just adding flush() to prettyPrinter()
I think it should help to avoid problem in 99% cases
"
76408849,2550,ngosang,2015-02-27T15:10:25Z,"@DoumanAsh is not working. :cry: 
"
76440281,2550,DoumanAsh,2015-02-27T17:54:29Z,"Hm... That's kinda lame though it worked fine for me

I wll make py2 version thread safe and for py3 will leave it as it is.
Can you please test work of py3 verion for now?
"
76517293,2550,DoumanAsh,2015-02-28T08:38:33Z,"Updated py2 version.
@ngosang  Please check it now

I have the second idea about safe multi-processing version. But let's wait with that for now
"
76518258,2550,DoumanAsh,2015-02-28T09:11:10Z,"Second variant for python2 multi-processor.
@ngosang Sorry for so many, but can you please test it too? :)
"
77705990,2550,DoumanAsh,2015-03-07T19:38:41Z,"Would be also good for someone else to test py2 version
"
77707121,2550,pmzqla,2015-03-07T20:00:32Z,"It seems to work fine, I can't replicate ngosang's problem with this pull request and everything is working as usual.
"
77771666,2550,ngosang,2015-03-08T20:17:03Z,"![](http://i.imgur.com/7L86gLL.png)
@pmzqla pls try with python2 and seach term ""american"" in all engines.
"
77772381,2550,pmzqla,2015-03-08T20:31:02Z,"Still working. Have you removed the plugins so that they are reloaded?

```
rm -rf ~/.local/share/data/qBittorrent/nova/  #brutal
```
"
77772643,2550,DoumanAsh,2015-03-08T20:36:03Z,"@ngosang @pmzqla 
What number of physical CPU cores you do have?

Well I hoped that re-opening stdout with 'utf-8' would help to block other processes, but it is highly possible that's not true since each process may have own stdout which is re-directed to the main one
"
77773155,2550,pmzqla,2015-03-08T20:46:46Z,"Here I have 2 cores, but the OS sees 4 cores.
"
77773256,2550,DoumanAsh,2015-03-08T20:48:30Z,"Current implementation creates process per physical core. Most possibly you have typical dual core with double threaded processes(i.e. logical 4 cores).
So in your case there are actually only two search processes are running... 
Though actually i'm not sure. It may differ for each OS, can you check 'ps' during search? How many python instances there will be

Though i guess it would be easier just check it in python:

> from os import cpu_count
> cpu_count()
"
77774870,2550,pmzqla,2015-03-08T21:17:14Z,"That's for python3 (and says 4). For python2 I used `multiprocessing.cpu_count()` and I indeed see 4 threads running. I could also try on another machine with 8 cores (4 actual cores), but I'm not sure it's set up to test this, so I'll wait for ngosang's reply.
"
77775013,2550,DoumanAsh,2015-03-08T21:19:40Z,"Noticed his first comments:

> NOTE: I have 1 dualcore working at 4.1 GHz (overclocked) so certainly I not a representative sample.

Seems like he should not have many cores so it is kinda strange...
Will try on my notebook too now

@ngosang 
Cam you please also re-try with multiprocessing.dummy?

I'm out of ideas so i will stick back to threaded solution for py2.
I dunno how to make a global lock with current search architecture.
 At least code looks much better :)
"
77804425,2550,ngosang,2015-03-09T06:01:10Z,"@DoumanAsh Sorry, I didn't remove the nova folder. I did it now and it's working well. Both versions work multiprocessing and multiprocessing.dummy.
"
77812633,2550,DoumanAsh,2015-03-09T07:56:57Z,"Well now it is good news :)

@sledgehammer999 
It seems that everything work fine, i know we delayed it, but do you want me to merge all commits into one or?
"
77922810,2550,sledgehammer999,2015-03-09T19:19:13Z,"I am delaying this for v3.2.1.
I want to tidy up v3.2.0. It has taken to long.
Note to self(and probably to the OP): I saw you mentioning that this spawns processes depending on the number of cores. Shouldn't we limit it to 2 or 3 processes per time? -although I doubt that in the immediate future we'll get 100-core systems-
"
77926392,2550,DoumanAsh,2015-03-09T19:40:06Z,"@sledgehammer999 
Well, yes... i do have this concern, but i'm unsure whatever should we limit or not.
Even if python spawns processes by number of cores. It is actually OS who dispatch CPU to these processes, not python. So i don't think it would cause significant load on all cores at once.
The problem is that we cannot predict amount of jobs(since user can have not builtin engines)

But how to decide limit... I'm unsure... 
First i think we should take into account amount of search engines i.e. if the number of jobs 2 then there is no need to spawn 4 processes :)
But this is not so easy with possible maximum. Generally most of users would have 4 or 8 cores...
"
78035883,2550,frenchiveruti,2015-03-10T11:24:13Z,"Ok, hello to everyone, I just came here to ask one thing, is there any solution for the problem of the search engin? Mine's only displaying thepiratebay searchs, all the other engines won't work, i've had to manually install python because of reasons, and it seems that won't work, but i have another PC that displays all the search findings, but on this one, qbt was able to auto install python.
Should I downgrade Python 2.7.9 to P2.7.8?
Thanks, and impressive work yours, besides that I don't understand a single word of what are you talking about :+1: 
PD: I've came from #2425 
"
80041443,2550,DoumanAsh,2015-03-14T07:07:23Z,"@frenchiveruti 
Well first i would always advise to use py3 intsead of py2
Second... did you try @pmzqla's advice #2698 ?
"
88763579,2550,DoumanAsh,2015-04-02T06:29:11Z,"Before any sorta of merging please let me know when can i squash commits as there are just too many of them and not all of them have any significant meaning
"
89865226,2550,sledgehammer999,2015-04-05T22:25:47Z,"I don't think I need to see the intermediate commits or commits that fix previous commits.
Since, I don't know much python, I'll skim through it and test it.
So you can start merging useless commits. (That doesn't mean you should merge them into one.)
"
90752142,2550,ngosang,2015-04-07T22:47:43Z,"@DoumanAsh Can you update the TorrentReactor plugin with this changes?
1) Rename it from ""TorrentReactor.Net"" to ""TorrentReactor""
2) Update the icon (I have changed the favicon.ico to png): http://www87.zippyshare.com/v/4ZxcdaTO/file.html
"
90801329,2550,DoumanAsh,2015-04-08T04:50:36Z,"Well i guess it is easy, so np
"
91349098,2550,Pireo,2015-04-09T20:35:18Z,"I've got this icon, clearer:
http://www23.zippyshare.com/v/FEjcIOlz/file.html
it's downloaded in native 16x16
"
91773272,2550,DoumanAsh,2015-04-11T06:45:52Z,"Hm... really? It is jpg so i wonder...
"
91776515,2550,DoumanAsh,2015-04-11T06:53:33Z,"Made small enchantments for used regex also
"
110120603,2550,DoumanAsh,2015-06-08T19:57:02Z,"@ngosang Can you please check that i rebased correctly?(in regard of recent changes to some engines)
"
110167428,2550,sledgehammer999,2015-06-08T23:03:56Z,"A maybe silly question that may have been already answered here. What happens if a user running eg 3.2.0 (a version without multiprocessing), automatically downloads these new plugins? Will they work for him too or will it cause problems?
"
110167658,2550,ngosang,2015-06-08T23:05:49Z,"The changes in the plugins are minor fixes, not related with the multiprocessing/multithread. Will work in old and new versions.
"
110170401,2550,sledgehammer999,2015-06-08T23:23:13Z,"This has been in the testing stage long enough IMO. And it seems there aren't any major problems. @DoumanAsh  and @ngosang is it ok to merge?
"
110170794,2550,ngosang,2015-06-08T23:26:05Z,"I'm going to do the last tests in 10 minutes. Wait for my report.
"
110171090,2550,sledgehammer999,2015-06-08T23:28:49Z,"> I'm going to do the last tests in 10 minutes. Wait for my report.

No need to hurry. Take your time. I am going to sleep in a few minutes.
"
110192350,2550,ngosang,2015-06-09T01:37:09Z,"I tested this PR again. **There is no problems in multiprocessing, it's working well. But, there are problems with several search engines.**
In the master branch all search engines are working well with Python 2 and Python 3.
With this PR:
**Python 3:**
- TorrentReactor is not working.
- Mininova: the Name in the results column is incomplete.
- Extratorrent: if you search **Ratchet & Clank** some results show **& amp;** instead of **&**

**Python 2:**
- TorrentReactor is not working.
- Torrentz is not working.
- BTDigg is not working.
- legittorrents is not working.
- Mininova: the Name in the results column is incomplete.
- Extratorrent: if you search **Ratchet & Clank** some results show **& amp;** instead of **&**

I know you didn't edit Torrentz and BTDigg in this PR but breaks compatibility with Python2 for some reason. If the changes are necessary we have to fix this engines in this PR.
"
110228058,2550,DoumanAsh,2015-06-09T05:18:10Z,"Thank you. I will look into it, though i'm also thinking return back to threading for py2 version.

About Extratorrent, i think you were fixing something like that for piratebay? Could you please share what was the problem?

Python 2 problem it seems there is some issue due to python itself, but i'm not sure what is the problem.
It seems someone made python multiprocessor pool to work with unicode only... and it's me... :)

Now i need to correct Mininova and Extratorrent

UPD: fixed Extratorrent, not all & amp; will be replaced by &
"
110302766,2550,ngosang,2015-06-09T10:16:19Z,"> About Extratorrent, i think you were fixing something like that for piratebay? Could you please share what was the problem?

The problem was different but I think this problem can be in other search engines you modified. The fix I made for tpb #3020 and the new Demonoid #3164 solve the following problem.
If you are parsing this string to obtain the name,

```
<a href=""..."">Takako Nishizaki & Gerald Garcia - Chinese Melodies for Violin & Guitar [MP3]</a>
```

with this code:

```
handle_data(self, data):
    if self.save_item:
         self.current_item[self.save_item] = data
         self.save_item = None
```

the result is that you only get **Takako Nishizaki** because handle_data takes **&** as a special tag and not part of the string. If you want to get the full name, handle_data will be called 3 times:
1 - **Takako Nishizaki**
2 - **& Gerald Garcia - Chinese Melodies for Violin** 
3 - **& Guitar [MP3]**
and you have to merge the 3 strings.
"
110445915,2550,DoumanAsh,2015-06-09T17:54:24Z,"@ngosang I applied your comments
Now i have to correct Mininova...
"
110464957,2550,ngosang,2015-06-09T18:59:42Z,"When you finish I will test it again and if It's fine I will request sledgehammer to merge ASAP.
"
110472591,2550,DoumanAsh,2015-06-09T19:20:36Z,"@ngosang 
Fixed. Actually i found small bug when i'm missing ""link"" and that started to lead to some issues :)

So seems to be good now.
Thanks for help, can you please test everything again? :)
"
110495493,2550,ngosang,2015-06-09T20:29:51Z,"This are the remaining problems.
**Python 3:**
- Mininova: the Name in the results column is incomplete.

**Python 2:**
- legittorrents is not working. (Works in Python 3)
- Mininova: the Name in the results column is incomplete.

In mininova I searched **a** http://www.mininova.org/search/a/seeds and in qBittorrent I only see **How To Write a** instead of **How To Write a Song, Lyrics and Chords. Songwriting Tips and Ideas. eBook By Dan-O at DanoSongs.com**

If you can change legittorrents to **Legit Torrents** in the search engine name
"
110496497,2550,DoumanAsh,2015-06-09T20:34:58Z,"@ngosang 
How legittorents is not working? There are no results? It works for me :(

Mininova works?

```
http://www.mininova.org/get/13198842|How To Write a Song, Lyrics and Chords. Songwriting Tips and Ideas. eBook By Dan-O at DanoSongs.com in
Ebooks|194631|13|0|http://www.mininova.org|http://www.mininova.org/tor/13198842/0
```
"
110498954,2550,ngosang,2015-06-09T20:43:49Z,"You are right legittorrents it's working now. This is the screenshot of mininova
![](http://i.imgur.com/Dc96AXt.png)
"
110500263,2550,ngosang,2015-06-09T20:50:00Z,"```
http://www.mininova.org/get/13198842| How To Write  a|194631| 13| 0|http://www.mininova.org|http://www.mininova.org/tor/13198842/0
http://www.mininova.org/get/1951353| Jewel Quest Mysteries - Find hidden objects  a|99289661| 10| 0|http://www.mininova.org|http://www.mininova.org/tor/1951353/0
http://www.mininova.org/get/3112793| How to St a|61235| 9| 0|http://www.mininova.org|http://www.mininova.org/tor/3112793/0
http://www.mininova.org/get/1136214| A|59234058| 9| 0|http://www.mininova.org|http://www.mininova.org/tor/1136214/0
http://www.mininova.org/get/13205465| A|75445043| 9| 0|http://www.mininova.org|http://www.mininova.org/tor/13205465/0
http://www.mininova.org/get/13207401| Using Google Webm a|176066396| 8| 1|http://www.mininova.org|http://www.mininova.org/tor/13207401/0
```
"
110502611,2550,DoumanAsh,2015-06-09T20:59:45Z,"@ngosang 
Sorry, i did not notice that i switched branch :D
"
110513521,2550,DoumanAsh,2015-06-09T21:44:27Z,"Finally it looks ok... I hope.

I think it's a bit over complex... but well... i'm tired for now so let leave it as it is
Merge two commits into one.
"
110531961,2550,ngosang,2015-06-09T23:27:46Z,"@sledgehammer999 Everything is fine now, you can merge it. You can also merge #3164.
"
110535129,2550,ngosang,2015-06-09T23:49:43Z,"WAIT!!!
I have found another bug. In extratorrent I get duplicate results (with the same name, size, pers and **hash**) The problem is only in extratorrent the other engines work well. Tested with Python 2 & Python 3 (the same problem in both).
![](http://i.imgur.com/Y8IhcDa.png)
"
110591962,2550,DoumanAsh,2015-06-10T05:14:21Z,"Found that i was re-running the search over the same results twice.
THe problem was in bad logic when i was collecting links to pages with next results(there is easy chance to get the same links twice)
"
110649057,2550,ngosang,2015-06-10T08:25:48Z,"@sledgehammer999 It's ready. I tested it several times and I can't find anything wrong. Yo can also merge #3164 and  #2670 (search related).
"
110655264,2550,DoumanAsh,2015-06-10T08:38:33Z,"#3164  will not be merge together with this one.
Sadly git often fails to auto-merge text files
"
110667215,2550,ngosang,2015-06-10T09:21:58Z,"Merge this PR first and then we will see if rebase is need. :smile: 
"
110693625,2550,DoumanAsh,2015-06-10T10:40:15Z,"Btw, if this is one is going to be merged soon then there is no need to merge #2670 separately. #2670 is included into this PR
"
110715898,2550,Pireo,2015-06-10T11:51:10Z,"Does kickass work properly now? Because it is the only one that currently takes time and many times ends in ""search aborted"". I'm using python 2.7.10 and I've tested with qBT 3.1.12 and 3.2.0
"
110945635,2550,sledgehammer999,2015-06-10T23:28:19Z,"@DoumanAsh I have merged #2670 before I read this.
There are 2 commits that read ""Final enchantments"". I think you mean ""Final enhancements"". If yes, please correct it.
Probably tomorrow this will be merged too.
"
110997519,2550,DoumanAsh,2015-06-11T04:49:06Z,"@sledgehammer999 
Yes... why i always misprint this word i dont know :(

Strange, git does not want to rename non-last commit
Anyway i squashed two last commits into one with correct name :)

@Pireo It works for me
"
111177960,2550,sledgehammer999,2015-06-11T15:43:58Z,"> Strange, git does not want to rename non-last commit

If you're using `git rebase -i <hash>` then you can choose `reword` to change the message of a commit.
"
111183838,2550,ngosang,2015-06-11T15:59:41Z,"He already did. This is ready finally...
"
111187785,2550,sledgehammer999,2015-06-11T16:09:38Z,"I found some issues that appear only if you enable all engines but not if you search separately with each engine. I am attaching pics.
![untitled](https://cloud.githubusercontent.com/assets/273315/8111933/4d72efe6-106d-11e5-9888-a345ca0cd123.png)
![untitled1](https://cloud.githubusercontent.com/assets/273315/8111935/4fbc878a-106d-11e5-8f1d-2ad7fbd83f6a.png)
![untitled2](https://cloud.githubusercontent.com/assets/273315/8111936/5285b252-106d-11e5-8fe4-5e3cc6fdbf47.png)
![untitled3](https://cloud.githubusercontent.com/assets/273315/8111938/5480ba66-106d-11e5-91ad-d193677513fc.png)
![untitled4](https://cloud.githubusercontent.com/assets/273315/8111942/56b52024-106d-11e5-9076-fff8a0d07896.png)
"
111189280,2550,sledgehammer999,2015-06-11T16:14:07Z,"Uhm, current git master has this problem too. So I am merging your PR and I hope someone fixes the problems I noticed.
Thank you all for the hard work.
"
111189522,2550,ngosang,2015-06-11T16:14:46Z,"I had that problem too but was fixed long time ago. Try this:

```
make clean
./configure
make
```

And remove /home/XXX/.local/share/data/qBittorrent/nova/ and /home/XXX/.local/share/data/qBittorrent/nova3/ before launch.
"
111191019,2550,sledgehammer999,2015-06-11T16:18:57Z,"> And remove /home/XXX/.local/share/data/qBittorrent/nova/ and /home/XXX/.local/share/data/qBittorrent/nova3/ before launch.

Yes removing them fixed the problem. That means that we should use a version for the non-search-engine .py files too.
"
111206375,2550,DoumanAsh,2015-06-11T16:57:25Z,"Yay! It is merged, it took me a while :)
btw there was there any bugs in addition to above mentioned?
"
111260510,2550,sledgehammer999,2015-06-11T20:04:13Z,"> That means that we should use a version for the non-search-engine .py files too.

Apparently, most of them do have a version and it is checked in updateNova()...
"
114299505,2550,Pireo,2015-06-22T23:15:53Z,"This happened to me:
http://img137.imagevenue.com/img.php?image=501471290_Cattura_122_504lo.jpg
qBT 3.3.0 alpha, python 2.7.10, windows 7 ultimate 64 bit
"
114362397,2550,DoumanAsh,2015-06-23T05:20:51Z,"@Pireo how often it happens?
"
114395387,2550,ngosang,2015-06-23T07:52:21Z,"I'm almost sure is this problem:

> And remove /home/XXX/.local/share/data/qBittorrent/nova/ and /home/XXX/.local/share/data/qBittorrent/nova3/ before launch.

I have found why this is happening. This are the results when you have v3.2.0 installed and you change to v3.3.0.
**FILE          NEW_VERSION           OLD_VERSION**
Python 3

```
/home/XXXX/.local/share/data/qBittorrent/nova3/nova2.py 1,400000 1,240000
updated
/home/XXXX/.local/share/data/qBittorrent/nova3/nova2dl.py 1,200000 1,100000
updated
/home/XXXX/.local/share/data/qBittorrent/nova3/novaprinter.py 1,440000 1,440000
/home/XXXX/.local/share/data/qBittorrent/nova3/helpers.py 1,400000 1,350000
updated
```

Python 2

```
/home/XXXX/.local/share/data/qBittorrent/nova/nova2.py 1,400000 1,320000
updated
/home/XXXX/.local/share/data/qBittorrent/nova/nova2dl.py 1,200000 1,100000
updated
/home/XXXX/.local/share/data/qBittorrent/nova/novaprinter.py 1,430000 1,430000
/home/XXXX/.local/share/data/qBittorrent/nova/helpers.py 1,400000 1,340000
updated
```

@DoumanAsh forgot to change the version number in **novaprinter.py** that's why it's necessary to remove the whole folder.

Fixed in this PR #3282. Tested with Python2 & 3. @sledgehammer999 maybe you can give @Pireo a windows build to be sure.
"
114413282,2550,Pireo,2015-06-23T09:06:03Z,"It happens rarely though, and I've updated 3.2.0 to 3.3.0
"
114433051,2550,DoumanAsh,2015-06-23T10:24:52Z,"@ngosang 
Thanks. Kinda lame of me :(
There is no need for new build. You can tamper with nova folders as well on windows :)

@Pireo 
Please, as per @ngosang suggestion, remove all files in nova folder(not in engines) and restart qBittorrent.
"
114469478,2550,Pireo,2015-06-23T12:12:19Z,"In the nova folder, I've removed all thos files except the ""engines"" subfolder and this problem with those searches didn't happen anymore, but this other still persists:
https://github.com/qbittorrent/qBittorrent/issues/3057#issuecomment-103610680
it also gives a second identical result with tpb
"
207030487,5090,glassez,2016-04-07T18:03:07Z,"I don't like this idea. This is not salvation for these browsers, since other apps still will not clean up after themselves. It will only add a little more fat to qBittorrent (not too little in the current implementation - two classes, a lot of settings etc.).
"
207060758,5090,zeule,2016-04-07T19:38:22Z,"Naturally, I'm not trying to provide a workaround for a browser. I think it is pretty obvious that some qBt users may use the app to download torrents which they do not want to be accidentally forgotten about and left at a well known or easy accessible place. For such cases the proposed option may be useful.
"
207251952,5090,glassez,2016-04-08T06:52:27Z,"> users may use the app to download torrents which they do not want to be accidently forgotten at a well known or easy accesible place

:)
"
207361156,5090,zeule,2016-04-08T10:17:53Z,"Oh, those night wordings! :) I'll change that one.
"
207376167,5090,glassez,2016-04-08T10:57:31Z,"I just liked the meaning, not wording. This can be the reason. Torrents are different... ;)
"
207377717,5090,glassez,2016-04-08T11:02:33Z,"But you should warn the user that this will also remove the torrent, which he will open by clicking or by any other method. We can't distinguish it.
"
207380730,5090,zeule,2016-04-08T11:09:03Z,"That is one of the reasons why I've asked for better options items names. Can you suggest anything? I would use a tooltip or a warning message box only as a last resort.
"
207384737,5090,glassez,2016-04-08T11:18:50Z,"Even best option name isn't enough. We still need some description. Maybe add some label with description near the main option control?
"
208417987,5090,zeule,2016-04-11T15:55:03Z,"Added a warning label and descriptive tooltip (see the updated description).
"
209109026,5090,sledgehammer999,2016-04-12T21:25:03Z,"I just want to add that this is a good feature because many users have requested it, especially in the forum. They wanted to have it as an option when deleting a torrent from the list.

Also I did a very quick look and I have a better implementation proposal. But I could be very wrong.
Why use the special guard thing?
The session class already knows where the .torrent lies. So after adding it, it should check the preferences and delete it.
Deleting after cancel can be handled by AddNewTorrent dialog alone.
Extra points: Option to override the preferences setting from the AddNewTorrent dialog.
"
209115350,5090,zeule,2016-04-12T21:42:48Z,"> Why use the special guard thing?
> The session class already knows where the .torrent lies. So after adding it, it should check the preferences and delete it.

I could be wrong too. The dialog adds a torrent by creating  a `TorrentInfo` object which is passed to the `Session` then. Does this preserve the file path? I thought that it does not.  The class encapsulates the logic which is used at two other places. Otherwise `Session` and `AddNewTorrent` would read settings and I personally don't like this. Besides, this approach can be easily extended to implement the extra point.  The only question is how that should look? It seems to me that there should be an option which will give a possibility to preserve the torrent file unconditionally, whether it will be added or not. Something like ""Do not delete .torrent file after closing the dialog."" Is it clear that the option cancels both settings, for added and for canceled torrent? 
"
209122193,5090,sledgehammer999,2016-04-12T22:01:46Z,"> The dialog adds a torrent by creating a TorrentInfo object which is passed to the Session then

Unfortunately you're correct.

> Besides, this approach can be easily extended to implement the extra point. The only question is how that should look? It seems to me that there should be an option which will give a possibility to preserve the torrent file unconditionally, whether it will be added or not. Something like ""Do not delete .torrent file after closing the dialog."" Is it clear that the option cancels both settings, for added and for canceled torrent? 

Don't know yet. I am looking at other things atm.
"
209125177,5090,zeule,2016-04-12T22:12:31Z,"Just found that I overread the following:

> They wanted to have it as an option when deleting a torrent from the list.

What do you mean here, please?

> Don't know yet. I am looking at other things atm.

We are not on a chat. :) I can wait, of course.
"
209125753,5090,sledgehammer999,2016-04-12T22:15:18Z,"> What do you mean here, please?

Their request was different form what you do here, but I think it results in the same thing more or less.
They want another option when they right click on a torrent from the transferlist. Apart from the regular delete they want also ""delete .torrent file"". I have declined it so far, because we don't track the original .torrent after we add it. And I thought it was a waste of time to implement such tracking.
"
209126229,5090,zeule,2016-04-12T22:17:34Z,"Thank you, it is clear now.

> And I thought it was a waste of time to implement such tracking.

+1
"
209640276,5090,zeule,2016-04-13T20:44:27Z,"Added an option to the `AddNewTorrentDialog` to disable removing for a particular torrent (the option is visible only when the auto-deletion is enabled).
"
209657835,5090,zeule,2016-04-13T21:37:38Z,"@LordNyriox: unfortunately yes. Thanks a lot!
"
209664857,5090,zeule,2016-04-13T21:56:08Z,"Thank you once again! The texts were corrected.
"
209820300,5090,zywo,2016-04-14T08:12:01Z,"The checkBox alignment for Torrent settings shouldn't be like that?

![screenshot from 2016-04-14 09-00-28](https://cloud.githubusercontent.com/assets/4026304/14521339/ba879b0e-0220-11e6-8c26-eba9c6541ed5.png)

Instead of:

![2](https://cloud.githubusercontent.com/assets/4026304/14521356/cca20f18-0220-11e6-91d9-56aea1439a4c.png)
"
209843023,5090,glassez,2016-04-14T09:16:36Z,"> The checkBox alignment for Torrent settings shouldn't be like that?

I think No, because it does not belong to torrent properties.
"
209849737,5090,Chocobo1,2016-04-14T09:32:23Z,"The new added option really should find a better place to stay:
- collapsed menu: [collapsed](https://cloud.githubusercontent.com/assets/9395168/14523536/cc8db3c4-0266-11e6-9517-a2e4b17246f6.png)
- expanded menu: [expanded](https://cloud.githubusercontent.com/assets/9395168/14523535/cc2079c6-0266-11e6-8b61-280cce8c6c64.png)
"
210524082,5090,zeule,2016-04-15T16:11:22Z,"@Chocobo1: took your suggestion about the dialog layout, thanks!
"
211066959,5090,Chocobo1,2016-04-17T17:38:22Z,"> @Chocobo1: took your suggestion about the dialog layout, thanks!

I guess you haven't update the PR yet? I didn't see the layout changes I mentioned.
And also: https://github.com/qbittorrent/qBittorrent/pull/5090#discussion_r59672489
"
211067181,5090,zeule,2016-04-17T17:42:09Z,"> I guess you haven't update the PR yet?

I've pushed the changes. Did I miss something?
"
211229625,5090,Chocobo1,2016-04-18T06:48:05Z,"> I've pushed the changes. Did I miss something?

I thought you were talking about this change: https://github.com/qbittorrent/qBittorrent/pull/5090#discussion_r59672448
And also: https://github.com/qbittorrent/qBittorrent/pull/5090#discussion_r59672489
"
211339865,5090,zeule,2016-04-18T11:31:21Z,"@Chocobo1: or, no. I'm sorry for confusing you. I've your suggestion about the placement of the option in  the ""Add torrent"" dialog in general, but I agree with @glassez that it does not belong to the torrent properties. So it now does not ""jump"" as it was. Concerning the size of the warning icon (where you suggest ""Fixed"") I'm actually puzzled a bit (and forgot to share that before).

The warning icon is retrieved from `QStyle` as `QIcon` but the label wants a pixmap. What size shall I pass to the `QIcon::pixmap()`? Right now it is 16 by 16. This will be not enough even for DPI > 160, I guess.
"
211378506,5090,Chocobo1,2016-04-18T13:28:34Z,"> but I agree with @glassez that it does not belong to the torrent properties

although it's not a torrent property, it is a **setting** to the download job.
and intuitively it fits nicely in a group of settings, so leaving it outside the group is well... less preferable.
maybe the ""Torrent settings"" can be renamed to ""Download settings"".
I hope this clarifies my point of view and I don't want to argue more on this.

> So it now does not ""jump"" as it was.

Now is better, but you should place the new checkbox above ""Never show again"", not under.

And now I think why there is a need to have `Delete .torrent files afterwards` in Options? every download job goes through addTorrentDialog right? (except nox builds)
Remove the settings in Options and rename ""Don't delete .torrent file"""" to ""Delete .torrent file"" in addTorrentDialog. Isn't this simpler?

> Concerning the size of the warning icon (where you suggest ""Fixed"") I'm actually puzzled a bit (and forgot to share that before).

And I suggest you revert to default properties as much as possible. intended changes can stand out this way.
And if you are preserving the `I` in QLabel, at least make it untranslatable.
Also the `buddy` thing you keep ignoring me, Please, can you tell me what is it for?

> This will be not enough even for DPI > 160, I guess.

Worry about it later, currently we just let Qt do the upscaling.
"
211381916,5090,glassez,2016-04-18T13:38:35Z,"> every download job goes through addTorrentDialog right?

No! Someone can disable dialog showing at all.
"
211513954,5090,zeule,2016-04-18T18:23:37Z,"> maybe the ""Torrent settings"" can be renamed to ""Download settings"".

+1

> And if you are preserving the I in QLabel, at least make it untranslatable.

Well, just to make it width not equal to zero. Not an important thing. I'll remove it.

> Also the buddy thing you keep ignoring me, Please, can you tell me what is it for?

OMG, I remember how I removed it. Must have forgot to save the file.
"
214503682,5090,sledgehammer999,2016-04-25T20:07:16Z,"Rebase please.
"
214511780,5090,zeule,2016-04-25T20:32:37Z,"Please.
"
214532665,5090,sledgehammer999,2016-04-25T21:35:52Z,"I am done reviewing it. I didn't compile/test it. I'll do it before merging.
"
217629867,5090,ngosang,2016-05-07T11:23:23Z,"Maybe I'm late but I don't like this idea. I think adding such functions are burdening qBittorrent. Also the size of `.torrent` files is negligible compared to the size of today's hard drives. I see no reason to remove them.

UPDATE: @evsh I have nothing against you, I think you're a great programmer, but you are trying to add many features in qBittorrent that are useful just for you. We should think about if a feature will be useful for more than 50% of people before including it. I'm thinking in #4994 for example.
"
217634458,5090,zeule,2016-05-07T13:18:47Z,"@ngosang: this feature is about not disk space but privacy.
"
217728939,5090,sledgehammer999,2016-05-08T15:51:40Z,"2 minor fixes and I can merge.
"
217823029,5090,zeule,2016-05-09T09:54:40Z,"> 2 minor fixes and I can merge.

Done.
"
217846351,5090,sledgehammer999,2016-05-09T12:05:04Z,"This seems to work fine for my simple tests. Thanks for the patch and all the other reviewers.
"
217861719,5090,zeule,2016-05-09T13:19:54Z,"I thank all the participants too.
"
307689815,6952,vit9696,2017-06-12T04:55:40Z,"I fixed the build issues except the one with qmake+gui. Your homebrew formula defines `-skip qtmacextras`, which is necessary to provide Dock icon badges and thus mandatory. Once you update your toolchain (just removing this line should be enough), your buildsystem will start working once again.

I could make it build even without the badges, but I see no reason to limit macOS functionality just because a certain toolchain is broken."
307719474,6952,Chocobo1,2017-06-12T08:10:49Z,"2 things I wanted to add:
1. create fixup commits for now, note that eventually you'll have to squash all commits into one.
2. please provide before & after screenshots if possible, majority (at least me) of the devs don't have easy access to a mac.
"
307845402,6952,vit9696,2017-06-12T16:38:33Z,"@Chocobo1 I fixed all the issues you asked me to change except the ones I consider invalid.
The screenshots are available in the first post if you did not notice ^^"
307902310,6952,vit9696,2017-06-12T19:50:55Z,"Alright, I squashed all the changes into a single commit and even fixed a couple of other issues I spotted. Would you please merge this?"
307981163,6952,Chocobo1,2017-06-13T01:36:18Z,">Would you please merge this?

I would like to if I can verify this PR on a mac, otherwise, this PR will be handled by the project owner @sledgehammer999."
307981700,6952,vit9696,2017-06-13T01:40:08Z,"@Chocobo1 well, I build this on a vm (too much of a dislike for Qt to let it arrive on my real machines), and can give you vnc or teamviewer without any issues. Maybe you could spot something yourself…
Ping me on irc or write an email to vit9696 at avp dot su."
308051489,6952,vit9696,2017-06-13T08:54:27Z,"@LordNyriox actually it is a very small change, so I added it right here.
It is especially bad because of the main menus, where the entry already says ""Preferences…"", and because of Dock that has Options.

To be honest, after this I felt like making all the icons greyscale on macOS and be done with it. I am not sure how to do it properly. On macOS one pretty much must use greyscale icons on toolbar, statusbar, in fact everywhere. And what you have at the moment looks terrible.

Shall I open an issue for a discussion? You have some theming pull requests here awaiting the merge, but this is not really about theming but about following the mandatory UI guidelines."
308055733,6952,vit9696,2017-06-13T09:11:49Z,"And just another thing, while I was changing the Preferences title I thought that something is wrong with the window. Now I see it. You use a qBittorrent icon everywhere in the windows.

On macOS we **do not** have a window icon unless this icon represents a file type, which is quite convenient. Also fixed everywhere."
308062545,6952,vit9696,2017-06-13T09:38:32Z,"In addition to the screens in the first post, here are more:
<details>
  <summary>Screenshots</summary>

![screen shot 2017-06-13 at 02 30 40](https://user-images.githubusercontent.com/4348897/27076183-16d3eaee-5035-11e7-8d69-a896905f89a0.png)
![screen shot 2017-06-13 at 02 30 48](https://user-images.githubusercontent.com/4348897/27076187-1727ccd6-5035-11e7-9685-3576b302e7e9.png)
![screen shot 2017-06-13 at 02 31 03](https://user-images.githubusercontent.com/4348897/27076184-172730c8-5035-11e7-9316-699516eda2e7.png)
![screen shot 2017-06-13 at 02 32 18](https://user-images.githubusercontent.com/4348897/27076188-172bf0b8-5035-11e7-8043-55820d909c97.png)
![screen shot 2017-06-13 at 02 32 28](https://user-images.githubusercontent.com/4348897/27076185-172729b6-5035-11e7-8a6b-118cf9235275.png)
![screen shot 2017-06-13 at 02 33 43](https://user-images.githubusercontent.com/4348897/27076186-1727cbbe-5035-11e7-91e3-32d0f2eb78b7.png)

</details>"
308133721,6952,vit9696,2017-06-13T14:25:54Z,"I created an issue regarding macOS icon choice: https://github.com/qbittorrent/qBittorrent/issues/6957.
Please let me hear your opinion.

@LordNyriox I am a reasonably old macOS user, and from what I remember even in the days of 10.6 colouring was not something to appear in the toolbar, and there were hardly many programs with the statusbar, and even them had greyscale icons. (e.g. [2017-06-13 16 09 25](https://user-images.githubusercontent.com/4348897/27087288-459a8d10-505d-11e7-8315-2d91617db7ba.png)). I guess we could continue the discussion in the created issue."
309215781,6952,vit9696,2017-06-17T13:40:35Z,"Sorry, found a bug, which was previously unnoticed due to another bug in the very old code of yours, that started to trigger due to a Qt change @_@.

The issue is that recent qBittorrent binaries have black text in selected tabs (see [Search and Suzumiya](https://user-images.githubusercontent.com/4348897/27076188-172bf0b8-5035-11e7-8043-55820d909c97.png). This happens because to support fusion and other styles on mac (that have black text on white tabs) Qt devs added a stylesheet comparison in https://github.com/qt/qtbase/commit/2fbc1432025dd478cf9e940e3c2a1952b218c6dc.

In your codebase you have a stylesheet replacement ([commit 1](https://github.com/qbittorrent/qBittorrent/commit/77c97b5b430cce35dcb878242393b800b1894e3#diff-7ec3c68a81efff79b6ca22ac1f1eabbaR148), [commit 2](https://github.com/qbittorrent/qBittorrent/commit/7b57345c4f9307fc11d6ea7e61ea38802df92ed4)) that… does nothing on mac mhm. (It was later modified and moved a little but remained the same). This effectively switches all the styles on mac to Stylesheet. QMacStyle check fails, and starting with the recent Qt 5.8.x versions qBittorrent tabs on mac are unreadable.

After I fixed this I discovered that I myself added a stylesheet change to remove the border. This is not valid, it breaks all the tabwidgets and `-style fusion` mode as well. I reworked the change, so we are good now ([screen 1](https://user-images.githubusercontent.com/4348897/27253348-6c93dfea-537b-11e7-9f88-d0fb1f21eddf.png) and [screen 2](https://user-images.githubusercontent.com/4348897/27253349-6cdea4f8-537b-11e7-807c-2a66b31226f6.png)).

I squashed the commits, just as you asked, but here are the only changes I made since the review confirmation to make your life easier: https://ghostbin.com/paste/umfdu.

I think this is finally good now and ready to be merged..."
309219332,6952,Chocobo1,2017-06-17T14:46:13Z,">I squashed the commits, just as you asked, but here are the only changes I made since the review confirmation to make your life easier: https://ghostbin.com/paste/umfdu.

Yeah, if you could defer the squash-ups to just before merging, that would be great, example: https://github.com/qbittorrent/qBittorrent/pull/6911/commits

"
309220447,6952,vit9696,2017-06-17T15:06:43Z,"As for squashing I am fine not to, generally even the maintainer does it at merging (on this site it is even automated). However, if I have to squash ""in the end"" it will most likely decline the confirmed review, so it is kind of an infinite loop with this logic. 

I left the commits untouched, let me know if we are good so that I could squash them and this gets finally applied xD))"
309222163,6952,Chocobo1,2017-06-17T15:37:02Z,">However, if I have to squash ""in the end"" it will most likely decline the confirmed review, so it is kind of an infinite loop with this logic.

Don't worry about it, its how we run the project now...

>I left the commits untouched, let me know if we are good so that I could squash them and this gets finally applied xD))

Someone (from the devs) will give you the signal.

---

@sledgehammer999 
ping and I my review is done here."
309224769,6952,thalieht,2017-06-17T16:21:24Z,"Closes #951, #2126, half #2761, #3022, #3030, #3617, #3750?, #4129?, #4147?, #4200, #4748?, #6997, PR #2096, #6206"
309227070,6952,vit9696,2017-06-17T17:00:40Z,"Thanks for checking the tracker.

This indeed fixes #4748.

As for #2761 using just the bare API there is enough space for a single line only, I guess for a more complete fix one must perform a full manual redraw in Cocoa, or at least provide an option to choose the speed to show. Given the enforced red colour the latter is probably a bad idea, and the former is certainly outside of this PR.

#3750, #4129, #4147 are fixed, the completely broken tray icon is now gone for good, and restoration and minimisation works fine."
310924741,6952,sledgehammer999,2017-06-25T20:02:44Z,"@vit9696 thanks for awesome work and sorry for the long wait. At least the other members started reviewing the code.
Of course I approve this work visually.
I'll also update the toolchain on Travis as soon as I get my hands on the macOS machine. Usually in a few days, where I'll also build the upcoming v3.3.14.

PS: With my latest push your PR has a minor conflict. Please fix it. Thx."
310948091,6952,vit9696,2017-06-26T02:17:35Z,"Hi, nice to see that moving. I rebased everything to trunk.
Had to add a minor change to get cmake compile: [line](https://github.com/qbittorrent/qBittorrent/pull/6952/files#diff-b565ef9558c99a298c3a692809dba35cL29).
Hopefully this could get merged in 3.4.0 =)"
313381540,6952,vit9696,2017-07-06T12:26:59Z,"> I don't like all these #ifdef with icons. Maybe we better organize our icons to remove or blacklist action icons on MacOS?

Even though possibly a good idea, it is not really doable. Icons still remain in the search tab, for example. While not so nice, this is essential for usability."
313388443,6952,zeule,2017-07-06T12:57:50Z,"> Even though possibly a good idea, it is not really doable.

Could you elaborate, please? If you mean that the same icon might be used on other platforms in different places where on MacOS in one of them icon is not needed, then maybe we better add a context parameter to `GuiIconProvider::getIcon()`?


"
313390794,6952,vit9696,2017-07-06T13:07:41Z,"@evsh I was referring to blacklisting tab/button icons as a class on macOS. I think Qt has something similar for non-menu icons that disables them globally, which is not really possible, since in some places the icons are still needed even on macOS.

Wrapping functions like `GuiIconProvider::getIcon()` is possible, but from what I remember it is not the only function used, also the semantics of making a show/hide decision needs to be agreed on (it cannot just be ifdef macOS → hide). In addition there is other code that still needs ifdefs.

All in all, I would rather not try to refactor relevant side portions of code at the same time as fixing a lot of other things."
313873516,6952,sledgehammer999,2017-07-08T18:33:38Z,@vit9696 rebase on master. macOS packageds for travis/homebrew have been updated to include QtMacExtras (+ QtSVG) (plus latest RC_1_0 for libtorrent)
313875139,6952,vit9696,2017-07-08T19:06:19Z,@sledgehammer999 we are good now =)
313882259,6952,zeule,2017-07-08T21:32:13Z,"> macOS packageds for travis/homebrew have been updated to include QtMacExtras (+ QtSVG)

Why do we use a custom Qt bottle but not the package from homebrew?"
314752806,6952,vit9696,2017-07-12T12:24:07Z,"Now that everything is settled including the build issues, would you please approve and merge this or let me know what else is ought to be changed? It is not too hard to maintain the patch in sync with the ongoing changes in master, but I would rather not spend your and my time on stuff like rebasing. Thank you for understanding.

CC @Chocobo1, @evsh, @sledgehammer999, @thalieht "
314787228,6952,sledgehammer999,2017-07-12T14:30:09Z,">Why do we use a custom Qt bottle but not the package from homebrew?

In the past the `macdeployqt` was broken. But now homebrew includes the patch in the formular itself. I can't remember any other reason. So it is probably safe to drop it now.

>Now that everything is settled including the build issues, would you please approve and merge this or let me know what else is ought to be changed? It is not too hard to maintain the patch in sync with the ongoing changes in master, but I would rather not spend your and my time on stuff like rebasing. Thank you for understanding.

I leave this PR open in a browser tab. I will review+merge as soon as possible."
314823404,6952,zeule,2017-07-12T16:27:50Z,"> In the past the macdeployqt was broken. But now homebrew includes the patch in the formular itself. I can't remember any other reason. So it is probably safe to drop it now.

Great! Thanks!"
314843747,6952,vit9696,2017-07-12T17:42:43Z,"> In the past the macdeployqt was broken. But now homebrew includes the patch in the formular itself. I can't remember any other reason. So it is probably safe to drop it now.

It may not be. I cannot produce a standalone build with `macdeployqt` from HomeBrew, though I am unaware if I am supposed to pass special flags or compile differently. Please test it before removing =)."
314859122,6952,sledgehammer999,2017-07-12T18:38:17Z,">It may not be. I cannot produce a standalone build with macdeployqt from HomeBrew, though I am unaware if I am supposed to pass special flags or compile differently. Please test it before removing =).

Are you using the 5.9.1 `qt.rb` formula? It explicitly has patch for this inside. And used `otool -L` in the QtNetwork and QtGui libs and the QtCore references were rewritten to relative paths pointing to the .app package.

PS: I just use `macdeployqt qbittorrent.app`
PS: Relevant PR #7097 "
314905476,6952,vit9696,2017-07-12T21:41:13Z,"@sledgehammer999 I have just rechecked my setup, and there is good news. Qt from HomeBrew now deploys without issues. There still were 5.9.0 leftovers, and unfortunately the older macdeployqt was used and confused me.

There is an important thing to be aware of, though: Qt from HomeBrew requires 10.10 and higher."
314908343,6952,sledgehammer999,2017-07-12T21:53:20Z,">There is an important thing to be aware of, though: Qt from HomeBrew requires 10.10 and higher.

We don't actually have a policy for macOS. Are there people not upgraded to 10.10 yet?"
314908825,6952,vit9696,2017-07-12T21:55:28Z,"@sledgehammer999 unsure, there could be some who stick to 10.9.5, but I personally do not care. Just mentioned this because you were concerned about the minimum supported macOS version in the other issue."
315550824,6952,sledgehammer999,2017-07-15T17:51:37Z,Thx for the time you took to find all the little details and fix them.
315583127,6952,Chocobo1,2017-07-16T03:44:19Z,"Getting some errors on qbt launch:
```shell
$ src/qbittorrent 
QObject::connect: No such slot MainWindow::toggleVisibility()
QObject::connect:  (sender name:   'actionToggleVisibility')
QObject::connect:  (receiver name: 'MainWindow')
QObject::connect: No such slot MainWindow::updateTrayIconMenu()
QObject::connect:  (receiver name: 'MainWindow')
QObject::connect: No such slot MainWindow::toggleVisibility(QSystemTrayIcon::ActivationReason)
QObject::connect:  (receiver name: 'MainWindow')
```"
315598244,6952,vit9696,2017-07-16T09:50:27Z,"@Chocobo1 I definitely don't have this. The only issues I see are:
```
$ /Applications/qbittorrent.app/Contents/MacOS/qbittorrent ; exit; 
2017-07-16 12:46:45.118 qbittorrent[34665:31468133] Path  given to -[NSWorkspace iconForFile:] is not a full path.
2017-07-16 12:46:45.118 qbittorrent[34665:31468133] Path  given to -[NSWorkspace iconForFile:] is not a full path.
```
And they are most certainly due to https://github.com/qbittorrent/qBittorrent/pull/6156.
Are you using cmake or qmake builds? I use cmake, and now I do wonder whether qmake also needs Q_OS_MAC definition for MOC. Like [this one](https://github.com/qbittorrent/qBittorrent/pull/6952/files#diff-95e351a3805a1dafa85bf20b81d086e6R30)."
315598465,6952,Chocobo1,2017-07-16T09:54:31Z,"@vit9696 
No worries, #7106 has just been merged.

>Are you using cmake or qmake builds?  

qmake"
315598598,6952,vit9696,2017-07-16T09:57:10Z,"Oh, I see, thanks a lot :)"
408169299,6952,D3V4N5H,2018-07-26T17:15:02Z,"Hello. I'm relatively new. I love qBittorrent. I'd like to see ETA (expected time to finish download) on the Badge instead of Global Download Speed, as it makes sense to me, to not to check now and then from the window and then hide it again.

I know C++ but not Qt.
How can I contribute?
Do I need any special development environment in my MacBook Air?"
200389249,4984,ngosang,2016-03-23T15:15:23Z,"This feature is necessary but I've looked at the code and the implementation seems a little complicated. Maybe @glassez  can help you simplify things.
"
200560764,4984,SeigneurSerpent,2016-03-23T21:59:48Z,"Let me elaborate on the changes introduced to clear a few things up.

`session.cpp` is modified to set external IP address to `announce_ip`. That is how a client tells its public IP even operating in a private network.

Announcement URL parameters `info_hash` and `peer_id` are just random 20-byte binary strings. Qt5's `QUrlQuery` wouldn't decode the parameters fully as it normally expects UTF-8 strings. Sometimes it could lead to different ""half-decoded"" strings corresponding to one binary string, making the decoding function non-bijective (not one-to-one). Therefore files `webapplication.cpp`, `webapplication.h`, `requestparser.h`, `requestparser.cpp`, `irequesthandler.h` and `connection.cpp` are changed to make url parameters decoding optional and turn it off for embedded tracker (via `configureRequestParser()` request and then invoking `disableURLParameterDecoding()` on `parser`), and let the tracker percent-decode the parameters. Still, when string decoding fails for some reason, the string is stored in a hashtable as a key thereby preserving the way tracker used to operate before for erroneous strings. That’s why several `if` clauses are introduced in `tracker.cpp`

Static functions in `IpUtil` and `isNonRoutable()` in particular are introduced in `tracker.cpp` to determine whether given IP address is public (external). These functions are used in `Peer::getIpForClient(clientIp)` to retrieve public IP for a given peer if the `clientIp` is public. Otherwise it falls back to connection IP.

If you have any questions or suggestions for improvement, please don't hesitate to tell.
"
200654828,4984,glassez,2016-03-24T04:12:28Z,"> Qt5's  QUrlQuery  wouldn't decode the parameters fully as it normally expects UTF-8 strings. Sometimes it could lead to different ""half-decoded"" strings corresponding to one binary string, making the decoding function non-bijective (not one-to-one). 

For a start, please describe this problem in detail. Give me an example URL that is decoded incorrectly, so I can check it out.
"
200947358,4984,SeigneurSerpent,2016-03-24T17:49:56Z," @glassez
Lets consider a simple test that decodes sequences ""()A%7BB"" and ""%28%29A%7BB"". These sequences represent the same binary string. The default QUrl::PrettyDecoded doesn't do much and produces ambiguity. QUrl::FullyDecoded seems to decode every character, but replaces non-UTF8 0x80-0xFF characters with a predefined character. It is evident when comparing decoded  strings ""%80%00"" and ""%FF%00"".

Reference seems to corroborate this:
http://doc.qt.io/qt-5/qurl.html#full-decoding
""Non-UTF-8 sequences: URLs may contain sequences of percent-encoded characters that do not form valid UTF-8 sequences. Since URLs need to be decoded using UTF-8, any decoder failure will result in the QString containing one or more replacement characters where the sequence existed.""

```
#include ""libtorrent/escape_string.hpp""
#include <string>
#include <QByteArray>
#include <QUrlQuery>

QString decode(const QString& encoded, QUrl::ComponentFormattingOptions encoding = QUrl::PrettyDecoded)
{
    QString url = QString(""announce?a="") + encoded;
    QListIterator<QPair<QString, QString> > i(QUrlQuery(url).queryItems(encoding));

    QString decoded = i.next().second;

    qDebug() << ""Decoded: "" << decoded;
    qDebug() << ""Hex: "" << decoded.toLocal8Bit().toHex();

    return decoded;
}

void test()
{
    char s1[] = ""()A%7BB"";
    // perfectly valid percent-encoded string that represents the same binary string as s1, but characters '(' and ')' are encoded
    char s2[] = ""%28%29A%7BB"";
    boost::system::error_code ec1, ec2;
    qDebug() << ""Libtorrent:"";
    qDebug() << ""Same binary? "" << (libtorrent::unescape_string(s1, ec1) == libtorrent::unescape_string(s2, ec2));
    qDebug() << """";

    QString e1(s1);
    QString e2(s2);
    qDebug() << ""default(PrettyDecoded):"";
    qDebug() << ""Same binary? "" << (decode(e1) == decode(e2));
    qDebug() << """";

    // FullyDecoded seems to help decode symbols, but...
    qDebug() << ""FullyDecoded:"";
    qDebug() << ""Same binary? "" << (decode(e1, QUrl::FullyDecoded) == decode(e2, QUrl::FullyDecoded));
    qDebug() << """";

    // non-UTF8 sequences are replaced with a predefined charachter
    qDebug() << ""FullyDecoded with Non-UTF8 characters:"";
    QString c1(""%80%00"");
    QString c2(""%FF%00"");
    qDebug() << ""Same binary? "" << (decode(c1, QUrl::FullyDecoded) == decode(c2, QUrl::FullyDecoded));
    qDebug() << """";
}
```

```
Libtorrent:
Same binary?  true

default(PrettyDecoded):
Decoded:  ""%28%29A{B""
Hex:  ""253238253239417b42""
Decoded:  ""()A{B""
Hex:  ""2829417b42""
Same binary?  false

FullyDecoded:
Decoded:  ""()A{B""
Hex:  ""2829417b42""
Decoded:  ""()A{B""
Hex:  ""2829417b42""
Same binary?  true

FullyDecoded with Non-UTF8 characters:
Decoded:  ""?\u0000""
Hex:  ""3f00""
Decoded:  ""?\u0000""
Hex:  ""3f00""
Same binary?  true
```
"
201175294,4984,glassez,2016-03-25T07:04:11Z,"@SeigneurSerpent Since there are two independent problems, it would be better if you will divide this PR into two: one for IP handling and the other for URL decoding. This may speed up reviewing and merging. (leave this PR for the URL decoding issue, because there are associated comments)
"
201178852,4984,glassez,2016-03-25T07:15:03Z,"> Lets consider a simple test that decodes sequences ""()A%7BB"" and ""%28%29A%7BB"". These sequences represent the same binary string. The default QUrl::PrettyDecoded doesn't do much and produces ambiguity. QUrl::FullyDecoded seems to decode every character, but replaces non-UTF8 0x80-0xFF characters with a predefined character. It is evident when comparing decoded strings ""%80%00"" and ""%FF%00"".

OK. That's all clear. But it's too abstract example.
What about actual cases? What parameters can contain such escapes, under what conditions, and what clients can produce this? And, most importantly, can we consider such requests valid from the BitTorrent protocol point of view?
"
201420544,4984,SeigneurSerpent,2016-03-25T18:51:29Z,"@glassez 

> Since there are two independent problems, it would be better if you will divide this PR into two: one for IP handling and the other for URL decoding. This may speed up reviewing and merging. (leave this PR for the URL decoding issue, because there are associated comments)

The code is difficult to divide seamlessly into two separate updates, because both rely on `Peer` class interface, which has been modified to incorporate both changes. Therefore the separation would drag changes from both updates and lead to multiple merge conflicts. Maybe it is better to move some IP-related code to a separate file to avoid clutter. Another option is to first merge ulr-decoding PR and then create remote ip handling PR.

> What about actual cases? What parameters can contain such escapes, under what conditions, and what clients can produce this? And, most importantly, can we consider such requests valid from the BitTorrent protocol point of view?

According to the specification, info_hash and peer_id are 20-byte binary strings that must be percent-escaped:
[https://wiki.theory.org/BitTorrentSpecification](url)

> Note that all binary data in the URL (particularly info_hash and peer_id) must be properly escaped.
> 
> info_hash: urlencoded 20-byte SHA1 hash of the value of the info key from the Metainfo file.
> 
> peer_id: urlencoded 20-byte string used as a unique ID for the client, generated by the client at startup.

The following page describes bittorrent tracker protocol in detail:
[https://wiki.theory.org/BitTorrent_Tracker_Protocol](url)
"
201435446,4984,glassez,2016-03-25T19:11:22Z,"> Maybe it is better to move some IP-related code to a separate file to avoid clutter.

Do not rush to do it. Let me watch current implementation.
"
201756082,4984,SeigneurSerpent,2016-03-26T10:48:26Z,"@glassez 

> QByteArray::fromPercentEncoding has wrong behavior too?

Percent-escaping produces US-ASCII character sequences. UTF-8 is backward compatible with US-ASCII, i.e. both have the same binary representation in the range 0x00-0x7F. Invoking `escaped.toUtf8()` produces QByteArray of ASCII symbols, which is consumed by QByteArray::fromPercentEncoding(). The function source code seems to confirm that it does what expected:

src/corelib/tools/qbytearray.cpp

```
static void q_fromPercentEncoding(QByteArray *ba, char percent)
{
    if (ba->isEmpty())
        return;

    char *data = ba->data();
    const char *inputPtr = data;

    int i = 0;
    int len = ba->count();
    int outlen = 0;
    int a, b;
    char c;
    while (i < len) {
        c = inputPtr[i];
        if (c == percent && i + 2 < len) {
            a = inputPtr[++i];
            b = inputPtr[++i];

            if (a >= '0' && a <= '9') a -= '0';
            else if (a >= 'a' && a <= 'f') a = a - 'a' + 10;
            else if (a >= 'A' && a <= 'F') a = a - 'A' + 10;

            if (b >= '0' && b <= '9') b -= '0';
            else if (b >= 'a' && b <= 'f') b  = b - 'a' + 10;
            else if (b >= 'A' && b <= 'F') b  = b - 'A' + 10;

            *data++ = (char)((a << 4) | b);
        } else {
            *data++ = c;
        }

        ++i;
        ++outlen;
    }

    if (outlen != len)
        ba->truncate(outlen);
}

void q_fromPercentEncoding(QByteArray *ba)
{
    q_fromPercentEncoding(ba, '%');
}  

QByteArray QByteArray::fromPercentEncoding(const QByteArray &input, char percent)
{
    if (input.isNull())
        return QByteArray();       // preserve null
    if (input.isEmpty())
        return QByteArray(input.data(), 0);

    QByteArray tmp = input;
    q_fromPercentEncoding(&tmp, percent);
    return tmp;
}
```
"
201791926,4984,glassez,2016-03-26T12:09:58Z,"I've considered it (I mean URL decoding). I fully agree with @ngosang - your solution is too complicated. Besides, it is located in the wrong application layer. Later I will present you my suggestions for correcting this (I don't have the free time to do so now).
"
202094243,4984,glassez,2016-03-27T15:50:03Z,"@SeigneurSerpent we need to fix this problem at the root. But where is the root? That's right - the root is in the RequestParser class. In short, meaning that we must decode the request on the basis that it may contain any binary data in percent-encoded form. So we need to decode it not in QString but to QByteArray (and change Http::Request::gets to `QMap<QByteArray, QByteArray>`). And the decision how to interpret these data should be taken at the application level (WebApplication, Tracker, etc.).
"
205817971,4984,SeigneurSerpent,2016-04-05T13:57:11Z,"@glassez 
Done. 
Your suggestion seems to be the perfect solution to the problem. Thanks!
"
206927758,4984,SeigneurSerpent,2016-04-07T14:20:19Z,"@glassez 

```
@@ -224,7 +224,7 @@ void WebApplication::action_public_images()
 void WebApplication::action_query_torrents()
 {
     CHECK_URI(0);
-    const QStringMap& gets = request().gets;
+    const QByteArrayMap& gets = request().gets;
```

> Did you check whether it breaks the web app or not?

I completely forgot to test it with Qt4, so I added some conversion code.
Both Qt5 and Qt4 have QString(QByteArray) constructor, but only Qt5 treats the array as Utf-8 sequence.  In Qt5 everything should work like magic because of QString(QByteArray) constructor and implicit construction from QByteArray to QString. As far as Qt4 is concerned, I added explicit conversion from QByteArray to QString.
Request.gets is used in 3 WebApplication functions: action_query_torrents, action_sync_maindata, action_sync_torrent_peers. But these functions appear not to be used by anything else. So I tested each case using handcrafted custom conversion tests.

```
@@ -123,14 +123,22 @@ bool RequestParser::parseStartingLine(const QString &line)

         // Parse GET parameters
 #ifndef QBT_USES_QT5
-        QListIterator<QPair<QString, QString> > i(url.queryItems());
+        QListIterator<QPair<QByteArray, QByteArray> > i(url.encodedQueryItems());
+        while (i.hasNext()) {
+            QPair<QByteArray, QByteArray> pair = i.next();
+            m_request.gets[pair.first] = pair.second;
```

> Why don't you do ""fromPercentEncoding()"" here? Or QUrl doing it itself?

Fixed.

```
 #include ""base/preferences.h""
 #include ""base/http/server.h""
 #include ""base/utils/string.h""
 #include ""tracker.h""
+#include <boost/asio/ip/address.hpp>
+#if defined(BOOST_ASIO_DYN_LINK) || !defined(BOOST_ASIO_SEPARATE_COMPILATION)
+#include <boost/asio/impl/src.hpp>
```

> Get that out of here. If qBittorrent is not compiled you have, it is the problem of your build configuration.

I guess I should leave only `defined(BOOST_ASIO_DYN_LINK)`

All remaining issues have been fixed.
"
206928915,4984,SeigneurSerpent,2016-04-07T14:22:55Z,"@Chocobo1 

```
@@ -42,5 +42,6 @@ enum class ShutdownAction
 };

 typedef QMap<QString, QString> QStringMap;
+using QByteArrayMap = QMap<QByteArray, QByteArray>;
```

> ```
> This is the same in c++11:
> ```
> 
> OK. But from the my view point, it comes down to whether you are going to define a type, which is also stated in what you quote:
> 
> ```
> it does not define a new type and ...
> ```
> 
> In this specific scenario, I interpret the author is defining a type, because QByteArrayMap is used non locally.
> And another weaker argument, the typedef is just above it... mixing like this is weird IMO.

Done
"
206953349,4984,glassez,2016-04-07T15:29:02Z,"> All remaining issues have been fixed.

You will hate to hear this, but I say no. I asked you to simplify your previous code, you made it difficult. I was told that my proposed simplification will reduce the amount of code and you just put the body of some functions in one line with braces in violation of our coding style rules. By the way, you also did not fix other coding style issues (or you just added the new).
Do you still have previous version of code?
"
207020944,4984,SeigneurSerpent,2016-04-07T17:41:55Z,"@glassez 

> Do you still have previous version of code?

Yes I have. I guess rebasing was a terrible idea, so I'll do it only after a complete successful review. I restored the branch and created a separate commit. Here is the proposed fix:

[https://github.com/qbittorrent/qBittorrent/pull/4984/commits/dbd374775134b10458a6ed1e0d3fb703e0f5d2a3]()

Apparently I misunderstood some of your suggestions. So let me comment on some seemingly very strange changes I've made.
I removed all getters from Peer class when transformed it to struct. Also I renamed toEntryForClient() to peerToEntry() and changed its signature to `libtorrent::entry peerToEntry(const Peer& peer, bool noPeerId, const QString& clientIp)` following the comment:

```
         bool operator!=(const Peer &other) const;
         bool operator==(const Peer &other) const;
-        QString uid() const;
-        libtorrent::entry toEntry(bool noPeerId) const;
+        const QByteArray& uid() const;
+        // converts to appropriate entry taking into account whether 'clientIp' is a public ip address,  i.e. provides
+        // public ip if 'clientIP' belongs to a public network, otherwise gives connection ip
+        libtorrent::entry toEntryForClient(bool noPeerId, const QString& clientIp) const;
```

> Since you use PeerBuilder to build a peer no need to implement Peer as class at all. Simple struct is enough here.
> As for this method (toEntryForClient()), it has private meaning and can be simply transformed to module wide function peerToEntry(). The main idea is to move all private things to .cpp.

I removed `escape()` function declaration from Perr class and transferred it to unnamed namespace in tracker.cpp following the comment:

```
+
+        // ip retrieved from connection
+        QString m_ip;
+        // ip obtained from announce query
+        QString m_announce_ip;
+        std::string m_peer_id;
+        int m_port;
+        QByteArray m_uid;
+
+        // if 'clientIP' belongs to a public network, returns public address found among connection and announce ip adrresses
+        const QString& getIpForClient(const QString& clientIP) const;
+        // percent-escapes given string
+        static std::string escape(const std::string& str);
+    };
+
+    class PeerBuilder
```

> It's pure private thing so move this into .cpp.

I guess I didn't quite get what you mean by moving pure private thing to .cpp. I would appreciate if you could clarify this matter.

I deleted the PeerBuilder class and put the code generating peer uid in-place, the only thing it did useful, after reading the following comment:

```
         bool operator!=(const Peer &other) const;
         bool operator==(const Peer &other) const;
-        QString uid() const;
-        libtorrent::entry toEntry(bool noPeerId) const;
+        const QByteArray& uid() const;
+        // converts to appropriate entry taking into account whether 'clientIp' is a public ip address,  i.e. provides
+        // public ip if 'clientIP' belongs to a public network, otherwise gives connection ip
+        libtorrent::entry toEntryForClient(bool noPeerId, const QString& clientIp) const;
```

> And then it all makes the PeerBuilder class superfluous!
> If you apply my suggestions, you will significantly reduce the amount of code.

Anyway I greatly appreciate any comments or suggestions. Thanks!
"
207039728,4984,glassez,2016-04-07T18:31:11Z,"Sorry, I went a little crazy. It's not so bad. My frustration has caused most of the Http::\* code. Tomorrow I will comment in detail on this version of the code (not necessary yet to change anything).
"
207250829,4984,glassez,2016-04-08T06:50:13Z,"@SeigneurSerpent I finished to comment. Conclusion:
1. `requestparser.cpp` is OK.
2. `session.cpp` seems to be ok.
3. `tracker.*` need to be improved (according to my comments).
4. `http/types.h` needs to be fixed (according to my comments).
5. `abstractwebapplication.*` need to be untouched.
6. `webapplication.cpp` needs to be fixed (you should add GET params parsing in affected Actions).

When you create QString from UTF-8 encoded QByteArray you should use QString::fromUtf8() for both Qt4 and Qt5 (to avoid redundant `#ifdef`s).

P.S. Try not to break the coding style rules, when you will be correct this time.
"
207489755,4984,SeigneurSerpent,2016-04-08T15:50:54Z,"I hope I got everything right this time.
"
207498232,4984,glassez,2016-04-08T16:16:14Z,"There are still a few things for fixing. The rest now looks good.

> The problem turned out to be that some boost asio dynamic libraries could be compiled without rvalue reference move support. All Travis-ci comilation attempts would fail without this inclusion. So I disabled the generation of moves. Thanks for pointing it out.

It also looks suspicious. Namely, the dependence of this behavior from the inclusion of `<boost/asio/impl/src.hpp>`. I'll try to test it later.
"
207503877,4984,glassez,2016-04-08T16:30:33Z,"Besides, for some reason I can't find any mention of `BOOST_ASIO_DISABLE_MOVE` in Boost.Asio documentation.
"
207532916,4984,SeigneurSerpent,2016-04-08T17:42:45Z,"@glassez 

> It also looks suspicious. Namely, the dependence of this behavior from the inclusion of <boost/asio/impl/src.hpp>. I'll try to test it later.

No need. I replace std::swap with copy assignment and hereby eliminated all rvalue moves.
"
216602483,4984,sledgehammer999,2016-05-03T17:22:36Z,"@SeigneurSerpent one final comment. I may be a little bit confused by your changes. But here it goes. It is about the announce ip. From [here](https://wiki.theory.org/BitTorrentSpecification#Tracker_Request_Parameters):

> ip: Optional. The true IP address of the client machine, in dotted quad format or rfc3513 defined hexed IPv6 address. Notes: In general this parameter is not necessary as the address of the client can be determined from the IP address from which the HTTP request came. The parameter is only needed in the case where the IP address that the request came in on is not the IP address of the client. This happens if the client is communicating to the tracker through a proxy (or a transparent web proxy/cache.) It also is necessary when both the client and the tracker are on the same local side of a NAT gateway. The reason for this is that otherwise the tracker would give out the internal (RFC1918) address of the client, which is not routable. Therefore the client must explicitly state its (external, routable) IP address to be given out to external peers. Various trackers treat this parameter differently. **Some only honor it only if the IP address that the request came in on is in RFC1918 space. Others honor it unconditionally, while others ignore it completely.** In case of IPv6 address (e.g.: 2001:db8:1:2::100) it indicates only that client can communicate via IPv6.

So IMO if the peer has set an announce ip, it should take precedence over the IP it connected through AND if it is routable, otherwise use the connected IP as fallback.

PS: If you know what interactive rebase is, then use the `fixup` keyword to merge your commits. If not, leave a comment and I'll give detailed instructions.
"
219551576,4984,sledgehammer999,2016-05-16T21:20:24Z,"@qbittorrent/qbittorrent-frequent-contributors it seems that @SeigneurSerpent has abandonded this PR(or too busy). Can someone review my comments, so I can prepare a patch after merging this?
"
220838615,4984,SeigneurSerpent,2016-05-22T15:34:30Z,"@sledgehammer999 
Sorry for taking so long to reply. I was away from home.
"
220838951,4984,SeigneurSerpent,2016-05-22T15:40:34Z,"@sledgehammer999 

If the changes are acceptable I can promptly merge them by interactive rebase
"
220866184,4984,sledgehammer999,2016-05-23T00:31:19Z,"I took a glance at your comments. I'll look the changes more thoroughly tomorrow.
You haven't commented on my https://github.com/qbittorrent/qBittorrent/pull/4984#issuecomment-216602483
"
221086237,4984,SeigneurSerpent,2016-05-23T20:28:32Z,"> So IMO if the peer has set an announce ip, it should take precedence over the IP it connected through AND if it is routable, otherwise use the connected IP as fallback.

I've changed somewhat server logic following your suggestion and now server provides external annouceIp to external client, otherwise - connection IP. 
However, you might be suggesting to always provide announceIp if it is routable no matter what client IP is. If that's the case, lets consider the setting of two local clients in the same network sharing private torrent. Current client implementation always announces external Ip in Session::handleExternalIPAlert(). Therefore both clients would announce their router's external IP to the server(which is one of the clients). Torrent server would provide the external IP and the clients would fail to initiate data transfer. Even if both specify their own local IP as annouceIp. On the other hand, current server implementation would provide local IPs to both clients and they would successfully communicate with each other.
From the conceptual point of view, it is certainly right to provide routable announceIp. For the above-mentioned scenario to work, I guess I should introduce a boolean option to turn inferred external ip announcement off.
"
246008416,4984,aekkarinnan,2016-09-09T19:03:42Z,"6
"
520175192,4984,glassez,2019-08-10T19:50:32Z,"@Chocobo1, what do you think about this feature in general?"
520198078,4984,Chocobo1,2019-08-11T03:52:02Z,">@Chocobo1, what do you think about this feature in general?

I'm working on something similar (improving the basic tracker), although not as complex as the PR. I'll put up for review when ready."
689102834,13327,FranciscoPombal,2020-09-08T19:55:48Z,"@glassez 

A note about the review comments pertaining to ""extracting certain trivial changes/removals to other PRs"" - I've explained in https://github.com/qbittorrent/qBittorrent/pull/13327#discussion_r485157109 why I don't think it's a good idea. However, I do agree those should be separated into distinct _commits_. I'll do that once we get over the first review."
689121875,13327,FranciscoPombal,2020-09-08T20:36:41Z,@glassez I've addressed the comments. The ones I did not mark as resolved are the ones that I think warrant further clarifications/discussion. Once we iron those out I'll force push to remove the `# GENEXP:` comments.
689514147,13327,FranciscoPombal,2020-09-09T11:58:51Z,"@glassez Ok, I think all comments of your comments of the first review have been addressed at this point. Let me know if there is something you think needs to be discussed further though. Otherwise, I'll remove the `# GENEXP:` comments and then start splitting this up into separate commits."
689544072,13327,glassez,2020-09-09T12:55:19Z,">Ok, I think all comments of your comments of the first review have been addressed at this point. Let me know if there is something you think needs to be discussed further though.

Seems it has no more blocking issues for me. Although I need to review it again after all final changes have done."
689585104,13327,FranciscoPombal,2020-09-09T14:04:43Z,"> Seems it has no more blocking issues for me. Although I need to review it again after all final changes have done.

Alright then. @Chocobo1 please take a look at this. The changes made as a result of @glassez's review comments were still very minor, so you can still compare this in its current state directly against https://github.com/qbittorrent/qBittorrent/pull/12746 to ascertain the value/advantages of going the generator expressions route.

Again, I will note that there are a few comments starting with `# GENEXP:` to signal places where the use of generator expressions was unavoidable. Once I address your review comments, I can remove those comments and finally start splitting this up into discrete commits - I already have a pretty good idea of how I will do that; @glassez also threw in some good suggestions."
690218006,13327,FranciscoPombal,2020-09-10T11:54:13Z,Force push to resolve https://github.com/qbittorrent/qBittorrent/pull/13327#discussion_r485750344
693498674,13327,FranciscoPombal,2020-09-16T15:53:47Z,"@Chocobo1 Force-pushed to address most review comments.

I will now investigate the situation with `_CRT_SECURE_NO_DEPRECATE` and `_SCL_SECURE_NO_DEPRECATE`."
693523568,13327,FranciscoPombal,2020-09-16T16:36:40Z,"Seems like `_CRT_SECURE_NO_DEPRECATE` and `_SCL_SECURE_NO_DEPRECATE` have been replaced by `_CRT_SECURE_NO_WARNINGS` and `_SCL_SECURE_NO_WARNINGS`, respectively, for a long time. Apparently they just disable a `/W3` deprecation warning (`C4996`) for certain things that we probably ought to have enabled in all cases anyway.

https://docs.microsoft.com/en-us/cpp/standard-library/safe-libraries-cpp-standard-library
https://docs.microsoft.com/en-us/cpp/c-runtime-library/security-features-in-the-crt
https://docs.microsoft.com/en-us/cpp/error-messages/compiler-warnings/compiler-warning-level-3-c4996

I'm not even sure if they were having any effect until now. I'll try building without them soon to know for sure."
693762274,13327,FranciscoPombal,2020-09-17T02:01:34Z,@Chocobo1 All comments addressed.
693794978,13327,glassez,2020-09-17T04:03:36Z,"@FranciscoPombal
Just to clarify one point. Previously, I suggested splitting these changes into some separate parts, but my goal was to review and merge them one by one (as separate PRs). Since it is generally approved now, I no longer see the point of making such a splitting post factum. The current split into two commits doesn't make sense for the master git history either. So let's just merge both commits into one and finish with it (if you don't have a great desire to prolong the fun even more)."
693840102,13327,FranciscoPombal,2020-09-17T04:50:25Z,"@glassez 

>Just to clarify one point. Previously, I suggested splitting these changes into some separate parts, but my goal was to review and merge them one by one (as separate PRs). Since it is generally approved now, I no longer see the point of making such a splitting post factum.

OK.

>The current split into two commits doesn't make sense for the master git history either. So let's just merge both commits into one and finish with it (if you don't have a great desire to prolong the fun even more).

The purpose of the current commit split is to enable easy comparison against the alternative with generator expressions, without having to open up https://github.com/qbittorrent/qBittorrent/pull/12746:

>It is built directly on top of it, to enable easily studying the differences from the diff, both against master and the genexp alternative.

Now that the general review is done, and both implementations have been verified to produce the same results, they can be compared fairly in terms of readability, maintainability, etc (actually, the genexp version is missing a couple minor fixes that came in during this review, like removing the `*_SECURE_NO_DEPRECATE` defines for Windows, which doesn't really make a difference - but let me know if you want me to remove that noise). I await your comments/decision on this matter (@Chocobo1 you too)."
694108505,13327,glassez,2020-09-17T09:18:22Z,"@FranciscoPombal
I don't think we should stay here any longer. If you still want to present genexps as an improvement, you can publish the corresponding PR on top of this one when it is merged."
694191623,13327,FranciscoPombal,2020-09-17T12:16:42Z,"@glassez 

> @FranciscoPombal
> I don't think we should stay here any longer. If you still want to present genexps as an improvement, you can publish the corresponding PR on top of this one when it is merged.

I was under the impression that there would be some more discussion about this before merging either one, but that's fine, the existing improvements can be merged now and we'll handle the rest later. I force-pushed to squash the commits together. This is ready for merging now."
694613674,13327,glassez,2020-09-18T02:37:39Z,Thank you!
694627090,13327,NotTsunami,2020-09-18T03:28:43Z,"All CMake builds on CI are failing now, with osx failing in a previous spot from before."
694648316,13327,Chocobo1,2020-09-18T04:48:45Z,">All CMake builds on CI are failing now, with osx failing in a previous spot from before.

Linux failing point:
Before this PR: No error
This PR: https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/728209129#L1579

OSX failing point:
Before this PR: https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/727897569#L2701
This PR: https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/728209131#L1225

It should be investigated."
694973505,13327,FranciscoPombal,2020-09-18T16:48:59Z,"@Chocobo1 @NotTsunami 

> > All CMake builds on CI are failing now, with osx failing in a previous spot from before.
> 
> Linux failing point:
> Before this PR: No error
> This PR: https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/728209129#L1579

I have also seen this (or very similar) reported here: https://github.com/qbittorrent/qBittorrent/issues/13347 
This failure seems to affect some systems, but not others. I don't know the exact reason why (and I can't reproduce on my Linux and Windows machines, though I haven't tried with WSL, like in the case of the bug report). I think I think this would fix it, but I wanted confirmation before proceeding: https://github.com/qbittorrent/qBittorrent/issues/13347#issuecomment-689887545 It does seem right to add the explicit direct dependency, as we do use it in `src/base/utils/misc.cpp` and `src/base/utils/password.cpp`. Actually, I can just submit a PR with the change and see what happens with CI. Will do that.

> OSX failing point:
> Before this PR: https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/727897569#L2701
> This PR: https://travis-ci.org/github/qbittorrent/qBittorrent/jobs/728209131#L1225

Though the symptom is different, the reason is the same - the broken bottle currently used. https://github.com/qbittorrent/qBittorrent/pull/13288 solves this of course."
694976251,13327,FranciscoPombal,2020-09-18T16:55:08Z,"@Chocobo1 @NotTsunami 

https://github.com/qbittorrent/qBittorrent/pull/13402"
837782506,14959,Chocobo1,2021-05-11T04:27:58Z,Perhaps you should add installation step to windows builds on github actions.
837794266,14959,glassez,2021-05-11T04:39:45Z,"> * All necessary runtime components are now copied to the build
>   directory, improving the edit/compile/debug cycle experience.

Copying all the dependencies to build directory doesn't seem like valid building workflow, IMO. It is absolutely unnecessary in correctly set development environment (I don't mean just IDE). If you want all to be copied into some target directory just install it there."
838442970,14959,FranciscoPombal,2021-05-11T13:08:07Z,"@Chocobo1 

> Perhaps you should add installation step to windows builds on github actions.

Only for the static builds, right? OK. CI for the dynamic builds will warrant a bit more disicussion because I don't think there is any more space for caching dependency artifacts, hence this comment in the OP:

> CI for dynamic builds is purposefully not included here, that is to be discussed and maybe implemented in another PR.

---

@glassez 

> Copying all the dependencies to build directory doesn't seem like valid building workflow, IMO. It is absolutely unnecessary in correctly set development environment (I don't mean just IDE).

What do you mean? The standard way to do the ""debug"" part of the ""edit/compile/debug"" cycle (IDE or not) is to just point the debugger at the executable generated in the build directory, and it should ""just work"". If some required runtime DLLs are not there, it will not work. Such is life on Windows. I'm sure it can also be done in some other roundabout way by configuring debugger search paths, etc, but this is simpler and more closely mimics the final setup that will be deployed to the user.

> If you want all to be copied into some target directory just install it there.

Regardless of matters related to development setup, copying the remaining runtime DLLs to the build directory is a prerequisite to make installation trivial.

Maybe you would prefer if the full ""runtime tree"" were generated to its own sub directory of the build folder, so that it is not at top-level? For example, copying `build/qBittorrent.exe` to `build/run/qBittorrent.exe`, and the required runtime DLLs also to `build/run`? Is this what you meant?"
838788213,14959,glassez,2021-05-11T16:28:49Z,"> What do you mean? The standard way to do the ""debug"" part of the ""edit/compile/debug"" cycle (IDE or not) is to just point the debugger at the executable generated in the build directory, and it should ""just work"".

It ""just works"" in **correctly set development environment** that I mentioned above (i.e. when all runtime dependencies are reachable via environment variables etc.)."
838861175,14959,FranciscoPombal,2021-05-11T17:20:44Z,"@glassez 

> It ""just works"" in **correctly set development environment** that I mentioned above (i.e. when all runtime dependencies are reachable via environment variables etc.).

That's in the Linux world, which I prefer as well - where every library, header file, etc is neatly stored in standard, well-known paths, all properly configured and ready to go, and automatically managed by a package manager.

But on Windows, where there is no such thing (beyond core system libs) and the common practice is to bundle everything separately between programs, it is much more practical to do it this way, rather than fiddling with `PATH`/`LIBPATH`s for every single different project. Imagine especially if you are a new contributor, you don't want to deal with that. My environment, and that of others _is_ correctly set up; fiddling with  `PATH`/`LIBPATH` in my shell/IDE simply to get the compiled executable to run correctly (without ""installing"" it) should not be my responsibility, its stuff that my tools, such as my build system, should do for me - and CMake is smart enough to save me the work of doing anything else[1].
Just like end-users don't have to fiddle with their `PATH`s to get their programs to work, developers shouldn't either. Developer UX matters - on Windows, this is the way to improve it.

See for yourself, many people face this problem: https://www.google.com/search?q=visual+studio+debug+missing+dll. Of course those needing to ask these questions are mostly novices. But those who don't are experts, whose precious time is wasted configuring such things.

[1] And it will become even smarter from 3.21 onward, thanks to https://gitlab.kitware.com/cmake/cmake/-/merge_requests/5837. "
838916668,14959,glassez,2021-05-11T17:58:53Z,"> That's in the Linux world, which I prefer as well - where every library, header file, etc is neatly stored in standard, well-known paths, all properly configured and ready to go, and automatically managed by a package manager.

I don't talk about Linux/Windows world. I talk about ""correctly set development environment"" that is configured by developer to maintain all needed workflows (building, testing etc.). It isn't dependent of any OS. Yes, from time to time I use Linux for development purposes and I use several non-default libraries/tools so they are located outside well-known system paths, but my ""development environment"" is still ""correctly set"" so I don't need apply such contr-productive actions like copying all dependencies in build dir.
As for the newcomers you supposedly care about... Sorry, but this is about developing, not playing video games. It is fair to expect at least basic knowledge from them. We do not require them to understand assembly language listing, etc."
838932402,14959,glassez,2021-05-11T18:09:55Z,"If we are talking about installing on Windows (at least in passing), then wouldn't it be better to make it possible for CMake build script to produce a real installer (e.g. NSIS) package for all types of builds (static and dynamic)?"
838962716,14959,FranciscoPombal,2021-05-11T18:30:34Z,"@glassez 

> As for the newcomers you supposedly care about... Sorry, but this is about developing, not playing video games. It is fair to expect at least basic knowledge from them. We do not require them to understand assembly language listing, etc.

You are missing the point. It's not about complexity, it's about comfort and ease of use (basically, improving developer UX). And it's not just newcomers I care about (and I _do_ care about them, not just ""supposedly""). Everyone on Windows expects it to work this way in the best case, and when there are not many special requirements (which is the case for qBittorrent, it's a very run-of-the-mill GUI application). If it doesn't work this way, it's not the end of the world of course, but the newcomers will struggle, and the experts will waste their time unnecessarily once more.

> Sorry, but this is about developing, not playing video games.

Lowering barriers of entry and simplifying workflows and setup is important. That's how you get more people into the project, both experts and newcomers alike. This is not a cathedral, it's a bazaar. It's for the community, by the community; the purpose of this project is not to stroke some developer's ego because they managed to setup and maintain an unnecessarily complex development setup, as opposed to some filthy gamer who could never achieve such a thing (I have no strong opinion about this comparison to video games, I simply don't understand it - this was my best interpretation of what it could mean).

> Yes, from time to time I use Linux for development purposes and I use several non-default libraries/tools so they are located outside well-known system paths, but my ""development environment"" is still ""correctly set"" so I don't need apply such contr-productive actions like copying all dependencies in build dir.

I did not say you never needed to use ""non-default libraries/tools"" on Linux - in fact, I usually install the latest version of Boost to `/opt/boost_w_xy_z` and use it instead of the one available in the repos. Furthermore sometimes it is really necessary to maintain more complicated setups. In this case it is simply not. Why complicate things when they can be easy?

Do you think stuff like this: https://github.com/qbittorrent/qBittorrent/wiki/Compilation:-Windows-(MSVC-2019,-64-bit,-static-linkage) is the best we can do? When I set out to improve the build system and the CI, the goal was to improve the project by making certain tasks easier and more accessible. I'm certain you agree this goal has been met.

Whereas previously, when a user wanted to test an ongoing PR, you'd have to tell them ""oh hey, you just have to follow this horrendously long procedure to compile from source"" or ""wait for some contributor to have the time to build it for you"", now they can simply download the test build and provide feedback.

Many users have been taking advantage of this and providing feedback more quickly; some of them who provide valuable feedback would not have otherwise been able to do so, either due to lack of time to compile themselves or expertise. In fact, I would bet you and other contributors have made use of the artifact downloads to quickly test things yourself without having to pull the PR and wait on the build (I sometimes do this, especially for Windows stuff). Through simplification and improving accessibility and developer UX, efficiency was improved - more people can do more things done quicker and with less effort. This is yet another step in that direction.

Additionally, the maintainers' time was freed up from having to maintain dependency bundles for the CI on the website; now everything is handled automatically and quickly (due to the caching). This in turn means we can be quicker in updating dependencies for CI.

I should also reiterate that these improvements are not solely targeted at ""making it easier for newcomers"", and especially not at the expense of more experienced users. Sometimes things get messy, and improving developer UX also means making it easy for experts to really dive in and dissect everything when needed. And, of course, this change is obviously not at odds with this goal either.

Perhaps this does not seem like a big deal to you, because you are biased by how long you've been doing this, but trust me, it is. That's fine, for most people, once something becomes a habit it severely distorts the perception of the areas where the task could be improved/simplified (this is the case for me as well in other matters). Please keep that in mind."
838978371,14959,FranciscoPombal,2021-05-11T18:41:17Z,"@glassez 

> You are missing the point. It's not about complexity, it's about comfort and ease of use (basically, improving developer UX).

To reiterate this: can I slog through https://github.com/qbittorrent/qBittorrent/wiki/Compilation:-Windows-(MSVC-2019,-64-bit,-static-linkage)? Yes. Did I do it? Yes, more than one time, unfortunately. Can many other people do it? Of course, this is not rocket science. Do I wish to do it again? No, unless possibly as a means to try to track down and isolate a very specific and evasive bug (was never the case thus far). Are there people who would have otherwise been able to help, but just gave up (not necessarily due to lack of technical capabilities)? You bet. Very quickly I started thinking ""there must be a better way"", for most cases, and worked towards it.

Similarly: can i setup the paths to find the required DLLs to debug the qBittorrent executable in the build folder? Yes. Can many other people also do so? Of course. Do I or others want to do it, given that there is an alternative way that is simpler and sufficient for 99% of cases? No. Are there people who would have otherwise been able to help, but just gave up (not due to lack of technical capabilities), and instead contributed their time and expertise to other FOSS projects that were easier to setup a development environment for? You bet."
839391094,14959,Chocobo1,2021-05-12T02:45:28Z,">Only for the static builds, right? OK. CI for the dynamic builds will warrant a bit more disicussion because I don't think there is any more space for caching dependency artifacts, hence this comment in the OP:

Just to be clear, the point is to test (run through) the install step of cmake script and ensure it is working.
As for dynamic builds, maybe you could install to some temporary path to avoid caching them."
839400175,14959,Chocobo1,2021-05-12T03:13:07Z,"@FranciscoPombal 
I think glassez is talking about the clear separation of building step and installation step: building step would only produce artifacts from code and installation step would gather all artifacts and dependencies and put them to a predefined path.
[Here](https://github.com/qbittorrent/qBittorrent/pull/14959/files#diff-c465e5ba8795855c88200e0f31078db072ddf7ef6fddb2c0c0d7d630fbcb1506R150) you violated the separation, that is, gathering/copying dependencies at the building step.

@glassez 
There could be a compromise for this: put the alternative behavior into a cmake module and place the module at `cmake/Modules/contrib/whatever.cmake`. The ""contrib"" folder stands for user contributed scripts and is not actively maintained by the project. The alternative behavior is by default off and it would need to be enabled by an explicit cmake argument (`-DCONTRIB_WHATEVER=ON`).
What do you think?

"
839403919,14959,glassez,2021-05-12T03:24:27Z,"> I think glassez is talking about the clear separation of building step and installation step: building step would only produce artifacts from code and installation step would gather all artifacts and dependencies and put them to a predefined path.
> [Here](https://github.com/qbittorrent/qBittorrent/pull/14959/files#diff-c465e5ba8795855c88200e0f31078db072ddf7ef6fddb2c0c0d7d630fbcb1506R150) you violated the separation, that is, gathering/copying dependencies at the building step.

👍 


> There could be a compromise for this: put the alternative behavior into a cmake module and place the module at `cmake/Modules/contrib/whatever.cmake`. The ""contrib"" folder stands for user contributed scripts and is not actively maintained by the project. The alternative behavior is by default off and it would need to be enabled by an explicit cmake argument (`-DCONTRIB_WHATEVER=ON`).
> What do you think?

👍 
Yes, I insist that ""build action"" just builds by default. If you want some irregular behavior, add it as an option."
839414017,14959,glassez,2021-05-12T03:58:38Z,"@FranciscoPombal 
Sorry, your motivation is contradictory in some aspects.
Why do you oppose this ""feature"" to the process of building/installing dependencies? It's still required, isn't it?
Why do you reproach me with the so-called Windows way, while you yourself suggest using command-line tools etc. (which is clearly not the Windows way) even when it is possible to use GUI tools (you even suggest not using the CMake installer, but configuring it manually). If someone can go through all the suggested steps of building/installing qBittorrent and its dependencies, then it's not at all difficult for them to enter another command to set the paths, is it?

But as suggested above, if our community wants this ""feature"", we can provide it as an option."
839439194,14959,glassez,2021-05-12T05:06:30Z,"> > There could be a compromise for this: put the alternative behavior into a cmake module and place the module at `cmake/Modules/contrib/whatever.cmake`. The ""contrib"" folder stands for user contributed scripts and is not actively maintained by the project. The alternative behavior is by default off and it would need to be enabled by an explicit cmake argument (`-DCONTRIB_WHATEVER=ON`).
> > What do you think?
> 
> 👍
> Yes, I insist that ""build action"" just builds by default. If you want some irregular behavior, add it as an option.

Honestly I still see no valid reason to distort meaning of build action instead of just apply install action if you need exe and its dependencies to be installed in some location. You can even set build dir as installation target dir if you want, can't you?"
839775980,14959,FranciscoPombal,2021-05-12T13:32:56Z,"(if you are in a hurry, just read the last 2 paragraphs at the bottom, below the horizontal line/separator)

@Chocobo1 

> Just to be clear, the point is to test (run through) the install step of cmake script and ensure it is working.

:+1:

> As for dynamic builds, maybe you could install to some temporary path to avoid caching them.

Seems like a reasonable stop-gap solution for now. Ideally we would of course want to cache the dependencies needed for the dynamic builds as well. I think the best way for now is to make it an entirely separate workflow (e.g. ""CI for dynamic builds"") Maybe GitHub will increase the available space for cached artifacts in the future, so that this can be simplified.

@Chocobo1 @glassez 

> I think glassez is talking about the clear separation of building step and installation step: building step would only produce artifacts from code and installation step would gather all artifacts and dependencies and put them to a predefined path.
[Here](https://github.com/qbittorrent/qBittorrent/pull/14959/files#diff-c465e5ba8795855c88200e0f31078db072ddf7ef6fddb2c0c0d7d630fbcb1506R150) you violated the separation, that is, gathering/copying dependencies at the building step.

> Honestly I still see no valid reason to distort meaning of build action instead of just apply install action if you need exe and its dependencies to be installed in some location. You can even set build dir as installation target dir if you want, can't you?

It seems to me like these statements contradict each other. If there is supposed to be a clear distinction between ""install"" and ""build"", why is it suggested that I run the ""install"" step if I just want to build for debugging? The install step is not meant to be executed as part of the normal development cycle.

> building step would only produce artifacts from code and installation step would gather all artifacts and dependencies and put them to a predefined path.

No. building step should produce artifacts _and do whatever else is necessary in order for the executable to be usable for the build folder_. In general, on Linux nothing else needs to be done. On Windows, it means potentially gathering and copying in artifacts to the build folder. The purpose of the install step is to gather all artifacts for deployment for deployment on an ""actual"" install location, to simulate what will end up on the users' machine.

Of course, these need not be the same, in qBittorrent's case it just so happens that the artifacts copied are all the same. But suppose we started including the `README.md` and `LICENSE` files as part of the installation; in this case, these files _wouldn't_ be copied as part of the build, but _would_ be copied as part of the installation, because their presence doesn't affect debugging in any way, it is only important to check that they would actually be deployed in the the `install` step. Similarly, I have noticed `windeployqt.exe` also copies `vc_redist.exe` as part of the gathering of runtime dependencies; I assume it does this for convenience, in case someone needs to update/install it, but clearly we're not going to copy it in the install step. So as you can see, I actually agree with you that there is a separation, I just think you're not right when claiming that `.dll`s and other stuff should not be copied as part of the build step on Windows - because if you don't, you're just shifting the workload onto the developer to do additional setup to get debugging to work.

As I've shown by the link to the google search above, this is a practice that is widely expected. But if you want to argue ""those are just noobs"", then I refer you to this comment by the maintainer of CMake himself: https://gitlab.kitware.com/cmake/cmake/-/issues/20417#note_707008 (and really, that whole thread and related threads), if you are more receptive to that argument of authority. You should consider that you may be a bit out of touch here.

> Sorry, your motivation is contradictory in some aspects.
Why do you oppose this ""feature"" to the process of building/installing dependencies? It's still required, isn't it?

As mentioned in the previous paragraphs, running the ""install"" step as part of the normal edit/compile/debug step is in violation of the separation of concerns that you guys champion.

>Why do you reproach me with the so-called Windows way, while you yourself suggest using command-line tools etc. (which is clearly not the Windows way) even when it is possible to use GUI tools

It seems to me you're implying the ""Windows way"" is at completely at odds with the general and widespread use of the CLI and CLI tools on Windows. This is no longer the case, if you look at what Microsoft has been doing for a while now. In the past years they have made a great effort to provide better command-line tooling. If there's a GUI on top of that to expedite certain common workflows, great, but the CLI is no longer a second-class citizen on Windows. Look at Powershell Core, `winget`, `vcpkg`, WSL, the new Windows Terminal (and the resulting opensourcing of much of their core terminal infrastructure), and many other things. These are all part of improving the developer experience. The newbies who use the GUI (and experts with a lot of muscle memory for it) can still use it, now the experts and power users who prefer the CLI are also much better served.

> even when it is possible to use GUI tools

Yes, it is possible. You can open the dialogs in Visual Studio or whatever to define the correct settings. Or, with this change, you don't need to do it. It is also possible to define those settings, PATHs, etc. via the command line - again, with this change, you don't need to do it. This is not about GUI vs CLI. It's about having to do less work with _both_ by default.

> (you even suggest not using the CMake installer, but configuring it manually). 

I said I _personally preferred it_, and others may as well _if_ they have certain special requirements. I did not say others _should_ do the same. You can also use the installer (the more ""Windows"" way), and won't be worse off for it.

> If someone can go through all the suggested steps of building/installing qBittorrent and its dependencies, then it's not at all difficult for them to enter another command to set the paths, is it?

If one can do math with an abacus, why do we need calculators? Yes, this is an exaggeration, but the point is that in that sentence you're implicitly recognizing that there _is_ an advantage in implementing this change, but you don't want it essentially _because in your opinion he current status quo is not that much harder_. If it can be improved with no downside, why not do it?

---

Anyway, speaking of ""no downside"", let's look at this in practical terms: in what way does this new way of doing things impact you negatively? If you can provide objective reasons for why this breaks/worsens _your_ workflow, I can start to work on solutions with you. After all, I don't want to implement something at your- or anyone else's expense whose workflow would be disrupted by this change. But, if it's all the same to you, why prevent implementing _and enabling by default_ a feature that is clearly useful for many other people, and improves their experience?

> There could be a compromise for this: ... ""contrib"" folder ...

_If_ this disrupts your existing workflows in some way, this can simply be gated behind a feature option that is `OFF` by default, e.g. (`COPY_RUNTIME_DEPS_TO_BUILDIR`). It would be similar in spirit to the current `MSVC_RUNTIME_DYNAMIC` option, no need to put it into a separate `contrib` directory."
839785785,14959,jagannatharjun,2021-05-12T13:46:20Z,"> It seems to me like these statements contradict each other. If there is supposed to be a clear distinction between ""install"" and ""build"", why is it suggested that I run the ""install"" step if I just want to build for debugging?

no one will run this step for a compile, debug cycle, it's would just add extra time. we would like to have ""build"" as fast as possible to do dev work, you're just adding extra unnecessary steps here.

> No. building step should produce artifacts and do whatever else is necessary in order for the executable to be usable for the build folder

No, the building is literally mean building, not aggregating dependents that's an install step.

> On Windows, it means potentially gathering and copying in artifacts to the build folder

nope it doesn't

>Yes, it is possible. You can open the dialogs in Visual Studio or whatever to define the correct settings. Or, with this change, you don't need to do it. It is also possible to define those settings, PATHs, etc. via the command line - again, with this change, you don't need to do it. This is not about GUI vs CLI. It's about having to do less work with both by default.

you only perform this one time when setting the environment, your solution will run with every compile run."
839797912,14959,FranciscoPombal,2021-05-12T14:01:49Z,"@jagannatharjun 

> no one will run this step for a compile, debug cycle, it's would just add extra time. we would like to have ""build"" as fast as possible to do dev work, you're just adding extra unnecessary steps here.
> 

Exactly. Hence why copying of dependent DLLs to the build folder should be done as an automatic post-build step.

EDIT: also, having to set up PATHs and whatnot when first starting out also prevents you form building as fast as possible at first...

> No, the building is literally mean building, not aggregating dependents that's an install step.

> nope it doesn't

Look. I have provided _sourced, real-world examples_ contradicting this, including one from other big CMake users and developers. Thus, at a minimum, I expect you to provide sources to contradict my claims, ""nope it doesn't"" isn't good enough here.

Also, in case you missed it, a small clarification, in case you missed it: building means that at the end of the process, running the executable from the output directory should ""just work"". On Windows, there are 2 ways to make it ""just work"". Either setup paths, or have your build tool copy the necessary dependents to the folder. I should not have to convince you at this point that the latter saves you work and keeps your setup simpler and more self-contained.
Installing entails gathering and copying dependents _and potentially other files_ (e.g. `README`, etc) to a _standard system install directory_ (or one made to simulate it).

> you only perform this one time when setting the environment, your solution will run with every compile run.

Is this supposed to be an argument about the performance of the post-build operation? Because as you can see, my solution uses `copy_if_different`, so it will only be very marginally slower after the first compile. Anyway, you are welcome to provide numbers substantiating a potential claim of measurable performance impact. Even if, in a hypothetical absolutely worst case, everything was overwritten every time, it's just a few DLLs in our case, it takes no time at all anyway.

EDIT: if you want to contribute constructively to the discussion, please address this:

>Anyway, speaking of ""no downside"", let's look at this in practical terms: in what way does this new way of doing things impact you negatively? If you can provide objective reasons for why this breaks/worsens your workflow, I can start to work on solutions with you. After all, I don't want to implement something at your- or anyone else's expense whose workflow would be disrupted by this change. But, if it's all the same to you, why prevent implementing and enabling by default a feature that is clearly useful for many other people, and improves their experience?"
839808094,14959,jagannatharjun,2021-05-12T14:15:04Z,"@FranciscoPombal look I don't think none of the other active devs actually uses CMake, modifying paths is just how it works on windows and I don't have enough motivation for argument. so I would really like you to at least put this under a define, this way you won't have to bump the CMake version as well and will keep your intended audience happy. This feature can be useful for release builds but I really don't see much use of it in debug builds (for my case at least), Also since it will become more ""smarter"" in cmake 3.21 why don't just wait until then it should be released in like 15 days."
839883151,14959,glassez,2021-05-12T15:50:43Z,">building step should produce artifacts and do whatever else is necessary in order for the executable to be usable for the build folder.

_© Francisco Pombal. All rights reserved._
"
839976419,14959,FranciscoPombal,2021-05-12T17:49:50Z,"@jagannatharjun @glassez

> @FranciscoPombal look I don't think none of the other active devs actually uses CMake,

~Big~ Worrying if true, considering CMake is now the default build system for Qt6 itself and Qt6 projects.

> and I don't have enough motivation for argument. so I would really like you to at least put this under a define, this way you won't have to bump the CMake version as well and will keep your intended audience happy.

Again, tell me exactly where and how this disrupts your current workflow and I'll be happy to do my best to accommodate it.

>This feature can be useful for release builds but I really don't see much use of it in debug builds (for my case at least),

OK, we're 50% of the way there! If you had actually tried this you would find that dependent artifacts are also copied in for `Debug` builds, so that other ""50%"" is also probably useful to you.

>Also since it will become more ""smarter"" in cmake 3.21 why don't just wait until then it should be released in like 15 days.

I'll just submit another PR in 15 days.

> _© Francisco Pombal. All rights reserved._

Very funny. I should have probably added a few more clauses to that statement, but it is certainly true in a wide range of cases, including ours. Meanwhile you are arguing that things should be more difficult for no reason. Again:

> **tell me exactly where and how this disrupts your current workflow and I'll be happy to do my best to accommodate it.**

---

> and I don't have enough motivation for argument.

Funny, you guys have invested a lot of time into writing unproductive posts (in the sense that you're still not telling me how exactly this change harms your workflow; we can of course discuss ""best""/""common"" practices all day long somewhere else) and now outright mockery. Again (this is getting repetitive):

> **tell me exactly where and how this disrupts your current workflow and I'll be happy to do my best to accommodate it.**"
840100951,14959,glassez,2021-05-12T21:13:46Z,"@FranciscoPombal 
Well, for now, let's close our eyes to our rejection of the idea of copying dependencies to the build directory and turn to its implementation.
I'm sorry, but I highly doubt both its reliability and its maintainability. Try to change my mind. Just please stop wasting your time and mine on some ""philosophical"" texts that you like to publish here. I'm interested in formal arguments.

As for reliability.
What kind of reliability can you talk about if you try to guess the names of dlls and the paths to them? Such care is similar to the situation if you decided to help me open the front door, trying to do it with some improvised objects in the hope that one of them will still open the lock, while I could easily open it with my key.
What if one of these supposed names matches, but it's the wrong dll?

As for maintainability.
This monstrous code doesn't look maintainable. What if we need to add another dependency? What about dependency dependencies? What if one of them adds a new dependency in the future?
Would your approach require too much care for it to maintain?"
840238895,14959,FranciscoPombal,2021-05-13T02:20:27Z,"@glassez 

> @FranciscoPombal
> Well, for now, let's close our eyes to our rejection of the idea of copying dependencies to the build directory and turn to its implementation.
> I'm sorry, but I highly doubt both its reliability and its maintainability. Try to change my mind. Just please stop wasting your time and mine on some ""philosophical"" texts that you like to publish here. I'm interested in formal arguments.

But that is the most important point here. This method is widely used and very useful, as the links I've posted above show. I'd like you to point out how this breaks your workflow, besides arguing about maintainability and reliability. Those are general concerns about any PR, I want to focus on the unique practical problems of this PR in its current state (of course, concerns about maintainability of reliability are 100% valid and important, I address them below, after the horizontal rule/line). In my last few posts all I have asked for are formal arguments, and I have provided links and sources to better substantiate my own claims. So I reject the claim that I've wasted anyone's time...

This is such a common workflow and commonly requested feature, that the next CMake version will include a built-in method of accomplishing this in the next version: https://gitlab.kitware.com/cmake/cmake/-/merge_requests/5837. I recommend you read the linked issue comments if you want to see what other people have to say about this.

After next version's release, I plan to try to adopt it immediately, as it it can greatly simplify the current implementation. But please don't take this as an excuse to not work on this now and wait for that; I'd really like to have at least something working ASAP. In fact, given the historical opposition to keeping up with recent CMake versions in this project (which can even be seen in this very PR once again already), I can't even think about what will happen when I propose _yet another_ bump in the span of only a few weeks, and for how long that will be stonewalled... in the meantime, I'd like to make this functionality available. In a way, you can think about the current implementation as ""insurance"".

For your convenience, I post here a snippet from the newly added documentation about this future feature:

> `$<TARGET_RUNTIME_DLLS:tgt>`
>
>List of DLLs that the target depends on at runtime. This is determined by
the locations of all the ``SHARED`` and ``MODULE`` targets in the target's
transitive dependencies. Using this generator expression on targets other
than executables, ``SHARED`` libraries, and ``MODULE`` libraries is an error.
On non-DLL platforms, it evaluates to an empty string.
>
>This generator expression can be used to copy all of the DLLs that a target
depends on into its output directory in a ``POST_BUILD`` custom command. For
example:
>
>```cmake
>find_package(foo REQUIRED)
>
>add_executable(exe main.c)
>target_link_libraries(exe PRIVATE foo::foo foo::bar)
>add_custom_command(TARGET exe POST_BUILD
>    COMMAND ${CMAKE_COMMAND} -E copy $<TARGET_RUNTIME_DLLS:exe> $<TARGET_FILE_DIR:exe>
>    COMMAND_EXPAND_LISTS
>)
>```

---

> As for reliability.
> What kind of reliability can you talk about if you try to guess the names of dlls and the paths to them? Such care is similar to the situation if you decided to help me open the front door, trying to do it with some improvised objects in the hope that one of them will still open the lock, while I could easily open it with my key.
> What if one of these supposed names matches, but it's the wrong dll?

The current implementation finds the DLLs based on the values stored in variables set by the `Find.*` module of the libraries themselves (for example, `OPENSSL_CRYPTO_LIBRARY` and `IMPORTED_LOCATION.*`). So this is as reliable as it gets, if you can't trust the values that the built-in `FindOpenSSL` provides you with (or some other library that you're consuming, even if it doesn't have a built-in `Find.*` module), you can't trust anything.

What we're after here are the imported location properties, and then we just find the DLL in `../bin` relative to that directory, because they use the classic Unix-style installation layout. If the library you're consuming sets these incorrectly, that is a bug in either the CMake config file provided by the library itself or the `Find.*` module you're using to find it.

As for what is probably the ugliest wart, `ZLIB_NAMES_LIST`: it was not made up by me. I simply copied all the possible names from the upstream `FindZLIB` module. I think this is sufficient - if it's good enough for the rest of the world, its good enough for us.

I have tested this both with and without vcpkg, and it worked as expected in both cases, which is a good proof of reliability.

> As for maintainability.
> This monstrous code doesn't look maintainable. What if we need to add another dependency? What about dependency dependencies? What if one of them adds a new dependency in the future?
> Would your approach require too much care for it to maintain?

I agree that especially the ZLIB part is ugly. But I had to work with what I had; I encourage you to go read the upstream `FindOpenSSL` and `FindZLIB` modules to double-check what they make available to you. There are quite some differences between the two, but the end result is that it is much simpler to write robust code to find the DLL with what `FindOpenSSL` provides than `FindZLIB`. I'm convinced this is the simplest possible way to handle the information given by `FindZLIB` and find the `.DLL` robustly, but if you have suggestions for improvement, I'd be glad to hear it. Anyway, tucking this away in its own file as suggested above in a review will at least keep its ""monstrosity"" out of sight and more manageable.

Now, for more specific answers:

> - What if we need to add another dependency?

Best case: it is a ""good citizen"" like libtorrent, and we can just add `""$<TARGET_FILE:libfoo::foo>""` to the `add_custom_command(TARGET qbt_app POST_BUILD COMMAND ""${CMAKE_COMMAND}"" -E copy_if_different ...)` call.

Medium case: we have to add code similar to the case for OpenSSL (maybe even slightly simpler)

Worst case: code similar to the case for ZLIB.

In practice, I don't expect we'll add any new dependency any time soon, and by the time we do, we'll have already transitioned to the simpler built-in way of CMake >= 3.21 that I plan to change to later.

> - What about dependency dependencies? What if one of them adds a new dependency in the future?

With the current implementation, we'd have to handle transitive dependencies ourselves. Not ideal, but doable (I'd fully commit to doing that if were needed!).

In practice, the only thing we currently use that has a bunch of transitive dependency DLLs is Qt, and that is entirely handled by `windeployqt.exe`.

Also, again, I don't expect we'll add any new dependency with transitive dependencies any time soon, and by the time we might do so, we'll have already transitioned to the CMake >= 3.21 method, which, as you can read in the documentation, handles transitive dependencies for you."
840409112,14959,xavier2k6,2021-05-13T08:32:58Z,"My own 2 cents in relation to bumping minimum required to CMake 3.20 should only be done when MSVC 2019 officially/natively supports it & **it will** in the next update. (They may even go to 3.21)

#### Similar to when dependencies were bumped boost/libtorrent
ref:https://github.com/qbittorrent/qBittorrent/pull/13511#issuecomment-710060113

serendipitously: `Boost` can now be raised to `1.66` for libtorrent 2.0 series as Ubuntu 18.04 support has now been dropped! (since 4.3.4)

If CMake minimum is changed now, the wiki will have to be changed to reflect what needs to be done in order to compile from source for those of us that do it the `legacy` way
____

I think it would be more beneficial to update `appveyor` to MSVC 2019 (seperate to this PR obviously) as it brings [AddressSanitizer](https://docs.microsoft.com/en-us/cpp/sanitizers/asan?view=msvc-160)

References:
[Address Sanitizer for MSVC Now Generally Available](https://devblogs.microsoft.com/cppblog/address-sanitizer-for-msvc-now-generally-available/)
[Finding Bugs with AddressSanitizer: MSVC Compiler](https://devblogs.microsoft.com/cppblog/finding-bugs-with-addresssanitizer-msvc-compiler/)
[Finding Bugs with AddressSanitizer: Patterns from Open Source Projects](https://devblogs.microsoft.com/cppblog/finding-bugs-with-addresssanitizer-patterns-from-open-source-projects/)
[AddressSanitizer for Windows: x64 and Debug Build Support](https://devblogs.microsoft.com/cppblog/asan-for-windows-x64-and-debug-build-support/)"
840477816,14959,FranciscoPombal,2021-05-13T10:47:41Z,"@xavier2k6 

> My own 2 cents in relation to bumping minimum required to CMake 3.20 should only be done when MSVC 2019 officially/natively supports it & **it will** in the next update. (They may even go to 3.21)
> #### Similar to when dependencies were bumped boost/libtorrent

This is a very different case than bumping boost/libtorrent. I know I'm repeating myself, but: CMake is a very simple **stand-alone tool** to install separately (either with an installer or zip).  Just like other similar cases like ninja, nasm, etc. We should not have to wait until version X of such tools is bundled with some other software package Y.

> ref:[#13511 (comment)](https://github.com/qbittorrent/qBittorrent/pull/13511#issuecomment-710060113)
> 
> serendipitously: `Boost` can now be raised to `1.66` for libtorrent 2.0 series as Ubuntu 18.04 support has now been dropped! (since 4.3.4)

I believe we can at least bump it to `1.71` even, since that is what is supported in 20.04: https://packages.ubuntu.com/focal/libboost-all-dev, but that is off-topic here.

> If CMake minimum is changed now, the wiki will have to be changed to reflect what needs to be done in order to compile from source for those of us that do it the `legacy` way

I think you are confusing things. The ""legacy"" way is https://github.com/qbittorrent/qBittorrent/wiki/Compiling-with-MSVC-2019-(static-linkage). The ""new"" way is https://github.com/qbittorrent/qBittorrent/wiki/Compilation:-Windows-(MSVC-2019,-64-bit,-static-linkage), which has recommended installing the latest CMake version for some time now. I just looked at the wiki page, and I realize it's probably better to change the wording to reflect the fact that the installer is also a viable option and more than sufficient.

> I think it would be more beneficial to update `appveyor` to MSVC 2019 (seperate to this PR obviously) as it brings [AddressSanitizer](https://docs.microsoft.com/en-us/cpp/sanitizers/asan?view=msvc-160)
> 
> References:
> [Address Sanitizer for MSVC Now Generally Available](https://devblogs.microsoft.com/cppblog/address-sanitizer-for-msvc-now-generally-available/)
> [Finding Bugs with AddressSanitizer: MSVC Compiler](https://devblogs.microsoft.com/cppblog/finding-bugs-with-addresssanitizer-msvc-compiler/)
> [Finding Bugs with AddressSanitizer: Patterns from Open Source Projects](https://devblogs.microsoft.com/cppblog/finding-bugs-with-addresssanitizer-patterns-from-open-source-projects/)
> [AddressSanitizer for Windows: x64 and Debug Build Support](https://devblogs.microsoft.com/cppblog/asan-for-windows-x64-and-debug-build-support/)

Again, off-topic, but I don't care about Appveyor (or Travis) at all. In fact, I've expressed my dislike for having to deal with many different CI services and maintain the scripts, their different syntaxes and software stacks. GitHub Actions is just better than both, and can do everything we would ever need. As for the (very legitimate) concern of vendor lock-in: I would argue that if we are ever in that position, it is easier to migrate to greener pastures if we only have to translate/migrate from a single service (and in the meantime, if we are really worried about it, we could take defensive measures, such as doing everything with shell commands, instead of using ""built-ins"" of the service or 3rd-party Actions). Not that I think this is a realistic concern anyway; I believe that fortunately, the industry is moving towards more interoperability and standardization in this field."
840724086,14959,FranciscoPombal,2021-05-13T17:49:32Z,"@Chocobo1

I have addressed all your review comments. Still unsure what you ended up deciding about the `_LIST` rename, that's why I mentioned you in that review and did not mark it as resolved yet.

~Now the only thing left to do is:~

> ~Perhaps you should add installation step to windows builds on github actions.~

~Which will be pushed shortly.~

Done.

I'll leave setting up a workflow for the dynamic builds for another PR though (unless you insist it should be done in this one).

~EDIT: actually, I just noticed I have https://github.com/qbittorrent/qBittorrent/pull/14959#discussion_r631051521 left to address as well.~ Deferred to another PR: https://github.com/qbittorrent/qBittorrent/pull/14959#issuecomment-840733187"
840733187,14959,FranciscoPombal,2021-05-13T18:04:44Z,"@Chocobo1 

> EDIT: actually, I just noticed I have https://github.com/qbittorrent/qBittorrent/pull/14959#discussion_r631051521 left to address as well.

Since this PR is about Windows builds and general cleanup, I think it's best to defer the investigation and resolution of that Linux-specific problem to another PR.

~I also just noticed I forgot to factor out the new code into its own module, will do it shortly, sorry for that.~ EDIT: Done."
840736324,14959,xavier2k6,2021-05-13T18:09:53Z,"@FranciscoPombal 

>I think you are confusing things. The ""legacy"" way is https://github.com/qbittorrent/qBittorrent/wiki/Compiling-with-MSVC-2019-(static-linkage). The ""new"" way is https://github.com/qbittorrent/qBittorrent/wiki/Compilation:-Windows-(MSVC-2019,-64-bit,-static-linkage), which has recommended installing the latest CMake version for some time now. I just looked at the wiki page, and I realize it's probably better to change the wording to reflect the fact that the installer is also a viable option and more than sufficient.

I am not confusing things, I believe you are - hence why I said for those of us that do it the legacy way. 

I compile using that **legacy guide**  https://github.com/qbittorrent/qBittorrent/wiki/Compiling-with-MSVC-2019-(static-linkage) & will continue to do so in future.......your CMake bump will have a negative impact (from what I can see & I'm open to correction on this) for how I choose to compile from source........I will be ""forced"" to add extra steps (which as I suggested will have to be documented on the **legacy guide** wiki) to how I choose to do things while compiling or wait for MSVC 2019 16.10 to be released officially or use a ""preview"" version.

One of the reasons, I choose to compile via **legacy** is the fact that the new way via vcpkg isn't always ideal as seen with libtorrent port not having latest commit....Boost 1.76 & even Qt 6.1.0 still isn't officially available via vcpkg etc. etc.
(WIP, I know!)

>but I don't care about Appveyor (or Travis) at all. In fact, I've expressed my dislike for having to deal with many different CI services and maintain the scripts, their different syntaxes and software stacks.

Why then have you created a PR to update Appveyor on libtorrent to MSVC 2019 & a CMake improvement there also but only bump it to **CMake 3.17**? (Why not go to CMake **3.20** there?)"
840772725,14959,FranciscoPombal,2021-05-13T19:11:34Z,"@xavier2k6 

> @FranciscoPombal
> 
> > I think you are confusing things. The ""legacy"" way is https://github.com/qbittorrent/qBittorrent/wiki/Compiling-with-MSVC-2019-(static-linkage). The ""new"" way is https://github.com/qbittorrent/qBittorrent/wiki/Compilation:-Windows-(MSVC-2019,-64-bit,-static-linkage), which has recommended installing the latest CMake version for some time now. I just looked at the wiki page, and I realize it's probably better to change the wording to reflect the fact that the installer is also a viable option and more than sufficient.
> 
> I am not confusing things, I believe you are - hence why I said for those of us that do it the legacy way.
> 
> I compile using that **legacy guide** https://github.com/qbittorrent/qBittorrent/wiki/Compiling-with-MSVC-2019-(static-linkage) & will continue to do so in future.......your CMake bump will have a negative impact (from what I can see & I'm open to correction on this) for how I choose to compile from source........I will be ""forced"" to add extra steps (which as I suggested will have to be documented on the **legacy guide** wiki) to how I choose to do things while compiling or wait for MSVC 2019 16.10 to be released officially or use a ""preview"" version.

No, it is you who are confused, but now I understand why. Legacy way == ""building with qmake/autotools""; new way == ""building with CMake"". It has nothing to do with whether the builds are dynamic or static. This PR simply improves the installation code for _both_ static and dynamic builds when building with the ""new way"", and improves the build/post build for dynamic builds in the ""new way"" as well. https://github.com/qbittorrent/qBittorrent/wiki/Compiling-with-MSVC-2019-(static-linkage) did _not_ become legacy. Dynamic builds that ""just work"" are now a viable alternative, that's all. You'll notice that there is a stub on the wiki home that reads `Windows (MSVC 2019, dynamic linkage) TODO`. It has been like that for a long time, but after this is merged, I plan to write it up :).

As for the extra steps: the existing guides have always recommended using the latest available CMake version, so that's not the case. And even if it were, the steps are trivial: just run a simple installer, or unpack a zip and optionally add to `PATH`. There is no reason to rely on the version of such tools bundled with other software suites, be they VS, Qt creator, etc.

> One of the reasons, I choose to compile via **legacy** is the fact that the new way via vcpkg isn't always ideal as seen with libtorrent port not having latest commit....Boost 1.76 & even Qt 6.1.0 still isn't officially available via vcpkg etc. etc.
> (WIP, I know!)

Again, ""legacy way"" has nothing to do with whether you use `vcpkg` or not. When testing this out, I used both `vcpkg` and a full stack of manually compiled dependencies. No one wants to ""deprecate"" building qBittorrent without `vcpkg`.

> Why then have you created a PR to update Appveyor on libtorrent to MSVC 2019 & a CMake improvement there also but only bump it to **CMake 3.17**? (Why not go to CMake **3.20** there?)

Is this some veiled accusation of hypocrisy? The reason was because it was a prerequisite/blocker to something more urgent that I wanted to solve. I chose to be pragmatic and just deal with the path of least resistance. You should judge the reasons for bumping the version _in this project_ on its own technical merits, not resort to such whataboutisms about how things are done in other projects and why.

The time we all have collectively wasted arguing whether CMake versions should be bumped or not and how ""inconvenient"" is is to update must be worth around 1000 lifetimes of installing/updating CMake by now."
840807944,14959,xavier2k6,2021-05-13T20:17:07Z,"@FranciscoPombal Thank you for expanding on your reasoning & alleviating possible concerns I have.

>Is this some veiled accusation of hypocrisy?

Certainly not!!

I could've rephrased it more appropriately to something like can you explain your reasoning or how come that's done differently there than here. etc.

It was meant merely as a request for myself to have a better overall understanding of this project & it's dependencies/how one differs to the other or how there may be compatibility issues like compiling one with C++14 & another requires C++17 - where both should be compiled with same version etc. (Hope I've expressed what I mean correctly??)

I'm not insinuating/implying or attacking anybody here directly/in-directly - let's be straight about that.

(If I wanted to call you out as a hypocrite - I'd call you straight out!)

I'm merely having a dialogue to better understand.....end of. (To me this is a healthy thing)

I'm in no way intentionally holding up this PR from being merged........My questioning etc can easily be dismissed by other members who have merging abilities etc."
840836761,14959,FranciscoPombal,2021-05-13T21:10:37Z,"@xavier2k6 

> @FranciscoPombal Thank you for expanding on your reasoning & alleviating possible concerns I have.

:+1: No problem, it became clear to me that it was just an honest misunderstanding about what ""legacy"" meant.

> Certainly not!!
> 
> I could've rephrased it more appropriately to something like can you explain your reasoning or how come that's done differently there than here. etc.
> 
> It was meant merely as a request for myself to have a better overall understanding of this project & it's dependencies/how one differs to the other or how there may be compatibility issues like compiling one with C++14 & another requires C++17 - where both should be compiled with same version etc. (Hope I've expressed what I mean correctly??)
> 
> I'm not insinuating/implying or attacking anybody here directly/in-directly - let's be straight about that.
> 
> (If I wanted to call you out as a hypocrite - I'd call you straight out!)
> 
> I'm merely having a dialogue to better understand.....end of. (To me this is a healthy thing)

I appreciate your understanding and honesty (especially this part: ""(If I wanted to call you out as a hypocrite - I'd call you straight out!)"" :)), and I must apologize - the presumption of guilt is 100% on me. It's just that this PR has generated a much more drawn-out and heated discussion that I'd hoped for. I have also been arguing the same exact points over and over for a long time now, and I'm tired of that: that this PR in no way impacts existing workflows (and if it did, that I'd be more than willing to resolve that issue); and that the QoL improvements that I argue about are valid and shouldn't be dismissed by others just because they are used to a different (also valid) way of doing things.

Fortunately now it seems that the conversation has become much more productive - some legitimate concerns about reliability and maintainability were raised, which I have addressed. And I'm ready to address any other such concerns that pop up. I also had time to address the initial (and very welcome) review.

> I'm in no way intentionally holding up this PR from being merged........My questioning etc can easily be dismissed by other members who have merging abilities etc.

:+1: You are of course well within your right to complain and suggest improvements if you think some other person (such as me) posts a PR that would very negatively impact your (and others') workflow. This is not the case here, and I understand that you just misunderstood the situation.

What really bothers me is when someone (this is not directed at you now, it's in general) argues that requiring such a thing as a trivial update to some tool like CMake, ninja, nasm, etc as part of a PR is a huge deal-breaker for otherwise very tangible real-world benefits, and suggest waiting X weeks/months/years as an alternative just because they refuse to do a simple task of toolset maintenance, which is the developer equivalent of a mechanic not caring for- and not replacing their broken screwdrivers and wrenches. These things shouldn't have to be uphill battles every time."
840845496,14959,FranciscoPombal,2021-05-13T21:27:45Z,"About this force push: passing `--no-angle` to `windeployqt` fixes a potential build failure with Qt5 (for example, when using vcpkg). `angle` is a purely optional runtime dependency that we have no use for at all, and this workaround won't be needed anymore in Qt 6. See https://github.com/microsoft/vcpkg/issues/17840#issuecomment-839828164 for more info."
845085424,14959,sledgehammer999,2021-05-20T12:50:25Z,"I agree with the first comments of @glassez and @Chocobo1. A build step should just build the source and give out the executable. Dependency gathering/installation should be done by another target which is requested by the user (eg `make install` or `make package` or `make install_deps`).
The standard way of doing things is for `make` to just build the executable. Nothing more nothing less.
A developer is expected to know about setting up library search paths for his dev environment (IDE or cli).

If the purpose is to make it easier for newbies to get started, then maybe make it a separate explicit option like ""gather deps"" or ""modify PATH to include dependencies"".
And to be frank, I am not entirely convinced we should go out of our way to ease the newbies for this particular problem. If a newbie doesn't know about LIB SEARCH PATHS I really doubt that he will be able to contribute meaningfully in the codebase. If he can navigate the codebase, find the correct place to fix a bug and actually being able to code it, then there is very much high chance that he understands about lib search paths.

Lastly, one problem I can see with copying the deps is: For example, user builds newer libtorrent but his build continues to use the copied old version and he wonders why he can't see the fix that is in the new libtorrent.

For all the above I assumed that
> now copied to the build directory as a post-build step

means that the post-build step is done automatically after each build and it doesn't require any other action from the user"
845123305,14959,FranciscoPombal,2021-05-20T13:30:08Z,"@sledgehammer999 

Thanks for chiming in on this.

> For all the above I assumed that
> 
> > now copied to the build directory as a post-build step
> 
> means that the post-build step is done automatically after each build and it doesn't require any other action from the user

Yep. Also, CMake automatically copies the files if they are updated (that's the whole purpose of `copy_if_different`). So the following is not really a concern:

> Lastly, one problem I can see with copying the deps is: For example, user builds newer libtorrent but his build continues to use the copied old version and he wonders why he can't see the fix that is in the new libtorrent.

> And to be frank, I am not entirely convinced we should go out of our way to ease the newbies for this particular problem.

OK, I don't know what to say anymore. This is not just ""to help newbies"". Many actually expect that their Windows build system copies the necessary runtime deps to the build folder, so that the build folder becomes equivalent to a user installation. I have posted multiple links showing that. Check out the multiple links I posted above corroborating this, including the links to the CMake issue tracker posts where even one of the lead CMake maintainers (clearly not a ""newbie"") states this is the way they do things (https://gitlab.kitware.com/cmake/cmake/-/issues/20417#note_707008), and an upcoming feature in 3.21 is focused on improving this exact workflow (https://gitlab.kitware.com/cmake/cmake/-/merge_requests/5837):

> Typically we handle that by setting `CMAKE_RUNTIME_OUTPUT_DIRECTORY` to a value fixed for all targets so they can run from the build tree on Windows by simply putting .dll and .exe files next to one another. (...)

It seems many people here are just used to a single way of doing things, and can't accept that other people prefer another way. And I really don't understand the attitude of ""this does not affect me at all, but I still don't want this implemented even though it benefits a bunch of people"".
Even for me it is more convenient when building on a new VM/machine where I might not already have everything set up the way I like.

However, since there is so much opposition to this, I'm willing to compromise on gating this change behind an option which is _disabled by default_, as you suggested:

> If the purpose is to make it easier for newbies to get started, then maybe make it a separate explicit option like ""gather deps"" or ""modify PATH to include dependencies"".

Would you accept that then?"
845160470,14959,glassez,2021-05-20T14:13:00Z,"> > If the purpose is to make it easier for newbies to get started, then maybe make it a separate explicit option like ""gather deps"" or ""modify PATH to include dependencies"".
> 
> Would you accept that then?

Implementing it as an option was suggested you at very beginning of this PR discussion so it's you who ""can't accept that other people prefer another way"".

A bit of sarcasm:
I wonder how people have been developing on Windows for several decades and haven't suffered from this problem... Or until this time, there was no such brilliant developer who would fix it in this way? (the questions are rhetorical, so you don't have to answer them.)"
845196122,14959,FranciscoPombal,2021-05-20T14:57:30Z,"@glassez 

> Implementing it as an option was suggested you at very beginning of this PR discussion so it's you who ""can't accept that other people prefer another way"".

Not quite, this is what I said:

> _If_ this disrupts your existing workflows in some way, this can simply be gated behind a feature option that is `OFF` by default, e.g. (`COPY_RUNTIME_DEPS_TO_BUILDIR`). It would be similar in spirit to the current `MSVC_RUNTIME_DYNAMIC` option, no need to put it into a separate `contrib` directory.

So far no one has told me if/how this disrupts their existing workflow, so I considered going the option route redundant and wasteful. I have repeatedly said that I'm more than willing to work out solutions to any possible disruption. I don't think there is any point in insisting further though, maybe something is getting lost in translation - if gating this behind an off-by-default option is the only way this is getting this in at this point, then so be it.

> A bit of sarcasm:
> I wonder how people have been developing on Windows for several decades and haven't suffered from this problem... Or until this time, there was no such brilliant developer who would fix it in this way? (the questions are rhetorical, so you don't have to answer them.)

You wouldn't have to ask these questions (rhetorically or not) if you had checked out the links that I posted earlier. But that doesn't matter now, lets wrap this up...

Any suggestions for the name of the option? Personally I prefer the first one, it is only shown if the user is compiling for Windows (either MSVC or MinGW) anyway, so I guess including `WIN`/`WINDOWS` in the name is redundant:

- `COPY_RUNTIME_DEPS_TO_BUILDIR`
- `WIN_COPY_DEPS_TO_BUILDDIR`
- `WIN_COPY_RUNTIME_DEPS_TO_BUILDDIR`"
847076677,14959,FranciscoPombal,2021-05-24T14:21:52Z,"@glassez ping, just need some final input to make the final changes (gating this behavior behind an off-by-default option) and get this ready.

> (...) lets wrap this up...
> 
> Any suggestions for the name of the option? Personally I prefer the first one, it is only shown if the user is compiling for Windows (either MSVC or MinGW) anyway, so I guess including `WIN`/`WINDOWS` in the name is redundant:
> 
> * `COPY_RUNTIME_DEPS_TO_BUILDIR`
> 
> * `WIN_COPY_DEPS_TO_BUILDDIR`
> 
> * `WIN_COPY_RUNTIME_DEPS_TO_BUILDDIR`

"
847082815,14959,glassez,2021-05-24T14:31:41Z,"`COPY_RUNTIME_DEPS_TO_BUILDIR` is the best of the suggested options. `WIN_` is unnecessary, because this option is still not available on other platforms."
847093205,14959,FranciscoPombal,2021-05-24T14:48:19Z,"@glassez 

> `COPY_RUNTIME_DEPS_TO_BUILDIR` is the best of the suggested options. `WIN_` is unnecessary, because this option is still not available on other platforms.

Thanks, done. Also reworded the commit description for the relevant commit."
848569988,14959,xavier2k6,2021-05-26T08:19:36Z,"**MSVC 2019 16.10.31321.278** has been officially released now, it **includes CMake 3.20**"
852361123,14959,FranciscoPombal,2021-06-01T18:45:31Z,@glassez @Chocobo1 All done.
854742255,14959,glassez,2021-06-04T13:56:20Z,"> **MSVC 2019 16.10.31321.278** has been officially released now, it **includes CMake 3.20**

Qt still ships CMake 3.19."
854744792,14959,FranciscoPombal,2021-06-04T14:00:06Z,"@glassez 

> Qt still ships CMake 3.19.

Is that supposed to be a blocker for this?"
863164211,14959,glassez,2021-06-17T11:35:20Z,"> @glassez
> 
> > Qt still ships CMake 3.19.
> 
> Is that supposed to be a blocker for this?

Yes, of course.
Or do you think it's acceptable to bring convenience to someone at the expense of causing inconvenience to someone else? There is nothing critical if this PR waits until Qt Installer provides CMake 3.20."
863269317,14959,FranciscoPombal,2021-06-17T14:06:08Z,"@glassez 

> Yes, of course.
Or do you think it's acceptable to bring convenience to someone at the expense of causing inconvenience to someone else? There is nothing critical if this PR waits until Qt Installer provides CMake 3.20.

Are you seriously complaining about the ""inconvenience"" of installing CMake 3.20? It is no inconvenience at all, either run a simple installer or extract a zip and add executables to `PATH`.

IMO, someone's unwillingness to do something so trivially simple as using an up-to-date CMake version should not come before the benefits that using such version brings for everyone else.

I would understand your position if CMake were difficult/painful to setup correctly standalone. For example, I quite appreciate the fact that the Qt installer provides pre-built OpenSSL binaries, which are a pain to build from source on Windows (although using vcpkg can ease that pain a little). But this is not the case for CMake at all, so you should not depend on the Qt installer (or any other 3rd party tool, Android Studio also comes to mind here) for your CMake installation, you should take care of it yourself.

EDIT: also you could install CMake 3.20 from the VS installer..."
863286310,14959,glassez,2021-06-17T14:26:14Z,"@FranciscoPombal 
I was sure you'd say something like that. So I didn't want to say anything to your previous comment. But the interest to confirm my guess prevailed.
>either run a simple installer or extract a zip and add executables to PATH.

Just do the same with qBittorrent runtime dependencies and let's bury this ""feature"".
Otherwise, please just wait until Qt installer updates the CMake version."
863287125,14959,glassez,2021-06-17T14:27:16Z,"> EDIT: also you could install CMake 3.20 from the VS installer...

Does VS installer provide Ninja as well?"
863517654,14959,FranciscoPombal,2021-06-17T19:48:22Z,"@glassez 

> Does VS installer provide Ninja as well?

Yes, and currently it is even the latest version (`1.10.2`). The package name is ""C++ CMake tools for Windows"" I think."
863525051,14959,FranciscoPombal,2021-06-17T20:01:29Z,"@glassez 

> @FranciscoPombal
> I was sure you'd say something like that. So I didn't want to say anything to your previous comment. But the interest to confirm my guess prevailed.
> 
> > either run a simple installer or extract a zip and add executables to PATH.
> 
> Just do the same with qBittorrent runtime dependencies and let's bury this ""feature"".
> Otherwise, please just wait until Qt installer updates the CMake version.

And I, in turn, was sure _you_ would say something like this, perhaps thinking that you've successfully ""trapped"" me with that false equivalency.

It is amusing (or maybe just sad) that you think the ""trouble"" of installing CMake the normal, trivial way somehow even comes close to ""cancel out"" the benefits provided by this PR.

It is truly amazing (and definitely sad) how difficult it is to add features that improve automation of common development tasks in this project, to improve developer UX among other things.

Also, as I have said before:

> Regardless of matters related to development setup, copying the remaining runtime DLLs to the build directory is a prerequisite to make installation trivial.

Making installation easier makes it easier to implement it in CI, as well as automated packaging. You seem to think I'm some kind of crazy person for wanting stuff like this, but other people have similar ideas and wishes: https://github.com/qbittorrent/qBittorrent/pull/15093#issuecomment-862705791. But no, by the looks of it, we'll be doing un-auditable, manual releases on an unpredictable schedule and with an at best partially documented process well into the 2030's."
864377396,14959,glassez,2021-06-19T08:46:38Z,"@FranciscoPombal 
_It seems that your problem is that you never doubt that you are right, and when your opinion is questioned, you do your best to find evidence that you are right. Often it comes down not to formal proofs, but simply to searching for like-minded people and quoting them, etc. If I'm right, and this is true, then let's just end this discussion and everyone will have their own opinion. (because you don't care about mine, do you?)
If the above is not valid, then let's try to continue._

**I'm really trying to find proof that this is a really useful thing** (although you may not believe me). 
That's how I understand it.
To begin with, ""copying all dependencies to the build folder on each build"" instead of ""one-time setting of environment variables"" is inherently irrational. Even the fact that the actual copying does not happen every time, but only after checking the files for changes, does not cancel its irrationality. After all, doing something (quite trivial for someone who decided to build an application) once looks much more rational than doing something with each build! Of course, you will object that the user have to manually set the environment variables, _which is extremely difficult, etc._, and the copying is performed by the build system behind the scene and does not bother the user. But, as I mentioned in passing above, this should not be a problem for a user who decides to build an application on his own for the purpose of testing and debugging it, otherwise his mental abilities cause great doubt that he should do this at all. And besides, it does still bother the user, if we are talking specifically about the developer, as users of the build system, who can invoke the build quite often, so even a few extra seconds that it will spend each time checking/copying dependencies can greatly irritate him.
(The above gives me enough reason to make this feature at least optional and disabled by default.)

Let's move on...
Well, maybe it has some other advantage that could offset its shortcomings? We'll see...
>copying the remaining runtime DLLs to the build directory is a prerequisite to make installation trivial

Could it be this? It does ""make installation trivial"" by simply moving the execution of all non-trivial actions from the installation step to the build step! This is obviously illogical, because the build step is performed much more often than the installation step, and most of the build cases do not imply further installation (if we are talking about developers workflow). In addition, it is not clear why it is impossible to still have this non-trivial logic where it is really required (in installation procedure)?
Sorry, I didn't find any proof why copying runtime dependencies to a single location **exactly at the build step** makes the installation process easier.



> You seem to think I'm some kind of crazy person for wanting stuff like this, but other people have similar ideas and wishes: [#15093 (comment)](https://github.com/qbittorrent/qBittorrent/pull/15093#issuecomment-862705791). But no, by the looks of it, we'll be doing un-auditable, manual releases on an unpredictable schedule and with an at best partially documented process well into the 2030's.

This does not apply to this topic at all. No need to abuse it.
I really like the idea of an automated build, so releasing the next version would just be adding a tag to the repository.
What I don't like is the way that is suggested in this PR.
"
864569453,14959,FranciscoPombal,2021-06-20T15:14:07Z,"@glassez 

> @FranciscoPombal
> _It seems that your problem is that you never doubt that you are right,

Wrong :)

> and when your opinion is questioned, you do your best to find evidence that you are right.

Yes, I substantiate my arguments. That's a bad thing?

> Often it comes down not to formal proofs, but simply to searching for like-minded people and quoting them, etc.

You keep insisting on some vague notion of ""formal proofs"" in contexts where it does not make much sense. This is not a mathematical discussion. This is about conventions and making development experience easier. In some cases (such as this one) substantiating ones position by showing that many others do the same thing **is** the ultimate form proof that you need. Unless you are doing some really weird/novel thing (which is not the case for qBittorrent, it is a relatively simple GUI download manager), it is a good thing to do certain things the same tried and true way that others do it. See https://en.wikipedia.org/wiki/Convention_over_configuration.

Of course ""many people do it X way, so we should also do it"" is a very dangerous way to think _in general_, and I'm sure you agree with that. But, in this case and others, it is a good thing to do the ""standard"" thing and/or the thing that many people request to be done a certain way.

> If I'm right, and this is true, then let's just end this discussion and everyone will have their own opinion. (because you don't care about mine, do you?) If the above is not valid, then let's try to continue._

I do care about your opinion, otherwise I wouldn't bother engaging with you. It is valuable to engage with people with different perspectives.

> **I'm really trying to find proof that this is a really useful thing** (although you may not believe me).
> That's how I understand it.

I believe you. The thing is, you seem to think I'm trying to convince you that this is a ""really useful thing"" _for you_. That is not what I'm trying to do. This might in fact never be useful _for you_, and that's completely fine. You might also find in the future that this turns out to be useful for you and that's fine as well.

What I'm trying to say is that this is useful for many others (and I believe I have provided enough evidence of this), while not breaking _your_ existing workflow. I'm not trying to convince _you_ that this will change your life. What I have trouble understanding is your opposition to something that can clearly benefit many people while not impacting you at all. From a utilitarian perspective, it is a clear-cut improvement - it has an upside and no downside. And no, I don't thing requirink a simple upgrade to CMake counts as a downside - if you do, I guess we just agree to disagree here. Everyone has to have CMake installed and updated anyway.

I probably wouldn't even have considered submitting a PR if the changes I proposed implied telling a bunch of existing contributors/team members ""hey, remember how you used to do things? Well from now on you'll have to do it this way"". A big selling point of this PR IMO is that no one is forced to do anything any differently.

> To begin with, ""copying all dependencies to the build folder on each build"" instead of ""one-time setting of environment variables"" is inherently irrational. Even the fact that the actual copying does not happen every time, but only after checking the files for changes, does not cancel its irrationality. After all, doing something (quite trivial for someone who decided to build an application) once looks much more rational than doing something with each build! Of course, you will object that the user have to manually set the environment variables, _which is extremely difficult, etc._, and the copying is performed by the build system behind the scene and does not bother the user. But, as I mentioned in passing above, this should not be a problem for a user who decides to build an application on his own for the purpose of testing and debugging it, otherwise his mental abilities cause great doubt that he should do this at all.

You keep centering your argument around ""my preferred way of doing things is not difficult, so the others are invalid"". This is very obviously not about sufficient mental faculties. Of course anyone could do it your way. It's just that clearly many people _prefer_ to do things another way. The reasons for this can be various, and if the implementation does not impact you negatively, why stop it? For example, consider the case of users who are involved in many different projects - they might not wish to deal with an env var jungle in their systems, and might prefer to have each project more self-contained rather than have them leak stuff to the system's environment. Or even just dealing with environment variables at the project level - some just appreciate the convenience of not having to fiddle environment variables, the build system does the tedious work for them.

>And besides, it does still bother the user, if we are talking specifically about the developer, as users of the build system, who can invoke the build quite often, so even a few extra seconds that it will spend each time checking/copying dependencies can greatly irritate him.
> (The above gives me enough reason to make this feature at least optional and disabled by default.)

Now this is an instance of an argument that _does_ require ""formal proofs""/hard data to substantiate - extraordinary claims require extraordinary proof. The burden of proof is on you to supply profiling data showing how this adds ""a few extra seconds"" (a simple average of three `$ time cmake ...` runs or equivalent should be enough to get started). This is absolutely not something that adds ""a few extra seconds"". This adds a few milliseconds _at worst_. Absolutely no one will notice it.

> Let's move on...
> Well, maybe it has some other advantage that could offset its shortcomings? We'll see...

Again, I believe I've shown how the shortcomings you mentioned are nor really there (except for ""forcing"" you to update CMake, which again, we can agree to disagree on that one). And, more importantly, I've clarified how this does not impact your workflow, while being useful for others and that _I'm not trying to convince you (or others who prefer other workflows) to switch to this workflow_.

> > copying the remaining runtime DLLs to the build directory is a prerequisite to make installation trivial
> 
> Could it be this? It does ""make installation trivial"" by simply moving the execution of all non-trivial actions from the installation step to the build step! This is obviously illogical, because the build step is performed much more often than the installation step, and most of the build cases do not imply further installation (if we are talking about developers workflow). In addition, it is not clear why it is impossible to still have this non-trivial logic where it is really required (in installation procedure)?
> Sorry, I didn't find any proof why copying runtime dependencies to a single location **exactly at the build step** makes the installation process easier.

The thing is, CMake is moving towards making it trivial to do this way. Consider that in the new native feature that they are introducing in a future version, the use case I describe is exactly the example use case shown in the documentation: https://gitlab.kitware.com/cmake/cmake/-/merge_requests/5837/diffs#cad53f118ab22a5cf1bd8bea8eb4c9b39cbfa8dd_941_949. This is convenient for many people.

As for non-trivial logic: again, once CMake releases the new version with the `TARGET_RUNTIME_DLLS` genex, it will be possible to significantly simplify the code. You can be sure that I will submit a PR doing just that once that is possible (although you'll probably block it until VS/Qt includes the new updated CMake version... seriously man, just install it the regular way...).

I wish I had a good example at hand of how this in turn makes installation easier from some experiments I made, but I can't seem to find them right now... Regardless, you'll be able to see it once I submit such a PR... For now, feel free to ignore this argument about ""making installation easier"", my above points stand on their own just fine and are enough to justify this.."
864569961,14959,FranciscoPombal,2021-06-20T15:18:00Z,"@glassez 

>Well, I had to change my development environment to use the CMake installed by Visual Studio Installer (although it doesn't look as convenient as it was with Qt Installer).

I can assure you installing CMake with its own installer (or zip) is even more convenient, and means you're no longer dependent on a 3rd party bundling the most recent CMake version.

> So now merging this PR won't break my workflow.

It never did in any reasonable way. You were creating your own problems (incompatible CMake version) by refusing to install the most recent version the standard way, instead of through a 3rd-party bundle."
864570663,14959,FranciscoPombal,2021-06-20T15:23:01Z,"@glassez 

Small note:

> to make this feature at least optional and disabled by default.)

This is already the case, I have already agreed to this. This feature is gated behind the _optional, disabled by default_ `COPY_RUNTIME_DEPS_TO_BUILDIR` option, as discussed previously."
864584646,14959,glassez,2021-06-20T17:11:23Z,"> I can assure you installing CMake with its own installer (or zip) is even more convenient, and means you're no longer dependent on a 3rd party bundling the most recent CMake version.
> 
> > So now merging this PR won't break my workflow.
> 
> It never did in any reasonable way. You were creating your own problems (incompatible CMake version) by refusing to install the most recent version the standard way, instead of through a 3rd-party bundle.

To remove the issue of installing CMake once and for all, I will say the following. Until recently, we (the developers of qBittorrent and myself) had no need to have the latest version of CMake, since we used only the main features that have been available for a long time. And although I initially used the original CMake installer (and I had to install and configure Ninja manually, since it still doesn't have any installer), but I switched to using the Qt installer for this, as it was much more convenient, because it took care of most of the tools I needed. Naturally, I did not like that I had to lose this convenience in favor of some dubious feature from my point of view (besides, it only required its delay, and not complete rejecting so no one should have been hurt too much).
Most likely, I will still have to return to native installers, since you are predicting an ""incredibly bright future"" for the project, the onset of which requires the use of the most advanced CMake innovations. Well, we'll see... In reality, I will start taking this seriously only when our build system learns how to create an installation package for Windows (for a dynamically linked application as well)."
864637219,14959,FranciscoPombal,2021-06-21T00:23:05Z,"@glassez 

> To remove the issue of installing CMake once and for all, I will say the following. Until recently, we (the developers of qBittorrent and myself) had no need to have the latest version of CMake, since we used only the main features that have been available for a long time.

> Most likely, I will still have to return to native installers, since you are predicting an ""incredibly bright future"" for the project, the onset of which requires the use of the most advanced CMake innovations.

You say this as if this is simply a matter of ""needing"" the latest version or not, and as if ""we used only the main features that have been available for a long time"" is a _good_ thing/good practice/somthing to be proud of, as opposed to taking advantage of all it can offer you.

I hope to convince you this is not the case. CMake is one of those pieces of software where by convention, everyone _should_ use the latest version, always, as soon as possible. This is feasible to demand since it is very easy to install and keep updated. Other such minuscule ""inconvenience"" of installing it, there is no downside:

- CMake has a very strong commitment to backwards compatibility via the policies mechanism. Furthermore, regressions in new versions are incredibly rare thanks to their extensive test suite, and when they do happen, it's with some super obscure feature that is almost not used by anyone.
- If this convention is followed, you can always iterate fast on the build system scripts and never worry about using new, better features that are introduced to make your life easier. This also prevents ""ossification"" of the build scripts.

> (and I had to install and configure Ninja manually, since it still doesn't have any installer)

Fair point about having to install the Ninja binary manually. Fortunately, it's just one small executable. And there is yet more light at the end of the tunnel: hopefully all this nonsense will go away once `winget` becomes more widespread and integrated into Windows and finally brings it to the 21st century in terms of software installation management.

> Well, we'll see... In reality, I will start taking this seriously only when our build system learns how to create an installation package for Windows (for a dynamically linked application as well).

This is closer than you think :)."
864776355,14959,glassez,2021-06-21T06:51:58Z,"> You say this as if this is simply a matter of ""needing"" the latest version or not, and as if ""we used only the main features that have been available for a long time"" is a _good_ thing/good practice/somthing to be proud of, as opposed to taking advantage of all it can offer you.

It was just a statement of fact. No need to look for hidden subtext there."
864779673,14959,glassez,2021-06-21T06:58:32Z,"> And there is yet more light at the end of the tunnel: hopefully all this nonsense will go away once `winget` becomes more widespread and integrated into Windows and finally brings it to the 21st century in terms of software installation management.

I've been thinking about `winget`... But it will be ""yet another third-party installer"", which can only be a barrier if you want to have the latest versions of the software as soon as possible."
865246721,14959,FranciscoPombal,2021-06-21T18:19:17Z,"@glassez 

> It was just a statement of fact. No need to look for hidden subtext there.

I see that I assumed too much, my apologies. I though it was an attempted justification for staying behind.

> I've been thinking about `winget`... But it will be ""yet another third-party installer"", which can only be a barrier if you want to have the latest versions of the software as soon as possible.

No, that's scoop, chocolatey, and friends. I've got good news for you: Microsoft is really serious about `winget`, just like they are serious about other recent projects like `vcpkg` and the new Windows Terminal. In fact, the upcoming Windows 11 will ship _by default_ with the new Windows Terminal installed, and `winget` recently had its 1.0 release. The days of hunting for installers online or using 3rd party installation management tools on Windows will finally soon come to an end..."
865250370,14959,FranciscoPombal,2021-06-21T18:24:48Z,"@sledgehammer999 @Chocobo1 All done, any further comments?"
865269130,14959,glassez,2021-06-21T18:57:55Z,"> @sledgehammer999 @Chocobo1 All done, any further comments?

Note that I would not have approved it so easily if this feature was of my personal interest. Its implementation may raise a number of questions. But let those who intend to actually use it worry about it.
Fortunately, it should become more reliable when CMake implements `TARGET_RUNTIME_DLLS`."
865283442,14959,glassez,2021-06-21T19:19:17Z,"> Consider that in the new native feature that they are introducing in a future version, the use case I describe is exactly the example use case shown in the documentation: https://gitlab.kitware.com/cmake/cmake/-/merge_requests/5837/diffs#cad53f118ab22a5cf1bd8bea8eb4c9b39cbfa8dd_941_949. This is convenient for many people.

Fortunately, CMake does not force anyone to ""copy runtime dependencies to the build folder"". It don't even implement such features as optional one. All it does is make someone be able to get a list of such dependencies. This approach deserves my respect."
865342056,14959,FranciscoPombal,2021-06-21T21:03:35Z,"@glassez 

> Fortunately, CMake does not force anyone to ""copy runtime dependencies to the build folder"". It don't even implement such features as optional one. All it does is make someone be able to get a list of such dependencies. This approach deserves my respect.

Of course, but the fact that the example usage of the feature the official docs show is exactly the workflow that I describe should at least make you pause and ponder about its merits..."
874150041,14959,FranciscoPombal,2021-07-05T14:19:01Z,"@sledgehammer999 @Chocobo1 

Any further comments? This is ready."
881576383,14959,glassez,2021-07-16T16:37:33Z,"@FranciscoPombal
Well, CMake 3.21 is [here](https://cmake.org/cmake/help/v3.21/release/3.21.html). So I would like to see how you get rid of the existing crutches using `TARGET_RUNTIME_DLLS` expression."
885735879,14959,xavier2k6,2021-07-23T15:55:45Z,also ref.: https://github.com/microsoft/vcpkg/pull/18955
894793790,14959,Rootax,2021-08-08T12:56:58Z,"BTW, how long is the linking against qbt_webui.lib supposed to be when we follow your (incredible) wiki ? On a 10920x, it's at it for more than an hour now... But no error so I let it run for now..

EDIT : my bad; the wiki is working great, I messed up something..."
894803676,14959,glassez,2021-08-08T14:10:27Z,"> On a 10920x, it's at it for more than an hour now...

Doesn't seem to be correct..."
942163003,14959,xavier2k6,2021-10-13T10:35:52Z,"@glassez @Chocobo1 
I know there was concerns that Qt still only shipped `CMake 3.19` at the time & MSVC 2019 didn't have native support for `CMake 3.20` until `16.10.31321.278`.

Should we revise this update plan & perhaps implement 2/3 of these commits in a New PR:
```
CMake: bump minimum version to 3.20
CMake: Migrate to CheckSourceCompiles
CMake: clarify variable purpose and expansion
```

1. Update to `CMake 3.19` now. (""# TODO: migrate to CheckSourceCompiles in CMake >= 3.19"")
2. When releasing official qBittorrent with `Qt6` support (sometime next year probably...2nd LTS March 2022) bump to `CMake 3.21` 

**MSVC 2022** which will be **GA ~November 8th** & is `64-bit only` currently comes with `CMake 3.21` (**RC**)
_____
**Qt docs seem to suggest we use `CMake 3.21+`** at least for `Qt6.2+`
>#### CMake Versions
>- You need CMake 3.16.0 or later for most platforms (due to new AUTOMOC json feature).
>- You need CMake 3.17.0 to build Qt for iOS with the simulator_and_device feature.
>- You need CMake 3.17.0 + Ninja to build Qt in debug_and_release mode on Windows / Linux.
>- You need CMake 3.18.0 + Ninja to build Qt on macOS in debug_and_release mode when using frameworks.
>- You need CMake 3.18.0 in user projects that use a static Qt together with QML (cmake_language EVAL is required for running the qmlimportscanner deferred finalizer)
>- You need CMake 3.19.0 in user projects to use automatic deferred finalizers (automatic calling of qt_finalize_target)
>- You need CMake 3.21.0 in user projects that create user libraries that link against a static Qt with a linker that is not capable to resolve circular dependencies between libraries (GNU ld, MinGW ld)

Reference:
https://github.com/qt/qtbase/blob/dev/cmake/README.md#overview
_____
<html>
<body>
<!--StartFragment--><h3 id=""build-tools"" style=""margin: 1.5em 0px 0.75em; padding: 0px; border: 0px; font-size: 1.35em; vertical-align: baseline; font-weight: 300; color: rgb(64, 66, 68); font-family: &quot;Titillium Web&quot;, Arial, Helvetica, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"">Build Tools<a class=""plink"" href=""https://doc.qt.io/qt-6/windows-building.html#build-tools"" title=""Direct link to this headline"" style=""margin: 0px; padding: 0px 0px 0px 8px; border: 0px; font-size: 0.8em; vertical-align: baseline; color: rgb(23, 168, 26); text-decoration: none; transition: opacity 180ms ease-in-out 0s; opacity: 0; font-weight: 600;""></a></h3><div class=""table"" style=""margin: 0px; padding: 0px; border: 0px; font-size: 16px; vertical-align: baseline; overflow-x: auto; color: rgb(64, 66, 68); font-family: &quot;Titillium Web&quot;, Arial, Helvetica, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"">

Tool | Supported Versions | Description
-- | -- | --
CMake | Version 3.16 and newer (3.17 and newer for -debug-and-release builds 3.21 and newer for -static builds). | Required for configuring the Qt build. Available in the Qt Online Installer and on cmake.org.

</div><!--EndFragment-->
</body>
</html>

Reference:
https://doc.qt.io/qt-6/windows-building.html
____
### System Requirements
**All desktop platforms**
- CMake (>= 3.16, >= 3.18.4 for Ninja Multi-Config, >= 3.21.1 for static Qt builds in Qt 6.2+)

Reference:
https://wiki.qt.io/Building_Qt_6_from_Git"
392993248,9007,wesleybl,2018-05-30T00:37:58Z,@sledgehammer999  if I remove the disk where the torrent was downloaded and start the qbittorrent what will happen with the percentage completed? Will keep 100% but will indicate error?
393031892,9007,glassez,2018-05-30T05:07:02Z,"@sledgehammer999, well, great job!
Although, it requires more changes.
1. We need to return the correct components loading sequence (startupTorrents should again become a part of the initialization of the session, and not be called from outside).
2. Torrent-manipulation actions (e.g. add torrent, delete torrent) should be unavailable (or maybe queued) until session is fully initialized (i.e. resumed all torrents).
3. We no need more two signals (torrentAdded/torrentNew) since it will indicate the same event.
4. Some GUI components should be disabled until session is fully initialized (or unavailable in some other way, e.g. we can show no GUI or show progress dialog)."
393047815,9007,Chocobo1,2018-05-30T06:41:53Z,">Torrent-manipulation actions (e.g. add torrent, delete torrent) should be unavailable (or maybe queued) until session is fully initialized (i.e. resumed all torrents).

I agree with the idea, making it unavailable seems simpler.

>Some GUI components should be disabled until session is fully initialized (or unavailable in some other way, e.g. we can show no GUI or show progress dialog).

Since this is an interactive program, displaying no GUI would be a bad choice.
*If feasible*, I would choose to ready the mainwindow as early as possible (modern browsers startup time is impressive!) and let user know program is still initializing: could be some text in statusbar, or display the torrent jobs initially as ""not yet loaded"" and transition to other ready state (paused or downloading) when it is loaded.
"
393050725,9007,glassez,2018-05-30T06:55:24Z,">or display the torrent jobs initially as ""not yet loaded"" and transition to other ready state (paused or downloading) when it is loaded.

Session doesn't emit signals for resumed torrents in changed code, only one startupFinished signal, and I really like this idea."
393062538,9007,glassez,2018-05-30T07:42:31Z,">I agree with the idea, making it unavailable seems simpler.

We still need queuing at least for ""add torrent"" action since the application can start with torrents specified in command line. Of course, we can implement it outside the Session."
393381971,9007,sledgehammer999,2018-05-31T02:30:23Z,"I addressed some of the comments in my 3rd commit

I pushed 2 new commits. Now the initial loading of the torrents is done in a separate thread. However, for me, the mainwindow still takes quite a few seconds to draw its contents. The initial blank/white window is drawn quickly. The widgets are taking quite a few seconds.
The 2 new commits were written rather hastily with not enough testing. So rip them apart in the review."
393402683,9007,Chocobo1,2018-05-31T04:59:23Z,">Now the initial loading of the torrents is done in a separate thread. However, for me, the mainwindow still takes quite a few seconds to draw its contents. 

Haven't tried this PR yet, (for you) does it still take seconds to draw the GUI even when there are no torrents?"
393549003,9007,wesleybl,2018-05-31T14:28:57Z,"@sledgehammer999 I would like to test this PR in Windows. If I do:

```bash
./configure
make && make install
qbittorrent
```

on Linux and copying the files to Windows will work?"
393563171,9007,wesleybl,2018-05-31T15:11:20Z,">on Linux and copying the files to Windows will work?

In fact, I've seen it's more complicated than that:

https://github.com/qbittorrent/qBittorrent/wiki/Compiling-with-MSVC-2015-%28static-linkage%29

I'll try it on Linux."
393567335,9007,sledgehammer999,2018-05-31T15:23:45Z,"@wesleybl No. Linux binaries can't work on Windows and vice versa.
In any case I have prepared a Windows build of this PR. Use at your caution: https://builds.shiki.hu/temp/qbittorrent_4.2.0alpha_x64_PR_9007.7z"
393578389,9007,wesleybl,2018-05-31T15:51:37Z,"@sledgehammer999 

https://builds.shiki.hu/temp/qbittorrent_4.2.0alpha_x64_PR_9007.7z

It didn't work on my Windows 8.1 32 bits. Is there a 32 bits version?"
393650112,9007,sledgehammer999,2018-05-31T19:28:39Z,@wesleybl here's a 32-bit build: https://builds.shiki.hu/temp/qbittorrent_4.2.0alpha_x32_PR_9007.7z
393920748,9007,wesleybl,2018-06-01T15:43:11Z,"@sledgehammer999 I did the following test with https://builds.shiki.hu/temp/qbittorrent_4.2.0alpha_x32_PR_9007.7z:

```
1. I downloaded a torrent completely to an external disk.
2. I stopped the qbittorrent.
3. I Removed the external disk.
4. I started qbittorrent.
5. The qbittorrent stopped the torrent, indicated ""Files unavailable"" and the download percentage was 0%.
```
In this situation I do not think the percentage should be 0%. As the disk is not there, qbittorrent does not know if I deleted the file.

If I connect the disk without stopping the qbittorrent and clicking ""Resume"", it starts downloading the file from scratch. But the file is already there.

If I stop the qbittorrent before connecting the disk, it recognizes that the file is there and maintains 100%.

Another test I did:

```
1. I downloaded a torrent completely to an external disk.
2. I deleted the files without stopping qbittorrent.
3. It keep 100% but every time someone tries to download the file from me, it indicates an i/o error. Indicate this several times.
```
It doesn't download the file again. What a breakthrough. But I should indicate I/O error only once.

Another:

```
1. I downloaded a torrent completely to an external disk.
2. I stopped the qbittorrent.
3. I deleted the files.
4. I started qbittorrent.
5. The qbittorrent stopped the torrent, indicated ""Files unavailable"" and the download percentage was 0%.
```
This is expected behavior. Awesome!

Great work! Thank you!
"
393936371,9007,sledgehammer999,2018-06-01T16:33:03Z,"The 1st and 3rd test are essentially the same. In the point of view of the program, files are unavailable. Libtorrent doesn't differentiate between disk not reachable or files not there.
The progress stays 0% because at that point the ""torrent job"" is in an undetermined/undefined state. It needs both the files and the fastresume to indicate the progress.

The 2nd test is again limited by what libtorrent does. Libtorrent in the same session thinks that torrents are there even if they were deleted. Any failure is interpreted as a read error that might go away after a while."
393943696,9007,wesleybl,2018-06-01T16:59:23Z,"@sledgehammer999 I did the first test because I usually remove the external disk to copy files from it to another place, but I want to start qbittorrent to seeding files from other disks in the meantime. When I connect the external disk again, I want to continue seeding the torrents that are in it without having to check the files again (imagine that there are many torrents on the external disk).I think the qbittorrent would ideally indicate that the files are not there but keep 100%. So when I connect the disk I would only need to start the torrent with error, without it checking all. Anyway, I can solve this problem by stopping the qbitorrent before connecting the disk.

In the 2nd test the qbittorrent could be stop the torrent the first time it detected an I/O error."
393990985,9007,sledgehammer999,2018-06-01T19:50:23Z,">When I connect the external disk again, I want to continue seeding the torrents that are in it without having to check the files again (imagine that there are many torrents on the external disk).I think the qbittorrent would ideally indicate that the files are not there but keep 100%. So when I connect the disk I would only need to start the torrent with error, without it checking all.

We may be able to implement a workaround. When user presses ""resume"", we could  (behind the scenes) remove and re-add the torrent job so libtorrent can check again the fastresume and the data on disk. The only downside to this is that the torrent will probably lose its queue number.

"
394088052,9007,wesleybl,2018-06-02T13:35:09Z,">When user presses ""resume"", we could (behind the scenes) remove and re-add the torrent job so libtorrent can check again the fastresume and the data on disk.

What is fastresume? How long does it take for each torrent? How will this influence deleted files? For example:

```
1. I downloaded two torrents to an external disk.
2. I stopped the qbittorrent.
3. I Removed the external disk.
4. I started qbittorrent.
5. The qbittorrent stopped the torrents, indicated ""Files unavailable"" and the download percentage was 0%.
6. On another computer I delete files from one of the torrents.
7. I reconnect the external drive.
8. I select the two torrents and click on resume.
```
What will happen to the torrent that had the files deleted? Ideally, it should go to and state ""stopped"" and do not start the download.

>The only downside to this is that the torrent will probably lose its queue number.

This would be an unusual situation. So I do not care if the queue number  is lost."
396127415,9007,coolio2013,2018-06-11T05:37:34Z,"About https://builds.shiki.hu/temp/qbittorrent_4.2.0alpha_x32_PR_9007.7z on Win XP-32:

Please rethink behaviour to disable the GUI. Rechecking takes time, especially big torrents on network shares.

Torrents with previous status 'Paused' (set manually to avoid recheck) and dirty from previous crashes WILL be rechecked at startup of qbt. Nothing you can do, since the GUI is all disabled. LOG says 

`Fast resume data was rejected for torrent {payload} fast resume rejected. check resume(): missing or invalid 'file sizes' entry. Checking again...`

process-monitor reveals that qbt does communications with other peers (I can't see checking itself). 
fastresume-files are not rewritten (same time/date for over 8hours) after start; some torrents should have completed recheck meanwhile. So the status remains and they will be rechecked again at next start, if qbt crashes or if I kill it now.

This will repeat forever. qbt will become completely useless. Please consider that. 
"
402568993,9007,harrv,2018-07-04T22:51:56Z,"I'd really like to see this PR merged. When I use the file system to delete or move a file that I had been seeding, I never want it to be re-downloaded. I'd prefer to see an error in the client and then decide if I want to remove the affected torrent from the client or change that torrent's file path. I got used to the beauty and simplicity of that workflow when I used uTorrent.

Is there anything I can do to help with the PR merge process? @sledgehammer999 thank you very much for your code changes to resolve this. Have you seen the review from @glassez on June 2? The requested changes look minor. Is that the only thing holding up merging this PR?

Edit: I tried @sledgehammer999 's alpha (64-bit) and had the same issues as @coolio2013 . Every time I try to start the application, it appears hung. I'm seeding about 90 torrents. I waited more than 15 minutes and saw no change. That should be addressed before this PR is merged."
402606668,9007,glassez,2018-07-05T04:59:49Z,">The requested changes look minor. Is that the only thing holding up merging this PR?

The requested changes are prerequisites for the main review."
403529201,9007,glassez,2018-07-09T15:57:48Z,">Since this is an interactive program, displaying no GUI would be a bad choice.
If feasible, I would choose to ready the mainwindow as early as possible (modern browsers startup time is impressive!) and let user know program is still initializing: could be some text in statusbar, or display the torrent jobs initially as ""not yet loaded"" and transition to other ready state (paused or downloading) when it is loaded.

I've been thinking a lot about this problem lately. And I've come to the conclusion again that those disruptions to the natural sequence of initialization of the components with that you guys are trying to solve this problem can't lead to anything good. We will only get a lot of logical errors and unmaintainable code!
The sequence should be in used-using order (as I said many times before). At global it should be as the following:
1. Core components
2. UI and Remote Access components

But @Chocobo1 is right too, the qBittorrent is ""interactive program"" (in GUI mode) so it would be incorrect to leave the user without a response for a long time. However, this does not mean that we must break the right order. Why should we display the main window immediately if it can't do any good at this time?..
I suggest another option (similar to other long-loaded programs): we just show the splash window (with some initialization related messages) until the application is fully loaded. Tray icon can also be showed but it shouldn't provide any controls during application loading."
404703731,9007,tehmasterer,2018-07-13T02:06:33Z,"Ugh... I thought this was fixed with the 4.1.1 update but it wasn't. I launched qbittorrent last week and I got all these i/o error pop notifications because my external drive wasn't connected. I noticed it switched all those torrents to resume so I quickly paused them. Today I connected my drive and a few of my completed, paused torrents, started overwriting.

If a torrent is completed but it can't find it, can it just say 100% and STAY paused? The overwriting is an absolute nightmare. Also some torrents have to be rechecked after I connect my external drive, even though the save path is the same. This is annoying for seeding."
404747255,9007,glassez,2018-07-13T07:12:37Z,"@sledgehammer999, I have an idea (I need to test it). What about restoring completed torrents in ""seeding mode""? This should prevent it from being rechecked. But I need to test it in different use cases (e.g. when torrent was downloaded partially and then user want to download some more files)."
404751056,9007,sledgehammer999,2018-07-13T07:30:53Z,"FYI, I'll be able to resume this PR either today or the weekend.

> What about restoring completed torrents in ""seeding mode""?

This sounds like a solution too. But you'll need to inspect the resume data yourself to determine the status.
Plus, you need to check for paused torrent instead (non-completed ones can have the same problem)."
405100038,9007,sledgehammer999,2018-07-15T15:44:57Z,"PR rebased and review comments addressed.
>
>```c++
> if (!data.resumed)
>         emit torrentNew(torrent);
>```
>As I said before this additional signal isn't needed anymore.

This signal is only used in the mainwindow in order to display a tray notification for **newly** added torrents."
405105470,9007,glassez,2018-07-15T17:24:48Z,">This signal is only used in the mainwindow in order to display a tray notification for newly added torrents.

But the torrentAdded signal is emitted only after start up process is finished, i.e. for **newly** added torrents only, so we no need the torrentNew signal, isn't it? Just connect its slot to torrentAdded signal.
"
405112157,9007,sledgehammer999,2018-07-15T19:23:01Z,">But the torrentAdded signal is emitted only after start up process is finished, i.e. for newly added torrents only, so we no need the torrentNew signal, isn't it? Just connect its slot to torrentAdded signal.

I see. Yes, this probably will work."
411792209,9007,sledgehammer999,2018-08-09T15:10:55Z,"@glassez I did a minor PR update.

Because the modules are so interconnected we need to serialize some actions in the startup.
Until the torrents are loaded, new torrents can't be added. This also preserves the order of the loaded torrents.
So RSS and WebUI are started when the torrents are loaded. The MainWindow disables all other entry points (include the search tab).
I investigated if there was an easy way to do it inside `addTorrent_impl()` but I couldn't.

This also affects the order we connect to `startupFinished` signal. The Application needs to be last to react. It is the one that initializes RSS, WebUI and enables all the elements of MainWindow. The order of current code is preserved.
Also, theoretically, widgets draw their contents quicker if they have received **all** their data while they were hidden. (eg transferlist with hundreds of torrent entries)
That's why I call `MainWindow::setEnabledWidgets()` from `Application::handleStartUpFinished()`.

`m_sessionStarted` is a guard inside `MainWindow::setEnabledWidgets()` and I can't think of a way to eliminate it and make use of `Session::isStarted()`."
412287418,9007,glassez,2018-08-11T16:51:50Z,"@sledgehammer999, unfortunately I can't say that I approve this PR in its current form. It's more like a rough workaround (in terms of its design).
However, as I see it, it takes away from you the resources that are already missing for full maintainence of the project. So you are free to merge it if you think its purpose is achieved (from a user point of view, closing our eyes to its implementation) in the hope that we will polish and improve it in the future.
But I would make upcoming release ASAP (without this PR) and then merge it immediately so we would be able to test it thoroughly and fix/improve it before the next release.

P.S. Have you ever thought of having an additional release manager? This could help to make releases on time. It is a very hateful situation, when hotfixes ""rot"" in the master for several months while the bugtracker is filled with duplicate issues!"
417856013,9007,ghost,2018-09-01T12:20:26Z,I have this problem too. Looks like add_torrent with flag_override_resume_data can help solve this problem.
450510074,9007,glassez,2018-12-29T18:08:26Z,"@sledgehammer999, you still want to do something about it?"
519202550,9007,glassez,2019-08-07T17:51:29Z,"@sledgehammer999, https://github.com/qbittorrent/qBittorrent/pull/9007#issuecomment-450510074"
520470743,9007,githubuserthatsright,2019-08-12T15:22:04Z,"Just so that I understand - this potential fix, or for that matter maybe any other, has been around for a bit over a year and more than just a few version updates and we've still got this as a problem?"
520481253,9007,glassez,2019-08-12T15:47:14Z,">Just so that I understand - this potential fix, or for that matter maybe any other, has been around for a bit over a year and more than just a few version updates and we've still got this as a problem?

The problems it was supposed to solve (at least most of them) are now solved in a different way."
520492783,9007,githubuserthatsright,2019-08-12T16:16:39Z,So moving or deleting data of a formerly completed torrrent will in no case any longer cause a redownload?
520522747,9007,glassez,2019-08-12T17:40:13Z,">So moving or deleting data of a formerly completed torrrent will in no case any longer cause a redownload?

This should be fixed now."
638189123,9007,glassez,2020-06-03T13:15:01Z,The goal was achieved in a different way.
680131950,13288,FranciscoPombal,2020-08-25T16:27:29Z,"Additional notes:

- The `Add CMakeGraphVizOptions.cmake file` commit is so that the `target_graph.dot` files produced as output of the builds don't get as cluttered. It was previously part of https://github.com/qbittorrent/qBittorrent/pull/12746, and I thought this would be a good place to re-introduce it.

- The macOS builds on Travis have been broken for some time now, with no hope of getting fixed until either sledge returns and fixes the archives from builds.shiki.hu or someone spends time overhauling the Travis script to to work around it. This PR is an alternative way of fixing that."
683182739,13288,FranciscoPombal,2020-08-28T23:05:32Z,"No change rebase, on top of the most recent CMake overhaul commit."
683779142,13288,FranciscoPombal,2020-08-31T13:30:15Z,"Force push: removed the toolset specification for Windows builds, so that it is clear that everything is built with the latest stable VS 2019 Enterprise tools. Turns out GitHub Actions runners don't keep older point releases around, so specifying the tool versions with `msvc-dev-cmd` is misleading (the latest ones will get used)."
685904805,13288,glassez,2020-09-02T18:04:45Z,">The Add CMakeGraphVizOptions.cmake file commit is so that the target_graph.dot files produced as output of the builds don't get as cluttered. 

I'm sorry, but I still don't understand why it's required to be added in this PR.
Your explanation sounds like if you say to people who know what you're talking about in advance."
685917238,13288,FranciscoPombal,2020-09-02T18:26:41Z,"@glassez 

> > The Add CMakeGraphVizOptions.cmake file commit is so that the target_graph.dot files produced as output of the builds don't get as cluttered.
> 
> I'm sorry, but I still don't understand why it's required to be added in this PR.
> Your explanation sounds like if you say to people who know what you're talking about in advance.

I've explained its purpose before: https://github.com/qbittorrent/qBittorrent/pull/12746#issuecomment-653964262, https://github.com/qbittorrent/qBittorrent/pull/12746#discussion_r462236148 (first 2 paragraphs). Try to build qBittorrent with the `--graphviz` flag without this file in the root dir to see the difference. The generated graph itself will be more cluttered with things that are not relevant and it will be split in many files, cluttering the output build directory."
685922502,13288,glassez,2020-09-02T18:35:28Z,">Try to build qBittorrent with the --graphviz flag without this file in the root dir to see the difference.

How is it related to this PR? Is any graphs producing **required** here?"
685926316,13288,FranciscoPombal,2020-09-02T18:42:41Z,"@glassez 

> How is it related to this PR? Is any graphs producing **required** here?

Yes, it's useful to see and troubleshoot the actual resulting dependency graph of the build. This was already relevant for https://github.com/qbittorrent/qBittorrent/pull/12746, so that the user could produce uncluttered graphs if they chose to, when building. But it is even more relevant in this PR. Download one of the zips from https://github.com/FranciscoPombal/qBittorrent/actions/runs/223928661, and imagine how much more annoying it would be if the zip contained many little graph files instead. Thanks to this configuration file it contains just one."
687785582,13288,glassez,2020-09-06T13:09:48Z,">Yes, it's useful to see and troubleshoot the actual resulting dependency graph of the build. 

Really? I haven't seen any complaints about it not being in current CI builds.
Isn't CI just intended to make sure that new changes are still buildable on platforms other than the one they were created on?
""Dependency graph of the build"" doesn't seem to be intended for everyone's use at all. Someone who actually cares about it can produce it locally.
In any case, you should not mix it in here (just as you shouldn't include creating graphs in CI environment). As already suggested in another PR, you can publish it in a separate PR, and try to provide a convincing argument that it makes sense at the project level.
"
688556083,13288,FranciscoPombal,2020-09-08T00:39:54Z,"@glassez 

> Really? I haven't seen any complaints about it not being in current CI builds.

It's not a solution to some specific complaint, it's just a general improvement.

> Isn't CI just intended to make sure that new changes are still buildable on platforms other than the one they were created on?

Yes, but not just that they are buildable, but also built the same way (or at least without surprising changes). I want to have confidence that changes I make which shouldn't impact the way qBittorrent is built on other platforms live up to that promise. This is especially useful when making changes/improvements to the build system.

> ""Dependency graph of the build"" doesn't seem to be intended for everyone's use at all. Someone who actually cares about it can produce it locally.

Not all developers have one machine with each of the supported operating systems. If someone complains there is something wrong when they tried to build on macOS, it is much easier to troubleshoot if everyone (even those who do not own systems with macOS/Hackintoshes/don't have macOS VMs set up) can use the files produced by the macOS CI runs as a canonical point of reference. CI is meant to both verify that things still build fine _and_ provide useful reference information for troubleshooting.

You could make a similar argument for the generated executable + pdb file. If you consider them useful, why not the graph? If you're concerned about performance, don't be, CMake generates this graph really fast.

> In any case, you should not mix it in here (just as you shouldn't include creating graphs in CI environment). As already suggested in another PR, you can publish it in a separate PR, and try to provide a convincing argument that it makes sense at the project level.

I'll consider it, but for now I believe I've refuted the central premises of `CI is _just_ for checking if it is still buildable` and `you shouldn't include creating graphs in CI environment` in the previous paragraphs."
688935002,13288,glassez,2020-09-08T14:58:05Z,"Okay, maybe producing dependency graph on CI really makes sense. I don't deal with CMake that closely, so it doesn't concern me. 
But then I have another questions. Isn't this file for customizing CMake graph output according to someone's personal preferences? Do we impose our preferences on others? Does it have something that really depends on the individual characteristics of our application (or its build system)? If it's really better for everyone, why does it behave differently by default?"
688936950,13288,glassez,2020-09-08T15:00:45Z,"If it is approved, shouldn't we remove all similar(CMake based) configurations from other CI environments in the same PR?"
689041129,13288,FranciscoPombal,2020-09-08T17:56:40Z,"@glassez 

These are the changes from default:

- `GRAPHVIZ_CUSTOM_TARGETS`: `FALSE` -> `TRUE`

To give more information about custom target by default; I think this will be quite useful if we ever add custom targets. A little more information is always welcome

- `GRAPHVIZ_GENERATE_PER_TARGET` and `GRAPHVIZ_GENERATE_DEPENDERS`: `TRUE` -> `FALSE`

When both of these are false, only the final overall graph is generated. This prevents spam of lots of little files.

- `GRAPHVIZ_IGNORE_TARGETS`: `<empty list>` -> `.*autogen`

This makes the `.*autogen` auto-generated targets (due to automatic {MOC, UIC, RCC}) not appear in the graph. I guess this would be the most controversial change, since this is the only one that removes information from what would otherwise be shown as the default. However, I don't think this is very useful 99% of the time.

---

Overall I think we should select the defaults that are most convenient for CI. If the options we choose for the CI don't suit someone's graph-generation preferences, they can always change it locally. I do wish there was a better way to pass these options than editing a specifically-named file, but sadly this is currently not possible.

However, thinking about it a little better now, I think it would be beneficial to open up discussion about exactly _which_ graph-generation options are ""most convenient for CI"". From this standpoint, it is indeed better to factor this out to another PR. I don't expect it will be too different from this, though. I'll just take care of the other prerequisite PR first, before factoring out the CMake graphviz stuff."
694969124,13288,FranciscoPombal,2020-09-18T16:39:28Z,"@glassez @Chocobo1 Rebased on top of master without the `CMakeGraphVizOptions.cmake` file. This can be merged now to finally fix the broken CI. Like I have explained above, it does all the TravisCI and Appveyor scripts currently do, and some things it does better."
694974736,13288,glassez,2020-09-18T16:51:48Z,"@FranciscoPombal
Please describe how we can see its results when it is merged. Will they available on PRs pages?"
694979623,13288,FranciscoPombal,2020-09-18T17:02:43Z,"@glassez 

> @FranciscoPombal
> Please describe how we can see its results when it is merged. Will they available on PRs pages?

Yes, it will be available in PR pages and run on every PR against master and commit to master. As mentioned in OP, here is an example of what you see once you click on the link: https://github.com/FranciscoPombal/qBittorrent/actions/runs/223928661

Force pushed to bump vcpkg and bump libtorrent version to 1.2.10."
694986699,13288,FranciscoPombal,2020-09-18T17:17:48Z,"Oops, sorry for requesting review again."
695799010,13288,FranciscoPombal,2020-09-20T15:19:29Z,"@glassez @Chocobo1 

About this force push:

Seems like something changed with GitHub actions runners, such that when using Ninja, GCC is detected as the default compiler, which breaks the build. I came across this problem when reusing this PR for other things recently.

So I have made a minor change to the Windows job, it now uses the `Visual Studio 16 2019` generator instead of Ninja, because this way, MSVC is always detected as the default compiler.

I have reported the bug here: https://github.com/actions/virtual-environments/issues/1621

Sample run showing that it works now again: https://github.com/FranciscoPombal/qBittorrent/runs/1138166418

diff:

```diff
       run: |
-        cmake -B build -G ""Ninja"" `
+        cmake -B build -G ""Visual Studio 16 2019"" `
           -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DCMAKE_BUILD_TYPE=RelWithDebInfo `
           -DCMAKE_TOOLCHAIN_FILE=${{ env.VCPKG_DEST_WIN }}/scripts/buildsystems/vcpkg.cmake `
           -DVCPKG_TARGET_TRIPLET=x64-windows-static-release `
           -DVERBOSE_CONFIGURE=ON `
           --graphviz=build/target_graph.dot
-        cmake --build build
+        cmake --build build --config RelWithDebInfo -- /p:UseMultiToolTask=true
 
     - name: upload artifact as zip
       uses: actions/upload-artifact@v2.1.3
```

The `/p:UseMultiToolTask=true` flag is to make sure the build utilizes all cores."
695940468,13288,glassez,2020-09-21T07:05:18Z,"@Chocobo1, @FranciscoPombal
Sorry, I don't have time to write extensive comments right now to express my opinion on each issue raised. So I will comment on my attitude to this PR in general.
I approve it without going into too much detail about it (although some aspects don't suit me either, or at least they should be further tweaked). And I want it to be merged as early as possible. I have two reasons:
1. We don't currently have a fully functional CI environment and this is really annoying.
2. It is better to continue discussing / improving it when it is already working and bringing some results, than to try to perfect something that is not yet there, at the risk of not getting anything in the end. These changes do not affect the source code of the app in any way, so the omitted flaws should not spoil anything very much. This will give us time to cool down a bit and look at it slowly and more objectively."
695943356,13288,glassez,2020-09-21T07:12:36Z,">Seems like something changed with GitHub actions runners, such that when using Ninja, GCC is detected as the default compiler, which breaks the build. I came across this problem when reusing this PR for other things recently.
So I have made a minor change to the Windows job, it now uses the Visual Studio 16 2019 generator instead of Ninja, because this way, MSVC is always detected as the default compiler.

This is a very controversial decision. Instead of fixing script so that it uses the compiler we need with previously selected generator, you just changed the generator. I would agree with this if you made an equivalent substitution (for example, jom). But ""Visual Studio""?.. Personally, I don't see any practical value for these generators other than loading CMake project to Visual Studio IDE. I think it's perverse to use these tools in a non-interactive environment."
696142293,13288,FranciscoPombal,2020-09-21T14:14:41Z,"@glassez 

You're right, I changed it to use Ninja + the `ilammy/msvc-dev-cmd@v1.3.0` action, I think this is a better solution."
696278979,13288,FranciscoPombal,2020-09-21T18:06:15Z,"I've given up completely on the upstream inclusion of a `CMakeGraphVizOptions.cmake` file, as I no longer think it makes sense. So I won't be making a future PR about it. If someone really wants it later, it's only about 5 lines anyway for the options that matter."
698444612,13288,glassez,2020-09-24T16:14:52Z,"@Chocobo1, @FranciscoPombal
Hey, you guys still haven't come to any agreement about it? I want to have a working CI."
698463055,13288,Chocobo1,2020-09-24T16:50:23Z,">Hey, you guys still haven't come to any agreement about it? I want to have a working CI.

@FranciscoPombal 
I would like to approve this PR if you agree to look into this afterwards: https://github.com/qbittorrent/qBittorrent/pull/13288#discussion_r492077003
Do we have an agreement?"
698509711,13288,FranciscoPombal,2020-09-24T18:22:59Z,"@glassez 

> Hey, you guys still haven't come to any agreement about it? I want to have a working CI.

This has been ready for 3 days.

@Chocobo1 

> @FranciscoPombal
> I would like to approve this PR if you agree to look into this afterwards: [#13288 (comment)](https://github.com/qbittorrent/qBittorrent/pull/13288#discussion_r492077003)
> Do we have an agreement?

The static builds? In case it wasn't clear before: sure! I also think it would be very useful. I thought it was understood that it was out of scope of this PR - but this PR was definitely made with such future extensions in mind.
"
698714968,13288,Chocobo1,2020-09-25T04:36:09Z,"I think we can also add a badge in README.md, see: https://docs.github.com/en/actions/managing-workflow-runs/adding-a-workflow-status-badge"
698799661,13288,FranciscoPombal,2020-09-25T08:31:41Z,"@Chocobo1 

> I think we can also add a badge in README.md, see: https://docs.github.com/en/actions/managing-workflow-runs/adding-a-workflow-status-badge

https://github.com/qbittorrent/qBittorrent/pull/13432"
698888083,13288,Chocobo1,2020-09-25T11:57:38Z,"@FranciscoPombal 
Thank you!"
794261720,13288,oprypin,2021-03-09T18:18:45Z,"Sorry for necro-posting and sorry for plugging my website. But,

Since this mentions ""nightly"" builds (and I'm not sure what exact purpose was in mind) --
Well, you can get a convenient link to the builds (either always-latest or a particular one) via [this website](https://nightly.link):
https://nightly.link/qbittorrent/qBittorrent/workflows/ci.yaml/master"
1704045488,19542,glassez,2023-09-03T08:16:16Z,"> * allow to configure and listen on an SSL port

I wonder if the same port can be used for both SSL and non-SSL connections?"
1706600660,19542,rcarpa,2023-09-05T13:14:53Z,"> I wonder if the same port can be used for both SSL and non-SSL connections?

Libtorrent doesn't allow this as of today. From their [documentation](https://libtorrent.org/manual-ref.html#ssl-torrents) : 
`SSL connections are accepted on a separate socket from normal bittorrent connections. To enable support for SSL torrents, add a listen interface to the settings_pack::listen_interfaces setting with the s suffix`

This also quite expected. While technically it's possible to try to detect if the client initializes an SSL connection based on first received bytes, it would mean putting heuristics into the code path of security-related primitives. I'm not aware of any broadly used network server which would do that. Do you have any example of server doing that in mind? "
1706759364,19542,glassez,2023-09-05T14:43:44Z,"It was curiosity mostly. I didn't go into much detail about such things. All that comes to my mind is HTTP and HTTPS (not sure if it's the same). Or can they also not coexist on the same port?
In any case, the question is settled, since libtorrent does not support it."
1706857000,19542,rcarpa,2023-09-05T15:38:33Z,"> Or can they also not coexist on the same port?

""Can"" is the wrong word. Technically it could be possible, but I cannot think of a reasons to do it [*]. http has been allocated the port 80 by IANA; https: port 443. This is the setup which every normal web server uses. 

[*] except, maybe, to hide a SSL service on a port. For example: hide that there is a VPN server listening on an open port by dissimulating it as a web server."
1706982015,19542,glassez,2023-09-05T16:59:21Z,"> http has been allocated the port 80 by IANA; https: port 443

Oh, right. Usually the default ports are hidden in URLs, so I forgot about the fact that they are different."
1745861225,19542,Neustradamus,2023-10-03T23:05:04Z,To follow
1962911187,19542,Chocobo1,2024-02-25T11:59:30Z,Superseded by PR #20338.
437278687,9824,thalieht,2018-11-09T07:53:28Z,"Clazy found only 4 in whole project (for what i've changed so far), great. The condition i said for copyAsConst is obviously wrong but if all it takes is Clazy i guess it doesn't matter. But what about qAsConst? Is what i said in the first post correct or there is more?"
437478425,9824,thalieht,2018-11-09T20:00:38Z,"I've also found a few existing `for ( : )` like the following
https://github.com/qbittorrent/qBittorrent/blob/547140ec4614d6e8597dd8217b928ffedcf000fc/src/base/rss/rss_feed.cpp#L232

`articles` is non-const QList. Is it correct as is, or it needs qAsConst?"
437582550,9824,Chocobo1,2018-11-10T13:05:28Z,">But what about qAsConst? Is what i said in the first post correct or there is more?

Your understanding seems correct.

>articles is non-const QList. Is it correct as is, or it needs qAsConst?

Seems not as `result` is already `const`.
"
437591934,9824,thalieht,2018-11-10T15:32:15Z,"Thanks and sorry if i'm being a pain... i found the following from another project which is in the same situation:
https://github.com/lxqt/lxqt-config/pull/137/files#diff-e5a213b77fa1d61778446c5c0cb7dfa9R54
`info` being const but `variants` not, yet qAsConst is added anyway."
439445828,9824,Chocobo1,2018-11-16T16:20:47Z,"Nothing more from me, I think you can squash commits then let others review."
439461677,9824,thalieht,2018-11-16T17:11:18Z,Squashed.
439601585,9824,glassez,2018-11-17T08:54:36Z,"Sorry for delay.
Guys, let's define the policy of using qAsConst/copyAsConst once and for all.
1. **(lvalue)** We require to use qAsConst when we iterate over non-const container but we don't intend to modify its items. However we can safely use it even with const containers to be sure that further code modifications will not lead to unexpected detaching of shared data.
2. **(rvalue)** copyAsConst is a more expensive operation because it calls the copy constructor (although it is quite lightweight). When can it really help? Only when affected method returns copy of internal container. When method creates new container it isn't affected by ""detaching"" problem. Now I'm not sure that using copyAsConst is the best solution. It generates either unnecessary copying or requires awareness of the internals of the affected methods (i.e. we need to know exactly what it returns to decide whether to use copyAsConst or not). Maybe just drop it and use another approach?"
439607065,9824,thalieht,2018-11-17T10:38:25Z,I added qAsConst if container is not const or where possible and copyAsConst where Clazy said it might detach. If not copyAsConst then what? Also i'm not sure about https://github.com/qbittorrent/qBittorrent/pull/9824#issuecomment-437591934 and https://github.com/qbittorrent/qBittorrent/pull/9824#discussion_r232946145
439614026,9824,thalieht,2018-11-17T12:45:09Z,"I run Clazy again and i had missed one, fixed."
439704996,9824,glassez,2018-11-18T16:21:31Z,"As for https://github.com/qbittorrent/qBittorrent/pull/9824#issuecomment-437591934, this is a misconception of course. All fields of const struct are const too (https://en.cppreference.com/w/c/language/const)."
439715486,9824,thalieht,2018-11-18T18:44:12Z,Reverted and thanks for the link.
441477727,9824,thalieht,2018-11-25T22:02:58Z,"Removed most copyAsConst. The remaining ones are mostly qt functions that i have no idea whats going on inside:
[QNetworkCookieJar::allCookies()](https://github.com/qt/qtbase/blob/c5307203f5c0b0e588cc93e70764c090dd4c2ce0/src/network/access/qnetworkcookiejar.cpp#L121)
		[QSettings::allKeys()](https://github.com/qt/qtbase/blob/527406cbd99f44470ef87468b73c18df949e8ac7/src/corelib/io/qsettings.cpp#L3133)
		[QItemSelectionModel::selectedIndexes()](https://github.com/qt/qtbase/blob/c5307203f5c0b0e588cc93e70764c090dd4c2ce0/src/corelib/itemmodels/qitemselectionmodel.cpp#L1703)
		[QApplication::allWidgets()](https://github.com/qt/qtbase/blob/825f98815683faea06144ab0262129b0367798ee/src/widgets/kernel/qapplication.cpp#L1736)
		[QWidget::actions()](https://github.com/qt/qtbase/blob/c5307203f5c0b0e588cc93e70764c090dd4c2ce0/src/widgets/kernel/qwidget.cpp#L3354)
		QObject::findChildren<T>()
		[QButtonGroup::buttons()](https://github.com/qt/qtbase/blob/c5307203f5c0b0e588cc93e70764c090dd4c2ce0/src/widgets/widgets/qbuttongroup.cpp#L287)
		https://github.com/qbittorrent/qBittorrent/blob/0e8323659e026b72d13d40f942e6317c9b2591f4/src/gui/categoryfilterwidget.cpp#L234

Also there is `Feed::articles()` which returns shared container, and `Folder::articles()` which does not. The following is confusing to me and i'm not sure which one is used here (i assume `Feed::articles()`)
https://github.com/qbittorrent/qBittorrent/blob/0e8323659e026b72d13d40f942e6317c9b2591f4/src/gui/rss/articlelistwidget.cpp#L71

I can't make `Feed::articles()` return const ref, i get some error about inheritance.

`Logger::getMessages` and `Logger::getPeers` have multiple return paths including shared container so i left the copyAsConst there."
441534661,9824,Chocobo1,2018-11-26T06:43:49Z,">The remaining ones are mostly qt functions that i have no idea whats going on inside:

This question makes me thinking, normally we should only care about the return type of a function, not its implementation, however the detachment problem forces us to look into, isn't that a bit weird?
Another (less popular) idea is just ignore using `copyAsConst` in most cases, only use it at performance critical places (almost none in qbt I guess), does that make sense?"
441537251,9824,glassez,2018-11-26T06:58:56Z,">Another (less popular) idea is just ignore using copyAsConst in most cases, only use it at performance critical places (almost none in qbt I guess), does that make sense?

I wouldn't go that way. After all, the copy constructor is less expensive than the real `detach()` (which leads to deep copying). So, if I had to choose between extreme cases, I would prefer to use `copyAsConst()`. In addition, it will protect against changing the program logic by oversight (because `for (Type var : copyAsConst(container))` is equivalent to `foreach (Type var, container)`).
So the only question is whether we should ""lazily"" use it everywhere, or try to discard those cases where it is not required."
441552923,9824,thalieht,2018-11-26T08:17:09Z,"I think we should keep it for Qt functions because we don't know if they will be changed some day to return shared container, except maybe for ones that wouldn't make sense to, e.g. mid() split().
Awaiting your decision guys."
441988680,9824,glassez,2018-11-27T09:29:38Z,"I had to re-examine it...
**First.** Why did we call it `copyAsConst`? It totally baffled me! Let's see its code:
```c++
template <typename T>
constexpr typename std::add_const<T>::type copyAsConst(T &&t) noexcept { return std::move(t); }
```
We don't really copy the value but move it. So the better name should be ""forwardAsConst"" or ""fwdAsConst"" (or something like it).
**Second.** Move-constructor is really simple. It just copies a couple of pointers.
**Third."" Let's compare the pros and cons. In the case when we are dealing with a really shared container (references count > 1), then `copyAsConst` wins undoubtedly. When a container exists in a single instance (I mean its shard data), we get the following:
1. `copyAsConst` way causes Move-constructor + destructor of empty object (so lightweight)
2. non-`copyAsConst` causes two `detach()` (in its lightweight form, i.e. just checking ref count)
Additionally the first way prevents us from unnecessary work to assess the need for use `copyAsConst` in some particular case (and from errors when we misinterpret some case).

I'm sorry I made you think of that. But I think we needed to do that before we approved that PR.
So let's choose our way and finish it!"
442044751,9824,Chocobo1,2018-11-27T12:42:15Z,">So the only question is whether we should ""lazily"" use it everywhere, or try to discard those cases where it is not required.

Personally I have no problem using `copyAsConst` everywhere, except the name is a bit long and too verbose which slows me down when reading it, sometimes I hope we can have it in some shorthand, e.g. `fConst()` which stands for forward as const."
442052995,9824,glassez,2018-11-27T13:12:04Z,">shorthand, e.g. fConst() which stands for forward as const.

I would use more readable name, e.g. `asConst()`. We can even rename our implementation of qAsConst to asConst to use single name in all logically similar situations (for both lvalues and rvalues)."
442055513,9824,Chocobo1,2018-11-27T13:20:32Z,">I would use more readable name, e.g. asConst(). We can even rename our implementation of qAsConst to asConst to use single name in all logically similar situations (for both lvalues and rvalues).

Agree, also I just remembered that it was proposed as `constify()` in PR #8325 but was changed later."
442082172,9824,glassez,2018-11-27T14:41:35Z,">Agree, also I just remembered that it was proposed as `constify()` in PR #8325 but was changed later.

Well, let it be `constify()` if you prefer it more.
IIRC, you don't object to have same name for them?"
442086696,9824,Chocobo1,2018-11-27T14:53:57Z,">IIRC, you don't object to have same name for them?

No problem for me, actually `asConst()` is 1 char shorter than the other so lets just use it."
442124990,9824,thalieht,2018-11-27T16:32:37Z,So i basically remove the last 2 commits and then rename copyAsConst and qAsConst to asConst in a new commit? Wasn't qAsConst chosen so qBt can use Qt's implementation after min version is bumped to >= 5.7.0?
442169537,9824,glassez,2018-11-27T18:39:33Z,">Wasn't qAsConst chosen so qBt can use Qt's implementation after min version is bumped to >= 5.7.0?

It's just trivial function template so we won't win much by using Qt's qAsConst instead of our own implementation."
442213829,9824,thalieht,2018-11-27T20:56:09Z,Removed last 2 commits (kept a backup just in case) and renamed qAsConst() and copyAsConst() to asConst() so as far as copyAsConst goes we're back to what Clazy complained might detach.
442499715,9824,thalieht,2018-11-28T15:59:18Z,Rebased.
442615898,9824,thalieht,2018-11-28T21:44:13Z,Added asConst to all functions. I'm open to changes if you want some specific ones removed.
444786797,9824,Chocobo1,2018-12-06T08:19:28Z,Thank you!
444839835,9824,thalieht,2018-12-06T11:24:44Z,Thank you all.
1000976703,15888,glassez,2021-12-25T05:16:57Z,Do we need to support both qrc and folder based themes?
1000976778,15888,glassez,2021-12-25T05:18:12Z,"@jagannatharjun 
Please attach some themes as zipped folders for testing."
1000990220,15888,jagannatharjun,2021-12-25T08:16:43Z,"> Do we need to support both qrc and folder based themes?

Wanted to keep backward compatibility. No reason to trouble users for whom the themes are working

> Please attach some themes as zipped folders for testing.

[theme-test.zip](https://github.com/qbittorrent/qBittorrent/files/7775628/theme-test.zip)


"
1001446422,15888,glassez,2021-12-27T09:02:41Z,"When I was thinking about this feature, I had the idea to set (in the UI and settings) not the path to the folder itself, but the path to the theme config file instead. It looks easier."
1001604830,15888,jagannatharjun,2021-12-27T14:55:54Z,"> the path to the theme config file instead

yes probably less code but IMO current implementation is more clearer whether it's more user-friendly is subjective."
1001633891,15888,glassez,2021-12-27T16:02:25Z,"> > the path to the theme config file instead
> 
> yes probably less code but IMO current implementation is more clearer whether it's more user-friendly is subjective.

I initially thought about UI. A single path input field would look better to me. But let's find out other opinions."
1002596516,15888,jagannatharjun,2021-12-29T13:32:51Z,"@glassez  Replaced the folder-based option with a selection of config.json, code is much shorter now 👍"
1003888869,15888,glassez,2022-01-03T06:11:30Z,"@jagannatharjun 
Thank you!"
96203700,2892,ngosang,2015-04-25T13:28:51Z,"**Tests using Archlinux & Qt4**

I can't build with libtorrent 1.0.4 (with the master version everything is ok):

```
torrenthandleimpl.o: En la función `libtorrent::fastresume_rejected_alert::message() const':
/usr/include/libtorrent/alert_types.hpp:1475: referencia a `libtorrent::convert_from_native(std::string const&)' sin definir
/usr/include/libtorrent/alert_types.hpp:1475: referencia a `libtorrent::convert_from_native(std::string const&)' sin definir
```

With libtorrent 0.16.17 I can but there are some problems...
- I had torrents in the list (before test this PR) and they are gone, it's not a very big problem for me.
- If I add a new magnet link and wait until metadata is retieved, I can see this lines in the console:

```
Exception thrown: invalid torrent handle used , receiver:  """" 
Exception thrown: invalid torrent handle used , receiver:  """" 
Exception thrown: invalid torrent handle used , receiver:  """"
....
```
- I add new magnet link with ""Start torrent"" checked. The torrent starts downloading but after 5 or 10 seconds the torrent stop. :S :S If I start it again the torrent stops again in few seconds... If I close qBittorrent and open again it's working as expected.
- When torrent download finishes the torrent extension (.!qB) isn't removed.
- When torrent download finishes I renamed one file inside the torrent in the ""Content"" tab. The file isn't renamed in the filesystem. (I think this is related with extension (.!qB)).
- When I click File => Exit I see this message in the console:

```
QThreadStorage: Thread 0x97f1728 exited after QThreadStorage 5 destroyed
```
- Torrents with non ASCII characters in the title fail. You can try with this:
  magnet:?xt=urn:btih:MWQBR6UVGTVI6EYCX7WMHR4QAH5UQ5VH&dn=The%20Imitation&tr=udp%3a%2f%2fopen.demonii.com%3a1337%2fannounce
  The torrent downaload starts but you can see this message in the console: File Error: The Imitation ... and If you close qBittorrent, the next time the file is in the state ""Missing Files"". You can see the ""Content"" tab also, the non ASCII characters are wrong.
"
96210107,2892,glassez,2015-04-25T14:06:10Z,"> I can't build with libtorrent 1.0.4

Do you build libtorrent with `export-extra=on`?
"
96210348,2892,ngosang,2015-04-25T14:08:47Z,"> Do you build libtorrent with export-extra=on?

I think no. I'm using this script for installation: https://aur.archlinux.org/packages/li/libtorrent-rasterbar-1/PKGBUILD

Btw, I updated the previous comment.
"
96210409,2892,glassez,2015-04-25T14:10:35Z,"@ngosang What is your OS and build/run environment (Qt, compiler etc.)?
"
96211186,2892,ngosang,2015-04-25T14:16:07Z,"> What is your OS and build/run environment (Qt, compiler etc.)?

Archlinux (updated)
gcc 4.9.2
qt4 4.8.6
boost 1.57.0
make 4.1
libtorrent-rasterbar 0.16.17  or  libtorrent-rasterbar 1.0.4 (just one at the same time)

As I said libtorrent 1.0.4 works perfect with the master branch.
"
96213326,2892,glassez,2015-04-25T14:22:31Z,"> I had torrents in the list (before test this PR) and they are gone, it's not a very big problem for me.

It's expected behavior. Torrents resuming were remade. Now torrent resume data is stored in ResumeData in form _torrent_info_hash.torrent_ + _torrent_info_hash.fastresume.queue_number_ (e.g. _0a89005cc7894d26eed12d35de59b02d11791ca0.fastresume.0_, _0a89005cc7894d26eed12d35de59b02d11791ca0.torrent_). So you can copy and adjust your old resume files.
"
96215236,2892,ngosang,2015-04-25T14:27:19Z,"> So you can copy and adjust your old resume files.

Don't worry about me :smile: .Look the other problems, If you need I can try more things.
"
96215554,2892,glassez,2015-04-25T14:30:05Z,"> Don't worry about me

This description can help others.

> Look the other problems, If you need I can try more things.

Of course. It is very difficult to test in isolation. The more testers, the better.
"
96219995,2892,ngosang,2015-04-25T15:06:44Z,"I added a new problem at the end: #2892#issuecomment-96203700
"
96233925,2892,sledgehammer999,2015-04-25T16:26:51Z,"@glassez Is extra-export=on needed now? If yes, why?
"
96234880,2892,glassez,2015-04-25T16:41:26Z,"It's just a guess. I have a habit to build so on Windows (I just use my old script). But Travis-Ci builds it without errors, so it is suspicious.
"
96240695,2892,glassez,2015-04-25T17:20:17Z,">    If I add a new magnet link and wait until metadata is retieved, I can see this lines in the console:
> `Exception thrown: invalid torrent handle used , receiver:  """"`

Fixed.
@ngosang Do you test updated code? And then comment out what is fixed and what is not.
"
96241063,2892,glassez,2015-04-25T17:24:23Z,"> Torrents with non ASCII characters in the title fail. You can try with this: magnet:?xt=urn:btih:MWQBR6UVGTVI6EYCX7WMHR4QAH5UQ5VH&dn=The%20Imitation&tr=udp%3a%2f%2fopen.demonii.com%3a1337%2fannounce

I tried:
![0](https://cloud.githubusercontent.com/assets/5063477/7333919/056b7fbe-eb89-11e4-955a-6d05923b9a54.png)
"
96243098,2892,ngosang,2015-04-25T17:38:22Z,"> Exception thrown: invalid torrent handle used , receiver: """"

It's working now.

The problem with codification is still present.
![](http://i.imgur.com/U4BpNOo.png)
I just compiled the master branch with the same libraries and it's working well.

**UPDATED:**
When I add the torrent it's working but if I close qBittorrent before completion and open it again there it's.
"
96246518,2892,ngosang,2015-04-25T18:00:27Z,"> UPDATED:
> When I add the torrent it's working but if I close qBittorrent before completion and open it again there it's.

@glassez 
"
96247051,2892,glassez,2015-04-25T18:04:09Z,"@ngosang You still test it with libtorrent-0.16?
"
96252636,2892,ngosang,2015-04-25T18:13:26Z,"> You still test it with libtorrent-0.16?

Yes. I can try with 1.0.4 again. Wait a few minutes.
"
96256086,2892,glassez,2015-04-25T18:22:47Z,"Linux Mint 17 + Qt 5.4 + libtorrent-0.16.19 + boost-1.54 = no problem with codification. Maybe the problem is with Qt 4.8?..
"
96258761,2892,ngosang,2015-04-25T18:43:09Z,"With this PR:
- Qt 5.4 + libtorrent-0.16.17 => NO codification problem
- Qt 4.8 + libtorrent-0.16.17 => **Codification problem**
- Qt XX + libtorrent-1.0.4 => **Compilation error**

With master branch:
- Qt 5.4 + libtorrent-0.16.17 => NO codification problem
- Qt 4.8 + libtorrent-0.16.17 => NO codification problem
- Qt XX + libtorrent-1.0.4 => Compilation successful

@pmzqla Can you help us?
"
96259790,2892,glassez,2015-04-25T18:52:30Z,"> When I add the torrent it's working but if I close qBittorrent before completion and open it again there it's.

Is there a problem with the encoding (as in your screenshot), when you added the torrent? Or it only appears after resume (together with missing files)?
Do you use temp path? Where do you save? When you resume, it shows the same path?
"
96260362,2892,sledgehammer999,2015-04-25T18:54:08Z,"If master branch is ok with encoding, I assume that the PR has a code path that forgets to do fromUtf8() when reading the path strings from libtorrent.
"
96263297,2892,ngosang,2015-04-25T18:59:25Z,"> Is there a problem with the encoding (as in your screenshot), when you added the torrent? Or it only appears after resume (together with missing files)?

When I add the torrent there is no problem. It's when I close qBittorrent and reopen it.
"
96263806,2892,glassez,2015-04-25T19:01:56Z,"> If master branch is ok with encoding, I assume that the PR has a code path that forgets to do fromUtf8() when reading the path strings from libtorrent.

The encoding problem is in torrent filenames - not in save path (as I see it).
"
96323643,2892,glassez,2015-04-26T05:07:14Z,"Linux Mint 17 + Qt 5.4 + libtorrent-**1.0.4** + boost-1.54 = no problem with building/encoding.
Need to try with Qt 4.8...
"
96361381,2892,pmzqla,2015-04-26T10:31:46Z,"I really don't know what's wrong with `libtorrent::fastresume_rejected_alert::message() const`, but I still can't build qBittorrent (libtorrent 1.0.3, Qt 4.8.6, boost 1.55)

```
torrenthandleimpl.o: In function `libtorrent::fastresume_rejected_alert::message() const':
/usr/local/include/libtorrent/alert_types.hpp:1479: undefined reference to `libtorrent::convert_from_native(std::string const&)'
/usr/local/include/libtorrent/alert_types.hpp:1479: undefined reference to `libtorrent::convert_from_native(std::string const&)'
collect2: error: ld returned 1 exit status
```

If I use the deprecated `p->msg` the build finishes. I don't understand why `storage_moved_failed_alert` is fine, but not `fastresume_rejected_alert`
"
96367011,2892,glassez,2015-04-26T11:37:20Z,"qBittorrent master uses `libtorrent::fastresume_rejected_alert::message()`... 😖 
"
96367055,2892,sledgehammer999,2015-04-26T11:37:58Z,"Windows 7:
-  qt 4.8.6 + libtorrent 1.0.4(svn11008) -> encoding issue after I **add** the magnet. The problem isn't present in the ""Add new torrent"" dialog. Also, I don't need to restart the client. The content window shows garbage info immediately.
- qt 5.4.1 + libtorrent 1.0.4(svn11008) -> everything is ok, even if I restart the client.
- qt 4.8.6 + libtorrent 1.0.4(svn11008) + **current git master** -> no encoding problem

I navigated the source and it seems to do the right thing on both qt4 and qt5... I cannot find anything obvious.

@glassez The following is a nitpick but I imagine this will get annoying fast. In QtCreator, if I right click on a method invoked by an object instance (eg `m_Info->file()`) and select ""Follow Symbol Under Cursor"" it opens up the relevant header file where that method is invoked. If I do the same on the header file it doesn't open the cpp file where the method is defined. I need to first right click on the header file and select ""Switch header/source"" for it to work.
Up until now, the ""Follow Symbol ..."" command immediately opened the cpp file without going to the header file first.
Any idea on how to fix this?
"
96368914,2892,glassez,2015-04-26T11:44:53Z,"@sledgehammer999 this happens for everything or for some classes only. Can you test it.
"
96369001,2892,sledgehammer999,2015-04-26T11:47:30Z,"@glassez I noticed this while navigating the source for the encoding issue. So the torrentcontelmodel/fs_util/misc/bittorrent info and related files seem to have this problem.
"
96370986,2892,pmzqla,2015-04-26T12:08:01Z,"The build doesn't fail if I use ""-O1"" instead of ""-O2"".

I had to manually edit the Makefile because the configure script always puts ""-O2"", no matter what's the value of the variable CXXFLAGS.

``` diff
--- a/src/Makefile  2015-04-26 14:05:06.908049867 +0200
+++ b/src/Makefile  2015-04-26 14:04:59.975679085 +0200
@@ -12,7 +12,7 @@
 CXX           = g++
 DEFINES       = -DQT_WEBKIT -DTORRENT_LINKING_SHARED -DBOOST_ASIO_DYN_LINK -DBOOST_ASIO_ENABLE_CANCELIO -DBOOST_EXCEPTION_DISABLE -DBOOST_ASIO_HASH_MAP_BUCKETS=1021 -DWITH_SHIPPED_GEOIP_H -DTORRENT_USE_OPENSSL -DQT_NO_DEBUG_OUTPUT -DVERSION_MAJOR=3 -DVERSION_MINOR=2 -DVERSION_BUGFIX=0 -DVERSION_BUILD=0 -DVERSION=\""v3.2.0beta\"" -DQT_NO_CAST_TO_ASCII -DQT_USE_FAST_CONCATENATION -DQT_USE_FAST_OPERATOR_PLUS -DBOOST_FILESYSTEM_VERSION=2 -DQT_NO_DEBUG -DQT_DBUS_LIB -DQT_XML_LIB -DQT_GUI_LIB -DQT_NETWORK_LIB -DQT_CORE_LIB -DQT_SHARED
 CFLAGS        = -m64 -pipe -O2 -D_REENTRANT -Wall -W $(DEFINES)
-CXXFLAGS      = -m64 -pipe -g -O2 -Wformat -Wformat-security -O2 -D_REENTRANT -Wall -W $(DEFINES)
+CXXFLAGS      = -m64 -pipe -g -O2 -Wformat -Wformat-security -O1 -D_REENTRANT -Wall -W $(DEFINES)
 INCPATH       = -I/usr/share/qt4/mkspecs/linux-g++-64 -I. -I/usr/include/qt4/QtCore -I/usr/include/qt4/QtNetwork -I/usr/include/qt4/QtGui -I/usr/include/qt4/QtXml -I/usr/include/qt4/QtDBus -I/usr/include/qt4 -I/usr/include -I/usr/local/include/libtorrent -I/usr/local/include -I. -Iapp -Iapp/qtsingleapplication -Iwebui/qjson -Igui -Igui/lineedit/src -Igui/properties -Igui/rss -Igui/geoip -Igui/powermanagement -Igui/qtnotify -Isearchengine -I. -I.
 LINK          = g++
 LFLAGS        = -m64 -Wl,-O1 -rdynamic
```

EDIT: and ""-O3"" works fine (?!?!?)
EDIT2: Using gcc 4.9.2
"
96388030,2892,sledgehammer999,2015-04-26T14:11:29Z,"@pmzqla the convert_from_native error might be related/fixed by this commit in the RC_1_0 branch: http://sourceforge.net/p/libtorrent/code/10958/
"
96402034,2892,glassez,2015-04-26T15:48:18Z,"Yeah, I caught it!
From Qt 4 Docs:

> **std::string** QString::**toStdString()** const
> Returns a std::string object with the data contained in this QString. The Unicode data is converted into 8-bit characters using the **toAscii()** function.

From Qt 5 Docs:

> **std::string** QString::**toStdString()** const
> Returns a std::string object with the data contained in this QString. The Unicode data is converted into 8-bit characters using the **toUtf8()** function.

Try to test updated code.
"
96409022,2892,sledgehammer999,2015-04-26T17:00:21Z,"@glassez I confirm that the encoding issue is gone now. But can you tell me what you did differently now? Point me to the relevant code? I also see that you totally deleted misc::toQStringU() functions. What took their place?
Also forget about the ""Follow Symbol Under Cursor"" problem. I don't seem to be able to reproduce it now. Probably a faulty state of QtCreator.
"
96409774,2892,glassez,2015-04-26T17:08:02Z,"@sledgehammer999 I replaced `QString::toStdString()` with utility function `String::toStdString()`. See `core/utils/string.cpp`.
`misc::toQStringU()` and `misc::toQString()` replaced with `String::fromStdString()` (just more informative name). But it is not relevant to this problem.
"
96410364,2892,sledgehammer999,2015-04-26T17:21:11Z,"I am not sure `String` should be used as a namespace. Too generic and very close to QString and std::string. But this isn't important enough to address it now. If someone has a better naming, he should tell it.
I was wondering what you changed here, because previously I had looked at the code of the content model that requested filenames and they all used toQStringU() correctly. So I cannot understand how QString::toStdString() fits in the picture.
"
96410915,2892,glassez,2015-04-26T17:24:21Z,"We used QString::toStdString() when call libtorrent functions (like rename_file() and so on).
"
96411892,2892,glassez,2015-04-26T17:35:59Z,"> I am not sure String should be used as a namespace. Too generic and very close to QString and std::string.

Actually, I intend to place all utility functions in a namespace Utils. So it will be a Utils::String.
"
96743372,2892,ngosang,2015-04-27T17:10:31Z,"@glassez It's broken. Check Travis logs.
"
96792687,2892,ngosang,2015-04-27T19:41:33Z,"Codification problem is solved. What about ..?
- When torrent download finishes the torrent extension (.!qB) isn't removed.
- There is a problem with the upload ratio. It works but when you close and open qBi the upload ratio is set to 0.00.
"
96972751,2892,glassez,2015-04-28T08:29:42Z,"@ngosang Thank you for testing!
But could you provide a little more information? It always happens or under some certain conditions. What settings do you use when testing qBittorrent (for example, saving to temporary folder). Single- or multifile torrent cause this issue.
"
97109708,2892,ngosang,2015-04-28T15:38:51Z,"Qt 4.8 + libtorrent-0.16.17

> When torrent download finishes the torrent extension (.!qB) isn't removed.

Save files to location => /mnt/DOWNLOADS/Descargas
Keep incomplete torrents in => /mnt/DOWNLOADS/Temp
I downloaded 10 torrents and all files have the (.!qB) extension after download is complete. (Single and multifile torrent cause this issue)
EDIT: This problem causes many more problems because the next time you try to share the torrent qBittorrent thinks you renamed or removed so there is a I/O error. He thinks the files don't have the extension.

> There is a problem with the upload ratio. It works but when you close and open qBi the upload ratio is set to 0.00.

It's simply not working. I add a new torrent and seems it's working but the uploaded and downloaded amount is not saved on qBittorrent close. To replicate this problem do this:
1) Download one torrent with many leechers, so you can upload some data, and wait until download finish.
2) Check the Uploaded/Downloaded/Ratio amounts in the transfers list and in the General tab.
3) File => Exit
4) Open qBittorrent again and see the Uploaded/Downloaded/Ratio amounts.
"
97135784,2892,glassez,2015-04-28T16:53:33Z,"This is replacement for old DownloadThread class.
"
97806624,2892,glassez,2015-04-30T14:03:36Z,"> When torrent download finishes the torrent extension (.!qB) isn't removed.

@ngosang, I cannot reproduce this issue. Please recheck with updated code.

> There is a problem with the upload ratio. It works but when you close and open qBi the upload ratio is set to 0.00.

Fixed. Please recheck.
"
97963802,2892,ngosang,2015-04-30T20:53:53Z,"> Fixed. Please recheck.

The ratio is fixed partially. If I look the uploaded amount for one torrent, close and reopen qBittorrent and look at that amount again the values are different. Looks like when qBittorrent closes don't save the last statistics for the torrent so the saved amount is always lower than the real one.

The (.!qB) extension is still there.

@pmzqla In one previous comment I explained the (.!qB) extension and ratio problems. Can you test it?
"
98040882,2892,glassez,2015-05-01T04:31:19Z,"> If I look the uploaded amount for one torrent, close and reopen qBittorrent and look at that amount again the values are different. Looks like when qBittorrent closes don't save the last statistics for the torrent so the saved amount is always lower than the real one.

This regression is exactly of this PR? qBittorrent master works correctly with this?
"
98093453,2892,ngosang,2015-05-01T10:15:58Z,"> This regression is exactly of this PR? qBittorrent master works correctly with this?

Master works perfect in all senses. Wait for the @pmzqla response but I think I'm doing everything well.
"
98120772,2892,pmzqla,2015-05-01T12:13:51Z,"I actually have other problems.

If I try to start a torrent, it's not added. If I add it again, qBittorrent tells me that it can't add it because the same torrent might be in a ""adding state"". This is what I get

```
Adding torrent...
 -> Hash: 356c390c955b889bd4b2ee2244522625f53f9ad3
# and nothing else happens
```

Magnet links work. However, metadata are not shown in the add torrent dialog AND the download actually starts even if I hadn't press OK.

I also think that the transferlist is not correctly updated, often the information displayed remain the same.

If I start a magnet before metdata are fetched, I can see the download start as I would expect, but I soon end up with:

```
*************************************************************
Catching SIGABRT, please report a bug at http://bug.qbittorrent.org
and provide the following backtrace:
qBittorrent version: v3.2.0beta
stack trace:
  /lib/x86_64-linux-gnu/libc.so.6 : gsignal()+0x37  [0x7f5381716107]
  /lib/x86_64-linux-gnu/libc.so.6 : abort()+0x148  [0x7f53817174e8]
  /usr/lib/x86_64-linux-gnu/libQtCore.so.4 : qt_message_output(QtMsgType, char const*)+0x12a  [0x7f538238da9a]
  /usr/lib/x86_64-linux-gnu/libQtCore.so.4 : ()+0x71e09  [0x7f538238de09]
  /usr/lib/x86_64-linux-gnu/libQtCore.so.4 : qFatal(char const*, ...)+0xa1  [0x7f538238e6f1]
  src/qbittorrent : TorrentContentModel::updateFilesProgress(QVector<double> const&)+0x38  [0x5f9ff8]
  src/qbittorrent : PropertiesWidget::loadDynamicData()+0xc32  [0x566fd2]
  /usr/lib/x86_64-linux-gnu/libQtCore.so.4 : QMetaObject::activate(QObject*, QMetaObject const*, int, void**)+0x32c  [0x7f53824b771c]
  /usr/lib/x86_64-linux-gnu/libQtCore.so.4 : QObject::event(QEvent*)+0xb3  [0x7f53824bbce3]
  /usr/lib/x86_64-linux-gnu/libQtGui.so.4 : QApplicationPrivate::notify_helper(QObject*, QEvent*)+0x8c  [0x7f5382d2348c]
  /usr/lib/x86_64-linux-gnu/libQtGui.so.4 : QApplication::notify(QObject*, QEvent*)+0x2b8  [0x7f5382d29fa8]
  src/qbittorrent : Application::notify(QObject*, QEvent*)+0x10  [0x495650]
  /usr/lib/x86_64-linux-gnu/libQtCore.so.4 : QCoreApplication::notifyInternal(QObject*, QEvent*)+0x8d  [0x7f53824a271d]
  /usr/lib/x86_64-linux-gnu/libQtCore.so.4 : ()+0x1b838b  [0x7f53824d438b]
  /usr/lib/x86_64-linux-gnu/libQtCore.so.4 : ()+0x1b53f9  [0x7f53824d13f9]
  /lib/x86_64-linux-gnu/libglib-2.0.so.0 : g_main_context_dispatch()+0x24d  [0x7f5380519c5d]
  /lib/x86_64-linux-gnu/libglib-2.0.so.0 : ()+0x49f48  [0x7f5380519f48]
  /lib/x86_64-linux-gnu/libglib-2.0.so.0 : g_main_context_iteration()+0x2c  [0x7f5380519ffc]
  /usr/lib/x86_64-linux-gnu/libQtCore.so.4 : QEventDispatcherGlib::processEvents(QFlags<QEventLoop::ProcessEventsFlag>)+0x5d  [0x7f53824d1d1d]
  /usr/lib/x86_64-linux-gnu/libQtGui.so.4 : ()+0x26bf96  [0x7f5382dc7f96]
  /usr/lib/x86_64-linux-gnu/libQtCore.so.4 : QEventLoop::processEvents(QFlags<QEventLoop::ProcessEventsFlag>)+0x41  [0x7f53824a1271]
  /usr/lib/x86_64-linux-gnu/libQtCore.so.4 : QEventLoop::exec(QFlags<QEventLoop::ProcessEventsFlag>)+0x1a5  [0x7f53824a15d5]
  /usr/lib/x86_64-linux-gnu/libQtCore.so.4 : QCoreApplication::exec()+0x99  [0x7f53824a7059]
  src/qbittorrent : Application::exec(QStringList const&)+0x1e6  [0x4953c6]
  src/qbittorrent : main()+0x578  [0x48d458]
  /lib/x86_64-linux-gnu/libc.so.6 : __libc_start_main()+0xf5  [0x7f5381702b45]
  src/qbittorrent() [0x491d08]
```

Built from ""glassez/bittorrent"" directly. I also cleared ""~/.config/qBittorrent"" and ""~/.local/share/data/qBittorrent"".
"
98122093,2892,glassez,2015-05-01T12:21:28Z,"@pmzqla What is your OS, libs, compiler etc.?
"
98147424,2892,pmzqla,2015-05-01T14:48:42Z,"Debian sid.

For this build I used: Qt 4.8.6, libtorrent 1.0.3, gcc 4.9.2, boost 1.55
"
98346804,2892,glassez,2015-05-02T10:34:24Z,"Damn, what am I doing wrong? I can't reproduce these bugs. Either you guys are hiding something.
Please include in your reports as much information as possible. This is especially true of the conditions of the tests. What settings are used, how do you add torrents (whether use addtorrentdialog or not, save it in the default folder, assign the label), what were you doing before that, etc.
Also you should make sure that before you start the test you have cleaned the build directory and downloaded the latest source code.
Apparently, I want more testers. @sledgehammer999 Do you have the time? Or I can count on you only after version 3.2 released?
"
98361957,2892,ngosang,2015-05-02T13:59:42Z,"**Archlinux Qt 4.8 + libtorrent-0.16.17 + gcc 4.9.2 + boost 1.57.0**
Fresh install.
I made a new folder and git clone the master branch, then I merged this PR. I also emptied this folders: **/home/XXXXX/.local/share/data/qBittorrent/** and **/home/XXXXX/.config/qBittorrent/**
I executed **./configure --with-libtorrent-rasterbar0.16** and then **make**.

Now all settings have the default value. I open QBittorrent, accept the legal notice, **enable the .!qB extension preference**, add new magnet dialog, I add 1 magnet link: magnet:?xt=urn:btih:D41EEC7C601A89000FD8808858A7AA12F31574B0&dn=debian+7+4+0+i386+netinst+iso&tr=udp%3A%2F%2Fopen.demonii.com%3A1337%2Fannounce
This torrent is SINGLE FILE. Two cases:
1) I click Accept before metadata is retrieved. **The torrent is not saved in the Downloads path**, it's in /tmp/d41eec7c601a89000fd8808858a7aa12f31574b0/debian-7.4.0-i386-netinst.iso.!qB **This problem only happens in Qt 4.8, in Qt 5 I think it's working.**
2) I click Accept after metadata is retrieved. The torrent is saved in the Downloads path. :+1: 
Torrent start downloading and I wait until it's completed. I go to the downloads folder and the single file don't have the  **.!qB** extension in both cases :+1:  (but in the 1st case the file is in a wrong folder).

If I repeat the both tests with the **.!qB extension preference DISABLED** the downloaded files **still have the .!qB extension and that extension isn't removed when torrent completes.** **This problem only happens in Qt 4.8, in Qt 5 I think it's working.**

I can't replicate the ratio problem but I'm sure it's there. I tried to replicade the @pmzqla problems but I can't.
"
98380739,2892,pmzqla,2015-05-02T17:17:24Z,"> @pmzqla the convert_from_native error might be related/fixed by this commit in the RC_1_0 branch: http://sourceforge.net/p/libtorrent/code/10958/

Yes, this fixes the problem.

@glassez For some reason, all the problems disappeared once I built qBittorrent with libtorrent 1.0.4 (with the patch linked by sledgehammer) instead of 1.0.3. The build finishes, downloads start, magnet waits for me to press OK. I don't know what was happening.

I can't reproduce the "".!qB"" problem.
"
98394818,2892,sledgehammer999,2015-05-02T20:02:49Z,"@glassez here is a hint on why the stats may not be saved correctly. (I didn't read your changes entirely). `torrent_handle::need_save_resume_data()` may not return true in case of a seeding torrent that only has its stats updated.
NOTE: When I say ""may"" I mean it as a guess not as a possibility that I have encountered.
Also the docs aren't very clear if need_save_resume_data() considers the above case. I think we should ask arvidn.
Libtorrent docs:

> **need_save_resume_data()**
> This function returns true if **any whole chunk has been downloaded** since the torrent was first loaded or since the last time the resume data was saved. When saving resume data periodically, it makes sense to skip any torrent which hasn't downloaded anything since the last time.
"
100525859,2892,sledgehammer999,2015-05-09T18:12:50Z,"@glassez my `git mergetool` autosolves the conflicts when rebasing. I use `kdiff3` as backend.
"
101060019,2892,sledgehammer999,2015-05-11T21:55:31Z,"I started reviewing this. -I'll try to ignore as much as possible from the deluge of new bugs/threads here and in the forum coming in for v3.2.0-
The first 3 commits are ok. I am looking at the fourth now. I'll leave inline comments.
"
101068510,2892,sledgehammer999,2015-05-11T22:45:15Z,"OK. I am done with the 4th commit. I'll wait your responses before continuing to the next one.
I also noticed that you have taken a whole another approach to Singletons. Now we have a triplet of static methods: `initInstance()`, `freeInstance()` and `instance()`. Why have you chosen this approach over the current one?
"
101151973,2892,glassez,2015-05-12T06:36:14Z,"> I also noticed that you have taken a whole another approach to Singletons. Now we have a triplet of static methods: initInstance(), freeInstance() and instance(). Why have you chosen this approach over the current one?

Singleton with lazy initialization is good when the program has several execution paths, some of which do not use these components.
We know exactly when and in what order we want to create (almost) all components of the application. Of course, you can leave the old version and call Singleton::instance() in the place where you want to create the object, but then why all the other `if (!m_instance)`? This is of course, not much will heat the CPU... But if we know that the object exists, I believe that this is unnecessary.
In addition, some of our Singletons depend on each other. What if (the old way) we will delete one of them and the other will call it instance() in the code that follows (though even in its destructor)? Even if we control it now, this may appear in future changes.
"
101349056,2892,sledgehammer999,2015-05-12T17:02:05Z,"I'll leave the Singleton talk aside for the moment. I'll come back to it when everything else is ready.
For now I have finished the review of https://github.com/glassez/qBittorrent/commit/af6a047749ee5748ed90878552c261a46852e168 too.
Commit https://github.com/glassez/qBittorrent/commit/17471ee03825bbd5c27b80fcb0927cb0c3b57dc1 is quite big. I am taking a break. I'll begin reading it later today.
"
101365154,2892,sledgehammer999,2015-05-12T17:53:55Z,"I took a quick peek at https://github.com/glassez/qBittorrent/commit/17471ee03825bbd5c27b80fcb0927cb0c3b57dc1 while doing something else. I noticed `infohash.h` and `cachestatus.h`. Please don't put code in headers. Split any such file into .h and .cpp.
"
101709616,2892,sledgehammer999,2015-05-13T15:08:25Z,"@glassez I noticed there are 5 more files in commit https://github.com/glassez/qBittorrent/commit/a684470ea4f4ec960fb7089b3f51ae3eddbe0272. Did you remove them from some previous commit that I reviewed?
Anyway, I have limited time today. I'll review the 5 new files later(they seem pretty straight forward) and maybe I'll start the next commit. I hope I can finish it today.
"
101720444,2892,glassez,2015-05-13T15:43:37Z,"> Did you remove them from some previous commit that I reviewed?

Done.
"
102142508,2892,ngosang,2015-05-14T19:20:42Z,"Offtopic
@sledgehammer999 Archlinux updated libtorrent-rasterbar to version 1.0.5 in official repo. https://www.archlinux.org/packages/?q=libtorrent-rasterbar
"
102181134,2892,sledgehammer999,2015-05-14T21:56:03Z,"> @sledgehammer999 Archlinux updated libtorrent-rasterbar to version 1.0.5 in official repo. 

OK. Is there a problem with that?
"
102184861,2892,ngosang,2015-05-14T22:13:25Z,"> OK. Is there a problem with that?

No, works perfect. Besides, qbittorrent-3.2.0 in the repo is compiled with it.
"
102864980,2892,sledgehammer999,2015-05-17T22:26:58Z,"That's it for today. Please don't push the changes I proposed. Leave it until I finish the commit. You can comment on something though.
PS: About the 0.16.x dropping: I can't remember what we agreed on. If I told you to also support 0.16.x then ignore my inline comments about dropping it.
"
103170598,2892,glassez,2015-05-18T18:49:14Z,"> But this is a very good opportunity to fix other things because: a) you are already doing a big code refactoring and b) I am looking at the affected sources closely and I spot things that could be done better. It would be horribly inefficient to come back and re-read it just to fix some if branches.
> Don't be afraid, I will not propose to do big internal restructuring to code that you didn't write.

It sounds convincing. In this case, I am at your service.
But if you notice any serious problems in the old code mentioned by me, it should be noted somewhere, to fix later. And there are enough problems, actually (as I noticed). There's something I have noted.
"
104741746,2892,glassez,2015-05-22T18:48:00Z,"@sledgehammer999 Please notify me when you finish with ""Redesign main core classes."". I'll update this PR because some next commits already changed.
"
104743081,2892,sledgehammer999,2015-05-22T18:55:56Z,"> Please notify me when you finish with ""Redesign main core classes.""

Of course. I am doing it in chunks because it is huge and I'm taking breaks. Currently reviewing the torrenthandle.cpp file. The only other big one left is session.cpp.
Don't push anything until I say I have finished.
"
104760501,2892,ppolewicz,2015-05-22T20:31:43Z,"If I want to make a fix for #2743 (so changing interface / port does not require a restart) should I do it on glassez/qBittorrent/bittorrent or on main trunk or somewhere else?
"
104771306,2892,sledgehammer999,2015-05-22T21:10:53Z,"@ppolewicz better wait a bit for this to be merged and have something solid to work on.
"
104787102,2892,ppolewicz,2015-05-22T22:10:41Z,"Ok. Is there any ETA on the merge?
"
104787704,2892,sledgehammer999,2015-05-22T22:15:58Z,"@ppolewicz From day to day. I am actively reviewing this. And it is the only thing I am focused on now.
"
105081216,2892,sledgehammer999,2015-05-25T00:23:00Z,"@glassez I finished all the **new** files from https://github.com/glassez/qBittorrent/commit/f7b496d17e75025153114ec00945d6a3154f8d18
What is left to see are the rest of the files. Most of them are you rearranging includes and adjusting var names.

However, I want to ask you something. I don't see the usefulness of the `SessionPrivate` and `TorrentHandlePrivate` classes. What are you trying to achieve?
"
105255728,2892,glassez,2015-05-25T15:52:56Z,"> However, I want to ask you something. I don't see the usefulness of the SessionPrivate and TorrentHandlePrivate classes. What are you trying to achieve?

The problem is that the Session needs to interact internally with TorrentHandle. For this purpose, these classes have some methods. We shouldn't make these methods public. But I don't want to do these classes friendly to each other, as they should have access only to a limited interface of each other. So I declared these methods as private in BitTorrent::BitTorrent Session and::TorrentHandle  classes and as public in SessionPrivate and TorrentHandlePrivate. External code uses interfaces of BitTorrent::\* classes, and they internally use *Private interfaces.
It might not be the best option. So I wrote in another comment that I'm still considering other internal structure options. But you don't have to worry about that, because the external interfaces of these classes will not affected (and, hence, code that interacts with them, will not change, too).
"
105258941,2892,glassez,2015-05-25T16:14:28Z,"@sledgehammer999 I will update this PR in the next couple of hours, so you could continue.
"
105265023,2892,glassez,2015-05-25T16:45:53Z,"PR updated.
"
105267439,2892,sledgehammer999,2015-05-25T16:51:31Z,"You shouldn't have done that. I haven't finished with the commit only with the new(green) files. I had requested for you to refrain from updating till I say so.
Luckily I still have the github email notifications that point to the old commit. It will be a pain going back forth between the commits.
"
105272314,2892,glassez,2015-05-25T17:19:32Z,"Oh, I'm sorry! I misunderstood you.
Maybe it's not so bad? I corrected what you pointed out in the current reviewed commit. And next commits.
"
105497424,2892,glassez,2015-05-26T11:48:12Z,"@sledgehammer999 I was able to restore previous state of this branch (in which it was prior to my last update). If you want, I'll revert this PR.
"
105509420,2892,sledgehammer999,2015-05-26T12:32:22Z,"No don't revert. Leave it as-is. I have locally your previous code. I'll checkout the new code in a new branch and compare. Then I'll begin commenting on the rest of the files. (probably tomorrow)
"
107176578,2892,sledgehammer999,2015-05-31T13:17:29Z,"I finished with the whole PR. Now you can fix/answer my inline comments and we're good to merge.

I want to ask(or note some general observations):
1. What happens if a user closes qbt before a magnet has downloaded its metadata? How do we restore that magnet?
2. Why do you create a file lock for the resume folder? Did you notice problems without it?
3. Inside `Session::addTorrent_impl()` we should initialize `libtorrent::add_torrent_params::file_priorities` directly from `BitTorrent::AddTorrentData::filePriorities` and not after the torrent has been added to the session.
4. I propose using lowercase names for namespaces to differentiate from class names. Plus I propose the `BitTorrent` namespace become `bt`.
"
108232454,2892,glassez,2015-06-03T07:38:33Z,"> What happens if a user closes qbt before a magnet has downloaded its metadata? How do we restore that magnet?

This can be divided into two different cases.
1. If we add magnet with dialog and the user closed the program (or system crash) before loading the metadata, we do not have any way to fix this, because the torrent has not yet been added to the session.
2. If we add without dialog (or what is the same, clicked there ""OK"" without waiting for downloading the metadata), then the torrent is added to the session and we have to resume, even if it has no metadata. Now this is not yet implemented. I plan to do this later. I have an idea - we can save magnet URI in fastresume file in that case, if the torrent hasn't metadata, and then (when you resume) use this if there is no torrent file.

> Why do you create a file lock for the resume folder? Did you notice problems without it?

In the previous code we had to check for the existence of this folder each time it is accessed. Now we are sure that it exists throughout the program. It would be nice also lock the ability to change access rights, but I don't know how to do it.

> Inside Session::addTorrent_impl() we should initialize libtorrent::add_torrent_params::file_priorities directly from BitTorrent::AddTorrentData::filePriorities and not after the torrent has been added to the session.

I wanted to do it, but for some reason I thought that such a possibility should be kept in `libtorrent::torrent_info` (through which I made a preliminary renaming files), but couldn't find it there.
Thanks for the tip. Done.

> I propose using lowercase names for namespaces to differentiate from class names. Plus I propose the BitTorrent namespace become bt.

Technically, **class** = **namespace** + **struct** + etc. So I see no reason to apply different naming.
Usually, lowercase namespace names are used where it is customary to call all in lowercase (for example, in libtorrent). I prefer not to use such a naming scheme.
However, if you insist, we'll change that.
At the expense of **bt**. Not good to use acronyms and other abbreviations in such names (even the names of the variables, except for some simple cases, should be as informative as possible). Exceptions can be only some well-known abbreviations (e.g., Utils, Fs, Misc, etc.) or too small reduction in long words, do not interfere with the perception of their meaning. If you care about the enter code screen space, then (trust me) it's not the greatest evil (especially now, in the era of big monitors). This is my (and not only my) opinion on the matter. The final decision for you. The only request is if we change it, it is easier to do it in a separate commit (I was so tired from rebasing).

@sledgehammer999 I finished all the fixes. If there are no additions here, I will update the PR. Waiting for your answer.
"
108544736,2892,sledgehammer999,2015-06-03T17:48:57Z,"OK. No change for the namespaces.

> I plan to do this later. I have an idea - we can save magnet URI in fastresume file in that case

Unless, I am wrong libtorrent doesn't generate(even dummy) fastresume for magnets.

> It would be nice also lock the ability to change access rights, but I don't know how to do it.

Don't bother with it. And I don't think this is even possible. However, we could preemptively test at startup if the folder is writable+readable by the program. If not, abort gracefully and inform the user of the situation.

> If there are no additions here, I will update the PR.

You can update the PR. I also left a final inline comment for your consideration/information.
"
108573856,2892,glassez,2015-06-03T18:53:47Z,"> Unless, I am wrong libtorrent doesn't generate(even dummy) fastresume for magnets.

Anyway, I will try to solve it somehow.

> However, we could preemptively test at startup if the folder is writable+readable by the program.

Create a lock file also solves this problem (at least partially).
"
108580023,2892,sledgehammer999,2015-06-03T19:04:52Z,"> Anyway, I will try to solve it somehow.

We could just write a bencoded file containing a dictionary(aka a dummy fastresume). The filename scheme would be the same. But in there we just save the magnet uri, the save path, paused, etc...
(of course libtorrent might generate the resume already)
"
108870815,2892,glassez,2015-06-04T12:23:34Z,"> We could just write a bencoded file containing a dictionary(aka a dummy fastresume). The filename scheme would be the same. But in there we just save the magnet uri, the save path, paused, etc...

Done. Waiting to create new PR.
"
110494270,2892,sledgehammer999,2015-06-09T20:24:02Z,"OK. Only the last comment remains.
"
111274869,2892,sledgehammer999,2015-06-11T20:54:02Z,"Thank you very much for your hard work.
"
111275523,2892,ngosang,2015-06-11T20:57:33Z,"OMG, I've been waiting for months. Should I rebase my other PR?
"
111492366,2892,onto,2015-06-12T13:24:36Z,"I have empty torrents list after build last version from master with these commits, how to restore it?
I copy *.fastresume and *.torrent files from ~/.local/share/data/qBittorrent/BT_backup to ~/.local/share/data/qBittorrent/ResumeData but nothing change.
"
111496367,2892,glassez,2015-06-12T13:42:05Z,"> Fastresume file name format:
>     <torrent_info_hash>.fastresume.<torrent_queue_position>
> E.g.:
>     fc8a15a2faf2734dbb1dc5f7afdc5c9beaeb1f59.fastresume.2

You can use 0 as <torrent_queue_position> for all your torrents (or actual queue positions if you know).
"
111496568,2892,equeim,2015-06-12T13:42:58Z,"Build error with --disable-gui:

```
app/main.cpp: In function 'int main(int, char**)':
app/main.cpp:201:25: error: 'daemon' was not declared in this scope
         if ((daemon(1, 0) == 0)) {
                         ^
```
"
111497449,2892,glassez,2015-06-12T13:47:49Z,"@equeim If you want a reply, you need to properly ask a question. 
When compilation errors, you must specify the version of the OS, compilers, libraries, etc.

UPD: Have you tried to build qBittorrent just before #2892 was merged?
"
111500467,2892,equeim,2015-06-12T13:53:48Z,"Gentoo GNU/Linux, GCC 4.9.2, Qt 5.4.1, libtorrent 1.0.5. Build with disabled GUI is broken after merging this pull request.
"
111508824,2892,ngosang,2015-06-12T14:18:00Z,"I confirm the --disable-gui problem too.
"
111512220,2892,glassez,2015-06-12T14:26:04Z,"Try to put

``` c++
#ifdef Q_OS_UNIX
#include <unistd.h>
#endif
```

after line 51 of main.cpp (after `#include <cstdio>`).
"
111543000,2892,equeim,2015-06-12T16:21:54Z,"This fixed the issue.
"
111576797,2892,sledgehammer999,2015-06-12T18:05:15Z,"And yet [travis](https://travis-ci.org/qbittorrent/qBittorrent/builds/66445744) didn't error out in the nox builds....
"
111593294,2892,glassez,2015-06-12T19:18:14Z,"Apparently, earlier this header was included via some other. Obviously, in some configurations, it still does. I, like Travis, have had no build problems.
"
111694644,2892,Gelmir,2015-06-13T10:08:35Z,"Too bad there was no automatic migration for fastresume.
1. Move everything to ResumeData
2. Run this script from ResumeData (remove -WhatIf to disable ""dry-run"" mode)

``` powershell
Get-ChildItem -Force .\ -Recurse -Include *.fastresume |
    Rename-Item -NewName {$_.name -replace '.fastresume','.fastresume.0' } -WhatIf
```
"
111695534,2892,sledgehammer999,2015-06-13T10:13:16Z,"@Gelmir see this comment(and the following): https://github.com/qbittorrent/qBittorrent/issues/2433#issuecomment-111276419
"
111863635,2892,ngosang,2015-06-14T18:44:35Z,"I noticed that the sorting order has changed again #2501:
![](http://i.imgur.com/UHvg5Qv.png)
"
427559047,9600,dzmat,2018-10-06T09:14:35Z,Reworded commit message. Also fixup-ed and rebased.
427717650,9600,glassez,2018-10-08T04:09:16Z,">@zeule, @thalieht, @ngosang, @onto: Review, please?

@LordNyriox, such comments are at least meaningless (actually they are pleasing). Especially in the actively reviewed PR. Even in the absence of activity, there are usually reasons for this (e.g. lack of free time)."
427884449,9600,dzmat,2018-10-08T15:46:18Z,"Squashed, rebased."
429543736,9600,glassez,2018-10-13T13:53:14Z,Thank you all!
173432650,3235,Chocobo1,2016-01-21T02:34:08Z,"I think this PR will have a better chance of getting merged by making these options available in ""advanced options"". Maybe later when I find time.
"
178441409,3235,Chocobo1,2016-02-02T08:26:16Z,"Commits & first post updated.
"
304206664,3235,Chocobo1,2017-05-26T06:52:41Z,">@Chocobo1: ?

I plan to resurrect it after I'm done with other things, it's very low prio now."
321564854,3235,sledgehammer999,2017-08-10T14:18:14Z,"@Chocobo1 FYI, this is approved. You can resurrect and merge. And probably you don't need 3 separate commits."
321565773,3235,sledgehammer999,2017-08-10T14:21:16Z,"@Chocobo1 I think `guided_read_cache` and `use_parole_mode` can always be on. IMO, they don't need a user setting."
321737086,3235,Chocobo1,2017-08-11T06:00:00Z,">I think guided_read_cache and use_parole_mode can always be on. IMO, they don't need a user setting.

libtorrent made `use_parole_mode = true` as default, I'll drop this one.
As for `guided_read_cache`, it's disabled by default in libtorrent and might not get enough testing.
IMO make it tunable is better.

>FYI, this is approved. You can resurrect and merge. And probably you don't need 3 separate commits.

Now I plan to add some other options, I'll put out a PR first, then we can bargain."
321976399,3235,Chocobo1,2017-08-12T11:50:49Z,"@sledgehammer999 @glassez 
I've updated this PR and now it add options for the following settings:
```
guided_read_cache
mixed_mode_algorithm
allow_multiple_connections_per_ip
choking_algorithm
seed_choking_algorithm
suggest_mode
send_buffer_watermark
send_buffer_low_watermark
send_buffer_watermark_factor
```"
322212756,3235,Chocobo1,2017-08-14T14:54:55Z,"@sledgehammer999 
I think it's ready, the only thing left is https://github.com/qbittorrent/qBittorrent/pull/3235#discussion_r132818135"
322233033,3235,sledgehammer999,2017-08-14T16:07:01Z,">I think it's ready, the only thing left is #3235 (comment)

Shit. I thought I had replied to this. Yes. No problem. Approved by me.
Now @glassez remains to revoke his block."
322389010,3235,Chocobo1,2017-08-15T06:39:01Z,PR updated.
323724974,3235,Chocobo1,2017-08-21T11:54:47Z,Updated.
324352933,3235,Chocobo1,2017-08-23T14:31:03Z,"@evsh  @sledgehammer999 
Any comments?"
324367424,3235,zeule,2017-08-23T15:11:49Z,"> Any comments?

No."
324523827,3235,Chocobo1,2017-08-24T03:36:21Z,thanks to everyone
340542463,3235,Seeker2,2017-10-30T18:35:23Z,"Was announce_to_all_tiers dropped because qBitTorrent lacks the GUI support for it?

Send upload piece suggestions cripples upload speed for some reason. I'm guessing it's an super/initial seeding type of feature to be used with low upload max?

prefer_tcp set to false also causes local peers to slow to almost nothing when internet uTP peers are connected even when LAN speeds are set to unlimited."
340585853,3235,sledgehammer999,2017-10-30T21:11:56Z,@Seeker2 look at #7660
413577862,9349,Chocobo1,2018-08-16T15:04:59Z,"I was thinking, are there other parameters than --portable that user will want to put in .params file?
If not, it could be a lot easier to just detect the file (""portable"" or whatever) existence and add `--portable` to argv list.
Either way, this PR is a great step towards true portable mode.

Also I reckon this feature should be windows only."
413650301,9349,zeule,2018-08-16T18:58:38Z,"Well, one can use the `--profie` there too. I just feel weird about changing application behaviour with appearance or disappearance of a directory. 

> Also I reckon this feature should be windows only.

Linux users use flash drives too."
413747014,9349,Chocobo1,2018-08-17T03:24:54Z,">Well, one can use the --profie there too. I just feel weird about changing application behaviour with appearance or disappearance of a directory.

OK, AFAIK it is quite common on Windows apps, to name a few, foobar2000, utorrent, mpc-hc, ccleaner, they just detect some file or directory and goes into portable mode if exists."
416328459,9349,sledgehammer999,2018-08-27T18:48:42Z,"Does [QCoreApplication::applicationFilePath()](https://doc.qt.io/qt-5/qcoreapplication.html#applicationFilePath), which is static, actually require a Q*Application running instance?"
416517919,9349,zeule,2018-08-28T09:37:33Z,"Yes, it requires an initialised app object."
416690006,9349,zeule,2018-08-28T18:21:11Z,"@LordNyriox: yes, any command line parameter can be read from that file.  "
416773177,9349,sledgehammer999,2018-08-28T23:29:04Z,@zeule I hope you didn't copy the getexename()/executablePath() code from another codebase without mentioning it.
417017391,9349,glassez,2018-08-29T16:30:08Z,">Not sure that putting the function to obtain executable path in the utils is the right way to go, because it is used only in main() before when the application object is not yet created.

I would put them in the ""main.cpp""."
417020819,9349,glassez,2018-08-29T16:40:15Z,"@sledgehammer999, is this feature generally approved?"
417021794,9349,glassez,2018-08-29T16:43:05Z,"@zeule, what about param redefinition? What source is preferred? Command line or file?"
417030691,9349,zeule,2018-08-29T17:08:31Z,"@glassez: command line, of course, because they go last. The same as you pass a parameter via the command line twice."
417417649,9349,zeule,2018-08-30T18:17:16Z,"Shortened the function, moved it into the main.cpp file."
418177121,9349,zeule,2018-09-03T18:54:16Z,"Would a menu command (""Tools|Enable portable mode"") to write/remove the portable switch to/from the .params file provide a better user experience?"
418428405,9349,glassez,2018-09-04T16:14:30Z,">Would a menu command (""Tools|Enable portable mode"") to write/remove the portable switch to/from the .params file provide a better user experience?

I think not.
It should be separate distro for ""portable"" version (or option in installer to generate ""portable"" installation."
418646432,9349,sledgehammer999,2018-09-05T08:33:18Z,">It should be separate distro for ""portable"" version (or option in installer to generate ""portable"" installation.

For Windows, I can start providing a 7z ""portable"" distro along with the installers. (separate link/file)

Apart from the comment style fixes is there anything else holding this PR back?"
418647033,9349,sledgehammer999,2018-09-05T08:35:19Z,">@sledgehammer999, is this feature generally approved?

Yes. Unless there is a better way proposed to signal portable mode in an automatic way."
418658148,9349,glassez,2018-09-05T09:11:42Z,">Apart from the comment style fixes is there anything else holding this PR back?

Certainly. This PR contains many other coding style violations, as I mentioned earlier."
418681845,9349,mzso,2018-09-05T10:30:49Z,"[**@glassez**](https://github.com/glassez) commented on [2018. szept. 4. 18:14 CEST](https://github.com/qbittorrent/qBittorrent/pull/9349#issuecomment-418428405 ""2018-09-04T16:14:30Z - Replied by Github Reply Comments""):
> It should be separate distro for ""portable"" version (or option in installer to generate ""portable"" installation.

[**@sledgehammer999**](https://github.com/sledgehammer999) commented on [2018. szept. 5. 10:33 CEST](https://github.com/qbittorrent/qBittorrent/pull/9349#issuecomment-418646432 ""2018-09-05T08:33:18Z - Replied by Github Reply Comments""):
> For Windows, I can start providing a 7z ""portable"" distro along with the installers. (separate link/file)

How about both? I see no reason for the installer to not have the option."
418693974,9349,sledgehammer999,2018-09-05T11:17:04Z,">How about both? I see no reason for the installer to not have the option.

It's easier to have the executable ready than waiting an installer to output them
Easier for me. The installer programming language will complicate this extra option."
419361986,9349,zeule,2018-09-07T08:20:56Z,"The installer just needs an option to output a prepared file with the command line switches, doesn't it?"
419363137,9349,zeule,2018-09-07T08:25:22Z,"> Certainly. This PR contains many other coding style violations, as I mentioned earlier.

Can't fix them unless you point them out. "
419373688,9349,mzso,2018-09-07T09:02:45Z,"[**@zeule**](https://github.com/zeule) commented on [2018. szept. 7. 10:20 CEST](https://github.com/qbittorrent/qBittorrent/pull/9349#issuecomment-419361986 ""2018-09-07T08:20:56Z - Replied by Github Reply Comments""):
> The installer just needs an option to output a prepared file with the command line switches, doesn't it?

One might want to update a portable instance, and the file since it's not exclusively for portable mode might have other content.

By the way this effects an archived package also, also a lot more negatively. Because the installer could handle this automatically, but the user needs to remember that the file was customized and recognize that overwriting with all files the package will destroy this customizations. (Thus the upgrade process is a fair bit more complicated)

(I ran into an issue like this with Notepad++, which nonsensically has a default hotkeys file instead of creating one, so my hotkey customizations were always reset to default, before I discovered what was happening.)"
419377621,9349,zeule,2018-09-07T09:17:32Z,"I don't quite share your concerns, because if the file was installed via an installer, editing it is like patching the executable itself. If users do that, they are expected to maintain their modifications.

I can submit another one (abandoning this one)
1. Implement a tiny executable that sets the portabke mode via the environemnt variable or command line swithch and call the actual qBt executable. 
2. Change the installer code to rename qbittorent.exe and install the new executable under that name instead.

But, frankly, the params file seems to be simpler and robuster to me."
419381761,9349,mzso,2018-09-07T09:32:28Z,"[**@zeule**](https://github.com/zeule) commented on [2018. szept. 7. 11:17 CEST](https://github.com/qbittorrent/qBittorrent/pull/9349#issuecomment-419377621 ""2018-09-07T09:17:32Z - Replied by Github Reply Comments""):
> I don't quite share your concerns, because if the file was installed via an installer, editing it is like patching the executable itself. If users do that, they are expected to maintain their modifications.
> 

Are you joking? How can you say editing a text file meant to hold custom parameters that can't even be modified by the app itself is like patching an executable? Waving the issue off won't make it less of a problem for users.

> But, frankly, the params file seems to be simpler and robuster to me.

An an empty *.portable file would be simple and robust. This way you need to deal with whatever parameters that were added."
419385609,9349,zeule,2018-09-07T09:45:51Z,"> Are you joking?

No, I'm not. Why would I be? Everything installed be an installer or another package manager is read-only for a user. I must admit that the idea of using an installer for a portable application looks odd to me. Maybe you could share a use-case, please?

> An an empty *.portable file would be simple and robust. 

Not that robust as it can't contain profile directory and I can easily imagine why cache and temp directories (the last one is not implemented yet in the portable mode) should not reside near the application binary."
419410252,9349,mzso,2018-09-07T11:24:30Z,"[**@zeule**](https://github.com/zeule) commented on [2018. szept. 7. 11:45 CEST](https://github.com/qbittorrent/qBittorrent/pull/9349#issuecomment-419385609 ""2018-09-07T09:45:51Z - Replied by Github Reply Comments""):

> No, I'm not. Why would I be? Everything installed be an installer or another package manager is read-only for a user. I must admit that the idea of using an installer for a portable application looks odd to me. Maybe you could share a use-case, please?
> 

This just sounds like your bias to me. Using an installer option to generate a portable instance is not unheard of, it's practical.

Besides in a portable instance it's normal for the user to manipulate files.

It's not that the .params file is not meant to be edited. How do you image people would use it?

> > An an empty *.portable file would be simple and robust.
> 
> Not that robust as it can't contain profile directory and I can easily imagine why cache and temp directories (the last one is not implemented yet in the portable mode) should not reside near the application binary.

"
419412770,9349,zeule,2018-09-07T11:36:32Z,"Sorry, I can't see how it can be practical. Portable app is meant to be taken away from a system where it was set up. Then how the package can be unistalled, for example? Updated?  

> Besides in a portable instance it's normal for the user to manipulate files.

Exactly! But not with the installer program. 

> How do you image people would use it?

In my vision the portable app is created by copying an existing installation/package archive file contents and then the files can be manipulated as needed. "
419415785,9349,glassez,2018-09-07T11:51:12Z,I still prefer have separate portable build to avoid start time slowdown (because of reading some files etc.).
419416108,9349,glassez,2018-09-07T11:52:35Z,I'm also not sure this method won't break commandline parameter handling on Windows.
419423669,9349,mzso,2018-09-07T12:26:39Z,"[**@zeule**](https://github.com/zeule) commented on [2018. szept. 7. 13:36 CEST](https://github.com/qbittorrent/qBittorrent/pull/9349#issuecomment-419412770 ""2018-09-07T11:36:32Z - Replied by Github Reply Comments""):
> Sorry, I can't see how it can be practical. Portable app is meant to be taken away from a system where it was set up. Then how the package can be unistalled, for example? Updated?
> 
You run the installer, point it to the existing portable instance's folder, and it would update it.
Uninstalling? You delete the folder if you don't need it anymore.

> > Besides in a portable instance it's normal for the user to manipulate files.
> 
> Exactly! But not with the installer program.
> 

The installer's purpose would be to not overwrite the .params file if it's modified. (And add the portable switch, when selecting portable mode, otherwise it would not make sense.)

> > How do you image people would use it?
> 
> In my vision the portable app is created by copying an existing installation/package archive file contents and then the files can be manipulated as needed.

Manually? That'd remarkably cumbersome."
419433139,9349,zeule,2018-09-07T13:06:02Z,"> I'm also not sure this method won't break commandline parameter handling on Windows.

In what way?

@mzso, I was always sure that the main purpose of a installer package is to track installed entities and remove all of them when uninstall is requested. This is certainly impossible with a portable application.  Deleting files does not mean reverting system changes made during the installation. Probably, I just don't understand why do you need a portable qBt and how would you use it."
419445838,9349,mzso,2018-09-07T13:51:17Z,"[**@zeule**](https://github.com/zeule) commented on [2018. szept. 7. 15:06 CEST](https://github.com/qbittorrent/qBittorrent/pull/9349#issuecomment-419433139 ""2018-09-07T13:06:02Z - Replied by Github Reply Comments""):
> Deleting files does not mean reverting system changes made during the installation. Probably, I just don't understand why do you need a portable qBt and how would you use it.

There are no system changes to revert with a portable instance

> [@mzso](https://github.com/mzso), I was always sure that the main purpose of a installer package is to track installed entities and remove all of them when uninstall is requested. This is certainly impossible with a portable application. 

I see no reason why it couldn't also be used for creating and upgrading portable instances "
419481401,9349,zeule,2018-09-07T15:45:24Z,"> There are no system changes to revert with a portable instance

Untrue, there are registry records. 

> I see no reason why it couldn't also be used for creating and upgrading portable instances

In this case what is the difference between an installation and an archive?"
419629499,9349,glassez,2018-09-08T10:15:05Z,"Still, I don't see any serious reason not to have a separate ""portable"" build. Why do we need all these "".params"" files, etc.?
Let's consider the following. ""Portable"" build just uses predefined profile location (i.e. exe folder) and has ""portable"" mode enabled by default.
Why we need ""portable"" mode as runtime option at all? Why someone needs to use the same installation in both modes?"
419676769,9349,mzso,2018-09-08T22:25:00Z,"[**@glassez**](https://github.com/glassez) commented on [2018. szept. 8. 12:15 CEST](https://github.com/qbittorrent/qBittorrent/pull/9349#issuecomment-419629499 ""2018-09-08T10:15:05Z - Replied by Github Reply Comments""):
> Still, I don't see any serious reason not to have a separate ""portable"" build. Why do we need all these "".params"" files, etc.?  
> 
> Let's consider the following. ""Portable"" build just uses predefined profile location (i.e. exe folder) and has ""portable"" mode enabled by default.  
> 
> Why we need ""portable"" mode as runtime option at all? Why someone needs to use the same installation in both modes?

It's fine by me. (whether it's packaged separately or not.)"
420912596,9349,glassez,2018-09-13T07:35:02Z,">>I'm also not sure this method won't break commandline parameter handling on Windows.
>
>In what way?

From `QCoreApplication::arguments()` docs:
_On Windows, the list is built from the argc and argv parameters only if modified argv/argc parameters are passed to the constructor. **In that case, encoding problems might occur.**_"
421342632,9349,zeule,2018-09-14T12:25:34Z,"@glassez, I don't understand what does the quoted text have to do with the changes in this PR. If one wants to abuse the Qt's parameter parser, it doesn't matter how to pass strings, either via the command line directly, or writing them into a file and reading afterwards."
422124958,9349,glassez,2018-09-17T18:39:35Z,">If one wants to abuse the Qt's parameter parser, it doesn't matter how to pass strings, either via the command line directly, or writing them into a file and reading afterwards.

No. It's about valid use case.
Qt don't use argc/argv on Windows by default since it contains strings in 8-bit encoding and so it cannot correctly handle params containing characters missing in such code page. It is use `GetCommandLineW()` instead.
But when you pass modified argc/argv to the QApplication constructor Qt has to use it. **_In that case, encoding problems might occur._** E.g. in case when user tries to open some file containing any of missing in current code page characters."
422504427,9349,zeule,2018-09-18T18:45:12Z,"Aha, thanks! Reading Qt sources helps. My god, what a dirty hack... OK then, I will hook into the `QBtCommandLineParameters` class.
"
423772762,9349,sledgehammer999,2018-09-22T20:55:27Z,"I don't want to poop the party but I have opened #9584 as an alternative.
(Also, I haven't read the last discussions in here for at least a week)"
438310837,9349,zeule,2018-11-13T15:38:14Z,"It was nice to control Qt options from that fiel, but Qt documentation does not agree. Thus the PR was greatly simplified. The .params file is read during the internal qBt parameters parsing."
563925042,9349,glassez,2019-12-10T08:34:26Z,"@Chocobo1, @sledgehammer999, are we still interested in this feature? (given the fact that the author has been inactive for a long time)"
562857329,11592,sledgehammer999,2019-12-07T14:49:02Z,"Guys, I think I addressed all your comments so far. Take a look at the new commit."
562921055,11592,SadPencil,2019-12-08T07:39:19Z,"As an IPv6 user, can't wait for this bug being fixed. I hope this fix could be approved fastly."
562936390,11592,sledgehammer999,2019-12-08T11:16:26Z,"In this push, I addressed almost all the comments, apart 2 from glassez."
563291012,11592,sledgehammer999,2019-12-09T15:26:08Z,I think I addressed everything and I did some furhter refactor. Due to that I implemented it as a separate temporary commit. It will be easier for you to see what I changed.
563292406,11592,sledgehammer999,2019-12-09T15:29:10Z,The missing part is the webui code itself. @Chocobo1 will you be able to plug in the correct js/html changes?
563300376,11592,Chocobo1,2019-12-09T15:47:33Z,">@Chocobo1 will you be able to plug in the correct js/html changes?

Currently I'm low on free time to write code unfortunately."
563764120,11592,glassez,2019-12-10T04:26:57Z,">An empty string for all address is fine for me or even better IMO: 0.0.0.0,::

Isn't empty string treated as ""any IP"" by app core? Then it should be used here as well."
564086458,11592,sledgehammer999,2019-12-10T15:28:53Z,"Now the webui receives an empty string to mean all addresses, `0.0.0.0` to mean All IPv4 addresses and `::` to mean All IPv6 addresses. This seems to have the benefit of the least possible code/refactoring.

I also changed how the GUI populates the comboboxes to match the logic of the WebUI comboboxes.

And I probably changed other things here and there. So forgive me but please take another look at the whole thing."
564204792,11592,sledgehammer999,2019-12-10T19:25:20Z,"On another note, I just noticed that we do a lot of
```c++
// ifaceAddr is of type QHostAddres
functionThatTakesQString(ifaceAddr.isNull() ? QString {} : ifaceAddr.toString());
```

But I realize that we can collapse it to:
```c++
functionThatTakesQString(ifaceAddr.toString());
```

I'll make the changes later (only code affected by me)."
564532564,11592,sledgehammer999,2019-12-11T13:11:17Z,Closes #11632
565037198,11592,sledgehammer999,2019-12-12T14:48:02Z,@glassez do you approve?
565039149,11592,glassez,2019-12-12T14:52:25Z,I would still change canonicalIPv6Addr to suggested canonicalIPAddr form. But you can ignore this opinion.
565041647,11592,sledgehammer999,2019-12-12T14:58:00Z,">I would still change canonicalIPv6Addr to suggested canonicalIPAddr form.

IMO, I don't want to give the impression that the function can be used with IPv4. (Yes, it will work but it shouldn't be used for IPv4)."
565110920,11592,glassez,2019-12-12T17:43:41Z,">it shouldn't be used for IPv4

You cannot forbid it since function accepts generic host address (function name isn't enough, there can be use case when parameter is bypassed unchecked). You either can break it at runtime (throw an exception) or change it to be valid (have a meaning) for any kind of host address.
If my argument is irrelevant to you, you can merge this PR, I have nothing to add."
565125990,11592,sledgehammer999,2019-12-12T18:24:39Z,"No, I meant that it is discouraged through the function name.

Thank you all for the reviewing."
568168024,11592,ghost,2019-12-21T09:48:55Z,"This introduced the tracker not working bug in v 4.2.1
The annnounce goes through and tracker status says ""working"" but still the torrent gets moved to error section unless you expilcity set ""Optional IP address to bind to"" to ""All IPv4 Addresses""
#11691 
@sledgehammer999 @glassez @Chocobo1"
576265055,11592,FranciscoPombal,2020-01-20T13:03:30Z,"@sledgehammer999 @glassez @Chocobo1 
There is new information available about this topic in the libtorrent documentation:
https://github.com/arvidn/libtorrent/pull/4267

Not sure if this warrants any changes/additions to the code introduced in this PR, but I thought I should give the heads-up."
980568171,15793,glassez,2021-11-27T12:27:34Z,"Note for the testers:
This PR is still Draft. Something can work incorrectly for now. Do not test it with your real profile.

It would be very useful to me if you tested it both with a clean profile and with some already existing one (you can copy your regular profile) to check the correctness of the upgrade.

For the completeness of testing, it is necessary to have several categories/subcategories with torrents in them. Some categories need to have a specified ""save path"". Some torrents should have an automatic TMM enabled. The option to save incomplete torrents in a separate folder should be enabled . Some torrents should not be fully downloaded.
All of the above should be configured before the first launch of this PR (you can create such a test profile based on your regular one and save it somewhere so that you can use a copy of it in tests later)."
980584160,15793,glassez,2021-11-27T12:47:29Z,"Please don't pick on GUI - it's not my familiar area. If there are obvious/objective shortcomings, then of course I will correct them. But please, let's leave all the subjective and controversial things for later Issues/PRs.

WebUI (as usual for me) is out of scope of this changes. You just need to ensure that existing functionality isn't broken.

WebAPI can be enriched with the new methods to allow manipulating per-category and per-torrent download paths in this PR or in one of the following ones."
980781096,15793,thalieht,2021-11-27T18:25:58Z,"""Download folder"" sounds indistinguishable from ""save path"" to me.  Maybe you meant ""Downloading folder"" but that's not much better. I'd go with just Incomplete/Unfinished. I know it's internal but think of the future code readers.

Are the relevant options in new torrent dialog and torrent options dialog supposed to mirror the global option i.e. are they an indicator that the global option will take effect or to override it?
In torrent options in manual mode, the option is always deselected by default which would suggest that it overrides the global, whilst the option in new torrent dialog mirrors the global one.

Existing partially downloaded torrents in manual mode aren't moved to the global incomplete save path. They continue downloading in final destination. (temp folder option was disabled in my existing profile prior to testing this PR if it matters).

In new torrent dialog, auto TMM mode, when changing category the save path and temp save path lineedits have each other's path filled in.

In torrent options The Browse... button for the relevant option opens a ""file"" dialog instead of a ""folder"".

The final save path is always the default no matter what is set in new torrent dialog in manual mode.

In new torrent dialog, when the temp folder checkbox is unchecked, it doesn't become checked when changing to autoTMM mode.

>For the completeness of testing, it is necessary to (...)

I didn't do any of that yet.

~~/Off topic
This would be much simpler if ""Manual"" mode didn't exist for categories. If i'm not mistaken categories in manual mode are no different than tags.~~"
980787306,15793,glassez,2021-11-27T19:13:13Z,"> ""Download folder"" sounds indistinguishable from ""save path"" to me. Maybe you meant ""Downloading folder"" but that's not much better. I'd go with just Incomplete/Unfinished. I know it's internal but think of the future code readers.

""Download path"" means the path where the torrent saves files during download. I still had the option to use the names ""Finished (save) path/Unfinished (save) path"" or ""Complete (save) path/Incomplete (save) path"" but for some reason I like them less. In any case, none of them makes clear sense to third-party code readers. But of course I will concede to the option that will be supported by a majority of votes.


> Are the relevant options in new torrent dialog and torrent options dialog supposed to mirror the global option i.e. are they an indicator that the global option will take effect or to override it?

It is supposed to work the same way as some other options: in ""Add new torrent dialog"" it is initially set to the global default value, but allows you to override it; in ""Torrent options dialog"" it displays the value of the selected torrent and allows you to change it.



> This would be much simpler if ""Manual"" mode didn't exist for categories.

I'm sorry, I don't understand what exactly you mean... Torrent can be either in ""Manual"" or ""Automatic"" mode. Currently category options (save and download paths) are applied to torrents that are in ""Automatic"" mode.

Everything else will be checked by me and commented on later."
980788991,15793,glassez,2021-11-27T19:26:40Z,"Note:
Any option that is part of ""Auto management"" feature is designed to behave in the following way:
1. Global value of such option is just ""default value"" for ""manual"" torrents. It is used as an initial suggestion in ""Add new torrent dialog"" or if torrent is added non-interactively. Once torrent is added it has its own ""copy"" of this option so it doesn't more follow the global one if it's changed.
2. ""Automanaged"" torrents follow their category options. If category has no some option overridden the global one is used. If category has relative path it is resolved against corresponding global one."
980803682,15793,thalieht,2021-11-27T23:06:04Z,"/Off topic
>>This would be much simpler if ""Manual"" mode didn't exist for categories.
>
>I'm sorry, I don't understand what exactly you mean...

Never mind, it was an undigested idea."
981585236,15793,thalieht,2021-11-29T12:22:08Z,">For the completeness of testing, it is necessary to (...)

I've tested all that and i haven't found any problems. I'll test again after the fixes.

What's the deal with the partially checked option in category options dialog? Why not just unchecked for default?"
982252879,15793,glassez,2021-11-30T03:34:27Z,"> What's the deal with the partially checked option in category options dialog? Why not just unchecked for default?

It's the way to configure Category to not override global setting.
Honestly tri-state checkbox isn't so good in this role. Combobox with Default/Enabled/Disabled seems better for me."
987909518,15793,glassez,2021-12-07T13:07:36Z,">Honestly tri-state checkbox isn't so good in this role. Combobox with Default/Enabled/Disabled seems better for me.

Done.
>In new torrent dialog, auto TMM mode, when changing category the save path and temp save path lineedits have each other's path filled in.

Should be fixed now.
>In torrent options The Browse... button for the relevant option opens a ""file"" dialog instead of a ""folder"".

Should be fixed now.
>The final save path is always the default no matter what is set in new torrent dialog in manual mode.

Should be fixed now.
>In new torrent dialog, when the temp folder checkbox is unchecked, it doesn't become checked when changing to autoTMM mode.

Should be fixed now.
Also added more improvements."
988073237,15793,glassez,2021-12-07T16:15:11Z,">WebAPI can be enriched with the new methods to allow manipulating per-category and per-torrent download paths in this PR or in one of the following ones.

Done. I hope I didn't missing something..."
988240848,15793,thalieht,2021-12-07T20:26:24Z,">Existing partially downloaded torrents in manual mode aren't moved to the global incomplete save path. They continue downloading in final destination.

Still happening.

General: 
""Use another path for incomplete torrents"": I now see that ""another"" refers to the final destination but i initially thought it was referring to the global temp path. I tried to think of a good neutral option description that doesn't have this problem but i failed. E.g. ""Use a temp folder for incomplete torrents"".

Category settings: 
Isn't ""Default"" supposed to use the global temp path? If it is, it's not reflected in ""Torrent options"" nor in ""New torrent dialog's"" temp paths while in autoTMM mode and a category in ""Default"" mode is selected. They are both updated with whatever temp path is filled in category options and most importantly, there is no distinction between ""Default"" and ""Yes"" functionally. In both modes torrents with that category are downloaded in whatever is in the category's ""Path"" lineedit.
Nitpick: ""Path:"" label in category options should also be disabled  when ""No"" is selected.

New torrent dialog:
(Not important) In manual mode, the global temp path should always be an entry in the temp path's combobox.
(also not important) IMO temp path should have its own ""Remember last used save path"" instead of coupling the current one to both the save path and temp path.

Torrent options:
While in AutoTMM, changing category doesn't update the temp path options like in new torrent dialog. "
988480240,15793,glassez,2021-12-08T04:07:05Z,"> > Existing partially downloaded torrents in manual mode aren't moved to the global incomplete save path. They continue downloading in final destination.
> 
> Still happening.

If they were saved to the target path before the upgrade (i.e. if the temporary folder was disabled), then ""manual"" torrents should not have an assigned ""download path"" after the upgrade. The upgrade logic is such that the upgrade itself should not cause any file movements (i.e. the current locations will be applied in one way or another).
If you change default/global ""download folder"" settings after upgrade it shouldn't affect ""manual"" torrents."
988487420,15793,glassez,2021-12-08T04:23:46Z,">""Use another path for incomplete torrents"": I now see that ""another"" refers to the final destination but i initially thought it was referring to the global temp path.

Just take it contextually. The path for saving the torrent is indicated here next to it. So it means ""Save the torrent there, but save it at another path until it is complete"".
But maybe use ""Save at another path until it is complete"" or  ""Save at another path while it is incomplete""?
As I mentioned above, I have problems with UI design."
988494016,15793,glassez,2021-12-08T04:43:21Z,">Isn't ""Default"" supposed to use the global temp path? 

No. Currently it is supposed to affect only ""Use download path"" setting and not ""Download path"". In other words they are handled separately so you can override ""download path"" but it will be used only when ""enabled"" globally.
Do you think it's over customizable?"
988515716,15793,glassez,2021-12-08T05:38:37Z,">(Not important) In manual mode, the global temp path should always be an entry in the temp path's combobox.

Does it behave like this for the ""save path"" combobox? I kind of tried to follow it...

>(also not important) IMO temp path should have its own ""Remember last used save path"" instead of coupling the current one to both the save path and temp path.

But this is too much, isn't it?

In any case, all such ""not so important"" things can be adjusted later, if someone else cares about it."
988768808,15793,thalieht,2021-12-08T12:27:24Z,"> >> Existing partially downloaded torrents in manual mode aren't moved to the global incomplete save path. They continue downloading in final destination.
> >
>> Still happening.
>
>If they were saved to the target path before the upgrade (i.e. if the temporary folder was disabled)

Forgot to mention that. Temp folder was enabled before the upgrade and these torrents were moved to the final destination on first launch.

>>I now see that ""another"" refers to the final destination but i initially thought it was referring to the global temp path.
>
>But maybe use ""Save at another path until it is complete"" or ""Save at another path while it is incomplete""?

Unfortunately the same can be said about these.

>>    Isn't ""Default"" supposed to use the global temp path?
>
>No. Currently it is supposed to affect only ""Use download path"" setting and not ""Download path"". In other words they are handled separately so you can override ""download path"" but it will be used only when ""enabled"" globally.
Do you think it's over customizable?

I can't understand what this means.

>>(Not important) In manual mode, the global temp path should always be an entry in the temp path's combobox.
>
>Does it behave like this for the ""save path"" combobox? I kind of tried to follow it...

No idea. Personally i only use autoTMM but this is what came to mind when testing it.

>In any case, all such ""not so important"" things can be adjusted later, if someone else cares about it.

👍 "
988820918,15793,glassez,2021-12-08T13:36:39Z,"> Forgot to mention that. Temp folder was enabled before the upgrade and these torrents were moved to the final destination on first launch.

I just checked the upgrade. The download path was correctly assigned to all incomplete ""manual"" torrents...
Are you sure they are moved?
Note: ""Save path"" in torrent properties view is literally ""save path"" and not ""actual location of torrent content""."
988844679,15793,thalieht,2021-12-08T14:07:29Z,">Are you sure they are moved?

Yes i'm sure. I use ""Open destination folder"" and it opens the final destination with the files downloaded so far in it."
988860966,15793,glassez,2021-12-08T14:26:44Z,"> > Are you sure they are moved?
> 
> Yes i'm sure. I use ""Open destination folder"" and it opens the final destination with the files downloaded so far in it.

...but ""download path"" of torrent correctly points to previously used ""temp folder""? And torrent is still incomplete?"
988869011,15793,glassez,2021-12-08T14:36:20Z,"> > > Isn't ""Default"" supposed to use the global temp path?
> > 
> > 
> > No. Currently it is supposed to affect only ""Use download path"" setting and not ""Download path"". In other words they are handled separately so you can override ""download path"" but it will be used only when ""enabled"" globally.
> > Do you think it's over customizable?
> 
> I can't understand what this means.

There are two related options:
1. Download path
2. Is the use of ""download path"" enabled or disabled

Category can override one or both of them.
E.g. you can assign custom ""download path"" to Category but still leave ""Use download path"" to be ""Default"" so it will be used only when enabled globally."
988991342,15793,thalieht,2021-12-08T16:54:26Z,">...but ""download path"" of torrent correctly points to previously used ""temp folder""? And torrent is still incomplete?

Oh no no, that option is disabled for such torrents (manual) in their Torrent options (should be enabled). Assuming that by ""download path"" you're referring to the temp path...as i said earlier, an ambiguous term. And yes torrent is still incomplete.

>E.g. you can assign custom ""download path"" to Category but still leave ""Use download path"" to be ""Default"" so it will be used only when enabled globally.

That is most unexpected (for me). I never would have guessed that. So the only difference from what i was expecting is which temp path to use, category's or global, Personally, i don't see the usefulness of using the category's temp path instead of the global temp path since we can fine tune the category's temp path to our liking with ""Yes and No"" options. I don't know what users want, but if i were using this feature i would want ""Default"" to mean use the global setting and path."
989045493,15793,glassez,2021-12-08T18:01:31Z,">Oh no no, that option is disabled for such torrents (manual) in their Torrent options (should be enabled). 

Maybe you started upgrading from some kind of ""dirty"" profile (with `categories.json` already created by previous upgrade)?"
989107164,15793,thalieht,2021-12-08T19:02:30Z,">Maybe you started upgrading from some kind of ""dirty"" profile (with categories.json already created by previous upgrade)?

Uhhh oops :) false alarm. I didn't know about this new file though."
989536490,15793,glassez,2021-12-09T05:50:58Z,"> I don't know what users want, but if i were using this feature i would want ""Default"" to mean use the global setting and path.

Okay, let's get this straight (for me). Here's what you expect from the Category Options (as I understand it):

""Use another path for incomplete torrents"" is **Default**:
1. Path field is disabled and shows default temp path of category
2. Default temp path of category is used when it is Enabled in Preferences

""Use another path for incomplete torrents"" is **No**:
1. Path field is disabled and empty
2. Temp path is never used regardless of settings in Preferences

""Use another path for incomplete torrents"" is **Yes**:
1. Path field is enabled
2. Given temp path is always used regardless of settings in Preferences"
989740781,15793,thalieht,2021-12-09T10:55:44Z,">""Use another path for incomplete torrents"" is Default:
>
>   1.  Path field is disabled and shows default temp path of category
>   2.  Default temp path of category is used when it is Enabled in Preferences

No... i would expect Default to use the global settings so:
1. Path is disabled and shows the global temp path. Maybe the path is empty if the global setting is disabled? To indicate that to the user.
2. Global temp path is used when enabled in the preferences or if it's not, don't use a temp path.

""Yes"" and ""No"" as they are (and you described).
"
989878189,15793,glassez,2021-12-09T13:59:53Z,"> No... i would expect Default to use the global settings so:
> 
> 1. Path is disabled and shows the global temp path. Maybe the path is empty if the global setting is disabled? To indicate that to the user.
> 2. Global temp path is used when enabled in the preferences or if it's not, don't use a temp path.

The difference, as I understand it, is ""Global temp path"" VS ""Default temp path of category (aka Global temp path with Category name appended)"", right?"
989923528,15793,thalieht,2021-12-09T14:51:14Z,">VS ""Default temp path of category (aka Global temp path with Category name appended)""

Oh that's what you meant by ""Default temp path of category"" then sure that sounds good to me. Ignore my post https://github.com/qbittorrent/qBittorrent/pull/15793#issuecomment-989740781. You got it right in https://github.com/qbittorrent/qBittorrent/pull/15793#issuecomment-989536490"
996820606,15793,glassez,2021-12-17T15:40:48Z,"@Chocobo1
Please give priority review to https://github.com/qbittorrent/qBittorrent/pull/15852 and https://github.com/qbittorrent/qBittorrent/pull/15853. They are less complex than this PR and I would like them both to get into the v4.4 release."
998958457,15793,glassez,2021-12-21T17:20:14Z,"> Oh that's what you meant by ""Default temp path of category"" then sure that sounds good to me. Ignore my post [#15793 (comment)](https://github.com/qbittorrent/qBittorrent/pull/15793#issuecomment-989740781). You got it right in [#15793 (comment)](https://github.com/qbittorrent/qBittorrent/pull/15793#issuecomment-989536490)

Done."
999060555,15793,thalieht,2021-12-21T20:06:04Z,Would it be too much to ask for the tri-state combobox in torrent options as well (as in category options)? There doesn't seem to be a way for torrents in manual mode to be automatically updated to a new global temp path state (on/off and/or new temp path).
999086319,15793,glassez,2021-12-21T20:52:11Z,"> There doesn't seem to be a way for torrents in **manual** mode to be **automatically** updated to a new global temp path state (on/off and/or new temp path).

That's how it should be. Otherwise, what is the difference between the modes?"
999098608,15793,thalieht,2021-12-21T21:14:36Z,">That's how it should be. Otherwise, what is the difference between the modes?

The category settings."
999270097,15793,glassez,2021-12-22T04:07:50Z,"> > That's how it should be. Otherwise, what is the difference between the modes?
> 
> The category settings.

The main difference is ""following or not global settings"". The ""manual"" mode is for people who don't want anything (related) to be affected when you change default settings. It already works the same way for the ""save path"". The ""temp path"" had no division into modes before, so we can say it was always ""automatic"".

Note that some people ask category options to be used as default ones for ""manual"" torrents as well. And I'm inclined to provide this ""feature"" at least optionally."
999796026,15793,thalieht,2021-12-22T18:57:54Z,"Alright, last issue from me, i can't find any other problems:
New torrent dialog: Manual mode, temp path is not empty when the option is unticked."
1000820837,15793,glassez,2021-12-24T12:26:19Z,"> Alright, last issue from me, i can't find any other problems:
> New torrent dialog: Manual mode, temp path is not empty when the option is unticked.

Should be fixed now."
1000870921,15793,thalieht,2021-12-24T15:14:11Z,">Should be fixed now.

Almost :) When default mode is manual and global temp path enabled, the temp path in new torrent dialog is empty on dialog creation (the global path is used)."
1000884269,15793,glassez,2021-12-24T15:52:03Z,"> > Should be fixed now.
> 
> Almost :) When default mode is manual and global temp path enabled, the temp path in new torrent dialog is empty on dialog creation (the global path is used).

And now?"
1000908437,15793,thalieht,2021-12-24T17:51:36Z,No more problems.
1003675674,15793,glassez,2022-01-02T07:34:11Z,"Do you think I should merge it now so that it can possibly get into the upcoming v4.4 release, or postpone it until the next v4.4.1 release?"
1003676874,15793,Chocobo1,2022-01-02T07:49:41Z,"> Do you think I should merge it now so that it can possibly get into the upcoming v4.4 release, or postpone it until the next v4.4.1 release?

Since it is a new/redesigned feature, it should go into major release, so 4.4.0.
"
1003763120,15793,glassez,2022-01-02T19:25:48Z,"@Chocobo1, @thalieht 
Thank you for reviewing and testing!"
1004030394,15793,The5kull,2022-01-03T11:28:11Z,"Updating to this build made all my torrents disappear.

https://github.com/qbittorrent/qBittorrent/suites/4811404472/artifacts/135378631"
1004078013,15793,glassez,2022-01-03T13:06:00Z,"> Updating to this build made all my torrents disappear.
> 
> https://github.com/qbittorrent/qBittorrent/suites/4811404472/artifacts/135378631

Any details?
Platform/OS, screenshots, configs, logs?
@thalieht, can you test it again? I'm away now."
1004174728,15793,thalieht,2022-01-03T15:37:10Z,I can reproduce with that build in portable mode but i can't when i compile master in linux (not portable). .fastresumes files are still there and torrents reappear unharmed when changing to a previous build.
1004182566,15793,glassez,2022-01-03T15:50:00Z,"> I can reproduce with that build in portable mode

On Windows?
Are there some interesting log messages?


> i can't when i compile master in linux (not portable).

I can't too."
1004216680,15793,xavier2k6,2022-01-03T16:44:01Z,"Dropped in one of those builds as a replacement for my main setup & poof torrents appear gone!

(windows 10 x64 - `C:\Program Files\qBittorrent`)

logs:
```
03/01/2022 16:27 - Successfully updated IP geolocation database.
03/01/2022 16:27 - IP geolocation database loaded. Type: DBIP-Country-Lite. Build time: Sat Jan 1 01:11:53 2022.
03/01/2022 16:27 - Successfully parsed the provided IP filter: 221771 rules were applied.
03/01/2022 16:27 - Detected external IP: N/A
03/01/2022 16:27 - Successfully listening on IP: N/A, port: UDP/33727
03/01/2022 16:27 - Successfully listening on IP: N/A, port: TCP/33727
03/01/2022 16:27 - Web UI: Now listening on IP: N/A, port: 8080
03/01/2022 16:27 - Web UI translation for selected locale (en) has been successfully loaded.
03/01/2022 16:27 - Using built-in Web UI.
03/01/2022 16:27 - Couldn't load IP geolocation database. Reason: The system cannot find the path specified.
03/01/2022 16:27 - Encryption support [FORCED]
03/01/2022 16:27 - Anonymous mode [ON]
03/01/2022 16:27 - PeX support [ON]
03/01/2022 16:27 - Local Peer Discovery support [ON]
03/01/2022 16:27 - DHT support [ON]
03/01/2022 16:27 - HTTP User-Agent is 'qBittorrent/4.4.0rc1'
03/01/2022 16:27 - Peer ID: -qB4400-
03/01/2022 16:27 - Trying to listen on: N/A:33727
03/01/2022 16:27 - Using config directory: C:/Users/PC/AppData/Roaming/qBittorrent
03/01/2022 16:27 - qBittorrent v4.4.0rc1 started
```"
1004217004,15793,thalieht,2022-01-03T16:44:34Z,">On Windows?
Are there some interesting log messages?

Yes Windows. Nothing strange in the log."
1004218664,15793,glassez,2022-01-03T16:47:36Z,"Well, I found the problem. Will fix it ASAP. I hope you'll help with testing. v4.4 release is already on the doorstep."
424954495,9541,Piccirello,2018-09-27T04:21:11Z,"@glassez whoops, good catch. Pushing a new commit."
437464062,9541,xnoreq,2018-11-09T19:11:38Z,"Why would you concatenate ids with pipes into a long string just to later split them again?!

Why not do the proper thing and use a field ""ids"" that has an array of integer IDs as value?

So instead of `""id"": ""134|140|500|....""` you have `""id"": [134, 140, 500, ...]`.
Instead of `""id"": ids.join(""|"")` you have `""ids"": ids`.
Instead of doing the split server-side you iterate over the array of integers directly.
"
439763954,9541,Piccirello,2018-11-19T03:51:03Z,"@xnoreq This is currently done to maintain consistency with all our existing APIs. In the future these should all be cleaned up and switched to the ""correct"" way."
446078052,9541,Chocobo1,2018-12-11T05:33:00Z,Thank you!
1465441361,18645,brvphoenix,2023-03-13T03:05:14Z,"> I don't actually approve of the first commit (at least in its current form). It creates a cross dependencies between Application and FileLogger, which clearly cannot be seen as an improvement from a code structure perspective.

I'm not skilled in C++, so please forgive me for asking some ridiculous questions. Can I avoid cross dependencies if using the application interface class? Do you have any suggestions for this, keeping the original form, using a singleton or any other way?"
1465524179,18645,glassez,2023-03-13T05:12:01Z,"> Can I avoid cross dependencies if using the application interface class? Do you have any suggestions for this, keeping the original form, using a singleton or any other way?

I believe the easiest thing for all of us would be to revert this commit."
1465543650,18645,glassez,2023-03-13T05:36:56Z,"@brvphoenix 
Isn't `Read files by QDataStream` a separate thing? I would strongly recommend to extract it into separate PR with explanation about its goals.
Also I would split ""compressing"" and ""sorting"" work unless they are really too interlinked."
1471578205,18645,brvphoenix,2023-03-16T09:16:36Z,"> @brvphoenix I don't have time to review it all at once. I can either do it little by little, leaving some comments individually, or (if you don't like it that way) wait until I can review it in its entirety.

I'm OK with that ;).

"
1604166446,18645,glassez,2023-06-23T11:45:23Z,"@brvphoenix 
Finally I found time to complete this review. I have a lot of comments about coding style, etc. But this is not the most important thing, it can be easily fixed.
I have a couple of more significant claims that I would really like to be resolved before it is approved:
1. It would be better to unify the naming of backup files in such a way that the name of the compressed file differs only by adding a `.gz` extension to the name of the corresponding uncompressed one.
2. I really don't like all this hassle with ""sorting"" backup files (and in fact, it's renaming a lot of files). It would be better for the backup file to remain untouched after its creation (up to its deletion, if configured). We could use the timestamp as a unique component of the file name."
1604746834,18645,glassez,2023-06-23T19:07:25Z,"@brvphoenix 
Another unification I would like to see is the following:
Regular backup is produced just by renaming the original log file. I would like to preserve this behavior and apply compressing to backup file itself. IMO, this could give the following advantages:
1. If compression fails for some reason, we will still have an uncompressed backup file,
2. Since compression in this case is an addition to the main algorithm, it will be much easier to do it in a separate thread (i.e. we create a backup file as usual, run an asynchronous ""compression"" task, and continue to do our usual things of writing log messages to main file)."
1605333940,18645,brvphoenix,2023-06-24T09:31:40Z,"> @brvphoenix Another unification I would like to see is the following: Regular backup is produced just by renaming the original log file. I would like to preserve this behavior and apply compressing to backup file itself. IMO, this could give the following advantages:
> 
> 1. If compression fails for some reason, we will still have an uncompressed backup file,
> 2. Since compression in this case is an addition to the main algorithm, it will be much easier to do it in a separate thread (i.e. we create a backup file as usual, run an asynchronous ""compression"" task, and continue to do our usual things of writing log messages to main file).

Current the log backups will not be renamed and the compressed backup files will be named as `<uncompressed name> + .gz`"
1853948818,18645,luzpaz,2023-12-13T13:46:12Z,Any traction here ?
617361053,12574,xavier2k6,2020-04-21T19:16:59Z,Does this or the other PR https://github.com/qbittorrent/qBittorrent/pull/11896 close #8330?
617485996,12574,FranciscoPombal,2020-04-22T00:57:43Z,"@xavier2k6 technically, that issue should have been closed with the merging of the linked PR in the last comment (fixed that now). These new PRs are just follow-ups that improve on that original ones, that arose from my additional experience in managing the issue tracker."
618537536,12574,LordNyriox,2020-04-23T17:33:08Z,"@FranciscoPombal:  Not strictly related to the PR itself, but I noticed that both the old template and this one do not seem to have a defined layout for ""feature requests"". 

For instance, submitting a log entry for a behavior that does not yet exist, does not seem viable to me. 

Any advice on this? "
618586700,12574,FranciscoPombal,2020-04-23T18:48:03Z,"> @FranciscoPombal: Not strictly related to the PR itself, but I noticed that both the old template and this one do not seem to have a defined layout for ""feature requests"".
> 
> For instance, submitting a log entry for a behavior that does not yet exist, does not seem viable to me.
> 
> Any advice on this?

Ok, I have changed things around a bit. Now there are separate templates for bug reports and feature requests, as well as links to the relevant support communities. Additionally, I threw in a simple PR template. When a user clicks ""New issue"", now they will get something similar to this this: https://github.com/microsoft/TypeScript/issues/new/choose

As a bonus, GitHub will no longer complain about ""You are using an old version of issue templates. Please update to the new issue template workflow. Learn more"" (check this here: https://github.com/qbittorrent/qBittorrent/blob/master/.github/ISSUE_TEMPLATE.md)"
618599690,12574,FranciscoPombal,2020-04-23T19:07:37Z,"I have pushed the changes to my master branch. ~The bug report and feature request templates are not showing up, but I think that is because my repo is a fork:~ EDIT: I fixed it.

Try it out here: https://github.com/FranciscoPombal/qBittorrent/issues/new/choose

Here is what it looks like for a user:
![image](https://user-images.githubusercontent.com/17580742/80515935-a2e2a800-897a-11ea-8051-7bcd64c5d579.png)

Note that the headers in the files like the following are metadata for github only and do not show up when the user is creating the issue:

```
---
name: Feature Request
about: Suggest a new feature or enhancement for qBittorrent.
title: ''
labels: 'Feature request'
assignees: ''
---
```

As a bonus, feature requests get automatically labeled on creation."
723572746,12574,xavier2k6,2020-11-08T12:46:02Z,"````
<!--
###############################################################################
WARNING!
IGNORING THE FOLLOWING TEMPLATE WILL RESULT IN THE ISSUE BEING CLOSED
AS INCOMPLETE/INVALID
DO NOT DELETE HEADINGS/SECTIONS (LEAVE BLANK IF NOT APPLICABLE)
###############################################################################
Please make sure the description is worded/structured well enough to be understood.
Provide steps to reproduce the issue.
Provide as much context/additional relevant information/examples as possible.
Suggested solution (if applicable).
Do not forget about the mandatory attachments!.

For more information consult the Contributing Guidelines at https://github.com/qbittorrent/qBittorrent/blob/master/CONTRIBUTING.md.
################################## IMPORTANT ###################################
Type your text under the HEADINGS/SECTIONS below (LEAVE BLANK IF NOT APPLICABLE)
Use the Preview tab before posting to ensure correct formatting.
###############################################################################
-->
#### qBittorrent version/architecture (32bit/64bit)

#### Operating system/version

#### (If on windows), please include (FULL version displayed in `command prompt` window) e.g. `[Version 10.0.19042.xyz]`

#### (If on Linux), please include `libtorrent-rasterbar` and `Qt` version

#### Install method (Official installer/Self-compiled/Other - please specify)

#### What is the problem

#### What is the expected behavior

#### Detailed steps to reproduce the problem

#### Extra info (if any)

#### Mandatory Attachments (log(s) and settings file)

````
How about something like this??
Big wall of text to go through currently in this PR (that I can see people - straight away, deleting & writing their own thing.)
I know, I certainly don't like it!!

### Result:
<!--
###############################################################################
WARNING!
IGNORING THE FOLLOWING TEMPLATE WILL RESULT IN THE ISSUE BEING CLOSED
AS INCOMPLETE/INVALID
DO NOT DELETE HEADINGS/SECTIONS (LEAVE BLANK IF NOT APPLICABLE)
###############################################################################
Please make sure the description is worded/structured well enough to be understood.
Provide steps to reproduce the issue.
Provide as much context/additional relevant information/examples as possible.
Suggested solution (if applicable).
Do not forget about the mandatory attachments!.

For more information consult the Contributing Guidelines at https://github.com/qbittorrent/qBittorrent/blob/master/CONTRIBUTING.md.
################################## IMPORTANT ###################################
Type your text under the HEADINGS/SECTIONS below (LEAVE BLANK IF NOT APPLICABLE)
Use the Preview tab before posting to ensure correct formatting.
###############################################################################
-->
#### qBittorrent version/architecture (32bit/64bit)

#### Operating system/version

#### (If on windows), please include (FULL version displayed in `command prompt` window) e.g. `[Version 10.0.19042.xyz]`

#### (If on Linux), please include `libtorrent-rasterbar` and `Qt` version

#### Install method (Official installer/Self-compiled/Other - please specify)

#### What is the problem

#### What is the expected behavior

#### Detailed steps to reproduce the problem

#### Extra info (if any)

#### Mandatory Attachments (log(s) and settings file)

"
723572888,12574,xavier2k6,2020-11-08T12:47:05Z,"The reason I included the `FULL` Version string is that:
It gives a more searchable text string for determining what OS the qBittorrent user base runs,
This will also aid in the raising ""Minimum Supported""/""Dropping"" of EOL OS's/because of dependencies/compilers etc.

### For example:

#### Windows 11
* [Windows 11 (22H2 / 10.0.22621)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.22621) - {_EOL - Oct 14th, 2024_}
* [Windows 11 (21H2 / 10.0.22000)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.22000) - {_EOL - Oct 10th, 2023_}

***
#### Windows 10
* [Windows 10 (22H2 / 10.0.19045)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.19045) - {_EOL - Oct 14th, 2025_}
* [Windows 10 (21H2 / 10.0.19044)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.19044) - {_EOL - Jun 13th, 2023_}
* [Windows 10 (21H1 / 10.0.19043)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.19043) - {_EOL - Dec 13th, 2022_}
* [Windows 10 (20H2 / 10.0.19042)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.19042) - {_EOL - May 10th, 2022_}
* [Windows 10 (2004 (_20H1_) / 10.0.19041)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.19041) - {_EOL - Dec 14th, 2021_}
* [Windows 10 (1909 (_19H2_) / 10.0.18363)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.18363) -  {_EOL - May 11th, 2021_}
* [Windows 10 (1903 (_19H1_) / 10.0.18362)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.18362) - {_EOL - Dec 8th, 2020_}
* [Windows 10 (1809 / 10.0.17763)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.17763) - {_EOL - Nov 10th, 2020_}
* [Windows 10 (1803 / 10.0.17134)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.17134) - {_EOL - Nov 12th, 2019_}
* [Windows 10 (1709 / 10.0.16299)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.16299) - {_EOL - Apr 9th, 2019_}
* [Windows 10 (1703 / 10.0.15063)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.15063) - {_EOL - Oct 9th, 2018_}
* [Windows 10 (1607 / 10.0.14393)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.14393) - {_EOL - Apr 10th, 2018_}
* [Windows 10 (1511 / 10.0.10586)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.10586) - {_EOL - Oct 10th, 2017_}
* [Windows 10 (1507 / 10.0.10240)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+10.0.10240) - {_EOL - May 9th, 2017_}
***

#### Windows 7 / 8 / 8.1
* [Windows 8.1 (6.3.9600)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+6.3.9600) - {_EOL - Jan 10, 2023)_}
* [Windows 8 (6.2.9200)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+6.2.9200) - (_EOL- Jan 12, 2016_)
* [Windows 7 SP1 (6.1.7601)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+6.1.7601) - {_EOL - Jan 14, 2020_}
* [Windows 7 (6.1.7600)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+6.1.7600) - {_EOL - Jan 14, 2020_}

***
### Windows Operating Systems no longer supported as of 4.2.0 Release (December 3rd 2019)
***
#### Windows XP / Vista
* [Windows Vista SP2 (6.0.6002)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+6.0.6002) - {_EOL - Apr 11, 2017_}
* [Windows Vista SP1 (6.0.6001)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+6.0.6001) - {_EOL - Apr 11, 2017_}
* [Windows Vista (6.0.6000)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+6.0.6000) - {_EOL - Apr 11, 2017_}
* [Windows XP (5.1.2600)](https://github.com/qbittorrent/qBittorrent/issues?q=is%3Aissue+is%3Aopen+5.1.2600) - {_EOL - April 8, 2014_}"
723584886,12574,xavier2k6,2020-11-08T14:30:03Z,"````
#### qBittorrent version/architecture (32bit/64bit)
<!--Type your text after the `>` to the right-->
#### Operating system/version
<!--Type your text after the `>` to the right-->
#### (If on windows), please include (FULL version displayed in `command prompt` window) e.g. `[Version 10.0.19042.xyz]`
<!--Type your text after the `>` to the right-->
#### (If on Linux), please include `libtorrent-rasterbar` and `Qt` version
<!--Type your text after the `>` to the right-->
#### Install method (Official installer/Self-compiled/Other - please specify)
<!--Type your text after the `>` to the right-->
#### What is the problem
<!--Type your text after the `>` to the right-->
#### What is the expected behavior
<!--Type your text after the `>` to the right-->
#### Detailed steps to reproduce the problem
<!--Type your text after the `>` to the right-->
#### Extra info (if any)
<!--Type your text after the `>` to the right-->
#### Mandatory Attachments (log(s) and settings file)
<!--Paste links/Drop the files on next line below this statement.-->
````

Or maybe this?

### RESULT:
#### qBittorrent version/architecture (32bit/64bit)
<!--Type your text after the `>` to the right-->
#### Operating system/version
<!--Type your text after the `>` to the right-->
#### (If on windows), please include (FULL version displayed in `command prompt` window) e.g. `[Version 10.0.19042.xyz]`
<!--Type your text after the `>` to the right-->
#### (If on Linux), please include `libtorrent-rasterbar` and `Qt` version
<!--Type your text after the `>` to the right-->
#### Install method (Official installer/Self-compiled/Other - please specify)
<!--Type your text after the `>` to the right-->
#### What is the problem
<!--Type your text after the `>` to the right-->
#### What is the expected behavior
<!--Type your text after the `>` to the right-->
#### Detailed steps to reproduce the problem
<!--Type your text after the `>` to the right-->
#### Extra info (if any)
<!--Type your text after the `>` to the right-->
#### Mandatory Attachments (log(s) and settings file)
<!--Paste links/Drop the files on next line below this statement.-->
"
723655580,12574,FranciscoPombal,2020-11-08T19:38:31Z,"> Big wall of text to go through currently in this PR (that I can see people - straight away, deleting & writing their own thing.)

Then their issue will be immediately closed and locked as invalid. This is a feature, not a bug, to filter out users who are not willing to put in the minimum effort."
723658083,12574,xavier2k6,2020-11-08T20:00:58Z,">Then their issue will be immediately closed and locked as invalid. This is a feature, not a bug, to filter out users who are not willing to put in the minimum effort.

You have to take in to account that for some users - looking at that wall of text is basically double dutch & may know nothing about markdown etc so may not know how it's supposed to look etc.

There have been users here, who have made issues & just pasted the `SIGABRT` crash reports for example with remarks like.....I dunno, just happened....it told me to report it here, so I did. (deleted - the template etc)

`OpenSSL`/`Libtorrent`/`Boost` don't even have that kind of text to read through/fiddle with etc.

Keep it to bare minimum/essentials & it's followed up."
723658849,12574,xavier2k6,2020-11-08T20:06:53Z,"This is `OpenSSL`'s

````
<!--
Thank you for your bug report. If this is your first one,
please take the time to read the following lines before posting it.

NOTE:

    If you're asking about how to use OpenSSL, this isn't the right 
    forum.  Please see our User Support resources:
    https://github.com/openssl/openssl/blob/master/.github/SUPPORT.md

Please remember to tell us in what OpenSSL version you found the issue.

For build issues:

    If this is a build issue, please include the configuration output
    as well as a log of all errors.  Don't forget to include the exact
    commands you typed.

    With OpenSSL before 1.1.1, the configuration output comes from the
    configuration command.  With OpenSSL 1.1.1 and on, it's the output
    of `perl configdata.pm --dump`

For other issues:

    If it isn't a build issue, example code or commands to reproduce
    the issue is highly appreciated.
    Also, please remember to tell us if you worked with your own
    OpenSSL build or if it is system provided.

Please remember to put ``` lines before and after any commands plus
output and code, like this:

    ```
    $ echo output output output
    output output output
    ```

    ```
    #include <stdio.h>
    
    int main() {
        int foo = 1;
        printf(""%d\n"", foo);
    }
    ```
-->
````"
723658964,12574,xavier2k6,2020-11-08T20:07:45Z,"`Liborrent`

````
**Please provide the following information**

libtorrent version (or branch):

platform/architecture:

compiler and compiler version:

please describe what symptom you see, what you would expect to see instead and
how to reproduce it.
````"
723659902,12574,FranciscoPombal,2020-11-08T20:15:23Z,"@xavier2k6 

The libtorrent template is not sufficient for us. There is a selection bias for the kinds of users (i.e., more technical) who post issues on issue trackers of libraries, so it doesn't need to be more verbose than that, for the most part - those who post there already know what kind of information they must provide for the report to be useful.

The same selection bias applies to OpenSSL, but this is at least partly offset by the fact that OpenSSL is a huge and ubiquitous project.
I like the markdown hints and the fact that they attempt to redirect users to other resources, but this new template for qBittorrent also does this. Perhaps it would also be nice to add something like ""If you're having trouble formatting the text the way you want, check out these resources: https://guides.github.com/features/mastering-markdown https://github.github.com/gfm/"".

As for the crash reports - perhaps we should add something in the crash dialog along the lines of ""when submitting the bug report, please fill out the whole template properly, don't just copy-paste the stacktrace""."
723667669,12574,xavier2k6,2020-11-08T21:21:39Z,">As for the crash reports - perhaps we should add something in the crash dialog along the lines of ""when submitting the bug report, please fill out the whole template properly, don't just copy-paste the stacktrace"".

I think, the main thing for `stack traces` is that they are posted in **code blocks**

some crashes - have a window pop-up, user takes a screenshot & posts that with majority of info missing or don't copy it all correctly. (It'd be great if when qBittorrent crashed with stacktrace - it would automatically output it to a file)

Don't get me wrong here, I think the new template for choosing `bug report` `feature request` **IS** a great idea!

The only hang up I have really with the (wall of text) is the `checklist`

Is there really a need for it??? (since there's already a link to the guidelines provided)

Could the guidelines be the very first step?? (before actually submitting new issue)

The current headings could be like below, as I've shown previously.......

Warning is there & what is needed is clear.

````
<!--
###############################################################################
WARNING!
IGNORING THE FOLLOWING TEMPLATE WILL RESULT IN THE ISSUE BEING CLOSED
AS INCOMPLETE/INVALID
DO NOT DELETE HEADINGS/SECTIONS (LEAVE BLANK IF NOT APPLICABLE)
###############################################################################
Please make sure the description is worded/structured well enough to be understood.
Provide steps to reproduce the issue.
Provide as much context/additional relevant information/examples as possible.
Suggested solution (if applicable).
Do not forget about the mandatory attachments!.

For more information consult the Contributing Guidelines at https://github.com/qbittorrent/qBittorrent/blob/master/CONTRIBUTING.md.
################################## IMPORTANT ###################################
Type your text under the HEADINGS/SECTIONS below (LEAVE BLANK IF NOT APPLICABLE)
Use the Preview tab before posting to ensure correct formatting.
###############################################################################
-->
#### qBittorrent version/architecture (32bit/64bit)

#### Operating system/version

#### (If on windows), please include (FULL version displayed in `command prompt` window) e.g. `[Version 10.0.19042.xyz]`

#### (If on Linux), please include `libtorrent-rasterbar` and `Qt` version

#### Install method (Official installer/Self-compiled/Other - please specify)

#### What is the problem

#### What is the expected behavior

#### Detailed steps to reproduce the problem

#### Extra info (if any)

#### Mandatory Attachments (log(s) and settings file)

````"
723785514,12574,glassez,2020-11-09T06:16:34Z,"It would be just fine if GitHub allowed us to have a ""Create new Issue"" form (instead of Issue template) where we would place all these prerequisites, checkboxes, etc. in a friendly way, and it would simply not allow someone to create an Issue if some of the required fields are not filled in or filled in incorrectly."
723923473,12574,xavier2k6,2020-11-09T10:30:51Z,"> It would be just fine if GitHub allowed us to have a ""Create new Issue"" form (instead of Issue template) where we would place all these prerequisites, checkboxes, etc. in a friendly way, and it would simply not allow someone to create an Issue if some of the required fields are not filled in or filled in incorrectly.

That would probably be the best option all-round & I believe it is do-able with Google Form submissions/scripts.

ref: https://gist.github.com/anythingcodes/c68597c8e78541f703607d3cf324134a & https://gist.github.com/bmcbride/62600e48274961819084 & https://medium.com/@01010111/using-google-forms-to-submit-github-issues-efdb5f876b"
727193321,12574,glassez,2020-11-14T11:35:54Z,"> > It would be just fine if GitHub allowed us to have a ""Create new Issue"" form (instead of Issue template) where we would place all these prerequisites, checkboxes, etc. in a friendly way, and it would simply not allow someone to create an Issue if some of the required fields are not filled in or filled in incorrectly.
> 
> That would probably be the best option all-round & I believe it is do-able with Google Form submissions/scripts.
> 
> ref: https://gist.github.com/anythingcodes/c68597c8e78541f703607d3cf324134a & https://gist.github.com/bmcbride/62600e48274961819084 & https://medium.com/@01010111/using-google-forms-to-submit-github-issues-efdb5f876b

@FranciscoPombal, have you any ideas about it?"
735506363,12574,FranciscoPombal,2020-11-30T02:15:09Z,"@glassez @xavier2k6 

> > That would probably be the best option all-round & I believe it is do-able with Google Form submissions/scripts.
> > ref: https://gist.github.com/anythingcodes/c68597c8e78541f703607d3cf324134a & https://gist.github.com/bmcbride/62600e48274961819084 & https://medium.com/@01010111/using-google-forms-to-submit-github-issues-efdb5f876b
> 
> @FranciscoPombal, have you any ideas about it?

Sorry for not answering sooner. Now that I've cleared my 100+ issue backlog I can get back to important stuff.

In short, I'm against this. This hearkens back to my arguments about requiring 1000 people to make 5% extra effort every once in a while (i.e. when they post an issue) vs. 10 people to make 5% extra effort all the time. It is not a huge barrier for entry for those 1000 people to fill in a markdown template with extensive instructions properly, while it is taxing for us to implement and maintain such a system on top of everything else we already do.

- Maintaining the template code is much more difficult for us and becomes a maintenance burden. Plus it reduces the potential pool of contributors who can suggest/implement improvements to the template.
- We probably actually want to filter out the users who wouldn't/couldn't fill out a markdown template properly.

I'm all for reducing barriers to entry and improving contribution accessibility, but there are maintenance trade-offs to be made, and we must keep low-effort posting/spam under control. At the end of the day, contributing to FOSS projects is a deliberate decision. If someone's gonna do it, they're gonna do it, it's not a markdown template or other ancillary procedure that will stop them. As long as it's reasonable, and not some insurmountable amount of bureaucracy that wears them down by 1000 paper cuts, it's fine IMO.

But hey, I'm open to changing my mind. Regardless, I think such a solution should be implemented in tandem with the current change, not instead of it. We should make it convenient for people to post high-quality issues on GitHub with GitHub itself."
735558319,12574,glassez,2020-11-30T05:37:38Z,"> But hey, I'm open to changing my mind. Regardless, I think such a solution should be implemented in tandem with the current change, not instead of it. We should make it convenient for people to post high-quality issues on GitHub with GitHub itself.

The idea is to separate information that is only important to the Issue creator and only at the time of creating the Issue (all these ""I read and accept"", links to Coding Guidelines, etc.) from information that is directly relevant to the Issue itself and important to everyone else. Alternatively, we can drop all these checkboxes, rephrase all these warnings and confirmations a bit, and add something like this:
By creating Issue, you confirm that you have read and agree with the statements above.
_(NOTE! All text above, including this line, should be deleted to avoid being included in the Issue description)_"
787604110,12574,FranciscoPombal,2021-03-01T03:07:53Z,"@glassez 

> The idea is to separate information that is only important to the Issue creator and only at the time of creating the Issue (all these ""I read and accept"", links to Coding Guidelines, etc.) from information that is directly relevant to the Issue itself and important to everyone else.

This works well in other high-traffic projects. `youtube-dl` comes to mind, but there are many others. Is having the checkboxes on top that much of a problem for you? You already know _you and other contributors_ can mostly ignore it. We just care that all checkboxes are ticked, which is something our brains immediately register within a couple milliseconds of opening the issue.
Plus, if you see an issue posted without all checkboxes ticked, **you can immediately de-prioritize it when perusing the issue tracker, since that information is shown in the issue pages** (look at the `4 out of 5` in this example):

![image](https://user-images.githubusercontent.com/17580742/109445838-61a6a300-7a38-11eb-8176-3e66de543f89.png)

The purpose of the checkboxes is to serve as a ""constructive educational filter"", by trying to accomplish these two objectives:

- filter low-effort posters.
- guide and assist diligent posters, who _want_ to post a high-quality issue, but might not not be aware of all the steps necessary to do so in the context of our project.

I believe these are worth pursuing, even if it means a little more ceremony in the form of a ""header"" of checkboxes that at most causes the ""inconvenience"" of having to scroll down a little bit more in lengthy posts.

>Alternatively, we can drop all these checkboxes, rephrase all these warnings and confirmations a bit, and add something like this:
>> By creating Issue, you confirm that you have read and agree with the statements above.
>> _(NOTE! All text above, including this line, should be deleted to avoid being included in the Issue description)_

This defeats much of the purpose of the checkbox ""header"" serving as an ""constructive educational filter"". Also, you would no longer be able to check at a glance from the issue page if a certain issue might not be worth opening (as outlined in bold above).

Formatting directions for the user's eyes only (like how to ""tick"" the checkboxes), which we really don't benefit from seeing in the issue body at all are already hidden away as comments, so they won't show up no matter what."
792834795,12574,glassez,2021-03-08T15:32:44Z,"One more note. Some projects offer several templates for creating different types of Issues. Can we at least separate Feature requests templates from regular Issue ones?
"
792845555,12574,FranciscoPombal,2021-03-08T15:48:56Z,"@glassez

> One more note. Some projects offer several templates for creating different types of Issues. Can we at least separate Feature requests templates from regular Issue ones?

This PR does that."
792860240,12574,FranciscoPombal,2021-03-08T16:05:45Z,"From a random user, https://github.com/qbittorrent/qBittorrent/issues/14502#issuecomment-792290834 (emphasis mine):

> I did try to provide enough information by filling in everything asked when opening this issue. **If more is needed by default, maybe it would have been an idea to actually ask for more there?** Just my two cents... I have tried looking in the wiki, the forums and **digging around here at github to see what would be relevant information, but had no luck finding anything.**

The new template also directs the user to the contributing guidelines, that contain tips on what useful information can be included to enrich the report."
792875698,12574,xavier2k6,2021-03-08T16:25:33Z,"> > It would be just fine if GitHub allowed us to have a ""Create new Issue"" form (instead of Issue template) where we would place all these prerequisites, checkboxes, etc. in a friendly way, and it would simply not allow someone to create an Issue if some of the required fields are not filled in or filled in incorrectly.
> 
> That would probably be the best option all-round & I believe it is do-able with Google Form submissions/scripts.
> 
> ref: https://gist.github.com/anythingcodes/c68597c8e78541f703607d3cf324134a & https://gist.github.com/bmcbride/62600e48274961819084 & https://medium.com/@01010111/using-google-forms-to-submit-github-issues-efdb5f876b

I still think this would be the overall better option but I wouldn't see it as a necessity straight away & would certainly not want it to get in the way of this PR/work getting merged,

What we have here is better than what we've got I suppose & it can be revised/re-configured/adapted etc or even replaced at a later stage."
792918257,12574,glassez,2021-03-08T17:19:58Z,"

> What we have here is better than what we've got I suppose & it can be revised/re-configured/adapted etc or even replaced at a later stage.

Good. I agree. Let others speak out, and we can merge it if there are no serious objections. Besides, I can't check all the details of these templates myself."
792976376,12574,FranciscoPombal,2021-03-08T18:31:43Z,"@glassez 

> > What we have here is better than what we've got I suppose & it can be revised/re-configured/adapted etc or even replaced at a later stage.
> 
> Good. I agree. Let others speak out, and we can merge it if there are no serious objections. Besides, I can't check all the details of these templates myself.

Yes (once there is approval I'll rebase and fix the merge conflict). An important point: this PR was first posted almost a whole year ago now. We had to suffer with a much worse issue template during that time, when this could have been merged much sooner. It took a whole year to realize that this was obviously objectively better than the existing one?? We need to iterate on these kinds of things faster. They don't need to be perfect from the start, and improving the quality of life for frequent contributors should be a top priority (refer back to my above point in https://github.com/qbittorrent/qBittorrent/pull/12574#issuecomment-735506363 about filtering low-effort issues and requiring 1000 people to make 5% extra effort every once in a while (i.e. when they post an issue) vs. 10 people to make 5% extra effort all the time)."
793050400,12574,thalieht,2021-03-08T20:24:04Z,I'm still against all those checkboxes. Maybe replace them with just one? Either way i won't insist/resist any more.
793352377,12574,glassez,2021-03-09T04:03:42Z,"> It took a whole year to realize that this was obviously objectively better than the existing one??

Not **obviously objectively better**. At least not for me. I still think it overcomplicated and it may not have as positive an effect as you advertise. But since you are dealing with it more, I let you improve it in a way that you think will be better."
848196226,12574,FranciscoPombal,2021-05-25T19:19:17Z,@glassez @Chocobo1 @thalieht @xavier2k6 I believe all comments were addressed. Previews updated in the OP.
848374613,12574,FranciscoPombal,2021-05-26T00:43:36Z,"@thalieht thanks for the review, all comments addressed."
848752027,12574,FranciscoPombal,2021-05-26T13:04:43Z,"@sakkamade Thanks for the review, all comments addressed."
850877031,12574,xavier2k6,2021-05-29T18:20:14Z,Should it be mentioned that we do not support `qBittorrent Enhanced Edition` `portableapps` versions & that issues relating to use of `docker` should be directed to `discussions`/`forum` etc.?
850880898,12574,ArcticGems,2021-05-29T18:43:07Z,"> 
> 
> Should it be mentioned that we do not support `qBittorrent Enhanced Edition` `portableapps` versions 

Maybe where you choose between 'bug report' and 'feature request', it should say at the of both options ""NO support for other forks/editions!"".

Example: `Report a problem with qBittorrent to help us solve it (NO support for other forks/editions!).`

"
852365247,12574,FranciscoPombal,2021-06-01T18:52:42Z,"@xavier2k6 @ArcticGems That's already mentioned in the contributing guidelines, I don't think it needs to be further emphasized here since we already tell the user to go read them.

@glassez @Chocobo1 Any further comments? I think this is ready to be merged now. It would be a nice improvement for all @qbittorrent/bug-handlers."
852393728,12574,ArcticGems,2021-06-01T19:36:00Z,"I still think this one is oddly phrased =

> This is **not a support issue or question** better suited for either the [discussions section](https://github.com/qbittorrent/qBittorrent/discussions), [forum](https://qbforums.shiki.hu/), or [subreddit](https://www.reddit.com/r/qBittorrent/), and the [wiki](https://github.com/qbittorrent/qBittorrent/wiki) did not contain a suitable solution either

Maybe this is better? =

> This is **not a support issue or question,** therefore better suited for either the [discussions section](https://github.com/qbittorrent/qBittorrent/discussions), [forum](https://qbforums.shiki.hu/), or [subreddit](https://www.reddit.com/r/qBittorrent/).  The [wiki](https://github.com/qbittorrent/qBittorrent/wiki) did not contain a suitable solution either"
852608016,12574,FranciscoPombal,2021-06-02T00:41:16Z,"@ArcticGems You're right, thanks for the suggestion. Fixed."
852940466,12574,glassez,2021-06-02T11:14:59Z,"> @glassez @Chocobo1 Any further comments? I think this is ready to be merged now. It would be a nice improvement for all @qbittorrent/bug-handlers.

I have already expressed my opinion. But I won't stop it. I suggest that the team just vote. If the majority supports it, let's merge.
@Chocobo1, do you have any blocking objections?"
852948200,12574,thalieht,2021-06-02T11:27:54Z,">therefore

 What this means now: ""This is **not** a support issue or question, so it belongs in discussions section, forum, or subreddit""
I would replace ""therefore"" with ""both of which are""

Last comment from me: I would make the inclusion of logs/settings files ""opt-out"" with something like: ""include them unless you _know_ they are irrelevant to solving the issue"". 
Examples: ""my fonts are too small"" ""translation problems"" ""the torrent's ""Added on"" is reset on every restart"" etc. Obviously the related checkbox would go away with this change.

p.s. I won't ""officially"" approve this PR because it adds >1 checkbox but other than that LGTM."
852989745,12574,ArcticGems,2021-06-02T12:35:29Z,"> 
> 
> > therefore
> 
> What this means now: ""This is **not** a support issue or question, so it belongs in discussions section, forum, or subreddit""
> I would replace ""therefore"" with ""both of which are""
> 
@thalieht 
I see what you mean. Maybe also add 'report/request' in the beginning (request for 'Feature request' part). =

> This report is **not a support issue or question,** both of which are better suited for either the [discussions section](https://github.com/qbittorrent/qBittorrent/discussions), [forum](https://qbforums.shiki.hu/), or [subreddit](https://www.reddit.com/r/qBittorrent/).  The [wiki](https://github.com/qbittorrent/qBittorrent/wiki) did not contain a suitable solution either

The use of 'issue' bugs me as well since the section is called ""Issues"". Maybe change it because it could confuse some users?"
853030504,12574,FranciscoPombal,2021-06-02T13:31:42Z,"@thalieht 

> What this means now: ""This is **not** a support issue or question, so it belongs in discussions section, forum, or subreddit""
> I would replace ""therefore"" with ""both of which are""

OK, will do.

> Last comment from me: I would make the inclusion of logs/settings files ""opt-out"" with something like: ""include them unless you _know_ they are irrelevant to solving the issue"".
> Examples: ""my fonts are too small"" ""translation problems"" ""the torrent's ""Added on"" is reset on every restart"" etc. Obviously the related checkbox would go away with this change.

We should not trust users to ""know it's irrelevant"". And even if they make the correct judgement, this will just lead to most taking the path of least resistance and not uploading the files even when needed, leading to the usual inefficient back-and-forth.

Other projects such as `youtube-dl` have similar demands and it works really well, no one complains.

As I've said before, it is more scalable to demand a little more from reporters from the get-go. than it is to expect us (team members and contributors) to ask the same thing over and over again in each new issue.

> p.s. I won't ""officially"" approve this PR because it adds >1 checkbox but other than that LGTM.

Does this mean it has 1 checkbox too many, or that you would like it to have _only_ 1 checkbox (I assume it's the latter)? Why is that a bad thing? It's the users who have to fill them in, not you. The number of filled checkboxes filled can be seen from the Issues list. This can help you prioritize issues that have had more thought put into them before even opening them (the ones that have all checkboxes checked).

@glassez 

> I have already expressed my opinion. But I won't stop it. I suggest that the team just vote. If the majority supports it, let's merge.
@Chocobo1, do you have any blocking objections?

Well I still need at least 2 ""official"" approvals, right? I just want to handle issues more efficiently and reduce the number of useless/low effort posts. As you've said before,

> But since you are dealing with it more, I let you improve it in a way that you think will be better.

So let's get on with this already after (after addressing Chocobo's comments, if any, sooner rather than later I hope).

If this doesn't work as well as I think it will, no one has a bigger incentive than me to fix it/improve it further."
853276561,12574,glassez,2021-06-02T18:17:25Z,"> So let's get on with this already after (after addressing Chocobo's comments, if any, sooner rather than later I hope).
> 
> If this doesn't work as well as I think it will, no one has a bigger incentive than me to fix it/improve it further.

Ok.
But you're still not the only bug handler. So I would like to see that there are no serious contradictions with the other members."
853353676,12574,xavier2k6,2021-06-02T20:15:46Z,">- [ ] I have read the **issue reporting guidelines** in the [contributing guidelines]

Suggest -> **issue reporting section**

>- [ ] I have read the **feature request guidelines** in the [contributing guidelines]

Suggest -> **feature request section**

Suggest -> Changing All headers to something like below to avoid seeing `(type here)`

`### qBittorrent info and operating system(s) <!--Type relevant information below this header-->`

`### If on Linux, `libtorrent-rasterbar` and `Qt` versions <!--Type relevant information below this header-->`
"
853459460,12574,FranciscoPombal,2021-06-03T00:04:24Z,"@xavier2k6 

> Suggest -> **issue reporting section**
>
> Suggest -> **feature request section**

:+1:, done.
 
> Suggest -> Changing All headers to something like below to avoid seeing `(type here)`
> 
> `### qBittorrent info and operating system(s) <!--Type relevant information below this header-->`
> 
> `### If on Linux, `libtorrent-rasterbar`and`Qt` versions <!--Type relevant information below this header-->`

I understand but I disagree (I have also thought of this in the past). I'm always concerned users will write inside the `<!-- -->`, which is worse than leaving a `(type here)`.

We already explicitly warn the user to delete each `(type here)` as they fill out the template in a comment above.
I think it's better to go with `(type here)` for now, if we still see that many users are not deleting the `(type here)`s, we can then try alternative solutions such as the one you propose."
853508219,12574,Chocobo1,2021-06-03T02:17:21Z,">@Chocobo1, do you have any blocking objections?

no."
853714933,12574,xavier2k6,2021-06-03T09:07:48Z,">I understand but I disagree (I have also thought of this in the past). I'm always concerned users will write inside the `<!-- -->`, which is worse than leaving a `(type here)`.

Well, if they do that & we are attempting to tighten up the issue tracker procedures in this PR then we can mark it as invalid can't we? (as they didn't follow our instructions correctly)

One overall checkbox may be sufficient enough for compliance with the instructions set out in `markdown` text but I won't insist on this.

My opinion from https://github.com/qbittorrent/qBittorrent/pull/12574#issuecomment-723923473 would still be the best option & as I said previously this is something that should be looked at in the future. (Maybe 6 months from now?)

I don't think I have any other issues with this PR."
853735874,12574,FranciscoPombal,2021-06-03T09:39:56Z,"@xavier2k6 

> Well, if they do that & we are attempting to tighten up the issue tracker procedures in this PR then we can mark it as invalid can't we? (as they didn't follow our instructions correctly)

Well we should be strict, but not super strict in closing issues for being invalid. A user may make an honest mistake; with the `<!-- -->` approach, the issue may not be understandable unless we specifically inspect the raw text. With the `(type here)` approach, the most that can happen in that case is that there is an extra `(type here)` appended/prepended to whatever the user writes, which is not ideal, but not that harmless, as the content is still all readable - and not a reason alone to close the report.

> One overall checkbox may be sufficient enough for compliance with the instructions set out in `markdown` text but I won't insist on this.

We can always change this in the future if users complain about it. Fortunately I doubt this will be the case. As I've demonstrated before, multiple other projects have been using the ""multiple checkbox"" method successfully for a long time. They keep the user engaged and alert as they are reading and fulfilling each requirement.

> My opinion from [#12574 (comment)](https://github.com/qbittorrent/qBittorrent/pull/12574#issuecomment-723923473) would still be the best option & as I said previously this is something that should be looked at in the future. (Maybe 6 months from now?)

First we should see how this one does ""in production"". This might not be the perfect solution until the end of time, but it sure has a much better chance of being more effective than what we have now, and it is proven in other even bigger projects.

Then sure, something based on google forms can be looked at in the future. However, I have expressed my reservations about it, and I'd like to add that some users might not like the fact that they have to interact with an external Google resource just to submit an issue...

> I don't think I have any other issues with this PR.

:+1:"
853740829,12574,FranciscoPombal,2021-06-03T09:48:15Z,"@glassez @Chocobo1 

> > @Chocobo1, do you have any blocking objections?
> 
> no.

Cool, can we finally get this approved and merged then? I believe @xavier2k6 and @thalieht 's concerns have been addressed (but let me know if there is still some last minute change that you need!)."
854574976,12574,FranciscoPombal,2021-06-04T10:17:40Z,"@glassez 

> Cosmetic comment: file names inside ISSUE_TEMPLATE seem to be inconsistent to me (namely using of `_template` suffix).
> Also why some `*.md` files have UPPERCASE names but others not? Is there any general naming scheme/convention?

I followed the conventions/guidelines in GitHub's documentation.

Basically,

- `.github/ISSUE_TEMPLATE` directory name must be upper case
- `.github/PULL_REQUEST_TEMPLATE` directory name must be upper case
- the name of the files inside `.github/{ISSUE, PULL_REQUEST}_TEMPLATE` are case-insensitive. So I chose lower case, to follow the convention of the rest of the files in the repository that don't have a case-sensitivity requirement.
- `SUPPORT.md` must (should?) be named exactly like that
- `FUNDING.yml` must (should?) be named exactly like that

References:
- https://docs.github.com/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/about-issue-and-pull-request-templates
- https://docs.github.com/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/configuring-issue-templates-for-your-repository
- https://docs.github.com/en/communities/setting-up-your-project-for-healthy-contributions/adding-support-resources-to-your-project
- https://docs.github.com/en/github/administering-a-repository/managing-repository-settings/displaying-a-sponsor-button-in-your-repository

---

The `.github/PULL_REQUEST_TEMPLATE/pull_request_template.md` file name should not contain the `_template` suffix for consistency with the rest, you are right about that, will push shortly to fix it."
856041762,12574,FranciscoPombal,2021-06-07T15:34:11Z,@glassez @Chocobo1 macOS CI failure is obviously spurious.
856969675,12574,glassez,2021-06-08T17:48:39Z,Thank you!
857042556,12574,ArcticGems,2021-06-08T19:26:21Z,"Maybe when it's time to release 4.4.0 beta, you guys can add another part called something like ""[4.4.0 Beta] Bug report"" with its own checklist and relevant questions?"
857586531,12574,FranciscoPombal,2021-06-09T10:38:51Z,"> Maybe when it's time to release 4.4.0 beta, you guys can add another part called something like ""[4.4.0 Beta] Bug report"" with its own checklist and relevant questions?

These templates can be used without changes for such purposes. It is sufficient for the user to write ""4.4.0 Beta"" in the version field. If we really do need a clearer separation between issues from that version and others, we'll just label them differently as they're posted."
898884373,12574,ArcticGems,2021-08-14T11:51:42Z,"I think the 'bug report form' that you can find in the 'uBlock-issues' repository is interesting. No more template evading/removing or checkbox mistakes!

It's worth looking into.

PR: https://github.com/uBlockOrigin/uBlock-issues/pull/1651

Check out how it looks here (start a issue, but don't submit) =
https://github.com/uBlockOrigin/uBlock-issues/issues
"
898912604,12574,xavier2k6,2021-08-14T16:05:37Z,"@ArcticGems Thank you so much!!!

@glassez this is a very useable option like what I had similarly suggested in https://github.com/qbittorrent/qBittorrent/pull/12574#issuecomment-723923473

https://github.com/uBlockOrigin/uBlock-issues/blob/master/.github/ISSUE_TEMPLATE/bug_report.yml

https://github.com/uBlockOrigin/uBlock-issues/blob/master/.github/ISSUE_TEMPLATE/config.yml

I'll try to work on this/submit PR over the wknd."
898964175,12574,xavier2k6,2021-08-14T22:09:41Z,"Here's an example:
![new issue template form](https://user-images.githubusercontent.com/42386382/129461279-ec197ac6-47ec-4516-9380-2ee86d991068.png)
"
899000136,12574,ArcticGems,2021-08-15T05:54:46Z,"
sorry, missed what you wrote earlier"
1850311054,20118,OdinVex,2023-12-11T15:29:39Z,"I'll adjust in time, I think this was older tinkering.

Edit: Hm, git clone built fine and ran fine, no adjustments. (cmake .; make)
Edit: Added override, must've forgot. This too compiles, should address the macOS fail. Could someone else peek at it, I shouldn't code so early."
1850595547,20118,stalkerok,2023-12-11T18:00:07Z,"Screenshots: 
GUI: ![2023-12-11_203555](https://github.com/qbittorrent/qBittorrent/assets/63958081/529a4ad9-b3ba-40f4-9f3f-e4d8f5b8996e) ![2023-12-11_204031](https://github.com/qbittorrent/qBittorrent/assets/63958081/a65f196b-73e4-47ea-9111-ac4ff2182db4)
WebUI: ![2023-12-11_204316](https://github.com/qbittorrent/qBittorrent/assets/63958081/b6b2a900-9104-4838-baec-e8d5ecd31669) ![2023-12-11_204141](https://github.com/qbittorrent/qBittorrent/assets/63958081/50662c21-1fa0-4d42-88e7-aa3aa13784b9)
Didn't find any problems. But it's still better to use ""IP"" instead of ""Address"" to save space, in case in the future someone (maybe you) wants to add a display of both ipv4 and ipv6 address at the same time, or even all possible addresses. Or any other information. IMHO"
1850614144,20118,OdinVex,2023-12-11T18:09:45Z,"> Didn't find any problems. But it's still better to use ""IP"" instead of ""Address"" to save space, in case in the future someone (maybe you) wants to add a display of both ipv4 and ipv6 address at the same time, or even all possible addresses. Or any other information.

I mentioned in the original PR that you (the general you, as in qBittorrent team/developers/whoever it may concern) can decide what language to use. When I see *IP* I see *Internet Protocol*, not *Address*, but I've been developing since 2004 in areas that include developing protocols and it just looks weird to my mind seeing ""External Internet Protocol"" when I'd need to refer to an address. Again though, I don't care which way it goes in your (general your) project, anyone pick. I'm running around on 28"" 4K high-DPI setups, so I don't have space to worry about. \*shrug\* Personally I'd rather the backend kept track of the last externally-detected addresses via type so it could end up ""External Address(es): IPv4, IPv6\*"" where an asterisk denotes which was detected most recently, somewhat adapting and opportunistic in displaying more, maybe even a popup menu showing a small 'mini-exec' log of addresses detected with timestamp (or enabling the View for the log and simply preset the filter to detected IPs...easiest and most 'integrated' in my opinion, less UI to manage or clutter and easily implemented).

Edit: I might take some time later today to implement separate IPv4/IPv6 addressing and displaying both using 'Addresses' (or only one if only one exists and using 'Address' *or whatever the project ends up deciding*).

Edit: Cleanly refactoring to support both IP address types is problematic because other functions rely on not making a difference between them, such as `isReannounceWhenAddressChangedEnabled` (see `handleExternalIPAlert` for more info). I haven't had any time to grasp the code, would that function matter or care about which type or is it safe to just go ahead and let it through regardless of IP address because it's still an externally detected change?"
1850698483,20118,OdinVex,2023-12-11T18:58:37Z,"I've implemented it all but I've come across a formatting situation. Do you want a space between IPv4 and IPv6 addresses or a comma and space or what? Edit: Went with a single space. Tested GUI and WebUI, currently working on my end."
1850709635,20118,stalkerok,2023-12-11T19:06:00Z,"> comma and space

would be a good option."
1850737147,20118,OdinVex,2023-12-11T19:24:34Z,"> > comma and space
> 
> would be a good option.

I didn't see the message until after commit, my bad. Comma and space would require keeping track of whether both are being shown or just one and adjusting so, was easier to use trim at the time."
1850753581,20118,stalkerok,2023-12-11T19:33:39Z,"> maybe even a popup menu showing a small 'mini-exec' log of addresses detected with timestamp

A small information window when hovering over an address with all available IP addresses would be a good option (the same as when hovering over ""connection status"", for example)."
1850759181,20118,OdinVex,2023-12-11T19:37:33Z,"> > maybe even a popup menu showing a small 'mini-exec' log of addresses detected with timestamp
> 
> A small information window when hovering over an address with all available IP addresses would be a good option (the same as when hovering over ""connection status"", for example).

qBittorrent currently doesn't keep track of addresses, merely the last detected of each type. The backend would need some further tinkering to do that. I don't do enough web development with JavaScript (I personally despite JS) to add a popup, but I can look at it. Edit: Perhaps that popup should just show the log filtered for detected IP Addresses?"
1850769621,20118,stalkerok,2023-12-11T19:44:15Z,"> Perhaps that popup should just show the log filtered for detected IP Addresses?

Perhaps I just don't really understand how good or bad it would look."
1850798324,20118,OdinVex,2023-12-11T20:04:07Z,"> > Perhaps that popup should just show the log filtered for detected IP Addresses?
> 
> Perhaps I just don't really understand how good or bad it would look.

Edit: I haven't pushed it yet but I've refactored the code to show (and send for WebUI) both IPv4 addresses and IPv6 addresses such as '`External Address(es): Detecting`' -> '`External Address: 0.0.0.0`' -> '`External Address: f:f:f:f`' ->'`External Addresses: 0.0.0.0, f:f:f:f`'. The addresses past detected are available for someone to write a popup (or something) if desired. All strings allow for translation, of course. I wonder, should we mark the last detected one via asterisk in cases with multiple addresses? (Ex: '`External Addresses: 0.0.0.0, f:f:f:f*`') It might be helpful for someone and is easily done.

Edit: Instead of a popup, I'd say just call the View->Log.onclick, call the Execution Log->onclick, set the filterTextInput text to '`Detected external IP.`' and set '`Information Messages`' to ticked in the drop-down. It'd show IP as well as when they were last used, less UI to develop. That'd work for the GUI and WebUI, too."
1856520768,20118,OdinVex,2023-12-14T20:16:27Z,"I decided to reuse elements of the UI. The label at the bottom was converted into a button similar to setting download/uploads speeds. When it's clicked it'll open up the `Execution Log` and add `Information Messages` to the filter list to show messages as appropriate. The GUI doesn't currently have a text input means of filtering the log, but at least they'll be shown (Informational type). The WebUI is pre-set with the translatable text and works as well. Try it out, see if it needs tweaking. If you want to call things 'Internet Protocol(s)' instead of addresses be my guest.

Edit: I felt this approach to reuse and reinforce use of the Execution Log as a means of information conveyance was best. It beats adding more UI that would need maintenance and simply works. Every user-facing string is translatable via `TR` and `QBT_TR`, I paid attention to make sure I used that 7 strings total including the transitory-state strings."
1856532952,20118,OdinVex,2023-12-14T20:26:21Z,"Except one string, forgot that one, added. :sweat_smile:"
1857543210,20118,glassez,2023-12-15T09:19:43Z,"> If you want to call things 'Internet Protocol(s)' instead of addresses be my guest.

We don't want to `call things 'Internet Protocol(s)' instead of addresses`. We do want to write `IP` as a shortcut of `IP address`. I can't figure out what the problem is. A similar thing (called ""metonymy"") is used everywhere (just look around, it's strange that you haven't come across it). We say ""IP"" instead of ""IP address"", ""E-mail"" instead of ""E-mail address"" whenever the context allows us to do it unambiguously."
1857572492,20118,glassez,2023-12-15T09:42:55Z,">When it's clicked it'll open up the `Execution Log` and add `Information Messages` to the filter list to show messages as appropriate.

Is it a really good idea to do it this way?
Firstly, it is doubtful to implicitly enable something that was previously explicitly disabled by the user.
Secondly, the log can be filled with a lot of messages, so it obviously won't seem intuitive to the user to see it."
1857583957,20118,glassez,2023-12-15T09:51:48Z,"Personally, I would limit myself (at least to begin with) to something minimalistic like Deluge does. Just `IP: 123.456.7.8` or maybe `IPv4: 123.456.7.8 | IPv6: 2001:0DB8:3C4D:7777:0260:3EFF:FE15:9501`. Details can be shown in tooltip. Or, if it is really necessary to see more details/statistics, we can later add ""External address info"" dialog that is displayed when you click on appropriate button on status bar."
1857777251,20118,stalkerok,2023-12-15T12:03:25Z,"> or maybe `IPv4: 123.456.7.8 | IPv6: 2001:0DB8:3C4D:7777:0260:3EFF:FE15:9501`

I don't think that's a good idea, a `, ` separator like that would save some space.
`IP: 123.456.7.8, 2001:0DB8:3C4D:7777:0260:3EFF:FE15:9501`
and
`IPv4: 123.456.7.8 | IPv6: 2001:0DB8:3C4D:7777:0260:3EFF:FE15:9501`

> Details can be shown in tooltip.

👍"
1857800353,20118,glassez,2023-12-15T12:22:32Z,"> > or maybe `IPv4: 123.456.7.8 | IPv6: 2001:0DB8:3C4D:7777:0260:3EFF:FE15:9501`
> 
> I don't think that's a good idea, a `, ` separator like that would save some space. `IP: 123.456.7.8, 2001:0DB8:3C4D:7777:0260:3EFF:FE15:9501` and `IPv4: 123.456.7.8 | IPv6: 2001:0DB8:3C4D:7777:0260:3EFF:FE15:9501`

To clarify. I meant two separate items of status bar.
Personally I would keep only addresses w/o `IP` etc. That would be enough. If not, then someone could look (once) at the details in the tooltip."
1858231124,20118,OdinVex,2023-12-15T17:26:39Z,"> We don't want to `call things 'Internet Protocol(s)' instead of addresses`. We do want to write `IP` as a shortcut of `IP address`. I can't figure out what the problem is. A similar thing (called ""metonymy"") is used everywhere (just look around, it's strange that you haven't come across it). We say ""IP"" instead of ""IP address"", ""E-mail"" instead of ""E-mail address"" whenever the context allows us to do it unambiguously.

I say e-mail address and IP address. \*shrug\*

> Is it a really good idea to do it this way? Firstly, it is doubtful to implicitly enable something that was previously explicitly disabled by the user. Secondly, the log can be filled with a lot of messages, so it obviously won't seem intuitive to the user to see it.
> ...
> Personally, I would limit myself (at least to begin with) to something minimalistic like Deluge does. Just `IP: 123.456.7.8` or maybe `IPv4: 123.456.7.8 | IPv6: 2001:0DB8:3C4D:7777:0260:3EFF:FE15:9501`. Details can be shown in tooltip. Or, if it is really necessary to see more details/statistics, we can later add ""External address info"" dialog that is displayed when you click on appropriate button on status bar.

That's what showing the Execution Log was to do. It simply re-used the pre-existing UI and filters to just the relevant messages (WebUI can filter by text which makes it much more useful, GUI can only filter by message type and is less useful).

Not sure if this is known, but this doesn't have to be perfect to get such a useful feature implemented. It doesn't *harm* anything except at most screen-space. On a side note, I disable the Search and RSS but they re-enable themselves and are useless to me. If they intentionally click on the addresses then they intentionally want more information, I don't see any harm in showing the Execution Log tab *when they specifically asked for information/details*. Fancy conveyance was 'immediately' irrelevant development to simply getting the functionality out there."
1923702440,20118,stauffenberg2020,2024-02-02T12:23:55Z,Can a country flag be shown next to the IP address?
1924282250,20118,OdinVex,2024-02-02T17:01:39Z,"> Can a country flag be shown next to the IP address?

Not sure why you'd want that but probably, qB already has the capability to show peers so it'd just be a matter of adding it. For now I'm just using my Violentmonkey script."
1924308751,20118,stauffenberg2020,2024-02-02T17:13:32Z,"> Not sure why you'd want that but probably, 

I use qB in Docker container attached to a macvlan network. And this macvlan network is encrypted through a VPN. I always want to make sure that the encryption is working properly, i.e. qB is always connected through VPN to the external network. Hope its clear.

"
1924315097,20118,OdinVex,2024-02-02T17:15:57Z,"> > Not sure why you'd want that but probably,
> 
> I use qB in Docker container attached to a macvlan network. And this macvlan network is encrypted through a VPN. I always want to make sure that the encryption is working properly, i.e. qB is always connected through VPN to the external network. Hope its clear.

That doesn't explain at all why a *country flag* would be what you want. You'd see the external IP address. As for the reason for showing an IP address...same, doing the whole VPN deal."
1924345200,20118,stauffenberg2020,2024-02-02T17:24:16Z,"> That doesn't explain at all why a _country flag_ would be what you want. You'd see the external IP address. As for the reason for showing an IP address...same, doing the whole VPN deal.

Well, Somewhat true. I would always choose a VPN from a different geographical region than my current region. 

The point is, I want to see a (red/green) flag/icon that my qB container is connected through VPN and not exposing my ip publicly. Since the docker container is connected through macvlan network, it cannot find out what my public ip is, unless the vpn service is down. 

Hence, if I see a country flag other than my current region - I will add downloads without hesitation. 

"
1924382554,20118,OdinVex,2024-02-02T17:37:55Z,"> Well, Somewhat true.

Not ""somewhat true"" at all, your response did not actually say why, you simply mentioned something you're doing. Just pointing it out."
1924388334,20118,stauffenberg2020,2024-02-02T17:40:55Z,"> > Well, Somewhat true.
> 
> Not ""somewhat true"" at all, your response did not actually say why, you simply mentioned something you're doing. Just pointing it out.

Did you understand the need for the feature request now? Or should I explain further in detail?"
1924395439,20118,OdinVex,2024-02-02T17:45:01Z,"> > > Well, Somewhat true.
> > 
> > 
> > Not ""somewhat true"" at all, your response did not actually say why, you simply mentioned something you're doing. Just pointing it out.
> 
> Did you understand the need for the feature request now? Or should I explain further in detail?

Of course I did, but I don't make assumptions, that makes for bad communication and bad reading comprehension. You have a reading comprehension issue. Edit: To very clearly clarify, I do understand what you want, I'm just pointing out that you did not say why when I asked you why."
1924401909,20118,stauffenberg2020,2024-02-02T17:49:47Z,"> I do understand what you want

Thanks, I only look forward to the implementation when some of the experts have time to do it, not an English class as I am not a native English speaker and neither I want to be a shakespear or churchill.

"
1924407132,20118,OdinVex,2024-02-02T17:53:04Z,"> > I do understand what you want
> 
> Thanks, I only look forward to the implementation when some of the experts have time to do it, not an English class as I am not a native English speaker and neither I want to be a shakespear or churchill.

I've been a Linux Kernel developer, contributed to mainline even, I *am* an expert, 20 years now and counting. This had nothing to do with English classes or anything of the sort. You did not actually state *why*, you simply stated something you *do* which did not explain *why*. I'm just going to ignore your rude deflections. You can _wait_ for _other_ experts to add it for all I care now."
1925749414,20118,stalkerok,2024-02-04T13:26:11Z,"It's a good idea actually, but it could be implemented in another PR.
@OdinVex, could you implement what has already been suggested here? It would also be nice to have a setting to disable the display of IP address. Or even vice versa, that by default this setting would be disabled, so that it would not show IP address."
1925775825,20118,OdinVex,2024-02-04T14:30:38Z,"> It's a good idea actually, but it could be implemented in another PR. @OdinVex, could you implement what has already been suggested here? It would also be nice to have a setting to disable the display of IP address. Or even vice versa, that by default this setting would be disabled, so that it would not show IP address.

No one seems to agree about how best to implement. I say show both last IPv4 and last IPv6 detected with a proper string informing people, but apparently that's ""too much info taking up too much space"". Another thinks the execution log shouldn't be shown even if users click on the address(es) and wants a popup. I never got any answer from a Windows user as to whether qB reports IPv6 addresses with zone info or just the address detected (though this is about external IP address, so I'm not sure why they brought that up to begin with...). I'm not going to waste time just to be told it isn't wanted in the end (the crying about screen real-estate, they can just disable it). No design decision makes everyone happy, hands are tied.

The ingredients are there if people want to tinker. I've implemented what I want with a Violentmonkey script, it works flawlessly and just how I like it. It shows last IPv4 and IPv6 addresses and clicking it shows my execution log filtered to show addresses. It also has a nice ""info"" icon and no one is fussing about screen real-estate or design of it.

Edit: As for whatever their name's suggestion they can hope someone else implements it. Their problem, not mine."
1925787715,20118,stalkerok,2024-02-04T15:09:07Z,"> No one seems to agree about how best to implement. I say show both last IPv4 and last IPv6 detected with a proper string informing people, but apparently that's ""too much info taking up too much space"".

You can implement one of the suggested options, I don't think anyone will mind.

> `IP: 123.456.7.8, 2001:0DB8:3C4D:7777:0260:3EFF:FE15:9501`
> and
> `IPv4: 123.456.7.8 | IPv6: 2001:0DB8:3C4D:7777:0260:3EFF:FE15:9501`

> Another thinks the execution log shouldn't be shown even if users click on the address(es) and wants a popup.

You can put this off for another PR, maybe someone will implement it later. But I said already my wishes about this, that the popup would look the same as the ""connection status"" window."
1925790221,20118,OdinVex,2024-02-04T15:16:10Z,"> > No one seems to agree about how best to implement. I say show both last IPv4 and last IPv6 detected with a proper string informing people, but apparently that's ""too much info taking up too much space"".
> 
> You can implement one of the suggested options, I don't think anyone will mind.
> 
> > `IP: 123.456.7.8, 2001:0DB8:3C4D:7777:0260:3EFF:FE15:9501`
> > and
> > `IPv4: 123.456.7.8 | IPv6: 2001:0DB8:3C4D:7777:0260:3EFF:FE15:9501`
> 
> > Another thinks the execution log shouldn't be shown even if users click on the address(es) and wants a popup.
> 
> You can put this off for another PR, maybe someone will implement it later. But I said already my wishes about this, that the popup would look the same as the ""connection status"" window.

So that's where the confusion is... That's is not a popup (an actual 'window'), that is a **tooltip**... That's already in there..

I'm not changing the string from 'External Address...' in my src, it makes no sense without it. Showing a random address with no indication if it's local interface or external address detected makes no sense. If you want it you add it."
1925791087,20118,stalkerok,2024-02-04T15:18:39Z,"> So that's where the confusion is... That's is not a popup (an actual 'window'), that is a **tooltip**... That's already in there..

Oops, yeah, that's what I mean."
1925791748,20118,OdinVex,2024-02-04T15:20:33Z,"> > So that's where the confusion is... That's is not a popup (an actual 'window'), that is a **tooltip**... That's already in there..
> 
> Oops, yeah, that's what I mean.

Yeah, that's already in there. If you hover over it you'll see the same thing you see already, it's a default in QT (but I had not gotten around to showing it in web UI I think, at least in the pushed src.)"
2057898044,20118,OdinVex,2024-04-15T22:10:57Z,Herpderp unstale.
2168960844,20118,OdinVex,2024-06-15T00:16:54Z,Herpderp unstale.
2211795925,20118,bacon-cheeseburger,2024-07-06T15:20:00Z,"I use -nox/cli + webui only and would like this feature. I couldn't care less about debating the labeling and whether an extra single character is wasting space ("", "" vs "" | ""). If that's a concern, this is 2024 and people know what ipv4 and ipv6 addresses look like. ""x.x.x.x"" and ""x:x:x:x:x:x:x:x"" is more than suitable. If someone doesn't know what those are, they wouldn't be looking for it in the first place. Don't over-think it.

Anyways, is this PR in current form the one to use? If not, where should I be looking? Thanks."
2211815941,20118,OdinVex,2024-07-06T16:43:04Z,"> this is 2024 and people know what ipv4 and ipv6 addresses look like
> If someone doesn't know what those are, they wouldn't be looking for it in the first place. Don't over-think it.

Not everyone knows what IP addresses are, even. Just because they don't know what something is doesn't mean they won't see it. It's not over-thinking, it's preventing software from becoming dumb as fuck like Windows became. This PR is just here for whoever wants a head start on maintaining their own patches. I simply use a ViolentMonkey script to do exactly what I wanted and it works well for all of us regardless of this entire thread+PR. If people want it they can use it or tweak it however they like.

Edit: The space-saving bit I didn't care about either considering the purpose of it all but one person appeared to be bothered by the space an IPv6 address might take up on screens too tiny to be usable... I think they're confused about the entire UI needing to use CSS to style things appropriate for DPI-related issues such as tiny screens or 4K monitors+ by using a singular root base font size and relative (em, etc) changes and SVGs so everything renders correctly at any size and designed for the screen size, and so-on."
2211823430,20118,bacon-cheeseburger,2024-07-06T17:16:22Z,"> > this is 2024 and people know what ipv4 and ipv6 addresses look like
> > If someone doesn't know what those are, they wouldn't be looking for it in the first place. Don't over-think it.
> 
> Not everyone knows what IP addresses are, even. Just because they don't know what something is doesn't mean they won't see it. It's not over-thinking, it's preventing software from becoming dumb as fuck like Windows became. This PR is just here for whoever wants a head start on maintaining their own patches. I simply use a ViolentMonkey script to do exactly what I wanted and it works well for all of us regardless of this entire thread+PR. If people want it they can use it or tweak it however they like.

I don't believe the average GenX-GenZ person, which makes up probably 99.9% of the qbittorrent user base, doesn't know what an ip is. If they don't, seeing ""x.x.x.x"" vs. ""ipv4 x.x.x.x"" isn't going to change anything for them. We can agree to disagree, no prob.

I do believe providing the external ip to the user can be useful be it via internally in qbittorrent (preferable imo) or the ViolentMonkey script you mentioned. "
2211823690,20118,glassez,2024-07-06T17:17:21Z,"> Not everyone knows what IP addresses are, even. Just because they don't know what something is doesn't mean they won't see it. It's not over-thinking, it's preventing software from becoming dumb as fuck like Windows became.

It's not very clear what exactly you mean.

If I see, for example, `93.184.216.34` in status bar, and I know that this is an IP, then I don't need any labels (especially something too detailed, like `IP Address` instead of a short `IP`). The only thing I might be interested in is what kind of IP address is displayed here (i.e. an _external_ address in this case). But this is the kind of information that is required only once upon first time you use the application (and only provided that you have not dealt with other similar applications), so it is not only wasteful, but also pointless to occupy a workplace with it, it is enough that it is displayed in the tooltip (along with other external addresses, if there are several of them).
If someone does not know what an IP address is, then a constantly visible label will not help them either."
2211828404,20118,OdinVex,2024-07-06T17:37:29Z,">I don't believe the average GenX-GenZ person, which makes up probably 99.9% of the qbittorrent user base, doesn't know what an ip is. If they don't, seeing ""x.x.x.x"" vs. ""ipv4 x.x.x.x"" isn't going to change anything for them. We can agree to disagree, no prob.

> If someone does not know what an IP address is, then a constantly visible label will not help them either.

I won't assume 99.9% are but I would lend they would most likely make up the majority, uncontested. Usually seeing unfamiliar terms leads intelligent people to query their definition and a quick query of 'IPv4/v6' might be enough for people to get the gist of what they are.

> If someone does not know what an IP address is, then a constantly visible label will not help them either.

I don't know how many torrenters know what DHT is but it's labeled and there. I looked into what DHT was when I saw it. People might take a moment to learn, might not.

> It's not very clear what exactly you mean.

It may not be clear to you but it's clear to a few people without GitHub accounts that I develop with that use qB, I keep them abreast of this thread in particular because they wanted this feature and just use my ViolentMonkey script meanwhile. Some have been around since the early phreaking days, though myself a little after. We've noticed the mass dumbing down of software hiding away information or control, usually in the name of making things better...and the horrible side-effect (hopefully not intention) of people not being able to gleam or understand the underlying workings of things. Over ""helpfulness"". It ends up with people on forums asking derp-simple questions or reinventing software and scripts to bring back control or functionality.

> especially something too detailed, like IP Address instead of a short IP)

This was already discussed. IP does not mean IP address, it means Internet Protocol. Short-hand has led to people saying 'IP' but it's still incorrect, but I specifically mentioned I didn't care if qB changed the strings.

> But this is the kind of information that is required only once upon first time you use the application

I'd like to offer the thought: that would be an assumption for some. *I'd* like to know if my ISP went down even for a few seconds and issued a DOCSIS devreset rebooting all modems and giving me a different IP...or to know if my VPN is still functional, let alone if my private IP leaked due for any reason. I'm not the only one that specifically feels this way, a quick search engine (Bing, Google, fill in) about kill-switching qB outgoing connections due to a VPN loss and such reveals a lot of people wish they could monitor the external address of the qB host. My ViolentMonkey script specifically changes an icon to flash a critical one while alerting to any address changes.

In the end, I don't think it *hurts* to let people know the external address(es) detected and I *know* of some obvious helpfulness of it. The RSS tab is 100% useless to me but I'm not fussing about screen space or the fact I had to keep turning it off every session until my ViolentMonkey script. The fact the execution log isn't shown by default bugs me but I turned it on with my ViolentMonkey as well. Others using it liked it this way too.

Edit: Entire point is for this to be helpful to those that might need it.
Edit: I'd also like to again point out Deluge has had it for years and it's been requested for qB a number of times as well. Seems it's all quibbling about how to display or communicate it in the status bar. IPv6 addresses being as long as they are with screen space being an issue with screens that can't even display the UI to begin with has thrown a wrench into it by bringing up the 'px' implementation of measuring rather than relative sizes to easily layout the UI but eh...feature or none, the other script users are happy and not one has complained of anything so far."
2211833521,20118,glassez,2024-07-06T17:59:03Z,"> But this is the kind of information that is required only once upon first time you use the application

@OdinVex 
You took that phrase out of context and wrote a lot of unrelated information underneath it in response."
2211834117,20118,OdinVex,2024-07-06T18:01:18Z,"> @OdinVex You took that phrase out of context and wrote a lot of unrelated information underneath it in response.

> If I see, for example, `93.184.216.34` in status bar, and I know that this is an IP, then I don't need any labels (especially something too detailed, like `IP Address` instead of a short `IP`). The only thing I might be interested in is what kind of IP address is displayed here (i.e. an _external_ address in this case). But this is the kind of information that is required only once upon first time you use the application (and only provided that you have not dealt with other similar applications), so it is not only wasteful, but also pointless to occupy a workplace with it, it is enough that it is displayed in the tooltip (along with other external addresses, if there are several of them). If someone does not know what an IP address is, then a constantly visible label will not help them either.

I don't think I did at all. It was all related. Edit: To clarify in case it wasn't obvious, I may want to see that information at any time, that was the whole point of the reply by showing scenarios very practical and real versus your ""only required once upon first time"" posit."
2211892546,20118,glassez,2024-07-06T19:22:15Z,"> To clarify in case it wasn't obvious, I may want to see that information at any time, that was the whole point of the reply by showing scenarios very practical and real versus your ""only required once upon first time"" posit.

OK, please explain what you mean by ""that information"".
>""only required once upon first time""

This phrase in the context of my comment means a label near the displayed IP address value.
I was saying that you don't need to see `External IP Address: 93.184.216.34` in the status bar all the time, but `93.184.216.34` is enough. A description of what kind of IP address is displayed there can be placed in the corresponding tooltip."
2211900880,20118,OdinVex,2024-07-06T19:40:09Z,"> OK, please explain what you mean by ""that information"".

The externally detected IP addresses. ...? That was the entire purpose of the initial filing and the initial PR and then this PR?

> This phrase in the context of my comment means a label near the displayed IP address value.
I was saying that you don't need to see External IP Address: 93.184.216.34 in the status bar all the time, but 93.184.216.34 is enough. A description of what kind of IP address is displayed there can be placed in the corresponding tooltip.

That isn't what was said but I understand what you're saying in this reply. This was already resolved though, I mentioned that the qB project can do whatever they want with the strings. If you want it to say ""Hamburgers:"" go head, or nothing at all, fine, I don't care what qB does with it. I've only ever pointed out that it's weird and unintuitive UI development to just display an address with no context (eg., ""External IPv4/IPv6 detected:"" (or whatever the case may be)). I've never cared what qB *does* with it, I simply wanted to lay the ground work since no one had done it. People can edit their translations file(s) to correct/adjust/prefer whatever they want.

I'd like to note a feature idea as well. The option to use an interface's IP address(es) over remotely fetched addresses. It's purely to eliminate traffic and reliance upon a third party for users that *know* they'll only ever have public addresses and such."
2212492561,20118,OdinVex,2024-07-07T15:55:33Z,"@hackerz-hub Some of my script users have rotating VPNs too, yeah. This was part of their desire to see the externally-detected addresses. I think the only thing mostly being argued here is how to convey the information."
2214170726,20118,OdinVex,2024-07-08T14:04:38Z,"@hackerz-hub, An image of what?"
2214219789,20118,xavier2k6,2024-07-08T14:22:55Z,"@OdinVex I suggest you `rebase` & take care of current conflicts which need to be resolved, this will also allow others to use CI builds for testing purposes."
2214242669,20118,OdinVex,2024-07-08T14:31:41Z,"> > But this is the kind of information that is required only once upon first time you use the application (and only provided that you have not dealt with other similar applications), so it is not only wasteful, but also pointless to occupy a workplace with it
> 
> > OK, please explain what you mean by ""that information"".
> 
> I just read this entire knowledge thread, I dont know if it is just me, But it looks like the admin @glassez is perhaps completely unaware (based on the replies!) of why **this feature** (this feature = displaying like `93.184.216.34`) is a needed one in the status bar.
> 
> Unless the admin gets a full understanding of the _need_ for **this feature** - he/she might not want to merge this into qB and hence this lack of understanding becomes a reason for forks and dilution.
> 
> Perhaps other admins (@Chocobo1, @FranciscoPombal, @jagannatharjun, @ngosang, @Piccirello, @sledgehammer999, @xavier2k6 ) should try to understand the need for this feature
> 
> or may be, @OdinVex - Can you **please** try to create a PR with a detailed summary for helping the admins to understand this PR ? - Because there is too much discussion around cosmetics rather than getting in the fundamental ground work

The cosmetics is the only issue here.

> > @hackerz-hub, An image of what?
> 
> @OdinVex - A Docker image of qBittorrent with your proposed modification of showing the IP address in the status bar of Web UI

I thought I embedded a screenshot in the first PR. Maybe I forgot.

![PAD4](https://github.com/qbittorrent/qBittorrent/assets/44311901/3a1a601a-3f3c-41f6-aa80-63fe0688aebd)
![PAD6](https://github.com/qbittorrent/qBittorrent/assets/44311901/be4abf30-fd23-40de-a6f4-cb3aa1e1016f)

> @OdinVex I suggest you `rebase` & take care of current conflicts which need to be resolved, this will also allow others to use CI builds for testing purposes.

I mentioned through this PR that I'm not doing anything anymore, I only bump it to keep it alive for anyone else who wants to deal with disagreements around cosmetics."
2214900884,20118,OdinVex,2024-07-08T18:30:35Z,"> > > > @hackerz-hub, An image of what?
> > > 
> > > 
> > > @OdinVex - A Docker image of qBittorrent with your proposed modification of showing the IP address in the status bar of Web UI
> > 
> > 
> > I thought I embedded a screenshot in the first PR. Maybe I forgot.
> > ![PAD4](https://private-user-images.githubusercontent.com/44311901/346605558-3a1a601a-3f3c-41f6-aa80-63fe0688aebd.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjA0NjI5NDMsIm5iZiI6MTcyMDQ2MjY0MywicGF0aCI6Ii80NDMxMTkwMS8zNDY2MDU1NTgtM2ExYTYwMWEtM2YzYy00MWY2LWFhODAtNjNmZTA2ODhhZWJkLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA3MDglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNzA4VDE4MTcyM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTgyYjA1NDhkMWIyYTRkYjk1ZjYzOTUwZDM4NDBlYzIxZjQ2Y2E3NTZiMzBiOGQzNjQwM2YxM2JkZjFjNDQzYjEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.VwvkW4MvZj13Wb6gOGyihBEIRclboYHc9w74Z159mbU) ![PAD6](https://private-user-images.githubusercontent.com/44311901/346605605-be4abf30-fd23-40de-a6f4-cb3aa1e1016f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjA0NjI5NDMsIm5iZiI6MTcyMDQ2MjY0MywicGF0aCI6Ii80NDMxMTkwMS8zNDY2MDU2MDUtYmU0YWJmMzAtZmQyMy00MGRlLWE2ZjQtY2IzYWExZTEwMTZmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA3MDglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNzA4VDE4MTcyM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTFkMDVjZGZhZjk1NWI0MTQxMzg5ZTVjNGMxNTg5OWI3YmMxYjBlNDQ1NTIyMWM0ZjkyOGJlY2RmYjk1ODgwMGYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.QxpLPyvpBZzqW1hzjP-v8yTQLFPMPoCNs7scw1Z-v7U)
> 
> I am surprised you didn't know what is a [Docker image](https://docs.docker.com/guides/docker-concepts/the-basics/what-is-an-image/) and instead attached a png image ! Can you let me know how you tested your original implementation in WebUI?

I know what a Docker image is. You asked for an image but never specified of what (I knew you were talking about a Docker image, but it made no sense to ask for the only thing I have: a ViolentMonkey Script). The images I instead gave were of the implementation in the WebUI, that's why I posted it. It's relevant to the only issue relating to this PR: Cosmetics. Keep up bud."
2214921215,20118,stalkerok,2024-07-08T18:41:38Z,"Time to force close this PR, maybe someone from the team will have the desire to implement this later. Or make changes and finalize this PR."
2214933324,20118,OdinVex,2024-07-08T18:48:59Z,"> Time to force close this PR, maybe someone from the team will have the desire to implement this later. Or make changes and finalize this PR.

They have no desire, despite there periodically being new Issues asking for it. It's been in Deluge for years, qBittorrent developers didn't seem to give a fuck when I read all the Issues asking for it. ""Lay the groundwork"" was what it ended up being. I did but the developers don't like it. I told them they could change whatever but all they did was rehash. Oh well, that's all there is to it."
2351486891,20118,skomerko,2024-09-15T09:16:39Z,"Hey @Piccirello, could you look into it maybe? I read through this thread and it looks like remaining problems are mostly cosmetics. It would help a ton of people. I don't have much experience and at most could bring parts to make it work in the WebUI but I guess not everybody would be satisfied :P"
333287464,7522,glassez,2017-09-30T06:23:54Z,PR updated.
333288674,7522,glassez,2017-09-30T06:51:03Z,As you can see `conf.pri.mingw` and `conf.pri.msvc` have mostly the same content. I would join it into single `conf.pri.example` file.
333328140,7522,glassez,2017-09-30T18:46:12Z,"@sledgehammer999, what about having only one example config file?"
333329224,7522,glassez,2017-09-30T19:04:43Z,PR updated. Added more comments.
333365346,7522,glassez,2017-10-01T09:44:52Z,">Yes the conf.pri.* files can be merged into one example file.
Maybe name it `conf.pri.windows`?

Done.
I use the proposed name `conf.pri.windows` unless someone have strong objections."
333570929,7522,glassez,2017-10-02T15:31:26Z,"PR updated again.
Stack trace support enabled from user config now."
333579807,7522,glassez,2017-10-02T16:00:08Z,"@Chocobo1, addressed your last comments."
334059944,7522,glassez,2017-10-04T06:17:46Z,">The English grammar in the comments is correct.

Wow! Glad to hear it."
334060261,7522,glassez,2017-10-04T06:19:52Z,Thank you all!
335015623,7522,funkydude,2017-10-08T15:48:38Z,"@Chocobo1 @sledgehammer999 You are using Qt 5.9 no? As far as I'm aware, it removed support for Vista and XP, so targeting XP can probably be changed."
335026355,7522,glassez,2017-10-08T18:05:51Z,">@Chocobo1 @sledgehammer999 You are using Qt 5.9 no? 

@sledgehammer999 uses 5.9.x for 64-bit releases (Vista+) and 5.7.x for 32-bit releases (XP+).
>As far as I'm aware, it removed support for Vista and XP, so targeting XP can probably be changed.

What do you mean?"
335050294,7522,funkydude,2017-10-09T00:40:28Z,"> 5.9.x for 64-bit releases (Vista+) 

Qt 5.9 only supports 7 and above, not Vista.

> What do you mean?

https://github.com/qbittorrent/qBittorrent/blob/master/conf.pri.windows#L47

@glassez But if these build files are only for the 32 bit version then you can just ignore my comment."
335210346,7522,glassez,2017-10-09T16:30:22Z,">@glassez But if these build files are only for the 32 bit version then you can just ignore my comment.

`conf.pri.windows` is just an example configuration. You can use different settings."
335271691,7522,funkydude,2017-10-09T20:08:00Z,"@glassez The comment was a direct response to the following comment from @evsh 

> Maybe we can again discuss dropping the XP support?

Are you stating this is not what is used for the official release?"
335283207,7522,sledgehammer999,2017-10-09T20:50:19Z,">Are you stating this is not what is used for the official release?

I am doing the official releases.
The 32-bit release is based on Qt 5.7.1 and supports Windows XP.
The 64-bit release is based on Qt 5.9.1 (soon 5.9.2) and doesn't support Windows XP.

For 64bit I disable this line:
```
DEFINES += BOOST_USE_WINAPI_VERSION=0x0501
```"
57332748,1984,Gelmir,2014-09-30T15:33:17Z,"Oh. And I've found my old patch. Almost gave up the search.

``` diff
diff -ruN --binary -x '.git*' -x '*.user' -x '*.orig' -x '*.dat' -x '*.qm' qBittorrent_orig/src/mainwindow.cpp qBittorrent/src/mainwindow.cpp
--- qBittorrent_orig/src/mainwindow.cpp 2013-02-12 21:22:43.336782700 +0400
+++ qBittorrent/src/mainwindow.cpp  2013-02-16 13:20:43.253188300 +0400
@@ -103,7 +103,7 @@
   setWindowTitle(tr(""qBittorrent %1"", ""e.g: qBittorrent v0.x"").arg(QString::fromUtf8(VERSION)));
   displaySpeedInTitle = pref.speedInTitleBar();
   // Clean exit on log out
-  connect(static_cast<SessionApplication*>(qApp), SIGNAL(sessionIsShuttingDown()), this, SLOT(deleteBTSession()));
+  connect(static_cast<SessionApplication*>(qApp), SIGNAL(sessionIsShuttingDown()), this, SLOT(deleteBTSession()), Qt::DirectConnection);
   // Setting icons
 #if defined(Q_WS_X11)
   if (Preferences().useSystemIconTheme())
@@ -328,14 +328,31 @@
 }

 void MainWindow::deleteBTSession() {
+#ifdef Q_OS_WIN
+  HMODULE result = LoadLibrary(TEXT(""User32.dll""));
+  typedef BOOL (WINAPI *DEFER_FUNC)(HWND, LPCWSTR);
+  typedef BOOL (WINAPI *RESUME_FUNC)(HWND);
+  DEFER_FUNC DeferSessionEnd = NULL;
+  RESUME_FUNC ResumeSessionEnd = NULL;
+  if(result) {
+    DeferSessionEnd = (DEFER_FUNC) GetProcAddress(result, ""ShutdownBlockReasonCreate"");
+    ResumeSessionEnd = (RESUME_FUNC) GetProcAddress(result, ""ShutdownBlockReasonDestroy"");
+    if(DeferSessionEnd && ResumeSessionEnd)
+      DeferSessionEnd(this->winId(), TEXT(""Saving data...""));
+  }
+#endif
   guiUpdater->stop();
   status_bar->stopTimer();
   QBtSession::drop();
   m_pwr->setActivityState(false);
   // Save window size, columns size
   writeSettings();
-  // Accept exit
-  qApp->exit();
+#ifdef Q_OS_WIN
+  if(result) {
+    if(DeferSessionEnd && ResumeSessionEnd)
+      ResumeSessionEnd(this->winId());
+  }
+#endif
 }

 // Destructor
diff -ruN --binary -x '.git*' -x '*.user' -x '*.orig' -x '*.dat' -x '*.qm' qBittorrent_orig/src/sessionapplication.cpp qBittorrent/src/sessionapplication.cpp
--- qBittorrent_orig/src/sessionapplication.cpp 2013-02-12 17:15:42.751093700 +0400
+++ qBittorrent/src/sessionapplication.cpp  2013-02-16 13:21:18.885245100 +0400
@@ -42,6 +42,7 @@
 void SessionApplication::commitData(QSessionManager & manager) {
   Q_UNUSED(manager);
   emit sessionIsShuttingDown();
+  manager.release();
 }

 bool SessionApplication::notify(QObject* receiver, QEvent* event) {
```
"
57488807,1984,paolo-sz,2014-10-01T15:58:50Z,"Ok, I made some improvements to the patch and now there are no more constraints on Qt version. I tried (Win7) with Qt4.8.5 and Qt5.3.2 and everything behaves as expected (with the Sleep(120000) trick placed just after the setSDBlockReason() call in the shutdownCleanUp() function.
What I miss are tests on XP...
"
57935181,1984,TONPumper,2014-10-05T12:57:54Z,"Does this mean that there is going to be a new version released to correct the issue?
"
57935287,1984,sledgehammer999,2014-10-05T13:01:22Z,"@paolo-sz 
Some nitpicks:
1. You should use eg `::GetProcAddress()` for any WINAPI call. `::` denotes the global namespace where all WINAPI functions live. Why should you do this? Code readability. A 3rd party reading that code will know immediately that that function is WINAPI and not Qt/qbittorrent function.
2. Don't leave comments after the `#else` or `#endif`. QtCreator does a pretty good job on separating everything visually.

Now other random things:
1. [GetVersion()](http://msdn.microsoft.com/en-us/library/windows/desktop/ms724439%28v=vs.85%29.aspx) seems to be deprecated on later versions. I think its better to use [IsWindowsVersionOrGreater()](http://msdn.microsoft.com/en-us/library/windows/desktop/dn424964%28v=vs.85%29.aspx) instead.
2. Why use GetModuleHandleA() instead of GetModuleHandle() ?
3. User visible strings should be wrapped in the tr() macro. `QString tmpstr(""Please wait while qBittorrent is exiting...\nBe patient, it could take a while..."");` should be `QString tmpstr(tr(""Please wait while qBittorrent is exiting...\nBe patient, it could take a while...""));` However I am not sure we should include a linebreak in the translatable text. Translators might remove it.

There might be some other syntax improvements possible but I don't want to dwelve into those. I'll do them myself after I merge this.

@Gelmir do you have anything to add?
"
57935319,1984,sledgehammer999,2014-10-05T13:02:25Z,"@paolo-sz 
To clarify: I meant to say that you should use `::` before any WINAPI call for code readability.
"
57937251,1984,Gelmir,2014-10-05T14:13:59Z,"@sledgehammer999, no objections.
"
58015814,1984,paolo-sz,2014-10-06T13:24:02Z,"> 1. You should use eg ::GetProcAddress() for any WINAPI call. :: denotes the global namespace where all WINAPI functions live. Why should you do this? Code readability. A 3rd party reading that code will know immediately that that function is WINAPI and not Qt/qbittorrent function.

Ok, understood.

> 1. Don't leave comments after the #else or #endif. QtCreator does a pretty good job on separating everything visually.

Ok... I'm not using QtCreator unless for deep debug reasons...

> 1. GetVersion() seems to be deprecated on later versions. I think its better to use IsWindowsVersionOrGreater() instead.

I completely agree but I was not sure on the Microsoft SDK used by the project (mainly you). IsWindowsVersionOrGreater requires SDK 8.0 (or 8.1, I don't remember exactly) while GetVersion is marked to be deprecated for future versions. On top of this mingw (mine, at least) does not have IsWindowsVersionOrGreater defined yet so I choose to use GetVersion...

> 1. Why use GetModuleHandleA() instead of GetModuleHandle() ?

Well, I don't know... to tell you the truth I just copied the code from internet...

> User visible strings should be wrapped in the tr() macro.

Ok.

Just for curiosity, did you have the chance to try the patch with XP?
If so, is it working without changes or it needs some adjustments?
"
58071321,1984,sledgehammer999,2014-10-06T18:49:01Z,"> I completely agree but I was not sure on the Microsoft SDK used by the project (mainly you). IsWindowsVersionOrGreater requires SDK 8.0 (or 8.1, I don't remember exactly) while GetVersion is marked to be deprecated for future versions. On top of this mingw (mine, at least) does not have IsWindowsVersionOrGreater defined yet so I choose to use GetVersion...

You are right. My mingw (gcc 9.0) does not include it neither does my msvc2008 installation.
So basically we should use GetVersion() for the moment.
I don't understand why MS will change its behavior. This probably brake a lot of already released software.

> Just for curiosity, did you have the chance to try the patch with XP?

Do the changes we discussed and then I'll try to compile it under XP.
"
58074146,1984,sledgehammer999,2014-10-06T19:03:47Z,"> I don't understand why MS will change its behavior. This probably brake a lot of already released software.

From the GetVersion docs:

> With the release of Windows 8.1, the behavior of the GetVersion API has changed in the value it will return for the operating system version. **The value returned by the GetVersion function now depends on how the application is manifested.**
> 
> Applications not manifested for Windows 8.1 will return the Windows 8 OS version value (6.2). Once an application is manifested for a given operating system version, GetVersion will always return the version that the application is manifested for in future releases. To manifest your applications for Windows 8.1 please refer to Targeting your application for Windows 8.1.

msvc builds automatically append a manifest and mingw builds use this manifest: https://github.com/qbittorrent/qBittorrent/blob/master/src/qbittorrent.exe.manifest

I don't know if that is enough to trigger the ""old behavior"" in newer versions of Windows. Further doc reading is needed.
"
58077598,1984,sledgehammer999,2014-10-06T19:21:08Z,"We are overthinking this. Gelmir's path had something that I missed. Something that we already do for WINAPI in other places in qbt(probably Gelmir's code too).

Since you dynamically look for `ShutdownBlockReasonCreate` you should only check if that pointer is NULL. If it is then that means we are running on a system that doesn't support it (ie XP). No need to check for OS version.
"
58158376,1984,paolo-sz,2014-10-07T09:24:36Z,"I made the changes you request.
I have also refined the patch to the minimum needed to work (only WM_QUERYENDSESSION message intercepted, only one call to windowsEventFilter::setSDBlockReason) in order to solve a double blocking message in some cases.
I also added the italian translation (with \n included... it works).
Everything rebased in a unique commit.
"
58172321,1984,sledgehammer999,2014-10-07T11:48:47Z,"Remove the translations. Translations are done on transifex. You can register there and request to be added in the italian team. Here is the project page: https://www.transifex.com/projects/p/qbittorrent/

Also the github diff shows that mainwindow.h has its permissions changed to 755. Was this accidental?
"
58176032,1984,paolo-sz,2014-10-07T12:26:20Z,"> Also the github diff shows that mainwindow.h has its permissions changed to 755. Was this accidental?

Indeed I didn't change permissions directly, I guess my editor did that along the way, sorry...
"
58811561,1984,sledgehammer999,2014-10-12T17:32:16Z,"I compiled and run this in a clean Windows XP VM (using qt4). Each time I try to shutdown the OS, qbt is closed but the shutdown process is somehow aborted!!! I need to re-issue the shutdown for it to actually shutdown! wtf!?!?
"
58814762,1984,sledgehammer999,2014-10-12T18:26:26Z,"Irrelevant to the above:

> Applications should call this function as they begin an operation that cannot be interrupted, such as burning a CD or DVD. **When the operation has completed, call the ShutdownBlockReasonDestroy function to indicate that the system can be shut down.**

However, I don't see you using `ShutdownBlockReasonDestroy`. Wouldn't that stall the shutdown progress on supported OSes?
"
58858946,1984,paolo-sz,2014-10-13T08:03:19Z,"> I compiled and run this in a clean Windows XP VM (using qt4). Each time I try to shutdown the OS, qbt is closed but the shutdown process is somehow aborted!!! I need to re-issue the shutdown for it to actually shutdown! wtf!?!?

Good question... good question...
Definitely, I need to test my patch directly on XP... I will install a VM like you did and I will try to get the code working on XP too... until MS decides to change behaviors another time...

> However, I don't see you using ShutdownBlockReasonDestroy. Wouldn't that stall the shutdown progress on supported OSes?

I was supposing the block reason would be automatically destroyed when the application ends...
But I feel this is not the main cause of the behavior you see... probably it is related to WM_xxx signals management...
I will update you once I will have my XP VM alive...
"
58862109,1984,paolo-sz,2014-10-13T08:40:35Z,"Excerpt from http://msdn.microsoft.com/en-us/library/ms700677(v=vs.85).aspx

> In Windows XP, each running application is sent the WM_QUERYENDSESSION message at shutdown. Applications can return TRUE to indicate that they can be closed, or FALSE to indicate that they should not be closed (e.g., because doing so would cause the user to lose data or destroy a CD being burned). If an application returns FALSE, in most cases, shutdown will be cancelled (and the application that cancelled shutdown is sent WM_ENDSESSION with wParam == FALSE). Microsoft® guidance for applications that return FALSE is that they should display UI indicating why they needed to cancel shutdown.
> ...
> By default, applications can delay responding to WM_QUERYENDSESSION for up to 5 seconds. After 5 seconds, Windows XP will display a dialog that indicates that the application is not responding and allows the user to terminate it. Until the user responds to this dialog, applications can block WM_QUERYENDSESSION (and, consequently, shutdown) indefinitely. If the user clicks the ""End Now"" button on the dialog, the application is immediately terminated and shutdown will continue. If the user clicks the ""Cancel"" button, shutdown is canceled and the application will continue running.

If I understand correctly, the code you wrote, with aboutToQuit signal and shutdownCleanUp function, falls exactly in the delay response to WM_QUERYENDSESSION case and thus the shutdown is delayed until qbt closes (as you already reported somewhere in this thread).

At this point I do not see other ways except than detecting the OS through GetVersion and not enabling my code on XP (or below)... but again, I will be more precise when I will have the VM...
"
58903358,1984,sledgehammer999,2014-10-13T14:53:50Z,"Your excerpt explains everything that we have observed so far.
So we need stop sending FALSE for WM_QUERYENDSESSION in case of Windows XP.
"
59998263,1984,sledgehammer999,2014-10-21T21:02:36Z,"@paolo-sz 

I locally merged your branch and made some edits on top of it. Now the qt4 version behaves as expected on Windows XP. However the qt5 version has a weird behavior. The app never exits AND the shutdown is aborted. I need to manually quit the app and then issue a shutdown. To tell you the truth, I am actually using a bit old qt5 build based on qt 5.2.1. Maybe this is the problem. Or something else has changed in qt5. Dunno. I have to try again without your patches and see how it behaves. I re-read my code but I can't find something obviously wrong.

Can you test on your OS(Win7) and see if my edits work as expected?
1. Test if Windows wait for the app to exit when it is minimized to the tray and no window is visible.
2. Try putting a sleep() too.
3. When the app actually exits after the sleep() does the shutdown process continue or is it aborted?

One last question: In `WindowsEventFilter::nativeEventFilter()` when we detect `WM_QUERYENDSESSION` shouldn't we respond with ""TRUE"" according to the MSDN docs?

Here is my local branch: https://github.com/sledgehammer999/qBittorrent/tree/block_shutdown
"
60084548,1984,paolo-sz,2014-10-22T13:31:48Z,"Sorry, I just see your post now that I made my new push... I'll give a look to your branch... let me know if you prefer to go ahead with that or use mine which now behaves ""well"" both on XP(32bit) and Win7(64bit), qt4.8.5 and qt5.3.2

Indeed in my googling around I remember I found something about some issues on shutdown and qt5.2...

I did a lot of work on my original patch in order to simplify the code and now seems to be more elegant.

On the other side I notice the XP behavior is not so pretty and I try a thousand of ways to improve that but with real poor results so I temporary give-up and I made the push leaving the XP behavior as it was before.

The not nice behavior I'm referring to on XP is that the user is not well informed about the reason qbt is not responding and the fact that the cancel button on the pop-up window shown by windows behave like the ""end now"" button instead of canceling the shutdown process...
"
60084997,1984,sledgehammer999,2014-10-22T13:34:58Z,"Observation: You seem to have borked/mixed the commit history. I get 29 new commits for the poll request, which are actually already commited to master. Can you reworked your history and force push here again?
"
60085862,1984,paolo-sz,2014-10-22T13:41:12Z,"Ok, I did a big mess with git... do you have any suggestion on how to cleanup everything?
"
60086890,1984,sledgehammer999,2014-10-22T13:48:18Z,"1. Create a new branch based on your master branch(the branch in this pull request I presume)
2. Switch back to your master branch
3. Force pull the official master branch onto your master branch. The force pull should overwrite everything and make it identical to the official branch
4. Switch to your created branch
5. Look at the history of that branch and note down the hashes of your commits
6. Switch back to master
7. Use the ""cherry-pick"" command to cherry pick your commits onto the top of master(using the hashes one by one).
8. When done forcep push your master branch. It should overwrite your previous mess and update the current pull request.
"
60120165,1984,sledgehammer999,2014-10-22T17:12:56Z,"Can you test my branch? -using a new local branch- and see if it behaves correctly on your system?
"
60199323,1984,paolo-sz,2014-10-23T06:52:33Z,"Ok, just give me some days, I'm not sure I will be able to do that today or tomorrow...
"
60362865,1984,paolo-sz,2014-10-24T09:11:44Z,"I tried your branch, the scenarios are as usual (with the sleep trick):
1. visible mainwindow, logoff
2. mainwindow minimized to tray, logoff
3. qbt closed, logoff

Here are the results:
- XP_32, Qt5.3.2: all fine (except the cancel button behaving as the ""end now"", but this is ""normal"")
- XP_32, Qt4.8.5: as above
- 7_64, Qt5.3.2: all fine (except the double appearance of qbt in the list of application which are blocking shutdown in scenario 1)
- 7_64, Qt4.8.5: all fine

In any case, I suggest you to have a look to the latest cleaned commit on my branch. I understand you already did some work on the old version but I feel this new commit is really better as a starting point (or, at least, has some more comments)

> The app never exits AND the shutdown is aborted. I need to manually quit the app and then issue a shutdown. To tell you the truth, I am actually using a bit old qt5 build based on qt 5.2.1. Maybe this is the problem. Or something else has changed in qt5. Dunno. I have to try again without your patches and see how it behaves. I re-read my code but I can't find something obviously wrong.

One possible cause of this behavior could be the ""long *"" parameter (which should be ""result"") not used in our event filter. If I understand correctly, when our event filter returns true then the result value is the value returned to the OS. If result is FALSE then the shutdown is aborted. In my original branch and in your too, result is not assigned so, if the default value is FALSE, we see the problem you describe.

> The app never exits AND the shutdown is aborted

Are you sure about that never?
What I usually see is the app correctly exiting after 2 mins but the shutdown effectively aborted... but my previous comment about changes on shutdown in qt5.2.x vs Qt5.3.x is still valid...
"
62581956,1984,paolo-sz,2014-11-11T17:19:59Z,"This latest push is exactly the behavior I would see.
Tested with Qt5.3.2 and 4.8.6 in all the usual three scenarios and now everything behaves correctly (including the cancel button really canceling shutdown).
I feel this is the shortest, simpler and cleanest code I'm able to write for this pull request.
"
62608418,1984,sledgehammer999,2014-11-11T19:49:17Z,"Just so you know I haven't forgotten about this. If I'm lucky I'll get to review this the coming weekend.
"
73431476,1984,sledgehammer999,2015-02-08T21:00:26Z,"@paolo-sz this feature is really important. I merged a PR that moved the files around in the project tree and it broke this PR.
Can you rebase? Then I'll try to review it ASAP and hopefully get it merged for v3.2.0. Thanks for all the effort so far.
"
73677444,1984,paolo-sz,2015-02-10T10:30:19Z,"Wow, a huge code restructuring...
Ok, I realigned this PR to the new code/structure and all the usual tests are passing with Win7/XP (all combination possible).

Just a note not related to this issue, in main.cpp (line 203 and 205) you call to app.reset(....), sould not be app->reset?
"
76440488,1984,glassez,2015-02-27T17:55:44Z,"> Just a note not related to this issue, in main.cpp (line 203 and 205) you call to app.reset(....), sould not be app->reset?

We call QScopedPointer::reset() there.
"
76443460,1984,glassez,2015-02-27T18:14:05Z,"I have objections!
We use MainWindow dynamic creation in order not to create it without the need (for example, when the application is already running and we only need to pass parameters).
OOP != create classes for everything! Your functionality can be easily implemented inside the Application class.
"
76464435,1984,sledgehammer999,2015-02-27T20:18:20Z,"I hadn't reviewed this. I wasn't going to merge it as is. I just wanted a mergable state.
Tomorrow, I'll be free and I'll start reviewing this.
Hopefully I'll get the other milestone items fixed too, so we can get v3.2.0 out.
"
76528393,1984,paolo-sz,2015-02-28T14:37:05Z,"> Your functionality can be easily implemented inside the Application class.

@glassez, it doesn't matter where the functionality is implemented, the point is that it needs some handle to a window (MainWindow seems to be the most reasonable choice) until the application is exiting. I tried with the dynamically created MainWindow and the functionality of this PR is completely lost (with serious application crash).
Honestly I do not see other ways than making MainWindow statically created but I'm open to any suggestion
"
76531183,1984,glassez,2015-02-28T15:47:14Z,"I now have no time to delve into this issue...
But at least you can use `QScopedPointer<MainWindow>` to combine dynamic creation with the existence of the object until the application is exiting.
"
76690752,1984,paolo-sz,2015-03-02T10:43:26Z,"By the way, I'm going to test the changes suggested by @glassez.
As far as you are in the review process of this PR and I do not want to switch your ground, let me know if you want me to commit them (no terrific changes)... or maybe when.
"
76779077,1984,sledgehammer999,2015-03-02T18:52:50Z,"> without this PR the ""end now"" and ""cancel"" button have exactly the same behavior: suddenly kill the application.

I would have thought that ""Cancel"" would let the program continue execution without interruption.

> As far as you are in the review process of this PR and I do not want to switch your ground

No problem go ahead.

However, I wonder why you chose to abandon your initial design of installing an event filter?
I still have this local branch that I **might** choose over your PR: https://github.com/sledgehammer999/qBittorrent/commit/54844a76cbb33b30c50188683a392a93d865a34b
"
76909039,1984,paolo-sz,2015-03-03T09:01:04Z,"> However, I wonder why you chose to abandon your initial design of installing an event filter?

Well, basically because with the initial event filter approach I were not able to solve the issue on the cancel button and, as long I were trying to find a solution by reading qt docs, I realized it was pretty complicated, quite ""intrusive"" in the current code and not easily manageable.
But I don't think the current implementation is conceptually different from the original event filter one, it only differs in the fact that the dirty work (installing event filter, catching windows events, ...) is left to QT. This made the code less intrusive (only the instantiation of the object class inside the application.cpp file), more portable (I never tested on platforms other than windows but, in theory, it could work with linux or mac with only small changes in the constructor part) and, I feel, more readable.

> I would have thought that ""Cancel"" would let the program continue execution without interruption.

I think this is feasible but it implies some changes in the events to monitor, aboutToQuit is too late to stop qbt termination, it allows only to stop the machine shutdown...

@glassez 

> But at least you can use QScopedPointer<MainWindow> to combine dynamic creation with the existence of the object until the application is exiting.

This works perfectly, thanks for the hint.
"
76936910,1984,sledgehammer999,2015-03-03T12:31:02Z,"> I think this is feasible but it implies some changes in the events to monitor, aboutToQuit is too late to stop qbt termination, it allows only to stop the machine shutdown...

Yes. That's exactly what I want. ""Cancel"" means continue execution of program and cancel system shutdown. If the program is in the process of exiting, I want it to exit. I want it to continue executing as long as it needs in order to perform a clean exit. I don't want qbt to abort its exit.
"
76956028,1984,paolo-sz,2015-03-03T14:35:16Z,"Ok, there is a misunderstanding, I think.
- Without this PR, cancel button kills qbt and shutdown immediately (dirty exit)
- With this PR, cancel button aborts shutdown but leave qbt in clean exit modality, in other words, qbt continues its exiting process until its clean end and the shutdown is canceled
"
76957051,1984,sledgehammer999,2015-03-03T14:40:24Z,"OK. I understand you now. However, I'll test myself that particular aspect too, because it seems so mind bogglingly wrong. I can't believe Windows has this flaw. Essentially `End Now` and `Cancel` have the same effect for the app.
"
76958993,1984,paolo-sz,2015-03-03T14:50:40Z,"If I understand correctly, this is not a 100% Windows issue in the sense that, in the case of a shutdown blocking application, the shutdown management is shared between Windows and the app. If the app does not manage correctly the ""signals"" from Windows we got this buggy behavior.
So the problem here is in qbt not on Windows and the demonstration is that changing the code (this PR) the misbehavior is gone.
"
93594786,1984,sledgehammer999,2015-04-15T23:15:36Z,"@paolo-sz I have made a far simpler solution. It seems to work great on Windows 7 and on Windows XP. Both while the mainwindow is showing and while it is mimimized to the tray.
Can you test too? Btw, can you describe to me how you solve the problem we discussed here: https://github.com/qbittorrent/qBittorrent/pull/1984#discussion_r25589543 ?
I can confirm that ""Cancel"" kills qbt and continues with the shutdown instead of aborting.
Here is my commit: https://github.com/sledgehammer999/qBittorrent/commit/32dd076f0f81e52148c6e418414e161962863e16
"
93666079,1984,paolo-sz,2015-04-16T07:33:46Z,"> I have made a far simpler solution. It seems to work great on Windows 7 and on Windows XP. Both while the mainwindow is showing and while it is mimimized to the tray.

Indeed your commit is pretty simpler than mine...

> Can you test too?

Yes, I will try to test it as soon as possible.

> Btw, can you describe to me how you solve the problem we discussed here: #1984 (comment) ?
> I can confirm that ""Cancel"" kills qbt and continues with the shutdown instead of aborting.

Does this mean your commit still do not solve the kill instead cancel on XP?
Well, the exact way the shutdown process is managed within QT is far to be clear to me but, my understanding is that aboutToQuit signal happens too late in the shutdown process. The trick I used  (that seems to work even if its implementation is very ""delicate"" which make me think I miss something) is to connect to the signal commitDataRequest instead and then:
- requests the QSessionManager user interaction through the allowsInteraction() member function
- make the cleanup stuff
- release the QSessionManager

Maybe this made superfluous the connection to aboutToQuit signal but, sincerely, I don't remember if I did that test within the thousands of tries I did... :-(
I will try to also test your solution with the additional commitDataRequest trick...
"
93679146,1984,paolo-sz,2015-04-16T08:39:35Z,"No, no, now I remember...

both signals aboutToQuit and commitDataRequest need their connections as far as they manage two different cases in XP (but I think the two connection does not destroy other OSes).
commitDataRequest is only raised when you try to shutdown the pc with qbt still open, so it is necessary to cleanly manage qbt shutdown in the case it is still open at shutdown time.
aboutToQuit is also raised when the pc is shutting down (this is why I implemented the alreadyDone variable) but , more important, is raised also when you simply close qbt (while commitDataRequest is not) and where a cleanup is still needed.

So the conclusion is: your commit is probably fine if we add a new function and a new signal connection

connect(qApp, SIGNAL(commitDataRequest(QSessionManager &)), this, SLOT(shutdownCleanUp(QSessionManager &)), Qt::DirectConnection);

void Application::shutdownCleanUp(QSessionManager &manager) {
    manager.allowsInteraction();
    cleanup();
    manager.release();
}

and we implement the alreadyDone protection in the current cleanup() function.

I wil try also this upgrade to your commit.
"
93706148,1984,sledgehammer999,2015-04-16T10:48:05Z,"I am away now and can't test what you said or what I say below.
Theoritically speaking the only time that qbt will take time to shutdown is when the session has many torrents(eg 100). During shutdown this manifests loosely in this flow: QBtSession::drop->private pointer destructor->request fast resume for all torrents->busy loop/wait for libtorrent to post the fastresume alerts for all torrents->save to disk. The loop/wait can take time when there are many torrents in the session.
During this loop/wait I don't think the mainloop(qt's mainloop) has a chance of ever running. So commitDataRequest() signal will be emitted probably well after the user has clicked the ""Cancel"" button in the ""End Program"" Windows dialog. And if we don't handle that immediately we'll observe the same thing.
PS: I produce the ""End Program"" dialog in a different way that you. You said you produce that dialog during log-off. Try this, put a 3min Sleep() before shutdownBRdestroy. Then issue a system shutdown on XP. After a while a dialog will appear saying that qbt isn't closing and giving you the possibility to press ""End Now"" button to kill the process. Also it has a progress bar at the top. If you let the progress bar reach 100% the dialog will present also a ""Cancel"" button. And the dialog is the same as the one you showed above. From the dialog text, pressing ""Cancel"" should abort the system shutdown. However, it instead kills qbt and the system shutdown continues.
I'll be very surprised if `commitDataRequest()` is enough to prevent this.
"
93727790,1984,paolo-sz,2015-04-16T12:59:05Z,"Ok, I made some tests and here are the results (I tested only QT5, let me know if you want me to test also 4.x but be aware that I will need some more time to recompile everything...)
1. Your commit does not work fine on 7 when window is minimized to tray (no button visible on the taskbar, only icon in tray), the machine's shutdown does not wait the ""Sleep()"" time but goes ahead immediately.
2. As you are already aware, it also fails with the kill on cacel behavior on XP

The reason of (1) is that, in order to work with the blocking reason, Vista+ not only needs a valid handle to a window  but also needs some visibile object around the screen, If you delete all the main window childrens while window is minimized to tray, no visible widgets will remain visible and the blocking reason will be ignored.
About (2), my understanding is that commitDataRequest() is issued right after you click the shutdown button, Indeed it provide a pointer to the QSessionManager giving you the chance to interact, and eventually cancel, the shutdown process.

I will made a new commit starting from your.
A few additional notice:
- I moved the shutdownBRdestroy and window destruction into Application:: destructor (this should be practicaly the very end of qbt so we are pretty sure nothing is still pending)
- I made an explicit cast to HWND when using m_window->effectiveWinId() otherwhise gcc complains (at least on 64bit compilation)
"
93729041,1984,sledgehammer999,2015-04-16T13:04:43Z,"> I moved the shutdownBRdestroy and window destruction into Application:: destructor (this should be practicaly the very end of qbt so we are pretty sure nothing is still pending)

Leave it where it is. Because as soon as the last window is destroyed Windows kills the application anyway. (aka `delete m_window;`).

> I made an explicit cast to HWND when using m_window->effectiveWinId() otherwhise gcc complains (at least on 64bit compilation)

Weird. If you look at the headers `Wid` is typedef to HWND for Windows. At least msvc2013 doesn't complain for qt4.

On the tray issue. I didn't test thoroughly with qt5. I mainly tested with qt4. One question though. When you are minimized to tray, is the qbt tray icon showing or is hidden? (you know under the ""arrow"" thingy the tray has).
"
93739968,1984,paolo-sz,2015-04-16T13:54:46Z,"Shit!

it seems that travis complains with QSessionManager... Qt5 vs Qt4 differences I guess
I understand... I need to compile for Qt4 too...

> On the tray issue. I didn't test thoroughly with qt5. I mainly tested with qt4. One question though. When you are minimized to tray, is the qbt tray icon showing or is hidden? (you know under the ""arrow"" thingy the tray has).

it is showing until while qbt is running (even if minimized to tray) but it disappears as soon as you choose to shutdown the machine and the shutdown doesn't wait...
"
93749058,1984,paolo-sz,2015-04-16T14:31:40Z,"Stupid me... it was only a matter of enabled/disabled GUI...
"
93762460,1984,sledgehammer999,2015-04-16T15:23:20Z,"@paolo-sz Stiil cannot test your patch yet, but about the tray issue can try the following? In the constructor of MainWindow class put `setAtrribute(Qt::WA_DeleteOnClose, false);`. Does it solve it?
"
93940163,1984,paolo-sz,2015-04-17T08:11:47Z,"> about the tray issue can try the following? In the constructor of MainWindow class put setAtrribute(Qt::WA_DeleteOnClose, false);. Does it solve it?

Nope, the only way which is currently working on my side is to hide the window at the beginning of <code>cleanup()</code> function and delete the window together with all its children when doing <code>delete m_window</code>. 
"
94008316,1984,paolo-sz,2015-04-17T15:24:36Z,"Ok, I have made the full set of tests and here is the resulting table (jpg because I'm pretty sure github does not accept xls...)
By the way, I found some additional strange behaviors... see the notes on table...

![qbt_shutdown_block_tests](https://cloud.githubusercontent.com/assets/7062844/7204944/3a454d46-e526-11e4-80bd-d59bbe6fe5e0.jpg)
"
94191446,1984,sledgehammer999,2015-04-18T18:58:08Z,"Thank you for the spreadsheet. I hadn't tested ""minimized to tray"" only ""close to tray"". I thought they do the same thing.
After further investigation I have found that even if you just minimize the window, without the option to go to tray, the shutdown process doesn't halt. (qt5.4.1 + win 7). So ""minimize"" does something to the Window and the OS doesn't consider it.
EDIT: I am trying to find out if there is a way to prevent the above.
"
94194819,1984,sledgehammer999,2015-04-18T19:34:26Z,"More on this: Win XP + qt5-> If you only minimize, without going to tray, the shutdown waits.
Wtf is happening here!?!?!
EDIT: This is also true for Win XP + qt4
"
94201433,1984,paolo-sz,2015-04-18T21:16:54Z,"Somewhere in the MS documentation (I think this previous comment https://github.com/qbittorrent/qBittorrent/pull/1984#issuecomment-58862109) I remember it is stated that the shoutdown will be blocked by a running application if some conditions are met. One of these conditions is that the application MUST have something visible. So I think the problem is that you delete all from the main window just at the beginning of the <code>cleanup()</code> function, removing all the visible stuff of bqt.
This is why I replaced the delete stuff with <code>m_window->hide()</code> in my patch...
All the other stuff in my patch is to solve the kill on close issue...
"
94203431,1984,sledgehammer999,2015-04-18T21:40:10Z,"If that was true, it would also kill the application when it was ""closed to tray"" too.
And hide() isn't enough. Read my code comment. We need to sync the preferences. MainWindows has various custom widgets that also save preferences in their destructor. That's why I explicitly delete all children and not the mainwindow.
"
94378233,1984,sledgehammer999,2015-04-20T07:17:03Z,"Just a heads up: The various ""fails"" of your spreadsheet may be due to the application crashing. I cannot investigate this fully, because it is very difficult to debug something when the OS is shutting down.
While I was trying to manually delete the custom widgets from inside MainWindow I discovered this buffling behavior:
1. Create a funciton MainWindow::cleanup() and inside stop() all the timers that are private to MainWindow
2. Modify the function that is called when the ""options"" button from the toolbar is pressed to call instead cleanup().
3. Run the app and press the button. It crashes with a backtrace window. Running it through the debugger it shows that the timer is happening inside QTimer::stop()!!! wtf?!?!?
4. Tested with qt5 on Win 7.

PS: For 2 days I might not be reachable. And I cannot test it further at the moment.
"
94774145,1984,glassez,2015-04-21T12:19:49Z,"Please see #2898. Perhaps your ""strange"" behavior related with it.
"
94863370,1984,paolo-sz,2015-04-21T16:32:02Z,"> And hide() isn't enough. Read my code comment. We need to sync the preferences. MainWindows has various custom widgets that also save preferences in their destructor. That's why I explicitly delete all children and not the mainwindow.

In this case, sorry it was not clear to me before your post, I agree with you, hide() is not enough...

I then tried to find another way and what I found seems to be promising... still working on it.

About the crashes you report, I started to see the backtrace window too. I feel you are right about the source of the fails I reported.
My 2 cent comment: I see in mainwindow.cpp a lot of pointers to classes... but none of the call to public functions of those classes is protected by NULL check neither none of those pointers is deleted on mainwindow destruction... I'm not a C++ master but I feel this is a very good source of crashes especially when you start deleting the main window's childrens....
"
94877152,1984,sledgehammer999,2015-04-21T17:15:44Z,"@glassez good catch.

@paolo-sz 
Yes, the lack of NULL checks may be the cause of problems. But supposedly stopping the timers stops any code activity in MainWindow.
The lack of deleting pointers in the destructor is usually a mistake. However, in this case `QObject`s that have a parent are deleted by their parent when the parent gets destroyed. All those pointers you see have their parent set to the MainWindow instance(see that each `new` uses `this` in the constructor). So this shouldn't be a problem.

Here's an interesting tool that let's you simulate shutdown and makes debugging easier: http://stackoverflow.com/a/2673800
I'll try to investigate this during the weekend.
"
95245331,1984,paolo-sz,2015-04-22T15:57:14Z,"> Here's an interesting tool that let's you simulate shutdown and makes debugging easier:

Have you already tried to run it?
Because it is not working on my XP 32bit installation...

Anyway, I tried to push another version... I have commented the code in order to explain what I did and why.
I have not fully tested the new implementation but maybe it is better to have some comments from you...
The tests I did are promising...
"
95487432,1984,paolo-sz,2015-04-23T08:21:39Z,"Could another reason be all the pointers in mainwindow.h not protected by QPointer?
"
95488171,1984,paolo-sz,2015-04-23T08:27:18Z,"@glassez, the mutex is because when you are blocking the commitaDataRequest signal (connected to shutdownCleanup) a window is displayed offerirng you to force shutdown or cancel (a third implicit is wait until shutdown happens naturally). If you choose the ""cancel"" option, then the shutdown process will be interrupted and the quit signal is not emitted.
But shutdownCleanup function in any case calls the cleanup function. The result is that the qbittorrent process does not exit even if the cleanup was executed. It stay ""alive"" but doing nothing...
"
95508450,1984,glassez,2015-04-23T09:25:15Z,"But what if you just try to call qApp->quit() at the end of cleanup()?
"
95513372,1984,paolo-sz,2015-04-23T09:40:40Z,"because cleanup() is called by shutdownCleanup() too... and, in some previous post, you rightly made me notice that the QT docs says I cannot call quit() from within commitDataRequest slot...

But maybe it is only a suggestion... I completely agree that the watchdog is complicated solution...
"
95514100,1984,glassez,2015-04-23T09:44:38Z,"But you can do it via QTimer::singleShot() with 0 timeout.
"
95517639,1984,paolo-sz,2015-04-23T09:54:00Z,"excerpt from QT docs ""...timeout of 0 will time out as soon as all the events in the window system's event queue have been processed...""
Not exactly want I want to do, I don't care about event queue status, I want to issue a quit as soon as all the cleanup stuff has been done...
"
95534560,1984,glassez,2015-04-23T10:45:36Z,"In your code the timer fires only once shutdownCleanup() will return.
"
95543169,1984,paolo-sz,2015-04-23T11:13:39Z,"Right, this is exactly what I said and what I want to implement...
"
95557595,1984,glassez,2015-04-23T11:40:59Z,"No, you misunderstood me. Your timer fires only once (regardless of the specified interval). The same effect as in the proposed method (with a zero timeout). So all these mutexes are overweight.
"
95561015,1984,sledgehammer999,2015-04-23T12:06:27Z,"Some updates: I have figured mostly why it crashes. I'll have something solid in the weekend.
"
95868543,1984,paolo-sz,2015-04-24T09:28:18Z,"@glassez, I think I'm catching your point and the tests definitely confirm you are totally right.
And this new approach is really much more elegant, thanks
"
96450284,1984,sledgehammer999,2015-04-27T00:07:31Z,"@paolo-sz I pushed new code in my branch. It seems to solve all the FAILs you documented on your excel **except** one. The one when ""cancel"" is clicked by the user on Windows XP.
I wanted to test with the SessionManager as you do, but I didn't get any more time today.
I see from your patch that you now connect to `commitDataRequest()` regardless of being on Windows XP or not. Do we get any benefit from this on Vista+? The application seems to behave correctly on Vista+ when cancel is clicked.
PS: I think you have written a comment about `commitDataRequest()` and Vista+ but it either got lost during your force pushes or I am too tired to spot it on this bug report.
PS2: I'll move the creation of the block reason inside cleanup(). First I want to test and see what to do with `commitDataRequest()`.
"
96544715,1984,paolo-sz,2015-04-27T07:56:32Z,"> I think you have written a comment about commitDataRequest() and Vista+ but it either got lost during your force pushes or I am too tired to spot it on this bug report.

@sledgehammer999, indeed I wrote it. The connection does not get any benefit in Vista+ which I confirm is correctly working without it. I choose to do in the current mode for 2 reasons:
1. QT docs says the return of <code>m_window->effectiveWinId()</code> could be different from time to time so I thought it was better to create the block reason inside <code>cleanup()</code>. But doing this I lost the XP/Vista+ detection where the connection to <code>commitDataRequest()</code> has to be done. Instead of writing additional code (I cannot use <code>IsWindiwsVistaOrAbove()</code> because current mingw does not support it), I decided to do the connection in any cases.
2. The code is simple, it does not need to manage special cases (except the <code>ShutdownBlockReasonCreate()</code>), XP or Vista+ does not care, the code is the same.

> I'll move the creation of the block reason inside cleanup().

I finally did the same (check my last forced push)
"
96842464,1984,sledgehammer999,2015-04-27T22:45:45Z,"@paolo-sz I pushed a new commit on top of the mine. Can you see it and maybe test? It seems to work fine for me. If you agree, I am going to merge the 2 commits and push the code into master, finally closing this issue.
EDIT: quick link to my branch: https://github.com/sledgehammer999/qBittorrent/commits/shutdown_block
"
97084660,1984,paolo-sz,2015-04-28T14:29:32Z,"@sledgehammer999, I only had a fast look through your branch's code and I'm pretty confident it will be (almost) the right one. I will make the tests and I'll provide you the results.
In the meanwhile just a couple of comments.
- If there are no special reasons in not doing <code>m_window->hide()</code> before the <code>m_window->cleanup()</code>, you could consider to add that call. This is only a visual improvement in order to not leave on the screen a not responsive/refreshed window.
- You could also consider to move the <code>m_window->cleanup()</code> after the block reason creation. My concern is about the delay due to saving gui settings... maybe I'm paranoid but I'm not so confident that delay will be surely smaller than 5 seconds (old or slow machines/hw, heavy disk activity, ...)
"
97086230,1984,sledgehammer999,2015-04-28T14:35:06Z,"Sure, I will do the 2 things you mentioned. In the meantime you can test the current code. Those changes will not affect the results.
"
97200102,1984,paolo-sz,2015-04-28T20:36:01Z,"@sledgehammer999, just one word: perfect!
All the tests were successfully ended also on my side, thanks to you and @glassez for all the great work!

Just out of curiosity, what was the problem that created the backtrace window when you was trying to delete the main window's children in a loop?
"
97206759,1984,sledgehammer999,2015-04-28T21:05:23Z,"> to delete the main window's children in a loop?

I never debugged that. However, I had my current MainWindow::cleanup() hooked up to the preferences button (for easy execution). Then inside the cleanup() I tried to delete every pointer(of widgets). Some of them resulted in crashes and the debugger wasn't very helpful. (I didn't use debug builds anyway). Some were fixed by changing the order of deletion. Others by not deleting them because deleting their container widget(eg `tabs`) also deleted the children. If I first deleted the children and then the container I got some other crash based on signals being emitted. I didn't investigate further since deleting of the container deleted the children too.
"
97207155,1984,sledgehammer999,2015-04-28T21:06:54Z,"> thanks to you

And as I say in the commit message thanks to you too.
"
706774593,13498,thalieht,2020-10-11T22:05:00Z,Wow! 10k torrents take 5-6 sec to load for me while in master it takes 30-40. Well done!
706779595,13498,xavier2k6,2020-10-11T22:48:30Z,"Briefly tested with the windows build from https://github.com/qbittorrent/qBittorrent/actions/runs/300957246  with 10,000 test torrents.

discarded 1st run as caching etc.
2nd run ~8 secs to show FULL GUI from 1st click

Only 2 downsides:
When clicking on options (advanced window etc) - hangs for a few seconds/displays (not responding)
~**I haven't compiled it myself, so it may be a different story when I use different libraries.**~
**_Not an issue with Qt5.15.1/Boost 1.74 & OpenSSL 1.1.1h_**

the splash screen - don't use it & have this unchecked - but this PR will constantly show it.

**EDIT:**
~It also has alot more SSD activity after it loads about 50 - 55% & takes a bit longer to close.~ PEBKAC
Had the 10,000 test torrents in resumed state, not paused."
706839330,13498,glassez,2020-10-12T03:40:28Z,"IMO, loading & populating GUI after session is fully restored is best approach.
This PR is still in draft form, some code is temporary, just to demonstrate it quickly. If we decide to continue in this direction, I'll clean it up. 
The main thing that needs to be completed is some feedback during application loading, while the main GUI is unavailable. For now, I just made the splash screen display unconditionally, but this is a temporary solution. I don't think it is acceptable, at least when application is configured to start minimized (but personally I would display it in all other cases unconditionally). I want to extract the tray icon into a separate component so that I can display it from the very beginning and use it for feedback during app loading.
What do you guys say?
@Chocobo1, I need your general opinion about the direction of these changes (don't look at the code in detail yet)."
707177803,13498,Chocobo1,2020-10-12T15:08:42Z,">@Chocobo1, I need your general opinion about the direction of these changes (don't look at the code in detail yet).

Well I don't have strong opinion on it except that splash screen isn't really a common thing nowadays.

>I want to extract the tray icon into a separate component so that I can display it from the very beginning and use it for feedback during app loading.

IIRC some linux desktop environment doesn't support tray icon so it may not be universally available..."
707181829,13498,glassez,2020-10-12T15:15:40Z,">splash screen isn't really a common thing nowadays.

I agree, but it still ""rocks"" in long-loading apps. Not having any response for 10-20 seconds is much worse."
707196436,13498,ArcticGems,2020-10-12T15:41:33Z,"> 
> 
> > splash screen isn't really a common thing nowadays.
> 
> I agree, but it still ""rocks"" in long-loading apps. Not having any response for 10-20 seconds is much worse.

I agree with glassez, without the splash screen, you might think qBittorrent crashed.
Maybe you could make so that the splash screen only shows when you have x number of torrents."
707249312,13498,Chocobo1,2020-10-12T17:26:10Z,"> > splash screen isn't really a common thing nowadays.
> 
> I agree, but it still ""rocks"" in long-loading apps. Not having any response for 10-20 seconds is much worse.

Or maybe instead a progress bar placed at the rightmost of the status bar:
![image](https://www.howtogeek.com/wp-content/uploads/2009/11/1ff.png)"
707271569,13498,glassez,2020-10-12T18:11:53Z,">Or maybe instead a progress bar placed at the rightmost of the status bar:

This makes sense when part of the interface is available from the beginning, but some additional tasks are still performed in the background. So this doesn't seem like a relevant example to me. I would use something like Photoshop as a suitable example.
Otherwise, what do you suggest to display in the main window besides the progress indicator? Empty controls? In addition, we must make them unavailable for interaction, so as not to allow the user to perform conflicting actions. Generally, I can't imagine how it could work in this case. Besides, I'm not good at GUI designing and I don't want to get stuck in it for long. I just want to implement the main idea (populate GUI after session loaded) as simply and clearly as possible for me. But if you (or someone else) have any more detailed ideas, you're welcome."
707276481,13498,xavier2k6,2020-10-12T18:22:38Z,"@glassez in the original improve startup thread, I made a build that uses the latest commit `dd1e7d0` from there but modified the ""time-out"" from default `10` & set to `200` instead.

For me that build opens instantly & all 10,000 test torrents get fully loaded in 38 - 40secs on my machine.......

Will I upload it here or in original thread for testing, also - anymore though to what I suggested in https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-706094028"
707424675,13498,NotTsunami,2020-10-13T01:12:53Z,"> @glassez in the original improve startup thread, I made a build that uses the latest commit `dd1e7d0` from there but modified the ""time-out"" from default `10` & set to `200` instead.
> 
> For me that build opens instantly & all 10,000 test torrents get fully loaded in 38 - 40secs on my machine.......
> 
> Will I upload it here or in original thread for testing, also - anymore though to what I suggested in [#13348 (comment)](https://github.com/qbittorrent/qBittorrent/pull/13348#issuecomment-706094028)

For the sake of development of this PR test builds should probably be just master + this PR, however benchmarks of the settings you mentioned vs just this PR vs master might be appreciated."
707436168,13498,ghost,2020-10-13T01:56:33Z,"My suggestion is, if qBt is being started from a startup entry on windows, start it as minimised to tray like every other app. 
And when it’s started as minimised, do not show any loading/splash screens.
However when someone clicks on the tray icon display the loading screen.

Show the loading screen only when someone starts qBt as not minimised.

Remove the settings for splash screens altogether. No app uses those anymore. This may also confuse users as to think it’s a bug. "
707490719,13498,glassez,2020-10-13T05:07:21Z,">when it’s started as minimised, do not show any loading/splash screens.

👍 
This should be obvious.
>Remove the settings for splash screens altogether.

👍 
>if qBt is being started from a startup entry on windows, start it as minimised to tray like every other app.

Now ""Start minimized"" is a user-configurable option. Although I believe that it should work unconditionally, when qBittorrent starts automatically, then minimized, in other cases - show a window. But it is kind of separate Issue."
707550045,13498,jagannatharjun,2020-10-13T07:30:00Z,">  what do you suggest to display in the main window besides the progress indicator? Empty controls? In addition, we must make them unavailable for interaction, so as not to allow the user to perform conflicting actions.

disable transfer list (maybe whole window), and only show a progress bar in the status bar, I'm only saying this because the current splash image doesn't look good,

~personally, I liked your previous solution better, 30-40 seconds delay in loading 10k torrents is kinda understandable (but don't tell them it can be done in 5 seconds)~ (nope)"
707559291,13498,xavier2k6,2020-10-13T07:49:02Z,">personally, I liked your previous solution better, 30-40 seconds delay in loading 10k torrents is kinda understandable

I would agree with this!

>(but don't tell them it can be done in 5 seconds)

Although this would be great! - I don't believe we are getting the correct observations/profiling in our collective tests.

The profiling in my opinion needs to be a bit more fleshed out & have more users feedback like I suggested in the other thread with users who have `12,000 & 36,000 real-life` cases.

The hardware used will have an impact on loading/start-up.........SSD/NVME SSD or HDD so that in itself needs to be kept in mind when possible `5 seconds` can be seen as wonderous for some but others it could be a ""I wish/if only"" feeling."
707575879,13498,glassez,2020-10-13T08:18:28Z,"> > personally, I liked your previous solution better, 30-40 seconds delay in loading 10k torrents is kinda understandable
> 
> I would agree with this!

Hey guys, please don't mix different levels of this problem.
I am primarily interested in whether we want to continue using the current (""idiotic"", IMO) startup method, where we GUI tries to handle all the intermediate states of the session loading, or whether we should populate GUI after the session is already loaded. If we choose the second method, then we will need to decide on the preferred way to provide feedback during app loading (whether it will be a splash screen, or some special view of main window, etc.)."
707592018,13498,ghost,2020-10-13T08:46:40Z,"@glassez 
Trackers are stuck at ""Updating"" with the build from this PR."
707845350,13498,glassez,2020-10-13T16:04:51Z,"> 
> 
> @glassez
> Trackers are stuck at ""Updating"" with the build from this PR.

Well, it looks like we found a bug in libtorrent.
@arvidn 
It is due to `lt::session::pause()` and `lt::session::resume()` calls (it seems that no one used the second one, so it remained unnoticed until now).
Session aborts tracker requests when we pause it:
https://github.com/arvidn/libtorrent/blob/197d9006ed49127abd6eb2e8dc9dabaf312f2812/src/session_impl.cpp#L867-L868
This puts the tracker manager in an aborted state:
https://github.com/arvidn/libtorrent/blob/197d9006ed49127abd6eb2e8dc9dabaf312f2812/src/tracker_manager.cpp#L435
And then when we try to resume the session, it tries to send announces, but tracker manager cannot do it because of aborted sate (or we get ""assertion failed"" error in the debug build):
https://github.com/arvidn/libtorrent/blob/197d9006ed49127abd6eb2e8dc9dabaf312f2812/src/tracker_manager.cpp#L283-L284
The problem is that once tracker manager gets into aborted state, it doesn't come back from it. And it really looks like a bug, otherwise `lt::session::resume()` is meaningless since it cannot work."
707915038,13498,arvidn,2020-10-13T18:04:09Z,"oh, it sounds like it. I'll take a look"
708049190,13498,sledgehammer999,2020-10-13T22:44:12Z,"@glassez I'll throw one **minor** suggestion on the represantion of things. If I understand correctly the goal of this PR is to load every torrent behind the scenes and once every torrent is loaded into the lt session then update the UI (aka transferlist) in one go. So your problem is what to do with the UI for the few seconds that it takes to load the torrents and the UI looks as doing nothing/unresponsive (or that you haven't popped up any UI element yet). 
My suggestion: Present the mainwindow as usual but have everything disabled in it. In the place of the transferlist put an empty background (usually grey) and a QLabel stating ""Torrents are being loaded. Please wait..."". I think this can be achieved with QStackedWidget."
708056612,13498,FranciscoPombal,2020-10-13T23:05:58Z,"I am against making the tray icon mandatory/an essential part of the presentation, because a) some people like me don't like tray icons, or only want them for very specific things and b) tray icons may be available in some not-so-uncommon setups.

I second the proposal of showing the GUI ASAP and presenting a visual cue about torrent load progress (progress bar in status bar and/or greyed out transfer list with text), rather than showing a splash screen or something like that."
708169945,13498,glassez,2020-10-14T05:41:28Z,"> My suggestion: Present the mainwindow as usual but have everything disabled in it. In the place of the transferlist put an empty background (usually grey) and a QLabel stating ""Torrents are being loaded. Please wait..."".

Okay, I'll try something like that... To be honest, I did not really want to get into this terrible jungle of main window initialization. But I'll give it a try.
>showing the GUI ASAP and presenting a visual cue about torrent load progress (progress bar in status bar and/or greyed out transfer list with text)

I'm still not sure whether to show progress. It can add an unnecessary load that we really want to avoid. Maybe just a message  ""Torrents are being loaded. Please wait..."" will be enough."
708180647,13498,ArcticGems,2020-10-14T06:09:44Z,"
> I'm still not sure whether to show progress. It can add an unnecessary load that we really want to avoid. Maybe just a message ""Torrents are being loaded. Please wait..."" will be enough.

Maybe a moving loading icon so that user know it's not frozen or is it to much?"
708248540,13498,arvidn,2020-10-14T08:31:39Z,@glassez would you (or someone else) be able to test this patch? https://github.com/arvidn/libtorrent/pull/5215
708393688,13498,ghost,2020-10-14T13:14:17Z,"> @glassez would you (or someone else) be able to test this patch? [arvidn/libtorrent#5215](https://github.com/arvidn/libtorrent/pull/5215)

@arvidn I've tested it and it's working fine now. You may merge it."
708436153,13498,xavier2k6,2020-10-14T14:21:00Z,"I made a build from the previous 'Load UI after BitTorrent session is restored commit: ebd5b4e' & GUI fully shows up after 5 seconds on my machine. (Default settings with portable profile & 10,000 test torrents/paused state.)

I don't know what the general consensus would be to not have anything displayed (for those 5 seconds) at startup?!

@glassez this **IS** actually a vast improvement over **V1** & I was wrong. **WELL DONE!!!**"
708536394,13498,glassez,2020-10-14T17:06:19Z,">I don't know what the general consensus would be to not have anything displayed (for those 5 seconds) at startup?!

This is acceptable to me. Besides, I wouldn't have to poke around in the Main window.
But do not forget that the result will not be so great on slower/older systems. Waiting even 20 seconds without any feedback is unacceptable, IMO. "
708873985,13498,glassez,2020-10-15T03:32:22Z,"@arvidn, would it be difficult to implement a flag that allows you to create a session in pause mode?"
708925312,13498,arvidn,2020-10-15T06:19:09Z,I think it's a good idea. It's not trivial to add in a backwards compatible way though. I'll take a look. Maybe there will have to be a new session constructor
708951791,13498,arvidn,2020-10-15T07:15:49Z,@glassez https://github.com/arvidn/libtorrent/pull/5220
709229885,13498,glassez,2020-10-15T11:42:39Z,"Seems it requires libtorrent 1.2.11 and higher. Not a problem for me. But if there are objections to raise minimum supported version of libtorrent, we will have to wait with this improvement."
709242348,13498,sledgehammer999,2020-10-15T11:59:48Z,">Seems it requires libtorrent 1.2.11 and higher. Not a problem for me. But if there are objections to raise minimum supported version of libtorrent, we will have to wait with this improvement.

IIRC the only problematic OS here is Linux. But since we provide via our PPA the newest libtorrent for the most popular distro(Ubuntu) it shouldn't be a problem to raise the minium version of 1.2.x. Besides, if a distro already packages 1.2.x and wants to update qbittorrent, it will almost always update libtorrent-rasterbar alongside with it."
709987089,13498,glassez,2020-10-16T11:22:41Z,"I started digging in the Main window today. This is just awful! No wonder I tried to avoid it all this time. It's just a bunch of poorly structured, confusing ""illogical"" logic. 
Can someone, for example, explain what the hell is going on with systray? What are the deferred attempts to create it if it is not available? After all, the documentation says in black and white that you can simply create qsystemtray object, even if ""system tray"" is not available in the system at the moment, and it will initialize system feature itself when it becomes available. @sledgehammer999, @Chocobo1, do you know anything about this? Maybe it's just a relic of a long time ago (for example, the Qt4 era)?"
710750429,13498,kasper93,2020-10-17T05:03:19Z,"@glassez I did quick look and I don't understand why do you intend to keep serialized loading?

In your patch (roughly)
1. load resume data (with splash screen)
2. add torrents to lt
3. start session
4. process tens of thousands alerts in one go, which adds torrents to list view. 

This is the exact problem I wanted to mitigate. There is no need to halt any processing(or gui) until all torrents are resumed, they can be resumed/added asynchronously as session/gui operates normally (visually the list will fill up as they are loaded). This way 1, 2, 4 is interleaved between each other and torrents are added in batches as LT notify about them being loaded. Without any GUI waiting/stalling.

Splash window is nice and all, but it is still taking time.

They are two main problems when resuming torrents.
1. loading the resume data
2. processing lt alerts

So far you only handled 1 and 2 is as crucial to handle correctly as 1, because throwing tens of thousands of alerts on main thread to process in one batch will also make it not responsive for quite some time. In some alerts we call back to lt and depending on lt state taking mutex might take some time and by interlarding those steps we make number of alerts to process way lower in one batch releasing gui event loop sooner.
"
710782758,13498,ghost,2020-10-17T09:23:08Z,"@kasper93 I think you've missed the V1 version of this PR where it was attempted to load the torrents asynchronously and populating the list as they are loaded. However, the results are not quite desirable."
710784308,13498,glassez,2020-10-17T09:33:33Z,"@xavier2k6, @an0n666 
Can you try the last commit? It is not yet fully completed, but it should still give a general idea of the approach used.
I would like to know how it behaves in both cases, having a lot of torrents (a test set of 10,000), as well as under your normal conditions (as many torrents as you use normally)."
710786619,13498,glassez,2020-10-17T09:49:04Z,"@kasper93 
>I don't understand

Exactly!


> In your patch (roughly)
> 
> 1. load resume data (with splash screen)
> 2. add torrents to lt
> 3. start session
> 4. process tens of thousands alerts in one go, which adds torrents to list view.

In my patch (roughly)
1. load resume data and add torrents to lt simultaneously in different threads
2. start session
3. populate GUI with all existing torrents at once that is key improvement here (since it is more effective than add them one by one)

The only remaining problem here is how to provide feedback during session restoring.
This is not a problem at all if you don't have a large number of torrents. But if there are several thousand of them, then user need to see that the app is loading, and not crashed/frozen."
710786956,13498,ghost,2020-10-17T09:51:31Z,"@glassez 
I've identified an issue. The 5-6 seconds loading time that some were reporting in this PR were probably affected by the libtorrent bug which caused trackers to be stuck at updating.
The <s>CI</s> github actions build is probably still using an older libtorrent because I'm still facing that stuck at updating issue for trackers on latest commit.
It took 4 seconds to load 10k torrents. But I think if trackers were working it would've taken more time."
710787399,13498,ghost,2020-10-17T09:54:19Z,"Can someone provide a build with latest RC1_2 branch of libtorrent and latest commit of this PR?
Or is it possible to update the libtorrent on the github actions build?
@FranciscoPombal @xavier2k6 "
710789500,13498,xavier2k6,2020-10-17T10:09:11Z,"@glassez general to content tabs missing in latest actions build??

![content tab missing](https://user-images.githubusercontent.com/42386382/96334496-27300100-1069-11eb-8b2d-63736759d66f.png)
"
710798441,13498,glassez,2020-10-17T10:23:27Z,">@glassez general to content tabs missing in latest actions build??

Well, will handle it.
But how it behaves generally? How long does it take for the main window to appear? How long does it take for the transfer list to appear? How does the window behave between these events?"
710831354,13498,xavier2k6,2020-10-17T11:13:09Z,"@an0n666 here ya go, just be aware of https://github.com/qbittorrent/qBittorrent/pull/13498#issuecomment-710789500

EDIT: 10,000 test torrents not included in this build.

Windows test build of 4.3.0(Alpha1) with listed libraries:
```
qBittorrent (Improve startup v2/session restore)   | 4.3.0 618ec6f PR #13498 (Oct 17, 2020)
libtorrent-rasterbar | 1.2.10.0 +git 9bfbee3 (Oct 16, 2020)
Qt                   | 5.15.1
OpenSSL              | 1.1.1h
zlib                 | 1.2.11
Boost                | 1.74
```
[Download Link](https://www.dropbox.com/s/tfuu2vp1btj2jy7/qbittorrent%20session%20restore-618ec6f%20%2B%20libtorrent%209bfbee3.zip?dl=1)"
710835668,13498,xavier2k6,2020-10-17T11:19:47Z,"> Well, will handle it.

Cool

> But how it behaves generally?

Seems to be ok, didn't test extensively!

>How long does it take for the main window to appear?

Instantly

>How long does it take for the transfer list to appear?

About 5 secs from paused state/about 7 secs from resumed state (10,000 test torrents - default settings)

>How does the window behave between these events?

Seems to be ok, didn't test extensively!

Have **374** torrents in my main setup & main window opened instantly & it took only about 1/2secs to fully load transfer list etc.

If you want more feedback on user experience etc - list below is of the 4x users I identified with a large amount of torrents.
```
ned-martin ~1800 torrents
bksinn78 ~7950 torrents
a-raccoon ~12,000 torrents
reyaz006 ~36,000 torrents
```"
710846205,13498,ghost,2020-10-17T11:32:52Z,"> @an0n666 here ya go, just be aware of [#13498 (comment)](https://github.com/qbittorrent/qBittorrent/pull/13498#issuecomment-710789500)
> 
> EDIT: 10,000 test torrents not included in this build.
> 
> Windows test build of 4.3.0(Alpha1) with listed libraries:
> 
> ```
> qBittorrent (Improve startup v2/session restore)   | 4.3.0 618ec6f PR #13498 (Oct 17, 2020)
> libtorrent-rasterbar | 1.2.10.0 +git 9bfbee3 (Oct 16, 2020)
> Qt                   | 5.15.1
> OpenSSL              | 1.1.1h
> zlib                 | 1.2.11
> Boost                | 1.74
> ```
> 
> [Download Link](https://www.dropbox.com/s/tfuu2vp1btj2jy7/qbittorrent%20session%20restore-618ec6f%20%2B%20libtorrent%209bfbee3.zip?dl=1)

Thanks for the build!

@glassez 
Here's a capture of how it behaves with 10k torrents 
https://gyazo.com/2aaa358311ae2a7a5601016348660d24
"
710848797,13498,glassez,2020-10-17T11:35:47Z,">If you want more feedback on user experience etc - list below is of the 4x users I identified with a large amount of torrents.

I wanted to know if I should continue in this direction. If it's generally approved, I'll clean it more. When it becomes more stable, we can call the users you mentioned."
710854357,13498,glassez,2020-10-17T11:41:59Z,"Thank you for your testing and feedback. This really helps, because I don't have much time to do it myself.
It would be nice if you provided information about the hardware configuration of your machines that you are testing it on."
710858555,13498,ghost,2020-10-17T11:48:11Z,"With only 22 torrents it loads the same as previous versions.
https://gyazo.com/c312b3f5b86003eac7203bb89aa75c85

Tested on a Windows 10 machine.
Hardware:
SSD with 500 MB+ r/w
A 6c/6t CPU, 16 G RAM.
"
710861655,13498,glassez,2020-10-17T11:53:23Z,">general to content tabs missing in latest actions build

Seems @an0n666 has no such issue.
Did you have all tabs closed before?"
710862799,13498,xavier2k6,2020-10-17T11:55:39Z,"> > general to content tabs missing in latest actions build
> 
> Seems @an0n666 has no such issue.

I just saw that myself in his clips?!

> Did you have all tabs closed before?

No - is there an option for that....."
710867095,13498,xavier2k6,2020-10-17T12:02:40Z,"> Thank you for your testing and feedback. This really helps, because I don't have much time to do it myself.

No bother.

> It would be nice if you provided information about the hardware configuration of your machines that you are testing it on.

Windows 10 Pro Version 2004 x64 (OS Build 19041.572)
I7 4790 (4 cores 8 threads)
32 GiB RAM
Samsung SSD 850 PRO 256 GB (Main OS) (Latest Firmware)
Samsung SSD 860 EVO 2TB (Torrents downloaded are saved here)  (Latest Firmware)"
710880427,13498,xavier2k6,2020-10-17T12:20:13Z,I'll test it on another machine later & report back.
710907993,13498,glassez,2020-10-17T12:43:53Z,">With only 22 torrents it loads the same as previous versions.

Well. I would not like to see unexpected side effects for less ""powerful"" users (such as myself).

> > Did you have all tabs closed before?
> 
> No - is there an option for that.....

I mean ""general"", ""trackers"", ""peers"", etc. You can see one or none of them."
710929734,13498,ghost,2020-10-17T13:02:56Z,"I can confirm the issue with the lower tabs. If you don't have any of the tabs shown while exiting the client, on the next start none of them shows up."
710930136,13498,xavier2k6,2020-10-17T13:03:19Z,">I mean ""general"", ""trackers"", ""peers"", etc. You can see one or none of them.

None, even if I load up my compiled build or the actions build with portable/profile & no torrents added.....100% default/vanilla/virgin......"
710935274,13498,xavier2k6,2020-10-17T13:07:41Z,">If you don't have any of the tabs shown while exiting the client, on the next start none of them shows up.

Can confirm

Not showing on at default settings either as previously stated."
710952947,13498,xavier2k6,2020-10-17T13:22:43Z,"Actually...........having a checkbox to enable/disable ""show lower tabs"" would be a nice feature.

May make a ""feature request"" in a new issue for this?!"
710959556,13498,glassez,2020-10-17T13:29:01Z,"> Actually...........having a checkbox to enable/disable ""show lower tabs"" would be a nice feature.

Do they interfere with you even in the collapsed state?"
710967950,13498,xavier2k6,2020-10-17T13:35:26Z,"> > Actually...........having a checkbox to enable/disable ""show lower tabs"" would be a nice feature.
> 
> Do they interfere with you even in the collapsed state?

It's more of an `aesthetic` preference for me........(now that I've seen them gone lol)

practically......I obviously can't say if there's a benefit or not (redrawing etc).........but I don't use them much....usually closed/minimized anyway."
711029897,13498,FranciscoPombal,2020-10-17T15:28:41Z,"> Can someone provide a build with latest RC1_2 branch of libtorrent and latest commit of this PR?
> Or is it possible to update the libtorrent on the github actions build?
> @FranciscoPombal @xavier2k6

Yeah, it is possible to update the version on the Actions build, I'll submit a PR to vcpkg. I would also like to have more build variants in CI (e.g. with `RC_1_2` HEAD), but currently I'm not aware of a way to accomplish that without blasting through the cache usage limit (thereby making cache useless, since at least one job would always be uncached, and thus severely increasing CI time to almost 2h, which is unacceptable) or doing more non-cached package installations, which would also increase the CI time somewhat. Another solution would be to have  a separate ""secondary CI"" workflow that is assumed to simply take longer than the main one, where we could have all build variants we'd like."
711032759,13498,xavier2k6,2020-10-17T15:46:14Z,"the ""actions builds"" are also defaulting async io threads to 10.....this was only meant to be for libtorrent 2.0 correct or was this changed for 1.2.x as well in master??"
711039065,13498,FranciscoPombal,2020-10-17T16:23:15Z,"> ??

That change was intended for both 1.2.x and 2.x"
711039410,13498,xavier2k6,2020-10-17T16:25:23Z,"> > ??
> 
> That change was intended for both 1.2.x and 2.x

ah cool, thanks for the clarification - I thought when I saw it...that something from 2.0 had crept in to 1.2.x

that rise in default is a good change for SSD/HDDS users alike..."
711040514,13498,glassez,2020-10-17T16:31:07Z,"> general to content tabs missing in latest actions build

Should be fixed now."
711041230,13498,xavier2k6,2020-10-17T16:34:06Z,"When you run qBittorrent & main (blank) window loads up
you can click on the gear icon =>SIGSEGV CRASH
or, tools=>options =>SIGSEGV CRASH"
711052399,13498,glassez,2020-10-17T17:25:00Z,">When you run qBittorrent & main (blank) window loads up
you can click on the gear icon =>SIGSEGV CRASH
or, tools=>options =>SIGSEGV CRASH

Oh, I see. As I said, latest changes are not yet complete. Tool bar and most of menu items should be unavailable until the session and other core components are loaded. "
711086877,13498,kasper93,2020-10-17T22:14:39Z,"@glassez 

> > I don't understand
> 
> Exactly!

Also I don't understand why you always have to be rude.

> In my patch (roughly)
> 
>     1. load resume data and add torrents to lt simultaneously in different threads
> 
>     2. start session
> 
>     3. populate GUI with all existing torrents at once that is key improvement here (since it is more effective than add them one by one)
> 

Sure, let me try asking again. Why do you want to serialize loading/adding torrents to lt and processing them? Queuing everything in lt like I said makes big batch of alerts to process, in my test with just ~600 torrent it takes 5-7s

Do you intend to manually add torrents to list and ignore `add_torrent_alert`? Or you want to gather those alerts and process them together? 

> since it is more effective than add them one by one

Why? After all adding torrents is iterative process so what overhead is involved when processing alerts one by one?

Anyhow it probably boils down to what time you measure, because letting lt session work while adding torrents will make pure adding torrents slower, but whole time to actually running torrent will be shorter. 

"
711147199,13498,glassez,2020-10-18T10:24:51Z,"@xavier2k6 
Can you produce a build with both `m_nativeSession->pause()` and `m_nativeSession->resume()` commented and compare its behavior with previous one?"
712099628,13498,glassez,2020-10-19T11:41:49Z,"> @xavier2k6
> Can you produce a build with both `m_nativeSession->pause()` and `m_nativeSession->resume()` commented and compare its behavior with previous one?

Have you any result?"
712100095,13498,FranciscoPombal,2020-10-19T11:42:47Z,"@glassez Please don't delete comments, hide them if needed."
712102254,13498,glassez,2020-10-19T11:47:49Z,"> @glassez Please don't delete comments, hide them if needed.

I don't delete anything important, even offtopic (I hide them), only what was of temporary significance (it often turns out that we use PR thread as a messenger). Otherwise, it becomes difficult for me to maintain it."
712111496,13498,FranciscoPombal,2020-10-19T12:06:21Z,"@glassez 

> I don't delete anything important, even offtopic (I hide them), only what was of temporary significance (it often turns out that we use PR thread as a messenger). Otherwise, it becomes difficult for me to maintain it.

Please leave it be for now. It is bad precedent to delete comments, even if they are spam (in a serious spam incident, it is preferable to ban the users from posting). Plus this is not even a particularly long discussion (yet). I agree it is not ideal to use the PR comment section for ephemeral communication, but we should enforce some other policy, like joining IRC for such conversations when 2 or more members notice they are online at the same time. This could be discussed together with other organizational matters."
712112435,13498,glassez,2020-10-19T12:08:17Z,"@FranciscoPombal
Ok"
712154070,13498,xavier2k6,2020-10-19T13:24:26Z,"> > @xavier2k6
> > Can you produce a build with both `m_nativeSession->pause()` and `m_nativeSession->resume()` commented and compare its behavior with previous one?
> 
> Have you any result?

I won't be in front of any of my machines until later this evening so it may be tomorrow before i actually have any update for you, sorry about that
"
712764417,13498,glassez,2020-10-20T10:48:49Z,"I noticed one thing. When qBittorrent starts ""cold"", reading resume data takes most of the startup time. Generally, startup time rests on reading time (at least in my tests on HDD driven machine). But with subsequent restarts of qBittorrent without restarting the system or any other heavy operations that can rewrite the disk IO cache, resume data is read much faster (even in my tests on HDD, it occurs in a couple of seconds, which is several times less than the total startup time). Since the normal launch of qBittorrent is usually ""cold"", I think we should test this PR in the same conditions. Am I right?"
712798288,13498,glassez,2020-10-20T11:58:17Z,"I also added some temporary code that makes some timestamps and outputs debug messages about the resume data read time and the total session resume time. If you can see such messages, it would be a good idea to get this info in your test reports."
712800290,13498,kasper93,2020-10-20T12:02:15Z,"You can use vmtouch to simulate both scenarios easily. Controlling mapped pages is quite important, because as you noticed reading resume data form memory is fast. Generally we cannot optimize IO time much, so would be nice to pipeline it with other processing to hide as much overhead as possible. "
716433731,13498,glassez,2020-10-26T09:45:19Z,"There's no one left to test the latest changes?..
@thalieht, @FranciscoPombal, @xavier2k6"
716445444,13498,xavier2k6,2020-10-26T10:07:21Z,"> There's no one left to test the latest changes?..
> @thalieht, @FranciscoPombal, @xavier2k6

I'll come back to this when I have more time......

`an0n666` seems to have got his account deleted???"
716689049,13498,thalieht,2020-10-26T17:01:33Z,"10k torrents no difference in loading time from the commit with the splash screen: 5-6 sec all paused and 13 sec all resumed.
One thing i noticed is that when all torrents are resumed, the loading progress bar animation is frozen after second 6 until the GUI is loaded. Doesn't happen when all torrents are paused. I don't expect anything regarding it, i'm just mentioning it.

Oh and no timestamps for me."
716845732,13498,xavier2k6,2020-10-26T21:55:38Z,">I noticed one thing. When qBittorrent starts ""cold"", reading resume data takes most of the startup time. Generally, startup time rests on reading time (at least in my tests on HDD driven machine). But with subsequent restarts of qBittorrent without restarting the system or any other heavy operations that can rewrite the disk IO cache, resume data is read much faster (even in my tests on HDD, it occurs in a couple of seconds, which is several times less than the total startup time). Since the normal launch of qBittorrent is usually ""cold"", I think we should test this PR in the same conditions. Am I right?

**Can confirm this & here are results from tests I conducted (actions build used - commit: `7b8087d`)**

### Paused
### Default/portable/10,000 test torrents
(double-click to fully loaded)
1st run 1min 33 secs
2nd run 4 secs
3rd run 4 secs
4th run 4 secs
(left it closed for 20 mins)
5th run 14 secs
6th run 4 secs

- runs 2/3/4/6 are the result of starting qBittorrent again as soon as it disappeared from task manager
- After 6th run in paused state - I resumed torrents & quit after a few minutes.

**Left about 2 hrs pass before beginning testing in resumed state.**

### Resumed
### Default/portable/10,000 test torrents
(double-click to fully loaded)
1st run 1min 34 secs
2nd run 32 secs
(left it closed for 10 mins)
3rd run 1min 10 secs
4th run 14 secs
5th run 9 secs
6th run 7 secs

- runs 2/4/5/6 are the result of starting qBittorrent again as soon as it disappeared from task manager

>Oh and no timestamps for me.

Same for me

>the loading progress bar animation is frozen

same observation, just before it is about to load GUI fully....starts to kinda stutter/freeze - no progression.
"
718195287,13498,xavier2k6,2020-10-28T20:39:23Z,"I gave the actions build with `87a9710` a whirl.....

Took 56 secs to load fully from double click (cold)
2nd/3rd run 3 going in to 4th sec to load fully from double click

One thing to note is that consistently the ""Downloading"" in STATUS pane ""ALWAYS"" shows a different amount on each run.......it never shows the `10,0000` - amount goes up or down on each run......

See pic for example:
![system restore inconsistency](https://user-images.githubusercontent.com/42386382/97493858-7aedf480-195d-11eb-99b8-2db56fa35d17.png)
"
718351843,13498,glassez,2020-10-29T04:27:41Z,">I gave the actions build with 87a9710 a whirl.....
One thing to note is that consistently the ""Downloading"" in STATUS pane ""ALWAYS"" shows a different amount on each run

Thank you for testing.
This last attempt seems to have defects. In addition, it does not bring the desired result.
It seems that the whole current approach does not work well with a large number of ""resumed"" torrents. Looking for a different approach..."
737860313,13498,glassez,2020-12-03T10:43:31Z,"I didn't abandon this work, but just put it on hold to solve more important tasks. I have some more ideas on how to go further."
742461389,13498,xavier2k6,2020-12-10T11:26:06Z,"I don't know if any of these would make a difference:

## classes/module:

`QFuture`
`QtConcurrent`
`Qpromise`"
759455011,13498,ghost,2021-01-13T13:40:56Z,"This is probably a related issue. 
https://github.com/qbittorrent/qBittorrent/issues/14115"
902347953,13498,NotTsunami,2021-08-20T00:47:40Z,Is this on hold until Qt6 support is finalized or are we going down a different route?
902419470,13498,glassez,2021-08-20T04:21:40Z,">Is this on hold until Qt6 support is finalized or are going down a different route?

I'm still busy with other problems. But I come back to think about this from time to time."
215987124,5195,ngosang,2016-04-30T18:54:47Z,"Could you share and example of uTorrent RSS feeds file?
"
215992053,5195,mgziminsky,2016-04-30T20:09:39Z,"@ngosang Here's a sample file with all imported options enumerated in the rules. You'll need to change the extension back to `.dat` to use it,
[sample.txt](https://github.com/qbittorrent/qBittorrent/files/243806/sample.txt)
"
215995012,5195,glassez,2016-04-30T20:58:04Z,"@mgziminsky 
1. I think you should separate logic from GUI code and move it into appropriate Base class.
2. Use **const** instead of `#define` to create constants
3. Check and fix coding style
"
215998255,5195,mgziminsky,2016-04-30T22:09:38Z,"@glassez 
1. I'll see what I can do. Do you have any particular expectations or suggestions as to how you want this to look in the end? I'm thinking a new aggregate model class that will hold the loading logic and results, then copying the loaded data into the final objects from the view callback. Does that sound acceptable?
2. Fair enough, will fix
3. Did you see something that doesn't follow the coding style? I'm using the provided QtCreator profile and ran uncrustify before committing.
"
216012123,5195,glassez,2016-05-01T03:19:52Z,"> Do you have any particular expectations or suggestions as to how you want this to look in the end? I'm thinking a new aggregate model class that will hold the loading logic and results, then copying the loaded data into the final objects from the view callback.

No need to complicate it.
Why not just implement the import function which parses the uTorrent file into set of qBittorrent RSS Feeds and Rules, and to call it from the GUI?
"
217627608,5195,ngosang,2016-05-07T10:29:16Z,"**OMG! It works perfect. Thank you so much! I couldn't find a single.**

I know this little improvements are not caused by your work but should be easy to implement for you.
In the Import dialog:
![](https://i.imgur.com/Q91nVTt.png)
I think we should have this 3 options:
- All supported formats (*.rssrules *.filters *.dat) <= Selected by default
- qBittorrent (*.rssrules *.filters)
- uTorrent (*.dat)

I don't know if it's possible but I want to see the extension (*.dat) in the dialog combo.

In the export dialog the Filter should be qBittorrent, the same as in the Import dialog. Remember the extension in the combo. :)
![](https://i.imgur.com/VSAMlQE.png)

The import dialog title doesn't seem ""proffesional""
![](https://i.imgur.com/KwZ1L81.png)
Export dialog title neither:
![](https://i.imgur.com/sE0jzr1.png)
"
217660345,5195,mgziminsky,2016-05-07T18:29:09Z,"> I think we should have this 3 options:
> - All supported formats (*.rssrules *.filters *.dat) <= Selected by default

Simple enough, I can add this in.

> I don't know if it's possible but I want to see the extension (*.dat) in the dialog combo.

This actually bothers me too. From what I can tell though, this is the fault of the system's native file dialog. The only solution that will ensure the filter rules are consistently shown is to force the use of Qt's built-in dialog rather than the system native one.

> The import dialog title doesn't seem ""proffesional""
> Export dialog title neither:

I'd be happy to change them, do you have some better alternatives in mind?
"
217662796,5195,ngosang,2016-05-07T19:19:05Z,"> I don't know if it's possible but I want to see the extension (*.dat) in the dialog combo.

I changed my mind, do not change that. Seems related to the DE, in Windows you can see the extension.

> I'd be happy to change them, do you have some better alternatives in mind?

I'm not english native.. maybe:
- Select a RSS rules file
- Select destination RSS rules file
"
218143456,5195,glassez,2016-05-10T12:33:14Z,"@mgziminsky please rebase and squash the last 4 commits into one so I can check it out.
"
218737876,5195,glassez,2016-05-12T12:07:32Z,"@mgziminsky
IMO, your main mistake here is you import feeds together with the rules and therefore it would be logical to do it from the main RSS UI, but for some reason you are doing it from narrowly (single-purpose) dialog, because of what you had to do that ugly closure (I mean the `addFeed` signal).
You should either import all uTorrent RSS data from main RSS UI or split importing into two parts (import feeds from main UI and import rules from appropriate dialog). I would prefer the first option.
@evsh what do you think on this?
"
218748948,5195,mgziminsky,2016-05-12T12:57:53Z,"I share your discomfort with the whole addFeed signal thing I ended up with, so I am completely in favor of making this change. I don't think there is any good way to import them separately, so I would also prefer your first option.

In that case, what are your thoughts on how this should be exposed from the main UI? My vote is a new option under the Tools menu. Then, if desired at some point, the ability to import settings from uTorrent can be added there as well as part of a sub-menu along with the RSS import option.
"
218762892,5195,glassez,2016-05-12T13:50:16Z,"> In that case, what are your thoughts on how this should be exposed from the main UI? My vote is a new option under the Tools menu. Then, if desired at some point, the ability to import settings from uTorrent can be added there as well as part of a sub-menu along with the RSS import option.

My vote is some button between ""RSS Downloader"" and ""Settings"".
But it would be better to ask other contributors.
"
218875326,5195,mgziminsky,2016-05-12T20:26:04Z,"For this feature though, the majority of users probably won't be using it, and those that do will only need to use it once. I typically think of buttons as a way to make common actions more accessible. Since this will be used so rarely, I feel like a button on the main UI will just be in the way.
"
218955602,5195,glassez,2016-05-13T05:30:54Z,"Your truth. I proceeded just from the fact that we already have some RSS command buttons, but do not have RSS menu.
But usually (in the case of a one-time import) the user is just offered to do it at the very beginning (through dialogue, for example). So we might as well do it when user turn on RSS UI.
"
218997498,5195,zeule,2016-05-13T09:38:09Z,"> @evsh what do you think on this?

I do share your concerns. I would try to implement the import filters in their own executables (I don't say they have to be executables). I guess the discussion about the signal went ahead already and that implementation will be changed.
"
219605060,5195,mgziminsky,2016-05-17T02:39:58Z,"Ok. So after experimenting a bit, here is what I decided to go with:
- A new menu option under the File menu that is only visible while the RSS tab is enabled.
- Open file dialog filter restricts to exactly `rss.dat` instead of `*.dat`
- `rss.dat` file in uTorrent's default location is pre-selected in the file dialog
- Importing will disable download rules and open the rules dialog so the user can check the imported rules
  - Maybe this should only happen if at least one rule is imported?

The most significant code change compared to before is to the behavior of the `DownloadRuleList`. The items in the list are now ""implicitly-shared"", which makes them effectively immutable. This allows `DownloadRuleList` to be copyable, which lets the rules dialog initialize it's editable list with a copy of the rules in memory, instead of loading them from disk.
"
222309924,5195,mgziminsky,2016-05-28T13:57:40Z,"@evsh @glassez 
Has anyone had a chance to look at my most recent commit? Sorry for the direct mentions, but there hasn't been any activity here in almost 2 weeks.
"
222317206,5195,glassez,2016-05-28T16:33:03Z,"The qBittorrent RSS subsystem is implemented through the ass (I have long intended to rewrite it, but I still once). Maybe that's why your changes look horrible (it's hard to build a good house on a bad groundwork).
So I prefer not to criticize it now. I better redo it all at once then, if the maintainer decides to merge this.
The only comment is about coding style. Please fix it.
"
222328220,5195,zeule,2016-05-28T20:28:02Z,"@mgziminsky I'm sorry but I have nothing to say. Don't use RSS and thus  do not really understand what is going on under the hood.
"
223816875,5195,mgziminsky,2016-06-05T14:42:45Z,"@glassez You mention coding style, but I don't know where you are referring to. I made sure to follow the style guide. I have the QtCreator profile loaded and ran uncrustify on my new files. I even went back and fixed some unrelated code based on your previous comments.
"
223916908,5195,glassez,2016-06-06T10:00:20Z,"> @glassez You mention coding style, but I don't know where you are referring to. I made sure to follow the style guide

Well. I pointed out your error in the code.
"
260212926,5195,apdidy,2016-11-13T21:07:15Z,"I'm new to this GitHub. Has update 5195 been released into a Stable or UnStable version of qBittorrent? If not, when do you anticipate to release the next version with this update? If it's going to be awhile, would you be able to guide me to a how to on compiling the source code for Windows? Then a how to on adding the updates you have checked but not released?
"
261784442,5195,mgziminsky,2016-11-20T15:23:20Z,"@apdidy 
Based on where the conversation left off, it seems unlikely this will be merged any time soon, if at all.

If you want to compile it on your own, you can find instructions on the qBittorrent wiki here: https://github.com/qbittorrent/qBittorrent/wiki
and specifically for Windows here: https://github.com/qbittorrent/qBittorrent/wiki/Windows-compilation
"
277713150,5195,sledgehammer999,2017-02-06T15:17:29Z,@mgziminsky recently I am doing quite a few PR reviews+merging regarding RSS(mostly by @magao). Do you mind rebasing this? I hope I'll have time to review+merge it too. Thanks for the effort so far.
277801929,5195,magao,2017-02-06T20:23:05Z,"@mgziminsky My new RSS rule handling (#6180 and #6181) has now been merged to master, and the new functionality in those might make importing easier. Basically, the changes were to reach parity (or better) with the uTorrent RSS filters ...

Note that regex rule parsing is currently broken on master - see PR #6344.

For myself I created a quick-and-dirty python script to convert my ~100 uTorrent RSS filters to qBittorrent.  I could make it available to see if there's any functionality in it that should be incorporated into this PR.

Side note: I needed to temporarily modify the qBittorrent rule loading to handle either a `QMap` or `QHash` (since I couldn't get `pyqt` to save as a `QHash`) but didn't see any point in creating a PR for that ..."
277851680,5195,mgziminsky,2017-02-06T23:45:03Z,"@sledgehammer999 @magao 
Thanks for the update. I'd been keeping an eye on that batch of RSS PRs, so if they are being merged now I'll try to get mine rebased some time this week."
528150843,5195,joachimweyl,2019-09-05T01:00:47Z,New to github. how do I find out if this code exists in qbittorrent or not?
528180426,5195,glassez,2019-09-05T03:25:58Z,">this code exists in qbittorrent or not?

No, it isn't."
596122392,5195,FranciscoPombal,2020-03-07T18:09:43Z,@mgziminsky is this abandoned? Re-open or start a new one if you still want to land something like this.
545768089,11354,glassez,2019-10-24T06:35:47Z,"@thalieht, are you test it? Couldn't it is possible lead to an inconsistent state?

What does happen, e.g., if you pause ""checking paused"" torrent? And then resume it?"
545936716,11354,thalieht,2019-10-24T14:11:27Z,">What does happen, e.g., if you pause ""checking paused"" torrent? And then resume it?

If by ""checking paused"" you're not referring to some weird internal state but to pause->recheck->interrupt recheck by pausing the torrent->resume, then yeah i had tested it and it behaves as expected: it resumes rechecking where it left off. However after qBt restart, the torrent will automatically recheck if the recheck wasn't finished. Not sure if that's expected behavior (don't know where to look in order to change it, if it isn't)."
547095701,11354,glassez,2019-10-28T18:55:54Z,"It isn't good idea to pause checking process in any case. Well, user can have reason to do it so I will discuss no pros and cons. 

First case is when the user triggers ""force recheck"" of paused torrent manually. Seems we can easily allow to pause it during checking but we need to clear `m_pauseWhenReady` flag.
The second case is when user wants to pause torrent that is checking during startup. This is a complex case and it requires careful research, otherwise we can plunge the torrent into inconsistent state."
547192385,11354,thalieht,2019-10-28T23:39:35Z,">The second case is when user wants to pause torrent that is checking during startup. This is a complex case and it requires careful research, otherwise we can plunge the torrent into inconsistent state.

I bet it involves `m_startupState`, i can't understand it. Maybe you'd like to take over? Turns out it's not as simple as i thought..."
547277571,11354,glassez,2019-10-29T06:33:56Z,">I bet it involves m_startupState, i can't understand it. Maybe you'd like to take over? 

At least you can finish the first case here. It is easy as you can see from my comment. And it should be done before v4.2 release.
I have no time now. I don't even have a suitable computer at my disposal."
547375064,11354,thalieht,2019-10-29T11:25:34Z,">At least you can finish the first case here.

Done (i hope) with some rudimentary testing again, no problems found."
548039518,11354,glassez,2019-10-30T18:01:36Z,">I thought the idea was to return it to its prior state when manually resuming the torrent we paused during recheck

Hmm, interesting point of view... can you explain what it's based on?
Mine is based on the fact that the user's last explicit action is ""resume torrent"", so user expects the torrent will keep resumed.
Or you separate ""checking"" from all other torrent jobs so ""pause"" and ""resume"" when torrent is checking affects only ""checking"" process?"
548048119,11354,xavier2k6,2019-10-30T18:20:51Z,"~~https://github.com/qbittorrent/qBittorrent/issues/11280#issuecomment-546748537~~

~~some torrents seem to need to be rechecked over & over again on each new openeing of qbittorrent......although it seems the amount is becoming less & less......I believe it is to do with the ""not responding"" being encountered on checking said torrents.~~"
548048879,11354,thalieht,2019-10-30T18:22:32Z,">Or you separate ""checking"" from all other torrent jobs so ""pause"" and ""resume"" when torrent is checking affects only ""checking"" process?

I hadn't given it any thought but it's pretty much what you said. It felt more intuitive. Also whether you were sarcastic or actually asking for my opinion the answer to both is that i don't care either way and my POV is clearly subjective hence you are right that it should resume the torrent.

>Mine is based on the fact that the user's last explicit action is ""resume torrent""

""resume"" actually :^)"
548288884,11354,thalieht,2019-10-31T09:45:06Z,"I have now given it some thought and stand by what i said that it should return to its prior state. Consider this: someone has his torrents on an external drive and forgets to connect it before starting qBt. They all start rechecking. ""damnit not now i have work to do"" and pauses everything. He had a mix of paused and non-paused torrents and i doubt he wants everything resumed when rechecking is finished. Remember, recheck was issued automatically/forcefully/unwillingly and the pause/resume commands were manual and explicit during the recheck. So despite what the code says, has the human given the command to ""resume torrent""?"
548401055,11354,glassez,2019-10-31T14:26:20Z,"> Also whether you were sarcastic or actually asking for my opinion

No sarcasm.
I am a supporter of simple, strict and reliable interfaces. But it often requires a certain skill and/or mentality from the user, so it is inconvenient for most ordinary users. So I'm interested in a different opinion.
>someone has his torrents on an external drive and forgets to connect it before starting qBt.

This isn't so good example. Such torrents just become ""missing files"". But you are right generally: recheck can be issued automatically/forcefully/unwillingly in many cases.
>the pause/resume commands were manual and explicit during the recheck

So you still lead to the fact that ""checking"" is a special state that can be started/paused regardless of the main state of the torrent. Hmm... In principle, I do not object to such a model, if we manage to formalize it consistently. The question is, will it be intuitive to the user that these actions (pause/resume) are context sensitive?"
548411501,11354,glassez,2019-10-31T14:48:10Z,">some torrents seem to need to be rechecked over & over again on each new openeing of qbittorrent......

Sorry, it seems like a different issue."
548430385,11354,glassez,2019-10-31T15:27:32Z,"@jagannatharjun, @Chocobo1, can you share the discussion above (about special meaning of ""checking"" state)?"
548442191,11354,jagannatharjun,2019-10-31T15:52:33Z,"Well, I didn't know the internals of qBittorrent yet. So I don't think I can add anything useful here
But by reading the comments and with my little understanding, I want to say that the idea should be that one can pause a torrent at any point in time, and ""Resuming"" should resume the torrent i.e Seeding if it were seeding previously or checking if it were checking.

"
548466138,11354,thalieht,2019-10-31T16:46:45Z,"@jagannatharjun the question is: if a paused torrent (initial state) started rechecking but was paused before it finishes, when user resumes the rechecking should the torrent go back to paused or resumed (seeding/downloading etc) when it finishes?"
548505192,11354,Chocobo1,2019-10-31T18:18:26Z,">@jagannatharjun the question is: if a paused torrent (initial state) started rechecking but was paused before it finishes, when user resumes the rechecking should the torrent go back to paused or resumed (seeding/downloading etc) when it finishes?

I would expect resumed state."
548529496,11354,glassez,2019-10-31T19:19:22Z,">I would expect resumed state.

Do you clearly understand the reasons for the contrary opinion?"
548626310,11354,xavier2k6,2019-11-01T01:02:17Z,"> > some torrents seem to need to be rechecked over & over again on each new openeing of qbittorrent......
> 
> Sorry, it seems like a different issue.

All ok now......had an extra resume file in BT_backup folder from about 2 yrs ago that had no torrent or torrent file associated with it....deleted it & resumed all other files manually for a split second or two in qbittorrent/re-paused - all saved same modified date/time regarding fastresume file & has not been stuck in a re-check loop on every start-up since."
548643857,11354,Chocobo1,2019-11-01T02:39:12Z,">Do you clearly understand the reasons for the contrary opinion?

I haven't look into much, that viewpoint was made as an user."
548673826,11354,glassez,2019-11-01T05:44:02Z,">I haven't look into much, that viewpoint was made as an user.

Ok, I asked for user opinions."
548697538,11354,LordNyriox,2019-11-01T07:45:43Z,"@thalieht: 

> if a paused torrent (initial state) started rechecking but was paused before it finishes, when user resumes the rechecking should the torrent go back to paused or resumed (seeding/downloading etc) when it finishes? 

IMO, the ""initial"" state should be preserved, assuming it is reasonable to do so.  I like to micromanage my qBittorrent transfers, which includes a lot of pausing and manual rechecking at various times. 

If some emergency comes up, and I have to pause a running recheck process to free up system resources, then I would like to be able to go back to exactly what I was doing in qBittorrent once the emergency is resolved. "
548881908,11354,glassez,2019-11-01T17:38:55Z,"Guys, it seems that you still do not understand what the hitch is...
Although the purpose of the changes is stated as ""allow to pause checking torrents"", it is not a problem in itself: just remove a couple of lines of code. The problem is what should happen next when we resume it again.
The fact is that ""checking"" can be performed for generally paused torrent (for which it temporarily resumes and then pauses again), for example, this can happen when a previously paused torrent is starting up, or when the user manually rechecks some paused torrent.
An illustrative example is #11076. Let's imagine you want download some torrent and run qBittorrent but it starts to check existing (both paused and resumed) torrents for some reason. You don't want to wait for it to finish checking and pause them all. After you've done your current job you want to resume all existing torrents. What should you do? And what behavior do you expect from qBittorrent?"
550410700,11354,Chocobo1,2019-11-06T17:16:37Z,">An illustrative example is #11076. Let's imagine you want download some torrent and run qBittorrent but it starts to check existing (both paused and resumed) torrents for some reason. You don't want to wait for it to finish checking and pause them all. After you've done your current job you want to resume all existing torrents. What should you do? And what behavior do you expect from qBittorrent?

I thought this situation isn't too different to what thalieht [mentioned](https://github.com/qbittorrent/qBittorrent/pull/11354#issuecomment-548466138) eariler. So my answer hasn't changed.

Basically this is what I would expect qbt to do (disregard what it is doing currently): 
1. When I press ""pause torrent"", I want it paused, i.e. just full stop.
2. When I press ""resume torrent"", I give qbt permission to do whatever it takes to get it running. The program may recheck the files if necessary. But eventually I want it to be in running state (either in downloading/seeding or whatever finished state).

>when the user manually rechecks some paused torrent.

I haven't really thought thoroughly on this, but I hope the following can reduce confusion from a user perspective.
1. When user manually rechecks some paused torrent, this marks the torrent a ""need recheck"" label (internally) and starts checking it. Now while it rechecks the user can have 2 actions:
    * Wait for it done and the torrent will become paused again.
    * Press pause to interrupt it. Now user can have 2 actions to leave this paused state:
      a. Select ""recheck torrent"" again, this action will go to step 1.
      b. Select resume. This will recheck the torrent and then starts running, i.e. leaving paused state.
"
551020401,11354,thalieht,2019-11-07T10:31:37Z,"@Chocobo1 if user has hundreds of torrents and they all start checking, he's supposed to manually track down which ones were previously paused and Force recheck only those he wants to be paused again? No one will do that anyway, everyone will just resume. Not to mention that issuing Force recheck on a half checked torrent will start from the beginning (no big deal since checking is no longer parallel, well except for Force resumed torrents). Unacceptable IMO. I only object because of this case, if mass rechecks were never mandatory it wouldn't even be an issue."
551034530,11354,Chocobo1,2019-11-07T11:10:57Z,">@Chocobo1 if user has hundreds of torrents and they all start checking

What leads to that condition? Does the user manually rechecks them or qbt auto start the rechecking? 
If it is the former I would expect this:
* Running state -> user initiate rechecks -> recheck done -> continue in running state
* Running state -> user initiate rechecks -> user pause it before done -> user resume it -> recheck done  -> continue in running state
* Running state -> user initiate rechecks -> user pause it before done -> user initiate recheck again (via menu ""force recheck"", not ""resume"") -> recheck done  -> torrent in paused state

In the latter case (IMO) it shouldn't, it should display ""needs recheck"" and sits in paused state and wait for user decision/action.
ps. I don't have a huge collection of torrents so I'm not familiar with this use case.


>he's supposed to manually track down which ones were previously paused and Force recheck only those he wants to be paused again? No one will do that anyway, everyone will just resume. 

For me it is confusing & inconsistent if the resume doesn't really mean starting the torrent (like what you will expect ▶️ on music players) and will depend on whether it needs rechecking. 

ps. To be clear, I don't mean to insist on my viewpoint and block any PR, I'm just expressing myself."
551043818,11354,glassez,2019-11-07T11:40:00Z,"So how about the following:
1. When user pause/resume torrent that is not started completely yet it applies to torrent initialization only, i.e. the torrent will be in the same state for which it is preparing.
2. When user pause and then resume already srarted torrent it will be resumed after all."
551056497,11354,thalieht,2019-11-07T12:19:19Z,">1. When user pause/resume torrent that is not started completely yet it applies to torrent initialization only, i.e. the torrent will be in the same state for which it is preparing.

I don't think i understand this (you're speaking in terms that describe `m_startupState`)."
551123720,11354,glassez,2019-11-07T15:18:38Z,">I don't think i understand this

Apply pause/resume action to ""checking"" process only when checking is triggered automatically (i.e. on startup checking). Otherwise (i.e. on manual checking) apply pause/resume to entire torrent."
551142004,11354,thalieht,2019-11-07T15:57:54Z,Fine by me.
551160912,11354,Chocobo1,2019-11-07T16:39:19Z,">So how about the following:
    When user pause/resume torrent that is not started completely yet it applies to torrent initialization only, i.e. the torrent will be in the same state for which it is preparing.
    When user pause and then resume already srarted torrent it will be resumed after all.

I think it is not fully ideal but I can accept it for now."
551584485,11354,thalieht,2019-11-08T11:01:29Z,"Is this ok or i have to check for a specific `m_startupState`?
```
+    if ((m_startupState != Started) && m_pauseWhenReady) {
+#if (LIBTORRENT_VERSION_NUM < 10200)
+        m_nativeHandle.stop_when_ready(true);
+#else
+        m_nativeHandle.set_flags(lt::torrent_flags::stop_when_ready);
+#endif
+    }
+    else {
+#if (LIBTORRENT_VERSION_NUM < 10200)
+        m_nativeHandle.stop_when_ready(false);
+#else
+        m_nativeHandle.unset_flags(lt::torrent_flags::stop_when_ready);
+#endif
+    }
```"
551654645,11354,glassez,2019-11-08T11:50:16Z,"@thalieht, you need to apply suggestion from https://github.com/qbittorrent/qBittorrent/pull/11354#discussion_r343190620 and then replace the following code in `pause()`
```c++
    // Libtorrent doesn't emit a torrent_paused_alert when the
    // torrent is queued (no I/O)
    // We test on the cached m_nativeStatus
    if (isQueued())
        m_session->handleTorrentPaused(this);
```
with the following:
```c++
if (m_startupState == Started) {
    if (m_pauseWhenReady) {
#if (LIBTORRENT_VERSION_NUM < 10200)
        m_nativeHandle.stop_when_ready(false);
#else
        m_nativeHandle.unset_flags(lt::torrent_flags::stop_when_ready);
#endif
        m_pauseWhenReady = false;
}

    // Libtorrent doesn't emit a torrent_paused_alert when the
    // torrent is queued (no I/O)
    // We test on the cached m_nativeStatus
    if (isQueued())
        m_session->handleTorrentPaused(this);
}
```

Unless I am missing something..."
551694280,11354,thalieht,2019-11-08T12:18:32Z,"Thanks that works too, although weird to look at: ""if m_pauseWhenReady then dont pause when ready"""
551851813,11354,glassez,2019-11-08T14:37:17Z,">although weird to look at: ""if m_pauseWhenReady then dont pause when ready""

Why weird? If ""pause when ready"" action was scheduled we cancel it (since we pause it explicitly and we don't want it to be paused automatically after we resume it)."
551853280,11354,glassez,2019-11-08T14:40:58Z,"@thalieht, why didn't you apply exact the same changes as I suggest in https://github.com/qbittorrent/qBittorrent/pull/11354#issuecomment-551654645?"
551859858,11354,thalieht,2019-11-08T14:57:53Z,">@thalieht, why didn't you apply exact the same changes as I suggest in #11354 (comment)?

I did what are you talking about?

Edit: oops the preprocessor indentation is wrong but i'll wait for your answer in case you mean something else."
551895749,11354,glassez,2019-11-08T16:28:58Z,">in case you mean something else.

Sorry, I mean exactly what I mean... but your code is different from my one."
551912489,11354,thalieht,2019-11-08T17:12:12Z,"You don't mean that the following closing brace belongs to `if (m_pauseWhenReady) {` do you? Of course you do... everything else is the same. I thought you just forgot a closing brace because of the indentation.

```
if (m_startupState == Started) {
    if (m_pauseWhenReady) {
#if (LIBTORRENT_VERSION_NUM < 10200)
        m_nativeHandle.stop_when_ready(false);
#else
        m_nativeHandle.unset_flags(lt::torrent_flags::stop_when_ready);
#endif
        m_pauseWhenReady = false;
}   <------------

    // Libtorrent doesn't emit a torrent_paused_alert when the
    // torrent is queued (no I/O)
    // We test on the cached m_nativeStatus
    if (isQueued())
        m_session->handleTorrentPaused(this);
}
```"
552051517,11354,Chocobo1,2019-11-09T01:28:28Z,"@thalieht 
Thanks!"
552063131,11354,glassez,2019-11-09T03:52:25Z,"@thalieht, thank you very much! :+1:"
552063191,11354,glassez,2019-11-09T03:53:39Z,4.1.x has the same issue so I think we should backport it.
552089750,11354,thalieht,2019-11-09T11:08:52Z,"Thanks everyone.

While testing the backport i accidentally discovered that we can't force recheck a checking torrent on startup that we paused. Do you want me to do something in `TorrentHandle::forceRecheck()` or just remove the following? Or it doesn't matter and i should leave it alone? Currently working on the backport, will make PR for master afterwards. 
https://github.com/qbittorrent/qBittorrent/blob/d12468ffb5b783d3e70c5a16c311ea32cfaa2b98/src/base/bittorrent/torrenthandle.cpp#L1402"
552090735,11354,glassez,2019-11-09T11:21:45Z,"@thalieht, you should backport this changes as is. Then we can elaborate on issue you meantioned.
> or just remove the following?

Seems, Yes. And add `m_startupState == Started` to `if (isPaused)` condition below."
552094336,11354,thalieht,2019-11-09T12:16:57Z,">@thalieht, you should backport this changes as is.

I'm not gonna make a million PRs for no reason, especially backports to a branch that will probably not see another release. I'll just make another commit for it and update PR description to mention the future PR to master.

>And add m_startupState == Started to if (isPaused) condition below.

I''ll assume you meant `m_startupState = Started`"
552103010,11354,thalieht,2019-11-09T13:59:15Z,">>And add m_startupState == Started to if (isPaused) condition below.
>
>I''ll assume you meant `m_startupState = Started`

I better mention that i tried 
`if (isPaused() && (m_startupState == Started))`
in case you meant that, but it pauses the moment it starts checking the ""on startup checking torrent i paused"" that i Force recheck."
552103667,11354,glassez,2019-11-09T14:05:44Z,">`if (isPaused() && (m_startupState == Started))`

Yes, but in reverse order.
>it pauses the moment it starts checking the ""on startup checking torrent i paused"" that i Force recheck.

Sorry, I cannot understand what do you mean."
552103832,11354,glassez,2019-11-09T14:07:38Z,"> I'll just make another commit for it

Backport PR that contains commits from several upstream PRs is allowed."
552105334,11354,thalieht,2019-11-09T14:27:24Z,">Sorry, I cannot understand what do you mean.

Cases 3 and 4 (rechecks on startup, both originally resumed and paused)

Instead of Resuming the checking torrent that i paused, i Force recheck. It goes to 0.0% and is paused immediately.

"
552208944,11354,thalieht,2019-11-10T16:11:16Z,#11472. I just removed the first line for now until there is an answer.
552211672,11354,glassez,2019-11-10T16:44:21Z,"Well, I didn't think it through. It is necessary to begin with a questions ""for what it is needed?"" and ""what the user expects as a result?"". So please describe possible use cases."
552221970,11354,thalieht,2019-11-10T18:48:06Z,">""for what it is needed?"" and ""what the user expects as a result?"". So please describe possible use cases.

To be able to Force recheck in legitimate cases which i mentioned above."
552223181,11354,glassez,2019-11-10T19:02:40Z,">legitimate cases which i mentioned above.

What cases? You just meantioned that ""Instead of Resuming the checking torrent that i paused, i Force recheck"". But what's the reason to do it? And what do you expect as a result?
Seems there are two possible ways: restart ""preparing"" process or skip ""preparing"" process (if you understand what I mean)."
552227873,11354,thalieht,2019-11-10T19:56:22Z,">You just meantioned that ""Instead of Resuming the checking torrent that i paused, i Force recheck"". But what's the reason to do it?

Honestly i wouldn't do it but apparently it's not unexpected
https://github.com/qbittorrent/qBittorrent/pull/11354#issuecomment-550410700
>Press pause to interrupt it. Now user can have 2 actions to leave this paused state:
a. Select ""recheck torrent"" again, this action will go to step 1.
b. Select resume. This will recheck the torrent and then starts running, i.e. leaving paused state.

>if you understand what I mean

Once again no, i don't know what ""preparing"", ""starting"" entails but i expect it to continue rechecking (if possible, currently it starts from the beginning) or to restart checking, as it currently does."
554437940,11354,glassez,2019-11-15T16:48:15Z,"

It has already been explained several times... Well, I'll say it again. ""Preparing"" is ""initial fastresume data/torrent checking"" and analyzing its result. 

But back to our question... 
Some torrent can be started to become either paused or resumed (i.e. ""target"" state). You have paused its checking. What state it should reach after you perform force recheck on it? We have chosen ""target"" state in case you resume it. Also be noted that when you recheck paused (started) torrent it becomes paused again. So what behavior should be used in case of recheck of ""preparing"" torrents?

BTW, user can perform ""recheck"" when checking is being performed."
554444365,11354,thalieht,2019-11-15T17:05:30Z,">What state it should reach after you perform force recheck on it?

Its previous state, ""preparing"" torrents included in the answer."
554625132,11354,glassez,2019-11-16T10:34:51Z,So how it works in current #11472?
554628070,11354,thalieht,2019-11-16T11:22:05Z,Pauses in all cases...https://github.com/qbittorrent/qBittorrent/blob/30ca4e6986c18b62340a50a1510132534c99e343/src/base/bittorrent/torrenthandle.cpp#L1408-L1410
554633273,11354,glassez,2019-11-16T12:35:16Z,"Can you test the following?
```c++
void TorrentHandle::forceRecheck()
{
    if (!hasMetadata()) return;

    m_nativeHandle.force_recheck();
    m_unchecked = false;

    if ((m_startupState != Started) || isPaused()) {
#if (LIBTORRENT_VERSION_NUM < 10200)
        m_nativeHandle.stop_when_ready(true);
#else
        m_nativeHandle.set_flags(lt::torrent_flags::stop_when_ready);
#endif
        setAutoManaged(true);
    }

    if ((m_startupState == Started) && isPaused())
        m_pauseWhenReady = true;
}
```"
554634706,11354,thalieht,2019-11-16T12:52:39Z,"
1.    Paused (initial Resumed)
 2.   Paused (initial Paused)
  3.  Resumed (initial Resumed on startup)
4. Paused (initial Paused on startup)
"
554638946,11354,glassez,2019-11-16T13:47:52Z,">Paused (initial Resumed)

It's really weird... Nothing should have changed for this case."
554639605,11354,thalieht,2019-11-16T13:55:28Z,`isPaused()` is true so it gets to `m_nativeHandle.stop_when_ready(true);`
554639815,11354,glassez,2019-11-16T13:58:09Z,Then I don't understand first two cases...
554640004,11354,glassez,2019-11-16T14:00:12Z,And maybe other cases too. What do you mean?
554640414,11354,thalieht,2019-11-16T14:05:05Z,"Never mind, i don't understand how 3rd case works with these changes so... better disregard my speculations."
554644963,11354,thalieht,2019-11-16T15:01:26Z,"Ah i get it, it's because `m_pauseWhenReady = true` was moved so the following is reached and it overrides `m_nativeHandle.stop_when_ready(true)` 
https://github.com/qbittorrent/qBittorrent/blob/30ca4e6986c18b62340a50a1510132534c99e343/src/base/bittorrent/torrenthandle.cpp#L1708
but that's not called when torrent is `Started`."
554646784,11354,glassez,2019-11-16T15:23:54Z,"@thalieht, I still don't understand you. What case we're discussing?"
554647293,11354,thalieht,2019-11-16T15:30:34Z,1st and 3rd cases. Why 1st doesn't work and 3rd works.
554651666,11354,glassez,2019-11-16T16:23:05Z,">1st and 3rd cases. Why 1st doesn't work and 3rd works.

But what do you mean by the first case? You recheck resumed (i.e. non paused) torrent and it becomes paused after checking has done?"
554656276,11354,thalieht,2019-11-16T17:17:07Z,"> You recheck resumed (i.e. non paused) torrent and it becomes paused after checking has done?

Yes. The 1st case is the only one that doesn't work the way we want i.e. to return to its prior state after the recheck."
554658181,11354,glassez,2019-11-16T17:39:30Z,">Yes. The 1st case is the only one that doesn't work the way we want i.e. to return to its prior state after the recheck.

But it shouldn't be affected by my changes and it should work as previously. It is ""started"" and ""non paused"" so it is out of both ""if"" bodies (in previous code it is out of ""if"" body so nothing is changed). Or am I wrong?"
554662736,11354,thalieht,2019-11-16T18:34:43Z,">and ""non paused""

But it is paused in all cases when we issue the recheck. Also in previous code i said that it gets paused in all cases after the recheck. 

>You recheck resumed (i.e. non paused) torrent and it becomes paused after checking has done?

Wait.. i think there is a misunderstanding: In all cases we interrupt the checking by pause and then force recheck again. So in all cases the torrent is paused when we issue the second recheck."
554664120,11354,glassez,2019-11-16T18:53:26Z,">So in all cases the torrent is paused when we issue the second recheck.

Then what's difference between 1st and 2nd cases?

Anyway, when we recheck paused torrent it should keep paused after checking has done (it is current behavior). When we recheck ""preparing"" torrent it should become in those state for which it is preparing (we suggest this behavior)."
554669271,11354,thalieht,2019-11-16T20:00:25Z,"In that case your changes have the desired result. Considering what we were talking about in this issue i thought we were talking about the same thing, but instead of Resume as the final step we Force recheck.
Anyway i'll make PR for master with these changes as there is no time left for 4.2 release."
675169263,13266,kasper93,2020-08-17T23:43:17Z,"This is rebased on #12173, two first commits are from there."
675292389,13266,glassez,2020-08-18T06:54:24Z,"Add screenshots, please."
675454001,13266,kasper93,2020-08-18T12:40:31Z,"![image](https://user-images.githubusercontent.com/1126053/90513855-95873e80-e160-11ea-9102-acb04ab639fa.png)
"
675464286,13266,ghost,2020-08-18T13:01:24Z,Nice! Finally we get to see error messages per endpoint as well as connection error messages! 
680084396,13266,glassez,2020-08-25T15:08:41Z,"Shouldn't you rename ""URL"" column to ""URL/Local endpoint""?"
680302777,13266,kasper93,2020-08-25T22:34:51Z,"> Shouldn't you rename ""URL"" column to ""URL/Local endpoint""?

I changed it, but not sure I like it. Maybe some more generic and simple like `Name`, which would fit both?"
681368091,13266,glassez,2020-08-27T04:09:48Z,">Maybe some more generic and simple like Name, which would fit both?

IMO, `Name` fits none of them."
939418617,13266,kasper93,2021-10-10T06:55:32Z,Rebased onto latest master
1133178536,13266,kasper93,2022-05-20T18:07:18Z,rebased on current master 
1586188617,13266,luzpaz,2023-06-11T14:27:59Z,Great work here. Any idea on a merge ETA ? 
1605688450,13266,kasper93,2023-06-24T19:01:59Z,rebased onto latest master and removed the changes that were rejected in other PRs
1683569985,13266,glassez,2023-08-18T08:40:09Z,Superseded by #19468.
366522094,8427,glassez,2018-02-18T15:00:49Z,"@Chocobo1, unless I'm wrong, we can process only original data views in all cases until we require to save some of them or convert to another format (e.g. QString)."
367327407,8427,Chocobo1,2018-02-21T13:35:48Z,">Is there a normal way to close connection?

Timeout:  https://github.com/qbittorrent/qBittorrent/blob/master/src/base/http/server.cpp#L108

PR updated."
367403731,8427,glassez,2018-02-21T17:25:12Z,"@Chocobo1, it's really hard to compare with the previous version, as diffs look just awful! I hope you had a good reason to completely rewrite that. I want to test this and look at some suspicious places in the debugger.
However, I firmly believe that this should be divided into two commits, one for ""Enable Http persistence connection"" and the second one for the rest."
367417754,8427,Chocobo1,2018-02-21T18:09:45Z,">I hope you had a good reason to completely rewrite that. 

Of course, better performance & security (if no bugs creeps in, even so, it's still better than the previous version IMO).

>However, I firmly believe that this should be divided into two commits, one for ""Enable Http persistence connection"" and the second one for the rest.

Due to I've already mixed them together, it's hard to separate cleanly.
I can push a version that the first commit do everything except ""Http persistence connection"" and the second commit enables it."
367426494,8427,glassez,2018-02-21T18:37:52Z,">I can push a version that the first commit do everything except ""Http persistence connection"" and the second commit enables it.

Well, order isn't so important here."
367925077,8427,Chocobo1,2018-02-23T06:46:52Z,">Well, order isn't so important here.

OK, done."
369850819,8427,Chocobo1,2018-03-02T08:07:22Z,Thanks for the reviews!
455149118,10175,FranciscoPombal,2019-01-17T12:05:06Z,"I can imagine a lot of people are using Let's Encrypt for their certificates.

Wouldn't it make sense to include an option to auto-reload the certificate from disk every X days?

This way people wouldn't have to reset the certificate every time it renews."
455174236,10175,Chocobo1,2019-01-17T13:37:00Z,">Wouldn't it make sense to include an option to auto-reload the certificate from disk every X days?

perhaps... anyway it is out of scope of this PR."
455737810,10175,Piccirello,2019-01-19T01:42:23Z,"Thanks for tackling this often-requested feature.

> This will break WebUI users who have https setup

I haven't had a chance to review the code yet, but this is going to be a support nightmare. nox users aren't going to have any idea why their setup broke after updating. What about writing out the contents of the existing cert + key to qBittorrent's config directory, on upgrade,  so that it continues to work? Or some other approach to make upgrading easier. It can be in a separate PR, but definitely before 4.2 is released.

"
455739760,10175,Chocobo1,2019-01-19T02:04:03Z,">I haven't had a chance to review the code yet, but this is going to be a support nightmare. nox users aren't going to have any idea why their setup broke after updating. 

One of the reason why this is for 4.2.0 only is that we already break WebUI users with this change: https://github.com/qbittorrent/qBittorrent/blob/master/Changelog#L4
So maybe it won't be much of an issue since WebUI users already need to reconfigure their setup?"
455906441,10175,Piccirello,2019-01-20T21:59:03Z,"What will the process be for setting the password? Will there be a prompt on first login, or does the user need to modify some config file?

The reason I think this PR will be an issue is that the webui will be entirely broken, unless the user tries a different protocol."
455930836,10175,Chocobo1,2019-01-21T02:36:12Z,">What will the process be for setting the password? 

User will be required to login with default password and updates it."
456365705,10175,glassez,2019-01-22T11:24:53Z,">User will be required to login with default password and updates it.

The user can do it remotely (via WebUI). However, this PR requires access to the server to update its configuration. Maybe you should listen to @Piccirello and implement the update code?  I don't think it's too complicated."
456387707,10175,Chocobo1,2019-01-22T12:49:09Z,">However, this PR requires access to the server to update its configuration. 

No, webUI will fallback to un-encrypted http automatically, so it is still accessible.

>The reason I think this PR will be an issue is that the webui will be entirely broken, unless the user tries a different protocol.
>
>Maybe you should listen to @Piccirello and implement the update code? I don't think it's too complicated.

I would agree with you guys if this had nothing to do with security. A few concerns from my viewpoint:
* Certificate and private key are sensitive things, as for me I would not like them to be exported automatically to other files without my consent, the same even if we provide a log message, because not every user will look at it.
* We just cleared all upgrade code in 4.2.0 to start fresh, now we want to reintroduce upgrade code so soon? My point is we already broke the WebUI (greatly), it doesn't matter more or less.

I might be wrong but so far I'm not greatly convinced that we really need the upgrade code. "
456390945,10175,glassez,2019-01-22T13:01:00Z,"I'm not insisting on ""upgrade"" code, I was just suggesting that we think about it again. 
Personally, I am for us to clean our code from time to time from all unnecessary things, even if it leads to incompatible changes."
456391804,10175,glassez,2019-01-22T13:04:06Z,Another way is to just keep using existing certs/keys if no new settings are set.
456392482,10175,glassez,2019-01-22T13:06:24Z,OFFTOPIC: Could we turn LGTM off until it's fixed? It's really annoying!
457321839,10175,Piccirello,2019-01-24T19:18:49Z,"> No, webUI will fallback to un-encrypted http automatically, so it is still accessible.

That’s not necessarily true. A user may have a reverse proxy configured and not expose qBittorrent directly, which I believe is a common use case based on issues created on this repo. In that case the protocol will have been hard coded and will now be incorrect. The difficulty comes in that changing the protocol won’t be an obvious thing to check when qBittorrent suddenly “stops working”.

> Certificate and private key are sensitive things, as for me I would not like them to be exported automatically to other files without my consent

I think this point is moot because we already save the user’s cert and key on the file system. We would just be moving it to a separate file in the same location. Users generally aren’t concerning themselves with how qBittorrent stores its config files.

> Another way is to just keep using existing certs/keys if no new settings are set.

If this approach is doable I think it would be a good compromise to avoid upgrade code.

My hesitation stems from qBittorrent not just making a major config change, but from users not having any idea of the change that’s going to occur. If we had a means of telling the user, this would be a non-issue.
"
457446408,10175,Chocobo1,2019-01-25T03:50:23Z,">A user may have a reverse proxy configured and not expose qBittorrent directly, which I believe is a common use case based on issues created on this repo. 

From what I see, most of the case is `qbt <--http--> proxy <--https--> web` so it is not affected by this PR.

>>Another way is to just keep using existing certs/keys if no new settings are set.
>
>If this approach is doable I think it would be a good compromise to avoid upgrade code.

I would prefer it too.
Please don't get me wrong, I not stopping anyone from adding the migration code (after this PR), I'm just not motivated.

>If we had a means of telling the user, this would be a non-issue.

We can make a post at https://www.qbittorrent.org/news.php
There is one such example, the title: Tuesday March 7th 2017 - NOTICE to tracker operators: User agent change
If we post it now would it be sufficient?"
457448482,10175,glassez,2019-01-25T04:05:00Z,"I think the final decision is @sledgehammer999.
>We just cleared all upgrade code in 4.2.0 to start fresh, now we want to reintroduce upgrade code so soon? 

The point was not ""to start fresh"" but ""to remove old upgrade code"", IMO. I think it isn't a problem to maintain upgrade from directly previous version. But as I said before it isn't problem for me if we introduce some incompatible changes at this point (of course we should mention it in release notes)."
457568573,10175,sledgehammer999,2019-01-25T13:13:00Z,">The point was not ""to start fresh"" but ""to remove old upgrade code"", IMO.

This ^

>I think the final decision is @sledgehammer999.

I am bit rusty with the WebUI part. Can someone explain in few words what is this change aka old vs new?"
457590163,10175,Chocobo1,2019-01-25T14:30:38Z,">Can someone explain in few words what is this change aka old vs new?

Previously the certificate & key were imported to qbt config, now we don't do that, instead we let user to specify the path to certificate & key.

This will break WebUI users who have https setup, without upgrade code users will need to login via http and update the path to the certificate & key to re-enable https."
457955045,10175,sledgehammer999,2019-01-27T21:16:35Z,"IMO, we should have migration code, that exports the keys into files in the same dir that current settings are saved. The keys are already accessible to anyone having access to that part of the filesystem anyway.
It's bad to suddenly degrade the connection security when the user has explicitly configured https and expects it work.

Or another measure: Detect if the old keys aren't empty AND news keys are empty ->refuse login until the user reconfigures https (or drops it)"
458039708,10175,Chocobo1,2019-01-28T08:38:39Z,"PR updated, added migration code in a new commit and `m_ui->textWebUIHttpsCert->setFileNameFilter` helpers."
459564955,10175,Piccirello,2019-02-01T00:53:27Z,"The upgrade code worked great for me.

One note: the cert and key are created with perms of 644. Ideally, the key would use 600 so that it's not readable by anyone other than the owner (none of the config files should be). Can someone think of a reason why this wouldn't be feasible?"
459611210,10175,Chocobo1,2019-02-01T05:31:32Z,">One note: the cert and key are created with perms of 644. Ideally, the key would use 600 so that it's not readable by anyone other than the owner (none of the config files should be). 

Instead of changing every file, perhaps change the folder (~/.config/qbittorrent) to 700 would be sufficient?
Since this issue has a bigger scope than this PR, let's do it in another PR."
473670043,10384,sledgehammer999,2019-03-17T14:18:42Z,"Most comments are addressed.
(will rebase later on latest master)"
473691999,10384,sledgehammer999,2019-03-17T18:23:15Z,"PR updated again.

**Guys an honest question:**
In recent diffs I have seen this usage:
```
const SomeType &localVar = someFunctionThatReturnsAVariable();
```

I suppose this is done for performance reasons to not copy the temporary object, right?
Is there a rule when to prefer this practice? Is it preferred for objects bigger than the size of a pointer?
Is this to be followed strictly or to our own discretion? Because I have mixed usages in this PR."
473878334,10384,Chocobo1,2019-03-18T11:49:15Z,">`const SomeType &localVar = someFunctionThatReturnsAVariable();`
>Is there a rule when to prefer this practice? 

I think it is only used when `someFunctionThatReturnsAVariable()` returns a const reference, otherwise `localVar` should be a normal variable."
473880890,10384,Chocobo1,2019-03-18T11:58:20Z,"I noticed there is this empty file: src/gui/log/logmessage.cpp, I think you can remove it instead."
473922727,10384,sledgehammer999,2019-03-18T14:03:38Z,">Don't recall anything. AFAIK we only do ""const reference initialize"" when the function returns a const reference, for anything else a normal variable.

>I think it is only used when someFunctionThatReturnsAVariable() returns a const reference, otherwise localVar should be a normal variable.

Yes, you're correct. I did a regex search in the codebase and the only cases were what you described. Also 2 cases where it initializes from a pointer if I can decipher it correctly.
1. misc.cpp:236
```c++
const auto &unitString = units[static_cast<int>(unit)];

// units it defined as
const struct { const char *source; const char *comment; } units[] = {
        QT_TRANSLATE_NOOP3(""misc"", ""B"", ""bytes""),
        QT_TRANSLATE_NOOP3(""misc"", ""KiB"", ""kibibytes (1024 bytes)""),
        QT_TRANSLATE_NOOP3(""misc"", ""MiB"", ""mebibytes (1024 kibibytes)""),
        QT_TRANSLATE_NOOP3(""misc"", ""GiB"", ""gibibytes (1024 mibibytes)""),
        QT_TRANSLATE_NOOP3(""misc"", ""TiB"", ""tebibytes (1024 gibibytes)""),
        QT_TRANSLATE_NOOP3(""misc"", ""PiB"", ""pebibytes (1024 tebibytes)""),
        QT_TRANSLATE_NOOP3(""misc"", ""EiB"", ""exbibytes (1024 pebibytes)"")
    };
```
2. reverseresolution.cpp:58
```c++
const QString &hostname = *m_cache.object(ip);
```

In any case, I'll stop using const ref to initialize local variables.

>I noticed there is this empty file: src/gui/log/logmessage.cpp, I think you can remove it instead.

That was a mistake. I'll correct it."
476148406,10384,glassez,2019-03-25T11:02:40Z,">Your model should interact with the Logger and provide data to the View in a convenient way. 

I would also implement it in a way to avoid duplication of Logger data (aka log messages) in the Model. But this will require some (minor) modification of the Logger."
476164885,10384,sledgehammer999,2019-03-25T11:55:40Z,"About the model/view issue: If I understand correctly you want the model to interact with Logger and not the widgets up the hierarchy, right? So basically the model a) gets the accumulated messages on start and b)listens/reacts to new messages, right?

>I would also implement it in a way to avoid duplication of Logger data (aka log messages) in the Model. But this will require some (minor) modification of the Logger.

This would be probably good too. I have a minor idea on how to achieve this, (if my above assumption about model/view is correct)."
476165564,10384,glassez,2019-03-25T11:57:58Z,">So basically the model a) gets the accumulated messages on start and b)listens/reacts to new messages, right?

Yes."
476168934,10384,sledgehammer999,2019-03-25T12:09:44Z,"I just re-thought my idea about this:

>I would also implement it in a way to avoid duplication of Logger data (aka log messages) in the Model. But this will require some (minor) modification of the Logger.

It wouldn't work. Basically I have zero ideas about this. Do you have anything specific? How will the data be shared between the two?
Maybe the model holds the msg IDs and dynamically queries Logger for msg data when required by the View? But again, the QReadLocker would introduce lag."
476229464,10384,glassez,2019-03-25T14:47:24Z,">Maybe the model holds the msg IDs and dynamically queries Logger for msg data when required by the View?

At first glance, all you need is the ability to get a message by its index.
>But again, the QReadLocker would introduce lag.

Some time ago I wanted to get rid of all QReadLockers (and forbid using basic app components from service threads directly), but you all proved to me the failure of my improvement due to the fact that QReadLocker does not reduce performance too much.
Anyway we can measure it."
480577407,10384,sledgehammer999,2019-04-07T10:20:18Z,"I have pushed 2 commits. The 1st one moves all data gathering into the models. The 2nd one doesn't cache the data (apart from the msg index) and directly queries them from the Logger when needed.

I don't know if any of them satisfies the goal of the PR: faster than current implementation at handling big logs

PS: The 2nd commit will be squashed into the 1st one if it is deemed satisfactory.
"
615023067,10384,Chocobo1,2020-04-17T03:44:44Z,Superseded by PR #12458. Closing.
1476532823,18735,rmartin16,2023-03-20T16:13:30Z,"I support this change. However (and this may be unavoidable), this change blocks local connections for me when qBittorrent is running in a Docker container. I can work around by exposing the host network to the Docker container....and that (ofc) comes with its own implications. FYI if nothing else since I exclusively use qBittorrent in Docker for personal and development purposes; I imagine this also may impact existing qBittorrent images and installation guides."
1476718617,18735,glassez,2023-03-20T18:14:44Z,">or manually set them in the configuration file

It's not a problem to change the username this way, but it's not that easy for a password.
And I think access only from the localhost may be too strict a requirement, because it seems impossible or quite difficult for things like Docker, which is often used to run qbittorrent-nox."
1477031216,18735,sledgehammer999,2023-03-20T22:32:36Z,"Can users pass cmd arguments when starting the docker container? (I am a docker noob).
I have introduced 2 cmd parameters that allow the user to change the webui credentials."
1478164776,18735,sledgehammer999,2023-03-21T16:23:04Z,">We don't exit app when Web UI port is changed via command line. Is there any strong reason to behave differently in this case?
If not, then I would also move username/password processing to Application class next to the WebUI port processing.

#### My rationale for the above and for the naming scheme
It depends on the semantics you want to give. These cmd switches make persistent edits to the config file. They aren't meant to be seen as temporary overrides of the config.
So I want to consider them as another mode of operation. Aka `edit config` vs `normal mode`.
I don't feel strongly about that. If you insist I'll make the necessary changes."
1478295585,18735,glassez,2023-03-21T17:18:07Z,"> I want to consider them as another mode of operation. Aka `edit config` vs `normal mode`.

This is a good idea in itself, IMO (something similar has occurred to me). But it contradicts the current semantics, so I object to it.
Such different ""modes of operation"" could be introduced in one of major update."
1478418339,18735,sledgehammer999,2023-03-21T18:47:49Z,ΟΚ. I'll push the requested changes later.
1478492780,18735,Chocobo1,2023-03-21T19:50:46Z,"> > We don't exit app when Web UI port is changed via command line. Is there any strong reason to behave differently in this case?
> > If not, then I would also move username/password processing to Application class next to the WebUI port processing.
> 
> #### My rationale for the above and for the naming scheme
> 
> It depends on the semantics you want to give. These cmd switches make persistent edits to the config file. They aren't meant to be seen as temporary overrides of the config. So I want to consider them as another mode of operation. Aka `edit config` vs `normal mode`. I don't feel strongly about that. If you insist I'll make the necessary changes.

Other than the 'semantics', passing sensitive information via commandline parameters (especially to a long-time running program) is a very bad idea. For example, in a multi-user machine, someone (one with enough privileges and not necessarily the root) could easily see all your commandline parameters in clear text. And also the sensitive information is in clear text in memory (in argv list) *for a long time* which is also a bad practice.

IMO using `edit config` mode changing the user/password make sense and is a lot better than `normal mode`. I.e. throw away the sensitive data the sooner the better.
"
1478715619,18735,sledgehammer999,2023-03-21T23:15:36Z,">For example, in a multi-user machine, someone (one with enough privileges and not necessarily the root) could easily see all your commandline parameters in clear text. And also the sensitive information is in clear text in memory (in argv list) for a long time which is also a bad practice.

In that threat model, such privileged users already own you because they can easily either edit your config file or monitor your traffic. Am I wrong?

However, your comment reminded me of another possible leak: bash history files. They record each command you give via the terminal. This would require a totally different approach for configuring the password. eg Having qbt to wait for user input in the terminal. Personally I cannot code this in a reasonable timeframe."
1478741136,18735,sledgehammer999,2023-03-21T23:58:15Z,">in a multi-user machine, someone (one with enough privileges and not necessarily the root) could easily see all your commandline parameters in clear text.

After doing a bit of research, it seems you don't need [any privileges](https://unix.stackexchange.com/questions/8223/can-other-users-view-the-arguments-passed-to-a-command) to achieve this. So it is valid threat concern."
1478928689,18735,glassez,2023-03-22T05:14:47Z,"> > in a multi-user machine, someone (one with enough privileges and not necessarily the root) could easily see all your commandline parameters in clear text.
> 
> After doing a bit of research, it seems you don't need [any privileges](https://unix.stackexchange.com/questions/8223/can-other-users-view-the-arguments-passed-to-a-command) to achieve this. So it is valid threat concern.

So I think you shouldn't provide it in this PR."
1479016433,18735,sledgehammer999,2023-03-22T07:04:54Z,">So I think you shouldn't provide it in this PR.

What do you mean? Should I drop the cmd arguments commit?"
1479219768,18735,glassez,2023-03-22T09:41:36Z,"> > So I think you shouldn't provide it in this PR.
> 
> What do you mean? Should I drop the cmd arguments commit?

Yes. Doesn't it look like you're covering up one vulnerability with another? Of course, CLI is intended not only to be used from a shell like bash, which will save passed parameters in its history file, and an informed user will not use it in this way. But an informed user will also not open access from the outside without changing the default password..."
1479381350,18735,glassez,2023-03-22T11:19:35Z,"Maybe instead add command line parameter to set ""trusted host"" from which alongside with localhost) a login using default credentials is accepted?"
1480015688,18735,sledgehammer999,2023-03-22T17:53:18Z,">Yes. Doesn't it look like you're covering up one vulnerability with another?

I asked because your comment was vague for me. I wasn't sure what you were suggesting to do.

I have removed the commits about cmd arguments. Altered a string in the first commit and made a constant out of the default password (new commit).

>Maybe instead add command line parameter to set ""trusted host"" from which alongside with localhost) a login using default credentials is accepted?

This would require a bit of work than I can't do now. In any case, I would prefer devoting the extra time in implementing(https://github.com/qbittorrent/qBittorrent/pull/18735#issuecomment-1478715619):
>eg Having qbt to wait for user input in the terminal."
1480021438,18735,sledgehammer999,2023-03-22T17:57:55Z,"### Solution for manually editing the config file for the credentials

Simply change the **Username** to something other than ""admin"" and it will let you login remotely with the new username and the old (default) password.
**AFTER DOING THAT**: Immediately log into qbittorrent and CHANGE YOUR PASSWORD TOO.
PS: The username is saved under the key `Preferences/WebUI/Username`

(sorry for the caps)"
1480033856,18735,glassez,2023-03-22T18:06:34Z,"> Simply change the **Username** to something other than ""admin"" and it will let you login remotely with the new username and the old (default) password.

Well, looks like acceptable compromise."
1480037369,18735,glassez,2023-03-22T18:09:14Z,"> I would prefer devoting the extra time in implementing([#18735 (comment)](https://github.com/qbittorrent/qBittorrent/pull/18735#issuecomment-1478715619)):
> 
> > eg Having qbt to wait for user input in the terminal.

Is this the right solution for Docker users? (Sorry, I'm not too good at this.)"
1480091000,18735,Chocobo1,2023-03-22T18:49:09Z,">Is this the right solution for Docker users? (Sorry, I'm not too good at this.)

No. Users run qbt-nox on headless machine so there won't be console unless they really work for it and sometimes it is just impossible.

One solution I can think of is to present the WebUI users a ""change password"" dialog after loading the private/index.html. That is, it will immediately check whether the username/password is still the default and if it is jump out a ""change password"" dialog. As how to check whether username/password is still default, it could be a new web api endpoint or just reuse some existing one.
This solution mostly affect/protect users whom are using the official webui and thus we should also advocate 3rd party webui implementations to do the same by mentioning it on the News section of our website.

Also this issue has been there for a long time and of course it should be solved eventually but IMO it is not that urgent we need it in the upcoming 4.5.3 release."
1480380567,18735,sledgehammer999,2023-03-22T23:25:26Z,">One solution I can think of is to present the WebUI users a ""change password"" dialog after loading the private/index.html. That is, it will immediately check whether the username/password is still the default and if it is jump out a ""change password"" dialog. As how to check whether username/password is still default, it could be a new web api endpoint or just reuse some existing one.
This solution mostly affect/protect users whom are using the official webui and thus we should also advocate 3rd party webui implementations to do the same by mentioning it on the News section of our website.


This sounds like a lot of intervention in the various code places to accommodate this behavior.
IMO, we should strive for the simplest possible solution (code-wise).

I am just throwing ideas here. I would like this PR to be approved/merged as-is. My new idea for discussion:
Have an explicit cmd arg `--allow-remote-login-with-default-credentials`."
1480570177,18735,Fijxu,2023-03-23T04:02:21Z,"Good change, I remember some day to enter in a empty Qbittorrent Web Server from the internet and I leaved a note with a torrent saying to the owner something like ""change the default password or something"" I still don't understand why people don't protect their things on the internet. Someday people like me will find out a service with default credentials. It's not ultra secret "
1480587518,18735,glassez,2023-03-23T04:29:45Z,"> One solution I can think of is to present the WebUI users a ""change password"" dialog after loading the private/index.html. That is, it will immediately check whether the username/password is still the default and if it is jump out a ""change password"" dialog. As how to check whether username/password is still default, it could be a new web api endpoint or just reuse some existing one.
> This solution mostly affect/protect users whom are using the official webui and thus we should also advocate 3rd party webui implementations to do the same by mentioning it on the News section of our website.

I would not call it a convenient or reliable solution.
I think that, after all, the key aspect of solving the problem is the restriction on access from external addresses, otherwise there is a greater chance that the attacker will be the first to log in using the default credentials. The same applies to `--allow-remote-login-with-default-credentials`.
The only problem is cases like using Docker, when the user cannot log in from the localhost. That's why I suggested providing an opportunity to set a ""trusted host"" via command line parameter."
1480635660,18735,Chocobo1,2023-03-23T05:47:18Z,">I am just throwing ideas here. I would like this PR to be approved/merged as-is. 

Sadly, this change alone would block remote users from logging in new docker installations. Reasons already stated in previous posts. The commit is good but on a whole *it will need more before an official release*.

>That's why I suggested providing an opportunity to set a ""trusted host"" via command line parameter.

Compared to messing with comandline parameters (which is unexpected and cumbersome for docker users, they just want to deploy and login/use it), it is convenient. Note that *not* all docker users are power users, some of them might just use a mouse to install qbt docker image from some management interface.
Also I suspect nox users (not just docker users) would just abuse that commandline param and still uses the default credentials.
"
1480663122,18735,Chocobo1,2023-03-23T06:27:13Z,">The commit is good but on a whole it will need more before an official release.

I reckon it would be best that we have more mechanisms applied (as long as they don't step on each other) since each of them has a different goal. And sole relying on just one won't be enough.

1\. Deny remote user login with default credentials
  For users with local accessibility.

2a. --allow-remote-login-with-default-credential
  An escape hatch for users without local accessibility.

2b. trusted host command line parameter
  Similar to `--allow-remote-login-with-default-credential` but safer(?) yet more cumbersome to configure for some users.

3\. Webui change password dialog
  To remind webui users to change credentials.
"
1481260012,18735,glassez,2023-03-23T14:05:37Z,"> Sadly, this change alone would block remote users from logging in new docker installations. Reasons already stated in previous posts. The commit is good but on a whole _it will need more before an official release_.

👍 
@sledgehammer999, I believe this is not a critical vulnerability to rush to fix it as soon as possible. There is a big chance that we will hurt more users than we will help if we don't think about it thoroughly. I would strongly recommend taking your time with it."
1482291329,18735,glassez,2023-03-24T05:52:51Z,"@Chocobo1 
Does a typical Docker image deployment scenario provide an initial configuration option, such as a configuration file template? Or maybe there is some initial configuration file preinstalled in the Docker image itself?"
1483848858,18735,sledgehammer999,2023-03-25T15:17:07Z,Please take a look at PR #18763. It is an alternative approach.
1483861384,18735,glassez,2023-03-25T16:18:13Z,"> @Chocobo1 Does a typical Docker image deployment scenario provide an initial configuration option, such as a configuration file template? Or maybe there is some initial configuration file preinstalled in the Docker image itself?

Why am I asking this? I think that since Docker images provides some kind of pre-installed environments, then most likely it can also include a pre-installed qBittorrent configuration file. Thus instead of the command line parameter suggested by @sledgehammer999 or me, we could simply provide such a configuration option, so that Docker image producers could include it in the pre-installed qBittorrent configuration file. I think this will be enough to start."
1483881638,18735,sledgehammer999,2023-03-25T17:49:10Z,">Why am I asking this? I think that since Docker images provides some kind of pre-installed environments, then most likely it can also include a pre-installed qBittorrent configuration file. Thus instead of the command line parameter suggested by @sledgehammer999 or me, we could simply provide such a configuration option, so that Docker image producers could include it in the pre-installed qBittorrent configuration file. I think this will be enough to start.

(docker noob here)
It can be configured to look for the config file: https://github.com/qbittorrent/docker-qbittorrent-nox/blob/main/docker-compose.yml#L31
The hard part is manufacturing a valid password value. We use PBKDF2, with a given settings (iterations, hash algo), to produce and save the password(as salted hash). It's possible to generate it via cmd commands probably, but kinda hard to find out all the necessary info."
1483883634,18735,sledgehammer999,2023-03-25T17:58:44Z,"> we could simply provide such a configuration option, so that Docker image producers could include it in the pre-installed qBittorrent configuration file

On second reading, you probably meant something else. How do you imagine this would work? What would the docker image producer provide as part of configuration?"
1483885339,18735,glassez,2023-03-25T18:06:24Z,"> On second reading, you probably meant something else.

👍 
>What would the docker image producer provide as part of configuration?

`AllowRemoteLoginWithDefaultCredential` option set to `true`.
Or `TrustedHostAddress` in case user side address can be known in advance."
1483890193,18735,sledgehammer999,2023-03-25T18:21:43Z,">AllowRemoteLoginWithDefaultCredential option set to true

What's different than the docker image simply having qbittorrent always launched with `--allow-remote-login-with-default-credential`?"
1483891708,18735,glassez,2023-03-25T18:29:36Z,"> > AllowRemoteLoginWithDefaultCredential option set to true
> 
> What's different than the docker image simply having qbittorrent always launched with `--allow-remote-login-with-default-credential`?

None. We must use the method that will be possible to apply at the stage of creating a Docker image.

EDIT:
Perhaps I was just confused by the remark that the console is unavailable (or hardly available) to Docker users. But after all, it is not necessary to set command line parameters at all. They can just be pre-configured as part of startup script."
1483900761,18735,sledgehammer999,2023-03-25T19:15:27Z,"AFAIK users run docker images from cmd like this:
```docker run <image_name>```

And they can pass arguments like this:
```docker run <image_name> --arg1 --arg2```

However, according to @Chocobo1 users can also manage/run images entirely through GUI without touching the cmd. These users will have difficulty running with cmd arguments."
1483902520,18735,glassez,2023-03-25T19:23:12Z,"> However, according to @Chocobo1 users can also manage/run images entirely through GUI without touching the cmd. These users will have difficulty running with cmd arguments.

But there still has to be some kind of startup script that runs the necessary programs when you run Docker image, for example, qBittorrent, right? Then it can pass parameters to executable if they are provided within that startup script."
1483907534,18735,sledgehammer999,2023-03-25T19:47:52Z,">But there still has to be some kind of startup script that runs the necessary programs when you run Docker image, for example, qBittorrent, right? Then it can pass parameters to executable if they are provided within that startup script.

Yes, usually the script is called [entrypoint.sh](https://github.com/qbittorrent/docker-qbittorrent-nox/blob/main/entrypoint.sh).
But, embedding the cmd argument into the script it will result in **always** calling qbittorrent with that argument. Doesn't that defeat the purpose of this PR?"
1483909664,18735,glassez,2023-03-25T19:57:40Z,"> But, embedding the cmd argument into the script it will result in **always** calling qbittorrent with that argument. Doesn't that defeat the purpose of this PR.

Yes.
I do not yet see the possibility of a more or less reliable solution if local access to qBittorrent is impossible. So I interpret this as just an opportunity to disable the suggested restrictions for such cases.
In addition, the problem being solved is less relevant for such isolated environments as Docker containers, isn't it?"
1483911897,18735,glassez,2023-03-25T20:09:20Z,"Hmm... now I've found the following sentence in qBittorrent docker page:
>Then you can login to qBittorrent-nox at: http://127.0.0.1:8080

I'm confused. Is it always true or the network configuration is still part of Docker/image config?"
1483924802,18735,sledgehammer999,2023-03-25T21:19:40Z,">I do not yet see the possibility of a more or less reliable solution if local access to qBittorrent is impossible.

That's why I opted for requiring the user to explicitly bypass the restriction via cmd args. The bypass is supposed to be temporary and explicit, hence the cmd arg. Docker user can do that easily, unless he doesn't know how to do terminal stuff at all. Personally, I don't find that latter part a blocking concern.
Also, as I personally interpret the situation, I don't see any other concern/objection to the explicit cmd arg option.

Maybe I have missed something. I don't know.

EDIT:
>That's why I opted for requiring the user to explicitly bypass the restriction via cmd args.

I mean restrict to local + have a `--allow-remote-login-with-default-credential` bypass."
1484023594,18735,Chocobo1,2023-03-26T07:55:06Z,">The hard part is manufacturing a valid password value. We use PBKDF2, with a given settings (iterations, hash algo), to produce and save the password(as salted hash). It's possible to generate it via cmd commands probably, but kinda hard to find out all the necessary info.

Not only that. What if in the future the password encryption was changed? thus having a second implementation of generating the password is a huge technical debt.

>Yes, usually the script is called [entrypoint.sh](https://github.com/qbittorrent/docker-qbittorrent-nox/blob/main/entrypoint.sh).

That script is embedded in the final docker image and therefore users cannot change it without rebuilding the whole image.
It is `docker-compose.yml` and `.env` for users to customize.

>I do not yet see the possibility of a more or less reliable solution if local access to qBittorrent is impossible. So I interpret this as just an opportunity to disable the suggested restrictions for such cases.

Indeed, I intend to always include that cmd parameter to docker images once it is ready. Note that we still need to remind users to change credentials ~~which I think #18763 should cover it (if it had the webui parts and if I'm not mistaken)~~.

>Hmm... now I've found the following sentence in qBittorrent docker page:
>>Then you can login to qBittorrent-nox at: http://127.0.0.1:8080/
>I'm confused. Is it always true or the network configuration is still part of Docker/image config?

It should be revised, I'll update it.


ps. I don't have enough time to catch up the developments so I'll reply in bulk when I'm available."
1484026802,18735,sledgehammer999,2023-03-26T08:09:13Z,">Indeed, I intend to always include that cmd parameter to docker images once it is ready. Note that we still need to remind users to change credentials

uhm, current implementation of the PR informs the user of the problem and the solution upon logging in."
1491918615,18735,bakerboy448,2023-03-31T13:21:33Z,"Why not provide an upstreams setting so users can add their own ip range.... as `localhost` and `127.0.0.1` is not going to work out well (I.e. docker)

alternatively - allow private ip / LAN ranges

having to mess around with CLI is just asking for problems"
1509846404,18735,xavier2k6,2023-04-15T14:04:58Z,It may also be advisable to look at **increasing password length requirement** from **6 characters** to **8+**
1734262768,18735,zotabee,2023-09-25T18:30:18Z,Any news?
1759224886,18735,luzpaz,2023-10-12T09:07:51Z,Time to nip this in the bud ?
1771411058,18735,sledgehammer999,2023-10-19T17:20:21Z,Closes #19738
1771686883,18735,sledgehammer999,2023-10-19T20:50:09Z,"@Chocobo1 @glassez I have rethought this and I propose a different approach

1. Upon login the server will check if default credentials are used.
2. If yes, it will allow API access only to the ""change credentials"" API(plus logout/login). Every other API request will be denied.
3. Our WebUI will recognize this and redirect to a page for changing the credentials.
4. Step 2 will happen regardless of the network from which the connection comes from.
5. (optional) Maybe consider full access on default credentials if it comes from localhost.

This implements the procedure of ""enforce a credential change upon first start of the device"". It is based on the assumption that the timeframe between program installation and first-time user interaction won't be long enough to get hijacked by an attacker. Even if it is hijacked, the user will notice it immediately because the attacker will have to change the credentials and the user won't know the new credentials and won't be able to access the UI.

This shouldn't interfere with Docker users either. Am I wrong?"
1772125946,18735,glassez,2023-10-20T05:53:45Z,"> It is based on the assumption that the timeframe between program installation and first-time user interaction won't be long enough to get hijacked by an attacker.

That's the problem.


> This shouldn't interfere with Docker users either.

Why do we put Docker at the forefront at all? This is only a special case (besides, the least sensitive), and we should eliminate the problem as a whole.
What is the problem? This is the ""default credentials"". So let's just get rid of them and force the user to set them themselves before he can use the WebUI/API. There should be no difficulty with this in any ""regular"" use case.
As for the Docker, we will leave the care of its specifics to it. If it is really problematic for the Docker user to adjust the qBittorrent configuration before running the container, then let them be set during the creation of the image itself (by image creator). Yes, it will still be ""default credentials"", although per Docker image (which as said above is less sensitive to this problem)."
1772151341,18735,sledgehammer999,2023-10-20T06:19:57Z,">So let's just get rid of them and force the user to set them themselves before he can use the WebUI/API

That's very easy to implement and enforce on the GUI version. We simply refuse to close the preferences window `if (enable.webui && !(credentials set))`.
But how do we achieve that in the headless version? (if we get rid of credentials)"
1772199264,18735,Chocobo1,2023-10-20T07:07:15Z,"I had an alternative idea:
Just generate a 6 (or 10) digit number random password at the very first launch of qbt.
In gui version, webui is by default off and when user turns it on (selected the webui checkbox), we will force the user to enter a new password via some UI widget property. I suspect we don't even need to show the random password.
In nox version. We will print the password to console and let user read it themselves.
"
1772220546,18735,glassez,2023-10-20T07:25:46Z,">I had an alternative idea

This is not an alternative idea. It basically coincides with my intention.

> In gui version, webui is by default off and when user turns it on (selected the webui checkbox), we will force the user to enter a new password

👍 


> I suspect we don't even need to show the random password.

👍 
Random password is meaningless in GUI mode. Just don't allow to enable WebUI w/o custom password is set.


> In nox version. We will print the password to console and let user read it themselves.

👍 
Like we do currently for default credentials."
1772224620,18735,sledgehammer999,2023-10-20T07:29:07Z,">In nox version. We will **print the password to console** and let user read it themselves.

Does this have any security implications that we should consider?"
1772270147,18735,glassez,2023-10-20T08:03:51Z,"> > In nox version. We will **print the password to console** and let user read it themselves.
> 
> Does this have any security implications that we should consider?

We won't be able to do anything if someone else (or malware) has access to the user's computer to read generated credentials. This is beyond our responsibility."
1772515794,18735,Chocobo1,2023-10-20T10:48:27Z,"> > In nox version. We will **print the password to console** and let user read it themselves.
> 
> Does this have any security implications that we should consider?

The password is limited to the specific user and is local to the machine so I think it is pretty safe."
1772568202,18735,sledgehammer999,2023-10-20T11:29:33Z,">We won't be able to do anything if someone else (or malware) has access to the user's computer to read generated credentials. This is beyond our responsibility.

Generally I agree but see below.

>The password is limited to the specific user and is local to the machine so I think it is pretty safe.

This will downgrade the current security offered to the user. Now we don't store the password itself but a salted hash of it.
Printing to console requires having access to the plaintext password."
1772584536,18735,glassez,2023-10-20T11:43:13Z,"> Now we don't store the password itself but a salted hash of it.
> Printing to console requires having access to the plaintext password.

It is supposed to be printed once generated, i.e. once qBittorrent is started w/o stored password. Then it is stored as usual and never be accessed as plain text. If the user did not remember it at the first launch, then he will have to reset it in the usual way, as it was previously available, i.e. clearing the saved password hash."
1772595202,18735,Chocobo1,2023-10-20T11:52:26Z,">It is supposed to be printed once generated, i.e. once qBittorrent is started w/o stored password. Then it is stored as usual and never be accessed as plain text. 

Perhaps the password can be generated every time if the user haven't updated it."
1772665114,18735,sledgehammer999,2023-10-20T12:37:27Z,">It is supposed to be printed once generated, i.e. once qBittorrent is started w/o stored password. Then it is stored as usual and never be accessed as plain text. If the user did not remember it at the first launch, then he will have to reset it in the usual way, as it was previously available, i.e. clearing the saved password hash.

It is probably easy to miss it in the first launch. And hard to debug afterwards (lots of ""hey what's the default password"" questions).

>Perhaps the password can be generated every time if the user haven't updated it.

Sounds good. However, qBt will need to track this.

I am not rejecting the above but where do we stand on the following? Provide a cmd arg for the nox version for configurin credentials (eg `--configure-web-credentials`). It will enter interactive mode asking the user to input username and password. Then write them to settings and exit."
1772680218,18735,glassez,2023-10-20T12:48:03Z,"> > Perhaps the password can be generated every time if the user haven't updated it.
> 
> Sounds good. However, qBt will need to track this.

It's not a problem, IMO. Just don't store generated password so it is always empty at start unless user set custom one and it is stored."
1772711677,18735,Chocobo1,2023-10-20T13:09:21Z,">Sounds good. However, qBt will need to track this.

There should be a field (maybe `WebUIPasswordUpdated`) that records whether user has updated the password.
If the field is non-existent/empty/`false` (or the webui hash is still the default `adminadmin`) then a random password is generated at launch and updates the webui password/hash and prints clear text password to screen. Otherwise do nothing and start qbt normally.
Once the user updates the password, this field is marked `true` (or something else, I haven't consider it thoroughly).

>It's not a problem, IMO. Just don't store generated password so it is always empty at start unless user set custom one and it is stored.

But won't you need more code to handle it at webui authentication? I suppose update the webui hash would be easier.

>Provide a cmd arg for the nox version for configurin credentials (eg --configure-web-credentials). It will enter interactive mode asking the user to input username and password. Then write them to settings and exit.

I don't consider it necessary but I don't object it either. IMO it can be done later (not a high priority) if anyone is interested."
1772995751,18735,glassez,2023-10-20T15:55:54Z,"> There should be a field (maybe `WebUIPasswordUpdated`) that records whether user has updated the password.

I believe it is better to avoid adding such an additional/temporary entry to the config file, if we can do with a variable."
1773056531,18735,glassez,2023-10-20T16:38:49Z,"The main thing now is to decide about the basic concept, and the implementation details are just details."
1773269212,18735,sledgehammer999,2023-10-20T19:11:31Z,"Let me summarize. I think there is consensus for the following:
1. Fresh install equals empty credentials. Old default credentials are treated as empty too.
2. GUI: On empty webui credentials the GUI will enforce the configuration of credentials before accepting the configuration setting ""Enable WebUI""
3. NOX: On empty webui credentials, it will create ephemeral(per session) credentials that will be output on the console/log.

That being said, I think @glassez's proposition of tracking the ""empty"" state via a variable is doable."
1773379930,18735,xavier2k6,2023-10-20T20:53:11Z,"@sledgehammer999 please take https://github.com/qbittorrent/qBittorrent/pull/18735#issuecomment-1509846404 in to account too.

Currently, the default password of `adminadmin` = 10 characters, yet we allow to lower that `default` by only requiring `6`"
1773653055,18735,glassez,2023-10-21T04:13:50Z,"> Old default credentials are treated as empty too.

I suppose there may be problems with this in some cases.
There is no problem if WebUI is disabled.
We need to think about how to behave if WebUI is enabled, but uses legacy default credentials.

Also we need to reject ""adminadmin"" from being set as password."
1773672716,18735,Chocobo1,2023-10-21T05:11:42Z,">Old default credentials are treated as empty too.
>We need to think about how to behave if WebUI is enabled, but uses legacy default credentials.

Why not detect if the password hash is still equal to `adminadmin` (the previous default hash value) and require a new password if it is.

>Also we need to reject ""adminadmin"" from being set as password.

I don't think we need to always reject it since the new default password is randomly generated. We only need to reject it when the user hasn't change it when upgrading from an older qbt version."
1773684880,18735,glassez,2023-10-21T05:54:42Z,"> Why not detect if the password hash is still equal to `adminadmin` (the previous default hash value) and require a new password if it is.

I'm not worried about how to detect this (it's not a problem), but about how to ""require a new password"" in a non-confusing way. In GUI, we could just show a dialog stating that the existing credentials are no longer valid. But what about no-GUI case? To a greater extent, I worry about systems running in non-interactive mode.
"
1773691776,18735,glassez,2023-10-21T06:26:35Z,"> I don't think we need to always reject it since the new default password is randomly generated.

What does a randomly generated password have to do with it?
I mean that ""adminadmin"" is well-known default password that is most likely to be affected by attakers. So I suggest to forbid it at all (i.e. disallow user to set such a password like any other invalid one)."
1773693332,18735,glassez,2023-10-21T06:35:03Z,"> But what about no-GUI case? To a greater extent, I worry about systems running in non-interactive mode.

Of course we will have to post a warning on the site that THE DEFAULT CREDENTIALS ARE NO LONGER VALID. Given the severity of the solved problem, the possible transitional difficulties of users can be considered as negligible."
1773698227,18735,Chocobo1,2023-10-21T06:58:52Z,">I worry about systems running in non-interactive mode.

I presume users would have to check the logs. In fact they do it often when qbt service is not up. AFAIK some service manager will redirect stderr/stdout to their own log.

>I mean that ""adminadmin"" is well-known default password that is most likely to be affected by attakers. So I suggest to forbid it at all (i.e. disallow user to set such a password like any other invalid one).

I don't insist but I don't favor disallowing ""adminadmin"" as a password if some dumb user really wants it to be (or they could have their reasons). I don't like being  a nanny for users.
Also note that another reason I dislike complicating setting/getting passwords is because potential [timing attacks](https://en.wikipedia.org/wiki/Timing_attack) that might creep in..."
1773703618,18735,glassez,2023-10-21T07:20:58Z,"> I don't favor disallowing ""adminadmin"" as a password if some dumb user really wants it to be (or they could have their reasons). I don't like being a nanny for users.
> Also note that another reason I dislike complicating setting/getting passwords is because potential [timing attacks](https://en.wikipedia.org/wiki/Timing_attack) that might creep in...

Reasonable enough, IMO."
1773742726,18735,sledgehammer999,2023-10-21T10:13:41Z,"I am in favor of disabling ""adminadmin"" for existing users. This is  a security fix and a breakage of sorts is warranted. Also it is most likely a mistake for the user to have webui enabled and default credentials.
Otherwise we will complicate things on our side unnecessarily.

On the WebUI front we can leverage the response to `/api/v2/auth/login`. Now it responds with `200` and a string reading `Fails` when credentials are wrong. We could return a detailed string about the ephemeral credentials and make the WebUI display that."
1773743132,18735,sledgehammer999,2023-10-21T10:15:31Z,">Of course we will have to post a warning on the site that THE DEFAULT CREDENTIALS ARE NO LONGER VALID. Given the severity of the solved problem, the possible transitional difficulties of users can be considered as negligible.

In fact, I'll put a similar warning to the news page now that I'll make the 4.6.0 release. ""DONT USE DEFAULT CREDENTIALS FOR THE WEBUI. THEY WILL BE DISABLED IN A FOLLOWING RELEASE""."
1777573797,18735,staze,2023-10-24T16:13:44Z,"> * Upon login the server will check if default credentials are used.
> * If yes, it will allow API access only to the ""change credentials"" API(plus logout/login). Every other API request will be denied.
> * Our WebUI will recognize this and redirect to a page for changing the credentials.
> * Step 2 will happen regardless of the network from which the connection comes from.
> * (optional) Maybe consider full access on default credentials if it comes from localhost.

I think this idea has been altered, but wanted to say, I think the issue with this is users may not know what enabling web gui does, so they may enable and never go change it. allowing change credentials via the API, or web interface, when the default password is still set would let an attacker change the password using the default. =/"
1780438835,18735,glassez,2023-10-26T05:27:48Z,Superseded by #19777.
84645098,2757,pmzqla,2015-03-22T16:19:50Z,"> I need help for localization (how to add lines to translation files?), code review and suggestons for improvements.

For the translations you need to use `lupdate`, but usually sledgehammer takes care of it and updates everything.

I can see in your screenschot that the speed is displayed differently from the rest of the application. You could use `misc::friendlyUnit(qreal val, bool is_speed)`, or use `tr(KiB/s)`.
"
84649635,2757,onto,2015-03-22T16:34:02Z,"> I can see in your screenschot that the speed is displayed differently from the rest of the application. You could use  `misc::friendlyUnit(qreal val, bool is_speed)` , or use  `tr(KiB/s)` .

Fix it.
"
85078363,2757,sledgehammer999,2015-03-23T16:29:10Z,"Don't worry about the translations. I'll generate them when I merge your code.
The only thing I want to say is based on the screenshot: I think you need to draw gridlines too, otherwise the graph seems useless IMO.
About the code: Currently I am trying to finish up v3.2.0, so I can't review it at the moment. If it works, then at most my review will concern only bad code design(if any).
"
85116509,2757,onto,2015-03-23T17:34:18Z,"Thanks for response.
I was think about gridlines, will add them.
"
85608090,2757,onto,2015-03-24T17:25:19Z,"Better?
![- 24 03 2015 - 21 21 07](https://cloud.githubusercontent.com/assets/768585/6808201/318a70f4-d26c-11e4-93c8-d84d772499b4.png)
"
85692900,2757,sledgehammer999,2015-03-24T21:13:24Z,"Yes!
"
86149932,2757,onto,2015-03-25T17:59:35Z,"Added.
"
86555111,2757,ngosang,2015-03-26T15:01:07Z,"I love it. Just two comments:
1) The drop down box always show ""total uploaded"" even when you don't have selected that checkbox.
![](http://i.imgur.com/crrqPRK.png)
2) The legend is behind the graph lines.
![](http://i.imgur.com/soYxIZG.png)
![](http://i.imgur.com/htjINsB.png)
In other clients it's in front of (it's just an example, I don't like the white background)
![](https://community.bt.com/t5/image/serverpage/image-id/24894i9F08C1EEA7F57900?v=mpbl-1)
"
86651218,2757,onto,2015-03-26T18:09:42Z,"I try to add transparent background to legend:
50%:
![- 26 03 2015 - 22 03 41](https://cloud.githubusercontent.com/assets/768585/6853447/a9312a8c-d404-11e4-9849-e34927454381.png)
75%:
![- 26 03 2015 - 22 07 16](https://cloud.githubusercontent.com/assets/768585/6853454/b2ce8d3c-d404-11e4-8c75-8c84170280ae.png)
Which is better?
"
86653650,2757,ngosang,2015-03-26T18:15:03Z,"50% for me.
Can you try to make the lines of the grid thinner?
"
86669279,2757,onto,2015-03-26T18:54:24Z,"Paint gridlines without antialiasing:
![- 26 03 2015 - 22 52 56](https://cloud.githubusercontent.com/assets/768585/6854460/eba89f84-d40a-11e4-8147-abb9d7a3c8d2.png)
"
86676808,2757,ngosang,2015-03-26T19:15:49Z,"Looks perfect to me.

What about?

> 1) The drop down box always show ""total uploaded"" even when you don't have selected that checkbox.
"
86678071,2757,onto,2015-03-26T19:19:03Z,"I will try to fix it ASAP.
"
87423136,2757,onto,2015-03-29T14:52:48Z,"I change combobox to button with menu, looks better at my opinion:
![1](https://cloud.githubusercontent.com/assets/768585/6886120/9da2ee20-d644-11e4-8f72-882718a7da75.png)
"
87429032,2757,ngosang,2015-03-29T15:41:49Z,"Can you rebase?
"
87437183,2757,onto,2015-03-29T16:33:27Z,"Rebased
"
87438827,2757,sledgehammer999,2015-03-29T16:40:55Z,"You should squash/fixup similar commits into one. Or commits that fix a problem in a previous commit of **yours**.
Note: You can still have multiple commits thematically arranged.
Note: `git rebase -i <commit hash>` is your friend(and then `git push --force`). If you need instructions I'll gladly tell you.
"
87442733,2757,ngosang,2015-03-29T16:51:35Z,":+1: For me it's ready to merge. 
Just one detail. I deleted qBittorrent.conf to test how it looks in a fresh install and by default all graphs are displayed. I think it's better to show only ""total download"" and ""total upload"".
"
87450473,2757,onto,2015-03-29T17:57:31Z,"May be commits need to ""squash"" into one commit (or two)? Because all of them (exclude last) are fixes (and code rewriting) of previous commits.
"
87452144,2757,sledgehammer999,2015-03-29T18:13:25Z,"If they fix only one commit then squash them together(or probably use 'fixup').
Otherwise, squash relevant commits together.
"
87452293,2757,sledgehammer999,2015-03-29T18:14:10Z,"If I confused you: Commits that fix a certain commit should be squashed into the same commit.
"
87455085,2757,onto,2015-03-29T18:51:39Z,"I hope I understood you correctly
"
87462079,2757,sledgehammer999,2015-03-29T19:45:58Z,"Now that I see the remaining comits: merge them into one.
"
87736700,2757,onto,2015-03-30T16:06:31Z,"Travis CI failed due to network errors, but it buildable.
"
87740869,2757,sledgehammer999,2015-03-30T16:21:10Z,"Yes. Don't worry. github is under DDOS for a week now :(
Anyway, I might be able to squeeze this in for v3.2.0 instead.
"
108960607,2757,Chocobo1,2015-06-04T16:36:42Z,":+1: for this.
BTW, it would be best if the text strings can be capitalized, e.g. `total upload -> Total Upload` in both menu item and graph, and the `Select graphs` button.
"
108989917,2757,onto,2015-06-04T17:48:48Z,"Two variants:
![1](https://cloud.githubusercontent.com/assets/768585/7990571/eecd8876-0b02-11e5-9498-2a31b7fe8ea5.png)
![2](https://cloud.githubusercontent.com/assets/768585/7990574/f50002a0-0b02-11e5-9a72-f1981b7fd364.png)
at my opinion second looks better.
"
108994251,2757,Chocobo1,2015-06-04T18:06:02Z,"Mmmm... I guess the second is a bit better, but IMO the button still should be `Select Graphs`.
"
109006537,2757,onto,2015-06-04T18:51:13Z,"![_2015-06-04_22-32-56](https://cloud.githubusercontent.com/assets/768585/7991529/caf332e6-0b09-11e5-956c-6edfe7f60a5e.png)
"
109150384,2757,Chocobo1,2015-06-05T03:09:17Z,":100: 
"
109391433,2757,sledgehammer999,2015-06-05T18:37:02Z,"@onto Sorry that I am late to the party. I prefer the first version. It is decided to have every word capitalized in menus/options.
"
111456148,2757,onto,2015-06-12T11:16:31Z,"@sledgehammer999  Do you mean `Total Upload`, `Total Download`, ... and `Select Graphs`?
"
111458138,2757,ngosang,2015-06-12T11:26:22Z,"He mean this with also **Select Graphs**
![](https://cloud.githubusercontent.com/assets/768585/7990571/eecd8876-0b02-11e5-9498-2a31b7fe8ea5.png)

One more thing, I don't know if you readed #3134. You need to rebase this PR to make it mergeable in master branch but you can keep this PR for the v3.2.x branch so your changes will be in the next release. Take a look at open PRs to see what I mean.
"
111476989,2757,onto,2015-06-12T12:33:25Z,"I rebase commit with current master.
"
113799497,2757,sledgehammer999,2015-06-20T18:19:40Z,"@onto Are you working on this? I would like to include it in v3.3.0 if possible.
"
113799607,2757,sledgehammer999,2015-06-20T18:20:12Z,"If you have any questions on how to do things based on our comments, just ask here.
"
113907334,2757,onto,2015-06-21T14:19:22Z,"Yes, i'll fix your suggestions ASAP. 
"
114636640,2757,onto,2015-06-23T20:45:33Z,"I do some changes regarding
https://github.com/qbittorrent/qBittorrent/pull/2757#discussion-diff-32374393
and
https://github.com/qbittorrent/qBittorrent/pull/2757#discussion-diff-32374370,
check it.

P.S. I don't find a way to forward declare template classes.
"
116300861,2757,ngosang,2015-06-28T17:18:41Z,"@sledgehammer999 he needs some help.
"
118537212,2757,fingershop,2015-07-04T17:50:24Z,"Can't wait to have this graph in qB! Please consider allowing the graph legend to be turned off, for a nice clean look. The legend is helpful at first, but after a day or two you know what the graph means, and the legend is no longer needed.
"
120767676,2757,sledgehammer999,2015-07-12T22:04:26Z,"@onto What is your status? Are you waiting for me to help you(or comment) somewhere? I cannot see where you need help.
Btw, for `speedplotview.cpp`, `speedplotview.h`, `speedwidget.cpp`, and `speedwidget.h` put a license notice at the top of file. Take a look at the one for `src/core/bittorrent/infohash.h` (don't forget to put your name(or nickname) and email instead)
"
120985325,2757,nucluster,2015-07-13T16:22:09Z,"@sledgehammer999  Hi! How I can get compiled exe-file for Windows with this speed widget? It's very needfull thing for me!
"
122073448,2757,onto,2015-07-16T20:08:24Z,"I add license notice, are sources ready to merge?
"
122097512,2757,sledgehammer999,2015-07-16T21:10:08Z,"Thanks. I'll review it tomorrow and if I don't find anything wrong I'll merge it.
"
122137084,2757,sledgehammer999,2015-07-17T00:33:03Z,"@onto I did a test compilation on Windows with MSVC2013. There is an error in `SpeedWidget::update()` due to the sleep() you use. I change it to use our sleep function `Utils::Misc::msleep(1000);` Can you do the same? My question is why do you sleep there?
Btw, how is `SpeedWidget::update()` run again?

@ everyone this speedwidget shows info session wide. However the bottom is reserved for buttons that show info per torrent. Do you have any suggestion on how to solve this discrepancy?
"
122176034,2757,Chocobo1,2015-07-17T04:57:41Z,"> Do you have any suggestion on how to solve this discrepancy?

How about adding a extending-spacer between `Content` & `Speed`, this will make `Speed` looks like right-aligned thus implying a difference.

And maybe the `Speed` can be renamed to `Graphs`.
"
122179570,2757,onto,2015-07-17T05:33:27Z,"> How about adding a extending-spacer between Content & Speed, this will make Speed looks like right-aligned thus implying a difference.

Can make like this:
![_2015-07-17_09-19-35](https://cloud.githubusercontent.com/assets/768585/8741148/2b7684b4-2c5d-11e5-95c7-3248099b6ce9.png)

but in utorrent no difference between session tabs and torrent tabs
![utorrent-21-700x386](https://cloud.githubusercontent.com/assets/768585/8741235/5e462b50-2c5e-11e5-9877-760138b8cc2f.png)

What do you think?
"
122185541,2757,glassez,2015-07-17T05:59:49Z,"qBittorrent is not utorrent!
IMO, difference between session tabs and torrent tabs should be.
"
122212272,2757,ngosang,2015-07-17T08:12:46Z,"If we put the Speed tab at top, with the Log, the user can't see the transfer list and the graph at the same time. This looks good to me:
![](https://cloud.githubusercontent.com/assets/768585/8741148/2b7684b4-2c5d-11e5-95c7-3248099b6ce9.png)
"
122219771,2757,sledgehammer999,2015-07-17T08:48:10Z,"I was thinking the same guys, but I was curious if there was another good solution.
@onto proceed with putting the button to the far right. Can you answer my other questions too?
"
122252535,2757,sledgehammer999,2015-07-17T11:38:25Z,"@onto Nevermind, I realized how `SpeedWidget::update()` is run multiple times. You have a (almost infinite)loop in there that's why you need to sleep between calls. Proceed with the above change.

@glassez do you think it is bad to sleep there?(it is a background thread anyway). 
"
122331748,2757,onto,2015-07-17T16:20:36Z,"> qBittorrent is not utorrent!

Absolutely agree, refer only for example.

> @onto Nevermind, I realized how SpeedWidget::update() is run multiple times. You have a (almost infinite)loop in there that's why you need to sleep between calls. Proceed with the above change.
> 
> @glassez do you think it is bad to sleep there?(it is a background thread anyway).

As another solution can use QTimer for this.
"
122405025,2757,sledgehammer999,2015-07-17T20:34:48Z,"> As another solution can use QTimer for this.

In my opinion this is more or less the same as sleeping, so no need to change it. This is low priority anyway.
"
122561607,2757,sledgehammer999,2015-07-18T16:30:26Z,"Thank you for the hard work.
"
122561920,2757,sledgehammer999,2015-07-18T16:32:29Z,"I have pushed some minor fixups on top of your code: https://github.com/qbittorrent/qBittorrent/commit/0b207946726e5dd9a7eb5605395b78a5f5e75c3f
"
122571115,2757,Chocobo1,2015-07-18T17:39:17Z,"Please add `QT += concurrent` in `src.pro`, it'll fix compilation error with QT5.
"
122573012,2757,sledgehammer999,2015-07-18T18:07:40Z,"> Please add QT += concurrent in src.pro, it'll fix compilation error with QT5.

Done.
"
122575079,2757,onto,2015-07-18T18:26:19Z,"> Thank you for the hard work.

Thanks for merge.
"
109561228,3150,Chocobo1,2015-06-06T09:55:41Z,":thumbsup: very useful!
I didn't test it yet, just some suggestions I thought of to make it more perfect:
- The title should be capitalized: `Peers Addition` or maybe `Add Peers` (pick one).
- The window should be resizeable vertically and horizontally as there would be potential text clipping for high DPI users, and the text edit area should follow the resize.
- Just glimpse through the code, ignore me if wrong, it seems there would be problems when validating IPv6 address, e.g. `2001:db8::ff00:42:8329`, also see: [ipv6 and port](http://serverfault.com/questions/205793/how-can-one-distinguish-the-host-and-the-port-in-an-ipv6-url).
- [QT5 only, added for note] The `Format: IPv4...` label can be removed by giving an example using [setPlaceholderText](http://doc.qt.io/qt-5/qtextedit.html#placeholderText-prop), like: `setPlaceholderText( ""1.2.3.4:20000\n[2000::45]:20000"" );`
"
109599144,3150,ngosang,2015-06-06T15:15:51Z,"> The title should be capitalized: Peers Addition or maybe Add Peers (pick one).

Changed to 'Add Peers'

> The window should be resizeable vertically and horizontally as there would be potential text clipping for high DPI users, and the text edit area should follow the resize.

Already it's.

> Just glimpse through the code, ignore me if wrong, it seems there would be problems when validating IPv6 address, e.g. 2001:db8::ff00:42:8329, also see: ipv6 and port.

Now the IPv6 format is [IPv6]:port (like in uTorrent and other apps). I changed the Copy peer function to copy the IPv6 with this format. I have tested with this IPs and it's working:

```
[2001:0DB8:0000:0000:0000:0000:1428:57ab]:3267
[2001:0DB8:0000:0000:0000::1428:57ac]:3268
[2001:0DB8:0:0:0:0:1428:57ad]:3269
[2001:0DB8:0::0:1428:57ae]:3270
[2001:0DB8::1428:57af]:3271
180.230.64.18:36500
1.186.77.9:51719
```

> [QT5 only, added for note] The Format: IPv4... label can be removed by giving an example using setPlaceholderText, like: setPlaceholderText( ""1.2.3.4:20000\n[2000::45]:20000"" );

I like it but for now we have to be compatible with Qt4. When support is dropped you could made this change in Add magnet, Add torrent... and this one.
"
109606344,3150,Chocobo1,2015-06-06T15:47:35Z,"Something missing from my last comment: 
- When an input line (IP:port) cannot be validated/read, output the problem string in the QMessageBox::warning instead of giving a general error message.

Should be a trival change. The rest is good for me!
"
109606634,3150,ngosang,2015-06-06T15:49:53Z,"I can compile in my machine but Travis fails. When you have time can you help me to fix that?
"
109606767,3150,Chocobo1,2015-06-06T15:50:38Z,"Try add `#include <QMap>` before `#include <QRegExp>` in peersadditiondlg.h
"
109608288,3150,ngosang,2015-06-06T16:08:32Z,"> When an input line (IP:port) cannot be validated/read, output the problem string in the QMessageBox::warning instead of giving a general error message.

![](http://i.imgur.com/GJ9SUC7.png)

Thanks
"
109613901,3150,Chocobo1,2015-06-06T16:28:13Z,"(Don't forget to capitalize the title)
"
109625611,3150,ngosang,2015-06-06T17:56:09Z,"> (Don't forget to capitalize the title)

I think it's not necessary. There is other MsgBox with the title ""No peer entered"". No Peer Entered???
"
111382594,3150,glassez,2015-06-12T06:49:00Z,"> > [QT5 only, added for note] The Format: IPv4... label can be removed by giving an example using setPlaceholderText, like: setPlaceholderText( ""1.2.3.4:20000\n[2000::45]:20000"" );
> 
> I like it but for now we have to be compatible with Qt4. When support is dropped you could made this change...

And why not make different versions for Qt4/Qt5 using conditional compilation directives.
If you do not use the advanced capabilities of Qt5, then we do not proceed to use it. There is always a lot of people who will say, ""Why do we need Qt5, because everything works fine?"".
"
111437530,3150,ngosang,2015-06-12T10:11:54Z,"I'm not opposing, just saying that in other windows the help is displayed in this way (in Qt4 and Qt5). See Add magnet, Add torrent... If I make this dialog looks different in Qt5 and the other windows have the old style will be weird.
Anyway if you want I can make the changes.
"
111438463,3150,Chocobo1,2015-06-12T10:16:46Z,"It won't be the first inconsistency (if you made the change) in this program.... just joking.
Thinking differently, this could be the first example for following UI fixups.
"
111442835,3150,glassez,2015-06-12T10:35:32Z,"> Thinking differently, this could be the first example for following UI fixups.

Join this.
Besides, you could change other windows too (if you want, of course).
"
111446621,3150,glassez,2015-06-12T10:50:24Z,"> I'm not opposing, just saying that in other windows the help is displayed in this way (in Qt4 and Qt5)

By and large, we now have only ""compatible"" with Qt5. We almost never use its ""charms"", as compatibility has come recently (I mean in master). But every time we add to the code something new, it's an excuse to try a new approach this new thing and remake similar to it old ones.
"
111447026,3150,ngosang,2015-06-12T10:52:18Z,"I'm making the changes but I don't know if **[2000::45]:20000** is a good example. Can you give me other?
![](http://i.imgur.com/qfoQhGF.png)
"
111457390,3150,glassez,2015-06-12T11:22:57Z,"IP addresses around us.
For example, fdb1:9973:dbba:0:ca6c:87ff:fe3f:8133.
"
111469119,3150,Chocobo1,2015-06-12T12:04:27Z,"Is this better? (text in setPlaceholderText)

```
Format: IPv4:Port / [IPv6]:Port
Example:
1.2.3.4:1234
[2001:0db8::1428:57af]:4321
```

Pardon me, if I contradict my previous post.

Or just have the same layout as Qt4 version, but with the additional text in setPlaceholderText?

```
Example:
1.2.3.4:1234
[2001:0db8::1428:57af]:4321
```

(Can't make up my mind...)
"
111472861,3150,ngosang,2015-06-12T12:11:05Z,"I'm going to use this:

```
Example:
198.51.100.1:20000
[2001:f0d0:1002:51::4]:20000
```

Without the label ""Format: IPv4:Port / [IPv6]:Port"" in Qt5 version.
"
111489328,3150,ngosang,2015-06-12T13:17:30Z,"rebased
"
111731708,3150,sledgehammer999,2015-06-13T17:15:03Z,"Don't forget to delete the peeraddition.cpp file and also remove it from the relevant .pri.
Btw, this is eligible for v3_2_x backporting.
"
111742215,3150,sledgehammer999,2015-06-13T19:29:17Z,"@ngosang I have answered to your questions already. Please reload the pages from github so you can view my comments. Sometimes github is stupid.
"
111751902,3150,ngosang,2015-06-13T20:51:23Z,"I did all changes you suggested.
@glassez I tried to simplify things, take a look.
@sledgehammer999 I did the backport with the old code #3150 but I'm not going to do more changes into it. The code is a mess but it works well. We all are making efforts in backport the code but it's necessary? How long will take the 3.3.0 release?
"
111754232,3150,sledgehammer999,2015-06-13T21:38:16Z,"> How long will take the 3.3.0 release?

It depends. There are stuff to be done. Like ensure a proper migration from the old BT_backup files to the new files... And I am sure glassez wants to put some more changes in before releasing.
"
111754743,3150,sledgehammer999,2015-06-13T21:47:51Z,"> We all are making efforts in backport the code but it's necessary?

If something is difficult to backport then it should be left in master only. Normally I'll request simple things to be backported.
"
111755216,3150,ngosang,2015-06-13T21:57:35Z,"> Normally I'll request simple things to be backported.

You can take a look at the old code, it's completely different. I let you 2 comments.
"
111755633,3150,ngosang,2015-06-13T22:10:31Z,"> I made the port always compulsory (as it's in the format label) because there isn't a default port. Each client has his own default port and most of them chose the port randomly.

![](http://i.imgur.com/c6uNoIg.png)
"
111757549,3150,sledgehammer999,2015-06-13T22:28:29Z,"For me that's the last comment. I'll also wait for @glassez to say if it is ok, since he participated in the review.
(making the port compulsory is correct).
"
111788379,3150,glassez,2015-06-14T06:40:27Z,"> Like ensure a proper migration from the old BT_backup files to the new files..

I think this is the only blocking issue. There are already enough changes for a new release.

> And I am sure glassez wants to put some more changes in before releasing.

Yes, my mission is not finished yet. But now it is not large. I want to do this gradually so as not to affect the release cycle.
Only new GeoIP Manager is for 3.3.0 release. And current PR's (those that I will publish before the release).
"
111800413,3150,ngosang,2015-06-14T08:38:47Z,"This PR is ready.
I prefer not delay much the release of version 3.3.0. I think we are trying to be too ambitious including too much in each release but meanwhile there are many known bugs in the stable releases. The most important softwares release a version every X months regardless of whether it contains many changes because the important thing is the bugs are fixed in a bounded time.
"
111864074,3150,sledgehammer999,2015-06-14T18:51:53Z,"@glassez I am ready to merge. OK?
"
111979307,3150,ngosang,2015-06-15T08:37:58Z,"if @glassez is not able to find more problems it's finished.
"
113915729,3150,ngosang,2015-06-21T15:41:37Z,"Changed.
"
113941643,3150,ngosang,2015-06-21T18:58:54Z,"Changed.
"
116299952,3150,ngosang,2015-06-28T17:11:57Z,"@sledgehammer999 I think this is ready (if you don't have more changes). About the v3.2.0 PR #3196 I prefer to not merge that, you can close if you want.
"
121408433,3150,ngosang,2015-07-14T22:15:13Z,"With the last commit Contol+C copies in format IP:Port instead of IP only.

@sledgehammer999 is there any reason to not merge?
"
122649523,3150,sledgehammer999,2015-07-19T11:01:31Z,"@ngosang Rebase. Also edit your commits to include the bug numbers.
PS: Don't spam multiple ""Closes"" in them. Just use `Closes #<num>, #<num> and #<num>`. I know it will auto-close only the first one. I'll close the rest. It is ugly to use multiple ""Closes"".
"
122650953,3150,ngosang,2015-07-19T11:37:55Z,"@sledgehammer999 ready.
"
122671930,3150,sledgehammer999,2015-07-19T15:32:52Z,"Thanks for this. If it is easily backported, please do so.
"
609751254,12434,glassez,2020-04-06T12:01:02Z,https://github.com/qbittorrent/qBittorrent/pull/12043#pullrequestreview-363194074
609770726,12434,FranciscoPombal,2020-04-06T12:42:56Z,"@glassez 

> [#12043 (review)](https://github.com/qbittorrent/qBittorrent/pull/12043#pullrequestreview-363194074)

Fixed."
615405985,12434,FranciscoPombal,2020-04-17T18:47:50Z,@Chocobo1 I removed the leniency changes. Now this is just about logging more stuff in the embedded tracker.
615850916,12434,FranciscoPombal,2020-04-18T11:51:49Z,"@glassez 
> I wouldn't merge such changes until Logger is redesigned to level-based form. Otherwise, it can generate a whole bunch of messages that can't be filtered out (I mean completely ignored, not only removed from the log list in GUI, as we allow now).
> IMO, such messages should be of Debug level since they indicates client errors that won't affect the app workability.

We don't know how long it will take until the logging is redesigned. It could take a long time. In the meantime, I think this is a relatively small change that can come in very handy when diagnosing issues with the embedded tracker. Otherwise, every time I try to solve a problem with the embedded tracker, I basically have to ask the bug reporter for a wireshark capture (not a realistic request for the majority of the users). With this change, hopefully solve the issue with just the information in the logs.

Plus in terms of code structure this is pretty trivial to change/undo when the logging is finally redesigned."
615856507,12434,glassez,2020-04-18T12:15:57Z,">We don't know how long it will take until the logging is redesigned. It could take a long time. 

It can be done quickly as soon as we reach any agreement on it. But for some reason this topic is ignored..."
615857177,12434,glassez,2020-04-18T12:19:00Z,">Plus in terms of code structure this is pretty trivial to change/undo when the logging is finally redesigned.

Well, I'll approve it unless my objections are supported by someone else."
615904138,12434,glassez,2020-04-18T17:02:05Z,">And before you ask, currently I don't have opinions about the redesign of logger.

Do you have any idea what I'm talking about (have you read my suggestion about it elsewhere)? If so, does your answer here mean that you are simply neutral about it, so that you have no fundamental objection to changing it?"
615907876,12434,Chocobo1,2020-04-18T17:26:23Z,">Do you have any idea what I'm talking about (have you read my suggestion about it elsewhere)? 

No, I don't have a complete picture, please remind me about it."
615965149,12434,FranciscoPombal,2020-04-18T22:31:33Z,"@Chocobo1
> IMO logging client error is out of the scope for a (small) embedded server. The current server already sent back proper error message to offending clients and I think the debugging (and therefore logging) should happen at the client side (as that is where the error originates, at least for the errors you're logging in this PR).
> Personally I don't think this PR is a good idea and won't support it, but I don't mind if other devs agree with this PR (i.e. there will be no hard block from me).
> 
> And before you ask, currently I don't have opinions about the redesign of logger.

I thought about it some more, and I think you are mostly right. I will remove the logging of the request params errors, as it is somewhat redundant at the end of the day. However, I still think logging the IP/protocol stuff at the tracker side is very useful for diagnosing potential problems. The potential IPv4-mappend IPv6 -> IPv4 conversion is information that is not available anywhere else short of debugging the program, for example."
616038672,12434,glassez,2020-04-19T05:27:30Z,">No, I don't have a complete picture, please remind me about it.

I suggest to use log message types based on verbosity levels instead of current ""flat"" (and mostly confusing) typification:
1. We define several verbosity levels, e.g. (starting from most verbose) Debug, Info, Warning, Critical.
2. We assign level to log message according to its relevance.
3. We allow to set Log level threshold via settings.
4. Log just ignores all messages that have more verbose level that configured threshold (i.e. it doesn't store such messages and it doesn't notify about them). E.g. if ""Warning"" level is set as threshold only ""Warning"" and ""Critical"" messages will be processed.

With this architecture, we can easily add more messages (even diagnostic ones) without fear of overloading the productive configuration (which is supposed to have a threshold higher than Debug)."
616043437,12434,Chocobo1,2020-04-19T05:49:22Z,"In general, I feel like it is quite similar to what we are using currently.

>E.g. if ""Warning"" level is set as threshold only ""Warning"" and ""Critical"" messages will be processed.

As a user, I would like to have the ability to select verbosity levels independently, there might be some kind of message in some level that I'm interested in and other levels doesn't interest me.

As for your earlier comment:
>Otherwise, it can generate a whole bunch of messages that can't be filtered out (I mean completely ignored, not only removed from the log list in GUI, as we allow now).

Currently logger stores all log messages without filtering them, I don't mind we change this.
"
616046453,12434,glassez,2020-04-19T06:01:35Z,">As a user, I would like to have the ability to select verbosity levels independently.

Seems you don't understand it. From the Log perspective any level contains messages from all previous (less verbose) levels. It seems meaningless to store, e.g., only ""Debug"" messages.
But we can preserve current filtering at the UI side so user can see only selected message types (of course from the subset that is provided by logger according to selected threshold)."
616053786,12434,Chocobo1,2020-04-19T06:31:29Z,">Seems you don't understand it. From the Log perspective any level contains messages from all previous (less verbose) levels. It seems meaningless to store, e.g., only ""Debug"" messages.

I simply don't like to be forced to show levels that I don't want. What if I really want to suppress warning level but still want info & critical levels? The verbosity hierarchy (or threshold) you presented is quite limited and inflexible from a user viewpoint.

>With this architecture, we can easily add more messages (even diagnostic ones) without fear of overloading the productive configuration 

I admit I don't understand what this has to do with verbosity hierarchy. Basically you just need to filter the messages according to its level at `Logger::addMessage()` and add an off by default `debug` level.

And that is enough about my opinion, maybe you should wait for others opinion too (I really don't mind changing it if the majority agrees).
"
616055706,12434,Chocobo1,2020-04-19T06:39:03Z,">But we can preserve current filtering at the UI side so user can see only selected message types (of course from the subset that is provided by logger according to selected threshold).

If this is possible then I suppose I'm fine with it."
616064071,12434,glassez,2020-04-19T07:16:55Z,">I simply don't like to be forced to show levels that I don't want. What if I really want to suppress warning level but still want info & critical levels?

I talk about core Log architecture. And I didn't invent it, it's widely used (to be honest, I've always wondered where qBittorrent log structuring came from). It even seems to follow the general principle of verbosity, used not only in logging. From this perspective, it is useless to cut out any particular layer of messages.
>What if I really want to suppress warning level but still want info & critical levels?

What's the point to store, e.g., only Info messages? What can you use them for?
The point is to tell the Logger to be more verbose (or less).
E.g. a productive configuration usually does not require all messages, especially Debug ones. The debug configuration can include all of them. For example, when something starts to go wrong, the user can sacrifice performance to be able to provide more debugging information.

>The verbosity hierarchy (or threshold) you presented is quite limited and inflexible from a user viewpoint.

Looks like you're talking about a View layer after all. So my proposal is still here:
>we can preserve current filtering at the UI side so user can see only selected message types (of course from the subset that is provided by logger according to selected threshold).
"
616080945,12434,arvidn,2020-04-19T09:02:59Z,"I think the main use case for logging is to debug and troubleshoot issues. I think when enabling more verbose logging, it's almost always to trouble shoot a specific issue. Being able to narrow down which component(s) print additional logging can save a lot of log noise from unrelated parts of the program. Unrelated to the issue being trouble shot that is.

This has worked well in uTorrent (where the log tab context menu lets you check categories of logs to enable)."
617327777,12434,FranciscoPombal,2020-04-21T18:12:17Z,"@Chocobo1 @glassez 
Alright, I've addressed the comments and made a few changes to improve the embedded tracker implementation in general.

- Both the actual address and the claimed address are treated similarly now, including converting to IPv4 if they are IPv4-mapped IPv6
- From the beginning, it is guaranteed that the addresses are either pure IPv4 or pure IPv6, in order to prevent surprises with converting to QByteArray, for example
- Other minor things
- Includes only the logging changes previously agreed upon."
704969862,12434,FranciscoPombal,2020-10-07T14:21:03Z,"@glassez @Chocobo1 

Rebased on top of `master`. Thoughts on https://github.com/qbittorrent/qBittorrent/pull/12434#issuecomment-617327777?"
2115962679,20833,ManiMatter,2024-05-16T18:46:59Z,"@glassez Thanks having included this on milestone 5.0, and for having reviewed the code. I was not able to figure out how to test whether the feature works properly. Just wanted to check if you had a chance to test if it actually works?

Many thanks"
2152184449,20833,ManiMatter,2024-06-06T11:47:15Z,"@glassez - quick question, do I need to do anything here to get this merged?"
2152276785,20833,glassez,2024-06-06T12:24:00Z,"> @glassez - quick question, do I need to do anything here to get this merged?

At least it should be confirmed by someone from the team (or maybe by couple of other people) that it works as intended."
2152436797,20833,ManiMatter,2024-06-06T13:14:03Z,"Thank you for the fast response. I unfortunately did not figure out how to build a docker image from the code so that I could test it myself. 

Did you test it on your end by any chance? If so, did it work? 

Looking forward for the other people to test it (guess that is done via qbittorrent/web-developers ?)"
2153404378,20833,ManiMatter,2024-06-06T21:03:10Z,"@Chocobo1 - many thanks for your review. I incorporated your changes.

Regarding renaming: I am not sure I understand your suggestion to rename the ""isPrivate"" to ""private"" in the various places. Since the flag that is returned currently in the properties is called ""isPrivate"", I feel it makes sense to keep calling it like this, rather than changing to ""private"". What was your thinking when suggesting the rename?

In terms of functionality, did the feature work for you as expected?
"
2154887712,20833,Chocobo1,2024-06-07T13:49:08Z,">Regarding renaming: I am not sure I understand your suggestion to rename the ""isPrivate"" to ""private"" in the various places. Since the flag that is returned currently in the properties is called ""isPrivate"", I feel it makes sense to keep calling it like this, rather than changing to ""private"". What was your thinking when suggesting the rename?

It looks weird to me.
For example: `bool TorrentFilter::matchIsPrivate(const BitTorrent::Torrent *const torrent)` and without going into the internals, what is it supposed to mean? A match/matching is private... what? No, it is matching for a private flag/property on a torrent object. Using another name like `matchPrivate` (or `matchPrivateTorrent`, `matchPrivateFlag`, etc.) could avoid the confusion IMO. Look at other similar functions, they aren't that hard to read and understand: `matchState`, `matchHash`, `matchCategory`.
Another one: `TorrentFilter::TorrentFilter(..., const std::optional<bool> isPrivate)`. What does it mean for the parameter by ""is private""? Is it running a test (with some outcome) on the parameter/variable? No, I suppose the function want some state for a ""private"" flag/property. And therefore I would suggest just call it `private` (or `privateFlag`, `privateState` or something like that).

>In terms of functionality, did the feature work for you as expected?

I haven't got time to test. BTW our CI do provide build artifacts, you can use it to verify."
2154957436,20833,glassez,2024-06-07T14:25:07Z,"> And therefore I would suggest just call it `private`

:+1:
The torrent property is called ""private"". Using the Qt naming convention getter/setter methods are called `isPrivate`/`setPrivate` accordingly. But in most cases we have to refer to the original property name (i.e. without `is` prefix)."
2154962996,20833,ManiMatter,2024-06-07T14:28:03Z,"> BTW our CI do provide build artifacts, you can use it to verify.

Thank you for the pointer, which helped me find the CI artefacts.
However, I am not sure I know how to run them, would you mind pointing me in the right direction once more?

In my regular setup, I run a docker container which I pull from lscr.io/linuxserver/qbittorrent:latest. 
My take is that the artefacts from the CI do not provide a docker image, correct?

If that's the case, I'm left off with my Mac to test (which runs on Sonoma).
Under the [Mac OS checks](https://github.com/qbittorrent/qBittorrent/actions/runs/9412131179/job/25926507787?pr=20833), I see four options:
build 2.0.10 vs build 1.2.19 and GUI on vs GUI off. 
What is the difference between those?

Lastly, after downloading them and unpacking the .zip, I see there is a .dmg inside and a cmake folder. The app inside the .dmg is crossed out in my case and when trying to open it I get a message ""Not supported on this Mac"".

Appreciate your patience and help - happy to support testing.. Just need to figure out how to get the artefacts to run."
2155021051,20833,ManiMatter,2024-06-07T15:00:35Z,"mh. I changed the naming convention across the board, but now CI complains, since the word ""private"" is a reserved word in C++. Any suggestions what to do? Change to ""privateFlag""?"
2155032087,20833,glassez,2024-06-07T15:06:49Z,"> mh. I changed the naming convention across the board, but now CI complains, since the word ""private"" is a reserved word in C++. Any suggestions what to do? Change to ""privateFlag""?

I couldn't imagine that you would misinterpret my comment above so much. I definitely didn't want you to change naming convention  we use. I was just stating a fact about such a convention so that you could understand where the name of the method `isPrivate` came from."
2155041684,20833,ManiMatter,2024-06-07T15:12:35Z,"sorry. new to all of this.. let me revert the commit. 
My understanding was that the suggestion was to consistently rename the ""is private"" to ""private""; I must have misunderstood.

Could you again please point me in the right direction in what sense I shall change the namings? Are we only talking about the matchIsPrivate and setIsPrivate functions to matchPrivate and setPrivate?"
2155838633,20833,Chocobo1,2024-06-08T06:39:23Z,">In my regular setup, I run a docker container which I pull from lscr.io/linuxserver/qbittorrent:latest.
My take is that the artefacts from the CI do not provide a docker image, correct?

Yes, no docker image.

>If that's the case, I'm left off with my Mac to test (which runs on Sonoma).
Under the [Mac OS checks](https://github.com/qbittorrent/qBittorrent/actions/runs/9412131179/job/25926507787?pr=20833), I see four options:
build 2.0.10 vs build 1.2.19 and GUI on vs GUI off.
What is the difference between those?

Different libtorrent versions and with GUI or not. Probably doesn't matter for you.

>Lastly, after downloading them and unpacking the .zip, I see there is a .dmg inside and a cmake folder. The app inside the .dmg is crossed out in my case and when trying to open it I get a message ""Not supported on this Mac"".

It seems our mac artifacts is for ARM. You're out of luck then...
"
2155865669,20833,ManiMatter,2024-06-08T08:07:07Z,"Many thanks for the guidance, @Chocobo1 . Besides not being 100% on the proposed renamings of the variables/functions (last post), I unfortunately do not know how to finish this PR without being able to test myself. Do you see any way that I can test (or would you know about someone who could support)?"
2157369634,20833,Chocobo1,2024-06-10T06:13:13Z,">I unfortunately do not know how to finish this PR without being able to test myself. Do you see any way that I can test (or would you know about someone who could support)?

For testing only, the easiest way is to get a windows/Ubuntu virtual machine. Then you can run the CI artifacts for these platforms.
For development, you'll need to setup properly: installing the compiler and libraries. You could read the instructions here: https://github.com/qbittorrent/qBittorrent/blob/master/INSTALL. [Homebrew](https://brew.sh/) might be of help for getting the libraries."
2158858587,20833,ManiMatter,2024-06-10T16:49:45Z,"Hi @Chocobo1 

Sorry for my questions, I feel pretty dumb. I have now installed a virtual box with Ubuntu on my Macbook, and have downloaded the Ubuntu Artefact with GUI (took ages to download despite me having a fast connection). I extracted the `qBittorrent-CI_Ubuntu-x64_GUI=ON_libtorrent-2.0.10_Qt-6.5.2/qbittorrent-CI_Ubuntu_x86_64.AppImage`, but when I click on it, nothing happens. When I try to launch it from terminal, I get the error `'cannot execute binary file'`.

Is this still because of the CPU architecture? I have a  2.8 GHz Quad-Core Intel Core i7 MacBook Pro from 2015. 

Any ideas?"
2159027425,20833,Chocobo1,2024-06-10T18:27:23Z,">(took ages to download despite me having a fast connection). 

Sometimes I abort it and re-download. Would be faster the second time. 

>Is this still because of the CPU architecture? I have a 2.8 GHz Quad-Core Intel Core i7 MacBook Pro from 2015.

Probably not. Your cpu is fine.

>I extracted the qBittorrent-CI_Ubuntu-x64_GUI=ON_libtorrent-2.0.10_Qt-6.5.2/qbittorrent-CI_Ubuntu_x86_64.AppImage, but when I click on it, nothing happens. When I try to launch it from terminal, I get the error 'cannot execute binary file'.

Did you try to give it execute permission first? `chmod +x qbittorrent-CI_Ubuntu_x86_64.AppImage`
Then run it in console: `./qbittorrent-CI_Ubuntu_x86_64.AppImage`
Also make sure you have `fuse` package installed.
"
2159046095,20833,ManiMatter,2024-06-10T18:37:46Z,"Thanks for the guidance, that has worked for me, many thanks (ie. was able to open the GUI).

I guess to be able to test the API, I need to download the non-GUI version so that I can test from the browser?"
2159080298,20833,glassez,2024-06-10T18:55:16Z,"> I guess to be able to test the API, I need to download the non-GUI version so that I can test from the browser?

This is not necessary. GUI version still provides WebUI/WebAPI if enabled in settings."
2159116325,20833,ManiMatter,2024-06-10T19:16:40Z,"Thanks again for pointing me on the right path. 

I tested it, all working as expected:
Tested with: `http://localhost:8080/api/v2/torrents/`
1. `info`: Public and Private Torrents show up, i.e., no filtering (correct)
2. `info?isPrivate`: Public and Private Torrents show up, i.e., no filtering (correct)
3. `info?isPrivate=false` (or `FALSE`, or `False` but not `0`): Only Public Torrents show up (correct)
4. `info?isPrivate=true` (or `TRUE`, or `True` but not `1`): Only Private Torrents show up (correct)
5. `info?isPrivate=XYZ` (or any other random, incorrect filter): Public and Private Torrents show up, i.e., no filtering (correct)

Content-wise, I therefore think this is ready to be merged.

You had some further suggestions as to renaming functions/variables, and to change the initialization of AnyIsPrivate.
I'm not 100% sure I understand what should be changed there - is it a must for this PR to be merged? If yes, appreciate if you once again could point me in the right direction, or if you could support with a commit for those items."
2165757142,20833,ManiMatter,2024-06-13T13:57:58Z,"@glassez, @Chocobo1  - what do you think, can we merge this?

> Thanks again for pointing me on the right path.
> 
> I tested it, all working as expected: Tested with: `http://localhost:8080/api/v2/torrents/`
> 
> 1. `info`: Public and Private Torrents show up, i.e., no filtering (correct)
> 2. `info?isPrivate`: Public and Private Torrents show up, i.e., no filtering (correct)
> 3. `info?isPrivate=false` (or `FALSE`, or `False` but not `0`): Only Public Torrents show up (correct)
> 4. `info?isPrivate=true` (or `TRUE`, or `True` but not `1`): Only Private Torrents show up (correct)
> 5. `info?isPrivate=XYZ` (or any other random, incorrect filter): Public and Private Torrents show up, i.e., no filtering (correct)
> 
> Content-wise, I therefore think this is ready to be merged.
> 
> You had some further suggestions as to renaming functions/variables, and to change the initialization of AnyIsPrivate. I'm not 100% sure I understand what should be changed there - is it a must for this PR to be merged? If yes, appreciate if you once again could point me in the right direction, or if you could support with a commit for those items.

"
2166469780,20833,ManiMatter,2024-06-13T18:06:53Z,"Thx for the commit, @glassez , much appreciated"
2167677935,20833,glassez,2024-06-14T09:55:44Z,"@ManiMatter 
Why do you pollute this PR with inappropriate commits?"
2167714782,20833,ManiMatter,2024-06-14T10:17:51Z,"> @ManiMatter Why do you pollute this PR with inappropriate commits?

Hi, still working on it. Apols. Will squash when ready. Wanted to add the ""private"" flag to the UI as well, hope that makes sense. "
2167727508,20833,glassez,2024-06-14T10:26:03Z,"> > @ManiMatter Why do you pollute this PR with inappropriate commits?
> 
> Hi, still working on it. Apols. Will squash when ready. Wanted to add the ""private"" flag to the UI as well, hope that makes sense.

IMO, it is separate thing and should be provided in its own PR."
2167729485,20833,ManiMatter,2024-06-14T10:27:11Z,"> > > @ManiMatter Why do you pollute this PR with inappropriate commits?
> > 
> > 
> > Hi, still working on it. Apols. Will squash when ready. Wanted to add the ""private"" flag to the UI as well, hope that makes sense.
> 
> IMO, it is separate thing and should be provided in its own PR.

Ok fair. Thought it may make sense to add it in this one since content-wise related. But happy to remove the commits and create a separate PR. "
2167757384,20833,ManiMatter,2024-06-14T10:44:06Z,@glassez - I have reverted the commits and created a separate PR to work on adding the private flag to the GUI. Apologies for the confusion caused. https://github.com/qbittorrent/qBittorrent/pull/20951/
2168127777,20833,Chocobo1,2024-06-14T14:06:25Z,"@ManiMatter 
From https://github.com/qbittorrent/qBittorrent/pull/20833#discussion_r1639665115
>Regardless, you should increment API_VERSION in webapplication.h due to other changes."
2168143995,20833,ManiMatter,2024-06-14T14:15:17Z,"> @ManiMatter From [#20833 (comment)](https://github.com/qbittorrent/qBittorrent/pull/20833#discussion_r1639665115)
> 
> > Regardless, you should increment API_VERSION in webapplication.h due to other changes.

done"
2171172226,20833,glassez,2024-06-16T07:57:34Z,"@ManiMatter 
Thank you!"
2171173762,20833,ManiMatter,2024-06-16T08:02:57Z,"Thx to you, @glassez and @Chocobo1 for your guidance and help, I learnt a lot"
69459133,2389,buinsky,2015-01-10T15:17:42Z,"@qbittorrent/webdev , @sledgehammer999 please review the PR.
"
69464895,2389,buinsky,2015-01-10T17:54:54Z,"I rebased the code.
"
69468729,2389,glassez,2015-01-10T19:36:08Z,"@buinsky Ты используешь QVariantHash, чтобы сравнивать списки, но при передаче конвертируешь их в списки. Это усложняет код. Что если так и передавать их, не конвертируя? Это практически не увеличит размер передаваемых данных, т.к. для измененных данных все равно приходится передавать некоторый идентификатор. При этом, списки, состоящие из простых значений (например, `labels`) можно обрабатывать и передавать как списки, не делая промежуточного преобразования в QVariantHash. Такой вариант позволит, к примеру, полностью избавиться от функции copyDataToPartialResponse().
"
69476110,2389,buinsky,2015-01-10T23:12:15Z,"> Ты используешь QVariantHash, чтобы сравнивать списки, но при передаче конвертируешь их в списки. Это усложняет код. Что если так и передавать их, не конвертируя? Это практически не увеличит размер передаваемых данных, т.к. для измененных данных все равно приходится передавать некоторый идентификатор. При этом, списки, состоящие из простых значений (например, labels) можно обрабатывать и передавать как списки, не делая промежуточного преобразования в QVariantHash. Такой вариант позволит, к примеру, полностью избавиться от функции copyDataToPartialResponse().

@glassez Если использовать QVariantList вместо QVariantHash. То нужно будет вводить функцию проверки наличия в массиве элемента с нужным ID / поиска элемента в массиве с нужным ID.

В QVariantHash удобно хранить имя ID-поля по которому можно идентифицировать элементы списка (чтобы определять какие данные удалены). Можно хранить имя ID-поля в конце или начале списка, но тогда понадобится функция наподобие copyDataToPartialResponse, которая будет проходить по всем елементам и удалять имя ID-поля в скопированных данных. Или ты предлагаешь имя ID-поля не удалять и пересылать вместе с данными?
"
69484602,2389,glassez,2015-01-11T05:48:50Z,"Нет, ты не понял. Я предлагаю обрабатывать и пересылать как списки только списки, состоящие из простых данных, например `labels`. А списки сложных данных, наоборот, не только обрабатывать, но и пересылать в виде хэш-таблиц (объектов JSON):

```
{
  torrents : {
    hash1 : {...},
   ...
    hashN : {...}
  },
  torrents_removed : [...],
  ...
}
```
"
69484848,2389,buinsky,2015-01-11T06:03:40Z,"> Нет, ты не понял. Я предлагаю обрабатывать и пересылать как списки только списки, состоящие из простых данных, например labels. А списки сложных данных, наоборот, не только обрабатывать, но и пересылать в виде хэш-таблиц (объектов JSON):

@glassez  Длина хэша - 40 байт. Не хотелось бы удлинять ответ.
"
69485148,2389,glassez,2015-01-11T06:22:01Z,"@buinsky да почему удлинять? Ты его все-равно пересылаешь для всех измененных торрентов.
"
69488904,2389,buinsky,2015-01-11T09:51:49Z,"@glassez I rebased the code. Will other comments?
"
69494247,2389,buinsky,2015-01-11T13:21:56Z,"> `hasChanges` не используется, так что ее можно убрать и отсюда и из сигнатуры всех остальных функций.

`hasChanges` используется для определения изменившихся данных.
"
69494311,2389,glassez,2015-01-11T13:24:05Z,"> `hasChanges` используется для определения изменившихся данных.

Где оно реально используется?
"
69494426,2389,buinsky,2015-01-11T13:27:53Z,"> Где оно реально используется?

``` cpp
...
        processHash(prevData[key].toHash(), data[key].toHash(), removedKeys, hash, changes);
...
        if (!changes)
            partial.remove(key);
```
"
69494553,2389,glassez,2015-01-11T13:31:24Z,"``` c++
if (!changes)
            partial.remove(key);
```

Я уже писал в комментариях, но, видимо, ты не заметил.
Это выражение бессмысленно, т.к. если `!changes` верно, то в `partial` и так нет этого ключа.
А больше `changes` нигде реально не используется и ее можно смело удалять.
"
69494795,2389,buinsky,2015-01-11T13:40:14Z,"> Я уже писал в комментариях, но, видимо, ты не заметил.
> Это выражение бессмысленно, т.к. если !changes верно, то в partial и так нет этого ключа.
> А больше changes нигде реально не используется и ее можно смело удалять.

Как же нет ключа? 

``` cpp
                processHash(prevData[key].toHash(), data[key].toHash(), removedKeys, hash, changes);
                partial[key] = hash;
```

Вторая строка. Грубо говоря `hasChanges` используется для удаления пустых объектов без изменений.
"
69495652,2389,buinsky,2015-01-11T14:10:00Z,"@glassez The code rebased.
"
69500942,2389,buinsky,2015-01-11T16:47:54Z,"@glassez Will any comments about rebased code?
"
69501333,2389,glassez,2015-01-11T16:58:24Z,"> Вторая строка. Грубо говоря hasChanges используется для удаления пустых объектов без изменений.

Зачем их добавлять?
"
69501346,2389,glassez,2015-01-11T16:58:54Z,"@buinsky Позже еще посмотрю. Пока занят.
"
69501804,2389,buinsky,2015-01-11T17:11:09Z,"> Зачем их добавлять?

Синхронизируемые данные можно представить в виде дерева. Когда обрабатываются потомки какого-то узла для них создается временный объект для хранения синхронизируемых данных, поскольку в узле невозможно сразу сказать, будут ли изменения в потомках узла. Когда прошла обработка данных потомков принимается решение: оставлять объект (изменения есть) или его можно удалить (изменений нет).
"
69502625,2389,sledgehammer999,2015-01-11T17:30:27Z,"@qbittorrent/qbittorrent-frequent-contributors Sorry for the offtopic. This is a heads up. And the only way I know to contact you.
I have something big happening in real life this week. So until Friday I will be mostly or totally inactive. I may also choose to ignore you during that period.
After Friday, unless something unforeseen happens, I'll be able to be 100% active for a while. And I'll be able to tackle most of the v3.2.0 milestone issues in that timeframe.
"
69503125,2389,glassez,2015-01-11T17:43:01Z,"> Синхронизируемые данные можно представить в виде дерева. Когда обрабатываются потомки какого-то узла для них создается временный объект для хранения синхронизируемых данных, поскольку в узле невозможно сразу сказать, будут ли изменения в потомках узла. Когда прошла обработка данных потомков принимается решения оставлять объект или его можно удалить.

Не будем далеко ходить... Разберем приведенные тобой две строчки кода:

``` c++
processHash(prevData[key].toHash(), data[key].toHash(), removedKeys, hash, changes);
partial[key] = hash;
```

Когда `processHash()` завершает работу, то переменная `hash` либо содержит пустую таблицу (значит, нет никаких изменений), либо нет (значит, изменения есть). Тогда почему бы не сделать так:

``` c++
if (!hash.isEmpty())
    partial[key] = hash;
```
"
69505096,2389,glassez,2015-01-11T18:33:15Z,"> Теоретически Hash может содержать еще один пустой Hash и тогда это условие не сработает.

Не может. Или покажите, при каких условиях это не так.
"
69539579,2389,buinsky,2015-01-12T08:23:44Z,"> Так при rid <= 0 будут передаваться все данные, как и при неверном значении rid.

@glassez Сейчас точно такое же поведение у программы. Что не так?
"
69551145,2389,glassez,2015-01-12T10:26:41Z,"> @glassez Сейчас точно такое же поведение у программы. Что не так?

Так то оно так, да не так...
Клиент первый раз хочет получить данные и отправляет `rid = 0` - какая ветвь `if - else` выполнится? А какая должна?
"
69565929,2389,buinsky,2015-01-12T12:58:47Z,"@glassez Будут еще замечания?
"
69573305,2389,glassez,2015-01-12T14:01:59Z,"@buinsky Ты, видимо, считаешь, что я придираюсь... Поверь мне - это не так. Просто я вижу в твоем коде некоторые недостатки, видимо, от неопытности. Я хочу не просто их исправить, а чтобы ты понял, в чем они заключаются. Однако, судя по твоей реакции, тебе этого не надо. Если ты считаешь, что все делаешь правильно, а я зря тебя достаю своими замечаниями, то скажи это прямо. Праздники кончились - у меня нет ни времени, ни желания что-то тебе навязывать. Просто исправим явные ошибки и пусть @sledgehammer999 примет этот PR. А мне будет легче потом все доделать.
Так что - нужны замечания или нет?
А пока ты думаешь, я укажу на явные ошибки.
"
69614512,2389,buinsky,2015-01-12T18:02:18Z,"> Так что - нужны замечания или нет?

Нужны.
"
69777948,2389,buinsky,2015-01-13T16:57:57Z,"@glassez Нужно еще что-нибудь исправить?
"
69798928,2389,glassez,2015-01-13T19:01:30Z,"Как я уже говорил - праздники кончились, а вместе с ними и свободное время...
Но нам надо разобраться с этим до конца. Осталось немного математики и здравого смысла.
Ну, во-первых, все-таки поборемся с излишней универсальностью некоторых функции. Таких у нас три - processList, processHash и processMap. Делают они одну и ту же операцию, но с разными типами данных (а именно, сравнивают два объекта одного типа и вычисляют разницу между ними). Самая основная идея здесь в том, что мы должны оперировать не с некоторыми абстрактными QVariantList, QVariantHash и QVariantMap - у нас это лишь способ представления, соответственно, списка простых данных, списка структурированных данных и самих этих структурированных данных. Не менее важно и то, что внутри функций сравнения мы имеем два объекта, можно сказать, одного класса - если это структуры, то они имеют одинаковый состав, а если списки - то они содержат элементы одинакового состава (это ведь логично - мы же не должны сравнивать, например, торрент с чем-то другим). И вот что следует из вышесказанного:
1. Проверки типа `!prevData.contains(key)` в функции `processMap` не нужны, так как `data` и `prevData` имеют одинаковую структуру (т.е. одни и те же ключи).
2. Проверки типа `prevData.isEmpty()` в функции `processMap` также не нужны (и по той же самой причине) - даже если мы будем сравнивать пустые структуры, то они будут пустыми обе, и все отработает правильно и без этих проверок (цикл просто не начнется).
3. Описанные в предыдущих пунктах проверки актуальны для `processHash`, т.к. здесь мы сравниваем два списка, а они могут содержать разное количество элементов или быть пустыми. Но (это чистая математика) `prevData.isEmpty()` здесь никак не зависит от цикла и поэтому ее нужно перенести за его пределы (чтобы не делать одно и то же n-е количество раз). Это же относится и к `processList`.

Что еще можно сказать об этих функциях... Функции, имеющие выходные параметры должны быть спроектированы так, чтобы они инициализировали эти параметры (т.е. вызывающая сторона не должна об этом заботиться). В нашем случае достаточно просто их очистить.
Получается примерно следующее:

``` c++
// Compare two structures (prevData, data) and calculate difference (syncData).
// Structures encoded as map.
void processMap(QVariantMap prevData, QVariantMap data, QVariantMap &syncData)
{
    // initialize output variable
    syncData.clear();

    QVariantList removedItems;
    foreach (QString key, data.keys()) {
        removedItems.clear();

        switch (data[key].type()) {
        case QVariant::Map:
            {
                QVariantMap map;
                processMap(prevData[key].toMap(), data[key].toMap(), map);
                if (!map.isEmpty())
                    syncData[key] = map;
            }
            break;
        case QVariant::Hash:
            {
                QVariantHash hash;
                processHash(prevData[key].toHash(), data[key].toHash(), hash, removedItems);
                if (!hash.isEmpty())
                    syncData[key] = hash;
                if (!removedItems.isEmpty())
                    syncData[key + KEY_SUFFIX_REMOVED] = removedItems;
            }
            break;
        case QVariant::List:
            {
                QVariantList list;
                processList(prevData[key].toList(), data[key].toList(), list, removedItems);
                if (!list.isEmpty())
                    syncData[key] = list;
                if (!removedItems.isEmpty())
                    syncData[key + KEY_SUFFIX_REMOVED] = removedItems;
            }
            break;
        case QVariant::String:
        case QVariant::LongLong:
        case QMetaType::Float:
        case QVariant::Int:
        case QVariant::Bool:
        case QVariant::Double:
        case QVariant::ULongLong:
            if (prevData[key] != data[key])
                syncData[key] = data[key];
            break;
        default:
            Q_ASSERT(0);
        }
    }
}

// Compare two lists of structures (prevData, data) and calculate difference (syncData, removedItems).
// Structures encoded as map.
// Lists are encoded as hash table (indexed by structure key value) to improve ease of searching for removed items.
void processHash(QVariantHash prevData, QVariantHash data, QVariantHash &syncData, QVariantList &removedItems)
{
    // initialize output variables
    syncData.clear();
    removedItems.clear();

    if (prevData.isEmpty()) {
        // If list was empty before, then difference is a whole new list.
        syncData = data;
    }
    else {
        foreach (QString key, data.keys()) {
            switch (data[key].type()) {
            case QVariant::Map:
                if (!prevData.contains(key)) {
                    // new list item found - append it to syncData
                    syncData[key] = data[key];
                }
                else {
                    QVariantMap map;
                    processMap(prevData[key].toMap(), data[key].toMap(), map);
                    if (!map.isEmpty())
                        // changed list item found - append its changes to syncData
                        syncData[key] = map;
                    else
                        // unchanged list item found - remove it from prevData
                        prevData.remove(key);
                }
                break;
            default:
                Q_ASSERT(0);
            }
        }

        if (!prevData.isEmpty())
            // prevData contains only items that are missing now -
            // put them in removedItems
            removedItems = prevData.keys();
    }
}

// Compare two lists of simple value (prevData, data) and calculate difference (syncData, removedItems).
void processList(QVariantList prevData, QVariantList data, QVariantList &syncData, QVariantList &removedItems)
{
    // initialize output variables
    syncData.clear();
    removedItems.clear();

    if (prevData.isEmpty()) {
        // If list was empty before, then difference is a whole new list.
        syncData = data;
    }
    else {
        foreach (QVariant item, data) {
            if (!prevData.contains(item))
                // new list item found - append it to syncData
                syncData.append(item);
            else
                // unchanged list item found - remove it from prevData
                prevData.removeOne(item);
        }

        if (!prevData.isEmpty())
            // prevData contains only items that are missing now -
            // put them in removedItems
            removedItems = prevData;
    }
}
```

P.S. Просьба оставить комментарии в функциях.
Те комментарии, которые перед функциями, нужно разместить перед их предварительным объявлением.
"
69838009,2389,fbarriga,2015-01-13T22:57:12Z,"It's possible to use english as lingua franca ?
"
69894530,2389,buinsky,2015-01-14T10:08:51Z,"@glassez please check comment for `getSyncMainData` function:

``` cpp
/**
 * The function returns the changed data from the server to synchronize with the web client.
 * Return value is map in JSON format.
 * Map contain the key:
 *  - ""Rid"": ID response
 * Map can contain the keys:
 *  - ""full_update"": full data update flag
 *  - ""torrents"": hash contains information about a torrents.
 *  - ""torrents_removed"": a list of hashes of removed torrents
 *  - ""labels"": list of labels
 *  - ""labels_removed"": list of removed labels
 *  - ""queueing"": priority system usage flag
 *  - ""server_state"": map contains information about the status of the server
 * The keys of the torrents hash are hashes of a torrents.
 * The value of the torrents hash contains map. The map can contain following keys:
 *  - ""name"": Torrent name
 *  - ""size"": Torrent size
 *  - ""progress: Torrent progress
 *  - ""dlspeed"": Torrent download speed
 *  - ""upspeed"": Torrent upload speed
 *  - ""priority"": Torrent priority (-1 if queuing is disabled)
 *  - ""num_seeds"": Torrent seeds connected to
 *  - ""num_complete"": Torrent seeds in the swarm
 *  - ""num_leechs"": Torrent leechers connected to
 *  - ""num_incomplete"": Torrent leechers in the swarm
 *  - ""ratio"": Torrent share ratio
 *  - ""eta"": Torrent ETA
 *  - ""state"": Torrent state
 *  - ""seq_dl"": Torrent sequential download state
 *  - ""f_l_piece_prio"": Torrent first last piece priority state
 * Server state map may contain the following keys:
 *  - ""connection_status"": conection status
 *  - ""dht_nodes"": DHT nodes count
 *  - ""dl_info_data"": bytes downloaded
 *  - ""dl_info_speed"": download speed
 *  - ""dl_rate_limit: downlaod speed limit
 *  - ""up_info_data: bytes uploaded
 *  - ""up_info_speed: upload speed
 *  - ""up_rate_limit: upload speed limit
 */
```
"
69912307,2389,glassez,2015-01-14T12:58:49Z,"> Return value is map in JSON format.
> ...
> ""torrents"": hash contains information about a torrents.

The JSON specification does not distinguish different types of data of the form ""key: value"". In JSON this is called **object**. But old _btjson_-code uses the term **dictionary**. You should use this term here.
"
69914392,2389,glassez,2015-01-14T13:18:45Z,"@buinsky I've updated my big comment with `processXXX` functions. I added more comments in functions code and improve `processHash` by removing second loop.
"
70071573,2389,buinsky,2015-01-15T11:16:10Z,"@glassez your code in your big comment doesn't properly works. So I updated only comments.
"
70074466,2389,glassez,2015-01-15T11:44:44Z,"> @glassez your code in your big comment doesn't properly works.

This is not my CODE. This is just EXAMPLE code. I wrote this ""on paper"", I'm not compile it and didn't test it - that's your job, because it is your PR. And my code is in my PR.

What and how is it doing wrong?
"
70075820,2389,glassez,2015-01-15T11:58:05Z,"@buinsky Ok. I've found it.
Replace

``` c++
if (!map.isEmpty())
    // changed list item found - append its changes to syncData
    syncData[key] = map;
else
    // unchanged list item found - remove it from prevData
    prevData.remove(key);
```

with

``` c++
// existing list item found - remove it from prevData
prevData.remove(key);
if (!map.isEmpty())
    // changed list item found - append its changes to syncData
    syncData[key] = map;
```

in my EXAMPLE of code (`processHash()`).
"
70244459,2389,buinsky,2015-01-16T12:01:54Z,"I rebased the code.
"
70407199,2389,glassez,2015-01-18T12:51:52Z,"@buinsky Thank for your work.
I haven't looked client code. Leave it to the others. Regarding comment to `getSyncMainData()` function, then let it check someone else too.
"
70407334,2389,sledgehammer999,2015-01-18T12:56:50Z,"Ok. After style is fixed I'll take a look at the diffs. (as soon as I can)
"
70407721,2389,buinsky,2015-01-18T13:10:08Z,"> Please fix indentation according to Coding Guide (see CODING_GUIDLINES.md).

@glassez , @sledgehammer999 The code rebased.
"
70408142,2389,sledgehammer999,2015-01-18T13:23:51Z,"@buinsky fix the typo in the first commit message

""Implement functions for generating partial responses of req**u**ests.""
"
70408306,2389,buinsky,2015-01-18T13:28:30Z,"> fix the typo in the first commit message

Done.
"
71030694,2389,sledgehammer999,2015-01-22T14:48:15Z,"@buinsky all else seems ok to me.
"
71087044,2389,buinsky,2015-01-22T19:55:04Z,"> Typo I think: ""torrents"": dictionary contains information about a torrents. -> ""torrents"": dictionary contains information about a torrent.

@sledgehammer999 It's not a typo. Each value of 'torrents' dictionary contains a map with info about a torrent.
"
71094091,2389,sledgehammer999,2015-01-22T20:38:26Z,"@buinsky see the bold part:

> ""torrents"": dictionary contains information about a **torrents**

Shouldn't the last word in this line read `torrent` ?
"
71104100,2389,buinsky,2015-01-22T21:38:14Z,"> Shouldn't the last word in this line read torrent ?

I'm not sure. My English isn't very good. @glassez should it be?
"
71106218,2389,sledgehammer999,2015-01-22T21:50:46Z,"> I'm not sure. My English isn't very good.

In english: ""one torrent"", ""two torrents"", ""three torrents"" etc
"
71107320,2389,buinsky,2015-01-22T21:57:18Z,"> In english: ""one torrent"", ""two torrents"", ""three torrents"" etc

@sledgehammer999  `""torrentS"": dictionary contains information about a torrentS.`
"
71108034,2389,pmzqla,2015-01-22T22:01:40Z,"Maybe you meant something like: `dictionary containing information about torrents.`?
"
71108253,2389,sledgehammer999,2015-01-22T22:02:58Z,"> Maybe you meant something like: dictionary containing information about torrents.?

This makes more sense. @buinsky in english ""a"" is the same as saying ""one"".
"
71110320,2389,buinsky,2015-01-22T22:15:33Z,"@sledgehammer999 the code rebased.
"
71110751,2389,sledgehammer999,2015-01-22T22:18:24Z,"@buinsky Thank you for the code and your time.
@glassez thanks for helping buinsky and reviewing this.
"
71110808,2389,sledgehammer999,2015-01-22T22:18:44Z,"-I am just going to let travis-ci finish the build and then merge.-
"
71478797,2389,pmzqla,2015-01-26T15:33:46Z,"@buinsky 
Something is not really clear to me.
The value of <code>rid</code> returned by <code>/sync/maindata?rid=X</code> is <code>X+1</code>. Shouldn't it be <code>X</code>?
"
71522284,2389,buinsky,2015-01-26T19:33:16Z,"> The value of rid returned by /sync/maindata?rid=X is X+1. Shouldn't it be X?

@pmzqla 

`rid` in response is ID assigned to response by server.
`rid` in request params is processed by client response ID.

Scheme: 
1) Server send `rid` (= x) to client 
2) Client confirms that it received response (send `rid` = x as request parameter to server)
"
71527344,2389,pmzqla,2015-01-26T20:01:52Z,"@buinsky 
OK, thanks.

Another question. Is it wanted that if the client never changes rid in its requests, the server doesn't do a full update?

e.g.

<pre>
sync/maindata?rid=0 -> full_update=true, rid=1
sync/maindata?rid=1 -> full_update=false, rid=2
sync/maindata?rid=1 -> full_update=false, rid=3
sync/maindata?rid=1 -> full_update=false, rid=4
...
</pre>
"
71531138,2389,buinsky,2015-01-26T20:24:06Z,"@pmzqla 

This is expected behavior. Client tells to server that it processed the response with ID = 1. And server sends only difference with that response. This because server keeps previouse response data to compare with current response untill client will send `rid` equal to current response ID or unknown ID (not previous or current).

I hope I have not confused you.
"
71532524,2389,pmzqla,2015-01-26T20:32:31Z,"OK, I just wanted to make sure this was the expected behavior.
Everything is clear now, thanks.
"
394156163,9026,Chocobo1,2018-06-03T11:38:19Z,"@sledgehammer999 
Can you give a general approval of this PR direction?"
394176056,9026,sledgehammer999,2018-06-03T17:04:10Z,I won't be able to comment until late tomorrow. Please wait a few days and don't merge.
394252464,9026,glassez,2018-06-04T06:54:40Z,PR updated.
395236798,9026,sledgehammer999,2018-06-06T22:42:03Z,Quick comment (the rest on the weekend): The *.qm files shouldn't be in the repo. They should be created during build like the regular translations do. Look at `qm_gen.pri` file in the root folder (or I'll manually create them with lrelease on build)
395504638,9026,glassez,2018-06-07T17:38:43Z,"> The *.qm files shouldn't be in the repo. They should be created during build like the regular translations do. 

Ok, fixed."
395528121,9026,glassez,2018-06-07T18:56:13Z,"NOTE FOR REVIEWERS:
**TSTool is not the part of main qBittorrent codebase.** It just a helper to avoid creating/updating WebUI translation files manually. It just a plain script and not the well-formed application. I set the goal only to achieve the desired functionality in the most simple way. Who does not like this approach, you can go to criticize all the millions of existing scripts like this! So I ask you to comment on it only on the basis of the prerequisites above. You can ""improve"" it later yourself, if ""add a dozen lines of code without changing the functionality"" is an improvement for you."
405149502,9026,glassez,2018-07-16T05:00:58Z,">I don't know if you were waiting for me.

Yes. You asked me:
>I won't be able to comment until late tomorrow. Please wait a few days and don't merge.

>I assume it's job is to scan the html sources, find QBT_TR occurrences and extract them correctly into .ts files.

Yes.
>I am not able to verify the python code, I assume that it does the above. 

WebUI translation files are created using this script."
405235022,9026,glassez,2018-07-16T12:43:45Z,"So, will anyone approve this PR, or do you still have doubts?"
405255736,9026,sledgehammer999,2018-07-16T13:56:20Z,"IMO, it is best to only comment if there is a bug in the python script. Since @glassez isn't particularly interested in python and improving code quality of the script.
Patches are welcome after the merge from more knowledgeable people."
406881901,9026,glassez,2018-07-22T17:06:17Z,">IMO, it will increase the probability that I'll forget to run it before a release and have stale translations.

Actually you have to update them once you've updated .ts files."
421078514,9026,glassez,2018-09-13T17:00:19Z,"@sledgehammer999, is this PR generally approved or rejected? Have you some additional comments?"
423757929,9026,sledgehammer999,2018-09-22T16:57:50Z,"Damn it. The github-email spam has gotten to me. @glassez yes this is generally approved.
I don't like distributing .qm files. If @Chocobo1 @zeule want us to distribute it feel free to continue. Otherwise, drop the change about distributing .qm files."
423764607,9026,glassez,2018-09-22T18:40:01Z,">I don't like distributing .qm files.

What do you mean exactly?
If you don't like having .qm in qBittorrent repo, it isn't intended and I fixed it.
WebUI .qm files should be distributed with qBittorrent binary as well as other .qm files, otherwise how can it be used?"
423768158,9026,sledgehammer999,2018-09-22T19:39:03Z,"I meant this:

>If you don't like having .qm in qBittorrent repo, it isn't intended and I fixed it.

So we're good."
426346025,9026,glassez,2018-10-02T16:44:55Z,"PR updated (rebased onto current master).
@sledgehammer999, @qbittorrent/demigods, I intend to merge this PR in the next few days, unless you have any objections (to the feature itself, but not to the translation helper script). Please don't merge any conflicting PRs before.
@zeule, it breaks CMake builds and I don't know how to fix it.
@sledgehammer999, (just a note; I hope it doesn't get in the way of this PR) once it's merged, we'll either have to accept PRs with translation updates, or publish WebUI translations on Transifex and sync with it from time to time."
427655262,9026,glassez,2018-10-07T13:52:35Z,"@Chocobo1, can you re-approve (or comment) it?"
427670887,9026,Chocobo1,2018-10-07T17:28:37Z,"Offtopic, also I've been thinking, (after this PR) it should be possible to write a small parser in JS to parse Qt .ts files directly (ditching .qm files), this way we can move the i18n string replacement from WebUI server to client side (browser). I only got the idea recently, haven't got the time to code it."
428136641,9026,glassez,2018-10-09T10:09:19Z,">(Optional) It would be nice to get rid of LGTM warnings.

@Chocobo1, Python warnings are fixed. I don't know why LGTM can't compile C++ code."
428409242,9026,Chocobo1,2018-10-10T01:42:21Z,"@zeule 
Just letting you know merging this PR will break cmake build.
If you don't have time we can fix it after the merge."
2332253914,21300,glassez,2024-09-05T17:15:59Z,"> One of the questions now: do we want to make it a configurable option instead? Maybe someone does want mmap files for some reason. And it's generally good to have more options after all.

I believe that there are a huge number of users (including me) who are not affected by mmap-related problems at all because of their use cases. At the same time, I am not sure that disabling mmaping will not bring other problems in some use cases, because mmap IO subsystem was not originally designed to work in this mode. Therefore, it would be better to provide `mmap_file_size_cutoff` as an option."
2332266661,21300,glassez,2024-09-05T17:23:14Z,"> Therefore, it would be better to provide `mmap_file_size_cutoff` as an option.

Or maybe provide a way of disabling memory mapped files via another ""Disk IO type"" which behind the scenes would be just mmap disk IO with disabled memory mapping."
2332279378,21300,HanabishiRecca,2024-09-05T17:30:46Z,"> Or maybe provide a way of disabling memory mapped files via another ""Disk IO type"" which behind the scenes would be just mmap disk IO with disabled memory mapping.

I like that idea more. Switching `Disk IO type` also requires client restart, could work as additional safety measure.

Exposing the raw int field is not very useful imo. Because some arbitrary values don't really mean anything. And advising people with mmap problems to set it to something like `2147483647` would be weird.
So on/off behavior looks better."
2332314284,21300,HanabishiRecca,2024-09-05T17:48:15Z,There is also another related option: [`disk_write_mode`](https://www.libtorrent.org/reference-Settings.html#disk_write_mode). Maybe worth setting to `always_pwrite` along the way.
2332404132,21300,HanabishiRecca,2024-09-05T18:39:47Z,"Done.
This option also could be repurposed in the future, when the actual pread-disk-io would be in production."
2332410892,21300,glassez,2024-09-05T18:44:01Z,"> There is also another related option: [`disk_write_mode`](https://www.libtorrent.org/reference-Settings.html#disk_write_mode). Maybe worth setting to `always_pwrite` along the way.

Will it provide any additional benefit? Isn't setting `mmap_file_size_cutoff` to maximum value enough?"
2332428896,21300,HanabishiRecca,2024-09-05T18:54:39Z,"> Will it provide any additional benefit?

No, it is redundant and doesn't do anything in this case. [It uses pwrite if either of conditions met.](https://github.com/arvidn/libtorrent/blob/2ab8fedabb7716947edc77958da6d0b5e1040df9/src/mmap_storage.cpp#L662-L663)

>  Isn't setting `mmap_file_size_cutoff` to maximum value enough?

I see it as an additional safety net. But if you think it is excessive, I'll remove it."
2332454285,21300,glassez,2024-09-05T19:10:23Z,"> I see it as an additional safety net.

Well, so be it. "
2356334456,21300,nagyimre1980,2024-09-17T15:58:40Z,Will 5.0.0 include it?
2383555643,21300,glassez,2024-09-30T15:41:21Z,"A note for the one who will be merging this PR:
I have corrected the PR title. Don't forget to change the commit message to follow it."
2386521509,21300,glassez,2024-10-01T16:58:49Z,"@HanabishiRecca 
Thank you!"
2386692002,21300,USBhost,2024-10-01T18:30:37Z,Wasn't the fallback single-threaded?
2386706722,21300,HanabishiRecca,2024-10-01T18:38:57Z,"No, it uses as many threads as you set via `Asynchronous I/O threads` option."
2389123264,21300,KyleSanderson,2024-10-02T16:39:28Z,@HanabishiRecca this doesn't seem to be in the 5.0.x branch - do you know if this will make it for 5.0.1?
2389148498,21300,USBhost,2024-10-02T16:51:21Z,Isn't it the new default? Basically called default?
2389174287,21300,HanabishiRecca,2024-10-02T17:02:54Z,"> this doesn't seem to be in the 5.0.x branch - do you know if this will make it for 5.0.1?

There is a milestone on the right. I'm not in the developers team, just a regular user, so it does not depend on me.

> Isn't it the new default? Basically called default?

No. You need to enable it explicitly (`Disk IO type` => `Simple pread/pwrite`).
"
2389193845,21300,USBhost,2024-10-02T17:13:39Z,scratch that I was wrong. It's not on 5.0.0
2389226937,21300,HanabishiRecca,2024-10-02T17:29:09Z,"> It's not on 5.0.0

Of course not. This PR was only merged yesterday, **after** the 5.0.0 release.

I clearly described testing steps in that message https://github.com/arvidn/libtorrent/issues/6667#issuecomment-2386662790.
"
2412831913,21300,Pentaphon,2024-10-15T03:42:01Z,Has anybody done any testing to confirm this works as intended?
2412833558,21300,USBhost,2024-10-15T03:44:11Z,"try this https://github.com/arvidn/libtorrent/issues/6667#issuecomment-2400340621
@Pentaphon "
2426401974,21300,glassez,2024-10-21T11:25:51Z,"@HanabishiRecca 
Could you create PR to my v5.0 branch in order for it to be backported?"
2426431081,21300,HanabishiRecca,2024-10-21T11:40:11Z,"Unfortunately GitHub does not allow forking the same repo twice.
Is there a problem with cherry-picking?"
2426440525,21300,glassez,2024-10-21T11:45:00Z,"> Unfortunately GitHub does not allow forking the same repo twice.

Why do you need it?


> Is there a problem with cherry-picking?

There are conflicts regarding the WebUI, which I prefer not to get involved with solving."
2426504811,21300,HanabishiRecca,2024-10-21T12:15:24Z,"Ok, I did it manually."
2442897890,21300,buroa,2024-10-29T00:03:30Z,This PR made my year. Thank you @HanabishiRecca 
2543710050,21300,mreilaender,2024-12-15T09:59:12Z,"Thank you very much @HanabishiRecca! For me with memory mapped IO under Linux, QBitTorrent didn't release the memory and simply kept growing eventually forcing other processes to use SWAP.

Using Pread fixed the issue without any obvious side effects :)"
564424464,11614,Tester798,2019-12-11T08:01:24Z,"Ok, here is the variant without ""Spoofing command line parameters""."
564432789,11614,glassez,2019-12-11T08:27:39Z,"It looks like this feature makes `--portable` command line parameter completely meaningless, so it should be removed. Or am I missing some important use case?"
564457871,11614,Tester798,2019-12-11T09:35:32Z,"Hmm.. Yes, after first time when program will be run with `--portable` command line parameter `profile` folder will be created in app folder and use of `--portable` command line parameter wouldn't be needed anymore.
But if `--portable` command line parameter will be removed, then user will need to create `profile` folder himself manually to initiate portable operation, so I'm not sure if the parameter should be removed.

The intent of this pull request is just to add the possibility to run the program in portable mode without need of specifying any additional portable parameters."
564462961,11614,glassez,2019-12-11T09:48:35Z,">But if --portable command line parameter will be removed, then user will need to create profile folder himself manually to initiate portable operation, so I'm not sure if the parameter should be removed.

Creating folder is no harder than running program with some parameter. But having ""--portable"" parameter only to create ""profile"" folder is meaningless, IMO."
564464578,11614,Tester798,2019-12-11T09:52:50Z,So should I add removing --portable command line parameter to this pull request too?
564465746,11614,glassez,2019-12-11T09:55:39Z,">So should I add removing --portable command line parameter to this pull request too?

Yes. Unless someone provides a compelling reason not to. Let's wait at least for @Chocobo1 opinion."
564478473,11614,Chocobo1,2019-12-11T10:27:59Z,">Yes. Unless someone provides a compelling reason not to. Let's wait at least for @Chocobo1 opinion.

I don't have opinion on either way under the condition that `--profile` switch won't be affected, otherwise we broke some usage pattern here.

Also I would like to see a new log entry stating the used profile directory when qbt is started (whether in portable mode or not, generally useful for users IMO), can you do that @Tester798?"
564485865,11614,glassez,2019-12-11T10:49:01Z,">I don't have opinion on either way under the condition that --profile switch won't be affected, otherwise we broke some usage pattern here.

I.e. portable mode with profile dir other than default one is really useful? Do we allow such configuration currently? If No, I will insist on removing ""--portable"" param.

One important thing is @sledgehammer999 general approval of this way of ""portable mode"" detection. Several different options were discussed earlier (explicit portable build, params file, etc.) but I do not recall that we came to a consensus, because we still have open PRs that implement other ways."
564487408,11614,Chocobo1,2019-12-11T10:53:27Z,">I.e. portable mode with profile dir other than default one is really useful? Do we allow such configuration currently?

Yes.
I don't use portable/profile switch and I'm just saying that some users will be affected.

>If No, I will insist on removing ""--portable"" param.

Just to be clear, it seems the `--portable` switch is just a shortcut for `--profile qbt_binary_path/profile`."
564491885,11614,glassez,2019-12-11T11:06:46Z,">Just to be clear, it seems the --portable switch is just a shortcut for --profile qbt_binary_path/profile.

Well, then it should definitely be removed here. All other ""useful"" cases are covered by other parameters."
564539475,11614,Tester798,2019-12-11T13:29:14Z,"Removed `--portable` command line argument.
Added logging of config profile directory (because logging just base profile directory will require more code modification)."
564564567,11614,glassez,2019-12-11T14:21:17Z,">logging just base profile directory will require more code modification

Isn't ""profileDir"" suitable?"
564568586,11614,Tester798,2019-12-11T14:29:04Z,`profileDir` is empty in case of not portable operation.
566355032,11614,Chocobo1,2019-12-17T02:45:26Z,"@glassez 
Before we press the merge button. Should this land in v4.2.x or in next major release v4.3.0?"
566378978,11614,glassez,2019-12-17T04:48:28Z,"I think it's not a problem to merge it in v4.2.x. v4.2.0 was not very successful and should not have spread much (I would treat it as one of the late beta/RC versions). Besides, hardly anyone has a ""profile"" folder in application directory for any other purpose than portable mode, so we are unlikely to break something.
Have you any other thoughts?"
566389243,11614,Chocobo1,2019-12-17T05:36:40Z,">I think it's not a problem to merge it in v4.2.x. v4.2.0 was not very successful and should not have spread much (I would treat it as one of the late beta/RC versions). 

For me it seems many people have tried it and some (if not many) of them reverted back due to problems.

>Have you any other thoughts?

Not many, I just thought this is a behavior change and personally I would prefer including it in next major release instead (but I don't insist). Well I'll merge it and let @sledgehammer999 decide."
566389475,11614,Chocobo1,2019-12-17T05:37:44Z,"@Tester798 
Thank you!"
566394292,11614,glassez,2019-12-17T05:58:37Z,">Well I'll merge it and let @sledgehammer999 decide.

:+1:"
566748306,11614,sledgehammer999,2019-12-17T21:04:34Z,"A lot of people were/are interested for a painfree way to enable portable mode. So what's the worst case? That someone has forgotten a ""profile"" folder in the same folder as the binary? Big deal. Let's not forget that for official installations it is extremely hard for such a file to exist. (usually the binary is installed in protected/system folder).
So I am inclined to include this in the next release."
566948022,11614,FreePlague,2019-12-18T09:23:03Z,How about QBT_PORTABLE = 1 environment variable? Is this gone too?
567027831,11614,olliebean,2019-12-18T13:19:14Z,"The first time I ran this new version without the --profile command line, all the downloaded files from my existing torrents - that had already been saved to the correct directories according to my Save Path in the Downloads tab of the options - were moved into the profile folder, and I had to move them back to where they should be by right-clicking on each one and selecting ""Set location"". Seems to have been a one-off, as new torrents are saving to the correct locations as per the settings, but surely this can't be working as designed?"
567070302,11614,glassez,2019-12-18T15:04:35Z,">The first time I ran this new version without the --profile command line,

It's not about --profile parameter. It's about --portable that is removed in favour of auto detection of ""portable"" mode."
567079979,11614,olliebean,2019-12-18T15:27:45Z,"I was using --profile=profile due to problems I had previously using the --portable switch. I just restarted qBittorrent without any command line, and it seems that problem still exists - all my torrents are now showing errors. The errors in the log read: ""The filename, directory name, or volume label syntax is incorrect."" It seems to be related to portable mode trying to use relative paths for everything.

I guess I'll restore my configuration from backup and continue to use --profile=profile."
567082566,11614,glassez,2019-12-18T15:33:32Z,"--profile=profile doesn't mean ""portable"" mode. ""portable"" mode includes ""relative fastresume paths""."
567087843,11614,olliebean,2019-12-18T15:44:53Z,"Yes, and apparently relative fastresume paths doesn't work properly if those paths aren't in qBittorrent's directory. 4.2.1 means portable mode is automatically enabled if the ""profile"" folder is found in qBittorrent's home directory, so I'm going to have to either revert to an older version or rename the profile folder to get my paths working properly again."
567092248,11614,olliebean,2019-12-18T15:54:43Z,"Regardless, v4.2.1 seems to have royally messed up my existing torrents. It knows where they are - if I double-click on a torrent, it opens the correct directory with the correct file selected - but they are showing errors, and if I try a ""recheck"" it can't find them. Any guidance on how to get things working again would be welcomed. Restoring my profile folder from backup doesn't seem to have helped. Nor did renaming the profile folder or reverting to an older version."
567156838,11614,Janaue,2019-12-18T18:37:03Z,the issues for broken torrents is old https://github.com/qbittorrent/qBittorrent/issues/11178
567174534,11614,olliebean,2019-12-18T19:24:34Z,"Is there any way to explicitly disable relative fastresume when running portably? Previously the way to get around this was to use `--profile=profile` instead of `--portable`; now the workaround seems to be to use a different name for the profile directory, e.g., `--profile=userprofile`, to prevent `--relative-fastresume` being automatically enabled by the presence of the ""profile"" directory."
567328673,11614,glassez,2019-12-19T04:36:33Z,"When you set `--profile=profile` without `--relative-fastresume` it just will use profile folder you set.

*Note: I'm not sure qBittorrent can correctly handle existing torrents when you start it in another mode than the previous one.*
So your problems can be caused by switching between modes and then running qBittorrent with torrents created in another mode.

It seems that you do not understand exactly what has been done here. We haven't changed how it works in one mode or another. We just changed the way to enable ""portable"" mode."
567405179,11614,olliebean,2019-12-19T09:18:04Z,"Thanks - it seems my mistake was to run the executable directly, without using `--profile=profile`, upon which it corrupted the fastresume paths in my existing profile folder. I'd been using this command line option for so long, via a shortcut, that I'd forgotten that --portable mode has this problem (and if I'd remembered, I probably would have assumed it had been fixed by now anyway), and thought this new update meant I wouldn't need the command line option any more. Had I just kept using my shortcut as before, I wouldn't have run into any problems."
567456094,11614,glassez,2019-12-19T11:42:48Z,"@Tester798, can you confirm that ""portable"" mode works as expected? Do you use it currently?"
567477889,11614,Janaue,2019-12-19T12:54:27Z,ddddd
567480011,11614,Janaue,2019-12-19T13:01:05Z,so what is the proper way to enable the portable mode and avoid the error of directory name ?
567481773,11614,olliebean,2019-12-19T13:06:19Z,"The option `--profile=profile` is essentially the same as portable mode, but without the `--relative-fastresume` option that causes the path errors. It won't fix any path errors caused by running in portable mode, but it will prevent any more paths getting broken."
567565306,11614,Tester798,2019-12-19T16:37:01Z,"@glassez didn't know it's released already, was planning to switch to it after this change.

Just checked versions 4.2.0 and 4.2.1 and looks like they work the same way in `portable` mode: giving error for the downloaded torrent after program is restarted if torrent was downloaded not to default folder.
If the program is running with `--profile=profile` command line, then looks like it's giving no error for the torrent after restarting the program (for both 4.2.0 and 4.2.1).

So looks like it's the problem with `--relative-fastresume` functionality?"
567569126,11614,Vanquo,2019-12-19T16:46:52Z,"https://github.com/qbittorrent/qBittorrent/issues/7765
https://github.com/qbittorrent/qBittorrent/issues/11178
https://github.com/qbittorrent/qBittorrent/issues/11706
https://github.com/qbittorrent/qBittorrent/issues/7770
These are all somehow related. 

If I can describe the problem me, olliebean and others are having with portable mode, its trying to save torrents in the same drive letter as qbittorrent.exe but outside of the profile folder. Torrents saved in say "".\profile\qBittorrent\downloads"" are fine after closing and reopening the app but any torrents located outside the profile folder but within the same drive letter will give the paths error. Any torrent saved in a different drive letter as qbittorrent.exe works fine.

Maybe portable mode should by default just not have `--relative-fastresume`. How about just keep the default to absolute paths and give us the option to decide if we want to save files in a relative path for portable use like specifying in the ""Default Save Path"" to save files in "".\profile\qBittorrent\Downloads"" relative to the qbittorrent.exe."
567573135,11614,sledgehammer999,2019-12-19T16:56:34Z,"Guys, this is a closed PR. If you experience problems, then open a new report describing the issue as best as you can. And maybe leave a link here too."
567602237,11614,LeoKesler,2019-12-19T18:15:11Z,"@Vanquo , the same happens if the torrents are saved in other driver letter. In this case, qbittorrent will copy the files to profile folder."
568038284,11614,a-raccoon,2019-12-20T18:35:15Z,"What is the explicit name of the ""Automatically Detected Portable Profile Folder"" in the program directory under Windows? Assume no command-line switches are used.  Can the folder be empty, to generate a new ini file within, or must it contain a .ini file already?

Drive = `E:`
ProgramDir = `E:\qBittorrent\`
AutoDetectPortableProfileDir = `E:\qBittorrent\????`

Also recommend a `[x] Install as Portable (Warning: Do not install as portable to C:\Program Files\)` in the qbt installer."
568791910,11614,bacon-cheeseburger,2019-12-24T19:02:19Z,"I know this is late in the conversation but there are some things people need to remember when it comes to software...

- User-defined paths should *always* be respected.
- No app should take it upon itself to move/copy files from user-defined paths. Trying to make apps ""smart"" by guessing what user intent is, almost always makes the app problematic. If I, as a user, want portable mode, *I* will tell the app, preferably by command line parameter. If I want to use a specific `profile`/dir for my config, *I* will tell you where to find it.
- K.I.S.S. *always* applies! Users who need/want to work outside of default settings know what they want. Stop trying to make assumptions, just listen to what they're telling you via the command line.
- GOOD apps do what the user asks, no more, no less. BAD apps argue with the user over what the user wants."
568804750,11614,a-raccoon,2019-12-24T21:42:42Z,"@bacon-cheeseburger : Not all users have command-lines or want to use command lines or edit shortcuts with command-line switches.  It is a very standard practice within the Microsoft Windows environment and culture for a Portable App to work via automatic detection of a config file within the proximity of the exe file.  Same goes for dll files within the proximity of the exe.  This is a defined standard.  More and more Windows apps behave in this way, because using third-party pseudo-portablizing containment sandbox tools (PortableApps) is very ghey and unnecessary.

qBittorrent is not Moving nor Copying anything.  The user does this."
568808747,11614,olliebean,2019-12-24T22:51:27Z,"@a-raccoon : The problem isn't with how the portable mode is enabled, whether by a command line or automatically if the profile folder is detected alongside the exe file. The problem is with the portable mode being unable to correctly handle a user-defined path for where to store the downloaded files without losing track of said files and throwing up errors, and indeed with it moving the user's existing downloaded files out of their user-defined folders and into its profile folder without asking or informing the user. (I think we've established that it does do this, as it has happened to me and to other users on enabling portable mode.)"
568811867,11614,bacon-cheeseburger,2019-12-24T23:54:41Z,"@a-raccoon And a lot of users are **not** Windows users. Rather than trying to shoehorn/force Windows quirks/oddities/etc's, apps should just simply listen to what the user is telling it whether it be by command line, config file, or otherwise. There's no reason an app should push back against user preferences. If the user _explicitly_ instructs the app to behave in a certain way, look for (pro)files in a certain place, etc. then do it. Don't fight the user, just do it.

Another point of consideration for non-Windows/Linux users is many people don't tolerate the idiocy that is distro/filesystem hierarchy. Instead they create more simple & sensible hierarchies that suit their needs and make things like creating backups vastly easier. Generally speaking, puking files all over the place is just bad design."
568859027,11614,glassez,2019-12-25T07:45:59Z,">The problem isn't with how the portable mode is enabled

But this PR is about ""how the portable mode is enabled"". We didn't touch anything else here. So please stop littering this topic with problems that isn't directly related to it."
569987671,11614,eli-schwartz,2019-12-31T20:38:16Z,"> Another point of consideration for non-Windows/Linux users is many people don't tolerate the idiocy that is distro/filesystem hierarchy. Instead they create more simple & sensible hierarchies that suit their needs and make things like creating backups vastly easier. Generally speaking, puking files all over the place is just bad design.

Why are you backing up program executables? If you're not backing up program executables, then none of this has anything to do with backups.

Complain about portable mode as you will, but simply enabling the mode when faced with a strictly Windows-style layout should really not be affecting Linux users for good or ill. And people doing backups of their profile data should not be using portable mode, as it will puke obtuse, bloated binaries all over their backups, which is just bad design for a backup system.

P.S. Any distro lets you create your own packages (some easier than others), which define whatever you darn well please, no matter how wrong you want to be... but it doesn't matter, qbittorrent is a single executable file, plus icons stored in the icon theme directory and accessed via `QIcon::fromTheme()` to ensure users are permitted to theme the program themselves. So if you really, truly want to relocate /usr/bin/qbittorrent to /opt/lolware/my/path/is/the/best/qbittorrent, you can."
570480788,11614,bacon-cheeseburger,2020-01-03T06:46:03Z,"@eli-schwartz What are you on about? Nobody said anything about backing up executables but it wouldn't matter if they did. A lot of people *do* in fact backup executables for known-working compatibility reasons. And nobody said anything about relocating ""/usr/bin/qbittorrent"", if that's even where it's located, to anywhere else. And who cares about creating your own packages using whatever layout suits you if the program doesn't behave properly or in an expected manner according to the given settings?"
616598737,12557,glassez,2020-04-20T14:42:07Z,">Also the renameRule API seems to be broken. Since I couldn't figure out where the mistake lies I created an issue.

Well, I'll look into it ASAP."
619227512,12557,Piccirello,2020-04-24T20:36:34Z,"Wow, someone actually implemented this! Major props @SeproDE - you're going to get a lot of love from the qBittorrent community for this. This is a big change so it may take a bit to review.

@glassez please include me in all web ui/api PRs"
619314081,12557,glassez,2020-04-25T03:43:23Z,">please include me in all web ui/api PRs

Sorry, what do you mean?"
619320400,12557,Chocobo1,2020-04-25T04:49:40Z,"> > please include me in all web ui/api PRs
> 
> Sorry, what do you mean?

Please remind/ask him to review all web ui/api related PRs.
"
619970998,12557,glassez,2020-04-27T13:01:30Z,">Please remind/ask him to review all web ui/api related PRs.

@Piccirello, please review this PR ASAP, since it's most wanted feature for many years."
628643567,12557,WolfganP,2020-05-14T13:41:18Z,Any news on this PR? Is there any showstopper?
628656575,12557,seproDev,2020-05-14T14:01:04Z,"@WolfganP 
> Any news on this PR? Is there any showstopper?

Still waiting for people to test the functionality.

Other then that #12558 should probably be fixed before merging."
629117343,12557,glassez,2020-05-15T08:53:55Z,">Other then that #12558 should probably be fixed before merging.

#12843 should probably fix it. Can someone test it?"
629154604,12557,seproDev,2020-05-15T10:16:26Z,"> #12843 should probably fix it. Can someone test it?

Works!"
632689927,12557,seproDev,2020-05-22T13:26:58Z,Rebased to resolve merge conflicts.
639186236,12557,Jylijs,2020-06-05T00:18:40Z,Any update?
640747094,12557,RaduMemetea,2020-06-08T16:50:52Z,Nothing new on this?
640750990,12557,glassez,2020-06-08T16:58:31Z,"@Chocobo1, if you don't have any serious comments in general, and you can't check it thoroughly, I would merge it as is and wait for user feedback. Judging by the related Issue, there is a fairly large user base."
640769313,12557,Chocobo1,2020-06-08T17:32:42Z,">I would merge it as is and wait for user feedback. 

I'm ok if Piccirello is fine with it too. @Piccirello What do you think?"
640799538,12557,Piccirello,2020-06-08T18:33:55Z,I tested very quickly with a public RSS feed I found online and everything seemed to work. I'm ok with merging as long as we have users thoroughly test it before it makes it into a release. 
641064126,12557,Chocobo1,2020-06-09T06:35:06Z,"@SeproDE 
Thank you!"
641102152,12557,glassez,2020-06-09T07:51:41Z,It would be useful if someone provides test builds with this feature merged.
641304476,12557,WolfganP,2020-06-09T13:40:34Z,"> It would be useful if someone provides test builds with this feature merged.

A quick test of a new master build worked perfectly (adding new subscription, updating it, selecting entry, getting details, double click to download). Couldn't test the rules system via the webUI, but will report later if any errors appear.

Thanks a lot @SeproDE !!!
"
641326646,12557,FranciscoPombal,2020-06-09T14:16:23Z,"@glassez 1 or 2 hours after this comment is posted, Windows builds with this feature will be available here: https://github.com/FranciscoPombal/qBittorrent/actions/runs/129842756"
642223257,12557,jobrien2001,2020-06-10T19:53:57Z,"@SeproDE 

I found a bug in the webui.

It truncates an rss url string.  Max characters is set too low.

Tried a jacket rss url (which are somewhat long) and it cut the string at a certain point.

Try enter this and you will see.  You wont get any results, but you can check in the feeds.json it has been cut.

Try ""http://192.168.1.155:9117/api/v2.0/indexers/1337x/results/torznab/api?apikey=o15guuigf7jdy1qj8sdsa45uisermjl&t=search&cat=100070&limit=10""

Also not sure where to post feedback on this new feature so i posted it here.  Should i have opened an issue?

UPDATE: edited manually with nano feeds.json with and its updating the feed.  Now I have another issue.  The RSS downloader popup containing all the forms to create new rules, has all the forms disabled.  No error shows on log or browser console.

Could it be the linuxserv docker image that is not good?"
642253880,12557,rmarble,2020-06-10T20:56:45Z,"I'm happy to help test and give feedback after I get my new server set up.
BUT...I'm a bit of a novice, and have been doing my best to understand the technical part of all this.
Is this built in to a version of qbittorrent, or is there some extra wizardry involved to implement it?

I appreciate your patience with a new Linux user and right brainer.  :)
"
642256218,12557,jobrien2001,2020-06-10T21:00:27Z,"setup docker on your environment then use this image:
docker pull linuxserver/qbittorrent:4.3.0202006091235-7009-1720580ubuntu18.04.1-ls50

Update: for more info on the variables go to https://hub.docker.com/r/linuxserver/qbittorrent"
642599068,12557,seproDev,2020-06-11T12:02:33Z,"@jobrien2001 
> Max characters is set too low.

Yes, that's definitely an issue. I think it should also be removed for newfolder and rename_feed.

> The RSS downloader popup containing all the forms to create new rules, has all the forms disabled.

The forms stay disabled when you select a rule?
What browser and OS are you using?"
642603770,12557,jobrien2001,2020-06-11T12:10:58Z,"@SeproDE 
> The forms stay disabled when you select a rule?
> What browser and OS are you using?

Disabled as soon as i hit the autodownloader button and the popup loads.  I cant create any rules.

Unraid

This docker:

https://hub.docker.com/layers/linuxserver/qbittorrent/4.3.0202006091235-7009-1720580ubuntu18.04.1-ls50/images/sha256-aad4e3e8005a05f00c065c79c4c5edb3dd36a01cd941c825b802433d09e38b40?context=explore

Brave, tried edge aswel.
"
642606582,12557,seproDev,2020-06-11T12:16:50Z,"@jobrien2001 
> I cant create any rules.

So the context menu doesn't load? The Web UI is missing a dedicated add rule button and instead only has the context menu. Maybe that should be added."
642607757,12557,jobrien2001,2020-06-11T12:19:38Z,"The rss popup for creating rules pops and i can see the forms, but the forms are disabled, so i cannot interact with them to create a new rule."
642609527,12557,seproDev,2020-06-11T12:23:50Z,"@jobrien2001 
When you open the Rss Downloader window the forms should be disabled since no rules is selected. When you right click on the left hand side the context menu should open to create a new rule.
![image](https://user-images.githubusercontent.com/4618135/84384977-1ff67380-abef-11ea-99bb-6988bfa65fee.png)
"
642612539,12557,jobrien2001,2020-06-11T12:30:33Z,"I cannot test atm but i will report back and see if I can get past it.   

I would agree the add rule button should be there. Maybe the forms hidden when they are in a disabled state."
642656381,12557,seproDev,2020-06-11T13:41:11Z,I have started work on fixes in [this branch](https://github.com/SeproDE/qBittorrent/commits/webui-rss-fixes). Should I create an issue for each fix/commit or squash all changes?
642792660,12557,FranciscoPombal,2020-06-11T16:31:33Z,"@SeproDE 

> I have started work on fixes in [this branch](https://github.com/SeproDE/qBittorrent/commits/webui-rss-fixes). Should I create an issue for each fix/commit or squash all changes?

Fixes look good. I would say one PR for all these fixes, but with the 3 separate commits. Then others can decide whether or not they should be squashed (in which case the purpose of each change should be mentioned in the commit message body)."
643015820,12557,jobrien2001,2020-06-12T01:33:31Z,"Everything working properly from the UI, but there is still a problem with handling completed rss torrents.

A lot of us use jackett as a proxy to get rss magnets.  Example rss item from jackett, note the id and torrenturl attributes (the id is a link to the page and the torrenturl a link that will redirect to a magnet).

```
    {
        ""attr"": """",
        ""category"": ""100036"",
        ""comments"": ""https://1337x.to/torrent/4492307/The-First-Actress-A-Novel-of-Sarah-Bernhardt-by-C-W-Gortner-EPUB/"",
        ""date"": ""11 Jun 2020 22:38:25 +0000"",
        ""description"": """",
        ""id"": ""https://1337x.to/torrent/4492307/The-First-Actress-A-Novel-of-Sarah-Bernhardt-by-C-W-Gortner-EPUB/"",
        ""jackettindexer"": ""1337x"",
        ""link"": ""http://192.168.1.222:9117/dl/1337x/?jackett_apikey=w3mi0bdfocf7tkq39ex6opjdy1qj8qql&path=Q2ZESjhHUXlrRlJPNEtaR3VaOU5GWGJ1TUpXSmhjWHVULTF5V3NsaGZiOUlJQ0xieXBTZWwtVDJsSGkwRFc3Z3lSUzRZMkZPQ0o3Q1hLTkY5eS1xSEJEMU9VcUgtbV9CM200eUdXN1UyWUxtTXJDZlpseTVyMzliNmVPV1NkMFZNTDUxZDcxVEFLeTJUV1ROcVp2MV84dDJhcFFmeGtFUV9udVItOXJVUEtXazhvOVowcWxqeDNLejg4NFpPSE5yS1RhREs3U0pTVm5Ud1RKa242YmhmV2VHcUpQWThLNjhXMkJUUmxmU0xXcU9LNTlxcnZJS2R5UFV6Z0pHM0JrRGJ4NV9jZw&file=The+First+Actress+A+Novel+of+Sarah+Bernhardt+by+C+W+Gortner+EPUB"",
        ""size"": ""5033165"",
        ""title"": ""The First Actress A Novel of Sarah Bernhardt by C W Gortner EPUB"",
        ""torrentURL"": ""http://192.168.1.222:9117/dl/1337x/?jackett_apikey=w3mi0bdfocf7tkq39ex6opjdy1qj8qql&path=Q2ZESjhHUXlrRlJPNEtaR3VaOU5GWGJ1TUpXSmhjWHVULTF5V3NsaGZiOUlJQ0xieXBTZWwtVDJsSGkwRFc3Z3lSUzRZMkZPQ0o3Q1hLTkY5eS1xSEJEMU9VcUgtbV9CM200eUdXN1UyWUxtTXJDZlpseTVyMzliNmVPV1NkMFZNTDUxZDcxVEFLeTJUV1ROcVp2MV84dDJhcFFmeGtFUV9udVItOXJVUEtXazhvOVowcWxqeDNLejg4NFpPSE5yS1RhREs3U0pTVm5Ud1RKa242YmhmV2VHcUpQWThLNjhXMkJUUmxmU0xXcU9LNTlxcnZJS2R5UFV6Z0pHM0JrRGJ4NV9jZw&file=The+First+Actress+A+Novel+of+Sarah+Bernhardt+by+C+W+Gortner+EPUB""
    }
```

Jackett's torrentURL and link attributes change every single time an rss is requested. If i set an autodownloader rule and it downloads an item it will not be marked `""isRead"": true` on completion.  This causes the downloader to redownload the article when there is a QB restart.  For some reason I do not understand this only happens on a QB restart, in other words, it remembers it has already downloaded the article in the current QB process.

I have 2 suspicions:

1. It could be the `id` attribute, note that most rss lists use the hash for an `id` while jackett uses a url  link (a jackett limitation). Maybe a variable type problem?

2. QB uses more than the `id` attribute to determine if an article should be marked `""isRead"": true` (which it should not).  I suspect it could use the feedurl as well, and since the feedurl change constantly this could be interpreted as a new item.  Also, jackett links cannot be magnets because of the way it works so this could also be the culprit.

I did some digging and these 2 blocks of code look where this is happening in  rss_autodownloader.cpp

I do not know the language so please forgive any errors in my assessment.

```
void AutoDownloader::handleTorrentDownloadFinished(const QString &url)
{
    const auto job = m_waitingJobs.take(url);
    if (!job) return;

    if (Feed *feed = Session::instance()->feedByURL(job->feedURL))
        if (Article *article = feed->articleByGUID(job->articleData.value(Article::KeyId).toString()))
            article->markAsRead();
}
```

""if (Feed *feed = Session::instance()->feedByURL(job->feedURL))""
This may not pass because the feed url in the json may not be the same as the one obtained when accessing torrenturl.

```
        if (BitTorrent::MagnetUri(torrentURL).isValid()) {
            if (Feed *feed = Session::instance()->feedByURL(job->feedURL)) {
                if (Article *article = feed->articleByGUID(job->articleData.value(Article::KeyId).toString()))
                    article->markAsRead();
            }
        }
        else {
            // waiting for torrent file downloading
            // normalize URL string via QUrl since DownloadManager do it
            m_waitingJobs.insert(QUrl(torrentURL).toString(), job);
        }

        return;
    }
```

""if (BitTorrent::MagnetUri(torrentURL).isValid()) {""
torrentURL's provided by jacket are not magnets, so this may not pass.
""if (Feed *feed = Session::instance()->feedByURL(job->feedURL)) {""
And this line pops again.






"
643047647,12557,jobrien2001,2020-06-12T03:40:40Z,"Update: If I download manually the rss article in the webui by using the RSS tab and right clicking on a giving article and selecting download.... it will correctly mark the article with `""isRead"": true`

Something must be different in the rss auto download code.

Here is confirmation that its working properly marking `""isRead"": true` by downloading manually from rss list:

```
    {
        ""attr"": """",
        ""category"": ""100036"",
        ""comments"": ""https://1337x.to/torrent/4492748/FreeCourseWeb-Spark-Joy-An-Illustrated-Master-Class-on-the-Art-of-Organizing-and-Tidying-Up-True-EPUB/"",
        ""date"": ""11 Jun 2020 10:51:00 +0000"",
        ""description"": """",
        ""id"": ""https://1337x.to/torrent/4492748/FreeCourseWeb-Spark-Joy-An-Illustrated-Master-Class-on-the-Art-of-Organizing-and-Tidying-Up-True-EPUB/"",
        ""isRead"": true,
        ""jackettindexer"": ""1337x"",
        ""link"": ""http://192.168.1.222:9117/dl/1337x/?jackett_apikey=w3mi0bdfocf7tkq39ex6opjdy1qj8qql&path=Q2ZESjhHUXlrRlJPNEtaR3VaOU5GWGJ1TUpYMjlvQzVsd2lyc1VHZ1RSRXFBaGhIcklEUFIxc0d4RzI3RGJqalE3WjdGT21Lek1Dd1Mza2h2TWFncjZPTm4xRHdZbGp6Tjk3bWdjamZocXZUX2pQc1Fxd0VrSU1na2R2RlRHS1p0cVJuNVNud1FYdmlyTHBfUzY0ZFAxd2JZeDZuVm1Pa015WmNBOGxBVjN6bW5QTXozYW0tWUtoZXFrNnUxOElyYk9FT2hQR1VfZGVXTThsZXBwUnJMaVROcnlnbGtZb1EtNTNvR1RabFdYcTlWeFBLSjhObHN2c3FBZHdLeGU0bUpQem1oYmdSdE43bU51ZEpsTXVKWlF1dXFKczRQQXV4cndKc0NDRnRHYU96eEJ4WA&file=FreeCourseWeb+Spark+Joy+An+Illustrated+Master+Class+on+the+Art+of+Organizing+and+Tidying+Up+True+EPUB"",
        ""size"": ""36280728"",
        ""title"": ""FreeCourseWeb Spark Joy An Illustrated Master Class on the Art of Organizing and Tidying Up True EPUB"",
        ""torrentURL"": ""http://192.168.1.222:9117/dl/1337x/?jackett_apikey=w3mi0bdfocf7tkq39ex6opjdy1qj8qql&path=Q2ZESjhHUXlrRlJPNEtaR3VaOU5GWGJ1TUpYMjlvQzVsd2lyc1VHZ1RSRXFBaGhIcklEUFIxc0d4RzI3RGJqalE3WjdGT21Lek1Dd1Mza2h2TWFncjZPTm4xRHdZbGp6Tjk3bWdjamZocXZUX2pQc1Fxd0VrSU1na2R2RlRHS1p0cVJuNVNud1FYdmlyTHBfUzY0ZFAxd2JZeDZuVm1Pa015WmNBOGxBVjN6bW5QTXozYW0tWUtoZXFrNnUxOElyYk9FT2hQR1VfZGVXTThsZXBwUnJMaVROcnlnbGtZb1EtNTNvR1RabFdYcTlWeFBLSjhObHN2c3FBZHdLeGU0bUpQem1oYmdSdE43bU51ZEpsTXVKWlF1dXFKczRQQXV4cndKc0NDRnRHYU96eEJ4WA&file=FreeCourseWeb+Spark+Joy+An+Illustrated+Master+Class+on+the+Art+of+Organizing+and+Tidying+Up+True+EPUB""
    }
```
"
643069248,12557,glassez,2020-06-12T05:14:15Z,"@jobrien2001, your last comments are unrelated to both current topic and WebUI. If you want to report some problem in RSS core functionality you should create separate Issue (one Issue per problem)."
643761266,12557,jobrien2001,2020-06-14T12:39:12Z,"Add rule button and feed max length is working now. Manual download button is working and so is Open news.

BTW the buttons looks great and the user interface looks more straight forward because of them."
643771929,12557,jobrien2001,2020-06-14T14:11:37Z,"Not sure if this is WebUI or another RSS core problem.

-add a feed
-add rule assigned to that feed.
-delete feed

Rule still exists assigned to that feed (which doesnt exist anymore). `""affectedFeeds"": [xxxxxxx]`

This might be harmless or intended to preserve the rule settings.

The reference to the feed can be removed by simply opening the rule and hitting save again."
644539847,12557,jobrien2001,2020-06-16T05:30:20Z,"3 Days running without a problem.

1 thought about the icons:  I found myself clicking on the big trashcan icon on the main toolbar instead of the small trashcan when trying to delete a rule.  Maybe a plus and minus would be better choice for icons to distinguish from the main toolbar.

@glassez Created a separate issue. Thank you.
"
644553116,12557,seproDev,2020-06-16T06:11:34Z,"@jobrien2001 

> Not sure if this is WebUI or another RSS core problem.

As long as this doesn't break anything I would keep it as intended behavior. Even if this were considered a bug I don't think the WebUI should deal with it. Instead that should be changed at API or Core level.

> 1 thought about the icons

Currently all shown icon are identical to the desktop UI. If we were to change them here they should also be changed in the desktop UI.

I thought about adding icons to the ""New subscription"", ""Mark items read"", ""Update all"" and ""RSS Downloader..."" buttons. The problem is that it the regular buttons are styled by the browser and thus the custom styling for the image buttons would only really be fitting for one browser."
644555152,12557,glassez,2020-06-16T06:16:55Z,">Currently all shown icon are identical to the desktop UI. If we were to change them here they should also be changed in the desktop UI.

It's a disadvantage of currently used approach, IMO. I have repeatedly suggested that we separate Web UI from Desktop UI completely. Really they are separate applications."
644849895,12557,Piccirello,2020-06-16T15:49:17Z,"> I have repeatedly suggested that we separate Web UI from Desktop UI completely.

I've yet to see this suggested by anyone that actually uses the Web UI. If this split were to happen, I predict that the Web UI and APIs would quickly fall behind in functionality."
645650493,12557,jobrien2001,2020-06-17T22:05:05Z,"May I suggest an enhancement?

A size column in the RSS list, if thats its available in the API.  Some feeds do provide a size attribute."
645669566,12557,FranciscoPombal,2020-06-17T23:00:28Z,@jobrien2001 please open new threads to discuss each new bug or feature.
917433554,15452,glassez,2021-09-11T16:23:09Z,"I think there are other suitable candidates to be moved in ""Torrent options"" dialog. Offhand, these are the following:
1. Save path
2. Sequential download
3. Download first and last piece first"
917563669,15452,Chocobo1,2021-09-12T06:01:29Z,">![mid](https://user-images.githubusercontent.com/6451685/132952643-cda2d4c5-901b-4f4a-be65-79eb5b8b4d70.JPG)

I like this better."
918134033,15452,thalieht,2021-09-13T12:18:01Z,"I've been trying to think about the relationship of autoTMM and save path (should save path be disabled when autoTMM is enabled?) but i now tested how ""Set location..."" works: it disables autoTMM, so i don't think there should be any interaction between these 2. Let me know if i'm wrong.
Which brings me to the layout.
>I like this better.

Now that i added the save path does that still apply? If yes should i move autoTMM above the Download... checkboxes?
If anyone has a better idea on where to put the new options (autoTMM, save path, Download....) let me know.

![4](https://user-images.githubusercontent.com/6451685/133079625-2ec0ef95-c27b-47c3-b5b4-ef1227c37662.JPG)

>I think there are other suitable candidates to be moved

Moved, as in... remove the originals? Although autoTMM was convenient for me to have it in the context menu, moving it was a necessary evil because it was.... accident prone. But save path? Now users would have to do 2 extra clicks for that.

p.s. i moved code around for the new options to be inline with how they are shown in the GUI (currently).
"
918152181,15452,glassez,2021-09-13T12:42:39Z,">Moved, as in... remove the originals? 

Yes. Otherwise what's the point to move it there?
>But save path? Now users would have to do 2 extra clicks for that.

I am always annoyed by these complaints about a couple of extra clicks, unless it is something that is really often used.
>i now tested how ""Set location..."" works: it disables autoTMM, so i don't think there should be any interaction between these 2. Let me know if i'm wrong.

When I implemented AutoTMM, it could have been one of two: 
1. Explicitly setting the Save Path disables AutoTMM 
2. Setting the Save Path is disabled/prohibited if autoTMM is enabled. 

I chose the first option because of the simpler implementation. But it seems to me more confusing, so now I would prefer the second option (as it is done in the ""Add new torrent"" dialog)."
918153944,15452,glassez,2021-09-13T12:45:08Z,">Now that i added the save path does that still apply? If yes should i move autoTMM above the Download... checkboxes?
If anyone has a better idea on where to put the new options (autoTMM, save path, Download....) let me know.

Well, it should at least be located alongside with ""Save path""."
918390903,15452,thalieht,2021-09-13T17:02:23Z,">>Moved, as in... remove the originals?
>
>Yes. Otherwise what's the point to move it there?

Consolidation, for when people want to change e.g. 3 things at the same time they don't have to open 3 different dialogs.

>I am always annoyed by these complaints about a couple of extra clicks, unless it is something that is really often used.

You're right, for options like the ones in the advanced tab, which you set and forget. Hide them behind 5 clicks, no problem. But you can't call a ""volatile"" option such as the save path that some people may want to change for every torrent as ""not often used"". Anyway i don't really care about it personally. You want the shortcuts gone, they're gone.

"
918401773,15452,glassez,2021-09-13T17:14:39Z,">You want the shortcuts gone, they're gone.

That was just my opinion. Other members may still worry about a couple of extra clicks."
920555347,15452,Chocobo1,2021-09-16T03:55:21Z,">But you can't call a ""volatile"" option such as the save path that some people may want to change for every torrent as ""not often used"". Anyway i don't really care about it personally. You want the shortcuts gone, they're gone.

No strong opinion from me."
922259978,15452,thalieht,2021-09-18T11:05:43Z,I squashed all commits.
925698446,15452,thalieht,2021-09-23T10:43:59Z,">Shouldn't the Categories also be moved here to have all the settings associated with AutoTMM in one place?

That was harder than i thought. I double checked everything but i probably missed something.

Edit: forgot pic

![asf](https://user-images.githubusercontent.com/6451685/134546528-a04b778f-cb86-46e1-90e6-70c62f50cadf.JPG)
"
926028867,15452,ArcticGems,2021-09-23T17:51:36Z,Maybe it would look better if 'Save path' and 'Category' was inside a box just like the 'Torrent speed limits' and 'Torrent share limits' options??
926794448,15452,thalieht,2021-09-24T17:17:42Z,">Maybe it would look better if 'Save path' and 'Category' was inside a box just like the 'Torrent speed limits' and 'Torrent share limits' options??

I'm neutral."
926803173,15452,xavier2k6,2021-09-24T17:31:29Z,">Shouldn't the Categories also be moved here to have all the settings associated with AutoTMM in one place?

What about `tags`?

>Maybe it would look better if 'Save path' and 'Category' was inside a box just like the 'Torrent speed limits' and 'Torrent share limits' options??

To me it looks fine from the screenshots."
926814725,15452,ArcticGems,2021-09-24T17:50:18Z,"> 
> 
> > Maybe it would look better if 'Save path' and 'Category' was inside a box just like the 'Torrent speed limits' and 'Torrent share limits' options??
> 
> I'm neutral.

> 
> > Maybe it would look better if 'Save path' and 'Category' was inside a box just like the 'Torrent speed limits' and 'Torrent share limits' options??
> 
> To me it looks fine from the screenshots.

OK 👍 

IMO by having the autoTMM checkbox above 'Save path' and 'Category', makes it look ""unbalanced"" and that's why I made the suggestion.

Anyway, it's not important, so keep it as-is. 👍 

"
927124425,15452,thalieht,2021-09-25T13:50:54Z,">>Shouldn't the Categories also be moved here to have all the settings associated with AutoTMM in one place?
>
>What about tags?

Beyond my capabilities."
933073084,15452,Chocobo1,2021-10-04T01:23:46Z,"@thalieht 
The CI errors are strange, try do a `git rebase master`."
933361588,15452,thalieht,2021-10-04T10:43:36Z,"I had to re-add `#include ""base/utils/fs.h""`in transferlistwidget because of https://github.com/qbittorrent/qBittorrent/pull/15468/files#diff-e83414ad4feb1c631ab0dc80a872501d7a6888c87f4e5469fef2451bc6a54dfbR90"
938751399,15452,thalieht,2021-10-08T15:57:00Z,">An even bigger problem may be if it prevents someone from changing ""different categories"" to ""no category"".

I separated ""mixed categories"" from ""no category"" in the category combobox.
EDIT: Changed signal for category combobox from `QComboBox::currentIndexChanged` to `QComboBox::activated` because if the ""Currently used categories"" item was already selected and it was clicked again, it would fill the combobox with the text that should be placeholder.
/offtopic
You guys probably already know this but i worry you're re-reading the whole diff every time:
You can click on ""forced-pushed"" to see the diff from the last force push."
939327832,15452,glassez,2021-10-09T17:00:00Z,"> > An even bigger problem may be if it prevents someone from changing ""different categories"" to ""no category"".
> 
> I separated ""mixed categories"" from ""no category"" in the category combobox. EDIT: Changed signal for category combobox from `QComboBox::currentIndexChanged` to `QComboBox::activated` because if the ""Currently used categories"" item was already selected and it was clicked again, it would fill the combobox with the text that should be placeholder.

I'm sorry, I need more time to sort this out.
But first of all I would like to clarify the intended behavior. I am interested in whether we should allow some setting to return to its original state if it was ""mixed""? For example, should we allow the user to set the checkboxes to a ""grayed"" state after it has left it once? Or the category back to ""Currently used categories""?"
939354892,15452,thalieht,2021-10-09T20:04:58Z,"> I am interested in whether we should allow some setting to return to its original state if it was ""mixed""?

Yes IMO."
943411006,15452,FranciscoPombal,2021-10-14T14:25:50Z,"@thalieht (posting outside of the review sub-thread for more visibility)

> Yet another case i didn't consider. This change won't be enough. I thought about setting the current index of the category combobox to -1 for mixed and then check for it on `accept()` but this doesn't cover when someone wants to set ""no category"" with the keyboard in the lineedit (by removing whatever is in it which can't be done when it's empty). They'd have to select the empty item from the dropdown list. When every string can be a category, what can be put in the lineedit to denote mixed categories? A conundrum...

You could set the existing category save path as the placeholder text of the lineedits: https://doc.qt.io/qt-5/qlineedit.html#placeholderText-prop.

This way, I believe it is much easier to reason about the state of the lineedits.

- The lineedit never has text when the torrent options window loads, only placeholder text.
- If a torrent has a category, the placeholder text shows the category name.
- If a torrent doesn't have a category, the placeholder text shows `<No category>`
- If the dialog refers to multiple torrents, and there are mixed categories, the  the placeholder text shows `<Many categories>`/`<Mixed categories>`
- Same logic for the save path lineedit.

To allow people to change from ""mixed categories"" to ""no category"", add a `No category` checkbox that clears and disables the category lineedit when checked.

This should hopefully cover all edge cases while presenting an intuitive UX to the user.

EDIT: OK now that I've built it I see that you are actually already using placeholder text, missed that in my initial rushed scan of the code. Hopefully my other suggestions are useful."
944897590,15452,glassez,2021-10-16T10:58:30Z,"> > I am interested in whether we should allow some setting to return to its original state if it was ""mixed""?
> 
> Yes IMO.

But IIRC this is not implemented currently even for simpler properties! Why break your brain trying to do this in such a difficult case, if it will also generate inconsistency?"
944939658,15452,thalieht,2021-10-16T15:55:03Z,"@FranciscoPombal thanks for the comment. I'm not against placeholders but the way i've done things in this dialog, it would probably complicate the implementation... even more. I've set a placeholder for mixed categories because any string can be a category and i couldn't think of a good way to reset to mixed categories. I've thought about the checkbox or even a push button but thankfully, i found this way of setting the first item in the combobox as mixed and handling any interaction with it. It's not perfect because it can only be reset by selecting it from the combobox but it's the best i can think of.

I'm definitely open for suggestions on mixed categories placeholder text though (""--Currently used categories--"" at present) assuming @glassez doesn't make me remove it.

>But IIRC this is not implemented currently even for simpler properties! Why break your brain trying to do this in such a difficult case, if it will also generate inconsistency?

Well, checkboxes have it. Anyway i've already done it for categories. Are you telling me to remove it for... consistency?
It's not that i don't want to have it for everything, i just can't think of a good way to do it for the other properties."
947741257,15452,glassez,2021-10-20T14:46:40Z,">Well, checkboxes have it

Do you mean that the user can switch checkbox to `Qt::PartiallyChecked`? Well, then it should be available only if the checkbox was `Qt::PartiallyChecked` initially, otherwise it is meaningless/confusing.
>Anyway i've already done it for categories. 

Ok, let's leave it as is for now.
>i just can't think of a good way to do it for the other properties.

What controls do you mean exactly? Maybe they can have some ""special"" or empty value?"
947854303,15452,thalieht,2021-10-20T16:55:53Z,">Well, then it should be available only if the checkbox was Qt::PartiallyChecked initially

Of course, and that's how it is.
>What controls do you mean exactly? Maybe they can have some ""special"" or empty value?

Speed and share limits. Speed limits use the special value as ""inequality"" for mixed torrents and if the limit is changed, then it's used for ""no limits"", and share limits have no radiobutton checked for mixed. I can't find a way to allow users to uncheck a radiobutton (click on the currently checked to uncheck it so all radiobuttons are unchecked)."
948359667,15452,glassez,2021-10-21T08:02:42Z,"> I can't find a way to allow users to uncheck a radiobutton (click on the currently checked to uncheck it so all radiobuttons are unchecked).

IIRC, you can play with [QButtonGroup](https://doc.qt.io/qt-5/qbuttongroup.HTML). It allows you to have radio buttons unchecked when its ""exclusive"" property is set to `false`. Unfortunately you can't keep it always `false` since it allows you to check more than one radiobutton. But you can set it to `false` once already checked radio buttons is clicked and set it to `true` once unchecked radiobutton is clicked."
949515631,15452,thalieht,2021-10-22T10:55:06Z,@glassez thanks alot! Done.
964780685,15452,Chocobo1,2021-11-10T04:40:04Z,"@thalieht 
Thank you!"
1007922008,15452,debiedowner,2022-01-08T09:25:31Z,"Since @glassez mentioned his annoyance by the ""complaints about a couple of extra clicks, unless it is something that is really often used"", let me discuss why I used to use the ""Download in sequential order"" & ""Download first and last pieces first"" options in the context menu very often. Of course, while I think that my use case is reasonable, I don't know how common it is, but let me explain it anyway as a data point.

When adding a torrent of a media file, I usually select ""Download in sequential order"" in the Add Torrent dialog, in order to be able to preview the media file to make sure it's correct, ensure its quality etc. Once enough of the file is downloaded and I previewed it, I turn off the ""Download in sequential order"" option to let it download most optimally for the swarm. Occasionally, I find that the media file also needs the end of the file to open, in which case I select the ""Download first and last pieces first"" option. I don't select it in the Add Torrent dialog for all torrents, because often it is not needed, and it can take a long time in slow torrents and delay being able to preview the file, especially since #3816 significantly enlarged the percentage to be downloaded at the end and there is no option to decrease it.

So I used to use these two options at least once for *almost every single torrent*, often twice, and sometimes more. This change, which makes it more cumbersome to change these options, encourages me to leave the torrents at downloading sequentially. #164 has a lengthy discussion of why that might be bad. So I was disappointed to see that qBittorrent 4.4.0 pushes me to bad behavior for the health of the swarm, in addition to make things more inconvenient. Also, I am less likely to notice that I left the file downloading sequentially and I should change it, since now this information is hidden in the Torrent options dialog, whereas it used to be always in-my-face as it appeared as a check mark in the context menu.

In any case, I don't expect this change to be taken back, and if any options were to come back to the context menu, I guess those are more likely to be the Category option or maybe Set Location action, as they seem to be getting more complaints (#15946, #15965). Since the other two are unlikely two come back, I would at least love to be able to open the Torrent options more quickly, with a hotkey, as I mentioned in this issue: #15980"
1008072837,15452,glassez,2022-01-08T17:31:17Z,"> Since @glassez mentioned his annoyance by the ""complaints about a couple of extra clicks, unless it is something that is really often used""

Please don't take my words out of context. It really annoys me when it comes to things that are not so often used.


> let me discuss why I used to use the ""Download in sequential order"" & ""Download first and last pieces first"" options in the context menu very often

It is a pity that you (and everyone else who is affected by these changes) did not participate in this topic when it was opened. Well, I get your point. Apparently, we need to return these items to the context menu. Ideally, I would suggest making this menu configurable."
1008153245,15452,debiedowner,2022-01-08T21:05:05Z,"My apologies, re-reading what I wrote, I realized that quoting you in that fashion can be read like I am disagreeing with you, and even being confrontational, which was not at all what I intended. Of course you are right that complaining about extra clicks are pointless without making a case that they need to be used often. I started with that quote merely to give a justification for barging in to the discussion that is already finished; maybe if I had said ""Since @glassez rightfully mentioned his annoyance..."" it would be more in the tone I intended it, or better yet, I should have omitted it altogether.

And you are also right that I should have made this point earlier before this change was made. I recognize that I am late, that's why I didn't want to be one of those ""change was bad, reverse it"" people creating new issues and complaining. I had actually made peace with the fact that the decision was made to move them to the Torrent options dialog, so I was just proposing that a way to access that dialog more easily could soften the blow, as @thalieht had earlier discussed. I explained my reasons for using these two options often only to support that proposal, though I would of course be happy to see them return to the context menu."
1187426978,17389,glassez,2022-07-18T13:27:12Z,"@qbittorrent/bug-handlers
Could someone do preliminary tests?
Also, there is no message in the progress dialog yet, so I would like someone to suggest it."
1187749207,17389,ghost,2022-07-18T16:53:16Z,"Nice!
10k dummy torrents without any files restored in ~5 seconds!

I then went ahead and deleted all torrents when tracker announces were still in progress.
Noticed a issue where the status bar filters remained at 10000 and did not update.
Trackers sections also showed wrong info.

![Capture](https://user-images.githubusercontent.com/79678786/179562638-540b71f4-9b0d-4476-873e-310d9df42cc1.PNG)

**Edit:** This issue with filters does not occur on master."
1187762315,17389,thalieht,2022-07-18T16:58:49Z,"I tested with the 10k torrents from here https://github.com/qbittorrent/qBittorrent/pull/16840#issuecomment-1092623394.
- Tracker Error filter counter counted up at a steady pace but stopped at a non-fixed number fewer than the total amount of torrents (sometimes 100 sometimes 400 and anything in between).
- I deleted a massive amount of torrents at once (>7000) and some filter counters weren't updated or worse. As i said before the counter error filter was counting up at a steady pace and i think this was the number it had reached when i deleted the 7k:
![0651](https://user-images.githubusercontent.com/6451685/179556658-4c5f4b86-5813-46e5-87e0-bbf97505ea3e.png)
- When all 10k are resumed, there is a few second freeze after the loading progress bar where everything is frozen as before the ""improve startup"" PR and i can't interact with the GUI unless the progress bar is shown (at 100%) for those few seconds in the end but i suppose that's normal. Last few startups it's the second one and i don't know how to reproduce the first but i thought i should mention it just in case.
- It's unexpected to me that i can't minimize qBt while torrents are loading.
- First time i tested Minimize to tray + minimize on startup causes the startup progress bar to stop loading after i click the notification or the tray icon, don't remember what i did, and i can only click ""Cancel"" at which point it crashes. I can't reproduce again:
```
 0# boost::stacktrace::basic_stacktrace >::init at D:\a\qBittorrent\boost\boost\stacktrace\stacktrace.hpp:77
 1# getStacktrace at D:\a\qBittorrent\qBittorrent\src\app\stacktrace.cpp:35
 2# `anonymous namespace'::abnormalExitHandler at D:\a\qBittorrent\qBittorrent\src\app\signalhandler.cpp:103
 3# _seh_filter_exe at minkernel\crts\ucrt\src\appcrt\misc\exception_filter.cpp:219
 4# `__scrt_common_main_seh'::`1'::filt$0 at D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:304
 5# __C_specific_handler at D:\a\_work\1\s\src\vctools\crt\vcruntime\src\eh\riscchandler.cpp:389
 6# _chkstk in ntdll
 7# RtlRaiseException in ntdll
 8# KiUserExceptionDispatcher in ntdll
 9# QString::fromStdString in Qt6Core
10# BitTorrent::TorrentImpl::TorrentImpl at D:\a\qBittorrent\qBittorrent\src\base\bittorrent\torrentimpl.cpp:292
11# BitTorrent::Session::createTorrent at D:\a\qBittorrent\qBittorrent\src\base\bittorrent\session.cpp:5070
12# BitTorrent::Session::handleAddTorrentAlerts at D:\a\qBittorrent\qBittorrent\src\base\bittorrent\session.cpp:4942
13# BitTorrent::Session::readAlerts at D:\a\qBittorrent\qBittorrent\src\base\bittorrent\session.cpp:4895
14# QMetaCallEvent::placeMetaCall in Qt6Core
15# QObject::event in Qt6Core
16# QApplicationPrivate::notify_helper in Qt6Widgets
17# QApplication::notify in Qt6Widgets
18# QCoreApplication::notifyInternal2 in Qt6Core
19# QCoreApplicationPrivate::sendPostedEvents in Qt6Core
20# QWindowsGuiEventDispatcher::sendPostedEvents in Qt6Gui
21# QEventDispatcherWin32::processEvents in Qt6Core
22# QWindowsGuiEventDispatcher::processEvents in Qt6Gui
23# QEventLoop::exec in Qt6Core
24# QCoreApplication::exec in Qt6Core
25# Application::exec at D:\a\qBittorrent\qBittorrent\src\app\application.cpp:749
26# main at D:\a\qBittorrent\qBittorrent\src\app\main.cpp:270
27# WinMain at C:\Users\qt\work\qt\qtbase\src\entrypoint\qtentrypoint_win.cpp:97
28# __scrt_common_main_seh at D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:288
29# BaseThreadInitThunk in KERNEL32
30# RtlUserThreadStart in ntdll
```

>Also, there is no message in the progress dialog yet, so I would like someone to suggest it.

`Loading torrents...`?
 "
1187839058,17389,glassez,2022-07-18T17:22:34Z,"@thalieht 
As for the crash reported above.
You most likely use libtorrent-1.2 based build and you are under the issue mentioned by me in https://github.com/qbittorrent/qBittorrent/pull/17385."
1187863079,17389,thalieht,2022-07-18T17:28:50Z,">@thalieht
As for the crash reported above.
You most likely use libtorrent-1.2

No, the 2.0.6 from CI."
1187910378,17389,glassez,2022-07-18T17:42:09Z,"> > @thalieht
> > As for the crash reported above.
> > You most likely use libtorrent-1.2
> 
> No, the 2.0.6 from CI.

The same thing either. The fix is merged between 2.0.6 and 2.0.7."
1187998554,17389,xavier2k6,2022-07-18T18:07:32Z,@glassez It might be best to get https://github.com/qbittorrent/qBittorrent/pull/17385 merged first?!
1188106211,17389,glassez,2022-07-18T18:44:37Z,"> @glassez It might be best to get #17385 merged first?!

It matters only for testing using CI artifacts (and only for libtorrent-2.0 based builds).
Anyway this PR is currently draft and #17385 is already approved so it'll be merged soon."
1188129369,17389,xavier2k6,2022-07-18T18:54:39Z,">It matters only for testing using CI artifacts (and only for libtorrent-2.0 based builds).

I know, but sometimes it's easier/convenient that the builds are available via actions than building them ourselves...."
1191392915,17389,glassez,2022-07-21T11:55:10Z,"PR is updated. 
The issue with filters should be fixed now.
>It's unexpected to me that i can't minimize qBt while torrents are loading.

You can still hide/show it by clicking on tray icon.
If you really care about minimizing the only thing I can think of is to add minimize button to progress dialog and try to minimize both dialog and main window together (I'm not sure I'll be able to do it).
In any case, seeing progress dialog without the possibility of minimization is not such a bad option compared to a completely unresponsive UI, as it was before (before the ""Improve startup"" PR was merged)."
1191394565,17389,glassez,2022-07-21T11:56:58Z,"> Nice!
> 10k dummy torrents without any files restored in ~5 seconds!

Could you compare the startup speed of this PR and master branch on your machine under the same conditions?"
1191425700,17389,ghost,2022-07-21T12:30:36Z,"In master it took the same time.
However I noticed a bug in master
If I add 10k torrents at once (in paused state, torrent content and options dialogue disabled) and close the client too quickly(obviously after 10k torrent finished loading), then I do not have all 10k torrents on next start. But if I wait a few seconds after adding all 10k, then all torrents load up in next startup. I think the shutdown process cancels ongoing background job of adding torrents without notifying the user.
Edit: Most likely the resume data writing process gets cancelled."
1192287455,17389,glassez,2022-07-22T07:49:30Z,"> If you really care about minimizing the only thing I can think of is to add minimize button to progress dialog and try to minimize both dialog and main window together (I'm not sure I'll be able to do it).

Well, or go back to my idea to show only the progress window (which has a minimize button), and create the main window only after the session is restored."
1193243423,17389,ghost,2022-07-24T04:17:23Z,What would happen when someone actually wanted qBt to start minimized to tray icon? They wouldn't want to see the progress I guess.
1193245576,17389,glassez,2022-07-24T04:38:28Z,">What would happen when someone actually wanted qBt to start minimized to tray icon? They wouldn't want to see the progress I guess.

Currently they won't see any dialog unless clicked on tray icon."
1197720507,17389,glassez,2022-07-28T06:29:46Z,"> In master it took the same time.

Oops... I forgot to remove the extra delay that I originally used for testing with a small number of torrents:
https://github.com/qbittorrent/qBittorrent/blob/ccfcabadf376c9b617a1cd0caa96956b96144f64/src/base/bittorrent/dbresumedatastorage.cpp#L408
Otherwise, your results look strange. For me, the acceleration compared to the master is visible to the naked eye (but I did not measure it in detail)."
1197738436,17389,ghost,2022-07-28T06:53:20Z,">If I add 10k torrents at once (in paused state, torrent content and options dialogue disabled) and close the client too quickly(obviously after 10k torrent finished loading), then I do not have all 10k torrents on next start. But if I wait a few seconds after adding all 10k, then all torrents load up in next startup.
>
This bug still exist.

10k torrents restored in 2 seconds now! I consider this a great improvement!

However, if I turn on windows defender, it takes around a minute to restore all torrents.

Edit: the last statement is true only for the first startup after enabling defender. Subsequent ones take 2-3 seconds.
More edit: its also true after rebooting the system. defender seems to slow up qbt startup a lot!"
1197751069,17389,ghost,2022-07-28T07:07:48Z,">However, if I turn on windows defender, it takes around a minute to restore all torrents.
>

This issue does not happen with SQlite database. So I guess defender is scanning all those individual fastresume metafiles when qBt is accessing them and thus delaying the startup significantly.
One more reason to switch to SQlite by default maybe?
Also it seems with SQlite I don't even get the loading screen with 10k torrents..they just load up so damn fast!"
1197754147,17389,glassez,2022-07-28T07:11:08Z,"> > If I add 10k torrents at once (in paused state, torrent content and options dialogue disabled) and close the client too quickly(obviously after 10k torrent finished loading), then I do not have all 10k torrents on next start. But if I wait a few seconds after adding all 10k, then all torrents load up in next startup.
> 
> This bug still exist.

It is another issue, isn't it?"
1197757980,17389,glassez,2022-07-28T07:15:19Z,">This issue does not happen with SQlite database. So I guess defender is scanning all those individual fastresume metafiles when qBt is accessing them and thus delaying the startup significantly.
One more reason to switch to SQlite by default maybe?

https://github.com/qbittorrent/qBittorrent/discussions/16768
People still see some problems with it. However, it seems objective to me only the need for the possibility of creating backups while the application is running."
1198070984,17389,glassez,2022-07-28T12:24:11Z,"> Well, or go back to my idea to show only the progress window (which has a minimize button), and create the main window only after the session is restored.

It is ready in general terms.
It still doesn't fully follow the behavior of the main window and I really doubt that this is really required:
1. progress dialog has a minimize button, but it is always simply minimized to the taskbar regardless of the ""minimize to tray"" setting, you can minimize to the tray only by clicking on the tray icon itself (but it still does not start visible if both ""minimize to tray"" and ""start minimized"" settings are set);
2. <del>main window just starts depending on settings and not follows the current state of progress dialog (so if it is configured to start minimized to tray it is really started minimized to tray even if progress dialog was previously opened from tray by user).</del>"
1198636950,17389,glassez,2022-07-28T21:13:29Z,"@oorzkws, could you test and feedback it as well?"
1200346758,17389,oorzkws,2022-07-31T04:39:33Z,"Caveats: I built this on the current libtorrent RC.

Questions: 
1. It's not clear what will happen if I hit cancel on the loading pop-up. Does this cancel loading the torrents, exit the program, or something else? If it does exit, maybe changing ""cancel"" to ""exit"" would be appropriate?
2. I'm not seeing the progress bar move at all despite the numbers in the background showing progress being made (at this point, around half of my torrents have been rechecked and all are loaded).
![image](https://user-images.githubusercontent.com/65210810/182010326-e1d95e30-3efa-4c91-a03c-be5eb1ae2252.png)
Is this unimplemented, a bug, or something behavior wise that I'm misjudging?

Notes:
- I really appreciate that it respects the start minimized setting
- I haven't yet finished a whole load cycle, I'll update this comment if anything else comes up
"
1200347212,17389,glassez,2022-07-31T04:45:15Z,"> 2\. I'm not seeing the progress bar move at all despite the numbers in the background showing progress being made (at this point, around half of my torrents have been rechecked and all are loaded).

Seems you use wrong commit to test.
Now it shows only progress dialog until all torrents are loaded."
1200347491,17389,glassez,2022-07-31T04:47:21Z,">It's not clear what will happen if I hit cancel on the loading pop-up. Does this cancel loading the torrents, exit the program, or something else? If it does exit, maybe changing ""cancel"" to ""exit"" would be appropriate?

@Chocobo1, @qbittorrent/bug-handlers, should I change the button text?"
1200348077,17389,oorzkws,2022-07-31T04:51:54Z,"> > 2. I'm not seeing the progress bar move at all despite the numbers in the background showing progress being made (at this point, around half of my torrents have been rechecked and all are loaded).
> 
> Seems you use wrong commit to test. Now it shows only progress dialog until all torrents are loaded.

Thanks, I had done the build after you mentioned me initially. I'll rebuild on current."
1200351065,17389,ghost,2022-07-31T05:16:58Z,Maybe Cancel and exit is more appropriate. 
1200352435,17389,ArcticGems,2022-07-31T05:30:59Z,Maybe 'exit' is better than 'cancel' in this case.
1200355161,17389,oorzkws,2022-07-31T05:56:32Z,"![image](https://user-images.githubusercontent.com/65210810/182012330-e5c9eb37-e0ef-41f3-84d9-a0f26ecfc55e.png)
hm, rebuilt on the current commit and still not seeing progress. The window doesn't come up behind though so I'm not sure where I ""really"" am progress-wise. I'll give it some more time.

Edit: Now seeing progress, went from 0% to 100% quite quickly.
![image](https://user-images.githubusercontent.com/65210810/182012412-40b0543a-e288-43a2-86f7-f1ef8ae02462.png)

All in all, it seems a bit less useful than tracking by GUI numbers (primarily total torrent count and rechecking torrent count) but if it makes it load faster in general I'm all for it. Perhaps a number of n/total count would be useful in this dialog? Otherwise, no issues."
1200364760,17389,Chocobo1,2022-07-31T07:12:07Z,">Perhaps a number of n/total count would be useful in this dialog? 

👍 "
1200367747,17389,glassez,2022-07-31T07:34:33Z,"> > Perhaps a number of n/total count would be useful in this dialog?
> 
> 👍

So what is its use? How practically could you use these numbers?"
1200372355,17389,oorzkws,2022-07-31T08:08:00Z,"> > > Perhaps a number of n/total count would be useful in this dialog?
> > 
> > 
> > 👍
> 
> So what is its use? How practically could you use these numbers?

- Seeing the total count lets me verify that the client has recognized the correct amount of torrents
- Seeing the current count provides a more granular progress count (i.e. 1 of 32300 loaded stepping to 2 of 32300 loaded is more useful than 0% stepping to 0%)
- Having both pieces of information available lets me guesstimate the total load time or see if slowdowns are happening at certain points"
1200383014,17389,glassez,2022-07-31T09:04:43Z,">Seeing the total count lets me verify that the client has recognized the correct amount of torrents

Maybe it's important when you have 200K torrents, but still... How would you use this information before the app if completely loaded?
>1 of 32300 loaded stepping to 2 of 32300 loaded is more useful than 0% stepping to 0%

It is still updated once for several (dozens) torrents.


>Having both pieces of information available lets me guesstimate the total load time

Hardly much more accurate given the above (unless you have a lot of torrents on a very slow system).

>see if slowdowns are happening at certain points

Well, for example, it was slightly delayed at 678/10000. What practical benefit could you derive from this information?

In addition, it may make startup progress reporting less scalable. I mean, if the startup process will include any more tasks in the future.

EDIT:
It also seems to require more cumbersome logic to set progress dialog range..."
1200385152,17389,oorzkws,2022-07-31T09:16:45Z,"> > Seeing the total count lets me verify that the client has recognized the correct amount of torrents
> 
> Maybe it's important when you have 200K torrents, but still... How would you use this information before the app if completely loaded?

Mainly for power outages/crashes/instance migrations where that information is useful.

> > see if slowdowns are happening at certain points
> 
> Well, for example, it was slightly delayed at 678/10000. What practical benefit could you derive from this information?

Bug reports 😄 the last time I ran into something like this, I ended up parsing the log to graph torrents/minute loaded over a time period. Having a simple display for troubleshooting can mean a lot.

> In addition, it may make startup progress reporting less scalable. I mean, if the startup process will include any more tasks in the future.

At the end of the day, it's your call. If you see it as not being worth the time, that's fine - I'm just providing cases where such information has been useful to me.

"
1200386861,17389,glassez,2022-07-31T09:27:57Z,">At the end of the day, it's your call. If you see it as not being worth the time, that's fine - I'm just providing cases where such information has been useful to me.

Maybe leave ""detailed reporting"" for the further improvement? It requires more serious reflection, IMO."
1200387633,17389,oorzkws,2022-07-31T09:33:07Z,"> > At the end of the day, it's your call. If you see it as not being worth the time, that's fine - I'm just providing cases where such information has been useful to me.
> 
> Maybe leave ""detailed reporting"" for the further improvement? It requires more serious reflection, IMO.

That's fair. Things can always be refined, and the current iteration is plenty functional."
1200439743,17389,glassez,2022-07-31T14:47:56Z,">main window just starts depending on settings and not follows the current state of progress dialog (so if it is configured to start minimized to tray it is really started minimized to tray even if progress dialog was previously opened from tray by user).

Fixed.
Now if app started hidden but then user opens progress dialog and doesn't hide it again until session is restored main window will start as opened as well."
1200454448,17389,glassez,2022-07-31T16:13:41Z,"> It also seems to require more cumbersome logic to set progress dialog range...

Another disadvantage turns out to be that `QProgressDialog` uses the `int` type for the value, while the torrent loading code theoretically supports more torrents (at least with Qt6)."
1203462864,17389,glassez,2022-08-03T04:15:09Z,Thanks to all the reviewers and testers!
1203471249,17389,glassez,2022-08-03T04:30:47Z,"Now we are ready to v4.5 beta release.
Unfortunately, we have problems with compatibility with libtorrent-1.2 due to the fact that https://github.com/arvidn/libtorrent/pull/6897 is still not backported there (and I'm beginning to doubt that it will be). In any case, it would be nice to get your support in the mentioned PR (preferably, not just a thumbs up, but reasoned arguments). In any case, if it does not resolve in our favor, I will use a workaround, although in this case the startup performance will decrease."
1203572839,17389,oorzkws,2022-08-03T07:12:09Z,"> Now we are ready to v4.5 beta release. Unfortunately, we have problems with compatibility with libtorrent-1.2 due to the fact that [arvidn/libtorrent#6897](https://github.com/arvidn/libtorrent/pull/6897) is still not backported there (and I'm beginning to doubt that it will be). In any case, it would be nice to get your support in the mentioned PR (preferably, not just a thumbs up, but reasoned arguments). In any case, if it does not resolve in our favor, I will use a workaround, although in this case the startup performance will decrease.

I'll comment here so I don't clog the PR, but wouldn't a behavior change such as this (with a user claiming they had expectations based on previous, bugged, behavior) preclude the change from being backported? Since while it does fix a bug, it can be ""breaking"" in changing the behavior patterns for that branch."
1203671415,17389,glassez,2022-08-03T08:53:55Z,"> wouldn't a behavior change such as this (with a user claiming they had expectations based on previous, bugged, behavior) preclude the change from being backported? Since while it does fix a bug, it can be ""breaking"" in changing the behavior patterns for that branch.

Maybe I'm the one who is wrong, but for me, arguments like ""don't fix this error, as it will break my workaround for it"" don't look reasonable."
1203891894,17389,glassez,2022-08-03T12:35:08Z,"> In any case, if it does not resolve in our favor, I will use a workaround, although in this case the startup performance will decrease.

I suppose I still found a way to fix it without losing performance. See #17491."
1203900599,17389,ghost,2022-08-03T12:43:18Z,@glassez if we aim to release 4.5.0 beta with both RC1_2 and RC2_0 build then there would be a lot of builds for the user to choose from..I guess we should only make a qT6 and RC2_0 beta release of 4.5.0 and keep the RC1_2 and qT5 builds for 4.4.x series.
1204130700,17389,glassez,2022-08-03T15:44:59Z,"> I guess we should only make a qT6 and RC2_0 beta release of 4.5.0

I don't think it's a good idea to leave libtorrent-1.2/Qt5 based variants without public beta testing. I am sure that we will still have to produce ""stable"" releases of v4.5 branch based on them."
1207136347,17389,Chocobo1,2022-08-06T03:26:29Z,"@glassez 
I'm having a some crashes now. I have 0 torrents in qbt. And the crash occurs when starting qbt. Sometimes it will crash, sometimes it won't.
When qbt crashed, the startup progress dialog is shown with 100% along with the stackdump dialog.
Another weird problem is, when qbt started up successfully, the ""add .torrent file"" menu option & button is missing. Not sure if it is related to the same root issue.
Not sure if it is my own problem but I think it is worth looking in. 

qBittorrent version: v4.5.0alpha1 (64-bit) 7f40602da927bffcf38cbaaab4b8b111e747cec4
Libtorrent version: 2.0.7.0
Qt version: 6.3.1
Boost version: 1.79.0

Caught signal: SIGSEGV
```
 0# getStacktrace[abi:cxx11]() in ./qbittorrent
 1# 0x0000556FB6FD252F in ./qbittorrent
 2# 0x00007F4814A6DA40 in /usr/lib/libc.so.6
 3# 0x00007F48165F7A2E in /usr/lib/libQt6Gui.so.6
 4# QSystemTrayIcon::setContextMenu(QMenu*) in /usr/lib/libQt6Widgets.so.6
 5# MainWindow::MainWindow(IGUIApplication*, MainWindow::State) in ./qbittorrent
 6# 0x0000556FB6FC03A5 in ./qbittorrent
 7# 0x00007F48150BBA8B in /usr/lib/libQt6Core.so.6
 8# BitTorrent::Session::handleLoadedResumeData(BitTorrent::Session::ResumeSessionContext*) in ./qbittorrent
 9# QObject::event(QEvent*) in /usr/lib/libQt6Core.so.6
10# QApplicationPrivate::notify_helper(QObject*, QEvent*) in /usr/lib/libQt6Widgets.so.6
11# QCoreApplication::notifyInternal2(QObject*, QEvent*) in /usr/lib/libQt6Core.so.6
12# QCoreApplicationPrivate::sendPostedEvents(QObject*, int, QThreadData*) in /usr/lib/libQt6Core.so.6
13# 0x00007F4815288338 in /usr/lib/libQt6Core.so.6
14# g_main_context_dispatch in /usr/lib/libglib-2.0.so.0
15# 0x00007F48147FC001 in /usr/lib/libglib-2.0.so.0
16# g_main_context_iteration in /usr/lib/libglib-2.0.so.0
17# QEventDispatcherGlib::processEvents(QFlags) in /usr/lib/libQt6Core.so.6
18# QEventLoop::exec(QFlags) in /usr/lib/libQt6Core.so.6
19# QCoreApplication::exec() in /usr/lib/libQt6Core.so.6
20# Application::exec(QList const&) in ./qbittorrent
21# main in ./qbittorrent
22# 0x00007F4814A582D0 in /usr/lib/libc.so.6
23# __libc_start_main in /usr/lib/libc.so.6
24# _start in ./qbittorrent
```

gdb stack trace:
```
#0  0x0000000000000000 in  ()
#1  0x00007ffff765cbb5 in  () at /usr/lib/libQt6Gui.so.6
#2  0x00007ffff7ac2155 in QSystemTrayIcon::setContextMenu(QMenu*) () at /usr/lib/libQt6Widgets.so.6
#3  0x00005555558c7248 in DesktopIntegration::setMenu(QMenu*)
    (this=<optimized out>, menu=<optimized out>)
    at /home/user/qBittorrent/src/gui/desktopintegration.cpp:144
#4  0x00005555558dedbb in MainWindow::MainWindow(IGUIApplication*, MainWindow::State)
     (this=this@entry=0x5555561c5260, app=0x5555560a9ef0, initialState=initialState@entry=MainWindow::Normal)
    at /home/user/qBittorrent/src/gui/mainwindow.cpp:362
#5  0x00005555557083a5 in operator() (__closure=0x555556477870)
    at /home/user/qBittorrent/src/app/application.cpp:760
#6  QtPrivate::FunctorCall<QtPrivate::IndexesList<>, QtPrivate::List<>, void, Application::exec(const QStringList&)::<lambda()> >::call (arg=<optimized out>, f=...)
    at /usr/include/qt6/QtCore/qobjectdefs_impl.h:163
#7  QtPrivate::Functor<Application::exec(const QStringList&)::<lambda()>, 0>::call<QtPrivate::List<>, void> (arg=<optimized out>, f=...) at /usr/include/qt6/QtCore/qobjectdefs_impl.h:277
#8  QtPrivate::QFunctorSlotObject<Application::exec(const QStringList&)::<lambda()>, 0, QtPrivate::List<>, void>::impl(int, QtPrivate::QSlotObjectBase *, QObject *, void **, bool *)
    (which=<optimized out>, this_=0x555556477860, r=<optimized out>, a=<optimized out>, ret=<optimized out>) at /usr/include/qt6/QtCore/qobjectdefs_impl.h:444
#9  0x00007ffff6120a8b in  () at /usr/lib/libQt6Core.so.6
#10 0x000055555576ef8b in BitTorrent::Session::handleLoadedResumeData(BitTorrent::Session::ResumeSessionContext*) (this=0x555556322200, context=0x555556443ce0)
    at /home/user/qBittorrent/src/base/bittorrent/session.cpp:1158
#11 0x00007ffff6112ed0 in QObject::event(QEvent*) () at /usr/lib/libQt6Core.so.6
#12 0x00007ffff7a009dc in QApplicationPrivate::notify_helper(QObject*, QEvent*) ()
    at /usr/lib/libQt6Widgets.so.6
#13 0x00007ffff60ce088 in QCoreApplication::notifyInternal2(QObject*, QEvent*) ()
    at /usr/lib/libQt6Core.so.6
#14 0x00007ffff60cfcd8 in QCoreApplicationPrivate::sendPostedEvents(QObject*, int, QThreadData*) ()
    at /usr/lib/libQt6Core.so.6
#15 0x00007ffff62ed338 in  () at /usr/lib/libQt6Core.so.6
#16 0x00007ffff580ac6b in g_main_context_dispatch () at /usr/lib/libglib-2.0.so.0
#17 0x00007ffff5861001 in  () at /usr/lib/libglib-2.0.so.0
#18 0x00007ffff5808392 in g_main_context_iteration () at /usr/lib/libglib-2.0.so.0
#19 0x00007ffff62eb4d2 in QEventDispatcherGlib::processEvents(QFlags<QEventLoop::ProcessEventsFlag>) ()
    at /usr/lib/libQt6Core.so.6
#20 0x00007ffff60d7014 in QEventLoop::exec(QFlags<QEventLoop::ProcessEventsFlag>) ()
    at /usr/lib/libQt6Core.so.6
#21 0x00007ffff60d16ab in QCoreApplication::exec() () at /usr/lib/libQt6Core.so.6
#22 0x0000555555709c5d in Application::exec(QList<QString> const&)
     (this=this@entry=0x5555560a9ee0, params=...) at /home/user/qBittorrent/src/app/application.cpp:797
#23 0x00005555556d7633 in main(int, char**) (argc=<optimized out>, argv=<optimized out>)
    at /home/user/qBittorrent/src/app/main.cpp:270
```"
1207137981,17389,glassez,2022-08-06T03:37:42Z,"@Chocobo1
I'll take care of it ASAP."
1207204142,17389,glassez,2022-08-06T12:13:47Z,"@Chocobo1 
Couldn't reproduce it on Windows (but found other bug).
Will try on Linux as soon as I can."
1207240167,17389,glassez,2022-08-06T16:09:37Z,"@Chocobo1 
I found a bug. Fix is coming soon."
1207245180,17389,glassez,2022-08-06T16:44:35Z,"> @Chocobo1 I found a bug. Fix is coming soon.

Added as a second commit in https://github.com/qbittorrent/qBittorrent/pull/17498."
1224884470,17389,xavier2k6,2022-08-23T21:03:46Z,"@glassez Looking through CI logs, this PR seems to have introduced this: `D:/a/qBittorrent/qBittorrent/src/app/application.cpp:806: tr() cannot be called without context`

Currently in `master` it is now `Line 845`:
https://github.com/qbittorrent/qBittorrent/blob/752734362981fe125f76c478e6b277c3e9dbf506/src/app/application.cpp#L845"
1905034480,20314,luzpaz,2024-01-22T23:45:19Z,Commit has a typo in the title: dor -> for
1906809085,20314,pktiuk,2024-01-23T19:46:02Z,Should I also update API version?
1913348143,20314,pktiuk,2024-01-27T22:03:38Z,"@glassez  @thalieht 

Could you look at this code?"
1913480108,20314,glassez,2024-01-28T07:03:32Z,"> @glassez @thalieht
> 
> Could you look at this code?

It would be more clear and robust if it just returns content of given directory (only subdirectories if we don't need files).
Also it should be named based on what it does (e.g., get directory listing), not what it could be used for in any particular case (autocompletion etc.)."
1913628431,20314,pktiuk,2024-01-28T15:10:57Z,"@glassez   

> Also it should be named based on what it does (e.g., get directory listing), not what it could be used for

This is exactly why I used name autocompletion, because it completes provided paths. (not only lists directories)

> It would be more clear and robust if it just returns content of given directory

Maybe it is a better idea. Filtering paths can be done on the frontend side and seems to be a bit more universal."
1913630220,20314,glassez,2024-01-28T15:16:40Z,"> Filtering paths can be done on the frontend side and seems to be a bit more universal.

Exactly. It is enough to get the directory listing only once."
1913630485,20314,pktiuk,2024-01-28T15:17:26Z,Is it good now?
1913633953,20314,glassez,2024-01-28T15:27:18Z,"> Is it good now?

No.
I would expect that its parameter is the path to the target directory (i.e. the one whose list of subdirectories you want to get), and not to some of its file/subdirectory."
1913675256,20314,pktiuk,2024-01-28T17:58:34Z,"> > Is it good now?
> 
> No. I would expect that its parameter is the path to the target directory (i.e. the one whose list of subdirectories you want to get), and not to some of its file/subdirectory.

It should be good now."
1914332514,20314,glassez,2024-01-29T09:51:21Z,"@pktiuk 
Are you the one who intends to add some functionality to WebUI that would use this API?"
1914497524,20314,pktiuk,2024-01-29T11:27:30Z,"Yes, I want to implement it, but I would like deal with it later in separate PR.

AFAIK other WebUI-s may be also interested in this API (https://github.com/VueTorrent/VueTorrent/issues/1459 )."
1925432489,20314,pktiuk,2024-02-03T19:12:20Z,"A stupid mistake while pushing.    
Code should be fine now."
1944485807,20314,pktiuk,2024-02-14T19:48:03Z,"API Description to be pasted into wiki

### Get directory content

Name: `getDirectoryContent`

|Parameter| Type| Description|
|-|-|-|
|dirPath|string| Absolute path to directory|
|show|string|Define which elements should be listed: `all`, `files`, `dirs`|

Returns:

|HTTP Code|Scenario|
|-|-|
|200|Success|
|400|Invalid path|
|404|Directory not found|

In case of success, the response will be a JSON array with the names of elements in the directory.
For example `/api/v2/app/getDirectoryContent?dir_path=%2Fhome&show=all` could return:

```json
[""admin"",""johnny""]
```"
1944520270,20314,pktiuk,2024-02-14T20:14:13Z,"@glassez   @Chocobo1 

TBH I find setting up an environment for qBitTorrent really annoying and problematic (mainly because of the new QT, boost and libtorrent), so I created a simple Docker for development. Would you be interested in contribution with Dockerfile and simple instruction how to use it?  

 Later it could be used for creating easy configs for [devcontainers](https://code.visualstudio.com/docs/devcontainers/create-dev-container) and would allow app development using [Github Codespaces](https://github.com/features/codespaces/). It would make life for new developers much easier. "
1945324292,20314,glassez,2024-02-15T03:57:05Z,"> dir_path

Why to mix naming conventions? It should be `dirPath`.
BTW, just path should be clear enough within the context of `getDirectoryContent`."
1945325763,20314,glassez,2024-02-15T03:59:52Z,"> show

This name is more appropriate for UI than for API. IMO, it would be better to use something like `mode`."
1945757048,20314,pktiuk,2024-02-15T10:10:37Z,"> > dir_path
> 
> Why to mix naming conventions? It should be `dirPath`. BTW, just path should be clear enough within the context of `getDirectoryContent`.

Done"
1945934149,20314,Chocobo1,2024-02-15T11:45:11Z,">TBH I find setting up an environment for qBitTorrent really annoying and problematic (mainly because of the new QT, boost and libtorrent), so I created a simple Docker for development. Would you be interested in contribution with Dockerfile and simple instruction how to use it?

Although it is not for development, we already have something alike: https://github.com/qbittorrent/docker-qbittorrent-nox

>Later it could be used for creating easy configs for [devcontainers](https://code.visualstudio.com/docs/devcontainers/create-dev-container) and would allow app development using [Github Codespaces](https://github.com/features/codespaces/). It would make life for new developers much easier.

Speaking for myself:
* devcontainers 
  That probably would help other newcomers.
  However, I already have my own dev environment in Archlinux. Setting it up for qbt is dead easy and therefore I probably won't be maintaining devcontainers. You'll have to be sure that it won't rot through the test of time.
* Github Codespaces
  I'm not interested.
"
2083359317,20314,glassez,2024-04-29T18:13:46Z,"@pktiuk 
Thank you!"
788393533,14465,FranciscoPombal,2021-03-01T23:29:49Z,"Haven't tested this yet, but the CMake bits LGTM at first glance."
788608409,14465,glassez,2021-03-02T05:29:33Z,"> Haven't tested this yet

And you won't be able to do it, since it's not even going to be successfully built at this stage yet."
788811473,14465,xavier2k6,2021-03-02T10:42:34Z,"@glassez I dunno if you have already seen this or if it will be of any help to you:

https://www.qt.io/blog/porting-from-qt-5-to-qt-6-using-clazy-checks
https://doc.qt.io/qt-6/portingguide.html"
803038090,14465,glassez,2021-03-19T18:44:33Z,"@FranciscoPombal, can you adjust GitHub CI configuration for this PR?"
803983583,14465,xavier2k6,2021-03-22T11:16:40Z,"> @FranciscoPombal, can you adjust GitHub CI configuration for this PR?

VCPKG still doesn't have support for Qt 6.x.x as it's still a WIP ref.: [[Qt6] WIP: For people who want to try it out or help.](https://github.com/microsoft/vcpkg/pull/14333)

They will probably need some help over there...

A possible alternative could be https://github.com/martinrotter/qt-minimalistic-builds/releases for local building/testing?

Qt 6.0.3 should be out this week/latest next.."
804022830,14465,glassez,2021-03-22T12:25:09Z,"Well, it finally compiles successfully on Windows using official Qt 6.0.2 installation:

![01](https://user-images.githubusercontent.com/5063477/111989160-74d1fd80-8b22-11eb-9a52-6303b3339b31.png)

The first thing that catches your eye is the broken progress bars:

![02](https://user-images.githubusercontent.com/5063477/111989183-7d2a3880-8b22-11eb-8cba-66bb0be255d1.png)

![03](https://user-images.githubusercontent.com/5063477/111989190-7f8c9280-8b22-11eb-8fb5-70c46e374dcf.png)


"
804026989,14465,xavier2k6,2021-03-22T12:35:18Z,I wonder is that over the recent PR to change to `ProgressBarPainter` class?
804029628,14465,FranciscoPombal,2021-03-22T12:39:14Z,"> @FranciscoPombal, can you adjust GitHub CI configuration for this PR?

Sure, I'll use the current WIP version at https://github.com/microsoft/vcpkg/pull/14333. Hopefully it's usable."
804030202,14465,glassez,2021-03-22T12:40:16Z,"> I wonder is that over the recent PR to change to `ProgressBarPainter` class?

It still works fine in Qt5, doesn't it? But this is definitely due to its manual painting."
804031132,14465,glassez,2021-03-22T12:41:52Z,"@jagannatharjun, ping."
804037781,14465,xavier2k6,2021-03-22T12:53:31Z,">It still works fine in Qt5, doesn't it?

Just checked latest GHA Master & it behaves as expected...."
804043662,14465,jagannatharjun,2021-03-22T13:02:41Z,maybe because someone removed this flag in the current master https://github.com/qbittorrent/qBittorrent/commit/816bc4570727a761c1ca634e05895c0dcfb5bce7#diff-1e27babe637ab6712fed4277c12010effd1f1a9187c561905709366d1187feecR56
804124279,14465,glassez,2021-03-22T14:52:25Z,"> maybe because someone removed this flag in the current master [816bc45#diff-1e27babe637ab6712fed4277c12010effd1f1a9187c561905709366d1187feecR56](https://github.com/qbittorrent/qBittorrent/commit/816bc4570727a761c1ca634e05895c0dcfb5bce7#diff-1e27babe637ab6712fed4277c12010effd1f1a9187c561905709366d1187feecR56)

Good catch 👍 Confirmed.
@Chocobo1"
804130761,14465,Chocobo1,2021-03-22T15:00:30Z,"> > maybe because someone removed this flag in the current master [816bc45#diff-1e27babe637ab6712fed4277c12010effd1f1a9187c561905709366d1187feecR56](https://github.com/qbittorrent/qBittorrent/commit/816bc4570727a761c1ca634e05895c0dcfb5bce7#diff-1e27babe637ab6712fed4277c12010effd1f1a9187c561905709366d1187feecR56)
> 
> Good catch 👍 Confirmed.
> @Chocobo1

It looks like a Qt bug to me.
Maybe add `m_dummyProgressBar.setOrientation(Qt::Horizontal)` in `ProgressBarPainter::ProgressBarPainter()` or `styleOption.state = (option.state | QStyle::State_Horizontal);` if the first didn't work."
804132340,14465,glassez,2021-03-22T15:02:30Z,"I came across a crash related to the RSS subsystem. I'll try to debug it later. 
As for supporting other OSes, that's a problem for me. At least until I'm provided with a workable CI environment."
804135472,14465,Chocobo1,2021-03-22T15:06:19Z,"@glassez 
Maybe you can consider splitting some of this PR. I see some of the changes are eligible for merging by adding appropriate conditionals to Qt6. If we are lucky we might be able to support both Qt5 & Qt6 at the same time."
804135498,14465,glassez,2021-03-22T15:06:21Z,"> styleOption.state = (option.state | QStyle::State_Horizontal);

It helps. I tried it first before I wrote ""Confirmed"" above."
804137773,14465,Chocobo1,2021-03-22T15:09:23Z,">It helps. I tried it first before I wrote ""Confirmed"" above.

Please help yourself (adding a commit), I don't have Qt6 setup yet."
804152031,14465,xavier2k6,2021-03-22T15:27:48Z,@glassez Did you configure Qt `statically` or `dynamically`?
804160229,14465,glassez,2021-03-22T15:38:20Z,">Maybe you can consider splitting some of this PR. I see some of the changes are eligible for merging by adding appropriate conditionals to Qt6.

As I said before `Replace QStringRef with QStringView` contains the biggest and most inconvenient changes. Embedding it in the current codebase can generate a hell of a lot of conditional code. Besides, I don't know what we can do with the build systems to support both Qt versions at the same time."
804162133,14465,glassez,2021-03-22T15:40:50Z,"> @glassez Did you configure Qt `statically` or `dynamically`?

As I said before I use **official Qt installation**. It provides dynamic libraries."
806027164,14465,glassez,2021-03-24T17:40:10Z,"For those who want to test it on Windows, I can provide my custom build in the archive."
806147280,14465,xavier2k6,2021-03-24T20:00:29Z,"> For those who want to test it on Windows, I can provide my custom build in the archive.

Please do, It would be interesting to see if Qt6 fixes some of the GUI issues etc"
806151226,14465,glassez,2021-03-24T20:03:25Z,"> > For those who want to test it on Windows, I can provide my custom build in the archive.
> 
> Please do, It would be interesting to see if Qt6 fixes some of the GUI issues etc

How can I share it?"
806180077,14465,xavier2k6,2021-03-24T20:55:02Z,"> How can I share it?

Do you have dropbox?
Upload to mega?"
806864975,14465,glassez,2021-03-25T14:36:26Z,"https://yadi.sk/d/bHrZhmONznWKrQ
Please try this. If it doesn't work because of the lack of some runtime library, tell me what it requires more."
806972633,14465,xavier2k6,2021-03-25T15:42:18Z,"> https://yadi.sk/d/bHrZhmONznWKrQ
> Please try this. If it doesn't work because of the lack of some runtime library, tell me what it requires more.

@glassez Thank you, Have given it a quick whirl via `portable mode`

Seems some of the GUI issues that have been reported still remain (As I was expecting they would)"
814092157,14465,glassez,2021-04-06T12:47:47Z,"Now there is only one commit left with the code changes. Actually, it contains two types of changes: replacing `QString::SplitBehavior` with `Qt::SplitBehavior`, and replacing `QStringRef` with `QStringView`.
I can include these changes in the current codebase conditionally, which will generate a lot of such conditional constructs in the code. Either I do it in an unconditional form, but target these changes to the milestone where the Qt minimum version will be increased to the required level:
1. Qt 5.14 for `Qt::SplitBehavior`
2. Qt 5.15.2 for `QStringView`

What do you think about?"
814590221,14465,Chocobo1,2021-04-07T04:25:59Z,">Either I do it in an unconditional form, but target these changes to the milestone where the Qt minimum version will be increased to the required level

I would chose this.
"
814755292,14465,glassez,2021-04-07T09:20:38Z,"> > Either I do it in an unconditional form, but target these changes to the milestone where the Qt minimum version will be increased to the required level
> 
> I would chose this.

Then there is no point in doing this now, but only when the corresponding milestone is started.

In any case, I intend to rebase this PR from time to time and provide test builds."
814818517,14465,sledgehammer999,2021-04-07T11:00:28Z,"I am contemplating this plan: Ubuntu 21.04 LTS is going to be released sometime this month. There can be another **final** release in the v4.3.x series this month. Then we switch to 4.4.x and drop Ubuntu 20.04. Thus having as minimum Qt 5.14.
However, I don't yet know when we should support 5.15 only. We could also drop Ubuntu 20.10 for 4.4.x but IMO it sounds a bit strict atm.

>Qt 5.15.2 for QStringView

Are we depended on the various QStringView::toLong/Int etc functions or only to the ::split() function? If only ::split(), then it seems trivial to implement our own version of it for <5.15.2 targets."
814845664,14465,glassez,2021-04-07T11:41:24Z,">Are we depended on the various QStringView::toLong/Int functions or only to the ::split() function?

Not only `split()`."
815122098,14465,glassez,2021-04-07T18:15:41Z,"> There can be another **final** release in the v4.3.x series this month. Then we switch to 4.4.x and drop Ubuntu 20.04. Thus having as minimum Qt 5.14.

👍 
>However, I don't yet know when we should support 5.15 only. 

Maybe in qBittorrent v4.5? It is unlikely to be released before the fall of 2021.
I would prefer that we have a codebase that is fully compatible with both Qt 5 and 6 versions, for the lifetime of at least one minor version of qBittorrent."
815180476,14465,sledgehammer999,2021-04-07T19:49:34Z,">Maybe in qBittorrent v4.5? It is unlikely to be released before the fall of 2021.

Yeah. You wrote it just before I was able to comment again.

Plan:
4.3.x: One last release in April.
4.4.x: Drops Ubuntu 20.04, bumps Qt to 5.14. Expected EOL in the fall(~October)
4.5.x: Drops Ubuntu 20.10, bumps Qt to 5.15, and hopefully gets full Qt6 support for testing builds. Official releases will continue with Qt5. The switchover to 4.5.x should be around October probably, so it coincides with Ubuntu 21.10. 

The Qt6.2 LTS is supposed to be released in September. There's a possibility that it either gets slightly postponed or that the first version is not so smooth. Lastly, we aren't in a rush to officially switch to Qt6 from day one. But at least we should be ready as much as possible(code-wise). (and also keep an eye on Win7 usage at that time).

>I would prefer that we have a codebase that is fully compatible with both Qt 5 and 6 versions, for the lifetime of at least one minor version of qBittorrent.

:+1: "
816285711,14465,FranciscoPombal,2021-04-08T23:01:55Z,"@glassez `vcpkg` builds are close, just a few details left to be ironed out... see https://github.com/microsoft/vcpkg/pull/14333#issuecomment-816283043.

@sledgehammer999 Ubuntu 21.04 is not an LTS release. The next LTS release is 22.04. ""Supporting"" non-LTS Ubuntu releases (such as 20.10, 21.04, 21.10) is more or less irrelevant. The vast majority of people don't use them, and their lifecycle is only 9 months or something like that. If you want to drop support for the current LTS (20.04) so soon, might as well go straight to Qt6, and tell Ubuntu users that they will have to stick with the last release of the 4.3.x branch until next year (22.04 is basically guaranteed to support Qt6), or compile qBittorrent+Qt6 themselves."
816547073,14465,glassez,2021-04-09T09:18:58Z,">so soon, might as well go straight to Qt6, and tell Ubuntu users that they will have to stick with the last release of the 4.3.x branch until next year (22.04 is basically guaranteed to support Qt6), or compile qBittorrent+Qt6 themselves.

I wouldn't still drop Qt5 until qBittorrent officially supports libtorrent2. I.e. I want the last Qt5 based qBittorrent branch is libtorrent2 based one."
816981687,14465,sledgehammer999,2021-04-09T21:28:04Z,">Ubuntu 21.04 is not an LTS release. The next LTS release is 22.04.

Oops you're right. But still, Ubuntu's package staleness is hugely inconvenient for us. I don't think it is viable to continue supporting the latest LTS. It is too behind and the next one isn't coming soon enough."
817232360,14465,FranciscoPombal,2021-04-11T01:39:31Z,"@glassez @xavier2k6 

Here is a branch with vcpkg Qt6 builds for Windows and macOS: https://github.com/FranciscoPombal/qBittorrent/tree/glassez_qt6 (there's just 2 new commits on top of this PR). Actions run: https://github.com/FranciscoPombal/qBittorrent/actions/runs/737142829. It _should_ work (I only tested locally for Windows - https://github.com/microsoft/vcpkg/pull/14333#issuecomment-817217833). The ports used were from the WIP Qt6 PR: https://github.com/microsoft/vcpkg/pull/14333 (most recent commit at the time of writing). It was also necessary to apply a small patch to `src/CMakeLists.txt` due to a possible bug with Qt's detection of `zstd` (which we don't even use) - see the comments about it in the Qt6 vcpkg PR.

Feel free to integrate these changes (or some improved version of them) into your branch. This should be useful for getting some builds into people's hands automatically for testing until the vcpkg Qt6 PR gets merged; then we can drop the overlay ports of the Qt stuff."
817268750,14465,FranciscoPombal,2021-04-11T08:15:02Z,"@glassez Great news: the Windows build did indeed succeed for the run: https://github.com/FranciscoPombal/qBittorrent/actions/runs/737142829. Still no dice with the macOS build - I included it just in case though, but the reason it's failing is not related to qBIttorrent anyway."
817331519,14465,FranciscoPombal,2021-04-11T16:09:00Z,"@glassez

This is a blocker for macOS:

https://github.com/qbittorrent/qBittorrent/blob/650bf15db8f246f1ab236c839e1bf169034bd167/src/gui/mainwindow.cpp#L52

These headers don't exist anymore in Qt6, because all the platform-specific extras packages were removed (the features they provided were consolidated elsewhere).

EDIT: usages of deprecated/no longer existing QtMac stuff::

https://github.com/qbittorrent/qBittorrent/blob/650bf15db8f246f1ab236c839e1bf169034bd167/src/gui/macutilities.mm#L49

Ref:
https://doc.qt.io/qt-5/qtmac.html#fromCGImageRef

https://github.com/qbittorrent/qBittorrent/blob/650bf15db8f246f1ab236c839e1bf169034bd167/src/gui/mainwindow.cpp#L1612

Ref:

- https://doc.qt.io/qt-5/qtmac-obsolete.html#badgeLabelText

> This function is obsolete. It is provided to keep old source code working. We strongly advise against using it in new code.
>
>Use `NSApp.dockTile.badgeLabel` instead.
>
>Returns the text of the application icon a.k.a badge.

- https://doc.qt.io/qt-5/qtmac-obsolete.html#setBadgeLabelText

> This function is obsolete. It is provided to keep old source code working. We strongly advise against using it in new code.
>
>Use `NSApp.dockTile.badgeLabel` instead.
>
>Sets the text shown on the application icon a.k.a badge.
>
>This is generally used with numbers (e.g. number of unread emails); it can also show a string."
830598230,14465,glassez,2021-05-01T09:50:30Z,"@sledgehammer999
>4.4.x: Drops Ubuntu 20.04, **bumps Qt to 5.14**.

Is it still valid, or should we postpone it until v4.5?"
830834827,14465,sledgehammer999,2021-05-02T16:25:57Z,">Is it still valid, or should we postpone it until v4.5?

Yes. Unless something changed that I am not aware of. I am doing the 4.3.5 release now."
833333629,14465,xavier2k6,2021-05-06T08:23:10Z,"Both [**Qt 6.0.4**](https://download.qt.io/official_releases/qt/6.0/) & [**Qt 6.1.0**](https://download.qt.io/official_releases/qt/6.1/) are released.

**Qt 6.0.4** will be **last patch** release to **Qt 6.0 series**

ref:
https://lists.qt-project.org/pipermail/releasing/2021-April/002848.html"
851611426,14465,xavier2k6,2021-05-31T17:36:31Z,">4.3.x: One last release in April.

>release the 4.4.x series based on libtorrent2

@sledgehammer999 
What is the time frame for completely dropping support of qBittorrent versions built with libtorrent 1.2.x series?
Do you plan to run the batch tool again to close these issues?"
873563594,14465,xavier2k6,2021-07-04T10:44:11Z,"Qt 6.1.2 is almost ready to be merged on VCPKG

ref.:
https://github.com/microsoft/vcpkg/pull/18787"
873573405,14465,xavier2k6,2021-07-04T11:48:35Z,"@FranciscoPombal That ZSTD issue is still present with VCPKG's version of Qt 6.1.1......do we still have to patch it on our end? as no doubt it will still be there with there Qt 6.1.2 version.....

<details>
<summary>click to show ""ZSTD::ZSTD"" Issue</summary>

```
-- The following REQUIRED packages have been found:

 * LibtorrentRasterbar (required version >= 1.2.14)
 * Boost (required version >= 1.75)
 * double-conversion
 * OpenSSL
 * freetype
 * ZLIB
 * Qt6 (required version >= 6.1.1)

-- The following features have been disabled:

 * MSVC_RUNTIME_DYNAMIC, Use MSVC dynamic runtime library (-MD) instead of static (-MT) (default: ON)

-- Configuring done
CMake Error at C:/qbt_tools/vcpkg/scripts/buildsystems/vcpkg.cmake:544 (_add_executable):
  Target ""qbt_app"" links to target ""ZSTD::ZSTD"" but the target was not found.
  Perhaps a find_package() call is missing for an IMPORTED target, or an
  ALIAS target is missing?
Call Stack (most recent call first):
  src/app/CMakeLists.txt:27 (add_executable)


CMake Error at C:/qbt_tools/vcpkg/scripts/buildsystems/vcpkg.cmake:544 (_add_executable):
  Target ""qbt_app"" links to target ""ZSTD::ZSTD"" but the target was not found.
  Perhaps a find_package() call is missing for an IMPORTED target, or an
  ALIAS target is missing?
Call Stack (most recent call first):
  src/app/CMakeLists.txt:27 (add_executable)


CMake Error at C:/qbt_tools/vcpkg/scripts/buildsystems/vcpkg.cmake:582 (_add_library):
  Target ""qbt_base"" links to target ""ZSTD::ZSTD"" but the target was not
  found.  Perhaps a find_package() call is missing for an IMPORTED target, or
  an ALIAS target is missing?
Call Stack (most recent call first):
  src/base/CMakeLists.txt:1 (add_library)


CMake Error at C:/qbt_tools/vcpkg/scripts/buildsystems/vcpkg.cmake:582 (_add_library):
  Target ""qbt_base"" links to target ""ZSTD::ZSTD"" but the target was not
  found.  Perhaps a find_package() call is missing for an IMPORTED target, or
  an ALIAS target is missing?
Call Stack (most recent call first):
  src/base/CMakeLists.txt:1 (add_library)


CMake Error at C:/qbt_tools/vcpkg/scripts/buildsystems/vcpkg.cmake:582 (_add_library):
  Target ""qbt_gui"" links to target ""ZSTD::ZSTD"" but the target was not found.
  Perhaps a find_package() call is missing for an IMPORTED target, or an
  ALIAS target is missing?
Call Stack (most recent call first):
  src/gui/CMakeLists.txt:1 (add_library)


CMake Error at C:/qbt_tools/vcpkg/scripts/buildsystems/vcpkg.cmake:582 (_add_library):
  Target ""qbt_gui"" links to target ""ZSTD::ZSTD"" but the target was not found.
  Perhaps a find_package() call is missing for an IMPORTED target, or an
  ALIAS target is missing?
Call Stack (most recent call first):
  src/gui/CMakeLists.txt:1 (add_library)


CMake Error at C:/qbt_tools/vcpkg/scripts/buildsystems/vcpkg.cmake:582 (_add_library):
  Target ""qbt_webui"" links to target ""ZSTD::ZSTD"" but the target was not
  found.  Perhaps a find_package() call is missing for an IMPORTED target, or
  an ALIAS target is missing?
Call Stack (most recent call first):
  src/webui/CMakeLists.txt:1 (add_library)


CMake Error at C:/qbt_tools/vcpkg/scripts/buildsystems/vcpkg.cmake:582 (_add_library):
  Target ""qbt_webui"" links to target ""ZSTD::ZSTD"" but the target was not
  found.  Perhaps a find_package() call is missing for an IMPORTED target, or
  an ALIAS target is missing?
Call Stack (most recent call first):
  src/webui/CMakeLists.txt:1 (add_library)


-- Generating done
Generate graphviz: D:/a/qBittorrent/qBittorrent/build/target_graph.dot
CMake Generate step failed.  Build files cannot be regenerated correctly.
ninja: error: loading 'build.ninja': The system cannot find the file specified.


Error: Process completed with exit code 1.
````

</details>

**EDIT:**
Boost 1.76 is also almost ready from them too.
ref.:
https://github.com/microsoft/vcpkg/pull/17335

**EDIT2:**
Are VCPKG using **ZSTD** as a default for compression/decompression or perhaps as a **Zlib** wrapper?? (Just a thought)

**EDIT3:**
GitHub Actions CI to be ammended

`ci.yaml`

**To be renamed:**
`qt5-base` -> `qtbase`
`qt5-svg` -> `qtsvg`
`qt5-tools` -> `qttools`

**To be removed**
`""qt5-winextras:x64-windows-static-release""`
`""qt5-macextras:x64-osx-release""`

Qt 6, removed these modules `winextras`/`macextras` anyway.
ref.:
https://doc-snapshots.qt.io/qt6-dev/whatsnew60.html#removed-modules-in-qt-6-0"
873605896,14465,xavier2k6,2021-07-04T14:51:54Z,"~@FranciscoPombal Does github actions/VCPKG use `ccache`??~

ignore"
873614751,14465,FranciscoPombal,2021-07-04T15:47:39Z,"@xavier2k6 tbh I think the simplest way to avoid the zstd issue is to tell vcpkg to build Qt6 without the zstd feature, we don't use it anyway. AFAIK the issue has been reported upstream, but still not fixed.

Alternatively, we can workaround it with a small change to our CML (I think commenting out `set(CMAKE_FIND_PACKAGE_PREFER_CONFIG ON)` is enough), but this is sub-optimal."
873618368,14465,xavier2k6,2021-07-04T16:08:11Z,"I think Qt uses zstd as default compression algorithm now for The Qt Resource System

ref.:
https://bugreports.qt.io/browse/QTBUG-76389?jql=text%20~%20%22zstd%22"
873622420,14465,FranciscoPombal,2021-07-04T16:35:06Z,"@xavier2k6 

> I think Qt uses zstd as default compression algorithm now for The Qt Resource System
> 
> ref.:
> https://bugreports.qt.io/browse/QTBUG-76389?jql=text%20~%20%22zstd%22

I don't think there is a big impact on us either way.

Anyway, for future reference, here is the upstream Qt report about the FindZSTD CMake issue: https://bugreports.qt.io/browse/QTBUG-93604."
873622965,14465,xavier2k6,2021-07-04T16:39:13Z,">I don't think there is a big impact on us either way.

👍 

>Anyway, for future reference, here is the upstream Qt report about the FindZSTD CMake issue: https://bugreports.qt.io/browse/QTBUG-93604.

👍 

(Was just re-reading https://github.com/microsoft/vcpkg/pull/14333 when you posted, lol)
Thanks!"
873623072,14465,glassez,2021-07-04T16:40:05Z,"> we can workaround it with a small change to our CML

👎 "
873623481,14465,xavier2k6,2021-07-04T16:43:10Z,"> > we can workaround it with a small change to our CML
> 
> 👎

I believe @FranciscoPombal is only suggesting this as a temporary workaround in order to get GHA to make builds for testing purposes......not a permanent change?!"
873624161,14465,glassez,2021-07-04T16:48:25Z,"> I believe @FranciscoPombal is only suggesting this as a temporary workaround in order to get GHA to make builds for testing purposes......not a permanent change?!

GHA can make such changes in our CML ""on the fly"", doesn't it?"
873626164,14465,xavier2k6,2021-07-04T17:02:16Z,">GHA can make such changes in our CML ""on the fly"", doesn't it?

Not sure about that......

I'm not talking about the master branch etc - more our own repositories/branches to modify/create the test builds."
873631331,14465,FranciscoPombal,2021-07-04T17:38:55Z,"@glassez 

As I said before, I also don't want to go the ""modify our own CML to workaround a Qt bug"" route if it can be avoided. And it can be avoided quite easily, simply by telling vcpkg to build Qt without ZSTD support.

So this is not needed:

> GHA can make such changes in our CML ""on the fly"", doesn't it?

, even though it is also an escape hatch I am comfortable with using if push comes to shove (e.g., if for some reason we require Qt to have ZSTD support in the future or something like that)."
873657103,14465,xavier2k6,2021-07-04T20:32:05Z,@FranciscoPombal thank you for the CML workaround.....it worked.
874394834,14465,FranciscoPombal,2021-07-06T01:21:37Z,@glassez Over at https://github.com/glassez/qBittorrent/pull/1 we're now golden: https://github.com/FranciscoPombal/qBittorrent/actions/runs/1002417780
889786970,14465,xavier2k6,2021-07-30T10:06:10Z,"~@glassez If you rebase from master the Qt6 builds should work now since PR https://github.com/qbittorrent/qBittorrent/pull/15245 was merged.~

EDIT:
See https://github.com/qbittorrent/qBittorrent/pull/14465#issuecomment-889831355"
889831355,14465,xavier2k6,2021-07-30T11:31:33Z,"@glassez Apologies, I forgot that you have a separate Qt6 workflow file.

Change:
VCPKG_COMMIT: `b361c2eefa3966cb7cec45275aff32e90430aaa6` **to** `8dddc6c899ce6fdbeab38b525a31e7f23cb2d5bb` in `ci_qt6_win_mac_test.yaml`"
931222554,14465,xavier2k6,2021-09-30T11:08:03Z,"**This is only intended as a Reference/FYI**
____

- `Qt 6.2.0` [Announced / Released](https://www.qt.io/blog/qt-6.2-lts-released)

- `Qt 6.2.0` is the first release in the Qt 6.2 **LTS** Series & It's available to [download now](https://download.qt.io/official_releases/qt/6.2/6.2.0/)

- `Qt 6.2.0` [Release Notes](https://code.qt.io/cgit/qt/qtreleasenotes.git/about/qt/6.2.0/release-note.md)

- `Qt 6.2.1 / Qt 6.2.2` in [October / December](https://wiki.qt.io/Qt_6.2_Release#Qt_6.2_release_plan)
_____

- `Appveyor` should have Image available with `Qt 6.2.0` tomorrow `1st October`
- `VCPKG Qt 6.2.x Port` ~is still a WIP.~ Available as of `VCPKG_Commit: <35bfef7> 35bfef708400cf882efb3e4df93045e0a06c9c23`
(Not yet available in default vcpkg via GHA CI OS Environment Images)
____

`Qt 6.3` series in [March 2022](https://wiki.qt.io/Qt_6.3_Release#Qt_6.3_release_plan)"
932276692,14465,glassez,2021-10-01T14:24:47Z,"Now I believe it's time to merge it into the master. I changed it by making the build with Qt6 optional (CMake-only, via QT6 option), so that we can continue to have a single codebase for both Qt5 and Qt6 branches.
There is no CI support here. I don't have time and I don't want to deal with it - someone else can do it better than me. I have saved the old developments in a separate [branch](https://github.com/glassez/qBittorrent/tree/qt6-env), so you can use them as a basis if necessary.

"
932415397,14465,xavier2k6,2021-10-01T17:17:43Z,"For CI, We may be able to use something like [install-qt-action](https://github.com/jurplel/install-qt-action) across all OS's as there's no ppa/repo with Qt6 currently or we can build from source....."
932716925,14465,glassez,2021-10-02T08:53:07Z,I can't figure out what the hell is wrong with the Windows CI build. I have successfully built it locally with both Qt 6.2 and Qt 5.15.2.
932724478,14465,xavier2k6,2021-10-02T09:50:41Z,">I can't figure out what the hell is wrong with the Windows CI build.

It's because of Boost 1.77.0

Reference:
https://github.com/qbittorrent/qBittorrent/issues/15402

We need to probably discuss this further on what we should do going forward until Boost 1.78.0 is released in December with the included fix in `asio`......should we add the Qt macro temporarily etc."
932799205,14465,glassez,2021-10-02T18:28:34Z,">should we add the Qt macro temporarily etc.

👎 
I don't see any good reason to just mark some Boost versions as incompatible. These ""keywords"" (signal, slot , emit) are quite old and widely known, so that we can consider such problems as an external bug (bug of Boost in this case)."
932824594,14465,xavier2k6,2021-10-02T21:46:09Z,"@glassez Have a fix for windows CI....

@Chocobo1 Apologies - I actually got you to remove the fix in a way from your PR https://github.com/qbittorrent/qBittorrent/pull/15355 

>`vcpkgGitCommitId: 8dddc6c899ce6fdbeab38b525a31e7f23cb2d5bb  # dummy value for lukka/run-vcpkg`

I thought it wasn't being used at all & it wasn't really as `doNotUpdateVcpkg:` was set to `true`

If `vcpkgGitCommitId` is added back in to workflow with any `commit` e.g. commit (`3768cef9c204bb168c04b3ba7cb93b10a140a91d`) before Boost 1.77.0 was introduced & `doNotUpdateVcpkg:` is set to `false` this will override the pre-installed vcpkg.

This will allow windows CI to build with Boost 1.76 again.....we can turn `doNotUpdateVcpkg:` back to `true` when Boost 1.78.0 is released or if a `fix / workaround` is included in a newer vcpkg commit."
943431049,14465,octavedo,2021-10-14T14:47:24Z,"HTTP/2 is enabled by default, please see:
https://doc.qt.io/qt-6/network-changes-qt6.html

qBittorrent does not appear to handle HTTP/2.

I tested with the git dev branch of qt.

It will fail to download the tracker list in the ""Tracker addition dialog"" (please see below)
<img width=""485"" alt=""qt6 3"" src=""https://user-images.githubusercontent.com/78203028/137341183-d49c855d-8ddf-4029-8763-54315b2e3f26.png"">

I propose the attached patch to solve this problem.

diff -ruN -x .DS_Store src/base/net/downloadmanager.cpp src2/base/net/downloadmanager.cpp
--- src/base/net/downloadmanager.cpp	2021-10-14 13:49:32.000000000 +0100
+++ src2/base/net/downloadmanager.cpp	2021-10-14 14:05:07.000000000 +0100
@@ -115,6 +115,7 @@
     QNetworkRequest createNetworkRequest(const Net::DownloadRequest &downloadRequest)
     {
         QNetworkRequest request {downloadRequest.url()};
+	request.setAttribute(QNetworkRequest::Http2AllowedAttribute, false);
 
         if (downloadRequest.userAgent().isEmpty())
             request.setRawHeader(""User-Agent"", DEFAULT_USER_AGENT);

"
1780548290,19777,Chocobo1,2023-10-26T07:18:09Z,ps. I would try to review it on this weekend.
1781456647,19777,staze,2023-10-26T16:29:10Z,"> Note that credentials explicitly set to ""admin:adminadmin"" are considered as valid.

Will this prevent previous default credentials from working? "
1781464843,19777,glassez,2023-10-26T16:34:10Z,"> > Note that credentials explicitly set to ""admin:adminadmin"" are considered as valid.
> 
> Will this prevent previous default credentials from working?

Sorry, I don't understand the essence of the question...
The behavior is described in the OP. qBittorrent will no longer have default credentials. ""admin:adminadmin"" won't work anymore unless you explicitly configured qBittorrent to have such credentials."
1781499701,19777,staze,2023-10-26T16:57:58Z,"> > > Note that credentials explicitly set to ""admin:adminadmin"" are considered as valid.
> > 
> > 
> > Will this prevent previous default credentials from working?
> 
> Sorry, I don't understand the essence of the question... The behavior is described in the OP. qBittorrent will no longer have default credentials. ""admin:adminadmin"" won't work anymore unless you explicitly configured qBittorrent to have such credentials.

On new installs, makes perfect sense, there's no default, it'll be randomized, etc. 

But if you updated from a previous version, and have web enabled, the default credentials exist and are ""valid""... during the upgrade, does it check the hashed value of that password, say ""it's adminadmin, must be default"" and disable it? I'm trying to determine if the update process to whatever version will ""close"" the security vulnerability. "
1781552339,19777,glassez,2023-10-26T17:36:12Z,"> But if you updated from a previous version, and have web enabled, the default credentials exist

You don't seem to understand what the ""default credentials"" means. This only applies if there are no credentials explicitly specified in the configuration file."
1781572470,19777,staze,2023-10-26T17:51:36Z,"> > But if you updated from a previous version, and have web enabled, the default credentials exist
> 
> You don't seem to understand what the ""default credentials"" means. This only applies if there are no credentials explicitly specified in the configuration file.

I do. I just don't know how they're implemented in qbittorrent. 
If you don't set credentials on old versions, did it leave the credentials null and only accepted admin:adminadmin, or did it set them to admin:adminadmin? If the latter, then they're ""set in the configuration file"" and won't be invalidated by this patch... since you've said ""admin:adminadmin"" if explicitly set, is valid. 

I'm not sure how else to word this. If you can manually set ""admin:adminadmin"" as credentials (which, to me seems incorrect and should be prevented since it's a known, default, credential), how are we preventing the old default credentials from continuing to work if the user just upgraded from an old version rather than a new install?"
1781584039,19777,glassez,2023-10-26T18:00:02Z,"> I just don't know how they're implemented in qbittorrent.

If you don't set it there should be nothing in config file. Just test it yourself."
1781764725,19777,staze,2023-10-26T19:21:56Z,"gotcha. so the config file being null for that setting means it's not overriding the built in credentials. understood. 

would still argue that admin:adminadmin should be disallowed, but probably a discussion for another day. Thanks for the answers! =)"
1781776606,19777,glassez,2023-10-26T19:30:25Z,"> would still argue that admin:adminadmin should be disallowed, but probably a discussion for another day.

https://github.com/qbittorrent/qBittorrent/pull/18735#issuecomment-1773703618"
1793805716,19777,sledgehammer999,2023-11-05T18:04:15Z,"Further comments:

1. Will the HTML part of the WebUI fail if an empty password is being set via the config page?
2. For the old default credentials:
>If you can manually set ""admin:adminadmin"" as credentials
>>If you don't set it there should be nothing in config file. Just test it yourself.

I remember that in previous versions, before some internal refactoring, under some conditions the `preferences` backend would write even the default values to disk. Do you remember any details?
My point is that we may need to also blacklist ""adminadmin"" going forward, because it might have been inadvertently written to disk."
1793812030,19777,glassez,2023-11-05T18:33:26Z,"> I remember that in previous versions, before some internal refactoring, under some conditions the `preferences` backend would write even the default values to disk. Do you remember any details?

As far as I know, it is now being prevented from writing default values. Simply because it does not write the value if it matches the current one."
1793812570,19777,glassez,2023-11-05T18:36:07Z,"> My point is that we may need to also blacklist ""adminadmin"" going forward, because it might have been inadvertently written to disk.

Previously, it was suggested that it does not make sense to prohibit the user from doing this if he really wants to do so. I would prefer to refrain from adding anything else here, except the most necessary minimum. Someone else can improve it in the future if they want to."
1793812683,19777,glassez,2023-11-05T18:36:44Z,"> 1. Will the HTML part of the WebUI fail if an empty password is being set via the config page?

I'll check it later."
1793816024,19777,sledgehammer999,2023-11-05T18:52:48Z,">Previously, it was suggested that it does not make sense to prohibit the user from doing this if he really wants to do so. I would prefer to refrain from adding anything else here, except the most necessary minimum. Someone else can improve it in the future if they want to.

Sure but there is a difference between the user explicitly writing vs our code inadvertently writing default values.
For future reference: The solution could be as simple as `Preferences::getWebUIPassword()` returning an empty string even if the old default is explicitly written to disk.

>As far as I know, it is now being prevented from writing default values. Simply because it does not write the value if it matches the current one.

This doesn't account for installs that have their config file survive from the older behavior.

However, I recognize that this might not be a big enough userbase to warrant a relief effort."
1794204028,19777,glassez,2023-11-06T07:11:27Z,"> The solution could be as simple as `Preferences::getWebUIPassword()` returning an empty string even if the old default is explicitly written to disk.

Not only. We would also have to reject the user's attempts to set such a password.
> This doesn't account for installs that have their config file survive from the older behavior.
> 
> However, I recognize that this might not be a big enough userbase to warrant a relief effort.

Yes.
In addition, this is already a well-known problem and users have been officially warned about it."
1801184356,19777,glassez,2023-11-08T06:39:49Z,PR is rebased to resolve conflicts.
1801192349,19777,sledgehammer999,2023-11-08T06:48:40Z,">I have no idea on how to handle the WebUI-HTML part.

In case @Chocobo1 (or someone else) doesn't propose a reasonable solution, I am not against merging this PR as-is.

>I don't know how best to do the same on the WebUI. I should at least send there information about whether there is password configured at the moment (aka `has_webui_password_configured`).
>>Well, seems there is no such problem for WebUI. After all, in order to change these settings from the WebUI, the user must be logged in, i.e. some password is configured in any case (or a temporary one is used).

Unless, he accessed the webui because auth was disabled for local access and then he disabled that setting via the webui.
PS: I wouldn't mind the `has_webui_password_configured` solution if nothing else is proposed."
1801205766,19777,glassez,2023-11-08T07:02:09Z,"> Unless, he accessed the webui because auth was disabled for local access and then he disabled that setting via the webui.

I thought about this case. It still has a temporary password.
IMO, anything else is beyond the scope of this PR."
1801982940,19777,sledgehammer999,2023-11-08T14:18:48Z,">IMO, anything else is beyond the scope of this PR.

Can you consider the following change?
In
https://github.com/qbittorrent/qBittorrent/blob/28b5d7230c832f0ba5d798a3fff0e6e725bee782/src/webui/api/authcontroller.cpp#L86

Change the current `""Fails.""` string to `""Invalid Username or Password.""`
Then add an additional specialized check for failure while on tempPassword. In that case the string should be something like `""A temporary password has been generated because no password has been configured. Find it in the console output. Restarting qBittorrent will generate a new temporary password.""`

And finally change https://github.com/qbittorrent/qBittorrent/blob/28b5d7230c832f0ba5d798a3fff0e6e725bee782/src/webui/www/public/scripts/login.js#L51
to
```javascript
errorMsgElement.textContent = xhr.responseText;
```

This way the user won't be dumbfounded on why he can't login anymore."
1802101712,19777,glassez,2023-11-08T15:19:08Z,"> This way the user won't be dumbfounded on why he can't login anymore.

I wouldn't do anything more than announce on the official website that ""default"" credentials are no longer supported. 
Moreover, your proposal will lead to incompatible API changes in a minor update which is bad idea.
@Chocobo1, what do you think?"
1802191558,19777,sledgehammer999,2023-11-08T16:01:42Z,"I don't think it is an incompatible API change. Especially if you look the JS code around the linked line.
Currently the API responses:
1. HTTP 403 + (may have response text attached, I didn't check code)-> User's IP is banned for too many failed login attempts
2. HTPP 200 + Response text ""Ok."" -> logged in
3. HTPP 200 + Response text ""Fails."" -> log failure, presumably invalid user/pass

New:
4. HTPP 200 + Response text ""Specialized error string"" -> log failure, explained in response text

The breakage would happen if we changed the log success response.

PS: I amend my previous comment. `Fails.` should stay. Only add a specialized response for temp password failure."
1802213772,19777,glassez,2023-11-08T16:13:28Z,"> The breakage would happen if we changed the log success response.

Some WebAPI users can legitimately count on the fact that it has only two options, `Ok` or `Fails`, and, for example, determine an unsuccessful result only by testing it for `Fails`. So these are incompatible changes if it will return something else.
And, by the way, it is incorrect to judge such things based on the built-in WebUI. If we only cared about it, we would not need to talk about any compatibility of the API changes."
1802344580,19777,sledgehammer999,2023-11-08T17:29:43Z,"Sadly you're correct:
https://github.com/bill-ahmed/qbit-matUI/blob/34610c40289ef8c107fad4e06c8d840c5069ae5b/projects/login/src/app/login-page/login-page.component.ts#L74-L75"
1807101435,19777,sledgehammer999,2023-11-12T11:41:43Z,"Closes #13833
Closes #16529
Closes #18731
Closes #19738"
1782900772,19801,glassez,2023-10-27T13:16:30Z,">while opening this PR i was redirected to [CODING_GUIDELINES.md](https://github.com/qbittorrent/qBittorrent/blob/35e4b35d125983051a25173d595119d99b7bda3a/CODING_GUIDELINES.md) Which encourages me to use `uncrustify`,

Note that `uncrustify` does not guarantee full compliance with our coding style. Just read [CODING_GUIDELINES.md](https://github.com/qbittorrent/qBittorrent/blob/35e4b35d125983051a25173d595119d99b7bda3a/CODING_GUIDELINES.md) and follow it in your code contribution."
1792612561,19801,luzpaz,2023-11-03T15:07:36Z,ping @jNullj 
1793067581,19801,jNullj,2023-11-03T20:39:57Z,"> ping @jNullj

Thank you for the reminder, I may be able to fix the PR this sunday."
1831845811,19801,ASTX111,2023-11-29T12:55:35Z,Any idea when this might be coming? It would be a great update to the appliacation! <3
1832558715,19801,jNullj,2023-11-29T19:22:47Z,"Due to my new job, my GitHub activity has decreased. Apologies for delays. I'll aim to resume work this weekend. Feel free to co-commit or suggest changes. If maintainers feel the need to edit or create a separate PR due to my pace, I understand. Thanks for your patience."
1839510029,19801,jNullj,2023-12-04T21:30:23Z,"Updated the PR:
Resolved all suggestions by @Chocobo1 at https://github.com/qbittorrent/qBittorrent/pull/19801/commits/8510d962de7a997b239bbb54488feefc5a353946 to https://github.com/qbittorrent/qBittorrent/pull/19801/commits/e1d5d28fd9f8ab2520444cf5f5ccc68029e82085
I fixed the issue spotted by @glassez 
Added code to update existing delay when the value is changed and merged latest master commits as well."
1880469203,19801,glassez,2024-01-08T06:56:31Z,"Unfortunately, I have found that these changes have ""opened the door"" to undefined behavior and/or race conditions. I want to make some preliminary changes in separate PR, and when it is merged, we will continue with this one."
1886597291,19801,glassez,2024-01-11T08:19:42Z,"> I want to make some preliminary changes in separate PR

#20257"
1886604654,19801,glassez,2024-01-11T08:25:28Z,"@jNullj 
It looks like the place where you originally inserted the timer code was the best choice. The illogic that confused me was caused by the inappropriate naming of some things, so I corrected them in #20257. I added the timer code there in advance (with zero timeout), so all you have to do is add the code for setting the configured timeout."
1888608776,19801,jNullj,2024-01-12T08:00:54Z,"No problem, i will update it after #20257  is merged to avoid reworking this pr if it changes before that.
I noticed you included a copyright notice update, should i add my (and co-authors) name/year in the files once i update them?"
1888651337,19801,glassez,2024-01-12T08:31:55Z,"> should i add my (and co-authors) name/year in the files once i update them?

Your - yes.
Are there any co-authors who have made significant contributions to it? Or do you mean those who offered some tips on correcting the coding style, etc.?"
1888755585,19801,jNullj,2024-01-12T09:41:07Z,"> > should i add my (and co-authors) name/year in the files once i update them?
> 
> Your - yes. Are there any co-authors who have made significant contributions to it? Or do you mean those who offered some tips on correcting the coding style, etc.?

Those who offered some tips on correcting the coding style, as in those who reviewed my code and offered changes.
All changes i made which you did not offer, I created myself.
"
1888832381,19801,glassez,2024-01-12T10:27:27Z,"> Those who offered some tips on correcting the coding style, as in those who reviewed my code and offered changes.

If the proposed changes are trivial, such as correcting the coding style, then we do not take this into account as co-authorship."
1890333031,19801,glassez,2024-01-13T05:57:18Z,"@jNullj 
#20257 has just merged."
1900824404,19801,glassez,2024-01-19T17:38:36Z,"@jNullj 
Thank you!"
1905674702,19801,HanabishiRecca,2024-01-23T09:47:17Z,@glassez 
68049790,2332,sledgehammer999,2014-12-24T12:37:55Z,"@qbittorrent/webdev any comments?
"
68051188,2332,pmzqla,2014-12-24T13:08:15Z,"Would it be possible to have more commits with smaller changes next time? I think it greatly simplify the review of the code (I maybe tend to overdo it sometimes).

Anyway, for now I simply tested the changes and everything seems to work as before from a user point of view.
"
68143010,2332,glassez,2014-12-26T14:29:22Z,"Here are a few observations:
1. The **session** should only be considered as a data store in which something can be stored between requests (as in usual web applications).
2. Too much logic made in **action** code. Compare with `action_json_torrents`. Here we are, in a good way, simply call some function from `btjson`, and pass your `rid` and some data from the **session** (for example, the previous response) as arguments.
3. PartialResponseGenerator has a redundant interface.
"
68166262,2332,buinsky,2014-12-27T02:22:00Z,"> 1. The session should only be considered as a data store in which something can be stored between requests (as in usual web applications).

@glassez, please prompt me where should I store PartialResponseGenerator objects and how to link them to the session?

> 1. PartialResponseGenerator has a redundant interface.

Could you explain more?
"
68187797,2332,glassez,2014-12-27T19:31:59Z,"> Could you explain more?

I have little free time this weekend, but if you can wait a bit, I will explain everything in detail.
"
68189314,2332,sledgehammer999,2014-12-27T20:29:13Z,"@glassez I won't merge this until you have explained yourself and everything gets resolved. I don't mind waiting. Its better than rushing broken code.

@qbittorrent/webdev Sorry for hijacking this thread. There isn't any other way to contact you AFAIK.
I know that some of you are busy. But if you have time and aren't bored you could start populating the wiki with the new info about the WebUI API.
Here is the old page: https://github.com/qbittorrent/qBittorrent/wiki/WebUI-API-Documentation
You guys are far more qualified to write the documentation.
Make sure to make 2 new subpages in the above page. One leading to the current documentation and one to the new documentation.
AFAIK, there are at least 2 android apps using the WebUI API...
"
68311636,2332,sledgehammer999,2014-12-29T22:42:42Z,"@buinsky since you mention 4 points in your description, could you split your commit accordingly?
"
68313088,2332,buinsky,2014-12-29T23:00:29Z,"> since you mention 4 points in your description, could you split your commit accordingly?

@sledgehammer999 , I can do it, but logic of the program will be broken without any commit (they will be strongly linked). May be it will be better to keep all code changes in one commit?
"
68313549,2332,sledgehammer999,2014-12-29T23:06:10Z,"If the changes cannot be split into functioning subcommits then you should leave it as one I suppose.
EDIT: It just seemed from your description that you have implemented different and separate things.
"
68315027,2332,buinsky,2014-12-29T23:26:41Z,"> It just seemed from your description that you have implemented different and separate things.

@sledgehammer999 , if I will write preliminary commit, which will remove some functionality of WebUI such as displaying torrents, hiding priority column, receiving torrents info, than it will be possible to split my commit because my commit overrides all this functionality.
"
68428629,2332,glassez,2014-12-31T07:51:48Z,"Now, as for class interface...

``` C++
public:
    QVariant response;
    QVariant previousResponse;
```

Don't use public fields - usually we make them private, but use public getters/setters if necessary.

``` c++
if (prg.getResponseId() == processed_response_id)
    prg.createResponse();
else if (prg.getPreviousResponseId() != processed_response_id)
    prg.previousResponse.clear();
```

getResponseId() and getPreviousResponseId() is not needed outside of class, as well as all the code fragment above.
In General, if you look at the task as a whole, your class (I mean the primary function of it - generatePartialResponse()) must take three input parameters - rid, the previous response and current response - and to return some result (partial response). Everything else is of no interest to us (I mean code external to the class) - it is the details of its implementation.
"
68429398,2332,glassez,2014-12-31T08:16:31Z,"Other comments...

``` c++
#define TO_MAP(x) (*(QVariantMap*)((x).constData()))
#define TO_HASH(x) (*(QVariantHash*)((x).constData()))
#define TO_LIST(x) (*(QVariantList*)((x).constData()))
```

Your hack doesn't do any good, and only complicates the code. Many C++ classes in Qt (including QVariant) use implicit data sharing, so simple operations (assignment, passing as a function argument or return from a function) does not produce a real copy of the data. See [Implicit Sharing](http://qt-project.org/doc/qt-4.8/implicit-sharing.html).
"
68429868,2332,buinsky,2014-12-31T08:31:08Z,"@glassez , can you give me an example, that shows how to write the following code without macroses:

``` cpp
void PartialResponseGenerator::processMap(bool& hasChanges, QVariantMap &partial, QVariantMap &prevData, QVariantMap &data)
{
...
processHash(changes, TO_LIST(partial[key]), TO_HASH(prevData[key]), TO_HASH(data[key]), removedKeys);
...
}
```
"
68430022,2332,buinsky,2014-12-31T08:35:53Z,"@glassez also, can you propose way to link PartialResponseGenerator objects to session (PartialResponseGenerator objects must be created and destroyed with the session) without putting them  into WebSession class?
"
68436807,2332,glassez,2014-12-31T11:26:25Z,"> @glassez , can you give me an example, that shows how to write the following code without macroses

``` c++
processHash(changes, partial[key].toList(), prevData[key].toHash(), data[key].toHash(), removedKeys);
```
"
68436935,2332,glassez,2014-12-31T11:29:53Z,"> PartialResponseGenerator objects must be created and destroyed with the session

It is not necessary. As I mentioned in the session it is better to store any data. Instance of PartialResponseGenerator can be created with every request.
"
68438140,2332,glassez,2014-12-31T12:01:23Z,"@buinsky And yet...
I think your implementation PartialResponseGenerator you have abstracted from the actual data structures that handle many of its functions. Here it is also only complicates the code. We are not just some abstract QVariant, which can contain anything - here is a concrete data structure. If you remember this, you can make everything much easier and more efficient.
`labels` and `queueing` better to pass through a separate request - it is a separate task.

I think you'd better not to dwell on your current implementation, and to try to create everything from scratch, taking into account all the comments. If you want, I can sum up how it should work.
"
68438787,2332,buinsky,2014-12-31T12:19:12Z,"> ``` cpp
> processHash(changes, partial[key].toList(), prevData[key].toHash(), data[key].toHash(), removedKeys);
> ```

@glassez , partial[key].toList() will create a copy of QVariantList, but I need to modify the source data.

> Implicit sharing automatically detaches the object from a shared block if the object is about to change and the reference count is greater than one. (This is often called copy-on-write or value semantics.)
"
68439088,2332,buinsky,2014-12-31T12:26:41Z,"> `labels` and `queueing` better to pass through a separate request - it is a separate task.

It's convenient to receive this data with torrents for immediate update of info related to torrents. I plan to add label column to torrents list. What if new label will displayd in torrents list, but labels list will not updated immediately? I think, WebUI shouldn't work this way.
"
68439188,2332,buinsky,2014-12-31T12:29:43Z,"> Instance of PartialResponseGenerator can be created with every request.

It can't because instance of PartialResponseGenerator must track what data have processed by the client.
"
68439845,2332,buinsky,2014-12-31T12:45:03Z,"> I think your implementation PartialResponseGenerator you have abstracted from the actual data structures that handle many of its functions.

PartialResponseGenerator can be used to cut any json responses with repeating data. This is what it is made for.

By the way, uTorrent WebUI also uses shortened responses.
"
68441492,2332,buinsky,2014-12-31T13:24:45Z,"@glassez I plan to make changes in the commit in a few days. I will ask you to review changes then.
"
68445958,2332,glassez,2014-12-31T14:52:42Z,"> @glassez , partial[key].toList() will create a copy of QVariantList, but I need to modify the source data.

Oh, sorry. Here I was a bit hasty. I wanted to write one thing and wrote another...
So `partial` here is pure output value, it is better to return it from a function as a return value. But since several such values, it is possible to change the parameter type to QVariant&, and put there QVariantList inside the function.
P.S. It is better not to mix the input and output parameters with each other in the function declaration.
"
68481168,2332,buinsky,2015-01-01T06:18:33Z,"> But since several such values, it is possible to change the parameter type to QVariant&, and put there QVariantList inside the function.

This does not relieve us from using the constData function. I suppose that better to use macroses for compacting the code.

>  in a good way, simply call some function from `btjson`, and pass your `rid` and some data from the session (for example, the previous response) as arguments.

I think that better to keep previous and current response in PartialResponseGenerator class and not to create new objects for storing responses. I don't khow where better to keep PartialResponseGenerator objects, but WebSession is convenient place.

@glassez I changed my commit. Please review it.
"
68486062,2332,glassez,2015-01-01T12:59:18Z,"@buinsky Apparently, you do not want to understand what I'm trying to say...
So now I'm just going to list things that are wrong in principle, and not because you use it here.
1. QVariant::constData() is a public member of a class, but it is ""not recommended"" for use (not for nothing that the developers of Qt do not mention it in the documentation). Using raw pointers generally very dangerous thing. If you can't do without using of constData(), it does not mean that this cannot be done.
2. We should not do something with class data from outside. With proper class design we should not have such opportunities. As a consequence, we should not make public fields in the class (unless ABSOLUTELY necessary).

These are the main disadvantages. I'm not even going to pay attention to the smaller ones. Also, I did not look at the client code (and don't want to do).
"
68488397,2332,buinsky,2015-01-01T14:55:22Z,"@glassez 
1. I understand that constData() is ""not recommended"" for use, but all perfectly works. Could you propose another method of direct access data stored in QVariant? If you can't do it, lets leave all as is.
2. I fixed this issue if you're talking about PartialResponseGenerator.

@sledgehammer999 Could you express your opinion about using constData()?
"
68495031,2332,glassez,2015-01-01T19:10:10Z,"You do not want to (or can't) understand me. I say that it's wrong and must be done correctly. And you - I understand that it's wrong, tell me how to do wrong in another way. Not to do wrong!

> Could you propose another method of direct access data stored in QVariant?

**Direct access data stored in QVariant** is wrong. And (most importantly) you can easily do without it.

> 1. I fixed this issue if you're talking about PartialResponseGenerator

And what do you think of this?

``` c++
QVariantMap *PartialResponseGenerator::createResponse(int processedResponseId)
{
    //...
    return (QVariantMap *)response.constData();
}
```

Unfortunately, now I'm away from my main computer, but otherwise I would have corrected your code and show how you can do. Perhaps later I will show it here in part, only basic fragments.

> ...lets leave all as is.

I'm not project maintainer. Perhaps @sledgehammer999 will merge this.
"
68495889,2332,sledgehammer999,2015-01-01T19:41:24Z,"I was hoping to not really read WebUI code. And glassez knows better the in and outs of it.
But anyway I'll review this (not necessarily today).
@buinsky I need a simple thing from you. I want you to explain to me simply how the partial request/response is supposed to work. (maybe an example). Then I'll be able to understand better what you are trying to achieve AND if you try to achieve it correctly.
PS: I agree that we must not use non-documented API.
"
68495929,2332,glassez,2015-01-01T19:43:16Z,"Here is one of such fragments.
Your code

``` c++
QByteArray btjson::getTorrentsPartial(PartialResponseGenerator &prg, int processedResponseId)
{
    QVariantMap &response = *prg.createResponse(processedResponseId);
    response[""torrents""] = QVariantHash();
    QVariantHash &torrents = TO_HASH(response[""torrents""]);

    std::vector<torrent_handle> torrentsList = QBtSession::instance()->getTorrents();
    std::vector<torrent_handle>::const_iterator it = torrentsList.begin();
    std::vector<torrent_handle>::const_iterator end = torrentsList.end();
    for(; it != end; ++it) {
        QTorrentHandle torrent = QTorrentHandle(*it);
        torrents[torrent.hash()] = (toMap(torrent));
    }
    //...
    response[""queueing""] = QBtSession::instance()->isQueueingEnabled();

    response[""labels""] = QVariantHash();
    QVariantHash &labels = TO_HASH(response[""labels""]);
    QStringList labelsList = Preferences::instance()->getTorrentLabels();
    for (int i = 0; i < labelsList.length(); i++)
        labels[labelsList[i]] = labelsList[i];

    return prg.generatePartialResponse();
}
```

can be replaced with

``` c++
QByteArray btjson::getTorrentsPartial(int rid, QVariantMap &lastResponse)
{
    QVariantMap response;

    QVariantHash torrents;
    std::vector<torrent_handle> torrentsList = QBtSession::instance()->getTorrents();
    std::vector<torrent_handle>::const_iterator it = torrentsList.begin();
    std::vector<torrent_handle>::const_iterator end = torrentsList.end();
    for(; it != end; ++it) {
        QTorrentHandle torrent = QTorrentHandle(*it);
        torrents[torrent.hash()] = toMap(torrent);
    }
    response[""torrents""] = torrents;
    //...
    response[""queueing""] = QBtSession::instance()->isQueueingEnabled();

    QVariantHash labels;
    QStringList labelsList = Preferences::instance()->getTorrentLabels();
    for (int i = 0; i < labelsList.length(); i++)
        labels[labelsList[i]] = labelsList[i];
    response[""labels""] = labels;

    return generatePartialResponse(rid, response, lastResponse);
}
```

where `rid` is what we received in the request, and `lastResponse` we store in the session (it also contains `rid` of last response).

As you can see, we don't want any class to perform this task. Only btjson::getTorrentsPartial() and a couple of functions.
"
68509565,2332,buinsky,2015-01-02T05:28:57Z,"> I want you to explain to me simply how the partial request/response is supposed to work.

Response represented in QVariantMap variable. QVariantMap contains key/value pairs. Values can contains:
1) Variables of some basic type (int, QString ...), for examle: [""name"", ""torrent1""], [""speed"", ""123000""].
2) QVariantMap variable which keep object properties.
3) QVarianHash variable which contains list of variables or objects.

So QVariantMap variable represents hierarchy of objects with properties which we must send in response.

PartialResponseGenerator keep last processed response by client. When client send request  PartialResponseGenerator compares generated response with last response recursively and leaves in hierarchy of objects and their properties only changed data. For example:

Last processed response:

``` javascript
{
    ""full_update"": true,
    ""labels"": [""1""],
    ""torrent"": {
        ""dlspeed"": 0,
        ""progress"": 0.0
    }
}
```

Current response:

``` javascript
{
    ""full_update"": true,
    ""labels"": [""1""],
    ""torrent"": {
        ""dlspeed"": 120423,
        ""progress"": 0.0
    }
}
```

Partial response

``` javascript
{
    ""torrent"": {
        ""dlspeed"": 120423
    }
}
```

Also PartialResponseGenerator handle ID of processed response to enshure that client recieved and processed partial response and client does not need full response data (when the page is reloaded or there are problems with the network).

@sledgehammer999 you can see how request is processed in function btjson::getTorrentsPartial in glassez post.
"
68511486,2332,buinsky,2015-01-02T07:04:15Z,"@glassez Please review ""Temporary commit"". If you will be satisfied with the code changes I will merge the commits into one.
"
68512244,2332,glassez,2015-01-02T07:38:51Z,"Well, the process went. Remained fully get rid of constData(), but it can be done later - now you can proceed to the algorithm. As far as I understand, your current code is incompatible with what we have (I mean `json/torrents` request). Again, I'm sure you can (and should) extend an existing algorithm by adding your ideas, and not to create a new request.
"
68512546,2332,buinsky,2015-01-02T07:51:44Z,"@glassez I can extend `json/torrents` request algorithm. I want to know what you thinking about including labels and queueing flag into response? It would be convenient to update the list of torrents label with the torrents table. Or not? I think that to much responses for each portion of data isn't good.
"
68521001,2332,glassez,2015-01-02T11:33:14Z,"Well, then let's begin.

> I want to know what you thinking about including labels and queueing flag into response? It would be convenient to update the list of torrents label with the torrents table. Or not? I think that to much responses for each portion of data isn't good. For example in uTorrent WebUI all data is sent in one response.

Personally, I advocate that each data type had its own request. They are updated with varying frequency. Besides, nothing bad will happen if some a short time (even a few seconds) we will have some labels in the list of torrents and not to have them in the list of labels. But we'll simplify the code for handling requests and responses, and thus increase the reliability of our program. We should not blindly imitate other programs.
Now, regarding the revision of the existing code. @sledgehammer999 Look at this too.
Now we just sent a list of torrents that matches the request parameters (filter, label, limit, offset). At the end of `btjson::getTorrents()` before converting to JSON, we have this list. It only remains to compare these torrents with those that we sent last time and send only the changed data. Moreover, we do not have any way to transmit information about those torrents that were in the previous list, and now there is no - current client code defines that itself. But for the rest of the torrent we should pass at least the hash, even if the data has not changed since the last time - it is necessary for the proper functioning of the sort (although the data of the torrent could not be changed, but its position could). In other cases, if the data are changed partially, we must send only the hash and modified data. When the client code needs to be modified so that they will check how much of the data came from the server and update only them, and the rest left as is.
Draw your attention to the fact that we need to compare two lists of torrents only that have a certain structure that will deliver us from all recursive calls and significantly shorten and simplify the code compared to original version of it.
"
68525356,2332,buinsky,2015-01-02T13:07:08Z,"@glassez I think that `json/torrents` and `json/torrentsPartial` can be exist together. `json/torrents` can be used by clients that need such data representation. `json/torrentsPartial` can be used by WebUI and mobile clients (transmited data reduced tenfold or more). Mixing the functionality of two queries is a perversion. WebUI will be work better and faster if it will filter and sort torrents by itself.

@sledgehammer999 can you judge us?
"
68525950,2332,glassez,2015-01-02T13:19:23Z,"> WebUI will be work better and faster if it will filter and sort torrents by itself.

Such statements need to argue.
Besides, if you're not aware, before WebUI contained filtering and sorting code, but we got rid of it. Filtering on the server side also significantly reduces the traffic. Combining this with partial data transfer will make it possible to reduce the amount of transmitted data.
"
68528547,2332,buinsky,2015-01-02T14:09:20Z,"> Such statements need to argue.

Instead of sending request WebUI immediately filter or sort torrents.

> Besides, if you're not aware, before WebUI contained filtering and sorting code, but we got rid of it. 

Sometimes it is useful to step back.

> Filtering on the server side also significantly reduces the traffic.

This is not reduces traffic when selected all torrents and all labels. Partial response reduces traffic more overwhelmingly.

> Besides, nothing bad will happen if some a short time (even a few seconds) we will have some labels in the list of torrents and not to have them in the list of labels.

Do you know why Firefox loses popularity? Because it slow. It should be noted that Firefox code is almost perfect.
"
68541241,2332,buinsky,2015-01-02T16:49:42Z,"@glassez 
The problem is that partial response is not fully compatible with `json/torrents` it has different logic. Partial response contains removed objects IDs from previous response. Also `torrents` response contains array of torrents (`[{...},...,{...}]`) and I don't know where to put `pid` (`[{...},...,{...}],pid=...` is not valid json data). Here is 2 solutions:
1) change response to this format: `{torrents={...},pid=...}`. In this case existing applications that uses WebUI api will not be able to receive data.
2) use cookies. I think it's a little clumsy.

May be it will be better don't remove `torrentsPartial` request?
"
68543002,2332,pmzqla,2015-01-02T17:11:29Z,"> @qbittorrent/webdev Sorry for hijacking this thread. There isn't any other way to contact you AFAIK.
> I know that some of you are busy. But if you have time and aren't bored you could start populating the wiki with the new info about the WebUI API.
> Here is the old page: https://github.com/qbittorrent/qBittorrent/wiki/WebUI-API-Documentation
> You guys are far more qualified to write the documentation.
> Make sure to make 2 new subpages in the above page. One leading to the current documentation and one to the new documentation.
> AFAIK, there are at least 2 android apps using the WebUI API...

I had prepared a txt some time ago. I refined it a little bit and uploaded <a href=""https://gist.github.com/pmzqla/7e5733dbecfc50ee4ecd#file-web-api-documentation"">here</a>. I know it should be done in the wiki, but doing this was faster and maybe it could make updating the wiki simpler.
"
68547251,2332,glassez,2015-01-02T18:04:44Z,"> Instead of sending request WebUI immediately filter or sort torrents.

Agree on the expense of the sort. But how, specifically, what are you going to filter without sending a request? For example, at some point in time the user switches the filter from ""active"" to ""all"".

> Sometimes it is useful to step back.

I agree. But assuming that a step forward was erroneous. You still haven't proven.

> This is not reduces traffic when selected all torrents and all labels. Partial response reduces traffic more overwhelmingly.

I do not propose to leave it as is. I propose to combine both methods.

> Do you know why Firefox loses popularity? Because it slow.

It is generally incomparable things. I don't even want to discuss it.

> change response to this format: `{torrents={...},rid=...}`. In this case existing applications that uses WebUI api will not be able to receive data.

This is a good option. Besides, now Web API is in the process of redesigning and already has some incompatibilities with older clients. When the redesign is complete, we will publish the documentation for the new API so that clients can implement support for it.

@buinsky if you think I'm just picking on you, you can relax. It's just different. As I already mentioned, Web API has undergone a redesign, one of the aims of which was the reduction of traffic. And originally I was looking at your case. But then I rejected it due to serious problems during its implementation. So I did what could be done at that time - filtering on the server side. And now I realized that it has eliminated the problem that stood in the way of implementation of the partial data transfer. I'm sure that you have not yet discovered this problem. If I'm wrong, then I can describe this problem (the use cases in which it appears), and you will tell me how you resolved it.
"
68548205,2332,sledgehammer999,2015-01-02T18:16:24Z,"Sorry guys for the late response. I was coding something else and didn't have time to take a look at this.
This may be a language thing, but it is important to note that any other member isn't hostile. Keep in mind that even if you speak English perfectly the written word may seem harsh. That's because you can't hear the tone of the voice the other person is using.
I am refering to both buinsky and glassez.
So yes, you should continue discussing and exchanging ideas. As I can tell from the comments there already was progress on how to resolve some issue. Keep it going.

> And originally I was looking at your case. But then I rejected it due to serious problems during its implementation. So I did what could be done at that time - filtering on the server side

@buinsky Some back history in case you didn't know. We had discussed various things for the WEBUI with @glassez almost a year ago. This is what he is refering to.
"
68548411,2332,buinsky,2015-01-02T18:19:19Z,"I get rid of `constData()` in the code.
"
68548903,2332,buinsky,2015-01-02T18:24:55Z,"> Agree on the expense of the sort. But how, specifically, what are you going to filter without sending a request? For example, at some point in time the user switches the filter from ""active"" to ""all"".

Just call function `updateTable` in `dynamicTable` class (file dynamicTable.js).
"
68549784,2332,buinsky,2015-01-02T18:35:27Z,"> As I already mentioned, Web API has undergone a redesign, one of the aims of which was the reduction of traffic. And originally I was looking at your case. But then I rejected it due to serious problems during its implementation. So I did what could be done at that time - filtering on the server side. And now I realized that it has eliminated the problem that stood in the way of implementation of the partial data transfer. I'm sure that you have not yet discovered this problem. If I'm wrong, then I can describe this problem (the use cases in which it appears), and you will tell me how you resolved it.

@glassez Could you write it in russian? I'm not sure that I understand you.
"
68550929,2332,buinsky,2015-01-02T18:49:27Z,"webui/btjson.cpp:220:82: error: invalid initialization of non-const reference of type ‘QVariantMap& {aka QMap<QString, QVariant>&}’ from an rvalue of type ‘QMap<QString, QVariant>’

webui/btjson.cpp:152:6: error: in passing argument 3 of ‘void processMap(bool&, QVariantMap&, QVariantMap&, QVariantMap&)’

webui/btjson.cpp:273:82: error: invalid initialization of non-const reference of type ‘QVariantMap& {aka QMap<QString, QVariant>&}’ from an rvalue of type ‘QMap<QString, QVariant>’

webui/btjson.cpp:250:6: error: in passing argument 3 of ‘void processMap(bool&, QVariantMap&, QVariantMap&, QVariantMap&)’

webui/btjson.cpp:289:99: error: invalid initialization of non-const reference of type ‘QVariantHash& {aka QHash<QString, QVariant>&}’ from an rvalue of type ‘QHash<QString, QVariant>’

webui/btjson.cpp:190:6: error: in passing argument 3 of ‘void processHash(bool&, QVariantList&, QVariantHash&, QVariantHash&, QVariantList&)’

@qbittorrent/webdev, @sledgehammer999 does anyone khow how to solve these errors? 
"
68553757,2332,sledgehammer999,2015-01-02T19:22:01Z,"> @glassez Could you write it in russian? I'm not sure that I understand you.

In this case, I don't have a problem in both of talking in Russian.

> @sledgehammer999 does anyone khow how to solve these errors? 

I am going to look into it in ~25-30 minutes.
"
68557211,2332,sledgehammer999,2015-01-02T20:01:34Z,"The error messages took me a while to understand. eg for the first the only way to fix that I know of is:

``` c++
else {
                QVariantMap map;
                QVariantMap tempmap0 = prevData[key].toMap();
                QVariantMap tempmap1 = data[key].toMap();
                processMap(changes, map, tempmap0, tempmap1);
                hasChanges |= changes;
                if (changes)
                    partial.append(map);
            }
```

Of course poor variable naming, only for testing purposes. The same fix applies to the other errors.
"
68558868,2332,sledgehammer999,2015-01-02T20:22:32Z,"Or if it makes sense code-wise, change the signature of processMap/processHash to take the 2 variables as const references. (eg processMap(const QVariantMap &data)).
"
68558982,2332,glassez,2015-01-02T20:23:46Z,"> @qbittorrent/webdev, @sledgehammer999 does anyone khow how to solve these errors?

This is a poor knowledge of **c++** language.
Replace

``` c++
void processMap(bool& hasChanges, QVariantMap &partial, QVariantMap &prevData, QVariantMap &data)
```

with

``` c++
void processMap(bool& hasChanges, QVariantMap &partial, const QVariantMap &prevData, const QVariantMap &data)
```

or simply

``` c++
void processMap(bool& hasChanges, QVariantMap &partial, QVariantMap prevData, QVariantMap data)
```

And yet... There is a function parameters order convention: input, both input and output, output. So:

``` c++
void processMap(QVariantMap prevData, QVariantMap data, bool& hasChanges, QVariantMap &partial)
```
"
68560009,2332,glassez,2015-01-02T20:36:37Z,"> Just call function updateTable in dynamicTable class (file dynamicTable.js).

As far as I understood, you are always stored on the client side all the torrents in addition to those that appear in the table (i.e., in addition to filtered). This should work, at first glance. But the effectiveness of this solution is questionable. And it is precisely at the efficiency you focus in their arguments.
"
68560308,2332,glassez,2015-01-02T20:40:28Z,"@buinsky Other functions need to be redone in a similar way.
"
68560544,2332,buinsky,2015-01-02T20:43:27Z,"> And it is precisely at the efficiency you focus in their arguments.

@glassez I don't anderstand this sentence. Could you write it in russian?
"
68561186,2332,buinsky,2015-01-02T20:51:43Z,"Частичный ответ обычно небольшой. Да, мы можем сократить и его с помощью отфильтровывания на стороне сервера, но с другой стороны мы уменьшим отзывчивость интерфейса.
"
68561904,2332,glassez,2015-01-02T21:01:12Z,"@buinsky В своих доводах в пользу своего решения ты делаешь упор на его эффективности, при этом ты предлагаешь постоянно хранить все торренты на стороне клиента (помимо уже отфильтрованных и отсортированных, которые отображаются в таблице), что подразумевает при каждом запросе обработку и тех и других. К тому же твой способ получения частичных данных весьма громоздкий. Я не вижу причин для этого. Ты говоришь о какой-то универсальности, но она здесь явно не требуется. 

> Частичный ответ обычно небольшой. Да, мы можем сократить и его с помощью отфильтровывания на стороне сервера, но с другой стороны мы уменьшим отзывчивость интерфейса.

Объясните, за счет чего мы уменьшим отзывчивость интерфейса? Видимо, я чего-то не понимаю... Только объясняйте аргументированно.
"
68583448,2332,buinsky,2015-01-03T04:51:10Z,"> В своих доводах в пользу своего решения ты делаешь упор на его эффективности, при этом ты предлагаешь постоянно хранить все торренты на стороне клиента (помимо уже отфильтрованных и отсортированных, которые отображаются в таблице), что подразумевает при каждом запросе обработку и тех и других.

1) Пересылаемые данные при использовании частичных ответов имеют **весьма малый размер**.
2) При использовании фильтрования и сортировке на стороне сервера каждый раз при нажатии фильтра или при сортировке сортировке списка посылается запрос, который требует времени на его обработку. Я часто подключаюсь к WebUI через мобильный телефон, интернет на котором не радует ping-ом и каждое переключение фильтров или сортировка подтормаживает. Бывает, довольно ощутимо. Лично меня это раздражает. Если бы фильтрования на стороне сервера не было интерфейс работал бы без задержек, а данные обновлялись бы по мере поступления ответов от сервера.
3) при сортировке на стороне сервера придется пересылать хэши всех торрентов. Каждый хэш имеет длинну 40 байт. Затраты на их пересылку могут быть больше, чем при использовании частичного ответа для всех торрентов, но без сортировки. К примеру, когда в списке 30 торрентов, а активны из них только несколько.

> Объясните, за счет чего мы уменьшим отзывчивость интерфейса? Видимо, я чего-то не понимаю... Только объясняйте аргументированно.

@glassez См. пункт 2. Для меня это основной аргумент к тому, чтобы не использовать фильтрацию на стороне сервера.
"
68587235,2332,glassez,2015-01-03T08:17:36Z,"> Я часто подключаюсь к WebUI через мобильный телефон

Мы не делаем приложение только для вас. Какова, по-вашему, доля тех людей, которые поступают так же (при условии, что текущий WebUI не расчитан на маленькие экраны).

> При использовании фильтрования и сортировке на стороне сервера каждый раз при нажатии фильтра или при сортировке сортировке списка посылается запрос, который требует времени на его обработку.

Насколько часто происходит переключение фильтров при средне-статистическом использовании? Я думаю - крайне редко. В основном, используется какой-то один фильтр.

> при сортировке на стороне сервера придется пересылать хэши всех торрентов. Каждый хэш имеет длинну 40 байт. Затраты на их пересылку могут быть больше, чем при использовании частичного ответа для всех торрентов, но без сортировки. К примеру, когда в списке 30 торрентов, а активны из них только несколько.

Согласен. Хотя это актуально только для некоторых типов фильтрации.

Позволю себе подвести некоторый итог:
1. Несомненно, сама по себе передача только измененных данных - это хорошая идея. Вопрос только в ее реализации и использовании.
2. Возможно, стоит реализовать частичную передачу через отдельный тип запроса. Решение этого вопроса можно предоставить руководителю проекта или/и обсудить с другими разработчиками.
3. Использование частичной передачи совместно с клиентской сортировкой/фильтрацией в qBittorrent WebUI под вопросом. Это полезно только в момент переключения фильтра при условии плохого сетевого соединения. Что касается сокращения трафика, то он будет меньше только при использовании лишь некоторых фильтров. При этом код WebUI увеличится на ~250 строк. Пусть решает руководитель.

Давайте это обсудим. Может, что-то подкорректируем (хотя я постарался изложить только факты) и опубликуем для остальных разработчиков.
"
68624922,2332,buinsky,2015-01-04T08:11:42Z,"> Besides, nothing bad will happen if some a short time (even a few seconds) we will have some labels in the list of torrents and not to have them in the list of labels.

@glassez  Каждый запрос - это около 500 лишних пересылаемых байт (заголовок запроса и ответа). 
Сейчас индикатор альтернативной скорости в WebUI работает неправильно. При переключении в программе использования альтернативной скорости в WebUI индикатор не меняется. Т.е. нужно периодически получать информацию об использовании альтернативной скорости.
Также в WebUI нужно периодически получать информацию об метках и использовании приоритетов.
Что, для этих случаев нужны отдельные запросы?

Мне кажется, что нужно сделать несколько запросов только для использования в WebUI, которые будут передавать совместно данные, которые обновляются в одно и то же время.

@sledgehammer999 Есть какие нибудь мысли по этому поводу и по поводу последнего поста glassez ?
"
68626492,2332,glassez,2015-01-04T09:21:13Z,"> Мне кажется, что нужно сделать несколько запросов только для использования в WebUI, которые будут передавать совместно данные, которые обновляются в одно и то же время.

То есть, твой основной замысел - хранить на стороне клиента все данные (по крайней мере, большинство из них) и периодически обновлять их путем запроса изменений. Картина начинает прорисовываться.
Проблема в том, что ты так до сих пор и не дал целостного и подробного описания своего замысла. А ведь это не просто изменения текущего API, это совершенно другое поведение, другой API. И реализовывать его нужно параллельно существующему.
"
68627059,2332,buinsky,2015-01-04T09:44:52Z,"> Проблема в том, что ты так до сих пор и не дал целостного и подробного описания своего замысла.

@glassez  Я предлагаю сделать запрос `json/WebUIMainData` и пересылать в нем все данные (торренты, метки, текущую скорость, статус соединения и т.д.) в сокращенном виде, кроме данных во вкладках  свойств текущего торрента, списка трекеров и содержимого торрента.
"
68627872,2332,sledgehammer999,2015-01-04T10:17:58Z,"> @sledgehammer999 Есть какие нибудь мысли по этому поводу и по поводу последнего поста glassez ?

@buinsky I don't speak russian.
"
68627994,2332,buinsky,2015-01-04T10:23:29Z,"@sledgehammer999 I propose to make a request `json/WebUIMainData` and send in it all the data (torrent, labels, current speed, connection status, etc.) in an abbreviated form, except data in the tabs of the properties of the current torrent trackers and list the contents of a torrent.
"
68628795,2332,sledgehammer999,2015-01-04T10:55:40Z,"I this a separate issue from the one this PR tries to implement?

I wonder what you discussed in russian.
"
68628997,2332,buinsky,2015-01-04T11:03:18Z,"@sledgehammer999 It is a separate issue. If @glassez agrees with me, I will implement this in separate commit.

@glassez Could you write your thoughts for @sledgehammer999?
"
68630769,2332,glassez,2015-01-04T12:12:16Z,"@sledgehammer999 I will try to describe what I understood from the plan of @buinsky. And just complement it by my comments. I will write in English and Russian, to more accurately understand what I mean.
@buinsky proposes to implement a completely different Web API based on data synchronization between the host (qBittorrent) and web clients (you can call it Web Sync API, whereas an existing - Web Query API). This will work as follows. In some key points (usually, at the first request and on network errors, causing the loss of transmitted data), the client receives a complete copy of all data and saves it. It only asks for the changes that have occurred since the previous request and updates its copy of the data. Sorting and filtering of data is performed on the client side. @buinsky proposes to create a query `json/WebUIMainData` (I think you can just `json/syncdata` - this will reflect its essence). But better, in my opinion, if we further differentiate between existing and new API, providing new **scope** to it - `sync/data` (or `sync/maindata`, if it is necessary to conduct separate sync some parts of the data). In this case, **scope** for an existing API can be renamed from `json` to `query` (it happens, for example, `query/torrents` and so on).

@sledgehammer999 Я попытаюсь описать, что я понял из замысла @buinsky. И сразу дополню это своими комментариями. Писать буду по-английски и по-русски, чтобы все более точно поняли, что я имею ввиду.
@buinsky предлагает реализовать совершенно другой Web API, основанный на синхронизации данных между основным приложением (qBittorrent) и его веб клиентами (можно назвать его Web Sync API, тогда как существующий - Web Query API). Это будет работать следующим образом. В некоторых ключевых точках (обычно, при первом обращении и при сетевых ошибках, приводящих к потере передаваемых данных) клиент получает полную копию всех данных и сохраняет ее у себя. В последствие он лишь запрашивает те изменения, которые произошли с момента предыдущего запроса и обновляет свою копию данных. Сортировка и фильтрация данных происходит на стороне клиента. @buinsky предлагает создать для этого запрос `json/WebUIMainData` (я думаю, что можно просто `json/syncdata` - это будет отражать его сущность). Но лучше, по-моему, будет, если мы еще больше разграничим существующий и новый API, выделив для него новый **scope** - `sync/data` (или `sync/maindata` на тот случай, если придется проводить раздельную синхронизацию некоторых частей данных). При этом, **scope** для существующего API можно переименовать из `json` в `query` (получится, например, `query/torrents` и т.п.).
"
68631094,2332,sledgehammer999,2015-01-04T12:23:38Z,"Does this mean overhauling the WebAPI entirely(and again)?
The client side sort seems to negate your previous changes(not necessarily bad).
In the proposed API it seems that almost all commands will be gone. The client will download a bunch of data at startup, save it and manipulate on it. Then on each request-update, hopefully a lot less data. Only data that has changed.
One question is would any webclient need all that data in the first place?
Or if the bulk of the INITIAL data isn't that big, then I don't see any harm done.

@glassez Do you have anything to comment(negative or positive) on the proposed API?
"
68631619,2332,glassez,2015-01-04T12:44:34Z,"> Does this mean overhauling the WebAPI entirely(and again)?

No, it doesn't.
If we implement this, it will exist in parallel with current API. For its operation it is only necessary to make one new request (or possibly several - see previous post) and implement a mechanism to compare data. The current API will not be affected (should not be affected), with the exception of maybe requests naming (see previous post).
Regarding the use of this new API in qBittorrent embedded web client (qBittorrent WebUI), it is, I think, a separate issue. For me, personally, it's all the same. So it's up to you. Or, maybe other developers will be some suggestions on this issue.
The main thing for me, if the new API will be created, that it was done professionally. And in this matter I will not leave @buinsky alone.
"
68631761,2332,glassez,2015-01-04T12:49:31Z,"> Or if the bulk of the INITIAL data isn't that big, then I don't see any harm done.

The volume of initial data will be slightly larger than the one that was passed earlier on every request (and the one that is passed now, if you don't filter). But it is with a proper implementation.
"
68632561,2332,sledgehammer999,2015-01-04T13:18:23Z,"Hmm, ok. As an I idea I think it is good one. I now wait to see its implementation. I imagine that this PR should be incorporated with the new API and not now, right?
"
68636148,2332,buinsky,2015-01-04T15:15:24Z,"Done!

@sledgehammer999 , @qbittorrent/webdev please check my commits.
"
68641452,2332,glassez,2015-01-04T17:43:27Z,"@buinsky Oh, you are fast! Stand down a little bit, and then you will have to do a lot of extra work.
First, still bear in mind that Web API (i.e., those requests that qBittorrent handles) and WebUI (i.e., the web client, which comes with qBittorrent) are separate things (if you haven't realized). Therefore, changes in them should be made separately. In this regard, you need to rebase your changes so that some commits touched the code of the main application and the other touched the web client code.
Secondly, in your place, I wouldn't edit the client code until such time as the work on the API will not end, and then you have to redo it constantly.
Thirdly, you need to rename PR so that its name reflects its essence, and also give a detailed description (this is not a simple bugfix, so you can ignore it).
And yet. @sledgehammer999 must approve requests renaming. So how this does affect compatibility with existing clients, this renaming should be done before version 3.2 will be released (to all API incompatibility appeared at one time). If @sledgehammer999 is approved, it will be possible to do this in a separate PR, because the current can not be completed before the release of version 3.2.
"
68641655,2332,buinsky,2015-01-04T17:49:00Z,"@glassez please write your last post in russian.
"
68641841,2332,glassez,2015-01-04T17:54:34Z,"@buinsky О, какой ты быстрый! Остынь немножко, а то тебе придется делать много лишней работы.
Во-первых, все-таки имей ввиду, что Web API (т.е. те запросы, которые qBittorrent обрабатывает) и WebUI (т.е. тот веб клиент, который поставляется вместе с qBittorrent) это отдельные вещи (если ты этого еще не понял). Поэтому правки в них нужно вносить отдельно. В связи с этим тебе нужно переделать твои изменения таким образом, чтобы одни коммиты затрагивали код основного приложения, а другие - код веб клиента.
Во-вторых, на твоем месте, я бы не торопился править клиентский код до тех пор, пока работа над API не закончится, а то тебе придется переделывать его постоянно.
В-третьих, тебе нужно переименовать PR так, чтобы его название отражало его суть, а также дать подробное описание (это не простой багфикс, чтобы можно было игнорировать это).
И еще. @sledgehammer999 должен утвердить переименование запросов. Так как это влияет на совместимость с существующими клиентами, то такое переименование нужно будет сделать до того, как версия 3.2 выйдет (чтобы все несовместимости API появились за один раз). Если @sledgehammer999 это одобрит, то можно будет сделать это в отдельном PR, т.к. текущий может быть не завершен до выхода версии 3.2.
"
68642362,2332,sledgehammer999,2015-01-04T18:09:23Z,"Did you mean API renaming? json->query? If yes, since this is still unreleased we can rename it now.
(I am still unsure how close v3.2.0 ETA is in general. If you continue to improve on code I'll gladly accept it. Especially webui).
"
68642626,2332,glassez,2015-01-04T18:16:55Z,"> Did you mean API renaming? json->query?

Yes.
I think it should be done in a separate PR, so you do not forget (if you decide to release 3.2, and this PR is not yet ready). I tell @buinsky to do it.

@buinsky Сделай, пожалуйста, отдельный PR с переименованием запросов `json` в `query`. @sledgehammer999 одобрил его.
"
68668078,2332,buinsky,2015-01-05T04:46:44Z,"@sledgehammer999 , @glassez it will be better to split this PR into 3 PRs. It will be easier for me if PRs will be merged one by one. So I left only first commit in this PR. @sledgehammer999, please merge it.
"
68868616,2332,buinsky,2015-01-06T14:05:20Z,"@sledgehammer999 will you merge the PR?
"
68870218,2332,sledgehammer999,2015-01-06T14:19:29Z,"@buinsky sorry I don't have time to review the final code at the moment. I'll do it in the weekend.
"
68931562,2332,buinsky,2015-01-06T20:52:39Z,"I transfer partial response part of the code into future PR.
"
69457900,2332,sledgehammer999,2015-01-10T14:37:14Z,"@buinsky I didn't look too close in the non-C++ code. The rest is ok. Sorry for the waiting.
"
44133616,1703,sorokin,2014-05-25T13:49:01Z,"qbittorrent uses outdated version of boost without boost::atomic. Ok.
"
44756977,1703,sledgehammer999,2014-05-31T19:16:20Z,"I just finished the first pass.
One general observation. The code identation should look like this(I am talking about the curly braces):

```
void function() {
 return 0;
}

if (test == false {
// do stuff
}
else if (test1 == false) {
// do stuff
}
else {
// do stuff
}
```

No I need to do a second pass to comment about the correct flags in the status() call and to re-read the alertdispatcher code.
We are almost ready for merging.
"
44757129,1703,sledgehammer999,2014-05-31T19:21:57Z,"Wow don't make new commits.
Or if you like make a new commit that will correspond to an old one. And when all changes are done for each commit you will ""squash"" the new ones into the olds ones. (on their related ones). (don't worry I'll give instructions on how to do this on git)
"
44757196,1703,sorokin,2014-05-31T19:24:56Z,"I fixup my existing commits based on your suggestions. (git rebase -i)
"
44757220,1703,sorokin,2014-05-31T19:25:47Z,"Lets I push new version. And your will make a second pass on review.
"
44757259,1703,sledgehammer999,2014-05-31T19:26:53Z,"> Lets I push new version. And your will make a second pass on review.

Not yet. The rest is simple enough to use the existing commits.
"
44757340,1703,sorokin,2014-05-31T19:29:47Z,"> Not yet. The rest is simple enough to use the existing commits.

Oops. I already pushed.
"
44757643,1703,sledgehammer999,2014-05-31T19:40:29Z,"I'll tell you when I'm done.
"
44759550,1703,sledgehammer999,2014-05-31T20:57:37Z,"Anyway. Let's say that I am finished. Please review your edits in qbtsession.cpp regarding the alerts. I saw a few unjustified deletes. I will review the rest of that file when you do the rest and push the changes.
Please do this (using git rebase -i <commit-hash>)
1. Do all the changes for [this](https://github.com/sorokin/qBittorrent/commit/342c464249eae6c8d7fbe9a871cf85a405981975) commit into a new commit.
2. Then ""squash"" the new commit onto the old one. (even if you fixup it doens't matter at this point)

Alternatively you can do first the git rebase -i
But choose to ""edit"" the relevant commits. git will stop in the first commit for you to edit. Go ahead and edit the relevant files for the required modifications for **that** commit. Then `git add` those files. (git status is your friend). Then to continue to the next commit do `git rebase --continue`. Git will ask you for a commit message before continuing though.

Or if follow any other workflow. I just want to have in front of me a series of commits with the ""final"" code.

Thanks for your patience and cooperation.
"
44759577,1703,sledgehammer999,2014-05-31T20:59:14Z,"EDIT: The commit I referenced above is just an **example**. I want you to post all the necessary edits for all the commits. I'll wait your comment that you're done before I start to look again at the code.
"
44770035,1703,sorokin,2014-06-01T07:58:18Z,"> EDIT: The commit I referenced above is just an example. I want you to post all the necessary edits for all the commits.

Where can I find all my old commits? (Those that were here before force push)
"
44770317,1703,sledgehammer999,2014-06-01T08:16:46Z,"Hey I think I have better/simpler interface of the alert dispatcher in mind. How about this:
1. dispatch() checks the type of the alert. If it isn't a `state_update_alert` it puts the alert into a queue (eg vector).
2. The readalerts() in qbtsession continues to operate in a fixed timer based approach.
3. Each time the timer timeouts readalerts() requests the whole queue(like it does now) from the dispatcher via the getPendingAlertsNoWait() function.

Now because we want react almost instantaneously to `state_update_alert` we cannot wait for the timer to timeout. The dispatcher should have signal named `torrentUpdates` or `statusesUpdates`. In qbtsession constructor we do something like this `connect(m_alertDispatcher, SIGNAL(torrentUpdates), SLOT(handleTorrentUpdates(const std::vector<torrent_status>&)), Qt::QueuedConnection);`. Then dispatch() instead of queueing this type of alert it will `emit torrentUpdates`. According to the Qt docs, when you connect the signal in this manner it is guaranteed that the slot will be called in the main thread even though the signal was emitted in another thread.

This way you avoid the extra logic of event_posted and enqueueToMainThread() (and possibly other details). At his point, if I understood correctly the code, a signal is a emitted when every alert is received which isn't very desirable. We should queue them.

PS: Also the `stats_alert` may need its own signal to handle it almost instantaneously too.
"
44770376,1703,sledgehammer999,2014-06-01T08:19:58Z,"> Where can I find all my old commits?

I see you already have squash/fixup your commits. That's ok. Just continue the way you like it. And just before merging we'll fix any stupid issues with commit messages or anything git related.
"
44770404,1703,sorokin,2014-06-01T08:21:22Z,"> I see you already have squash/fixup your commits. That's ok. Just continue the way you like it. And just before merging we'll fix any stupid issues with commit messages or anything git related.

You linked commit https://github.com/sorokin/qBittorrent/commit/342c464249eae6c8d7fbe9a871cf85a405981975 so I can address issues in it. But don't know how to find your feedback on other commits.
"
44770434,1703,sledgehammer999,2014-06-01T08:23:57Z,"If you already forced pushed into the branch and have deleted the old commits(eg via squash/fixup) then everything is lost. Github doesn't keep track of comments made in deleted commits.
"
44770479,1703,sorokin,2014-06-01T08:26:51Z,"> At his point, if I understood correctly the code, a signal is a emitted when every alert is received which isn't very desirable. We should queue them.

Incorrect. When UI thread is slow many alerts are grouped into one signal.
"
44770526,1703,sledgehammer999,2014-06-01T08:29:16Z,"> When UI thread is slow many alerts are grouped into one signal.

You are probably correct, but still I think its better to convert. This will mean that readalerts() will stay almost as is. No need to create a handleAlerts() function. What do you think?
"
44771840,1703,sorokin,2014-06-01T08:42:30Z,"> Hey I think I have better/simpler interface of the alert dispatcher in mind. How about this:
> 1. dispatch() checks the type of the alert. If it isn't a state_update_alert it puts the alert into a queue (eg vector).
> 2. The readalerts() in qbtsession continues to operate in a fixed timer based approach.
> 3. Each time the timer timeouts readalerts() requests the whole queue(like it does now) from the dispatcher via the getPendingAlertsNoWait() function.
> 
> Now because we want react almost instantaneously to state_update_alert we cannot wait for the timer to timeout. The dispatcher should have signal named torrentUpdates or statusesUpdates. In qbtsession constructor we do something like this connect(m_alertDispatcher, SIGNAL(torrentUpdates), SLOT(handleTorrentUpdates(const std::vector<torrent_status>&)), Qt::QueuedConnection);. Then dispatch() instead of queueing this type of alert it will emit torrentUpdates. According to the Qt docs, when you connect the signal in this manner it is guaranteed that the slot will be called in the main thread even though the signal was emitted in another thread.
> 
> This way you avoid the extra logic of event_posted and enqueueToMainThread() (and possibly other details). At his point, if I understood correctly the code, a signal is a emitted when every alert is received which isn't very desirable. We should queue them.
> 
> PS: Also the stats_alert may need its own signal to handle it almost instantaneously too.

Although I do agree that it is better to have several queues for different kind of alerts. Where alerts are properly coalesced, handled and appropriate signal is emitted. I think this is the direction for further improvements.

At the same time I don't like the proposed timer approach. Because it make unnecessary lag, and also it wastes unnecessary battery time (CPU must wake up to perform an action) and CPU time.
"
44771941,1703,sorokin,2014-06-01T08:45:55Z,"> You are probably correct, but still I think its better to convert. This will mean that readalerts() will stay almost as is. No need to create a handleAlerts() function. What do you think?

handleAlert() is just a cleanup to keep reasonable function size and nesting depth. It could be inlined into readAlerts() function but this makes readAlerts() less readable.
"
44771959,1703,sledgehammer999,2014-06-01T08:47:05Z,"> At the same time I don't like the proposed timer approach. Because it make unnecessary lag, and also it wastes unnecessary battery time (CPU must wake up to perform an action) and CPU time.

Then how about this:
1. We should have a generalAlerts signal and connect readalerts to it.
2. In dispatch() before exiting check for this: Size of queue and interval since last emit. If queue has more than eg 20 alerts emit the signal. Or if interval is bigger than 1s and queue has less than eg 20 alerts(not empty) emit the signal too.
"
44771978,1703,sledgehammer999,2014-06-01T08:48:08Z,"> handleAlert() is just a cleanup to keep reasonable function size and nesting depth. It could be inlined into readAlerts() function but this makes readAlerts() less readable.

I am going to merge this for readalerts() https://github.com/qbittorrent/qBittorrent/pull/1652
So don't worry about the depth atm.
(I will merge it after this pull request)
"
44772069,1703,sorokin,2014-06-01T08:53:38Z,"> I am going to merge this for readalerts() #1652
> So don't worry about the depth atm.

This will conflict with my changes. I have done similar cleanup in my last two commits.
"
44772100,1703,sledgehammer999,2014-06-01T08:56:00Z,"> This will conflict with my changes. I have done similar cleanup in my last two commits.

I think @glassez will be ok with rebasing. Just don't change readalerts() too much.
Or do you want me to merge that now so **YOU** can rebase on that?
"
44772258,1703,sorokin,2014-06-01T09:03:28Z,"> I think @glassez will be ok with rebasing. Just don't change readalerts() too much.

I have found out that series of dynamic_cast is taking some time (small, but measurable). I hope that one day we will optimize repaint. If we optimize repaint this series of dynamic_casts will become second most expensive action in UI thread.

I have found out also that @glassez have optimized dynamic_casts already. The problem is that his pull request conflicts this my changes. So I decided to reimplement his code on top of my commits.

> Or do you want me to merge that now so YOU can rebase on that?

I want you to merge my pull request. Because it contains all changes in @glassez pull request and also some other changes.
"
44772308,1703,sledgehammer999,2014-06-01T09:06:21Z,"> Because it contains all changes in @glassez pull request and also some other changes.

But it also contains your name in the commit instead of glassez's...
While we wait for glassez's reply, go ahead and implement the rest of the things that need changing.
Also what is your opinion on my last proposal on the dispatcher?
"
44772504,1703,sorokin,2014-06-01T09:15:56Z,"> Then how about this:
> 1. We should have a generalAlerts signal and connect readalerts to it.
> 2. In dispatch() before exiting check for this: Size of queue and interval since last emit. If queue has more than eg 20 alerts emit the signal. Or if interval is bigger than 1s and queue has less than eg 20 alerts(not empty) emit the signal too.

I thought about this. This does make sense. But I decided to go with my current approach, because I don't see any benefits.

Currently it works in the following manner: if UI thread can not cope with a rate of alerts, alerts are coalesced. If UI thread manages to grab alerts very fast. It will grab them one at the time. This approach works well with short-time burst of alerts and also it adds minimal lag when alerts are rare.

What are we trying to optimize/minimize?
"
44772620,1703,sorokin,2014-06-01T09:21:43Z,"> But it also contains your name in the commit instead of glassez's...

Should I change an author of commit?
"
44772654,1703,sorokin,2014-06-01T09:23:19Z,"Looks like I answered all comments. If I have missed something, please let me know.
"
44772938,1703,sledgehammer999,2014-06-01T09:39:45Z,"Status: I am trying to re-write the status flags...
"
44773344,1703,sledgehammer999,2014-06-01T10:02:52Z,"Status: Done with the cache torrent_status
Don't forget to overload the static functions of QTorrentHandle.
"
44773514,1703,sledgehammer999,2014-06-01T10:12:18Z,"1. Fix your indentation.
2. Don't include these 2 commits: https://github.com/sorokin/qBittorrent/commit/a51e612dd7374bd8e79562c4e8ee21fa9ea5bf33 and https://github.com/sorokin/qBittorrent/commit/db2fe1d2e8448477723d78d0d88f60896972dac2 in this pull request. (you can keep them locally in a separate branch in case we need them.
3. After you're done with the above, I want you to explain to me something about the dispatcher (again).
"
44774367,1703,sorokin,2014-06-01T10:33:27Z,"> Don't forget to overload the static functions of QTorrentHandle.

Done.

> Fix your indentation.

fixed in alert dispatcher and in torrent statistics.

> Don't include these 2 commits: sorokin@a51e612 and sorokin@db2fe1d in this pull request. (you can keep them locally in a separate branch in case we need them.

Ok.

> After you're done with the above, I want you to explain to me something about the dispatcher (again).

Ready.
"
44774420,1703,glassez,2014-06-01T10:36:14Z,"I think my request can be merged before, at least because it to be previously created. Besides, I now no time for this (even rebasing) - I need time for other tasks (WebUI).
May not have to use my request if it will be easier to improve qBittorrent. But in this case I have some remarks on similar with my changes (I will comment on the appropriate places in the code if necessary).
"
44774451,1703,sorokin,2014-06-01T10:38:15Z,"@glassez, @sledgehammer999 have asked me to not include two my last commits on pull request, you can find them at my master branch https://github.com/sorokin/qBittorrent/commits/master
"
44774521,1703,sledgehammer999,2014-06-01T10:42:46Z,"@sorokin How about I merge https://github.com/qbittorrent/qBittorrent/pull/1652 now and then you can rebase your https://github.com/sorokin/qBittorrent/commit/6a71f7b96c65dc67a79e0866fd212c2c562d2fc4 around it? Can you do it?
"
44774566,1703,sledgehammer999,2014-06-01T10:44:49Z,"Also the build fails: https://travis-ci.org/qbittorrent/qBittorrent/jobs/26497397
"
44775228,1703,sorokin,2014-06-01T11:21:07Z,"I made ~20 rebases on the last several hours. I get a bit tired of constant rebasing and resolving conflict. No wonder that the build has broken.

> @sorokin How about I merge #1652 now and then you can rebase your sorokin@6a71f7b around it? Can you do it?

I have provided you the @glassez work on top of my, I'm ok if you just change author. You want @glassez work on top of my. I don't want to make a rebase again.

Sorry, but I become tired of resolving conflict and a bit angry because this work is useless. I can do this work but later. If you want it right now, rebase it yourself. Sorry.
"
44775356,1703,sledgehammer999,2014-06-01T11:28:50Z,"> I made ~20 rebases on the last several hours. I get a bit tired of constant rebasing and resolving conflict.

The modifications I commented about shouldn't result in any conflicts...

> Sorry, but I become tired of resolving conflict and a bit angry because this work is useless. I can do this work but later. If you want it right now, rebase it yourself. Sorry.

No need to get angry. Take your time. Don't rebase on glassez's request -forget about that code-. Leave your last 2 commits out(as you already have done). Pretty up the rest of the commits and when you're done leave a comment here so I can do one last pass over them.
I repeat take your time.
"
44775407,1703,sledgehammer999,2014-06-01T11:31:17Z,"And to make your life easier: use the 'edit' keyword when doing git rebase -i.
Then you do the changes in the relevant files, you git add them and then git rebase --continue.
"
44790151,1703,sorokin,2014-06-01T21:37:50Z,"> Pretty up the rest of the commits and when you're done leave a comment here so I can do one last pass over them.

I repaired the build.

> After you're done with the above, I want you to explain to me something about the dispatcher (again).

Ok.
"
44790500,1703,sledgehammer999,2014-06-01T21:52:16Z,"While I was writing my question I understood what the situation is. But I have 2 simpler questions:
1. alertdispatcher.cpp line 61, I thought you said this re-assignment was unnecessary
2. (I assume I didn't misunderstand the usage of the QWaitCondition). Why use the QWaitCondition and complicate things? When getPendingAlerts() gets called if we don't have any alerts in the queue, just return an empty list.

(I won't look at the rest of the commits atm. I am too sleepy. Probably tomorrow)
"
44790583,1703,sledgehammer999,2014-06-01T21:55:58Z,"Small nitpick: You have included again your last 2 commits in this pull request. (have them ready to do a separate pull request upon this request's merging)
"
44790609,1703,sledgehammer999,2014-06-01T21:56:50Z,"> Small nitpick: You have included again your last 2 commits in this pull request. (have them ready to do a separate pull request upon this request's merging)

Ignore this. Github seems broken. Now those commits don't show up.
"
44791241,1703,sorokin,2014-06-01T22:21:54Z,"> alertdispatcher.cpp line 61, I thought you said this re-assignment was unnecessary

Yes. We should check that there is still non-zero value in *tag, but if it is non-zero it should be equal to the value obtained before.

> (I assume I didn't misunderstand the usage of the QWaitCondition). Why use the QWaitCondition and complicate things? When getPendingAlerts() gets called if we don't have any alerts in the queue, just return an empty list.

Without QWaitCondition UI thread will burn 100% CPU during in saveFastResumeData() waiting for alerts.
"
44791344,1703,sledgehammer999,2014-06-01T22:26:29Z,"> Without QWaitCondition UI thread will burn 100% CPU during in saveFastResumeData() waiting for alerts.

This is what I get when I am sleepy. I thought that getPendingAlerts() was called by readalerts()...

Ok I think that was my last grey area about alertdispatcher. I think you have done a really solid work on that class.
"
44985164,1703,sorokin,2014-06-03T16:09:25Z,"@sledgehammer999

How the merging is going? What is your decision with #1652?

(I would like to start working on #1592 so I would like to have a branch I can base my work on)
"
44985395,1703,sledgehammer999,2014-06-03T16:11:05Z,"> How the merging is going? What is your decision with #1652?

I am doing a test build atm. So this will be merged pretty soon.
"
45000972,1703,sledgehammer999,2014-06-03T18:17:43Z,"I am merging this.
Thank you very much for the huge effort.
**2 notes**:
1. There are 4 new files now. alertdispatcher.h, alertdispatcher.cpp, torrentstatistics.h, torrentstatistics.cpp
Can you leave at the top of the files a license notice like the rest of qbt files have? In alertdispatcher you can leave your email in the contact. In the torrentstatistics I am not so sure what should go there. You just moved code around. That code was mostly written by @Gelmir IIRC. @Gelmir care to leave a comment about this?
2. In future pull request please have your commits **titles** start with a capital letter (and maybe end with a period). Also try to make them as small and descriptive as possible. If you want to give a lot more info just use the commit **message**.

Thank you again.
PS: I did some edits that you left out and fixes in a separate commit.
"
45006531,1703,sledgehammer999,2014-06-03T19:03:10Z,"@sorokin I am tagging you here since github doesn't have a pm system.
Make a pull request for your other 2 commits(about the alerts). I have 2-3 notes to comment but they are pretty simple to fix by you. Thanks.
"
45024260,1703,sorokin,2014-06-03T21:39:58Z,"Woo hoo! It is merged.

> Make a pull request for your other 2 commits(about the alerts). I have 2-3 notes to comment but they are pretty simple to fix by you. Thanks.

#1730

> In alertdispatcher you can leave your email in the contact.

#1731
"
45135018,1703,sledgehammer999,2014-06-04T18:53:24Z,"@sorokin 
There is problem with AtomicPointer and Qt5 in alertdispatcher.cpp
From gcc 4.9 on Windows I get these:

```
C:\QBITTORRENT\qBittorrent\src\qtlibtorrent\alertdispatcher.cpp: In static member function 'static void QAlertDispatcher::dispatch(QSharedPointer<QAtomicPointer<QAlertDispatcher> >, std::auto_ptr<libtorrent::alert>)':
C:\QBITTORRENT\qBittorrent\src\qtlibtorrent\alertdispatcher.cpp:85:33: error: cannot convert 'QAtomicPointer<QAlertDispatcher>' to 'QAlertDispatcher*' in initialization
   QAlertDispatcher* that = (*tag);
                                 ^
C:\QBITTORRENT\qBittorrent\src\qtlibtorrent\alertdispatcher.cpp:91:7: error: no match for 'operator!' (operand type is 'QAtomicPointer<QAlertDispatcher>')
   if (!(*tag))
       ^
C:\QBITTORRENT\qBittorrent\src\qtlibtorrent\alertdispatcher.cpp:91:7: note: candidate is:
C:\QBITTORRENT\qBittorrent\src\qtlibtorrent\alertdispatcher.cpp:91:7: note: operator!(bool) <built-in>
C:\QBITTORRENT\qBittorrent\src\qtlibtorrent\alertdispatcher.cpp:91:7: note:   no known conversion for argument 1 from 'QAtomicPointer<QAlertDispatcher>' to 'bool'
```

The only thing that I found is that the QAtomicPointer class no longer provides operators \* and ! in Qt5.
Check [Qt4](https://qt-project.org/doc/qt-4.8/qatomicpointer.html) and [Qt5](https://qt-project.org/doc/qt-5/qatomicpointer.html) class docs.
Any ideas?
"
45211689,1703,sorokin,2014-06-05T12:12:27Z,"> Any ideas?

They changed an interface in Qt5. In Qt5 .load() and .store() functions should be used.

We could place a ifdef here or use std::atomic (if we enable C++11) or use boost::atomic (if we update boost version).
"
45211885,1703,sledgehammer999,2014-06-05T12:14:35Z,"The question is load() or loadAcquire()? store() or storeRelease() ?
If you could prepare a new pull request with ifdefs that would be great.
"
45229582,1703,glassez,2014-06-05T14:55:45Z,"> We could place a ifdef here or use std::atomic (if we enable C++11)...

To take advantage of C++11, will limit the range of supported compilers. I think the maintainer will not do. Although I also like some of the innovations of this standard (even little things like automatic type deduction make the code more compact when working with iterators, etc.).
"
45238622,1703,glassez,2014-06-05T16:01:43Z,"> Any ideas?

I did not immediately realize...
After all, I've got it compiles with Qt5 fine. However, I use Visual Studio 2013.
I dug around a bit in the code of QAtomicPointer - It has conversion operator to pointer (to QAlertDispatcher\* in this case), however, GCC, apparently, does not here an implicit conversion. What if you try to explicit? This will eliminate ifdef's.
"
45243601,1703,sledgehammer999,2014-06-05T16:40:39Z,"> What if you try to explicit?

Do you mean type casting?
Yes we cannot switch to c++11 because I use MSVC2008 for the Windows official releases.
(I don't want to depend on boost since qt has similar functionality)
"
45251768,1703,glassez,2014-06-05T17:50:23Z,"Yes, I mean type casting.
"
45253205,1703,glassez,2014-06-05T18:02:23Z,"I just built qBittorrent (current master) on Linux with gcc 4.8.1
So this is a bug of gcc 4.9, apparently...
"
45262739,1703,sorokin,2014-06-05T19:23:36Z,"> The question is load() or loadAcquire()? store() or storeRelease() ?

I guess store() relaxed as we do it under mutex and loadAcquire. I'm not 100% sure. When I use std::atomic I usually use maximal ordering (sequential consistency), because usually performance doesn't matter. 

> If you could prepare a new pull request with ifdefs that would be great.

Ok.
"
45262952,1703,sorokin,2014-06-05T19:25:30Z,"> To take advantage of C++11, will limit the range of supported compilers. I think the maintainer will not do. Although I also like some of the innovations of this standard (even little things like automatic type deduction make the code more compact when working with iterators, etc.).

<strike>Just curious. On which compilers should qbittorrent be able to be compiled that doesn't support std::atomic?</strike> Ok. VS2008, it is 3 generation behind latest version (4 is we count current beta).
"
45275834,1703,sledgehammer999,2014-06-05T21:14:50Z,"> VS2008, it is 3 generation behind latest version

This is because of Windows XP. I don't want to depend on extra runtimes. Windows's users are fuzzy about total installed sized.
"
45336911,1703,glassez,2014-06-06T13:36:06Z,"> Yes we cannot switch to c++11 because I use MSVC2008 for the Windows official releases.

Do you use MSVC2008 Express Edition? If so, then you can start using MSVC2010 Express Edition with no problems (it contains some new features). Newer releases are not supported Windows XP.
"
46232851,1703,sorokin,2014-06-16T20:34:43Z,"@sledgehammer999 I'm trying to prepare a patch to fix compilation with qt5. How to build qbittorrent with qt5. I tried option --with-qt5 in ./configure, but it doesn't work. It requires qmake from qt5 for building, but it still create a binary that uses qt4.
"
46237054,1703,sledgehammer999,2014-06-16T21:02:34Z,"> but it still create a binary that uses qt4.

The terminal output of ./configure && make would be useful. Also the contents of config.log and Makefile should be useful too.
(pastebin or similar is your friend)
"
46778931,1703,sledgehammer999,2014-06-22T11:43:12Z,"Sorry guys for bothering you. But since in guthub there is no way to directly communicate with each other I have to resort in tagging. Just so you know, my email is sledgehammer999@qbittorrent.org if you want to have more direct chats.
I just wanted to know what is your status. Are you working on something? Are you busy with real life?
@sorokin  @glassez 
"
46789357,1703,sorokin,2014-06-22T18:54:40Z,"./configure --enable-debug --with-qt5: http://pastebin.com/FjfkzySE
config.log: http://pastebin.com/H3ii93zG
make: http://pastebin.com/BGJr041n
"
46789427,1703,sorokin,2014-06-22T18:56:58Z,"@sledgehammer999 

> Are you working on something?

I made a push request with my recent changes.

> Are you busy with real life?

A bit. But usually I have some time during weekend.
"
46789689,1703,sledgehammer999,2014-06-22T19:07:03Z,"> make: http://pastebin.com/BGJr041n

I suspect that this is the terminal output after running ""make"".
That output is really weird:

> cd src/ && ( test -e Makefile || /usr/lib/x86_64-linux-gnu/qt5/bin/qmake /home/ivan/d/qbittorrent/src/src.pro -o Makefile ) && make -f Makefile 

The above line checks and recreates the Makefile if needed with the qt5 qmake, which is correct. Then a few lines below:

> /usr/bin/qmake-qt4 -o Makefile src.pro

This line recreates the Makefile unconditionally using the qt4 qmake!

Can you post the contents of Makefile after you run `./configure --enable-debug --with-qt5`?
"
46789921,1703,sorokin,2014-06-22T19:16:18Z,"My current Makefile in qbittorrent/ directory: http://pastebin.com/UABqEFrt
"
46790021,1703,sorokin,2014-06-22T19:19:59Z,"My current Makefile in qbittorrent/src/ directory: http://pastebin.com/i0bHm2jE
"
46790115,1703,sledgehammer999,2014-06-22T19:23:09Z,"Try deleting qbittorrent/src/Makefile. It could be left over from previous builds/configurations.
Did that fix the problem?
"
46790188,1703,sorokin,2014-06-22T19:25:23Z,"Yes. Thank you.
"
46790446,1703,sorokin,2014-06-22T19:35:55Z,"Now I have a few linking errors: http://pastebin.com/jLrYW79C

Linker command: http://pastebin.com/qBUksSbi
"
46790663,1703,sorokin,2014-06-22T19:43:19Z,"Hm. Looks like something was not rebuild. I will do make clean && make.
"
46790918,1703,sledgehammer999,2014-06-22T19:54:01Z,"You probably know this bug `make -jX` where X marks cores/threads speeds up the compilation process.
"
46791197,1703,sledgehammer999,2014-06-22T20:04:38Z,"> You probably know this bug make -jX where X marks cores/threads speeds up the compilation process.

I meant:
You probably know this, but make -jX where X denotes how many cores/threads to use. This speeds up the compilation process.
"
46791265,1703,sorokin,2014-06-22T20:07:01Z,"> You probably know this, but make -jX where X denotes how many cores/threads to use. This speeds up the compilation process.

Yes, thank you. I know about this flag, but always forget to use it. :-)
"
46791292,1703,sledgehammer999,2014-06-22T20:07:54Z,"Did the linker error go away?
"
46791490,1703,sorokin,2014-06-22T20:14:35Z,"Yes. Linker error have gone. I think it is a bug, but reconfiguration doesn't force a rebuild of object files.
"
564712175,11637,FranciscoPombal,2019-12-11T20:10:42Z,"These changes are suggestions from my experience with using qBittorrent ""in the field"". The numerical values, in particular, don't have a bulletproof justification, it's just a ballpark.

The idea is to optimize defaults for the common case, where it is understood that ""common case"" now also includes users with relatively fast connections (50+ megabits to 1 gigabit, my condolences to any Australians or Americans reading this) and machines (with SSDs, and the like). The goal is to do this without raising the minimum requirements to run qBittorrent with several torrents too much (I think the main concern would be memory usage).

Of course, as always, users at either extreme end (ultra fast machines and connections, machines dedicated to high speed seeding, racing, or users with very low available memory and other system resources) will need to tune their settings for their specific use case.

I would appreciate comments about all of these potential changes, but especially relating to the `watermark*` ones. Does the memory consumption of these settings increase proportionally to the number of active torrents or peers or is there a single send buffer for everything?

If it is the former, then at least the value for `send_buffer_watermark` is probably unreasonable and wasteful for everything except the fastest connections.

Additionally, how difficult would it be to detect the number of hardware threads on a system at runtime? I ask this because, like I said in a previous discussion, I think the default value `aio_threads` should be changed to be `4 * number_of_hardware_threads`. The reason is that libtorrent will spawn 1 SHA-1 thread for every 4 `aio_threads`. Nearly all systems will perform better, particularly when rechecking, if libtorrent spawns as many SHA-1 threads as there are hardware threads available. Nowaydays most people have machines with at least 2 cores (laptops) or 4 cores (desktops), and many people have more than this. With `aio_threads` set to 4, libtorrent will only ever use one of them for SHA-1. But that is a matter for another PR...

@arvidn I would appreciate guidance, thanks"
564939815,11637,FranciscoPombal,2019-12-12T10:10:37Z,"> Overall I'm a bit curious if updating those memory related tweaks will affect less powerful system / embedded systems such as raspberry pi? I mean I don't want it to crash because the default settings is too high for it.

Yes, that is my main concern as well. I am open to suggestions regarding all of the fixed numerical values relating to memory usage, especially the send buffer stuff. Ultimately, I can remove those kinds of changes from this PR, but I still think the other changes (like AnnounceToAllTrackers) are worth it on their own."
565244701,11637,sledgehammer999,2019-12-13T00:13:14Z,">QueueingSystemEnabled (on -> off)

Personally, I wouldn't like this change. However, if others agree I am not going to block this.

>UseRandomPort (false -> true):

IIRC `true` was the default for some time. I can't remember the exact reason we switched back, but I think it had something to do with webui users (and console users).

>IPv6Enabled (false -> true): 

Not relevant anymore after my #11592 was merged.

For the others, I don't have any particular comment."
565249363,11637,FranciscoPombal,2019-12-13T00:32:47Z,"> > QueueingSystemEnabled (on -> off)
> 
> Personally, I wouldn't like this change. However, if others agree I am not going to block this.

What are your reasons for not liking it? It would be nice to know. In any case, this change can be subject to a vote, it it is all the same to you.

> > UseRandomPort (false -> true):
> 
> IIRC `true` was the default for some time. I can't remember the exact reason we switched back, but I think it had something to do with webui users (and console users).

It would make sense to be `true` by default, because it is better for the average user while not making things more difficult for those who want it `false`. Users who want this set to `false`, i.e. webui and console users, already have to change the config to:
- set the port number to the desired one, as it is unlikely that qBIttorrent randomly assigns the exact fixed port number they want on first run.
- change a bunch of settings they would have to anyway (password, etc).
These users have to edit the config either way, might as well make it explicit that setting a fixed port is intended for advanced usage.
in light of this, if you also don't have strong feelings one way or the other, we could vote on whether this should be changed or not, like above.

> > IPv6Enabled (false -> true):
> 
> Not relevant anymore after my #11592 was merged.

Yeah I realized it became irrelevant as well I will rebase this on top of the current master and remove this change.
"
565287795,11637,Chocobo1,2019-12-13T03:41:25Z,">It would make sense to be true by default, because it is better for the average user while not making things more difficult for those who want it false. Users who want this set to false, i.e. webui and console users, already have to change the config to:

Just to make sure you guys are talking about the same thing, the affected setting is for bitorrent port and webui always listen on a fixed port 8080."
565397325,11637,FranciscoPombal,2019-12-13T10:54:44Z,"> Just to make sure you guys are talking about the same thing, the affected setting is for bitorrent port and webui always listen on a fixed port 8080.

yes, and anyway webui users typically want to change both values. for ""regular"" GUI-only users, random listening port is better for the reasons outlined above, and the webui port is not important for them."
565405439,11637,FranciscoPombal,2019-12-13T11:19:41Z,Rebased and dropped IPv6 setting change due to https://github.com/qbittorrent/qBittorrent/pull/11592
565465557,11637,sledgehammer999,2019-12-13T14:42:17Z,"About my comment for random port: I did some history digging and issue digging. I couldn't find the problem I was remembering. So there's a possibility I misremember this. Also after #10523 it probably isn't a big problem to go full random.

>AnnounceToAllTrackers (off->on)

I missed this. Don't we break some kind of universal guideline on good behavior for clients if we enable this by default?"
565509122,11637,LordNyriox,2019-12-13T16:31:45Z,"@sledgehammer999: 

> Don't we break some kind of universal guideline on good behavior for clients if we enable this by default? 

Does that matter, given that a significant chunk of your userbase seems to expect the behavior that enabling it would provide? "
565836630,11637,FranciscoPombal,2019-12-15T18:58:24Z,"> Also after #10523 it probably isn't a big problem to go full random.

> Does that matter, given that a significant chunk of your userbase seems to expect the behavior that enabling it would provide?

Yep, my thoughts exactly."
565837133,11637,ghost,2019-12-15T19:05:28Z,"Queue should be disabled by default. Have seen a lot of users who switched from utorrent/bittorrent and are limited to only seeding 3 torrents at a time by default. Some don’t even understand that the torrents queued for seeding are actually not seeding.
What’s the devs logic to set such a low value? By default seeding should be unlimited (-1). However setting a limit on max active downloads is reasonable. "
565942654,11637,Seeker2,2019-12-16T07:42:20Z,"AnnounceToAllTracker should be left off, but announcing to 1 tracker on all tiers should be on.
Otherwise, this will serve to reduce or eliminate HTTPS public trackers which have far higher bandwidth requirements than regular HTTP trackers (let alone udp ones!)
The HTTPS trackers are far more likely to run into bandwidth hosting issues if every peer or seed starts using the HTTPS tracker as well as the regular tracker on the same tier.

Quite a few torrents are made with tracker tiers for a reason, and hammering all those trackers by default because of connectivity issues only some people have seems a really poor workaround.
If qBitTorrent is failing to switch to a working-and-reachable tracker on each tier when one is available in a timely manner (not taking 3+ hours just to switch between 3 trackers), perhaps that should be investigated and fixed instead.

I had to clarify working-and-reachable trackers, because many proxies do not work with common udp trackers due to them not supporting UDP packets.
...or ISPs that block/scramble unencrypted tracker packets, which might prevent HTTP trackers from working.
...or IPv6 trackers, if there are any."
566662718,11637,NotTsunami,2019-12-17T17:22:28Z,"> AnnounceToAllTracker should be left off, but announcing to 1 tracker on all tiers should be on.
> Otherwise, this will serve to reduce or eliminate HTTPS public trackers which have far higher bandwidth requirements than regular HTTP trackers (let alone udp ones!)
> The HTTPS trackers are far more likely to run into bandwidth hosting issues if every peer or seed starts using the HTTPS tracker as well as the regular tracker on the same tier.
> 
> Quite a few torrents are made with tracker tiers for a reason, and hammering all those trackers by default because of connectivity issues only some people have seems a really poor workaround.
> If qBitTorrent is failing to switch to a working-and-reachable tracker on each tier when one is available in a timely manner (not taking 3+ hours just to switch between 3 trackers), perhaps that should be investigated and fixed instead.
> 
> I had to clarify working-and-reachable trackers, because many proxies do not work with common udp trackers due to them not supporting UDP packets.
> ...or ISPs that block/scramble unencrypted tracker packets, which might prevent HTTP trackers from working.
> ...or IPv6 trackers, if there are any.

Agreed. I am in favor of all changes except AnnounceToAllTrackers."
566705270,11637,FranciscoPombal,2019-12-17T19:09:49Z,"Upon reading @Seeker2 's post and reading through https://github.com/qbittorrent/qBittorrent/pull/11279 one more time, I think I have changed my mind.

IMO, the correct fix would be to:

1. > AnnounceToAllTracker should be left off, but announcing to 1 tracker on all tiers should be on. 

(what @Seeker2 said).

2. Provide a more sophisticated tracker edit dialog, that clearly shows which tier a tracker is in and allows the user to move trackers between tiers and add trackers to specific tiers.
Thus, if a user is having trouble finding peers, they can add a bunch of trackers each to a different tier.

Regarding point 2:  The downside is that the current feature of ""automatically add the following trackers to new torrents"" would probably need an upgrade, to support specifying the tiering of the auto-added trackers.

It should be noted that, with the existing code base, no combination of options can bring qbittorrent to full compliance with [BEP 12](http://bittorrent.org/beps/bep_0012.html). What's more, [BEP 12](http://bittorrent.org/beps/bep_0012.html) is very specific about the announce order in each case, but doesn't specify whether a client should always announce to all trackers in a tier even if the first was successful."
566827592,11637,FranciscoPombal,2019-12-18T01:39:02Z,"@Chocobo1 @sledgehammer999 
Dropped the change to the `AnnounceToAllTrackers` setting in light of previous comments.

Should I remove the changes to `send buffer` stuff, which will probably require much more discussion? Since we all seem to be in agreement about the other changes, they could get merged right away. I was kind of hoping this would be able to make it in some form to 4.2.1, but alas."
566854402,11637,Chocobo1,2019-12-18T03:45:17Z,">Since we all seem to be in agreement about the other changes, they could get merged right away. 

I think you missed one change discussed here: https://github.com/qbittorrent/qBittorrent/pull/11637#discussion_r357473163
>>What about simply raising it to 32 MiB instead, as a compromise?
>
>OK for me."
566854670,11637,Chocobo1,2019-12-18T03:46:33Z,">Should I remove the changes to send buffer stuff, which will probably require much more discussion? 

👍 "
566873471,11637,ghost,2019-12-18T05:26:26Z,Use random port should be off. As 4.2 addresses the default port 8999 already. 
566877507,11637,ArcticGems,2019-12-18T05:45:20Z,">     * QueueingSystemEnabled (on -> off): this is a big one. Users often don't realize this is on and get confused as to why some torrents get the ""Queued"" status. By defaulting to off, several simultaneous downloads work out of the box. Users who know they want the queueing system will go look in the settings anyway.

Should this one still be included since it's already been done with this merged PR??: https://github.com/qbittorrent/qBittorrent/pull/11678"
566905202,11637,Seeker2,2019-12-18T07:22:25Z,"Another elephant-in-the-room concerning people having trouble getting torrents working is it's not very apparent why a torrent isn't downloading or uploading.
From what I understand, the only clue in the main torrent list window is the torrents with trackers errors show up as ""stalled"".

This post:  https://github.com/qbittorrent/qBittorrent/issues/11320#issuecomment-566109063
...doesn't seem to be a case of all udp trackers failing OR all apparent trackers on a torrent being tried-but-failing. qBitTorrent doesn't even appear to be trying on some.
The first torrent shows SEEDING and connected to 1 seed, which I've seen numerous times in my own use of qBitTorrent.
The middle torrent shows a poorly-created torrent with all the trackers in 1 tier. I manually split those trackers into different tier groups when I see them on uTorrent, but that's annoying to do in uTorrent and a HUGE PAIN in qBitTorrent. That's one of the few examples where it's really tempting to just announce on all trackers, but what a mess doing that! (There might be 100+ trackers on it!)
The follow-up post by the same person:  https://github.com/qbittorrent/qBittorrent/issues/11320#issuecomment-566403555
...shows qBitTorrent clearly failing on tracker updates where uTorrent does not."
567283718,11637,FranciscoPombal,2019-12-19T01:09:59Z,"Addressed everything.

@Chocobo1 
> I think you missed one change discussed here: [#11637 (comment)](https://github.com/qbittorrent/qBittorrent/pull/11637#discussion_r357473163)

Thanks, done.

@ArcticGems 

> Should this one still be included since it's already been done with this merged PR??: https://github.com/qbittorrent/qBittorrent/pull/11678

Done.

@an0n666 

> Use random port should be off. As 4.2 addresses the default port 8999 already.

???

@Seeker2 

> Another elephant-in-the-room concerning people having trouble getting torrents working is it's not very apparent why a torrent isn't downloading or uploading.
> From what I understand, the only clue in the main torrent list window is the torrents with trackers errors show up as ""stalled"".
> 
> This post: [#11320 (comment)](https://github.com/qbittorrent/qBittorrent/issues/11320#issuecomment-566109063)
> ...doesn't seem to be a case of all udp trackers failing OR all apparent trackers on a torrent being tried-but-failing. qBitTorrent doesn't even appear to be trying on some.
> The first torrent shows SEEDING and connected to 1 seed, which I've seen numerous times in my own use of qBitTorrent.
> The middle torrent shows a poorly-created torrent with all the trackers in 1 tier. I manually split those trackers into different tier groups when I see them on uTorrent, but that's annoying to do in uTorrent and a HUGE PAIN in qBitTorrent. That's one of the few examples where it's really tempting to just announce on all trackers, but what a mess doing that! (There might be 100+ trackers on it!)
> The follow-up post by the same person: [#11320 (comment)](https://github.com/qbittorrent/qBittorrent/issues/11320#issuecomment-566403555)
> ...shows qBitTorrent clearly failing on tracker updates where uTorrent does not.

Perhaps qBittorrent should add a new state, something like ""Tracker Error"", to better informed the user. And it also should not fail announces when other clients don't as well. Maybe some kind of timeout is set too low? Anyway, those problems are all out of scope of this PR."
567300631,11637,ghost,2019-12-19T02:19:40Z,qBit is already setting a random port on first startup. If you’re going to set it on every startup then there’s still some chance of setting a port used by other apps. Also those who’ve been using qBit for some time now may have forwarded a port manually on their router for qBit. If it becomes random they’ll lose that until they go into the settings and set it to not random. The proper fix for this issue would be to use a different port if the current port fails to be listened on.
567301684,11637,Chocobo1,2019-12-19T02:24:15Z,">If you’re going to set it on every startup then there’s still some chance of setting a port used by other apps. 

Just to clarify, the port number is actually assigned from OS so it is (very) unlikely to be used by other apps.

>Also those who’ve been using qBit for some time now may have forwarded a port manually on their router for qBit. 

Existing installations won't be affected. It only matters for new installs."
567304458,11637,ghost,2019-12-19T02:37:26Z,Some trackers track session data based on IP:port. If a random port is acquired everytime it’ll generate a new session everytime qBit is restarted. 
567306350,11637,ArcticGems,2019-12-19T02:46:28Z,"
>> Also those who’ve been using qBit for some time now may have forwarded a port manually on their router for qBit
>
>> Existing installations won't be affected. It only matters for new installs.

I think this option is something many new user could easily miss = they configurate their router and next time they start qBittorrent the port listening fails, they will likely skip checking qBittorrent options and create a new git issue."
567306875,11637,ghost,2019-12-19T02:48:54Z,"> > > Also those who’ve been using qBit for some time now may have forwarded a port manually on their router for qBit
> > 
> > 
> > > Existing installations won't be affected. It only matters for new installs.
> 
> I think this option is something many new user could easily miss = they configurate their router and next time they start qBittorrent the port listening fails, they will likely skip checking qBittorrent options and create a new git issue.

Yes exactly. They might miss that as almost no client sets random port by default. "
567550971,11637,FranciscoPombal,2019-12-19T16:01:53Z,"No one sets up port forwarding on their routers without first checking that they have selected a fixed port. And, in case they don't, the crowd that sets up port forwarding also knows how to setup a fixed port. Random port at every start is safer than simply at first startup in the general case, for the reasons outlined above."
567569244,11637,FranciscoPombal,2019-12-19T16:47:10Z,Rebased
567570712,11637,ArcticGems,2019-12-19T16:50:48Z,"> 
> 
> No one sets up port forwarding on their routers without first checking that they have selected a fixed port. And, in case they don't, the crowd that sets up port forwarding also knows how to setup a fixed port. Random port at every start is safer than simply at first startup in the general case, for the reasons outlined above.

I was talking about the **second** time **new** user start qBittorrent (**after** the first startup).

You shouldn't underestimate the ""average user"" carelessness (I experience this often in my work :stuck_out_tongue:)"
567571744,11637,Chocobo1,2019-12-19T16:53:22Z,"@FranciscoPombal 
FYI you only need to rebase a PR when you saw merge conflicts on github (you can find examples in older PRs of what it looks like). This also save some time for me and others to review & re-approve the PR."
567573040,11637,FranciscoPombal,2019-12-19T16:56:21Z,"@ArcticGems
> I was talking about the **second** time **new** user start qBittorrent (**after** the first startup).
> 
> You shouldn't underestimate the ""average user"" carelessness (I experience this often in my work as IT support stuck_out_tongue)

I still don't understand what the problem is. User that wants to setup port forwarding goes to settings, looks around and sees this:

![image](https://user-images.githubusercontent.com/17580742/71192364-0566c180-2280-11ea-848c-1a3e99560cb8.png)

I'd say this is pretty clear and difficult to miss. The option to select the port number is even greyed out until they unselect ""Use a different port each startup"". If they are careless enough to miss it the first time, they will surely see it the second time when they go double-check the port number and notice it has changed."
567573901,11637,FranciscoPombal,2019-12-19T16:58:24Z,"@Chocobo1 
> FYI you only need to rebase a PR when you saw merge conflicts on github (you can find examples in older PRs of what it looks like). This also save some time for me and others to review & re-approve the PR.

Hmm, sorry, I though I needed to rebase up to the most recent commit regardless. Thanks for the heads-up."
567578865,11637,ArcticGems,2019-12-19T17:11:02Z,"> @ArcticGems
> . If they are careless enough to miss it the first time, they will surely see it the second time when they go double-check the port number and notice it has changed.

You would be suprised how many who don't double-check things and choose to complain immediately to the support. Anyway, you guys can decide what you think is the best."
567635413,11637,sledgehammer999,2019-12-19T19:45:32Z,">Just to clarify, the port number is actually assigned from OS so it is (very) unlikely to be used by other apps.

Actually no.
We setup the variable like this:
```c++
, m_port(BITTORRENT_SESSION_KEY(""Port""), -1)
```

And then immediately in the session constructor we do this:
```c++
if (port() < 0)
        m_port = Utils::Random::rand(1024, 65535);
```

This would have the nice sideeffect that until a user chooses a different setting he would get a random port on each start. However, the settings file is saved even if the user doesn't change something and immediately closes the client. (this it saves the new random port to the conf file as a fixed value).

Offtopic: The saving of the conf file immediately after launch and exit without changing a settings smells like a bug and should be investigated later. We shouldn't write the conf file unnecessarily. It could lead to data loss."
567638011,11637,Chocobo1,2019-12-19T19:52:53Z,"> 
> 
> > Just to clarify, the port number is actually assigned from OS so it is (very) unlikely to be used by other apps.
> 
> Actually no.
> We setup the variable like this:

I think you're missing the context, I was referring to https://github.com/qbittorrent/qBittorrent/pull/11637/files#diff-5961e6811ef7cd17f473ca94c53d5559R435

And see this: https://github.com/qbittorrent/qBittorrent/blob/30502de960b70c2b8bd132ea6261d5b20aad41d3/src/base/bittorrent/session.cpp#L1442

>Offtopic: The saving of the conf file immediately after launch and exit without changing a settings smells like a bug and should be investigated later. We shouldn't write the conf file unnecessarily. It could lead to data loss.

It seems it only happens once for each fresh install, not a big deal for me since there is always some other settings being modified along with it (such as EULA on program start)."
568246051,11637,p43b1,2019-12-22T09:33:52Z,">     * ~AnnounceToAllTrackers (off->on): not sure why this was off by default. It should improve peer discoverability.~ The situation this change seeks to improve needs a better and more involved fix overall than this simple default setting toggle.

Old but gold answer about why announcing to all trackers (edit: in a tier or not it's not important) is a very very bad idea: [https://ktetch.co.uk/2014/01/bittorrent-tracker-madness/](url)
"
568324316,11637,FranciscoPombal,2019-12-23T01:29:39Z,@Chocobo1 Anything else preventing the merge?
568338207,11637,Chocobo1,2019-12-23T03:07:55Z,">@Chocobo1 Anything else preventing the merge?

I can't merge a PR (outside of WebUI stuff) with only my approval, it will require other collaborators approval too.

Lets ping @glassez for review."
568354506,11637,glassez,2019-12-23T04:54:38Z,"I have my doubts about ""random port"" by default. Having it is more likely to run into a busy port from time to time than having a well-known port.
As of ""disk cache size"" I have no personal experience. But as far as I remember there were the problems with it in the past and we repeatedly changed its value. Will we step on the same rake again?

My general opinion about default option is qBittorrent should work from the scratch on typical system of regular user.

BTW, guided ""First time run settings"" dialog will be useful, IMO."
568356206,11637,ArcticGems,2019-12-23T05:04:44Z,"> 
> BTW, guided ""First time run settings"" dialog will be useful, IMO.

or a option during installation to choose between ""Regular settings"" or ""Low-end computer settings"".
(a option that can also be made afterwards in qBittorrent Option).

Example =
- Regular settings
- Low-end computer settings
- Custom (Only in qBittorrent Option: Automatically switch to this when user manually change relevant settings)"
568503481,11637,FranciscoPombal,2019-12-23T15:24:53Z,"@glassez 

> I have my doubts about ""random port"" by default. Having it is more likely to run into a busy port from time to time than having a well-known port.

This was discussed above. The problem is precisely that qBittorrent does not use a well-known port. It uses a random port determined at first startup, which stays that way. There is a chance that the random port chosen at first startup is not the best, so always randomizing the port enables users to fix whatever port choice problem arises via a simple ""turn it off and on again"".

> As of ""disk cache size"" I have no personal experience. But as far as I remember there were the problems with it in the past and we repeatedly changed its value. Will we step on the same rake again?

As discussed above, setting it to `auto` lets libtorrent select:
- more reasonable values for users with more resources
- similar values to what we have now for users in more constrained environments

So it is a strictly better option than the fixed value it has now.

> My general opinion about default option is qBittorrent should work from the scratch on typical system of regular user.

Yes. That is why I am proposing these changes. I know from experience that certain settings are not optimal for the average case (mostly `CheckingMemUsage` and `SizeDiskCacheSize`). Additionally, the proposed changes take into account users with low-end/low-power machines, such as raspberry pis.

> BTW, guided ""First time run settings"" dialog will be useful, IMO.

Yes, something like the ""bittorrent settings calculators"" of old. Ideally, libtorrent could even have the possibility of auto-adjusting most important settings based on a short automatic test. But that is for another day."
568513216,11637,Chocobo1,2019-12-23T16:05:06Z,">so always randomizing the port enables users to fix whatever port choice problem arises via a simple ""turn it off and on again"".

That is not precise enough, see my relevant posts above:
https://github.com/qbittorrent/qBittorrent/pull/11637#issuecomment-567301684
https://github.com/qbittorrent/qBittorrent/pull/11637#issuecomment-567638011
In short, with `UseRandomPort = true;` the port number will be assigned by the OS (randomly) which should be an unused port at the time making the API call.
"
568520298,11637,glassez,2019-12-23T16:33:52Z,">which should be an unused port at the time making the API call.

Well, it's good."
568648649,11637,Chocobo1,2019-12-24T04:27:19Z,"@FranciscoPombal 
Thank you!"
581267766,11637,ghost,2020-02-03T07:02:01Z,Seeing some crazy disk I/O when diskcache is set to auto in a 32G system.
581342456,11637,arvidn,2020-02-03T10:26:50Z,"@an0n666 ""crazy"" good or ""crazy"" bad? Is the disk cache itself being flushed to swapfile?"
581354219,11637,ghost,2020-02-03T10:54:04Z,"> @an0n666 ""crazy"" good or ""crazy"" bad? Is the disk cache itself being flushed to swapfile?

crazy bad. It started reading at 150 MB+ from disk. No download/upload ongoing.
Maybe it was loading files onto cache from disk?"
581469288,11637,FranciscoPombal,2020-02-03T15:29:57Z,"> Seeing some crazy disk I/O when diskcache is set to auto in a 32G system.

According to current libtorrent code, auto would set the cache to around 800 MiB on a 32 GiB system. This is probably excessive. You can manually set it to lower.

Meanwhile, libtorrent could set auto cache to be `amount_of_ram/60` or even a flat value of, say, 500 MiB for systems with > 16 GiB of RAM."
581473338,11637,ghost,2020-02-03T15:38:10Z,Most people would not want to waste that much RAM on a torrent client. When people see that much disk I/O or RAM usage they’ll probably switch to some other client instead. Why not keep the default to a low value so everyone is happy? If someone wants to allocate more RAM they could change it from settings. 
581475463,11637,arvidn,2020-02-03T15:42:40Z,"I don't think 800 MiB is excessive. If one downloads a torrent, if the whole torrent can fit in the cache you get the best performance.

It's not obvious to me that setting the cache to a high value is inherently problematic (apart from the fact that the process will use a lot of *anonymous* memory, which won't get evicted gracefully under memory pressure).

@an0n666 could you provide more details of what is being read from disk?
is a file being checked?
is a file being moved?
you say 150 MB (I assume you mean per second), would you expect libtorrent to read faster or slower than that? (and why?)
what tool did you use to measure the 150MB/s, and what exactly did it measure?"
581479025,11637,ghost,2020-02-03T15:49:40Z,"I think the disk read maybe unrelated. It could be due to some file check on startup(even though nothing was saying checking). 
800 MB is not too much but if your system is not dedicated to torrenting you might want other processes to use that extra RAM. Basically it all depends on priorities. "
581480146,11637,arvidn,2020-02-03T15:52:01Z,"> 800 MB is not too much but if your system is not dedicated to torrenting you might want other processes to use that extra RAM. Basically it all depends on priorities.

agreed. In fact, in the next major release of libtorrent (2.0) the disk cache will use the kernel facility, to make it use as much RAM as the kernel has available to it, and gracefully evict it when the system needs more free RAM."
581523951,11637,FranciscoPombal,2020-02-03T17:24:26Z,"> Most people would not want to waste that much RAM on a torrent client. When people see that much disk I/O or RAM usage they’ll probably switch to some other client instead. Why not keep the default to a low value so everyone is happy? If someone wants to allocate more RAM they could change it from settings.

This change came about because the vast majority of users have < 32 GiB RAM, and for them the previous fixed disk cache value was sometimes a major performance bottleneck."
581528189,11637,ghost,2020-02-03T17:34:08Z,"> > Most people would not want to waste that much RAM on a torrent client. When people see that much disk I/O or RAM usage they’ll probably switch to some other client instead. Why not keep the default to a low value so everyone is happy? If someone wants to allocate more RAM they could change it from settings.
> 
> This change came about because the vast majority of users have < 32 GiB RAM, and for them the previous fixed disk cache value was sometimes a major performance bottleneck.

I see. But even on a 16/8 GiB system this would use an amount of RAM which is ""significant"" to some users. Specially when other alternatives might be using lesser amount of RAM with quite similar performance why would anyone opt to use qBit? Unless someone can prove that using a 500 MiB cache instead of 64 gives a significant performance boost, this will remain up to debate."
581539085,11637,FranciscoPombal,2020-02-03T17:59:33Z,"> I see. But even on a 16/8 GiB system this would use an amount of RAM which is ""significant"" to some users. Specially when other alternatives might be using lesser amount of RAM with quite similar performance why would anyone opt to use qBit? Unless someone can prove that using a 500 MiB cache instead of 64 gives a significant performance boost, this will remain up to debate.

I did not claim that 500 MiB is a better value than 64 MiB. My point is that currently, libtorrent assigns ""reasonable"" values for users that have 512 MiB RAM and up, with the exception of users with 2 GiB (for these users, auto sets the value to ~68 MiB, which is basically the same as before). Here, ""reasonable"" means ""larger enough than 64 MiB to not be a bottleneck but not so big that users would complain about excessive RAM usage"".

To quote my table above, extrapolated from the libtorrent code:

> Some examples:
> 
>     * 512 MiB RAM: 512/10 = ~51,2 MiB allocated for the disk cache (actually a bit smaller than the current default, which with this little RAM is probably a good thing)
> 
>     * 1 GiB RAM: 1024/10 = ~100 MiB (only slightly bigger)
> 
>     * 2 GiB RAM: 2048/30 = ~68 MiB (about on par)
> 
>     * 4 GiB RAM: 4096/30 = ~136 MiB (bigger, not unreasonable)
> 
>     * 8 GIB RAM: 8192/40 = ~200 MiB (bigger, not unreasonable)
> 
>     * 16 GiB RAM: 16384/40 = ~400 MiB (bigger, not unreasonable)
>       ...
> 

It's with 32 GiB and up that the current libtorrent logic starts setting values that are perhaps too big. But like arvid mentioned, all this will be resolved in libtorrent 2.0. Nobody will have to fiddle with setting the amount of cache anymore. Until then, this is a workaround to:

- prevent tanking performance due to too little cache
- dissuade users from setting it to silly values like 1 GiB and up."
581838796,11637,ghost,2020-02-04T10:19:47Z,"On a desktop environment 400 MiB could be unreasonable to many users. I believe the values that are automatically set by libtorrent should be re-calibrated to not go over a pre-set maximum. Like don't set anything beyond 200 MiB for even >8 GiB systems. The user always has the option to configure the cache settings if he's experiencing a bottleneck. Cache related bottlenecks will not happen in every use case. One guy could download a 400 MiB file to his cache but if no one is downloading from him, keeping that data in cache and wasting the memory sounds unreasonable to me. Also downloading to cache will not give any significant speed boost as well if the network is not fast enough. So is it ideal to use a large cache even if someone has a very slow network?"
581894097,11637,arvidn,2020-02-04T12:46:38Z,"it seems reasonable to make the ""logarithm"" extend past 4 GiB. I'm open to suggestions. Here's the current logic: https://github.com/arvidn/libtorrent/blob/d33b0506a0f4cd61860fd54864267c82d3e171e3/src/disk_buffer_pool.cpp#L294

Maybe there should be another tier at 8GiB"
581908157,11637,FranciscoPombal,2020-02-04T13:25:33Z,"@arvidn 
I think these would be reasonable target values:

- 8 -> 200 MiB (same as now)
- 12 -> 250 MiB
- 16 -> 300 MiB
- 24 -> 350 MiB
- 32 -> 400 MiB
- \>32 -> 512 MiB

I don't think it makes sense to fine tune too much for more than 32 GiB since:
a) it is already a huge amount
b) libtorrent 2.0 will probably come around way before systems with >32 GiB ram become common place among the majority of the user base (whereas systems with 8-16 GiB RAM are already common now).

@an0n666 thoughts?"
582027341,11637,xavier2k6,2020-02-04T17:37:16Z,">* 512 MiB RAM: 512/10 = ~51,2 MiB allocated for the disk cache (actually a bit smaller than the current default, which with this little RAM is probably a good thing)
>
>* 1 GiB RAM: 1024/10 = ~100 MiB (only slightly bigger)
>
>* 2 GiB RAM: 2048/30 = ~68 MiB (about on par)
>
>* 4 GiB RAM: 4096/30 = ~136 MiB (bigger, not unreasonable)
>
>* 8 GIB RAM: 8192/40 = ~200 MiB (bigger, not unreasonable)
>
>* 16 GiB RAM: 16384/40 = ~400 MiB (bigger, not unreasonable)

I think the current method should be kept **as is** but with the addition of below:

>Maybe there should be another tier at 8GiB

A new tier(s) at 8GiB/16GiB or 32GiB

There should probably be a MAX Upper Limit Cap for the manual setting of the disk cache setting too. (Just like the outstanding memory when checking torrents is capped at 1024MiB)

Should manual disk cache setting only have a range up to max 1024MiB??
this would fall under the **current** calculation:

* 32 GiB RAM: 32768/40 = ~800 MiB"
582042491,11637,ghost,2020-02-04T18:11:54Z,"> it seems reasonable to make the ""logarithm"" extend past 4 GiB. I'm open to suggestions. Here's the current logic: https://github.com/arvidn/libtorrent/blob/d33b0506a0f4cd61860fd54864267c82d3e171e3/src/disk_buffer_pool.cpp#L294
> 
> Maybe there should be another tier at 8GiB

If this is the current logic then the above mentioned calculations are not correct.
You're take a 40th of everything exceeding 4 GiB
 a 30th of everything exceeding 1 GiB
and a 10th of everything below a GiB and adding those up to get the final cache value?
So on a system with 8 GiB RAM it would be using around ~256MiB not ~200MiB?
Anyways, if that's the case then adding another tier on 8GiB would help."
582046930,11637,FranciscoPombal,2020-02-04T18:22:08Z,"@xavier2k6 the table you quoted is what this PR implements. In the comment above yours, I suggested new cache values for systems with large amounts of RAM, which is what we are now talking about.

Without this PR, (i. e. in all stable releases of qBittorrent thus far), the cache is set to 64 MiB for everyone.

@an0n666 
8 GiB RAM = 8192 MiB ; 8192/40 = 204,8"
582048858,11637,ghost,2020-02-04T18:26:33Z,"
> 8 GiB RAM = 8192 MiB ; 8192/40 = 204,8

The code doesn't do a 8192/40. Check the link."
582082520,11637,xavier2k6,2020-02-04T19:45:26Z,">the table you quoted is what this PR implements.

I thought the quoted table was what the ""**auto**"" option **implements currently** ie the libtorrent ""logarithm""
If that's true then my opinion is the same, it should stay as is & tweaked with new tier(s) & I do apologise in advance if I've taken it up wrong/misunderstood.

> In the comment above yours, I suggested new cache values for systems with large amounts of RAM, which is what we are now talking about.

You are suggesting to lower the cache values though on what the ""logarithm"" does currently??

>I think these would be reasonable target values:

>*  8 -> 200 MiB (same as now)
>*  12 -> 250 MiB
>*  16 -> 300 MiB
>*  24 -> 350 MiB
>*  32 -> 400 MiB
>*  >32 -> 512 MiB

BTW - I am a plus 1 for implementing the default of ""auto"" if it does in fact use the libtorrent ""logarithm"""
